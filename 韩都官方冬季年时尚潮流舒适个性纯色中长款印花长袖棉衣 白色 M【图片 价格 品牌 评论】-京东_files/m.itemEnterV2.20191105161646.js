define("zepto",function(require,exports,t){var _cacheThisModule_;var e=function(){var t,e,n,i,r=[],o=r.concat,a=r.filter,s=r.slice,u=window.document,f={},c={},l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},h=/^\s*<(\w+|!)[^>]*>/,p=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,d=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,m=/^(?:body|html)$/i,v=/([A-Z])/g,g=["val","css","html","text","data","width","height","offset"],y=["after","prepend","before","append"],b=u.createElement("table"),w=u.createElement("tr"),x={tr:u.createElement("tbody"),tbody:b,thead:b,tfoot:b,td:w,th:w,"*":u.createElement("div")},E=/complete|loaded|interactive/,T=/^[\w-]*$/,S={},j=S.toString,C={},O,N,A=u.createElement("div"),P={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},M=Array.isArray||function(t){return t instanceof Array};C.matches=function(t,e){if(!e||!t||t.nodeType!==1)return false;var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(n)return n.call(t,e);var i,r=t.parentNode,o=!r;if(o)(r=A).appendChild(t);i=~C.qsa(r,e).indexOf(t);o&&A.removeChild(t);return i};function D(t){return t==null?String(t):S[j.call(t)]||"object"}function k(t){return D(t)=="function"}function F(t){return t!=null&&t==t.window}function L(t){return t!=null&&t.nodeType==t.DOCUMENT_NODE}function $(t){return D(t)=="object"}function R(t){return $(t)&&!F(t)&&Object.getPrototypeOf(t)==Object.prototype}function _(t){var e=!!t&&"length"in t&&t.length,i=n.type(t);return"function"!=i&&!F(t)&&("array"==i||e===0||typeof e=="number"&&e>0&&e-1 in t)}function q(t){return a.call(t,function(t){return t!=null})}function z(t){return t.length>0?n.fn.concat.apply([],t):t}O=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})};function I(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}N=function(t){return a.call(t,function(e,n){return t.indexOf(e)==n})};function W(t){return t in c?c[t]:c[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function Z(t,e){return typeof e=="number"&&!l[I(t)]?e+"px":e}function B(t){var e,n;if(!f[t]){e=u.createElement(t);u.body.appendChild(e);n=getComputedStyle(e,"").getPropertyValue("display");e.parentNode.removeChild(e);n=="none"&&(n="block");f[t]=n}return f[t]}function V(t){return"children"in t?s.call(t.children):n.map(t.childNodes,function(t){if(t.nodeType==1)return t})}function H(t,e){var n,i=t?t.length:0;for(n=0;n<i;n++)this[n]=t[n];this.length=i;this.selector=e||""}C.fragment=function(e,i,r){var o,a,f;if(p.test(e))o=n(u.createElement(RegExp.$1));if(!o){if(e.replace)e=e.replace(d,"<$1></$2>");if(i===t)i=h.test(e)&&RegExp.$1;if(!(i in x))i="*";f=x[i];f.innerHTML=""+e;o=n.each(s.call(f.childNodes),function(){f.removeChild(this)})}if(R(r)){a=n(o);n.each(r,function(t,e){if(g.indexOf(t)>-1)a[t](e);else a.attr(t,e)})}return o};C.Z=function(t,e){return new H(t,e)};C.isZ=function(t){return t instanceof C.Z};C.init=function(e,i){var r;if(!e)return C.Z();else if(typeof e=="string"){e=e.trim();if(e[0]=="<"&&h.test(e))r=C.fragment(e,RegExp.$1,i),e=null;else if(i!==t)return n(i).find(e);else r=C.qsa(u,e)}else if(k(e))return n(u).ready(e);else if(C.isZ(e))return e;else{if(M(e))r=q(e);else if($(e))r=[e],e=null;else if(h.test(e))r=C.fragment(e.trim(),RegExp.$1,i),e=null;else if(i!==t)return n(i).find(e);else r=C.qsa(u,e)}return C.Z(r,e)};n=function(t,e){return C.init(t,e)};function U(n,i,r){for(e in i)if(r&&(R(i[e])||M(i[e]))){if(R(i[e])&&!R(n[e]))n[e]={};if(M(i[e])&&!M(n[e]))n[e]=[];U(n[e],i[e],r)}else if(i[e]!==t)n[e]=i[e]}n.extend=function(t){var e,n=s.call(arguments,1);if(typeof t=="boolean"){e=t;t=n.shift()}n.forEach(function(n){U(t,n,e)});return t};C.qsa=function(t,e){var n,i=e[0]=="#",r=!i&&e[0]==".",o=i||r?e.slice(1):e,a=T.test(o);return t.getElementById&&a&&i?(n=t.getElementById(o))?[n]:[]:t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11?[]:s.call(a&&!i&&t.getElementsByClassName?r?t.getElementsByClassName(o):t.getElementsByTagName(e):t.querySelectorAll(e))};function X(t,e){return e==null?n(t):n(t).filter(e)}n.contains=u.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){while(e&&(e=e.parentNode))if(e===t)return true;return false};function Y(t,e,n,i){return k(e)?e.call(t,n,i):e}function G(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function J(e,n){var i=e.className||"",r=i&&i.baseVal!==t;if(n===t)return r?i.baseVal:i;r?i.baseVal=n:e.className=n}function K(t){try{return t?t=="true"||(t=="false"?false:t=="null"?null:+t+""==t?+t:/^[\[\{]/.test(t)?n.parseJSON(t):t):t}catch(e){return t}}n.type=D;n.isFunction=k;n.isWindow=F;n.isArray=M;n.isPlainObject=R;n.isEmptyObject=function(t){var e;for(e in t)return false;return true};n.isNumeric=function(t){var e=Number(t),n=typeof t;return t!=null&&n!="boolean"&&(n!="string"||t.length)&&!isNaN(e)&&isFinite(e)||false};n.inArray=function(t,e,n){return r.indexOf.call(e,t,n)};n.camelCase=O;n.trim=function(t){return t==null?"":String.prototype.trim.call(t)};n.uuid=0;n.support={};n.expr={};n.noop=function(){};n.map=function(t,e){var n,i=[],r,o;if(_(t))for(r=0;r<t.length;r++){n=e(t[r],r);if(n!=null)i.push(n)}else for(o in t){n=e(t[o],o);if(n!=null)i.push(n)}return z(i)};n.each=function(t,e){var n,i;if(_(t)){for(n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===false)return t}else{for(i in t)if(e.call(t[i],i,t[i])===false)return t}return t};n.grep=function(t,e){return a.call(t,e)};if(window.JSON)n.parseJSON=JSON.parse;n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){S["[object "+e+"]"]=e.toLowerCase()});n.fn={constructor:C.Z,length:0,forEach:r.forEach,reduce:r.reduce,push:r.push,sort:r.sort,splice:r.splice,indexOf:r.indexOf,concat:function(){var t,e,n=[];for(t=0;t<arguments.length;t++){e=arguments[t];n[t]=C.isZ(e)?e.toArray():e}return o.apply(C.isZ(this)?this.toArray():this,n)},map:function(t){return n(n.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(t){if(E.test(u.readyState)&&u.body)t(n);else u.addEventListener("DOMContentLoaded",function(){t(n)},false);return this},get:function(e){return e===t?s.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){if(this.parentNode!=null)this.parentNode.removeChild(this)})},each:function(t){r.every.call(this,function(e,n){return t.call(e,n,e)!==false});return this},filter:function(t){if(k(t))return this.not(this.not(t));return n(a.call(this,function(e){return C.matches(e,t)}))},add:function(t,e){return n(N(this.concat(n(t,e))))},is:function(t){return this.length>0&&C.matches(this[0],t)},not:function(e){var i=[];if(k(e)&&e.call!==t)this.each(function(t){if(!e.call(this,t))i.push(this)});else{var r=typeof e=="string"?this.filter(e):_(e)&&k(e.item)?s.call(e):n(e);this.forEach(function(t){if(r.indexOf(t)<0)i.push(t)})}return n(i)},has:function(t){return this.filter(function(){return $(t)?n.contains(this,t):n(this).find(t).size()})},eq:function(t){return t===-1?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!$(t)?t:n(t)},last:function(){var t=this[this.length-1];return t&&!$(t)?t:n(t)},find:function(t){var e,i=this;if(!t)e=n();else if(typeof t=="object")e=n(t).filter(function(){var t=this;return r.some.call(i,function(e){return n.contains(e,t)})});else if(this.length==1)e=n(C.qsa(this[0],t));else e=this.map(function(){return C.qsa(this,t)});return e},closest:function(t,e){var i=[],r=typeof t=="object"&&n(t);this.each(function(n,o){while(o&&!(r?r.indexOf(o)>=0:C.matches(o,t)))o=o!==e&&!L(o)&&o.parentNode;if(o&&i.indexOf(o)<0)i.push(o)});return n(i)},parents:function(t){var e=[],i=this;while(i.length>0)i=n.map(i,function(t){if((t=t.parentNode)&&!L(t)&&e.indexOf(t)<0){e.push(t);return t}});return X(e,t)},parent:function(t){return X(N(this.pluck("parentNode")),t)},children:function(t){return X(this.map(function(){return V(this)}),t)},contents:function(){return this.map(function(){return this.contentDocument||s.call(this.childNodes)})},siblings:function(t){return X(this.map(function(t,e){return a.call(V(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return n.map(this,function(e){return e[t]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display="");if(getComputedStyle(this,"").getPropertyValue("display")=="none")this.style.display=B(this.nodeName)})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var e=k(t);if(this[0]&&!e)var i=n(t).get(0),r=i.parentNode||this.length>1;return this.each(function(o){n(this).wrapAll(e?t.call(this,o):r?i.cloneNode(true):i)})},wrapAll:function(t){if(this[0]){n(this[0]).before(t=n(t));var e;while((e=t.children()).length)t=e.first();n(t).append(this)}return this},wrapInner:function(t){var e=k(t);return this.each(function(i){var r=n(this),o=r.contents(),a=e?t.call(this,i):t;o.length?o.wrapAll(a):r.append(a)})},unwrap:function(){this.parent().each(function(){n(this).replaceWith(n(this).children())});return this},clone:function(){return this.map(function(){return this.cloneNode(true)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var i=n(this);(e===t?i.css("display")=="none":e)?i.show():i.hide()})},prev:function(t){return n(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return n(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var i=this.innerHTML;n(this).empty().append(Y(this,t,e,i))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var n=Y(this,t,e,this.textContent);this.textContent=n==null?"":""+n}):0 in this?this.pluck("textContent").join(""):null},attr:function(n,i){var r;return typeof n=="string"&&!(1 in arguments)?0 in this&&this[0].nodeType==1&&(r=this[0].getAttribute(n))!=null?r:t:this.each(function(t){if(this.nodeType!==1)return;if($(n))for(e in n)G(this,e,n[e]);else G(this,n,Y(this,i,t,this.getAttribute(n)))})},removeAttr:function(t){return this.each(function(){this.nodeType===1&&t.split(" ").forEach(function(t){G(this,t)},this)})},prop:function(t,e){t=P[t]||t;return 1 in arguments?this.each(function(n){this[t]=Y(this,e,n,this[t])}):this[0]&&this[0][t]},removeProp:function(t){t=P[t]||t;return this.each(function(){delete this[t]})},data:function(e,n){var i="data-"+e.replace(v,"-$1").toLowerCase();var r=1 in arguments?this.attr(i,n):this.attr(i);return r!==null?K(r):t},val:function(t){if(0 in arguments){if(t==null)t="";return this.each(function(e){this.value=Y(this,t,e,this.value)})}else{return this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)}},offset:function(t){if(t)return this.each(function(e){var i=n(this),r=Y(this,t,e,i.offset()),o=i.offsetParent().offset(),a={top:r.top-o.top,left:r.left-o.left};if(i.css("position")=="static")a["position"]="relative";i.css(a)});if(!this.length)return null;if(u.documentElement!==this[0]&&!n.contains(u.documentElement,this[0]))return{top:0,left:0};var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(t,i){if(arguments.length<2){var r=this[0];if(typeof t=="string"){if(!r)return;return r.style[O(t)]||getComputedStyle(r,"").getPropertyValue(t)}else if(M(t)){if(!r)return;var o={};var a=getComputedStyle(r,"");n.each(t,function(t,e){o[e]=r.style[O(e)]||a.getPropertyValue(e)});return o}}var s="";if(D(t)=="string"){if(!i&&i!==0)this.each(function(){this.style.removeProperty(I(t))});else s=I(t)+":"+Z(t,i)}else{for(e in t)if(!t[e]&&t[e]!==0)this.each(function(){this.style.removeProperty(I(e))});else s+=I(e)+":"+Z(e,t[e])+";"}return this.each(function(){this.style.cssText+=";"+s})},index:function(t){return t?this.indexOf(n(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){if(!t)return false;return r.some.call(this,function(t){return this.test(J(t))},W(t))},addClass:function(t){if(!t)return this;return this.each(function(e){if(!("className"in this))return;i=[];var r=J(this),o=Y(this,t,e,r);o.split(/\s+/g).forEach(function(t){if(!n(this).hasClass(t))i.push(t)},this);i.length&&J(this,r+(r?" ":"")+i.join(" "))})},removeClass:function(e){return this.each(function(n){if(!("className"in this))return;if(e===t)return J(this,"");i=J(this);Y(this,e,n,i).split(/\s+/g).forEach(function(t){i=i.replace(W(t)," ")});J(this,i.trim())})},toggleClass:function(e,i){if(!e)return this;return this.each(function(r){var o=n(this),a=Y(this,e,r,J(this));a.split(/\s+/g).forEach(function(e){(i===t?!o.hasClass(e):i)?o.addClass(e):o.removeClass(e)})})},scrollTop:function(e){if(!this.length)return;var n="scrollTop"in this[0];if(e===t)return n?this[0].scrollTop:this[0].pageYOffset;return this.each(n?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})},scrollLeft:function(e){if(!this.length)return;var n="scrollLeft"in this[0];if(e===t)return n?this[0].scrollLeft:this[0].pageXOffset;return this.each(n?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})},position:function(){if(!this.length)return;var t=this[0],e=this.offsetParent(),i=this.offset(),r=m.test(e[0].nodeName)?{top:0,left:0}:e.offset();i.top-=parseFloat(n(t).css("margin-top"))||0;i.left-=parseFloat(n(t).css("margin-left"))||0;r.top+=parseFloat(n(e[0]).css("border-top-width"))||0;r.left+=parseFloat(n(e[0]).css("border-left-width"))||0;return{top:i.top-r.top,left:i.left-r.left}},offsetParent:function(){return this.map(function(){var t=this.offsetParent||u.body;while(t&&!m.test(t.nodeName)&&n(t).css("position")=="static")t=t.offsetParent;return t})}};n.fn.detach=n.fn.remove;["width","height"].forEach(function(e){var i=e.replace(/./,function(t){return t[0].toUpperCase()});n.fn[e]=function(r){var o,a=this[0];if(r===t)return F(a)?a["inner"+i]:L(a)?a.documentElement["scroll"+i]:(o=this.offset())&&o[e];else return this.each(function(t){a=n(this);a.css(e,Y(this,r,t,a[e]()))})}});function Q(t,e){e(t);for(var n=0,i=t.childNodes.length;n<i;n++)Q(t.childNodes[n],e)}y.forEach(function(e,i){var r=i%2;n.fn[e]=function(){var e,o=n.map(arguments,function(i){var r=[];e=D(i);if(e=="array"){i.forEach(function(e){if(e.nodeType!==t)return r.push(e);else if(n.zepto.isZ(e))return r=r.concat(e.get());r=r.concat(C.fragment(e))});return r}return e=="object"||i==null?i:C.fragment(i)}),a,s=this.length>1;if(o.length<1)return this;return this.each(function(t,e){a=r?e:e.parentNode;e=i==0?e.nextSibling:i==1?e.firstChild:i==2?e:null;var f=n.contains(u.documentElement,a);o.forEach(function(t){if(s)t=t.cloneNode(true);else if(!a)return n(t).remove();a.insertBefore(t,e);if(f)Q(t,function(t){if(t.nodeName!=null&&t.nodeName.toUpperCase()==="SCRIPT"&&(!t.type||t.type==="text/javascript")&&!t.src){var e=t.ownerDocument?t.ownerDocument.defaultView:window;e["eval"].call(e,t.innerHTML)}})})})};n.fn[r?e+"To":"insert"+(i?"Before":"After")]=function(t){n(t)[e](this);return this}});C.Z.prototype=H.prototype=n.fn;C.uniq=N;C.deserializeValue=K;n.zepto=C;return n}();window.Zepto=e;window.$===undefined&&(window.$=e);(function(t){var e=1,n,i=Array.prototype.slice,r=t.isFunction,o=function(t){return typeof t=="string"},a={},s={},u="onfocusin"in window,f={focus:"focusin",blur:"focusout"},c={mouseenter:"mouseover",mouseleave:"mouseout"};s.click=s.mousedown=s.mouseup=s.mousemove="MouseEvents";function l(t){return t._zid||(t._zid=e++)}function h(t,e,n,i){e=p(e);if(e.ns)var r=d(e.ns);return(a[l(t)]||[]).filter(function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||r.test(t.ns))&&(!n||l(t.fn)===l(n))&&(!i||t.sel==i)})}function p(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function d(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function m(t,e){return t.del&&(!u&&t.e in f)||!!e}function v(t){return c[t]||u&&f[t]||t}function g(e,i,r,o,s,u,f){var h=l(e),d=a[h]||(a[h]=[]);i.split(/\s/).forEach(function(i){if(i=="ready")return t(document).ready(r);var a=p(i);a.fn=r;a.sel=s;if(a.e in c)r=function(e){var n=e.relatedTarget;if(!n||n!==this&&!t.contains(this,n))return a.fn.apply(this,arguments)};a.del=u;var l=u||r;a.proxy=function(t){t=T(t);if(t.isImmediatePropagationStopped())return;t.data=o;var i=l.apply(e,t._args==n?[t]:[t].concat(t._args));if(i===false)t.preventDefault(),t.stopPropagation();return i};a.i=d.length;d.push(a);if("addEventListener"in e)e.addEventListener(v(a.e),a.proxy,m(a,f))})}function y(t,e,n,i,r){var o=l(t);(e||"").split(/\s/).forEach(function(e){h(t,e,n,i).forEach(function(e){delete a[o][e.i];if("removeEventListener"in t)t.removeEventListener(v(e.e),e.proxy,m(e,r))})})}t.event={add:g,remove:y};t.proxy=function(e,n){var a=2 in arguments&&i.call(arguments,2);if(r(e)){var s=function(){return e.apply(n,a?a.concat(i.call(arguments)):arguments)};s._zid=l(e);return s}else if(o(n)){if(a){a.unshift(e[n],e);return t.proxy.apply(null,a)}else{return t.proxy(e[n],e)}}else{throw new TypeError("expected function")}};t.fn.bind=function(t,e,n){return this.on(t,e,n)};t.fn.unbind=function(t,e){return this.off(t,e)};t.fn.one=function(t,e,n,i){return this.on(t,e,n,i,1)};var b=function(){return true},w=function(){return false},x=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,E={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function T(e,i){if(i||!e.isDefaultPrevented){i||(i=e);t.each(E,function(t,n){var r=i[t];e[t]=function(){this[n]=b;return r&&r.apply(i,arguments)};e[n]=w});e.timeStamp||(e.timeStamp=Date.now());if(i.defaultPrevented!==n?i.defaultPrevented:"returnValue"in i?i.returnValue===false:i.getPreventDefault&&i.getPreventDefault())e.isDefaultPrevented=b}return e}function S(t){var e,i={originalEvent:t};for(e in t)if(!x.test(e)&&t[e]!==n)i[e]=t[e];return T(i,t)}t.fn.delegate=function(t,e,n){return this.on(e,t,n)};t.fn.undelegate=function(t,e,n){return this.off(e,t,n)};t.fn.live=function(e,n){t(document.body).delegate(this.selector,e,n);return this};t.fn.die=function(e,n){t(document.body).undelegate(this.selector,e,n);return this};t.fn.on=function(e,a,s,u,f){var c,l,h=this;if(e&&!o(e)){t.each(e,function(t,e){h.on(t,a,s,e,f)});return h}if(!o(a)&&!r(u)&&u!==false)u=s,s=a,a=n;if(u===n||s===false)u=s,s=n;if(u===false)u=w;return h.each(function(n,r){if(f)c=function(t){y(r,t.type,u);return u.apply(this,arguments)};if(a)l=function(e){var n,o=t(e.target).closest(a,r).get(0);if(o&&o!==r){n=t.extend(S(e),{currentTarget:o,liveFired:r});return(c||u).apply(o,[n].concat(i.call(arguments,1)))}};g(r,e,u,s,a,l||c)})};t.fn.off=function(e,i,a){var s=this;if(e&&!o(e)){t.each(e,function(t,e){s.off(t,i,e)});return s}if(!o(i)&&!r(a)&&a!==false)a=i,i=n;if(a===false)a=w;return s.each(function(){y(this,e,a,i)})};t.fn.trigger=function(e,n){e=o(e)||t.isPlainObject(e)?t.Event(e):T(e);e._args=n;return this.each(function(){if(e.type in f&&typeof this[e.type]=="function")this[e.type]();else if("dispatchEvent"in this)this.dispatchEvent(e);else t(this).triggerHandler(e,n)})};t.fn.triggerHandler=function(e,n){var i,r;this.each(function(a,s){i=S(o(e)?t.Event(e):e);i._args=n;i.target=s;t.each(h(s,e.type||e),function(t,e){r=e.proxy(i);if(i.isImmediatePropagationStopped())return false})});return r};("focusin focusout focus blur load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select keydown keypress keyup error").split(" ").forEach(function(e){t.fn[e]=function(t){return 0 in arguments?this.bind(e,t):this.trigger(e)}});t.Event=function(t,e){if(!o(t))e=t,t=e.type;var n=document.createEvent(s[t]||"Events"),i=true;if(e)for(var r in e)r=="bubbles"?i=!!e[r]:n[r]=e[r];n.initEvent(t,i,true);return T(n)}})(e);(function(t){var e=+new Date,n=window.document,i,r,o=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,a=/^(?:text|application)\/javascript/i,s=/^(?:text|application)\/xml/i,u="application/json",f="text/html",c=/^\s*$/,l=n.createElement("a");l.href=window.location.href;function h(e,n,i){var r=t.Event(n);t(e).trigger(r,i);return!r.isDefaultPrevented()}function p(t,e,i,r){if(t.global)return h(e||n,i,r)}t.active=0;function d(e){if(e.global&&t.active++===0)p(e,null,"ajaxStart")}function m(e){if(e.global&&!--t.active)p(e,null,"ajaxStop")}function v(t,e){var n=e.context;if(e.beforeSend.call(n,t,e)===false||p(e,n,"ajaxBeforeSend",[t,e])===false)return false;p(e,n,"ajaxSend",[t,e])}function g(t,e,n,i){var r=n.context,o="success";n.success.call(r,t,o,e);if(i)i.resolveWith(r,[t,o,e]);p(n,r,"ajaxSuccess",[e,n,t]);b(o,e,n)}function y(t,e,n,i,r){var o=i.context;i.error.call(o,n,e,t);if(r)r.rejectWith(o,[n,e,t]);p(i,o,"ajaxError",[n,i,t||e]);b(e,n,i)}function b(t,e,n){var i=n.context;n.complete.call(i,e,t);p(n,i,"ajaxComplete",[e,n]);m(n)}function w(t,e,n){if(n.dataFilter==x)return t;var i=n.context;return n.dataFilter.call(i,t,e)}function x(){}t.ajaxJSONP=function(i,r){if(!("type"in i))return t.ajax(i);var o=i.jsonpCallback,a=(t.isFunction(o)?o():o)||"Zepto"+e++,s=n.createElement("script"),u=window[a],f,c=function(e){t(s).triggerHandler("error",e||"abort")},l={abort:c},h;if(r)r.promise(l);t(s).on("load error",function(e,n){clearTimeout(h);t(s).off().remove();if(e.type=="error"||!f){y(null,n||"error",l,i,r)}else{g(f[0],l,i,r)}window[a]=u;if(f&&t.isFunction(u))u(f[0]);u=f=undefined});if(v(l,i)===false){c("abort");return l}window[a]=function(){f=arguments};s.src=i.url.replace(/\?(.+)=\?/,"?$1="+a);n.head.appendChild(s);if(i.timeout>0)h=setTimeout(function(){c("timeout")},i.timeout);return l};t.ajaxSettings={type:"GET",beforeSend:x,success:x,error:x,complete:x,context:null,global:true,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:u,xml:"application/xml, text/xml",html:f,text:"text/plain"},crossDomain:false,timeout:0,processData:true,cache:true,dataFilter:x};function E(t){if(t)t=t.split(";",2)[0];return t&&(t==f?"html":t==u?"json":a.test(t)?"script":s.test(t)&&"xml")||"text"}function T(t,e){if(e=="")return t;return(t+"&"+e).replace(/[&?]{1,2}/,"?")}function S(e){if(e.processData&&e.data&&t.type(e.data)!="string")e.data=t.param(e.data,e.traditional);if(e.data&&(!e.type||e.type.toUpperCase()=="GET"||"jsonp"==e.dataType))e.url=T(e.url,e.data),e.data=undefined}t.ajax=function(e){var o=t.extend({},e||{}),a=t.Deferred&&t.Deferred(),s,u;for(i in t.ajaxSettings)if(o[i]===undefined)o[i]=t.ajaxSettings[i];d(o);if(!o.crossDomain){s=n.createElement("a");s.href=o.url;s.href=s.href;o.crossDomain=l.protocol+"//"+l.host!==s.protocol+"//"+s.host}if(!o.url)o.url=window.location.toString();if((u=o.url.indexOf("#"))>-1)o.url=o.url.slice(0,u);S(o);var f=o.dataType,h=/\?.+=\?/.test(o.url);if(h)f="jsonp";if(o.cache===false||(!e||e.cache!==true)&&("script"==f||"jsonp"==f))o.url=T(o.url,"_="+Date.now());if("jsonp"==f){if(!h)o.url=T(o.url,o.jsonp?o.jsonp+"=?":o.jsonp===false?"":"callback=?");return t.ajaxJSONP(o,a)}var p=o.accepts[f],m={},b=function(t,e){m[t.toLowerCase()]=[t,e]},j=/^([\w-]+:)\/\//.test(o.url)?RegExp.$1:window.location.protocol,C=o.xhr(),O=C.setRequestHeader,N;if(a)a.promise(C);if(!o.crossDomain)b("X-Requested-With","XMLHttpRequest");b("Accept",p||"*/*");if(p=o.mimeType||p){if(p.indexOf(",")>-1)p=p.split(",",2)[0];C.overrideMimeType&&C.overrideMimeType(p)}if(o.contentType||o.contentType!==false&&o.data&&o.type.toUpperCase()!="GET")b("Content-Type",o.contentType||"application/x-www-form-urlencoded");if(o.headers)for(r in o.headers)b(r,o.headers[r]);C.setRequestHeader=b;C.onreadystatechange=function(){if(C.readyState==4){C.onreadystatechange=x;clearTimeout(N);var e,n=false;if(C.status>=200&&C.status<300||C.status==304||C.status==0&&j=="file:"){f=f||E(o.mimeType||C.getResponseHeader("content-type"));if(C.responseType=="arraybuffer"||C.responseType=="blob")e=C.response;else{e=C.responseText;try{e=w(e,f,o);if(f=="script")(1,eval)(e);else if(f=="xml")e=C.responseXML;else if(f=="json")e=c.test(e)?null:t.parseJSON(e)}catch(i){n=i}if(n)return y(n,"parsererror",C,o,a)}g(e,C,o,a)}else{y(C.statusText||null,C.status?"error":"abort",C,o,a)}}};if(v(C,o)===false){C.abort();y(null,"abort",C,o,a);return C}var A="async"in o?o.async:true;C.open(o.type,o.url,A,o.username,o.password);if(o.xhrFields)for(r in o.xhrFields)C[r]=o.xhrFields[r];for(r in m)O.apply(C,m[r]);if(o.timeout>0)N=setTimeout(function(){C.onreadystatechange=x;C.abort();y(null,"timeout",C,o,a)},o.timeout);C.send(o.data?o.data:null);return C};function j(e,n,i,r){if(t.isFunction(n))r=i,i=n,n=undefined;if(!t.isFunction(i))r=i,i=undefined;return{url:e,data:n,success:i,dataType:r}}t.get=function(){return t.ajax(j.apply(null,arguments))};t.post=function(){var e=j.apply(null,arguments);e.type="POST";return t.ajax(e)};t.getJSON=function(){var e=j.apply(null,arguments);e.dataType="json";return t.ajax(e)};t.fn.load=function(e,n,i){if(!this.length)return this;var r=this,a=e.split(/\s/),s,u=j(e,n,i),f=u.success;if(a.length>1)u.url=a[0],s=a[1];u.success=function(e){r.html(s?t("<div>").html(e.replace(o,"")).find(s):e);f&&f.apply(r,arguments)};t.ajax(u);return this};var C=encodeURIComponent;function O(e,n,i,r){var o,a=t.isArray(n),s=t.isPlainObject(n);t.each(n,function(n,u){o=t.type(u);if(r)n=i?r:r+"["+(s||o=="object"||o=="array"?n:"")+"]";if(!r&&a)e.add(u.name,u.value);else if(o=="array"||!i&&o=="object")O(e,u,i,n);else e.add(n,u)})}t.param=function(e,n){var i=[];i.add=function(e,n){if(t.isFunction(n))n=n();if(n==null)n="";this.push(C(e)+"="+C(n))};O(i,e,n);return i.join("&").replace(/%20/g,"+")}})(e);(function(t){t.fn.serializeArray=function(){var e,n,i=[],r=function(t){if(t.forEach)return t.forEach(r);i.push({name:e,value:t})};if(this[0])t.each(this[0].elements,function(i,o){n=o.type,e=o.name;if(e&&o.nodeName.toLowerCase()!="fieldset"&&!o.disabled&&n!="submit"&&n!="reset"&&n!="button"&&n!="file"&&(n!="radio"&&n!="checkbox"||o.checked))r(t(o).val())});return i};t.fn.serialize=function(){var t=[];this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))});return t.join("&")};t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n);if(!n.isDefaultPrevented())this.get(0).submit()}return this}})(e);(function(){try{getComputedStyle(undefined)}catch(t){var e=getComputedStyle;window.getComputedStyle=function(t,n){try{return e(t,n)}catch(i){return null}}}})();(function(t){function e(t,e){var n=this.os={},i=this.browser={},r=t.match(/Web[kK]it[\/]{0,1}([\d.]+)/),o=t.match(/(Android);?[\s\/]+([\d.]+)?/),a=!!t.match(/\(Macintosh\; Intel /),s=t.match(/(iPad).*OS\s([\d_]+)/),u=t.match(/(iPod)(.*OS\s([\d_]+))?/),f=!s&&t.match(/(iPhone\sOS)\s([\d_]+)/),c=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),l=/Win\d{2}|Windows/.test(e),h=t.match(/Windows Phone ([\d.]+)/),p=c&&t.match(/TouchPad/),d=t.match(/Kindle\/([\d.]+)/),m=t.match(/Silk\/([\d._]+)/),v=t.match(/(BlackBerry).*Version\/([\d.]+)/),g=t.match(/(BB10).*Version\/([\d.]+)/),y=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),b=t.match(/PlayBook/),w=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),x=t.match(/Firefox\/([\d.]+)/),E=t.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),T=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),S=!w&&t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),j=S||t.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);if(i.webkit=!!r)i.version=r[1];if(o)n.android=true,n.version=o[2];if(f&&!u)n.ios=n.iphone=true,n.version=f[2].replace(/_/g,".");if(s)n.ios=n.ipad=true,n.version=s[2].replace(/_/g,".");if(u)n.ios=n.ipod=true,n.version=u[3]?u[3].replace(/_/g,"."):null;if(h)n.wp=true,n.version=h[1];if(c)n.webos=true,n.version=c[2];if(p)n.touchpad=true;if(v)n.blackberry=true,n.version=v[2];if(g)n.bb10=true,n.version=g[2];if(y)n.rimtabletos=true,n.version=y[2];if(b)i.playbook=true;if(d)n.kindle=true,n.version=d[1];if(m)i.silk=true,i.version=m[1];if(!m&&n.android&&t.match(/Kindle Fire/))i.silk=true;if(w)i.chrome=true,i.version=w[1];if(x)i.firefox=true,i.version=x[1];if(E)n.firefoxos=true,n.version=E[1];if(T)i.ie=true,i.version=T[1];if(j&&(a||n.ios||l)){i.safari=true;if(!n.ios)i.version=j[1]}if(S)i.webview=true;n.tablet=!!(s||b||o&&!t.match(/Mobile/)||x&&t.match(/Tablet/)||T&&!t.match(/Phone/)&&t.match(/Touch/));n.phone=!!(!n.tablet&&!n.ipod&&(o||f||c||v||g||w&&t.match(/Android/)||w&&t.match(/CriOS\/([\d.]+)/)||x&&t.match(/Mobile/)||T&&t.match(/Touch/)))}e.call(t,navigator.userAgent,navigator.platform);t.__detect=e})(e);(function(t){var e=[],n;t.fn.remove=function(){return this.each(function(){if(this.parentNode){if(this.tagName==="IMG"){e.push(this);this.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";if(n)clearTimeout(n);n=setTimeout(function(){e=[]},6e4)}this.parentNode.removeChild(this)}})}})(e);(function(t){var e={},n=t.fn.data,i=t.camelCase,r=t.expando="Zepto"+ +new Date,o=[];function a(o,a){var u=o[r],f=u&&e[u];if(a===undefined)return f||s(o);else{if(f){if(a in f)return f[a];var c=i(a);if(c in f)return f[c]}return n.call(t(o),a)}}function s(n,o,a){var s=n[r]||(n[r]=++t.uuid),f=e[s]||(e[s]=u(n));if(o!==undefined)f[i(o)]=a;return f}function u(e){var n={};t.each(e.attributes||o,function(e,r){if(r.name.indexOf("data-")==0)n[i(r.name.replace("data-",""))]=t.zepto.deserializeValue(r.value)});return n}t.fn.data=function(e,n){return n===undefined?t.isPlainObject(e)?this.each(function(n,i){t.each(e,function(t,e){s(i,t,e)})}):0 in this?a(this[0],e):undefined:this.each(function(){s(this,e,n)})};t.data=function(e,n,i){return t(e).data(n,i)};t.hasData=function(n){var i=n[r],o=i&&e[i];return o?!t.isEmptyObject(o):false};t.fn.removeData=function(n){if(typeof n=="string")n=n.split(/\s+/);return this.each(function(){var o=this[r],a=o&&e[o];if(a)t.each(n||a,function(t){delete a[n?i(this):t]})})};["remove","empty"].forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=this.find("*");if(e==="remove")t=t.add(this);t.removeData();return n.call(this)}})})(e);(function(t){var e=Array.prototype.slice;function n(e){var i=[["resolve","done",t.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",t.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",t.Callbacks({memory:1})]],r="pending",o={state:function(){return r},always:function(){a.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return n(function(n){t.each(i,function(i,r){var s=t.isFunction(e[i])&&e[i];a[r[1]](function(){var e=s&&s.apply(this,arguments);if(e&&t.isFunction(e.promise)){e.promise().done(n.resolve).fail(n.reject).progress(n.notify)}else{var i=this===o?n.promise():this,a=s?[e]:arguments;n[r[0]+"With"](i,a)}})});e=null}).promise()},promise:function(e){return e!=null?t.extend(e,o):o}},a={};t.each(i,function(t,e){var n=e[2],s=e[3];o[e[1]]=n.add;if(s){n.add(function(){r=s},i[t^1][2].disable,i[2][2].lock)}a[e[0]]=function(){a[e[0]+"With"](this===a?o:this,arguments);return this};a[e[0]+"With"]=n.fireWith});o.promise(a);if(e)e.call(a,a);return a}t.when=function(i){var r=e.call(arguments),o=r.length,a=0,s=o!==1||i&&t.isFunction(i.promise)?o:0,u=s===1?i:n(),f,c,l,h=function(t,n,i){return function(r){n[t]=this;i[t]=arguments.length>1?e.call(arguments):r;if(i===f){u.notifyWith(n,i)}else if(!--s){u.resolveWith(n,i)}}};if(o>1){f=new Array(o);c=new Array(o);l=new Array(o);for(;a<o;++a){if(r[a]&&t.isFunction(r[a].promise)){r[a].promise().done(h(a,l,r)).fail(u.reject).progress(h(a,c,f))}else{
--s}}}if(!s)u.resolveWith(l,r);return u.promise()};t.Deferred=n})(e);(function(t){t.Callbacks=function(e){e=t.extend({},e);var n,i,r,o,a,s,u=[],f=!e.once&&[],c=function(t){n=e.memory&&t;i=true;s=o||0;o=0;a=u.length;r=true;for(;u&&s<a;++s){if(u[s].apply(t[0],t[1])===false&&e.stopOnFalse){n=false;break}}r=false;if(u){if(f)f.length&&c(f.shift());else if(n)u.length=0;else l.disable()}},l={add:function(){if(u){var i=u.length,s=function(n){t.each(n,function(t,n){if(typeof n==="function"){if(!e.unique||!l.has(n))u.push(n)}else if(n&&n.length&&typeof n!=="string")s(n)})};s(arguments);if(r)a=u.length;else if(n){o=i;c(n)}}return this},remove:function(){if(u){t.each(arguments,function(e,n){var i;while((i=t.inArray(n,u,i))>-1){u.splice(i,1);if(r){if(i<=a)--a;if(i<=s)--s}}})}return this},has:function(e){return!!(u&&(e?t.inArray(e,u)>-1:u.length))},empty:function(){a=u.length=0;return this},disable:function(){u=f=n=undefined;return this},disabled:function(){return!u},lock:function(){f=undefined;if(!n)l.disable();return this},locked:function(){return!f},fireWith:function(t,e){if(u&&(!i||f)){e=e||[];e=[t,e.slice?e.slice():e];if(r)f.push(e);else c(e)}return this},fire:function(){return l.fireWith(this,arguments)},fired:function(){return!!i}};return l}})(e);(function(t){var e=t.zepto,n=e.qsa,i=e.matches;function r(e){e=t(e);return!!(e.width()||e.height())&&e.css("display")!=="none"}var o=t.expr[":"]={visible:function(){if(r(this))return this},hidden:function(){if(!r(this))return this},selected:function(){if(this.selected)return this},checked:function(){if(this.checked)return this},parent:function(){return this.parentNode},first:function(t){if(t===0)return this},last:function(t,e){if(t===e.length-1)return this},eq:function(t,e,n){if(t===n)return this},contains:function(e,n,i){if(t(this).text().indexOf(i)>-1)return this},has:function(t,n,i){if(e.qsa(this,i).length)return this}};var a=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),s=/^\s*>/,u="Zepto"+ +new Date;function f(t,e){t=t.replace(/=#\]/g,'="#"]');var n,i,r=a.exec(t);if(r&&r[2]in o){n=o[r[2]],i=r[3];t=r[1];if(i){var s=Number(i);if(isNaN(s))i=i.replace(/^["']|["']$/g,"");else i=s}}return e(t,n,i)}e.qsa=function(i,r){return f(r,function(o,a,f){try{var c;if(!o&&a)o="*";else if(s.test(o))c=t(i).addClass(u),o="."+u+" "+o;var l=n(i,o)}catch(h){console.error("error performing selector: %o",r);throw h}finally{if(c)c.removeClass(u)}return!a?l:e.uniq(t.map(l,function(t,e){return a.call(t,e,l,f)}))})};e.matches=function(t,e){return f(e,function(e,n,r){return(!e||i(t,e))&&(!n||n.call(t,null,r)===t)})}})(e);(function(t){var e={},n,i,r,o,a=750,s;function u(t,e,n,i){return Math.abs(t-e)>=Math.abs(n-i)?t-e>0?"Left":"Right":n-i>0?"Up":"Down"}function f(){o=null;if(e.last){e.el.trigger("longTap");e={}}}function c(){if(o)clearTimeout(o);o=null}function l(){if(n)clearTimeout(n);if(i)clearTimeout(i);if(r)clearTimeout(r);if(o)clearTimeout(o);n=i=r=o=null;e={}}function h(t){return(t.pointerType=="touch"||t.pointerType==t.MSPOINTER_TYPE_TOUCH)&&t.isPrimary}function p(t,e){return t.type=="pointer"+e||t.type.toLowerCase()=="mspointer"+e}t(document).ready(function(){var d,m,v=0,g=0,y,b;if("MSGesture"in window){s=new MSGesture;s.target=document.body}t(document).bind("MSGestureEnd",function(t){var n=t.velocityX>1?"Right":t.velocityX<-1?"Left":t.velocityY>1?"Down":t.velocityY<-1?"Up":null;if(n){e.el.trigger("swipe");e.el.trigger("swipe"+n)}}).on("touchstart MSPointerDown pointerdown",function(i){if((b=p(i,"down"))&&!h(i))return;y=b?i:i.touches[0];if(i.touches&&i.touches.length===1&&e.x2){e.x2=undefined;e.y2=undefined}d=Date.now();m=d-(e.last||d);e.el=t("tagName"in y.target?y.target:y.target.parentNode);n&&clearTimeout(n);e.x1=y.pageX;e.y1=y.pageY;if(m>0&&m<=250)e.isDoubleTap=true;e.last=d;o=setTimeout(f,a);if(s&&b)s.addPointer(i.pointerId)}).on("touchmove MSPointerMove pointermove",function(t){if((b=p(t,"move"))&&!h(t))return;y=b?t:t.touches[0];c();e.x2=y.pageX;e.y2=y.pageY;v+=Math.abs(e.x1-e.x2);g+=Math.abs(e.y1-e.y2)}).on("touchend MSPointerUp pointerup",function(o){if((b=p(o,"up"))&&!h(o))return;c();if(e.x2&&Math.abs(e.x1-e.x2)>30||e.y2&&Math.abs(e.y1-e.y2)>30)r=setTimeout(function(){if(e.el){e.el.trigger("swipe");e.el.trigger("swipe"+u(e.x1,e.x2,e.y1,e.y2))}e={}},0);else if("last"in e)if(v<30&&g<30){i=setTimeout(function(){var i=t.Event("tap");i.pageX=e.x2||e.x1||0;i.pageY=e.y2||e.y1||0;i.cancelTouch=l;if(e.el)e.el.trigger(i);if(e.isDoubleTap){if(e.el)e.el.trigger("doubleTap");e={}}else{n=setTimeout(function(){n=null;if(e.el)e.el.trigger("singleTap");e={}},250)}},0)}else{e={}}v=g=0}).on("touchcancel MSPointerCancel pointercancel",l);t(window).on("scroll",l)});["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(e){t.fn[e]=function(t){return this.on(e,t)}})})(e);(function(t){if(t.os.ios){var e={},n;function i(t){return"tagName"in t?t:t.parentNode}t(document).bind("gesturestart",function(t){var r=Date.now(),o=r-(e.last||r);e.target=i(t.target);n&&clearTimeout(n);e.e1=t.scale;e.last=r}).bind("gesturechange",function(t){e.e2=t.scale}).bind("gestureend",function(n){if(e.e2>0){Math.abs(e.e1-e.e2)!=0&&t(e.target).trigger("pinch")&&t(e.target).trigger("pinch"+(e.e1-e.e2>0?"In":"Out"));e.e1=e.e2=e.last=0}else if("last"in e){e={}}});["pinch","pinchIn","pinchOut"].forEach(function(e){t.fn[e]=function(t){return this.bind(e,t)}})}})(e);(function(t){t.fn.end=function(){return this.prevObject||t()};t.fn.andSelf=function(){return this.add(this.prevObject||t())};"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings".split(",").forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=n.apply(this,arguments);t.prevObject=this;return t}})})(e);(function(t){if(String.prototype.trim===t)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};if(Array.prototype.reduce===t)Array.prototype.reduce=function(e){if(this===void 0||this===null)throw new TypeError;var n=Object(this),i=n.length>>>0,r=0,o;if(typeof e!="function")throw new TypeError;if(i==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)o=arguments[1];else do{if(r in n){o=n[r++];break}if(++r>=i)throw new TypeError}while(true);while(r<i){if(r in n)o=e.call(t,o,n[r],r,n);r++}return o}})();return t.exports=exports=e});;define("url",function(require,exports,module){var _cacheThisModule_;module.exports={setHash:function(e){setTimeout(function(){location.hash=e},0)},getHash:function(e){var t=e||location.hash;return t?t.replace(/.*#/,""):""},getHashModelName:function(){var e=this.getHash();return e?e.split("&")[0].split("=")[0]:[]},getHashActionName:function(){var e=this.getHash();return e==""?"":(e?e.split("&"):[])[0].split("=")[1]},getHashParam:function(e){var t=this.getHash().match(new RegExp("(^|&)"+e+"=([^&]*)(&|$)"));return t!=null?t[2]:""},getUrlParam:function(e,t){var n=arguments[1]||window.location.search,r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=n.substr(n.indexOf("?")+1).match(r);return i!=null?i[2]:""},getParams:function(){var e=[],t=this.getHash();paramArr=t?t.split("&"):[];for(var n=1,r=paramArr.length;n<r;n++)e.push(paramArr[n]);return e},decodeUrl:function(e){e=decodeURIComponent(e);var t=this.parseUrl(e),n=[];$.each(t.params,function(e,t){t=decodeURIComponent(t),n.push(e+"="+t)});var r=e.split("?")[0];return r+"?"+n.join("&")},parseUrl:function(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){var e={},n=t.search.replace(/^\?/,"").split("&"),r=n.length,i=0,s;for(;i<r;i++){if(!n[i])continue;s=n[i].split("="),e[s[0]]=s[1]}return e}(),file:(t.pathname.match(/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}},replaceParam:function(e,t,n,r){n=n||location.href;var i=new RegExp("([\\?&]"+e+"=)[^&#]*");return n.match(i)?r?n.replace(i,"$1"+t):n:n.indexOf("?")==-1?n+"?"+e+"="+t:n+"&"+e+"="+t}}});;;define("loopScroll",function(require,exports,t){var _cacheThisModule_;var i=require("zepto");var e=function(t){this.opt={tp:"text",moveDom:null,moveChild:[],tab:[],viewDom:null,touchDom2:[],sp:{x:0,y:0},min:0,minp:0,step:0,len:1,index:1,offset:0,loadImg:false,image:[],loopScroll:false,lockScrY:false,stopOnce:false,autoTime:0,holdAuto:false,tabClass:"cur",transition:.3,imgInit:true,imgInitLazy:4e3,enableTransX:false,transXVal:100,useVue:false,ignoreAppend:false,fun:function(){}};i.extend(this,this.opt,t);this.len=this.moveChild.length;this.min=this.min||{text:100,img:1}[this.tp];this.minp=this.minp||Math.max(this.min,30);if(!this.viewDom)this.viewDom=i(window);if(this.len>1)this.startEvent();if(this.loadImg)this.image=this.moveDom.find("img");this.resize(this.step||this.moveChild.eq(0).width());if(this.autoTime){var e=this;setInterval(function(){if(!e.holdAuto){if(!e.stopOnce)e.stepMove(e.index+1);e.stopOnce=false}},this.autoTime)}};i.extend(e.prototype,{resize:function(t){this.step=t||this.step;var i=(this.viewDom.width()-this.step)/2;this.offset=this.loopScroll?this.step-i:i;if(this.len==1)this.offset=-i;this.stepMove(this.index,true)},addChild:function(t,i){if(!this.loopScroll)return;this.moveChild.eq(0).after(t);this.len+=1;this.tab.eq(this.len-2).after(i);this.tab=this.tab.parent().children();if(this.len==2){this.moveChild=this.moveDom.children();this.startEvent()}else{this.stepMove(2)}},startEvent:function(){var t=this,e=this.moveDom.get(0),s=function(i){i.addEventListener("touchstart",t,false);i.addEventListener("touchmove",t,false);i.addEventListener("touchend",t,false);i.addEventListener("touchcancel",t,false);i.addEventListener("webkitTransitionEnd",t,false)};s(e);this.tab.each(function(e,s){i(s).attr("no",e+1);i(s).click(function(){t.stepMove(i(this).attr("no"))})});if(this.loopScroll){var n=this.moveChild.eq(0).clone().attr({id:"",onload:""});n.find("img").attr({id:"",onload:""});!this.ignoreAppend&&this.moveDom.append(n);var o=this.moveChild.eq(this.len-1).clone().attr({id:"",onload:""});o.find("img").attr({id:"",onload:""});!this.ignoreAppend&&this.moveDom.prepend(o)}for(var h=0;h<this.touchDom2.length;h++){s(this.touchDom2[h])}},handleEvent:function(t){switch(t.type){case"touchstart":this.sp=this.getPosition(t);this.holdAuto=true;this.stopOnce=true;break;case"touchmove":this.touchmove(t);break;case"touchend":case"touchcancel":this.move(t);this.holdAuto=false;break;case"webkitTransitionEnd":t.preventDefault();break}},getPosition:function(t){var i=t.changedTouches?t.changedTouches[0]:t;return{x:i.pageX,y:i.pageY}},touchmove:function(t){var i=this.getPosition(t),e=i.x-this.sp.x,s=i.y-this.sp.y;if(Math.abs(e)-Math.abs(s)>this.min){t.preventDefault();var n=e-this.step*(this.index-1)-this.offset;!this.useVue&&this.moveDom.css({"-webkit-backface-visibility":"hidden","-webkit-transform":this.enableTransX?"translateX("+(this.loopScroll?this.index:this.index-1)*-this.transXVal+"%)":"translate3D("+n+"px,0,0)","-webkit-transition":"0"})}else{if(!this.lockScrY)t.preventDefault()}},move:function(t){var i=this.getPosition(t),e=i.x-this.sp.x,s=i.y-this.sp.y;if(Math.abs(e)<Math.abs(s)||Math.abs(e)<this.minp){this.stepMove(this.index);return}if(e>0){t.preventDefault();this.stepMove(this.index-1)}else{t.preventDefault();this.stepMove(this.index+1)}},loadImage:function(t){var e=this.image;var s=function(t){if(e[t]&&i(e[t]).attr("back_src")){e[t].src=i(e[t]).attr("back_src");i(e[t]).removeAttr("back_src")}};s(t);(function(t,i,e){setTimeout(function(){s(t-1);s(t+1)},i?e:0)})(t,this.imgInit,this.imgInitLazy);this.imgInit=false},stepMove:function(t,i){this.index=t>this.len?this.len:t<1?1:t;this.tab.removeClass(this.tabClass);this.tab.eq(this.index-1).addClass(this.tabClass);var e=-this.step*((this.loopScroll?t:this.index)-1)-this.offset;!this.useVue&&this.moveDom.css({"-webkit-transform":this.enableTransX?"translateX("+(this.loopScroll?t:this.index-1)*-this.transXVal+"%)":"translate3D("+e+"px,0,0)","-webkit-transition":i?"0ms":"all "+this.transition+"s ease"});if(this.loadImg)this.loadImage(this.index);this.fun(this.index);if(this.loopScroll&&!i){var s=this,n=t;if(t<=0)n=this.len;if(t>this.len)n=1;if(n!=t)setTimeout(function(){s.stepMove(n,true)},this.transition*1e3)}},_isOutScreen:function(t){return t.offset().top>=i(window).height()+window.scrollY||t.offset().top+t.height()<window.scrollY},_isElementHidden:function(t){var i=t.parents().concat();i.unshift(t[0]);return i.some(function(t){if(getComputedStyle(t,"").getPropertyValue("display")=="none"){return true}})}});exports.init=function(t){return new e(t)}});;define("cookie",function(require,exports,module){var _cacheThisModule_;exports.get=getCookie;exports.set=setCookie;exports.del=delCookie;function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);if(!val||!val[2]){return"";}
var res=val[2];try{if(/(%[0-9A-F]{2}){2,}/.test(res)){return decodeURIComponent(res);}else{return unescape(res);}}catch(e){return unescape(res);}}
function setCookie(name,value,expires,path,domain,secure){var exp=new Date(),expires=arguments[2]||null,path=arguments[3]||"/",domain=arguments[4]||null,secure=arguments[5]||false;expires?exp.setMinutes(exp.getMinutes()+parseInt(expires)):"";document.cookie=name+'='+escape(value)+(expires?';expires='+exp.toGMTString():'')+(path?';path='+path:'')+(domain?';domain='+domain:'')+(secure?';secure':'');}
function delCookie(name,path,domain,secure){var value=getCookie(name);if(value!=null){var exp=new Date();exp.setMinutes(exp.getMinutes()-1000);path=path||"/";document.cookie=name+'=;expires='+exp.toGMTString()+(path?';path='+path:'')+(domain?';domain='+domain:'')+(secure?';secure':'');}}});
;define('loadJs',function(require,exports,module){var _cacheThisModule_;var ck=require('cookie');var callbackNameCount={},letterMap=['Z','A','B','C','D','E','F','G','H','I'];function transToLetter(num){var arr=(num+'').split(''),v=[];for(var i=0;i<arr.length;i++){v.push(letterMap[arr[i]])}
return v.join('');}
function callbackNameUnique(str){if(!callbackNameCount[str]){callbackNameCount[str]=1;}else{callbackNameCount[str]+=1;}
return str+transToLetter(callbackNameCount[str]);}
function ignoreUrl(url){return url.indexOf('wq.360buyimg.com')>-1||url.indexOf('wqs.jd.com')>-1||url.indexOf("wqcoss.jd.com/mcoss/")>-1||url.indexOf("btshow.jd.com/queryBtPlanInfo.do")>-1||url.indexOf('storage.360buyimg.com')>-1;}
function sendJs(url,opt){var option={onLoad:null,onError:null,onTimeout:null,timeout:8000,isToken:true,keepProtocol:false,charset:"utf-8",setReportUrl:""};var code=0;var timer;var clear=function(){if(!el){return;}
timer&&clearTimeout(timer);el.onload=el.onreadystatechange=el.onerror=null;el.parentNode&&(el.parentNode.removeChild(el));el=null;}
if(arguments.length==1){if(typeof arguments[0]=="object"){opt=arguments[0];url=opt.url;}else{opt={};}}
if(typeof(opt.data)=='object'){var param=[];for(var k in opt.data){param.push(k+'='+opt.data[k])}
if(param.length>0){param=param.join('&');url+=(url.indexOf('?')>0?'&':'?')+param;}}
if(window.traceid){var lh=url.split('#');url+=(lh[0].indexOf('?')>0?'&':'?')+'traceid='+window.traceid+(lh[1]?'#'+lh[1]:'');}
for(var i in opt){if(opt.hasOwnProperty(i)){option[i]=opt[i];}}
var el=document.createElement("script");el.charset=option.charset||"utf-8";var needCheck=false;var cgiLoadOK=false;var reportUrl="";if(opt.setReportUrl&&typeof opt.setReportUrl=="function"){reportUrl=opt.setReportUrl();!reportUrl&&(reportUrl=url);}else{reportUrl=window.CGI302ReportKeepUrl?url:url.replace(/\?.*/,'');}
el.onload=el.onreadystatechange=function(){if(/loaded|complete/i.test(this.readyState)||navigator.userAgent.toLowerCase().indexOf("msie")==-1){option.onLoad&&option.onLoad();if(needCheck&&!cgiLoadOK){if(window.JD){JD.report.umpBiz({bizid:24,operation:3,result:"1",source:0,message:reportUrl});}
option.onError&&option.onError();window.onerror('','','','',{stack:'servererror:'+reportUrl});console.log('loadJs Failed:'+url);}
clear();}};el.onerror=function(){window.__reloadResource&&__reloadResource(el);option.onError&&option.onError();clear();};var targetUrl=option.isToken?addToken(url,"ls"):url;if(!ignoreUrl(targetUrl)){var originFunctionName;var newFunctionName;var originFunction;var newUrl=targetUrl.replace(/callback=([^&]+)/,function(a,b){originFunctionName=b;newFunctionName=callbackNameUnique(originFunctionName);return'callback='+newFunctionName;});if(originFunctionName&&window[originFunctionName]){needCheck=true;targetUrl=newUrl;originFunction=window[originFunctionName];window[newFunctionName]=function(d){cgiLoadOK=true;originFunction(d,code);};}}
if(window.JD){targetUrl=JD.url.getCgiUrl(targetUrl);}
el.src=option.keepProtocol?targetUrl:targetUrl.replace(/^http(s?):/,"");!opt.cancleLog&&console.log('loadJs request:'+el.src);document.getElementsByTagName('head')[0].appendChild(el);if(typeof option.onTimeout=="function"){timer=setTimeout(function(){code=1;option.onTimeout();},option.timeout);}};function addToken(url,type){if(url==""||(url.indexOf("://")<0?location.href:url).indexOf("http")!=0){return url;}
var wq_token=getToken("wq_skey");var pt_token=getToken("pt_key");var parts=url.split("#");var parts2=parts[0].split("?");var path=parts2[0];var param=(parts2.length==2?parts2[1]:"").split("&");var hash=parts.length==2?parts[1]:"";var hasSceneval=false;param=param.filter(function(m){if(m.match(/^sceneval=/))hasSceneval=true
return!(/g_tk=\d+/.test(m)||/g_pt_tk=\d+/.test(m)||/g_ty=\w+/.test(m));});wq_token&&param.push("g_tk="+wq_token);pt_token&&param.push("g_pt_tk="+pt_token);(wq_token||pt_token)&&param.push("g_ty="+type);if(!hasSceneval&&window.location&&location.href.match(/(\?|&)sceneval=2/)){param.push("sceneval=2");}
var paramStr=param.join("&");return path+(paramStr?("?"+paramStr):"")+(hash?("#"+hash):"");};function getToken(key){key=key||"wq_skey";var skey=ck.get(key);return skey?time33(skey):"";};function time33(str){for(var i=0,len=str.length,hash=5381;i<len;++i){hash+=(hash<<5)+str.charAt(i).charCodeAt();}
return hash&0x7fffffff;}
exports.loadScript=function(url,opt){var args=[].slice.call(arguments);setTimeout(function(){sendJs.apply(null,args);},0);};exports.addToken=addToken;});
;define('util',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),ls=require('loadJs');function checkInScreen(dom,offset,type){var pageHeight=document.documentElement.clientHeight,pageTop=$(document.body).scrollTop(),pageBottom=pageHeight+pageTop,dis=offset||0,size=dom.offset(),itemTop=size.top-dis,itemBottom=itemTop+size.height,checkType=type||'';if(checkType==='up'){if(itemBottom<pageTop){return true;}}else if(checkType==='down'){if(itemTop>pageBottom){return true;}}else if(checkType==='partup'){if(itemTop<pageTop){return true;}}else if(checkType==='partdown'){if(itemBottom>pageBottom){return true;}}else{if((itemTop<pageBottom&&itemTop>pageTop)||(itemBottom<pageBottom&&itemBottom>pageTop)){return true;}else if(itemTop<pageTop&&itemBottom>pageBottom){return true;}}
return false;}
function delay(f,t){var now=Date.now,last=0,ctx,args,exec=function(){last=now();f.apply(ctx,args)};return function(){cur=now();ctx=this,args=arguments;if(cur-last>t){exec();}}}
function delegateMove(){var sy,direction,delegateFunc=[];this.listen=function(func){if(typeof func==='function'){delegateFunc.push(func);}};this.remove=function(func){if(typeof func!=='function')return;for(var i=0,l=delegateFunc.length;i<l;i++){if(func===delegateFunc[i]){delegateFunc.splice(i,1);}}};document.addEventListener('touchstart',function(e){var touches=e.touches[0];sy=touches.clientY;});document.addEventListener('touchmove',function(e){var touches=e.changedTouches[0],endTy=touches.clientY;if(endTy-sy>0){direction='up';}else if(sy-endTy>0){direction='down';}});document.addEventListener('touchend',delay(function(){fireFunc(direction);},80));document.addEventListener('scroll',delay(function(){fireFunc(direction);},80));function fireFunc(d){for(var i=0,l=delegateFunc.length;i<l;i++){delegateFunc[i].apply(null,[d]);}}}
function isDate(d){try{var d=new Date(d);d=null;return true;}catch(e){return false;}}
function format(s){var re=/{\d+}/g,args=Array.prototype.slice.call(arguments,1),r=s.toString();return r.replace(re,function(v){var vi=v.substr(1,v.length-2);return typeof args[vi]==='undefined'?v:args[vi];});}
function itilReport(option){var opt={bid:"1",mid:"01",res:[],onBeforeReport:null,delay:5000}
for(var k in option){opt[k]=option[k];}
if(opt.res.length>0){window.reportWebInfo=function(json){};window.setTimeout(function(){opt.onBeforeReport&&opt.onBeforeReport(opt);var pstr=opt.bid+opt.mid+"-"+opt.res.join("|");var url="http://bases.wanggou.com/mcoss/webreport/ReportWebInfo?report="+pstr+"&t="+new Date()/1000;ls.loadScript({url:url});},opt.delay);}}
function getQuery(name,url){var u=arguments[1]||window.location.search,reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=u.substr(u.indexOf("\?")+1).match(reg);return r!=null?r[2]:"";}
function setQuery(json,url){var hash=url?url.match(/#.*/)&&url.match(/#.*/)[0]||"":location.hash,search=url?url.replace(/#.*/,"").match(/\?.*/)&&url.replace(/#.*/,"").match(/\?.*/)[0]||"":location.search,path=url?url.replace(/#.*/,"").replace(/\?.*/,""):location.protocol+"//"+location.host+location.pathname;for(var i in json){var query=i+"="+json[i],oldValue=getQuery(i,search);if(oldValue){search=search.replace(i+"="+oldValue,i+"="+json[i]);}else{search=(search.length>0)?search+"&"+query:"?"+query;}}
return path+search+hash;}
function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]).replace(/(^")|("$)/g,""):""):null;}
function setCookie(name,value,expires,path,domain,secure){var exp=new Date(),expires=arguments[2]||null,path=arguments[3]||"/",domain=arguments[4]||null,secure=arguments[5]||false;expires?exp.setMinutes(exp.getMinutes()+parseInt(expires)):"";document.cookie=name+'='+escape(value)+(expires?';expires='+exp.toGMTString():'')+(path?';path='+path:'')+(domain?';domain='+domain:'')+(secure?';secure':'');}
function getHash(name){var u=arguments[1]||location.hash;var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");var r=u.substr(u.indexOf("#")+1).match(reg);if(r!=null){return r[2];}
return"";}
function htmlDecode(str){return typeof(str)!="string"?"":str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&amp;/g,"&");}
function htmlEncode(str){return typeof(str)!="string"?"":str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&apos;").replace(/ /g,"&nbsp;");}
function strSubGB(str,start,len,flag){var total=strLenGB(str);if(total>(len-start)){var flag=flag||"";var strTemp=str.replace(/[\u00FF-\uFFFF]/g,"@-").substr(start,len);var subLen=strTemp.match(/@-/g)?strTemp.match(/@-/g).length:0;return str.substring(0,len-subLen)+flag;}
return str;}
function strLenGB(v){return v.replace(/[\u00FF-\uFFFF]/g,"  ").length;}
function canWxPay(){var ua=navigator.userAgent.toLowerCase();return ua.match(/micromessenger/)?true:false;}
function removeStorage(key){window.localStorage.removeItem(key);}
function saveStorage(key,value,isJson){try{window.localStorage.setItem(key,isJson?JSON.stringify(value):value);}catch(e){console.error(e);}}
function getStorage(key){return window.localStorage.getItem(key);}
function isSupportStorage(){if(!window.localStorage){return false;}
try{window.localStorage.setItem("test",true);window.localStorage.removeItem("test");return true;}catch(e){return false;}}
function isSQ(){var cid=getCookie('cid');if(cid==2)return true;if(/qq\/([\d\.]+)*/i.test(navigator.userAgent)){return true;}
return false;}
function isWX(){var cid=getCookie('cid');if(cid==1)return true;if(/MicroMessenger/i.test(navigator.userAgent)){return true;}
return false;}
function preventPageScroll(node){node[0].ontouchstart=handleStart;function handleStart(e){node[0].ontouchmove=handleMove;}
function handleMove(evt){evt.preventDefault();node[0].ontouchend=handleEnd;}
function handleEnd(){node[0].ontouchend=null;node[0].ontouchmove=null;}}
function loginLocation(url){if(getCookie('wg_uin')&&getCookie('wg_skey')){location.href=url;}
else{login(url);}}
function login(reUrl){reUrl=reUrl||location.href;if(isWX()){window.location.href='http://party.wanggou.com/tws64/m/wxv2/Login?appid=1&rurl='+encodeURIComponent(reUrl);}else{window.location.href='http://party.wanggou.com/tws64/m/h5v1/cpLogin?rurl='+encodeURIComponent(reUrl)+'&sid='+getCookie('sid')+'&uk='+getCookie('uk');}}
function addRd(url,rd){url=url.replace(//g,"?");var reg=/ptag[=,]\d+\.\d+\.\d+/i,hasQuery=/\?/.test(url);hasAnchor=url.indexOf('#')>-1;if(reg.test(url)){url=url.replace(reg,"PTAG="+rd);}else{url=hasAnchor?url.replace("#",(hasQuery?"&":"?")+"PTAG="+rd+"#"):(url+(hasQuery?"&":"?")+"PTAG="+rd);}
return url;}
function arrayUniq(arr){var returnArr=[];for(var i=0,len=arr.length;i<len;i++){((","+returnArr+",").indexOf(","+arr[i]+",")<0)?returnArr.push(arr[i]):'';};return returnArr;}
function once(fn){var run=false;return function(){!run&&(run=!run,typeof fn==='function'&&fn.call());}}
function getMyLocation(callback){var cookiecoores,res,errorRes={};function mysave(coords){if(coords&&coords.longitude){var val=JSON.stringify(coords);JD.cookie.set('coords',val,60,'/','jd.com');}}
function myget(){var coords;coords=JD.cookie.get('coords');try{if(coords){coords=JSON.parse(coords);}}catch(e){coords=false;console.log(e);}
if(!coords||!coords.longitude||!coords.latitude){coords=false;JD.cookie.del('coords','/','jd.com');}
return coords;}
function isMQQUserAgent(){if(/qq\/([\d\.]+)*/.test(navigator.userAgent.toLowerCase())){return true;}
return false;}
function isWxUserAgent(){if(navigator.userAgent.indexOf('MicroMessenger')>0){return true;}
return false;}
cookiecoores=myget();if(cookiecoores){callback&&callback(cookiecoores);}else{if(isWxUserAgent()&&JD.wxapi){JD.wxapi.ready(function(config){config.beta=true;wx.getLocation({type:'gcj02',success:function(position){res={'latitude':position.latitude,'longitude':position.longitude};mysave(res);callback&&callback(res);},fail:function(){callback&&callback(errorRes);},cancel:function(){callback&&callback(errorRes);}});});}else if(isMQQUserAgent()&&window.mqq){mqq.sensor.getLocation(function(retCode,latitude,longitude){if(retCode===0){res={'latitude':latitude,'longitude':longitude};mysave(res);callback&&callback(res);}else{callback&&callback(errorRes);}});}else if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){res={'latitude':position.coords.latitude,'longitude':position.coords.longitude};mysave(res);callback&&callback(res);},function(error){callback&&callback(errorRes);});}else{callback&&callback(errorRes);}}}
return{checkInScreen:checkInScreen,delay:delay,delegateMove:delegateMove,isDate:isDate,format:format,itilReport:itilReport,getQuery:getQuery,setQuery:setQuery,getCookie:getCookie,setCookie:setCookie,getHash:getHash,htmlDecode:htmlDecode,htmlEncode:htmlEncode,strSubGB:strSubGB,strLenGB:strLenGB,canWxPay:canWxPay,isSupportStorage:isSupportStorage,isSQ:isSQ,isWX:isWX,saveStorage:saveStorage,getStorage:getStorage,removeStorage:removeStorage,preventPageScroll:preventPageScroll,loginLocation:loginLocation,login:login,addRd:addRd,arrayUniq:arrayUniq,once:once,getMyLocation:getMyLocation};});
;define('login',function(require,exports,module){var _cacheThisModule_;exports.isLogin=isLogin;exports.validateLogin=function(callback){if(!isLogin()){callback(false);return true;}
validateLogin(callback);};exports.login=login;var _LoadingStartTime=new Date();function isLogin(){var env=getEnv();if(env=="jdm"||env=="jdapp"||env=="jdpingou"||env=="kplxcx"||env=="meitu"){return true;}
return getWqUin()&&getWqSkey();}
function validateLogin(callback){window.validateLoginCallback=function(data){callback(data.iRet!=9999)};var sceneval=(["jdm",'jdapp','kplxcx','meitu','jdpingou'].indexOf(getEnv())>=0?"&sceneval=2":"");JD.sendJs("//wq.jd.com/mlogin/wxv3/LoginCheckJsonp?callback=validateLoginCallback&_t="+Math.random()+sceneval);}
function login(opt){var option={env:getEnv(),scope:false,rurl:window.location.href};for(var i in opt){option[i]=opt[i];}
if(!/^\/\/|^http(?:s?):\/\//.test(option.rurl)){option.rurl=window.location.href;}
option.rurl=option.rurl.replace(/^http(?:s?):\/\//,"//");option.rurl=window.location.protocol+option.rurl;if(option.env=="jdm"){var url="//passport.m.jd.com/user/login.action?returnurl="+encodeURIComponent(option.rurl);justLogin(url);}
else if(option.env=="wxwork"){var corpid=getCookie("wq_bjd_corpid")||"";var rurl="//wqs.jd.com/bjd/tologin.html?corpid="+corpid+"&rurl="+encodeURIComponent(option.rurl);justLogin(rurl);}
else if(option.env=="weixin"){var rurl="//wq.jd.com/mlogin/wxv3/login_BJ?rurl="+encodeURIComponent(option.rurl)+"&appid=1"+(option.scope?"&scope=snsapi_userinfo":"");justLogin(rurl);}
else if(option.env=="jdapp"||option.env=="jdpingou"){if(new Date()-_LoadingStartTime<=3000&&option.env=="jdpingou"){window.pingouWebviewNotification=function(res){res=typeof res=="string"?JSON.parse(res):res;setTimeout(function(){if(res&&res.fromNative=="login"&&(res.state=="-1"||res.state=="-2")){history.go(-1);setTimeout(function(){JSSDK&&JSSDK.WebView&&JSSDK.WebView.closeActiveWebview&&JSSDK.WebView.closeActiveWebview();},300);}},0);}}
var rurl="//wq.jd.com/mlogin/mpage/Login?rurl="+encodeURIComponent(option.rurl);window.location.href=rurl;}
else if(option.env=="qq"){var rurl="//wq.jd.com/mlogin/h5v1/cpLogin_BJ?rurl="+encodeURIComponent(option.rurl);justLogin(rurl);}else if(option.env=="qbxcx"){qbxcxLogin(option);}else if(option.env=="kplxcx"){JD&&JD.wxapp&&JD.wxapp.isWxapp&&JD.wxapp.isWxapp(function(iswxapp){if(iswxapp){var usehash="#cookie="+encodeURIComponent('{"appkey":"'+getCookie("appkey")+'","source":"'+getCookie("source")+'","customerinfo":"'+getCookie("customerinfo")+'","wxapp_type":"3"}');if(getUrlParam("loginPlugin")==1){var _pageName=getUrlParam("pageName");var _retpages="";if(_pageName=="jshopH5"){_retpages="/pages/jshopH5/jshopH5";}else{_retpages="/pages/activityH5/activityH5";}
var rurl=_retpages+'?encode_url='+encodeURIComponent(/#/.test(location.href)?location.href.replace(/#?[^#]*$/,usehash):(location.href+usehash))+"&kActUrl="+encodeURIComponent(/#/.test(location.href)?location.href.replace(/#?[^#]*$/,usehash):(location.href+usehash));JD.wxapp.goto('/pages/login/index/index?'+(getUrlParam("isSwitchTab")==1?'pageType=switchTab&':'')+'returnPage='+encodeURIComponent(rurl));}else{var rurl='/pages/activityH5/activityH5?encode_url='+encodeURIComponent(/#/.test(location.href)?location.href.replace(/#?[^#]*$/,usehash):(location.href+usehash));JD.wxapp.goto('/pages/login/login?returnpage='+encodeURIComponent(rurl));}}else{var rurl="//wq.jd.com/mlogin/wxv3/login_BJ?rurl="+encodeURIComponent(option.rurl)+"&appid=1"+(option.scope?"&scope=snsapi_userinfo":"");justLogin(rurl);}});}
else if(option.env=='meitu'){rurl="//plogin.m.jd.com/user/login.action?appid=856&oauthlogin=MEITU&returnurl="+encodeURIComponent(option.rurl);justLogin(rurl);}
else{var rurl="//wq.jd.com/mlogin/mpage/Login?rurl="+encodeURIComponent(option.rurl);justLogin(rurl);}}
function justLogin(rurl){if(window.__isLoginJumping)return;window.__isLoginJumping=1;window.location.href=rurl;setTimeout(function(){window.__isLoginJumping=0;JD.report.umpBiz({bizid:47,operation:46,result:1,source:0,message:JD.device.scene});if(window.__loginRetryDisable)return;window.location.href=rurl;},5000);}
function getWqUin(){return getCookie("wq_uin");}
function getWqSkey(){return getCookie("wq_skey");}
function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]):""):null;}
function reportUMP(biz,op,result,msg){JD.report.umpBiz({bizid:biz,operation:op,result:result,source:'0',message:msg||""});}
function qbxcxLogin(opt){var t=setTimeout(function(){reportUMP(649,5,100);},4000);if(!window.QBJSBridge){document.addEventListener("QBJSBridgeReady",qbReady,false)}else{qbReady()}
function qbReady(count){count=count||0;if(count>1)return true;count++;if(window.__isQB){window.qbbridge.login({appkey:'jd',type:"3",success:function(data){var ticket=data.ticket;if(ticket){reportUMP(649,5,0);clearTimeout(t);var flag="&";if(opt.rurl.indexOf("?")<0){flag="?";}
opt.rurl+=flag+"t="+Date.now();justLogin('https://wq.jd.com/mlogin/wxv3/LoginQBApp_H5?ticket='+encodeURI(ticket)+'&rurl='+encodeURIComponent(opt.rurl))
return true;}
reportUMP(649,5,101);clearTimeout(t);qbReady(count);},fail:function(err){reportUMP(649,5,err.code);clearTimeout(t);qbReady(count);}})
return true;}
reportUMP(649,5,102);clearTimeout(t);qbReady(count);}}
function getUrlParam(name){var u=arguments[1]||window.location.search,reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)",'i'),r=u.substr(u.indexOf("\?")+1).match(reg);return r!=null?r[2]:"";}
function getEnv(){var ua=navigator.userAgent.toLowerCase();if(/com\.meitu\.myxj/.test(ua)){return'meitu';}else if(JD.wxapp&&JD.wxapp.wxappType==3){return"kplxcx";}else if(JD.wxapp&&JD.wxapp.wxappType==5){return"qbxcx";}else if(/jdpingou/.test(ua)){return"jdpingou";}else if(/jdapp;/.test(ua)){return"jdapp";}else if(/(\.|^)m\.jd\.com/.test(window.location.hostname)||/[?&]sceneval=2/.test(window.location.search)){return"jdm";}else if(/micromessenger(\/[\d\.]+)*/.test(ua)&&/wxwork/.test(ua)){return"wxwork";}else if(/micromessenger(\/[\d\.]+)*/.test(ua)){return"weixin";}else if(/qq\/(\/[\d\.]+)*/.test(ua)||/qzone\//.test(ua)){return"qq";}else{return"h5";}}});
;define('wq.address',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),ls=require('loadJs'),util=require('util'),login=require('login'),storage_version='jd_areamap_201711',isLogin,commonAddrHtml=[],usualAddrList=[],areaCgiHold=false,gpsHtml='',area=[''],areaId=['0'],addrId='',gpsChoice=false,uname='',uphone='',addrName='',addrIdArr=[],addrNameArr=[],longitude='',latitude='',isDefaultAddr=false,isHasDefaultAddr=false,curAddr={},domainStr='jd.com',isMQQBrowser=/MQQBrowser/i.test(navigator.userAgent),isJdPgApp=JD&&JD.device&&JD.device.scene=='jdpingou',level=0,cache={},addrToken='',isMCart=false,selectedAddr={},lastSelectFlag=0,opt={con:'',title:'',deep:4,commonType:'1',clickEvent:'click',onClose:function(){},onlySaveCommon:false,isNeedCss:true,isNeedCommon:true,isNeedFixed:false,overClass:'overflowHide',isSearch:false,isShowHW:true,isShowTW:true,isShowGA:true};module.exports={init:init,show:show,reset:reset,getAddrInfo:getAddrInfo,setAddrCookies:setAddrCookies,clearCookies:clearCookies};function init(option){isMCart=/(^|[&|?])sceneval=2([&|#]|$)/.test(location.search)||/(\.|^)m\.jd\.com/.test(document.domain)||(option.sceneval&&option.sceneval==2);$.extend(opt,option);isLogin=login.isLogin();opt.commonType='1';if(!isLogin){opt.isNeedCommon=false;}
try{domainStr=(document.domain||'wq.jd.com').split('.').slice(-2).join('.');}catch(e){domainStr='jd.com';}
loadCss();setBasicDom();bindEvent();if(opt.commonType==1)$('#addrGps').hide();}
function show(lev){level=lev||0;showHidePopup(true);curAddr=getAddrInfo();if(opt.isNeedCommon){getCommonAddrV1();}else if(opt.commonType=='2'){getCommonAddrV1();getAreaList();}else{getAreaList();}}
function reset(option){commonAddrHtml=[];isLogin=login.isLogin();usualAddrList=[];areaCgiHold=false;if(option){$.extend(opt,option);}}
function bindEvent(){$('#addrBody').off().on(opt.clickEvent,'[filter-type]',function(e){var tar=$(this),ftype=tar.attr('filter-type'),isTab=(tar.attr('tag')=='1'),selectClass=(opt.isSearch?'selected':'on');if(isTab){tar.addClass('cur').siblings().removeClass('cur');}
if(ftype==='area'){if(areaCgiHold){areaCgiHold=false;level--;}
var tid=tar.attr('tid'),tname=tar.attr('tname'),extid=tar.attr('extid');if(extid){level=parseInt(extid,10)+1;}else{level++;}
if(!isTab){tar.addClass(selectClass).siblings().removeClass(selectClass);area[level]=tname;areaId[level]=tid;clearArea(level+1);}
if(level<opt.deep&&level<4){getAreaList(isTab);}
if(level>=opt.deep||level>=4){$('#ulAddrTab li.cur').hide();finish();}}else if(ftype==='common'){var $target=$(e.target);if($target.hasClass('mod_address_slide_list_1_warn')||$target.hasClass('mod_address_slide_list_1_edit')){var tempAddrId=tar.attr('addrid');showHidePopup();if(tempAddrId){opt.beforeEdit&&opt.beforeEdit();location.href='//wqs.jd.com/my/my_address.shtml?ptag=7387.1.4&token='+addrToken+(isMCart?'&sceneval=2':'')+'&backurl='+encodeURIComponent(location.href)+'#type=edit&adid='+tempAddrId;}}else if(tar.attr('addrid')&&tar.attr('addrname')&&!tar.hasClass('disabled')){tar.addClass(selectClass).siblings().removeClass(selectClass);addrId=tar.attr('addrid');addrName=tar.attr('addrname');addrIdArr=(tar.attr('ids')||'').split('_');addrNameArr=(tar.attr('names')||'').split('_');longitude=(tar.attr('longitude')||'');latitude=(tar.attr('latitude')||'');isDefaultAddr=(tar.attr('isdefaultaddr')||'');uname=decodeURIComponent(tar.attr('uname')||'');uphone=tar.attr('uphone')||'';finish({uname:uname,uphone:uphone});}}else if(ftype==='addaddr'){showHidePopup();opt.beforeEdit&&opt.beforeEdit();location.href='//wqs.jd.com/my/my_address.shtml?ptag=7387.1.5'+(isMCart?'&sceneval=2':'')+'&backurl='+encodeURIComponent(location.href)+'#type=edit&adid=0';}else if(ftype==='areaaddr'){getAreaList();}else{finish();}});$('#addrGps').off().on(opt.clickEvent,'dl',function(e){var tar=$(this);tar.toggleClass('on');if(tar.hasClass('on')){addrId='';gpsChoice=true;addrIdArr=(tar.attr('ids')||'').split('_');addrNameArr=(tar.attr('names')||'').split('_');finish();}});if(opt.isSearch){$('#searchFoot').off().on(opt.clickEvent,function(e){getAreaList();});$('#searchPrev').off().on(opt.clickEvent,function(e){var tar=$(this),tag=tar.attr('tag');if(tag=='2'){if(opt.isNeedCommon){getCommonAddrV1();}else{showHidePopup();opt.onClose&&opt.onClose();}}else{showHidePopup();opt.onClose&&opt.onClose();}});}else{$('#addrBtn').off().on(opt.clickEvent,function(e){var tar=$(this),tag=tar.attr('tag');if(tag==='1'){getAreaList();}else if(tag==='3'){showHidePopup();opt.beforeEdit&&opt.beforeEdit();location.href='//wqs.jd.com/my/my_address.shtml?ptag=7387.1.5'+(isMCart?'&sceneval=2':'')+'&backurl='+encodeURIComponent(location.href)+'#type=edit&adid=0';}});$('#popupAddr').off().on(opt.clickEvent,function(event){var $tag=$(event.target);if($tag.hasClass('close')||($tag.parents('.mod_address_slide_main').length==0&&$tag.closest('.mod_address_slide').length)){showHidePopup();opt.onClose&&opt.onClose();}else if($tag.hasClass('back')){getCommonAddrV1();}});}}
function clearArea(num){if(num<areaId.length){for(var i=num,len=areaId.length;i<len;++i){delete areaId[i];delete area[i];}
areaId.length=num;area.length=num;}}
function getAreaList(flag){if(!$('#ulAddrTab').length||!$('#ulAddrList').length){var domStr='<ul class="mod_address_slide_tabs_1" id="ulAddrTab" style="display:none;"></ul><ul class="mod_address_slide_list_2" ptag="7387.1.2" id="ulAddrList" style="display:none;"></ul>';if(opt.isSearch){domStr='<div class="tab"><ul class="tab_list" id="ulAddrTab"></ul></div><div class="search_addrlayer_body_scroller"><div class="search_addrlayer_body_scroller_inner"><ul class="list_1" id="ulAddrList" style="display:none;"></ul></div></div>';}
$('#addrBody').html(domStr);}
if(opt.isSearch){$('#searchFoot').hide();$('#searchAddr').removeClass('with_foot');$('#searchPrev').attr('tag','2');}else{if($('#addrBtn').attr('tag')!=='3')$('#addrBtn').hide().parent().hide();$('#popupAddrHead').html((commonAddrHtml.length>0?'<i class="back"></i>':'')+'<i class="close"></i>');$('#popupAddr div.mod_address_slide_main').addClass('type_flex');}
if(!flag){if(level>0){var tabArr=[],searchStr=(opt.isSearch?' class="item"':'');for(var i=1;i<=level;i++){if(area[i])tabArr.push('<li tag="1"'+searchStr+(areaId[i-1]?' filter-type="area" tid="'+areaId[i-1]+'" tname="'+area[i-1]+'" extid="'+(i-2)+'"':'')+'><span>'+area[i]+'</span></li>');}
tabArr.push('<li tag="1"'+(areaId[level]?' filter-type="area" tid="'+areaId[level]+'" tname="'+area[level]+'" extid="'+(level-1)+'"':'')+' class="'+(opt.isSearch?'item ':'')+'cur"><span></span></li>');$('#ulAddrTab').html(tabArr.join('')).show();}else{$('#ulAddrTab').html('<li class="'+(opt.isSearch?'item ':'')+'cur"><span></span></li>').show();}}
var areaid=areaId[level];if(cache[areaid]&&cache[areaid].length>0){fillAreas(cache[areaid],flag,areaid);return;}
var areas=util.getStorage(storage_version);if(areas){areas=JSON.parse(areas);if(areas[areaid]&&areas[areaid].length>0){fillAreas(areas[areaid],flag,areaid);return;}}
var url='//fts.jd.com/area/get?fid='+areaid+'&callback=getAreaList_callback'+(isMCart?'&sceneval=2':'');window.getAreaList_callback=function(list){areaCgiHold=false;var tempAreas=[];for(var i=0,len=list.length;i<len;++i){if(level==0){if(list[i].id>0&&(list[i].id<100||list[i].id==52993)){tempAreas.push(list[i]);}}else{tempAreas.push(list[i]);}}
if(tempAreas.length>0){fillAreas(tempAreas,flag,areaid);cache[areaid]=tempAreas;!areas&&(areas={});areas[areaid]=tempAreas;util.saveStorage(storage_version,areas,true);}else{clearArea(level+1);finish();}};if(!areaCgiHold){areaCgiHold=true;ls.loadScript({url:url});}}
function finish(res){selectedAddr={}
showHidePopup();if(!gpsChoice)$('#addrGps dl').removeClass('on');if(addrId&&addrName){lastSelectFlag=2
selectedAddr={ids:addrIdArr,names:addrNameArr,id:addrId,name:addrName,longitude:longitude,latitude:latitude,isShortCache:isDefaultAddr!='1'&&isHasDefaultAddr}
setAddrCookies(selectedAddr);addrId='';isDefaultAddr=false;}else{lastSelectFlag=1
if(gpsChoice){gpsChoice=false;selectedAddr={ids:addrIdArr,names:addrNameArr}}else{selectedAddr={ids:areaId.slice(1),names:area.slice(1)}}
if(!opt.onlySaveCommon){setAddrCookies(selectedAddr);}}
if(isMQQBrowser){window.setTimeout(function(){opt.onFinish&&opt.onFinish(res);},300);}else{opt.onFinish&&opt.onFinish(res);}}
function setAddrCookies(opt){opt=opt||{};var today=new Date();var tomorrow_4time=new Date(today.getFullYear()+'/'+(today.getMonth()+1)+'/'+today.getDate()+" 00:00:00").getTime()+28*60*60*1000;var cacheTime=parseInt((tomorrow_4time-today.getTime())/60000);var setCookieStorage=function(key,value,domain){if(opt.isShortCache){JD.cookie.set(key,value,cacheTime,"/",(domain||domainStr));}else{JD.cookie.set(key,value,999999,"/",(domain||domainStr));}
if(window.WQAPI)window.WQAPI.db.set(key,value);},ids=opt.ids,names=opt.names,id=opt.id,name=opt.name,longitude=opt.longitude,latitude=opt.latitude,flag=opt.flag;if(ids&&ids.length>1&&names&&names.length>1){for(var i=0;i<4;i++){ids[i]=ids[i]||'0';names[i]=names[i]||'';}
ids=ids.slice(0,4);names=names.slice(0,4);var wq_addr=[];if(!flag||(id&&name)){wq_addr.push(id||'0');wq_addr.push(ids.join('_'));wq_addr.push(names.join('_'));wq_addr.push(name||'');wq_addr.push(longitude&&latitude?longitude+','+latitude:'');}else{wq_addr=(JD.cookie.get('wq_addr')||'').split('|');wq_addr[0]=wq_addr[0]||'0';wq_addr[1]=ids.join('_');wq_addr[2]=names.join('_');wq_addr=dealAddrDetail(wq_addr);wq_addr=wq_addr.slice(0,5);}
setCookieStorage('wq_addr',wq_addr.join('|'));setCookieStorage('jdAddrId',ids.join('_'));setCookieStorage('jdAddrName',names.join('_'));if(document.domain.indexOf('m.jd.com')>-1){setCookieStorage('commonAddress',wq_addr[0],'m.jd.com');setCookieStorage('regionAddress',(wq_addr[1]||'').replace(/_/g,','),'m.jd.com');}
setCookieStorage('mitemAddrId',wq_addr[1]);setCookieStorage('mitemAddrName',wq_addr[3]);}
try{sysancJdpgAppAddr(opt);}catch(e){}}
function sysancJdpgAppAddr(opt){if(isJdPgApp&&window.JSSDK&&window.JSSDK.Native&&window.JSSDK.Native.Sys&&window.JSSDK.Native.Sys.updateGlobalAddress){var ids=opt.ids,names=opt.names,id=opt.id,name=opt.name,longitude=opt.longitude,latitude=opt.latitude;var params={};ids[0]&&(params.provinceId=ids[0]);names[0]&&(params.provinceName=names[0]);ids[1]&&(params.cityId=ids[1]);names[1]&&(params.cityName=names[1]);ids[2]&&(params.countyId=ids[2]);names[2]&&(params.countyName=names[2]);ids[3]&&(params.townId=ids[3]);names[3]&&(params.townName=names[3]);longitude&&(params.longitude=longitude);latitude&&(params.latitude=latitude);if(name||(names&&names.length>0)){params.fullAddress=name?name:names.join('');}
if(id){params.addressId=id;params.addressType=1;}else{params.addressType=0;}
if(!params.provinceId)return;window.JSSDK.Native.Sys.updateGlobalAddress(params);}}
function fillAreas(areas,flag,areaid){if(opt.onRender){opt.onRender(areas,level);}else{var list=[];for(var i=0,len=areas.length;i<len;++i){list.push({datamark:'area',tid:areas[i].id,name:areas[i].name});}
var html=template(list,areaid),$dom=$('#ulAddrList');$dom.html(html).show();if(flag){var $curDom=$dom.find('[tid="'+areaId[level+1]+'"]'),selectClass=(opt.isSearch?'selected':'on');if(opt.isSearch)$dom=$('.search_addrlayer_body_scroller_inner');$dom.scrollTop(0);if($curDom.length>0){$curDom.addClass(selectClass).siblings().removeClass(selectClass);$dom.scrollTop($curDom.offset().top-$dom.offset().top-20);}}}
opt.onAfterRender&&opt.onAfterRender();}
function template(it,areaid){var out=[],searchStr=(opt.isSearch?' class="item"':'');for(var i=0,l=it.length;i<l;i++){if((it[i].tid==32&&opt.isShowTW)||(it[i].tid==52993&&opt.isShowGA)||(it[i].tid!=32&&it[i].tid!=52993)){out.push('<li'+searchStr+' filter-type="'+(it[i].datamark)+'" tid="'+(it[i].tid)+'" tname="'+(it[i].name)+'">'+it[i].name+'</li>');}}
if(areaid==0&&opt.isShowHW){out.push('<li'+searchStr+' filter-type="area" tid="53283" tname=""></li>');}
return out.join('');}
function getCommonAddrV1(){if(opt.isNeedCommon){if(opt.isSearch){$('#searchFoot').show();$('#searchAddr').addClass('with_foot');$('#searchPrev').attr('tag','1');}else{$('#popupAddrHead').html('<i class="close"></i>');$('#addrBtn').hide().parent().hide();$('#popupAddr div.mod_address_slide_main').removeClass('type_flex');}}
var $dom=$('#addrBody'),selectClass=(opt.isSearch?'selected':'on'),scrollCur=function(){var $ul=$dom.find('ul'),$cur=$dom.find('li[addrid="'+curAddr.addrId+'"]');if(opt.isSearch)$ul=$('.search_addrlayer_body_scroller_inner');$ul.scrollTop(0);if($cur.length>0&&!$cur.hasClass('disabled')){$cur.addClass(selectClass).siblings().removeClass(selectClass);$ul.scrollTop($cur.offset().top-$ul.offset().top-20);}};if(commonAddrHtml.length>0){$dom.html(commonAddrHtml.join(''));scrollCur();return;}
var setCommonError=function(){if(opt.isNeedCommon){opt.isNeedCommon=false;show();}};setTimeout(function(){if(!commonAddrHtml.length){setCommonError();}},1500);window.commonAddrV1CB=function(json){if(json.retCode==='0'){usualAddrList=json.list;addrToken=json.token?json.token:'';var usualItem={},addNewAddr="";if(!usualAddrList.length){setCommonError();}
if(opt.isNeedCommon){commonAddrHtml=[opt.isSearch?'<div class="search_addrlayer_body_scroller"><div class="search_addrlayer_body_scroller_inner"><ul class="list_2">':'<ul class="mod_address_slide_list_1" ptag="7387.1.1">'];var labName='',labClass='',labHtml='';for(var i=0,len=usualAddrList.length;i<len;i++){usualItem=usualAddrList[i];labHtml='';if(usualItem.default_address=='1'){isHasDefaultAddr=true;labHtml='<span class="mod_address_slide_list_1_tag_default"></span>';}
if(!opt.isSearch&&usualItem.label&&(usualItem.label!=usualItem.name)){labHtml+='<span class="mod_address_slide_list_1_tag">'+usualItem.label+'</span>';}
if(usualItem&&usualItem.addrfull&&usualItem.cityId){commonAddrHtml.push('<li filter-type="common"'+(opt.isSearch?' class="item"':(usualItem.need_upgrade==='1'?' class="disabled"':''))+' uname="'+encodeURIComponent(usualItem.name)+'" uphone="'+usualItem.mobile+'" longitude="'+usualItem.longitude+'" latitude="'+usualItem.latitude+'" isdefaultaddr="'+usualItem.default_address+'" addrid="'+(usualItem.adid||0)+'" addrname="'+usualItem.addrfull+'" ids="'+[usualItem.provinceId||0,usualItem.cityId||0,usualItem.countyId||0,usualItem.townId||0].join('_')+'" names="'+[usualItem.provinceName||'',usualItem.cityName||'',usualItem.countyName||'',usualItem.townName||''].join('_')+'">'+labHtml+usualItem.addrfull+(opt.isSearch?'':((usualItem.need_upgrade==='1'?'<p class="mod_address_slide_list_1_warn"></p>':'')+'<i class="mod_address_slide_list_1_edit" style="padding-left: 30px;"></i>'))+'</li>');}}
if(commonAddrHtml.length>1){if(usualAddrList.length<20){addNewAddr='<li filter-type="addaddr" class="mod_address_slide_list_1_more"><span class="mod_address_slide_list_1_moretext"><i class="type_add"></i></span></li>';}
commonAddrHtml.push(opt.isSearch?'</ul></div></div>':addNewAddr+'<li class="mod_address_slide_list_1_more type_or"><span class="mod_address_slide_list_1_moretext"></span></li><li class="mod_address_slide_list_1_more" filter-type="areaaddr"><span class="mod_address_slide_list_1_moretext"><i class="type_choose"></i></span></li></ul>');$dom.html(commonAddrHtml.join(''));scrollCur();}else{commonAddrHtml=[];if(!opt.isSearch){$('#addrBtn').html('<span class="arrow"></span>').attr('tag','3').show().parent().show();}
setCommonError();}}}else{setCommonError();}};ls.loadScript('//wq.jd.com/deal/recvaddr/getrecvaddrlistV3?adid=0&reg=1&callback=commonAddrV1CB&locationid='+(curAddr.id||'')+'&t='+Math.random()+(isMCart?'&sceneval=2':''));}
function checkUpgrade(opt){if(opt.provinceid&&opt.cityid&&opt.countyid){window.checkUpgradeCB=function(json){if(json.errCode==='0'){opt.cb&&opt.cb(json.need_upgrade==='1');}};ls.loadScript(['//wq.jd.com/deal/recvaddr/checkaddress?callback=checkUpgradeCB'+(isMCart?'&sceneval=2':''),'provinceid='+opt.provinceid,'cityid='+opt.cityid,'countyid='+opt.countyid,'townid='+(opt.townid||'')].join('&'));}}
function setBasicDom(){var out='<div class="mod_address_slide" style="display:none;" id="popupAddr"><div class="mod_address_slide_main"><div class="mod_address_slide_head" id="popupAddrHead"></div><div class="mod_address_slide_body" id="addrBody"></div><div class="mod_address_slide_foot"><a id="addrBtn" style="display:none;" href="javascript:void(0);" tag="1"></a></div></div></div>';if(opt.isSearch){out='<div class="search_addrlayer with_foot fixed" id="searchAddr" style="display:none;"><div class="search_addrlayer_main"><div class="search_addrlayer_head ">'+opt.title+'<i class="icon_back" id="searchPrev" tag="1"></i></div><div class="search_addrlayer_body" id="addrBody"></div><div class="search_addrlayer_foot" id="searchFoot"><div class="btns"><a href="javascript:void(0);" class="btn bg_1"></a></div></div></div></div>';}
if(opt.con){$('#'+opt.con).html(out);}else{$('body').append(out);}}
function loadCss(){if($('#addressCss').length||!opt.isNeedCss){return;}
var l=document.createElement('link');l.id='addressCss';l.setAttribute('type','text/css');l.setAttribute('rel','stylesheet');l.setAttribute('href',opt.isSearch?JD.url.getStaticDisRec('//wq.360buyimg.com/fd/h5/wxsq_dev/search/css/search_addrlayer.min_ca7849cb.css'):JD.url.getStaticDisRec('//wq.360buyimg.com/fd/h5/wxsq_dev/gb/css/mod_address_slide.min_c74dbaf7.css'));document.getElementsByTagName('head')[0].appendChild(l);}
function showHidePopup(flag){var $dom=$(opt.isSearch?'#searchAddr':'#popupAddr'),$body=$(opt.isSearch?'html':'body');if(flag){$dom.show();setTimeout(function(){$dom.addClass('show');if(opt.isNeedFixed)$body.addClass(opt.overClass);},50);}else{$body.removeClass(opt.overClass);$dom.removeClass('show');setTimeout(function(){$dom.hide();},50);}}
function getAddrInfo(needUpgrade,cbFun){var wq_addr=[]
if(lastSelectFlag===1&&opt.onlySaveCommon){wq_addr.push('0')
wq_addr.push(selectedAddr.ids.join('_'))
wq_addr.push(selectedAddr.names.join('_'))}else{wq_addr=(JD.cookie.get('wq_addr')||'').split('|'),wq_addr=dealAddrDetail(wq_addr);wq_addr=wq_addr.slice(0,5);}
if(needUpgrade){var addrId=wq_addr[0];if(addrId*1){var addrItem=usualAddrList.filter(function(s){return s&&s.adid===addrId;})[0],upgradeCb=function(flag){if(flag){var addrName=(wq_addr[2]||'').split('_').join('');addUpgradeAlertDom(addrName,addrId);}
cbFun&&cbFun(flag);};if(addrItem){upgradeCb(addrItem.need_upgrade==='1');}else{var addrIds=fourStr(wq_addr[1],'0').split('_');addrItem={provinceId:addrIds[0],cityId:addrIds[1],countyId:addrIds[2],townId:addrIds[3]};checkUpgrade({provinceid:addrItem.provinceId,cityid:addrItem.cityId,countyid:addrItem.countyId,townid:addrItem.townId,cb:upgradeCb});}}}
var xys=(wq_addr[4]||'').split(','),longitude=xys[0]||'',latitude=xys[1]||'';return{addrId:wq_addr[0]||'0',addrName:wq_addr[3]||'',longitude:longitude,latitude:latitude,id:fourStr(wq_addr[1]||JD.cookie.get('jdAddrId'),'0')||'1_72_2819_0',name:fourStr(wq_addr[2]||JD.cookie.get('jdAddrName'),'')||'___'};function fourStr(str,flag){if(!str)return'';var arr=str.indexOf(',')!=-1?str.split(','):str.split('_');for(var i=0;i<4;i++){arr[i]=arr[i]||flag;}
arr=arr.slice(0,4);return arr.join('_');}}
function clearCookies(){var addr=getAddrInfo(),provinceName=(addr.name||'').split('_')[0];if(provinceName&&provinceName.replace(/\s/g,'').length>8){var setCookieStorage=function(key,value){JD.cookie.set(key,value,30,"/",domainStr);if(window.WQAPI)WQAPI.db.set(key,value);};setCookieStorage('wq_addr','0|1_72_2819_0|___||');setCookieStorage('jdAddrId','1_72_2819_0');setCookieStorage('jdAddrName','___');}}
function addUpgradeAlertDom(addrName,addrId){if(!addrName||!addrId)return;if(!$('#addrUpgradeAlert').length){$('body').append('<div id="addrUpgradeAlert" class="mod_alert" style="display: none;"><span class="close"></span><i class="icon"></i><p class="addrtips"></p><p class="btns"><a href="javascript:;" class="btn btn_2" ptag="7387.3.2"></a><a href="javascript:;" class="btn btn_1"></a></p></div><div id="addrUpgradeAlertMask" class="mod_alert_mask" style="display: none;"></div>');$('#addrUpgradeAlert').off().on(opt.clickEvent,'p.btns a.btn_2',function(){show();$('#addrUpgradeAlert,#addrUpgradeAlertMask').hide().removeClass('show fixed');}).on(opt.clickEvent,'p.btns a.btn_1',function(){opt.beforeEdit&&opt.beforeEdit();location.href='//wqs.jd.com/my/my_address.shtml?ptag=7387.3.3'+(isMCart?'&sceneval=2':'')+'&backurl='+encodeURIComponent(location.href)+'#type=edit&adid='+addrId;showHidePopup();$('#addrUpgradeAlert,#addrUpgradeAlertMask').hide().removeClass('show fixed');});$('#addrUpgradeAlert span.close,#addrUpgradeAlertMask').off().on(opt.clickEvent,function(){$('#addrUpgradeAlert,#addrUpgradeAlertMask').hide().removeClass('show fixed');});}
var $el=$('#addrUpgradeAlert'),$cover=$('#addrUpgradeAlertMask');$el.show().addClass('show fixed').find('p.addrtips').text(''+addrName+'');$cover.show().addClass('show fixed');window.wa&&wa('jdClick',{ptag:'7387.3.1'});}
function dealAddrDetail(wq_addr){if(wq_addr.length>5){var xy=wq_addr[wq_addr.length-1],wq_xy='',wq_detail=wq_addr.slice(3);if(/\d+(?:\.\d+)?,\d+(?:\.\d+)?/.test(xy)){wq_detail=wq_addr.slice(3,wq_addr.length-1);wq_xy=xy;}
wq_addr[3]=wq_detail.join('|');wq_addr[4]=wq_xy;}
return wq_addr;}});
;define('wq.item.common',function(require,exports,module){var _cacheThisModule_,$=require("zepto"),mUtil=require('util'),pageWidth=$(window).width();window._imagePC_data={num:0};var detLeftPadding=10,detRightPadding=10;function setDetPadding(padding){if(padding==undefined)return;if($.isArray(padding)){if(padding.length<1||padding.length>4){return;}else if(padding.length===4){detLeftPadding=(padding[3]+'').replace('px','')-0;detRightPadding=(padding[1]+'').replace('px','')-0;}else if(padding.length===3||padding.length===2){detLeftPadding=detRightPadding=(padding[1]+'').replace('px','')-0;}else{detLeftPadding=detRightPadding=(padding[0]+'').replace('px','')-0;}}else{detLeftPadding=detRightPadding=(padding+'').replace('px','')-0;}}
function initLoadImg(opt){var data={cache:[]},commId=opt.commId,$img=$('#'+commId+' img');$img.each(function(i){var dom=$(this);data.cache.push({url:dom.attr('item_init_src'),dom:dom});});data.num=data.cache.length;if(!window._imagePC_data[commId]){window._imagePC_data.num+=1;startResizeer(commId);}
window._imagePC_data[commId]=data;var scale=areaResize(commId);var oDiv=document.getElementById(commId);if(scale&&Math.ceil(14/scale)>10){oDiv.style.fontSize=Math.ceil(14/scale)+'px';}
oDiv.style.lineHeight=2;loadImg();}
function loadImg(){var d=window._imagePC_data;if(!d||d.num<=0){return;}
var scrollHeight=$(window).scrollTop(),visibleHeight=$(window).height()+scrollHeight+100;for(var key in window._imagePC_data){if(key=='num')continue;var dd=window._imagePC_data[key];$.each(dd.cache,function(i,data){var em=data.dom,imgH=em.offset().top;if(visibleHeight>imgH&&!em.attr("loaded")&&em.is(':visible')){if(data.url){em.on('load',(function(commId){return function(){areaResize(commId);};})(key));em.attr("src",data.url);}
em.removeAttr('item_init_src');em.attr("loaded",dd.num);dd.num--;}});if(dd.num<=0){delete window._imagePC_data[key];window._imagePC_data.num-=1;}}}
function areaResize(commId){var oDiv=document.getElementById(commId);if(!oDiv)return 0;var pDiv=oDiv.parentNode,w=oDiv.offsetWidth,h=oDiv.offsetHeight,cw=(window.isMScene&&pageWidth>640?640:pageWidth)-detLeftPadding-detRightPadding;if(w>0){var scale=cw/w;if(scale<1){oDiv.style.WebkitTransformOrigin=0+'px '+0+'px';oDiv.style.transformOrigin=0+'px '+0+'px';oDiv.style.WebkitTransform='scale('+scale+')';oDiv.style.transform='scale('+scale+')';pDiv.style.width=(w*scale)+'px';pDiv.style.height=(h*scale)+'px';}
if(scale&&Math.ceil(14/scale)>10){var oDiv=document.getElementById(commId);oDiv.style.fontSize=Math.ceil(14/scale)+'px';}
return scale;}
return 0;}
function startResizeer(commId){var inter=window.setInterval(function(){areaResize(commId);},1500);window.setTimeout(function(){window.clearInterval(inter);},6000);}
function tavlHTML(str){if(!str)return'';var imgReg=/<img([^>]*?\s+)src=["']([^"']+)["']([^>]*>)/ig,backgroundReg=/background\s*=\s*"([^"]+)"/ig,iframeReg=/<iframe([^>]+)src\s*=\s*"([^"]+)"(.*?\/iframe>)/ig,imgReg3=/src\s*=\s*"\s*(done|null|undefined|\s)*?"/g,emptyImg='//wq.360buyimg.com/fd/h5/base/detail/images/transparent_a38f0a03.png',linkReg3=/height="0px"/ig,urlReg=/^(https*:){0,1}\/\//,focReg=/\![^\.]*(\..+)$/,base64Reg=/^data:image\/(jpeg|png|gif);base64,/,flashvar='',width='',height='';str=str.replace(imgReg,function($0,$1,$2,$3){if(base64Reg.test($2)){}else{$2=adverImgurl($2);if(urlReg.test($2)){$2=$2.replace(focReg,'$1');$2=JD.img.getImgUrl($2);}else{$2=emptyImg;}}
$3=($3||'').replace(/src\s*=\s*".*?"/g,'');return'<img'+$1+'item_init_src="'+$2+'" src="'+emptyImg+'"'+$3;}).replace(backgroundReg,function($0,$1){if(base64Reg.test($1)){}else{$1=adverImgurl($1);if(urlReg.test($1)){$1=JD.img.getImgUrl($1);}else{$1='';}}
return $1?'background="'+$1+'"':'';}).replace(imgReg3,'').replace(linkReg3,'style="display:none"').replace(iframeReg,function($0,$1,$2,$3){flashvar=($2||'').split('?')[1];var outStr='';if(flashvar){flashvar=htmlDecode(flashvar);width=JD.url.getUrlParam('w',flashvar);height=JD.url.getUrlParam('h',flashvar);if(height>0&&width>0){if(width>pageWidth){height=(pageWidth/width)*height;width=pageWidth;}
flashvar+='&height='+height+'&width='+width;outStr='<p class="warning_text"> Wi-Fi </p><iframe src="'+'//s.yuntv.letv.com/bcloud.html?'+flashvar+'" height="'+height+'" width="'+width+'"></iframe>'}}
return outStr;}).replace(/\>\s*[\?]+\s*\</g,'><').replace(/http:\/\//g,'//');try{str=adverTransferCss(str);str=adverTransfer(str,'','');}catch(e){}
return str;}
function htmlDecode(str){return typeof(str)!="string"?"":str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&amp;/g,"&");}
function adverImgurl(imgurl){imgurl=imgurl.replace(/(^.*)\/\//i,'//').replace(/img10/g,'img1'+parseInt(Math.random()*5,10));return imgurl;}
function adverTransferCss(str){var out=str,styleReg=/<\s*style[^>]*>([^<]*)<\s*\/\s*style\s*>/ig,emptyBgUrlReg=/background(?:-image)?\s*\:[^\;]*url\(\s*\)[^\;\}]*[\;]?/ig,cssReg=/([^\{]*)(\{[^\}]*\})/ig,annotReg=/\/\*[^\*]*\*\//ig;out=out.replace(styleReg,function($0,$1){if(!$1)return'';var str=$1.replace(emptyBgUrlReg,'');str=str.replace(annotReg,'');str=str.replace(cssReg,function(a0,a1,a2){if(!a1)return'';var tempA1s=a1.split(','),a1s=[];for(var i=0,len=tempA1s.length;i<len;++i){if(/^\s*\./.test(tempA1s[i])){a1s.push(tempA1s[i]);}}
if(a1s.length==0)return'';return a1s.join(',')+a2;});if(!str||/^\s*$/.test(str))return'';return'<style type="text/css">'+str+'</style>';});return out;}
function adverTransfer(ad,flag,ptag){if(!ad)return'';var out='',urlReg=/^(https*:){0,1}\/\//;flag=flag||urlReg.test(ad);if(flag){out=window.isKeplerPinGou?keplerPinGouTransferUrl(ad,ptag):((window.isMScene)?mTransferUrl(ad,ptag):transferUrl(ad,ptag));}else{var linkReg=/<a([^>]+)href\s*=\s*"([^"]+)"(.*?\/a>[,\?\.!:]*)/ig,linkReg1=/<area([^>]+)href\s*=\s*"([^"]+)"(.*?>[,\?\.!:]*)/ig,linkUrl='';out=ad.replace(/\\\\*['"]/ig,'"').replace(/\r|\n/g,'').replace(linkReg1,function($0,$1,$2,$3){linkUrl=window.isKeplerPinGou?keplerPinGouTransferUrl($2):((window.isMScene)?mTransferUrl($2):transferUrl($2));return(linkUrl?('<area'+$1+'href="'+linkUrl+'" '+$3).replace('_blank','_self'):'');});out=out.replace(linkReg,function($0,$1,$2,$3){linkUrl=window.isKeplerPinGou?keplerPinGouTransferUrl($2):((window.isMScene)?mTransferUrl($2):transferUrl($2));return(linkUrl?('<a'+$1+'href="'+linkUrl+'" '+$3).replace('_blank','_self'):'');});}
return out;}
function transferUrl(url,ptag){if(!url)return'';var urlReg=/^(https*:)?\/\//,outUrl='',replaceReg=[/^(https*:)?\/\/item(\.m)?\.jd\.com\/(product\/)?(\d+)\.html/,/^(https*:)?\/\/item\.m\.jd\.com\/ware\/view\.action(?=\?).*[?|&]wareId=(\d+)/,/^(https*:)?\/\/m?item\.jd\.hk\/(product\/)?(\d+)\.html/,/^(https*:)?\/\/mitem\.jd\.hk\/ware\/view\.action(?=\?).*[?|&]wareId=(\d+)/,/^(https*:)?\/\/m?item\.yiyaojd\.com\/(product\/)?(\d+)\.html/,/^(https*:)?\/\/mitem\.yiyaojd\.com\/ware\/view\.action(?=\?).*[?|&]wareId=(\d+)/,/^(https*:)?\/\/m?item\.jkcsjd\.com\/(product\/)?(\d+)\.html/,/^(https*:)?\/\/mitem\.jkcsjd\.com\/ware\/view\.action(?=\?).*[?|&]wareId=(\d+)/,/^(https*:)?\/\/item(\.m)?\.paipai\.com\/(product\/)?(\d+)\.html/,],wqReg=/^(https*:)?\/\/(wqs|wq|wqitem|wqmitem|wqsou)\.jd\.(com\/|hk\/)/,skuId='',wqRegs=[];if(window.itemWhitelist){wqRegs=window.itemWhitelist.filter(function(item){return item.channel==='wq'})[0].reg.split(';');}else{JD.report.umpBiz({bizid:'25',operation:'31',result:'1',source:'0',message:'this url doesn\'t config the item_whiteList ppms'+location.href});wqRegs=['/^(https*:)?\/\/red\.jd\.com\/redList-.+?-0-0-1\.html\s*?$/','/^(https*:)?\/\/red\.jd\.com\/redList-.+?-0-0-1\.html\s*?$/','/^(https*:)?\/\/redact\.m\.jd\.com\/(detail\/|foreDetail\/|wq\/detail\/|wq\/foreDetail\/).+?\.html\s*?$/','/^(https*:)?\/\/(wqs|wq|wqitem|wqmitem|wqsou)\.jd\.(com\/|hk\/)/','/^(https*:)?\/\/www\.healthjd\.com/','/^(https*:)?\/\/sale\.jd\.com\/m-\w{1,}\.html/','/^(https*:)?\/\/sale\.jd\.com\/m\/h5\/\w{1,}\.html/','/^(https*:)?\/\/item\.(yiyao)?jd\.(com|hk)/','/^(https*:)?\/\/item\.(jkcs)?jd\.(com|hk)/','/^(https*:)?\/\/item(\.m)?\.paipai\.com/'];}
if(!urlReg.test(url))return'';if(wqReg.test(url)){outUrl=url.replace(/(https*:)?/,'');}else{for(var i=0,len=replaceReg.length;i<len;i++){var matchRegArr=url.match(replaceReg[i]);if(matchRegArr){skuId=matchRegArr[matchRegArr.length-1];if(skuId>0){try{var params;if(url.indexOf('http')===-1){params=new URL('http:'+url).search;}else{params=new URL(url).search;}
if(params.indexOf('wareId')!==-1){outUrl='//wqitem.jd.com/item/view'+params.replace('wareId','sku');}else{outUrl='//wqitem.jd.com/item/view'+(params?params+'&':'?')+'sku='+skuId;}}catch(e){outUrl='';}}
break;}}}
if(wqRegs.length>0&&wqRegs[0]){wqRegs.forEach(function(reg){reg=new RegExp(reg.slice(1,-1));try{if(reg.test(url)){outUrl=url.replace(/(https*:)?/,'');}}catch(e){}})}
if(urlReg.test(outUrl)){outUrl=ptag?mUtil.addRd(outUrl,ptag):outUrl;}else{outUrl='';}
return outUrl;}
function mTransferUrl(url,ptag){if(!url)return'';var urlReg=/^(https*:){0,1}\/\//,outUrl='',mRegs=[];if(window.itemWhitelist){mRegs=window.itemWhitelist.filter(function(item){return item.channel==='mm'})[0].reg.split(';');}else{JD.report.umpBiz({bizid:'25',operation:'31',result:'1',source:'0',message:'this url doesn\'t config the item_whiteList ppms'+location.href});mRegs=['/^(https*:){0,1}\/\/sale\.jd\.com/','/^(https*:){0,1}\/\/car\.m\.jd\.com/','/^(https*:){0,1}\/\/msc\.jd\.com/','/^(https*:){0,1}\/\/item\.jd\.com/','/^(https*:){0,1}\/\/coupon\.m\.jd\.com/','/^(https*:){0,1}\/\/red\.jd\.com/','/^(https*:){0,1}\/\/red\.m\.jd\.com/','/^(https*:){0,1}\/\/h5\.m\.jd\.com/','/^(https*:){0,1}\/\/v\.m\.jd\.com/','/^(https*:){0,1}\/\/jdw\.jd\.hk/','/^(https*:){0,1}\/\/shop\.m\.jd\.com/','/^(https*:){0,1}\/\/pro(\.m){0,1}\.jd\.com/','/^(https*:){0,1}\/\/m\.jr\.jd\.com/','/^(https*:){0,1}\/\/credit\.jd\.com/','/^(https*:){0,1}\/\/phrase\.jd\.com/','/^(https*:){0,1}\/\/mall\.jd\.com/','/^(https*:){0,1}\/\/m\.jd\.com\/html\/quanqiugou\/ebayIntro\.html/','/^(https*:){0,1}\/\/ihelp\.jd\.com\/l\/help\/scene\/getSceneDetail/','/^(https*:){0,1}\/\/home\.m\.jd\.com\/sam\/bandCard\.action/','/^(https*:){0,1}\/\/home\.m\.jd\.com\/sam\/myCard\.action/','/^(https*:){0,1}\/\/crmsam\.jd\.com\/samclub\/index\.html/','/^(https*:){0,1}\/\/m\.huishou\.jd\.com/','/^(https*:){0,1}\/\/item\.m\.jd\.com/','/^(https*:){0,1}\/\/coll\.jd\.com/','/^(https*:){0,1}\/\/book\.jd\.com/','/^(https*:){0,1}\/\/channel\.jd\.com/','/^(https*:){0,1}\/\/c-nfa\.jd\.com/','/^(https*:){0,1}\/\/tob\.jd\.com/','/^(https*:){0,1}\/\/surveys\.jd\.com/','/^(https*:){0,1}\/\/poplist\.m\.jd\.com/','/^(https*:){0,1}\/\/uranus\.jd\.com/','/^(https*:){0,1}\/\/answer\.jd\.com/','/^(https*:){0,1}\/\/www\.healthjd\.com/',];}
if(!urlReg.test(url))return'';if(mRegs.length>0&&mRegs[0]){try{mRegs.forEach(function(reg){reg=new RegExp(reg.slice(1,-1));if(reg.test(url)){outUrl=url.replace(/(https*:){0,1}/,'');}})}catch(e){}}
if(urlReg.test(outUrl)){outUrl=ptag?mUtil.addRd(outUrl,ptag):outUrl;}else{outUrl='';}
return outUrl;}
function keplerPinGouTransferUrl(url,ptag){if(!url)return'';var urlReg=/^(https*:){0,1}\/\//;if(!urlReg.test(url))return'';var keplerRegs=[],outUrl='';if(window.itemWhitelist){keplerRegs=window.itemWhitelist.filter(function(item){return item.channel==='kepler'})[0].reg.split(';');}else{JD.report.umpBiz({bizid:'25',operation:'31',result:'1',source:'0',message:'this url doesn\'t config the item_whiteList ppms'+location.href});keplerRegs=[];}
if(keplerRegs.length>0&&keplerRegs[0]){try{keplerRegs.forEach(function(reg){reg=new RegExp(reg.slice(1,-1));if(reg.test(url)){outUrl=url.replace(/(https*:){0,1}/,'');}})}catch(e){}}
if(urlReg.test(outUrl)){outUrl=ptag?mUtil.addRd(outUrl,ptag):outUrl;}else{outUrl='';}
return outUrl;}
function adverChangeLinkShow(ad){var linkReg=/<\/?a[^>]*>/g,linkGroupReg=/<a.*?href=\"([^\"]*)\"[^>]*>/;var match=ad.match(linkGroupReg);if(match&&match.length>1){var link=match[1];ad=ad.replace(linkReg,'');ad+=' <a href="'+link+'">></a>';}
return ad;}
function transEmbed(commId){var $dom=$('#'+commId),$embed=$dom.find('embed'),$item='';if($embed.length){$embed.hide();$.each($embed,function(i,item){$item=$(item);var flashvar=$item.attr('flashvars'),height=$item.attr('h'),width=$item.attr('w');if(flashvar&&height>0&&width>0){if(width>pageWidth){height=(pageWidth/width)*height;width=pageWidth;}
flashvar+='&height='+height+'&width='+width;$item.after('<p class="warning_text"> Wi-Fi </p><iframe src="'+'//s.yuntv.letv.com/bcloud.html?'+flashvar+'" height="'+height+'" width="'+width+'"></iframe>');}});$embed.remove();}}
function moduleReport(){var cacheTime=0,factoryTime=0,loadTime=0,startWaste=0;try{if(window._itemGlobal&&window._itemGlobal.startRepTime){var navigationStart=(window.performance||window.webkitPerformance)['timing']['navigationStart'];if(navigationStart>1000)startWaste=window._itemGlobal.startRepTime.getTime()-navigationStart;}}catch(e){}
var cgi='//fd.3.cn/cesu/r?pid=277';var OS=getOS(navigator.userAgent);if(window.JD&&JD.device&&JD.device.getNetwork){JD.device.getNetwork(function(network){var reportImg=new Image();var os=OS?OS.replace(/%20/g,""):"other",net=(network||'').toLowerCase();reportImg.src=[cgi,'os='+os,'apn='+net,'s1='+loadTime,'s2='+cacheTime,'s3='+factoryTime,'s4='+startWaste].join('&');});}}
function getOS(ua){var OSTypeList={'android':[/(Android);?[\s\/]+([\d.]+)?/,[1,2]],'ios':[/((iPad)|(iPod)|(iPhone)).*\s+OS\s+([\d_]+)/,function(r){return['ios',(r[5]?r[5].replace(/_/g,'.'):"")]}],'unknow':[/(Android);?[\s\/]+([\d.]+)?/],'win':[/(\(|\s)*(Windows)[^\d.]+([\d\.]+).*((WOW64)*)/gi,[2,3]]};var r,it;for(var k in OSTypeList){it=OSTypeList[k];if(it[0]instanceof Function){r=it[0](ua);return k+=r[1]?' '+r[1]:'';}else if(r=it[0].exec(ua)){if(it.length>1){if(it[1]instanceof Function){r=it[1](r);}else if(it[1]instanceof Array){r=[r[it[1][0]],r[it[1][1]]];}}
return k+=r[1]?' '+r[1]:'';}}
return'other';}
function jsonToTpl(json,tpl){var outStr='';try{outStr=(tpl||'').replace(/{#(\w+)#}/g,function(a,b){return json[b]===0?'0':(json[b]||"");});}catch(e){}
return outStr;}
function setItemOrderChannel(skuId){var urlKey=JD.url.getUrlParam('channelkey'),urlValue=JD.url.getUrlParam('channelvalue'),urlKeyWhiteList_wq=['cubeinvite'],urlKeyWhiteList_m=['cubeinvite'],urlKeyWhiteList=[];urlKeyWhiteList=window.isMScene?urlKeyWhiteList_m:urlKeyWhiteList_wq;if(urlKeyWhiteList.indexOf(urlKey)>=0&&urlValue){var itemOrderchannel=JD.cookie.get('item_orderchannel')?JSON.parse(JD.cookie.get('item_orderchannel')):{};itemOrderchannel[urlKey]={value:urlValue,skuId:skuId,timeStamp:new Date().getTime()
};JD.cookie.set('item_orderchannel',JSON.stringify(itemOrderchannel),24*60,'/','jd.com');setTimeout(function(){JD.cookie.set('item_orderchannel',JSON.stringify(itemOrderchannel),24*60,'/','jd.com');},4500);}}
function updateItemOrderChannel(skuId){var urlKey=JD.url.getUrlParam('channelkey'),urlValue=JD.url.getUrlParam('channelkey'),urlKeyWhiteList_wq=['cubeinvite'],urlKeyWhiteList_m=['cubeinvite'],urlKeyWhiteList=[];urlKeyWhiteList=window.isMScene?urlKeyWhiteList_m:urlKeyWhiteList_wq;if(urlKeyWhiteList.indexOf(urlKey)>=0&&urlValue){var itemOrderchannel=JSON.parse(JD.cookie.get('item_orderchannel'));itemOrderchannel[urlKey].skuId=skuId;itemOrderchannel[urlKey].timeStamp=new Date().getTime();JD.cookie.set('item_orderchannel',JSON.stringify(itemOrderchannel),24*60,'/','jd.com');}}
exports.setItemOrderChannel=setItemOrderChannel;exports.updateItemOrderChannel=updateItemOrderChannel;exports.setDetPadding=setDetPadding;exports.initLoadImg=initLoadImg;exports.loadImg=loadImg;exports.tavlHTML=tavlHTML;exports.adverTransfer=adverTransfer;exports.transEmbed=transEmbed;exports.moduleReport=moduleReport;exports.jsonToTpl=jsonToTpl;exports.adverChangeLinkShow=adverChangeLinkShow;});
;define("cachev1",function(require,exports,module){var _cacheThisModule_;var _isSessionAble=true;var _isLocalAble=true;var checkStorage=function(o){var key="WXSQ_STOARGE_TEST",value;try{o.setItem(key,1);value=o.getItem(key);o.removeItem(key);return value==1;}catch(e){return false;}};try{_isSessionAble=checkStorage(window.sessionStorage);_isLocalAble=checkStorage(window.localStorage);}catch(e){_isSessionAble=false;_isLocalAble=false;}
if(!_isSessionAble||!_isLocalAble){JD.report.umpBiz({bizid:45,operation:1,result:2,source:0,message:"session "+_isSessionAble+"|local "+_isLocalAble});}
var isArray=Array.isArray||function(object){return object instanceof Array}
function isWindow(obj){return obj!=null&&obj==obj.window}
function isObject(obj){return obj!=null&&typeof(obj)=="object"}
function isPlainObject(obj){return isObject(obj)&&!isWindow(obj)&&Object.getPrototypeOf(obj)==Object.prototype}
function extend(target,source,deep){for(key in source)
if(deep&&(isPlainObject(source[key])||isArray(source[key]))){if(isPlainObject(source[key])&&!isPlainObject(target[key]))
target[key]={}
if(isArray(source[key])&&!isArray(target[key]))
target[key]=[]
extend(target[key],source[key],deep)}else if(source[key]!==undefined)target[key]=source[key]
return target;}
function parseJSON(data){if(!data||typeof(data)!="string"){return data;}
data=data.replace(/^\s+|\s+$/g,"");if(!data)return data;try{data=JSON.parse(data);}catch(e){}
return data;};var storage=function(){var jdStorage=window.sessionStorage;var keyPrefix="WQ_";var _setItem=function(key,value,merge,expire,callback){var o=parseJSON(getItem(keyPrefix+key));if(o&&(merge&&isPlainObject(value)&&isPlainObject(o.v)||isArray(value)&&isArray(o.v))){value=extend(o.v,value,true);}
var v={v:value,"t":new Date().getTime(),"e":typeof expire!="number"?"":expire};_flush(keyPrefix+key,v,callback);};var _getItem=function(key){var o=jdStorage.getItem(keyPrefix+key);if(!o)return jdStorage.getItem(key);o=parseJSON(o);var e=o&&o.e;if(e===0||(e&&(new Date()-o.t)>=e*1000)){_removeItem(key);return"";}
return o.v;};var _removeItem=function(key){try{jdStorage.removeItem(keyPrefix+key);}catch(e){}};var _flush=function(key,value,callback){var v="";try{v=JSON.stringify(value);}catch(e){throw new Error("JSON"+e.message);}
try{jdStorage.setItem(key,v);callback&&callback(0);}catch(e){callback&&callback(0);setTimeout(function(){_clearOut();try{jdStorage.setItem(key,v);}catch(e){JD.report.umpBiz({bizid:45,operation:1,result:1,source:0,message:key+"|"+e.message});return false;}},0);}
return true;};var _persistence=function(p){jdStorage=p?window.localStorage:window.sessionStorage;}
var _clearOut=function(){var key="";for(var i=jdStorage.length-1;i>=0;i--){key=jdStorage.key(i);key.indexOf(keyPrefix)==0&&_getItem(key.slice(keyPrefix.length));}}
return{setItem:_setItem,getItem:_getItem,removeItem:_removeItem,persistence:_persistence,clearOut:_clearOut,}}();function getItem(key){var v="";try{v=storage.getItem(key);}catch(e){}
return v;}
function setItem(key,value,force,merge,expire,callback){typeof expire=="function"&&(callback=expire,expire=false);typeof merge=="number"&&(expire=merge,merge=false);typeof merge=="function"&&(callback=merge,merge=false);typeof force=="function"&&(callback=force,force=false);typeof force=="number"&&(expire=force,force=false);if(force&&(!expire||typeof expire!="number")){throw new Error("");return false;}
storage.persistence(!!force);storage.setItem(key,value,merge,expire,callback);}
function removeItem(key){storage.removeItem(key);}
return{getItem:function(key,force){storage.persistence(!!force);return getItem(key);},setItem:function(key,value,force,merge,expire,callback){return setItem(key,value,force,merge,expire,callback);},removeItem:function(key,force){storage.persistence(!!force);return removeItem(key);},clearOut:function(force){storage.persistence(!!force);storage.clearOut();},session:{getItem:function(key){storage.persistence(false);return getItem(key);},setItem:function(key,value,merge,expire,callback){return setItem(key,value,false,merge,expire,callback);},removeItem:function(key){storage.persistence(false);return removeItem(key);},clearOut:function(){storage.persistence(false);storage.clearOut();},},local:{getItem:function(key){storage.persistence(true);return getItem(key);},setItem:function(key,value,merge,expire,callback){return setItem(key,value,true,merge,expire,callback);},removeItem:function(key){storage.persistence(true);return removeItem(key);},clearOut:function(){storage.persistence(true);storage.clearOut();},}}});
;define('mqqStorage',function(require,exports,module){var _cacheThisModule_;var isInQQ=((/qq\/([\d\.]+)*/).test(navigator.userAgent)),supportDataApi=isInQQ&&window.mqq&&mqq.compare("4.6")>=0,cfg={prefix:"$lc_",expire:1440,callId:1,path:"wanggouH5data"};var _cache=require("cachev1");function writeH5Data(key,data,callback,exp){try{var now=new Date(),myKey=cfg.prefix+key,callback=callback?callback:empty(),myData=JsonToStr({value:data,expire:now.setMinutes(now.getMinutes()+(exp||cfg.expire))});if(supportDataApi){mqq.data.writeH5Data({callid:cfg.callId,path:cfg.path,key:myKey,data:myData},function(res){callback(res.ret==0);});}else{_cache.session.setItem(myKey,myData,(exp||cfg.expire)*60,function(ret){if(ret==0){callback(true);}else{callback(false);}});}}catch(e){callback(false);}};function readH5Data(key,callback){try{var myKey=cfg.prefix+key;callback=callback?callback:empty();if(supportDataApi){mqq.data.readH5Data({callid:cfg.callId,path:cfg.path,key:myKey},function(res){if(res.ret!=0){callback(null,false);return;}
var d=StrToJson(res.response.data),now=new Date();if(!d){callback(null,false);return;}
if(d.expire>now.getTime()){callback(d.value,true);}else{mqq.data.deleteH5Data({callid:cfg.callId,path:cfg.path,key:myKey});callback(null,false);}});}else{var d=getStorageObj(myKey);callback(d?d.value:null,d?true:false);}}catch(e){callback(null,false);}};function deleteH5Data(key,callback){try{var myKey=cfg.prefix+key;callback=callback?callback:empty();if(supportDataApi){mqq.data.deleteH5Data({callid:cfg.callId,path:cfg.path,key:myKey},function(res){callback(res.ret==0);});}else{_cache.session.removeItem(key);callback(true);}}catch(e){callback(false);}};function JsonToStr(o){if(o==undefined){return"";}
if(JSON&&JSON.stringify){return JSON.stringify(o);}else{var r=[];if(typeof o=="string")return"\""+o.replace(/([\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+"\"";if(typeof o=="object"){if(!o.sort){for(var i in o)
r.push("\""+i+"\":"+JsonToStr(o[i]));if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(o.toString)){r.push("toString:"+o.toString.toString());}
r="{"+r.join()+"}"}else{for(var i=0;i<o.length;i++)
r.push(JsonToStr(o[i]))
r="["+r.join()+"]";}
return r;}
return o.toString().replace(/\"\:/g,'":""');}}
function StrToJson(str){try{if(JSON&&JSON.parse){return JSON.parse(str);}else{return eval('('+str+')');}}catch(e){return null;}}
function getStorageObj(name){var storageObj,timeNow=new Date();storageObj=StrToJson(_cache.session.getItem(name));if(storageObj&&timeNow.getTime()<storageObj.expire){return storageObj;}else{_cache.session.removeItem(name);return null;}}
function empty(){return function(){};}
return{writeH5Data:writeH5Data,readH5Data:readH5Data,deleteH5Data:deleteH5Data};});
;define('md5',function(require,exports,module){var _cacheThisModule_;exports.getHash=getHash;var rotateLeft=function(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}
var addUnsigned=function(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4)return(lResult^0x80000000^lX8^lY8);if(lX4|lY4){if(lResult&0x40000000)return(lResult^0xC0000000^lX8^lY8);else return(lResult^0x40000000^lX8^lY8);}else{return(lResult^lX8^lY8);}}
var F=function(x,y,z){return(x&y)|((~x)&z);}
var G=function(x,y,z){return(x&z)|(y&(~z));}
var H=function(x,y,z){return(x^y^z);}
var I=function(x,y,z){return(y^(x|(~z)));}
var FF=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(F(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var GG=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(G(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var HH=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(H(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var II=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(I(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var convertToWordArray=function(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWordsTempOne=lMessageLength+8;var lNumberOfWordsTempTwo=(lNumberOfWordsTempOne-(lNumberOfWordsTempOne%64))/64;var lNumberOfWords=(lNumberOfWordsTempTwo+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}
lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;};var wordToHex=function(lValue){var WordToHexValue="",WordToHexValueTemp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValueTemp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValueTemp.substr(WordToHexValueTemp.length-2,2);}
return WordToHexValue;};var uTF8Encode=function(string){string=string.replace(/\x0d\x0a/g,"\x0a");var output="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){output+=String.fromCharCode(c);}else if((c>127)&&(c<2048)){output+=String.fromCharCode((c>>6)|192);output+=String.fromCharCode((c&63)|128);}else{output+=String.fromCharCode((c>>12)|224);output+=String.fromCharCode(((c>>6)&63)|128);output+=String.fromCharCode((c&63)|128);}}
return output;};function getHash(string){var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=uTF8Encode(string);x=convertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD);}
var tempValue=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return tempValue.toLowerCase();}});
;define('wfdata',function(require,exports,module){var _cacheThisModule_,ls=require('loadJs'),useDebug=JD.url.getUrlParam("mdebug")?true:false,storage=require("mqqStorage"),md5=require("md5"),_DataType={PPMS:5,Spematerial:7,Mportal:8,Brandspecial:9,Keywordsearch:10,CPC_NEW:11,SECKILL:12,RANKLIST:13,Keywordsearch_MUTI:14,CATEGORYENTRY:15,MARTV3:16,PINGOU:17,SecondSECKILL:18,MART:0,CPT:1,CPC:2,CPT_WX:3,MART_MUTI:4,MaterialQuery:6,};var TYPE_MAP={};TYPE_MAP[_DataType.PPMS]={cgi:'//wq.360buyimg.com/data/ppms/js/ppms.page{#key#}.jsonp'};TYPE_MAP[_DataType.Spematerial]={cgi:'//wqcoss.jd.com/mcoss/spematerial/spematerialshow'};TYPE_MAP[_DataType.Mportal]={cgi:'//wqcoss.jd.com/mcoss/mportal/show'};TYPE_MAP[_DataType.Brandspecial]={cgi:'//wqcoss.jd.com/mcoss/brandspecial/show'};TYPE_MAP[_DataType.Keywordsearch]={cgi:'//wqcoss1.jd.com/mcoss/keyword/keywordsearch'};TYPE_MAP[_DataType.CPC_NEW]={cgi:'//wqcoss1.jd.com/mcoss/focusbi/show_new'};TYPE_MAP[_DataType.SECKILL]={cgi:'//wqcoss.jd.com/mcoss/seckill/show'};TYPE_MAP[_DataType.SecondSECKILL]={cgi:'//wqcoss.jd.com/mcoss/secondkill/show'};TYPE_MAP[_DataType.RANKLIST]={cgi:'//wqcoss.jd.com/mcoss/ranklist/bshow'};TYPE_MAP[_DataType.Keywordsearch_MUTI]={cgi:'//wqcoss.jd.com/mcoss/keyword/batchkeywordsearch'};TYPE_MAP[_DataType.CATEGORYENTRY]={cgi:'//wqcoss.jd.com/mcoss/categoryentry/getentryv2'};TYPE_MAP[_DataType.MARTV3]={cgi:'//wqcoss.jd.com/mcoss/martv3/show'};TYPE_MAP[_DataType.PINGOU]={cgi:'//wqcoss.jd.com/mcoss/seckill/pingou'};TYPE_MAP[_DataType.MART]={cgi:'//wqcoss.jd.com/mcoss/mmart/show'};TYPE_MAP[_DataType.CPT]={cgi:'//wqcoss.jd.com/mcoss/focuscpt/qqshow'};TYPE_MAP[_DataType.CPC]={cgi:'//wqcoss.jd.com/mcoss/focusbi/show'};TYPE_MAP[_DataType.CPT_WX]={cgi:'//wqcoss.jd.com/mcoss/focuscpt/wxshow'};TYPE_MAP[_DataType.MART_MUTI]={cgi:'//wqcoss.jd.com/mcoss/mmart/mshow'};TYPE_MAP[_DataType.MaterialQuery]={cgi:'//wqcoss.jd.com/mcoss/material/query'};function getParamStr(param,isGetCacheKey){var arr=[];for(var key in param){var v=param[key]+"";if(v){arr.push(isGetCacheKey?key+'_'+v:key+'='+v);}}
if(isGetCacheKey){return arr.sort().join('_');}else{arr.push('t='+Math.round(new Date()/(1000*300)));return arr.join('&');}}
function getCGI(opt){var nowtype=opt.dataType;var tplUrl=TYPE_MAP[opt.dataType].cgi;return opt.dataType==_DataType.PPMS?tplUrl.replace("{#key#}",opt.param.key):tplUrl;}
function getStaticUrl(opt){var params=opt.param;var cgi=getCGI(opt);var url=cgi+(cgi.indexOf('?')>-1?'&':'?')+getParamStr(params);return url;}
function fetchData(opt,cacheKey){var func=arguments.callee,args=arguments,context=this;var params=JSON.parse(JSON.stringify(opt.param));var cbName=opt.dataType==_DataType.PPMS?opt.param.callback:JD.cgi.getCallback(TYPE_MAP[opt.dataType].cgi,params);params.callback=cbName;var cgi=getCGI(opt);var url=cgi+(cgi.indexOf('?')>-1?'&':'?')+getParamStr(params);window[cbName]=function(obj){try{if(obj.pageId&&!obj.errCode){storage.writeH5Data(cacheKey,obj,null,5);opt.cb&&opt.cb(obj);}else if(obj.errCode=="0"||obj.errcode=="0"||obj.retcode=="0"){if(!useDebug){storage.writeH5Data(cacheKey,obj,null,5);}
opt.cb&&opt.cb(obj);}else{opt.handleError&&opt.handleError(func,args,context,obj);}}catch(exp){if(useDebug){console.log('wf-data-error-begin.............');console.log(exp.message);console.log(exp.stack);console.log('..............wf-data-error-end');}
opt.handleError&&opt.handleError(func,args,context,exp);}};ls.loadScript({url:url,charset:'utf-8',onError:function(msg,url,line,col,error){var errorObj={msg:msg,url:url,line:line,col:col,error:error};opt.handleError&&opt.handleError(func,args,context,errorObj);},timeout:opt.timeout||8000,onTimeout:function(){opt.handleTimeout&&opt.handleTimeout();}});}
function getData(opt){var cacheKey,notLoadFromCache=false;if(opt.dataType==_DataType.CPC_NEW&&JD.url.getUrlParam('debugTime')){opt.param.pretime=parseInt(+new Date(JD.GLOBAL_CONFIG.NOW)/1000)}
if(!useDebug&&!notLoadFromCache){cacheKey=opt.param.cacheKey||getParamStr(opt.param,true);storage.readH5Data(cacheKey,function(res,success){if(!success||!res){fetchData(opt,cacheKey);return;}
window.setTimeout(function(){opt.cb&&opt.cb(res,true);},0);});}else{fetchData(opt,cacheKey);}}
exports.getData=function(opt){getData(opt);}
exports.getStaticUrl=function(opt){return getStaticUrl(opt);}
exports.DataType=_DataType;});
;define('numberp',function(require,exports,module){function digitLength(num){var eSplit=num.toString().split(/[eE]/);var len=(eSplit[0].split('.')[1]||'').length-(+(eSplit[1]||0));return len>0?len:0;}
function float2Fixed(num){if(num.toString().indexOf('e')===-1){return num.toString().replace('.','')*1;}
var dLen=digitLength(num);return dLen>0?num*Math.pow(10,dLen):num;}
function times(numArr){if(!numArr||numArr.length===0)return 0;if(numArr.length===1)return numArr[0];if(numArr.length>2){return times([times([numArr[0],numArr[1]])].concat(numArr.slice(2)));}
var num1=numArr[0];var num2=numArr[1];var num1Changed=float2Fixed(num1);var num2Changed=float2Fixed(num2);var baseNum=digitLength(num1)+digitLength(num2);var leftValue=num1Changed*num2Changed;return leftValue/Math.pow(10,baseNum);}
function plus(numArr){if(!numArr||numArr.length===0)return 0;if(numArr.length===1)return numArr[0];if(numArr.length>2){return plus([plus([numArr[0],numArr[1]])].concat(numArr.slice(2)));}
var num1=numArr[0];var num2=numArr[1];var baseNum=Math.pow(10,Math.max(digitLength(num1),digitLength(num2)));return(times([num1,baseNum])+times([num2,baseNum]))/baseNum;}
function minus(numArr){if(!numArr||numArr.length===0)return 0;if(numArr.length===1)return numArr[0];if(numArr.length>2){return minus([minus([numArr[0],numArr[1]])].concat(numArr.slice(2)));}
var num1=numArr[0];var num2=numArr[1];var baseNum=Math.pow(10,Math.max(digitLength(num1),digitLength(num2)));return(times([num1,baseNum])-times([num2,baseNum]))/baseNum;}
function divide(numArr){if(!numArr||numArr.length===0)return 0;if(numArr.length===1)return numArr[0];if(numArr.length>2){return divide([divide([numArr[0],numArr[1]])].concat(numArr.slice(2)));}
var num1=numArr[0];var num2=numArr[1];var num1Changed=float2Fixed(num1);var num2Changed=float2Fixed(num2);return times([(num1Changed/num2Changed),Math.pow(10,digitLength(num2)-digitLength(num1))]);}
function round(num,ratio){if(!num)return 0;ratio=ratio||0;var base=Math.pow(10,ratio);var result=divide([Math.round(times([num,base])),base]);var lackZeroLength=ratio-(result.toString().split('.')[1]||'').length;if(lackZeroLength>0){result=result.toString();if(result.indexOf('.')===-1){result+='.';}
for(var i=0;i<lackZeroLength;i++){result+='0';}}
return result.toString();}
exports.plus=plus;exports.minus=minus;exports.times=times;exports.divide=divide;exports.round=round;exports.digitLength=digitLength;exports.float2Fixed=float2Fixed;});
;define("jd.item.util",function(require,exports,module){var _cacheThisModule_,$=require('zepto'),urlParam=require('url'),itemComm=require('wq.item.common'),loopScroll=require('loopScroll'),mUtil=require('util'),cache=require('cachev1'),numberp=require('numberp'),domainStr=document.domain.split('.').slice(1).join('.'),isAndroid=$.os&&$.os&&$.os.android,network='',protocol=window.location.protocol||'http:',isJDChoice=window._itemGlobal&&window._itemGlobal.isJDChoice,judgeBuyLinkTimer=null;(function($){var o=$({});$.subscribe=function(){o.on.apply(o,arguments);};$.unsubscribe=function(){o.off.apply(o,arguments);};$.publish=function(){o.trigger.apply(o,arguments);};}($));JD&&JD.device&&JD.device.getNetwork(function(nt){network=nt;});function getNetWork(){return network;}
function formatTime(date){var addZero=function(num){return(num<10?'0':'')+num;};return{year:date.getFullYear(),month:addZero(date.getMonth()+1),day:addZero(date.getDate()),hour:addZero(date.getHours()),min:addZero(date.getMinutes()),sec:addZero(date.getSeconds())};}
function formatRemainTime(time){var addZero=function(num){return(num<10?'0':'')+num;};var hour=0,min=0,sec=0,millSec=Math.floor((time%1000)/100);time=parseInt(time,10)||0;time=Math.floor(time/1000);hour=Math.floor(time/3600);time=time-hour*3600;min=Math.floor(time/60);sec=time-min*60;return[addZero(hour),addZero(min),addZero(sec),millSec];}
function showNotice(opt){if(!opt||!opt.str)return;var iconFlag=opt.iconFlag?opt.iconFlag:0,t=opt.t?opt.t:2000,str=opt.str;var $iconDom=$('#noticeIcon');$iconDom.removeClass('icon_fail').removeClass('icon_success');switch(iconFlag){case 0:$iconDom.hide();break;case 1:$iconDom.show();$iconDom.addClass('icon_success');break;case 2:$iconDom.show();$iconDom.addClass('icon_fail');break;}
$('#noticeStr').html(str);$('#noticePanel').show();$('#noticePanel').css('margin-left','-'+($('#noticePanel').width())/2+'px');setTimeout(function(){$('#noticePanel').hide();},t);}
function setDelayTime(){window.holdAction=true;setTimeout(function(){window.holdAction=false;},400);}
var imageViewer={lockScrollH:0,hasBindEvent:false,blackCoverShow:false,toggleBlackCover:function(show){var obj=this;obj.blackCoverShow=show;var $body=$(document.body),bodyFixed=$body.hasClass('overflowHide');if(show){obj.lockScrollH=bodyFixed?(popUp&&popUp.mainViewScroll):$(window).scrollTop();$('#blackCover').show();window.location.hash='#img';if(obj.hasBindHashEvent)return;$(window).on('hashchange',function(){if(window.location.hash!='#img'){obj.closeImagePreview();}});obj.hasBindHashEvent=true;}else{$('#blackCover').hide();setTimeout(function(){bodyFixed?$body.css('top',-1*obj.lockScrollH):window.scrollTo(0,obj.lockScrollH);},10);}},previewImage:function(src){if(!src)return;var obj=this;if(~domainStr.indexOf('jd.com')&&window.WeixinJSBridge&&window.location.hash!='#img'){try{src=(src.indexOf('http')>-1?'':protocol)+src;window.WeixinJSBridge.invoke('imagePreview',{'current':src,'urls':[src]});}catch(e){}}else{obj.toggleBlackCover(true);$('#fullImg').attr('src',src);$('#imageViewer').show();if(obj.hasBindImagePreviewEvent)return;$('#imageViewer,#fullImg,#blackCover').on('click',function(){window.history.go(-1);});$('body').on('touchend',function(e){var target=e.srcElement||e.target,em=target,i=1;while(em&&!em.id&&i<=3){em=em.parentNode;i++;}
if(!em||!em.id)return;if(em.id=='imageViewer'||em.id=='fullImg'||em.id=='blackCover'){e.preventDefault();window.history.go(-1);}});obj.hasBindImagePreviewEvent=true;}},closeImagePreview:function(){var obj=this;obj.toggleBlackCover(false);$('#fullImg').attr('src','');$('#imageViewer').hide();$('#evalLoopImg').hide();},loopImagesPreview:function(opt){var obj=this;var imgList=opt.imgList||[],curIndex=opt.curIndex||1;if(~domainStr.indexOf('jd.com')&&window.WeixinJSBridge&&window.location.hash!='#img'){var loopImg=[];for(var i=0,len=imgList.length;i<len;i++){loopImg.push((imgList[i].indexOf('http')>-1?'':protocol)+imgList[i]);}
window.WeixinJSBridge.invoke('imagePreview',{'current':loopImg[curIndex-1],'urls':loopImg});}else{var _wb=document.body.clientWidth,tpl='<div class="mod_slider mod_slider_s1 mod_slider_viewer" id="evalLoopImg" style="height:'+_wb+'px;">'
+'<div class="inner">'
+'<ul class="pic_list" id="evalLoopImgUl">'
+'{#loopImgLi#}'
+'</ul>'
+'</div>'
+'<div class="bar_wrap">'
+'<ul class="bar" id="evalLoopImgBar"></ul>'
+'</div>'
+'<div class="decoration" style="display:none;">'
+'<div class="text_wrap"></div>'
+'<div class="remind"></div>'
+'</div>'
+'</div>',loopImgLiArr=[],html='',$loopImg=$('#evalLoopImg'),$loopImgUl=$('#evalLoopImgUl');if(imgList.length>0){imgList.forEach(function(imgPath){loopImgLiArr.push('<li style="height:'+_wb+'px;width:'+_wb+'px"><img src="'+imgPath+'" onerror="__reloadResource(this)"></li>');});html=itemComm.jsonToTpl({loopImgLi:loopImgLiArr.join('')},tpl);if($loopImg.length&&$loopImgUl.length){$loopImgUl.attr('style','');$loopImgUl.html(loopImgLiArr.join(''));$loopImg.show();}else{$('#imageViewer').after(html);$loopImg=$('#evalLoopImg');}
obj.toggleBlackCover(true);}
loopScroll.init({tp:'img',viewDom:$('#evalLoopImgUl li').eq(0),len:imgList.length,loadImg:true,moveDom:$('#evalLoopImgUl'),moveChild:$('#evalLoopImgUl li'),tab:$('#evalLoopImgBar li'),loopScroll:false,lockScrY:true,imgInitLazy:1000,index:curIndex});$loopImg.off().on('click',function(event){event.preventDefault&&event.preventDefault();event.stopPropagation&&event.stopPropagation();window.history.go(-1);});}}};var popUp={popupshow:false,popupBody:{},$domCache:{},setPopupBody:function(key,value){if(!key)return;this.popupBody[key]=value;},createPopup:function(opt){var flag=opt.flag,stopMove=opt.stopMove,msg=opt.msg,noCoverEvent=opt.noCoverEvent,priceVerifyImg=opt.priceVerifyImg,startY=0,endY=0,moveY=0,stopMoveFun=function(e){var touch,touchDirection='',shouldPrevent=false;if(e.type==='touchstart'){touch=e.touches[0];startY=Math.floor(touch.pageY);}else if(e.type==='touchmove'){touch=e.touches[0];endY=Math.floor(touch.pageY);moveY=endY-startY;if(moveY>0){touchDirection='down';}else if(moveY<0){touchDirection='up'}}
if(e.target.id!=='fxRuleContainer'&&e.target.classList.value!=='btn btn_1'){shouldPrevent=true;}else{var stp=e.target.scrollTop,cht=e.target.clientHeight,sht=e.target.scrollHeight;if(numberp.plus([stp,cht])===sht&&touchDirection==='up'){shouldPrevent=true;}else if(stp===0&&touchDirection==='down'){shouldPrevent=true;}else{shouldPrevent=false;}}
if(shouldPrevent){e.preventDefault();}},btnClose=false,btnConfirm=false,btnCancel=false,btnFavGood=false,btnEvent=function(){setDelayTime();$('#modAlertDiv,#modAlertMask').hide().removeClass(' mod_alert_info show fixed');if(stopMove){document.removeEventListener('touchmove',stopMoveFun,{passive:false});document.removeEventListener('touchstart',stopMoveFun,{passive:false});}};if(!$('#modAlertDiv').length){$('body').append('<div id="modAlertDiv" class="mod_alert" style="display: none;"></div><div id="modAlertMask" class="mod_alert_mask" style="display: none;"></div>');}
var $el=$('#modAlertDiv'),$cover=$('#modAlertMask');switch(flag){case 1:$el.html('<i class="icon"></i><p><br>~</p><div class="follow"><img src="'+JD.img.getImgUrl('//img11.360buyimg.com/jdphoto/s280x280_jfs/t3469/354/312631197/5626/21e9275b/5806d31eN2884548b.png',180,180)+'" alt=""><p class="text"></p></div>');break;case 2:$el.addClass('mod_alert_info');$el.html('<span class="close"></span><h3 class="title">'+opt.title+'</h3><div class="inner">'+opt.msg+'</div>'+(opt.btnTxt?('<p class="btns"><a href="javascript:void(0);" class="btn btn_1">'+opt.btnTxt+'</a></p>'):''));btnClose='span.close';if(opt.btnTxt){btnConfirm='p.btns';}
break;case 3:if(opt.isNeedInfo)$el.addClass('mod_alert_info');$el.html('<p>'+msg+'</p><p class="btns"><a href="javascript:void(0);" class="btn btn_1">'+(opt.btnTxt||'')+'</a></p>');btnConfirm='p.btns';break;case 4:$el.html((opt.icon!='none'?('<i class="icon'+(opt.icon!='info'?(' icon_'+opt.icon):'')+'"></i>'):'')+'<p>'+msg+'</p>'+(opt.small?'<p class="small">'+opt.small+'</p>':'')+'<p class="btns"><a href="javascript:;" class="btn btn_2">'+opt.cancelText+'</a><a href="javascript:;" class="btn btn_1">'+opt.okText+'</a></p>');btnConfirm='a.btn_1';btnCancel='a.btn_2';break;case 5:msg='<i class="icon"></i><p>'+msg+'</p><div class="verify_input"><input class="input" type="text" id="verifyInput"><span class="wrap"><img src="'+(priceVerifyImg||'//fpoimg.com/75x30')+'" alt="" id="verifyCodeImg"></span></div><p class="warn_text" id="warnTip"></p>';$el.html(msg+'<p class="btns"><a href="javascript:void(0);" class="btn btn_1"></a></p>');break;case 6:$el.html('<span class="close"></span><i class="icon"></i><p>'+msg+'</p><p class="small">'+opt.small+'</p><p class="btns">'+'<a href="javascript:void(0);" class="btn" style="background: #e4393c;color: #fff">'+opt.btnTxt+'</a></p>');btnClose='span.close';btnConfirm='p.btns';break;case 7:$el.addClass('mod_alert_info');$el.html('<span class="close"></span><h3 class="title"></h3><div class="verify_inputs"><div class="verify_input"><input class="input" type="tel" mark="phonenum" placeholder="" maxlength="11"></div><div class="verify_input"><input class="input" mark="imgcode" type="text" placeholder=""><span class="wrap" mark="genimgcode"><img mark="img"/></span></div><div class="verify_input"><input class="input" mark="msgcode" type="text" placeholder=""><div class="verify_input_btn" mark="sendcode"></div><div class="verify_input_btn type_disabled" style="display:none;"><span mark="sendcodesed"></span></div></div></div><p class="warn_text" style="display:none;" mark="errtips"></p><p class="btns"><a href="javascript:" class="btn btn_1"></a></p>');btnClose='span.close';btnConfirm='p.btns';break;case 8:$el.addClass('mod_alert_info');$el.html('<span class="close"></span><h3 class="title"></h3><p class="alignLeft"></p><div class="verify_input type_no_padding"><input class="input" mark="shname" type="text" placeholder=""></div><p class="warn_text" style="display:none;" mark="errtips"></p><p class="btns"><a href="javascript:" class="btn btn_1"></a></p>');btnClose='span.close';btnConfirm='p.btns';break;case 9:$el.addClass('mod_alert_info');$el.html('<h3 class="title"></h3><p class="alignLeft" style="font-size:14px;"></p><div class="verify_input type_no_padding"><input class="input" mark="phoneNum" type="text" placeholder=""></div><p class="warn_text" style="display:none;" mark="errtips"></p><p class="btns"><a href="javascript:;" class="btn btn_2"></a><a href="javascript:;" class="btn btn_1"></a></p>');btnConfirm='a.btn_1';btnCancel='a.btn_2';break;case 10:$el.addClass('mod_alert_info');$el.html('<h3 class="title"></h3><p class="alignLeft" style="font-size:14px;">90</p><div class="verify_input type_no_padding"><input class="input" mark="price" type="number" placeholder=""></div><p class="warn_text" style="display:none;" mark="errtips1"></p><div class="verify_input type_no_padding"><input class="input" mark="phoneNum" type="text" placeholder=""></div><p class="warn_text" style="display:none;" mark="errtips2"></p><p class="btns"><a href="javascript:;" class="btn btn_2"></a><a href="javascript:;" class="btn btn_1"></a></p>');btnConfirm='a.btn_1';btnCancel='a.btn_2';break;case 11:$el.addClass('mod_alert_info');$el.html('<h3 class="title" style="margin-bottom:12px;">'+opt.title+'</h3><p class="alignLeft" style="font-size:14px;">'+opt.msg+'</p><p class="btns" style="margin-top:12px;"><a href="javascript:;" class="btn btn_1"></a></p>');btnConfirm='a.btn_1';break;case 12:$el.addClass('mod_alert_info');var htmlStr='<h3 class="title">?</h3>'+'<p class="alignLeft">'+opt.msg+'</p>'+'<p class="btns">'+'<a href="javascript:;" class="btn btn_2"></a>'+'<a href="javascript:;" class="btn btn_1"></a>'+'</p>';btnCancel='a.btn_1';btnConfirm='a.btn_2';$el.html(htmlStr);break;case 13:$el.addClass('mod_alert_info');var htmlStr='<h3 class="title">'+(opt.title||'')+'</h3>'+'<div class="inner">'+'<dl>'+'<dt>'+opt.msg+'</dt>'+'</dl>'+
(opt.showFav?'<div class="checkbox_line checked" id="jxappFavGood">APP</div>':'')+'</div>'+'<div class="btns">'+'<a href="#" class="btn btn_1">'+(opt.cancelText||'')+'</a>'+'</div>';btnCancel='a.btn_1';btnFavGood=opt.showFav?'.checkbox_line':'';$el.html(htmlStr);}
setTimeout(function(){$el.show().addClass('show fixed');$cover.show().addClass('show fixed');},isAndroid?100:400);$el.off();if(btnClose){$el.on('click',btnClose,function(){btnEvent();opt.onClose&&opt.onClose();});}
if(btnConfirm){$el.on('click',btnConfirm,function(){var keep=false;if(opt.onConfirm){keep=!!opt.onConfirm();}
if(keep)return;btnEvent();});}
if(btnFavGood){$el.on('click',btnFavGood,function(){opt.onFavGood&&opt.onFavGood();});}
if(btnCancel){$el.on('click',btnCancel,function(){btnEvent();opt.onCancel&&opt.onCancel();});}
if(!noCoverEvent){$cover.off().on('click',function(){btnEvent();opt.onClose&&opt.onClose();});}
if(stopMove){document.addEventListener('touchmove',stopMoveFun,{passive:false});document.addEventListener('touchstart',stopMoveFun,{passive:false});}},createPopDom:function(opt){if(!opt)return;var obj=this,className=opt.className,btnTxt=opt.btnTxt||'',newChoice=(opt.isSku?opt.skuId+className:className);var $el=$('#popupDom'),$popBody=$el.find('div.body');obj.popupBody.lastChoice=newChoice;var setDom=function(){$el=$('#popupDom');$popBody=$el.find('div.body');var $main=$el.find('.main');var closeEvent=function(tar){if(tar.hasClass('mod_btns')){opt.onConfirm&&opt.onConfirm();if(!opt.needConfirm)obj.showHidePopup($el);}else{opt.onCancel&&opt.onCancel();obj.showHidePopup($el);}};$el.off().on('click',function(){closeEvent($(this));});$main.off().on('click',function(event){event.stopPropagation&&event.stopPropagation();});$main.on('click','i.close,i.close_sp,div.mod_btns',function(){closeEvent($(this));});if(opt.isPresent){$main.on('click','.de_pm_list',function(){var url=$(this).attr('tourl'),urlReg=/^(https*:){0,1}\/\//;if(urlReg.test(url)){window.location.href=url;}});}
$el.attr('class',className);var $btn=$el.find('div.mod_btns');if(~className.indexOf('detail_promote_B_main')){$btn.hide();}
else if(btnTxt){$btn.show().find('div.mod_btn').text(btnTxt);}else{$btn.hide();}
$el.find('div.header').html(opt.title+'<i class='+(opt.closeClass||'close')+'></i>');$popBody.html(opt.body||'');obj.showHidePopup($el,true);};if(!$el.length){$('body').append('<div id="popupDom"><div class="main"><div class="header"><i class="close"></i></div><div class="body"></div><div class="mod_btns"><div class="mod_btn bg_1"'+(isJDChoice?'style="background-color: #c19b47;"':'')+'></div></div></div>');$el=$('#popupDom');}
if(className=='detail_ease_service_main'){$el.find('.mod_btn.bg_1').removeClass('bg_1');}else{$el.find('.mod_btn').addClass('bg_1');}
setDom();},setPopupArea:function(sellWhilePresell,priceObj){this.sellWhilePresell=sellWhilePresell;this.priceObj=priceObj;},showPopupArea:function(flag){this.showHidePopup($('#popupBuyArea'),true);$('#popupBuyArea').attr('type',flag||0);JD.events.trigger('item.util.showPopupArea');window.wa&&window.wa('ptagExposure',{ptag:'7001.1.234'});var yuyuePricePair=[],jdPricePair=[];if(this.priceObj){yuyuePricePair=this.priceObj.yuyuePrice&&this.priceObj.yuyuePrice.split('.');jdPricePair=this.priceObj.jdPrice&&this.priceObj.jdPrice.split('.');}
if(flag=='1'||flag=='2'){$('#buyBtn1').parent().removeClass('show').hide();$('#popupConfirm').attr('tag',flag).parent().addClass('show').show();reporter.reportExposure({ptag:'7001.11.4'});if(window.isPingouScene||isJDChoice)return;$('#priceSale2').show();$('#sellWhilePresellPrice').remove();if(this.sellWhilePresell){if(flag=='1'){$('#priceSale2').html('&yen;<em>'+jdPricePair[0]+'</em>.'+jdPricePair[1]);$('#popupDoublePrice').show();$('#popupConfirm').text('').removeClass('red').addClass('yellow');}else{$('#priceSale2').html('&yen;<em>'+yuyuePricePair[0]+'</em>.'+yuyuePricePair[1]);$('#popupDoublePrice').hide();$('#popupConfirm').text('').removeClass('yellow').addClass('red');}}else{$('#popupConfirm').text('').removeClass('yellow').addClass('red');}}else if(flag=='3'){$('#buyBtn1').parent().removeClass('show').hide();$('#popupConfirm').attr('tag','0').parent().removeClass('show').hide();$('#popupNotice').hide();$('#storePopupConfirm').parent().addClass('show').show();}else{$('#buyBtn1').parent().addClass('show').show();if(flag=='5'){$('#popupConfirm').attr('tag',flag).parent().removeClass('show').hide();}else{$('#popupConfirm').attr('tag','0').parent().removeClass('show').hide();}
$('#storePopupConfirm').parent().removeClass('show').hide();if(window.isPingouScene||isJDChoice)return;if(this.sellWhilePresell&&this.priceObj){$('#priceSale2').hide();$('#popupDoublePrice').hide();if(!$('#sellWhilePresellPrice').length)$('#priceSale2').after('<div class="double_price" id="sellWhilePresellPrice"><div class="price_main">&yen;<em>'+yuyuePricePair[0]+'</em>.'+yuyuePricePair[1]+'</div><div class="price_sub"><span class="txt"></span>&yen;'+this.priceObj.jdPrice+'</div></div>');}else{$('#priceSale2').show();$('#popupDoublePrice').show();$('#sellWhilePresellPrice').remove();}}},showHidePopup:function($dom,flag){var obj=this;if(flag){this.mainViewScroll=$(window).scrollTop();$dom.show();setTimeout(function(){$dom.addClass('show');$('body').css('top','-'+$(window).scrollTop()+'px').addClass('overflowHide');obj.popupshow=true;},50);}else{setDelayTime();$dom.removeClass('show');$('body').removeClass('overflowHide').css('top','0');window.scrollTo(0,this.mainViewScroll);setTimeout(function(){$dom.hide();},50);obj.popupshow=false;}},replaceDom:function(opt){if(!opt)return;var obj=this,$old=opt.$old,$new='',oldKey=opt.oldKey,newKey=opt.newKey;if($old.length&&oldKey&&newKey){if(!obj.$domCache[oldKey]){obj.$domCache[oldKey]=$old;}
$new=obj.$domCache[newKey];var hasNew=false;if($new&&$new.length){$old.replaceWith($new);hasNew=true;}else{$new=$old.clone();$old.replaceWith($new);hasNew=false;}
opt.cb&&opt.cb(hasNew);}}};var umpMonitor={bizid:'',cgiTimeout:4000,timeout:{},setBizid:function(bizid){this.bizid=bizid;},report:function(config){if(!config)return;config.bizid=this.bizid;JD.report.umpBiz(config);},delTimeout:function(key,msg){var obj=this;if(obj.timeout[key]){clearTimeout(obj.timeout[key]);obj.timeout[key]=null;if(msg){var operation=key.replace('itil','');JD.report.umpBiz({bizid:obj.bizid,operation:operation,result:'0',source:'0',message:msg});}}},createTimeout:function(operationNo,msg,timeout,callback){var obj=this;var itilStr='itil'+operationNo;obj.delTimeout(itilStr);obj.timeout[itilStr]=setTimeout(function(){JD.report.umpBiz({bizid:obj.bizid,operation:operationNo,result:'1',source:'0',message:msg});callback&&callback();},timeout||obj.cgiTimeout);}};var reporter={isPgScene:false,isJDChoice:'',koStatus:0,baseSkuId:'',skuId:'',isZiying:false,jdCategory:[],jdPrice:0,venderName:'',venderId:'',brandName:'',brandId:'',jdAddrId:'',pTag:'',itemType:window.isPingouScene?'1':'',jdPvLogobj:{category:'',sku_change:'0'},txPvLogobj:{pv_type:'0',scn_type:'3'},init:function(config){var obj=this;$.extend(obj,config);obj.reportPV();},setItemType:function(value){var obj=this;obj.item_type=value;obj.jdPvLogobj.item_type=value;},setJdPvLogobj:function(key,value){var obj=this;if(!key)return;obj.jdPvLogobj[key]=value;},reportPV:function(){var obj=this,dapeiId=urlParam.getUrlParam('dapeiid');obj.jdPvLogobj.sku_id=obj.skuId;obj.jdPvLogobj.area=obj.jdAddrId.join('|');obj.jdPvLogobj.leaf=obj.jdCategory.join('_');obj.jdPvLogobj.vender_id=obj.venderId;obj.jdPvLogobj.isJX=(obj.isJDChoice?'1':'0');obj.jdPvLogobj.isQianggou=(obj.koStatus>0?'1':'0');if(obj.jdPvLogobj.sku&&~obj.jdPvLogobj.sku.indexOf('|')){var skuArr=obj.jdPvLogobj.sku.split('|');skuArr[1]=obj.jdPrice;obj.jdPvLogobj.sku=skuArr.join('|');}
if(dapeiId)obj.jdPvLogobj.dapeiid=dapeiId;if(obj.pTag)obj.jdPvLogobj.ptag_id=obj.pTag+'';window.wa&&window.wa('jdPv',obj.jdPvLogobj);obj.jdPvLogobj.sku_change='1';if(window.isMScene){if(!window.MPing)return;var pv=new MPing.inputs.PV();if(pv&&obj.isPgScene)pv.page_param='pingou';if(pv)pv.sku=obj.skuId;var mping=new MPing();mping.send(pv);MPing.inputs.Click.attachEvent();}else{obj.txReport({isPV:true});}},txReport:function(opt){opt=opt||{};var obj=this,ptag=opt.ptag,isPV=opt.isPV,skuId=opt.skuId||obj.skuId;if(isPV){$.extend(obj.txPvLogobj,{detail_sku:skuId,detail_baseSku:obj.baseSkuId,detail_ispop:(obj.isZiying?'0':'1'),detail_cid:obj.jdCategory.slice(0,3).join('_'),detail_price:obj.jdPrice,detail_brand:(obj.brandName||'')+'_'+(obj.brandId||''),detail_vendor:(obj.venderName||'')+'_'+(obj.venderId||'')});obj.txPvLogobj.detail_action='';try{window.wa&&window.wa('tencent.send','pv',obj.txPvLogobj);obj.txPvLogobj.pv_type='1';window.wa&&window.wa('reportToWeixin',{scn_type:3,detail_sku:''+skuId,detail_ispop:(obj.isZiying?0:1),detail_cid:obj.jdCategory.slice(0,3).join('_'),detail_price:parseFloat(obj.jdPrice),detail_vendor:(obj.venderName||'')+'_'+(obj.venderId||''),ddetail_baseSku:''+obj.baseSkuId});}catch(e){}}else{try{if(!opt.noJd&&window.wa){obj.reports({sku_id:skuId,vender_id:obj.venderId||'',ptag:ptag,isJX:(obj.isJDChoice?'1':'0')})}
if(!window.isMScene){obj.txPvLogobj.detail_action=ptag;window.wa&&window.wa('tencent.send','click',obj.txPvLogobj);}}catch(e){}}},reports:function(opt){var obj=this;if(window.wa&&opt&&opt.ptag){if(obj.item_type)opt.item_type=obj.item_type;if(obj.skuId)opt.sku_id=obj.skuId;window.wa('jdClick',opt);}},reportExposure:function(opt){var obj=this;if(window.wa&&opt&&opt.ptag){if(obj.item_type)opt.item_type=obj.item_type;if(obj.skuId)opt.sku_id=obj.skuId;window.wa('ptagExposure',opt);}},pingClick:function(report_eventid,report_eventparam,report_eventlevel,report_pageparam){if(!window.isMScene)return;if(!window.MPing)return;try{var click=new MPing.inputs.Click(report_eventid);click.event_param=report_eventparam||'';click.event_level=report_eventlevel||'';click.page_param=report_pageparam||'';var mping=new MPing();mping.send(click);}catch(e){}},pingAddClick:function(report_eventid,report_eventparam,report_eventlevel,report_pageparam){if(!window.isMScene)return;if(!window.MPing)return;try{var cart=new MPing.inputs.AddCart(report_eventid,report_pageparam);cart.event_param=report_eventparam||'';cart.event_level=report_eventlevel||'';cart.page_param=report_pageparam||'';var mping=new MPing();mping.send(cart);}catch(e){}}};function $jsonToTpl(json,tpl){var outStr='';try{outStr=(tpl||'').replace(/{#(\w+)#}/g,function(a,b){return json[b]===0?'0':(json[b]||"");});}catch(e){}
return outStr;}
function getAppWebviewUrl(url,type){if(JD&&JD.device&&JD.device.scene=='jdapp'){url='openapp.jdmobile://virtual?params={"des":"m","category":"jump","url":"https:'+JD.url.addUrlParam(url,{'jdshwkon':'1'})+'"}';switch(type){case'cart':url='openapp.jdmobile://virtual?params={"des":"cartB","category":"jump","sourceValue":"","sourceType":""}';break;}}
return url;}
function getImgUrl(jfsimg,size){var url='//m.360buyimg.com/mobilecms/s'+(size?size:'750x750')+'_'+jfsimg;if(/2g|3g/i.test(network)){url=JD.img.getImgUrl(url,'','','','!q50');}else{url=JD.img.getImgUrl(url,'','','','!q80');}
return url;}
function getMyLocation(callback){if(cache.getItem('getLocationFailFlag',true)){callback&&callback({});return;}
mUtil.getMyLocation(function(item){if(item&&item.latitude&&item.longitude){callback&&callback(item);}
else{callback&&callback({});cache.setItem('getLocationFailFlag',1,true,7*24*3600);}});}
function jumpMap(coords,name,addr){if(!coords){return;}
var latitude,longitude,_coords,mapurl,tmp;_coords=coords.split(',');latitude=_coords[0]-0;longitude=_coords[1]-0;if(latitude>longitude){tmp=latitude;latitude=longitude;longitude=tmp;}
if(navigator.userAgent.indexOf('MicroMessenger')>0){JD.wxapi&&JD.wxapi.ready&&JD.wxapi.ready(function(config){config.beta=true;wx.openLocation({latitude:latitude,longitude:longitude,name:name,address:addr,scale:15,infoUrl:''});});}else if(/qq\/([\d\.]+)*/.test(navigator.userAgent.toLowerCase())){mapurl='//apis.map.qq.com/tools/poimarker?marker=coord:'+latitude+','+longitude+';title:'+name+';addr:'+addr+'&referer=myapp&key=AEXBZ-2MUKJ-YSVF6-KIYLB-44AA3-3QFEK';window.mqq&&window.mqq.ui&&window.mqq.ui.openUrl&&window.mqq.ui.openUrl({'url':mapurl,'target':1,'style':1,'animation':0});}}
function judgeBuyLink(url,callback){if(!JD||!JD.device||JD.device.scene!='weixin'){callback(url,false);return;}
judgeBuyLinkTimer&&window.clearTimeout(judgeBuyLinkTimer);judgeBuyLinkTimer=window.setTimeout(function(){callback(url,false);},500);JD.wxapp&&JD.wxapp.isWxapp(function(iswxapp){judgeBuyLinkTimer&&window.clearTimeout(judgeBuyLinkTimer);if(iswxapp){var turl=JD.wxapp.transform.buy(url);if(turl){var pluginName=JD.url.getUrlParam('pluginName')||'';var isMainWxapp=JD.wxapp&&(JD.wxapp.wxappType==0||JD.wxapp.wxappType==1);var isPgWxapp=JD.wxapp&&JD.wxapp.wxappType==2;var isGwqWxapp=JD.wxapp&&JD.wxapp.wxappType==9;if(pluginName&&pluginName=='jd@plugin-wxapp'){turl=turl.replace(JD.wxapp.urls.buy,'plugin://'+pluginName+'/pay');callback(turl,true);}else if(isMainWxapp||isPgWxapp){callback(turl,true);}else{callback(url,false);}}else{callback(url,false);}}else{callback(url,false);}});}
function isObject(obj){return Object.prototype.toString.call(obj)==='[object Object]';}
function fuzzyNum(num){num=parseInt(num);if(num>99999999){num=+(parseFloat(num/10000).toFixed(1))+''}else if(num>9999){num=+(parseFloat(num/10000).toFixed(1))+''}
return num;}
function setSpecTime(time,curDay,isMillisecond){var timesNum=isMillisecond?1:1000;if(time-curDay>24*3600*1000/timesNum)return;time=time*timesNum;if(isNaN(time)||time<=0){return;}
var addZero=function(num){return(num*1<10?'0':'')+num;}
var today=new Date(curDay*timesNum).setHours(23,59,59,59),setDay=new Date(time).setHours(23,59,59,59),sethour=new Date(time).getHours(),setminutes=new Date(time).getMinutes(),dayStr='';if(today===setDay){dayStr+='';}else if(today<setDay){dayStr+='';}else{return false;}
return dayStr+addZero(sethour)+':'+addZero(setminutes);}
function isNum(s){if(s!=null){var re=/\d*/i
var r=s.match(re)
return(r==s)}
return false}
exports.getNetWork=getNetWork;exports.formatTime=formatTime;exports.formatRemainTime=formatRemainTime;exports.showNotice=showNotice;exports.setDelayTime=setDelayTime;exports.imageViewer=imageViewer;exports.popUp=popUp;exports.umpMonitor=umpMonitor;exports.reporter=reporter;exports.$jsonToTpl=$jsonToTpl;exports.getAppWebviewUrl=getAppWebviewUrl;exports.getImgUrl=getImgUrl;exports.getMyLocation=getMyLocation;exports.jumpMap=jumpMap;exports.judgeBuyLink=judgeBuyLink;exports.isObject=isObject;exports.fuzzyNum=fuzzyNum;exports.setSpecTime=setSpecTime;exports.isNum=isNum;});
;define("m.item.common",function(require,exports,module){var _cacheThisModule_,$=require('zepto'),util=require('util'),cookie=require('cookie'),mWfdata=require('wfdata'),itemUtil=require('jd.item.util'),gVar={wikiInfo:null};function setWiki(obj,category){$('#wiki').hide();if(!category)return;window.showPageData33684=function(json){if(!json.data||!json.data.length)return;gVar.wikiInfo=json;var wikiData;json.data.forEach(function(item,index){if(item.ppms_itemName==''){wikiData=item.news;}});wikiData&&wikiData.forEach(function(item,index){if(item.pcateid==category&&item.desc&&item.views){$('#wiki p').html(''+item.desc);$('#wiki span').html(item.views+'');$('#wiki').show();$('#wiki').on('click',function(){itemUtil.reporter.pingClick('MProductdetail_Encyclopedia','','',obj.skuId);setTimeout(function(){location.href=item.link;},200);});}});};if(gVar.wikiInfo){window.showPageData33684(gVar.wikiInfo);return;}
mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v33684'}});}
function jumpToWQ(obj){var isWX=util.isWX(),isSQ=util.isSQ();if(!isWX&&!isSQ)return;var jdzt=cookie.get('_jdzt'),isAd=(jdzt=='zt_rtb'||jdzt=='zt_jt');if(!isAd)return;if(obj.isOnlineService||obj.isXnkq||obj.isCzGoods||obj.zyTravel||obj.isSxdzq||obj.isOilCard)return;var jda=cookie.get('__jda')||'',arr=jda.split('.');location.href='//wqitem.jd.com/item/view?sku='+obj.skuId+'&scan_orig=mad.item&ptag='+(isWX?'17047.13.1':'17051.6.3')+'&Msxzwq='+(arr[1]||'')+'&'+window.location.search.substring(1);}
exports.setWiki=setWiki;exports.jumpToWQ=jumpToWQ;});
;define('wq.lib.regionReport',function(require,exports,module){var _cacheThisModule_;exports.report=function(opt){var wq_area=JD.cookie.get("wq_area");var url='//fd.3.cn/cesu_div/r?bid='+opt.bid+'&ip=&time='+~~(new Date().getTime()/1000)+'&num=1&v1=&v2='+'&wq_area='+encodeURIComponent(wq_area);console.log("_REGIONPV>>",decodeURIComponent(url));var _rName='_REGIONPV'+Math.random();window[_rName]=new Image();window[_rName].src=url;}});
;define("wq.skuImgPrice",function(require,exports,module){var _cacheThisModule_,mLs=require('loadJs'),isWX=/micromessenger(\/[\d\.]+)*/.test(navigator.userAgent.toLowerCase()),addinfo=getAddrInfo(),jdAddrId=addinfo.id,jdAddrName=addinfo.name,cgiUrl={price:'//pe.3.cn/prices/pcpmgets?',imgTitle:'//yx.3.cn/service/info.action?'};function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]).replace(/(^")|("$)/g,""):""):null;}
function getAddrInfo(){var wq_addr=(getCookie('wq_addr')||'').split('|'),fourStr=function(str,flag){if(!str)return'';var arr=str.split('_');for(var i=0;i<4;i++){arr[i]=arr[i]||flag;}
arr=arr.slice(0,4);return arr.join('_');};if(wq_addr.length>4){var wq_detail=wq_addr.slice(3);wq_addr[3]=wq_detail.join('|');}
wq_addr=wq_addr.slice(0,4);if(wq_addr.length!=4)wq_addr=[];return{addrId:wq_addr[0]||'0',addrName:wq_addr[3]||'',id:fourStr(wq_addr[1]||getCookie('jdAddrId'),'0')||'19_1607_3155_0',name:fourStr(wq_addr[2]||getCookie('jdAddrName'),'')||'___'};}
function getImgTitleBySkus(opt){opt=opt||{};var skus=opt.skus,imgIndex=opt.imgIndex,callback=opt.callback,skusImgTitle=[],cbKey='imgTitleBySkusCB',u_source=opt.u_source||'wxsqpage',abortRequset=false;while(window[cbKey]){cbKey+='Az';}
window[cbKey]=function(json){if(abortRequset)return;if(json){for(var skuId in json){skusImgTitle.push({sku:skuId,img:imgIndex?'//img10.360buyimg.com/n'+imgIndex+'/'+json[skuId].imagePath:json[skuId].imagePath,title:json[skuId].name});}
callback&&callback(skusImgTitle);}};mLs.loadScript({url:cgiUrl.imgTitle+'callback='+cbKey+'&u_source='+u_source+'&ids='+skus+'&area='+jdAddrId+'&origin='+(isWX?5:4)+'&t='+Math.random(),timeout:opt.timeout||8000,onError:function(){opt.onError&&opt.onError();},onTimeout:function(){abortRequset=true;opt.onTimeout&&opt.onTimeout();}});}
function getPriceBySkus(opt){opt=opt||{};var skus=opt.skus,callback=opt.callback,iitem={},skusPrice=[],cbKey='priceBySkusCB',ext=opt.ext||'',abortRequset=false;while(window[cbKey]){cbKey+='Az';}
window[cbKey]=function(json){if(abortRequset)return;if(json){for(var i=0,leni=json.length;i<leni;i++){iitem=json[i];skusPrice.push({sku:iitem.id,price:iitem.p,marketPrice:iitem.m,pcPrice:iitem.pcp||'',np:iitem.np});}
callback&&callback(skusPrice);}};mLs.loadScript({url:cgiUrl.price+'callback='+cbKey+'&source='+(opt.source?opt.source:'wxsq')+(ext?('&ext='+ext):'')+'&skuids='+skus+'&area='+jdAddrId+'&origin='+(isWX?5:4)+'&t='+Math.random(),timeout:opt.timeout||8000,onError:function(){opt.onError&&opt.onError();},onTimeout:function(){abortRequset=true;opt.onTimeout&&opt.onTimeout();}});}
function getImgTitlePriceBySkus(opt){var skusImgTitle=null,skusPrice=null,callback=opt.callback,imgTitlePriceCB=function(){if(skusImgTitle&&skusPrice){for(var i=0,leni=skusImgTitle.length;i<leni;i++){for(var j=0,lenj=skusPrice.length;j<lenj;j++){if(skusImgTitle[i].sku==skusPrice[j].sku){skusImgTitle[i].price=skusPrice[j].price;skusImgTitle[i].marketPrice=skusPrice[j].marketPrice;skusImgTitle[i].pcPrice=skusPrice[j].pcPrice;}}}
callback&&callback(skusImgTitle);}};getImgTitleBySkus({skus:opt.skus,timeout:opt.timeout,onTimeout:opt.onTimeout4ImgTitle,onError:opt.onError4ImgTitle,imgIndex:opt.imgIndex,callback:function(d){skusImgTitle=d;imgTitlePriceCB();}});getPriceBySkus({skus:opt.skus,timeout:opt.timeout,onTimeout:opt.onTimeout4Price,onError:opt.onError4Price,callback:function(d){skusPrice=d;imgTitlePriceCB();}});}
exports.jdAddrId=jdAddrId;exports.jdAddrName=jdAddrName;exports.getImgTitleBySkus=getImgTitleBySkus;exports.getPriceBySkus=getPriceBySkus;exports.getImgTitlePriceBySkus=getImgTitlePriceBySkus;});
;define("report",function(require,exports,module){var _cacheThisModule_;var REPORT_VERSON='1.1',goodsExposureList=[],logJSONList=[];function extend(target,source){for(var key in source){target[key]=source[key];}}
function $getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]):""):null;}
function pvReport(bjInfo,szInfo){try{window.MANUAL_PV=true;if(!bjInfo){return;}
if(!(window.ECC_cloud_report_pv&&FOOTDETECT&&FOOTDETECT.objMsgPv)){setTimeout(function(){pvReport(bjInfo,szInfo);},50);return;}
var objData={};extend(objData,FOOTDETECT.objMsgPv||{});if(bjInfo.vurl){if(bjInfo.vurl.indexOf("http")==-1){bjInfo.vurl=window.location.protocol+bjInfo.vurl;}
extend(objData,bjInfo);window._vurl=bjInfo.vurl;ECC.cloud.report.pvPortal(objData);}else{if(szInfo){window.jdPvLog(bjInfo);extend(objData,szInfo);ECC.cloud.report.pv(objData);}else{window.jdPvLog(bjInfo);extend(objData,bjInfo);ECC.cloud.report.pv(objData);}}}catch(e){}}
function pvPortal(vurl){if(typeof vurl!='string'){return;}
var ptag=/[&?]ptag=([^&#]*)/gi.exec(vurl);ptag=ptag?ptag[1]:'';pvReport({vurl:vurl,ptag:ptag});}
function logJSON(obj){function task(){if(!task.hasInit){task.counter=setInterval(function(){if(window.ECC_cloud_report_pv){if(!logJSONList.length){clearInterval(task.counter);task.counter=0;return;}
var data=logJSONList.shift();log(data);}},40);task.hasInit=true;}}
function log(data){var mark='wg_wx.000002';data.mark&&(mark=data.mark,delete data.mark);window.ja&&window.ja.logJSON(mark,REPORT_VERSON,data);}
if(window.ECC_cloud_report_pv){log(obj);}else{if(!obj||({}).toString.call(obj)!='[object Object]'){return;}
logJSONList.push(obj);task();}}
function setCookiePtag(ptag){if(!window.ECC_cloud_report_pv){setTimeout(function(){setCookiePtag(ptag);},100);return;}
setTimeout(function(){ECC.cloud.report.synCookiePtag({ptag:ptag,notNeedPvReport:true});},200);}
function getPPRD_PValue(prefix){var regs={QZGDT:/QZGDT\.([^\.\-]+)/gim,QZZTC:/QZZTC\.([^\.\-]+)/gim,ADKEY:/ADKEY\.([^\.\-]+)/gim,WQVERSION:/WQVERSION\.([^\.\-]+)/gim},pprd_p=$getCookie('PPRD_P')||'',paramIsArr=Array.isArray(prefix),str='',rs={};prefix=paramIsArr?prefix:[prefix];pprd_p&&prefix.forEach(function(elem){if(regs[elem]&&regs[elem].test(pprd_p)){rs[elem]=RegExp.$1||'';}});return paramIsArr?rs:rs[prefix[0]];}
function logGoodsExposure(ptags){function task(){if(!logGoodsExposure.hasInit){logGoodsExposure.counter=setInterval(function(){if(window.ECC_cloud_report_pv){clearInterval(logGoodsExposure.counter);logGoodsExposure.counter=0;log();}},80);logGoodsExposure.hasInit=true;}}
function log(){if(!goodsExposureList.length){return;}
window.ja&&window.ja.logGoodsExposure(goodsExposureList.join('_'));logGoodsExposure.goodsExposureList=goodsExposureList=[];}
if(!ptags){return;}!logGoodsExposure.goodsExposureList&&(logGoodsExposure.goodsExposureList=[]);!Array.isArray(ptags)&&(ptags=[ptags]);var goodsExposureList=logGoodsExposure.goodsExposureList;[].push.apply(goodsExposureList,ptags);if(window.ECC_cloud_report_pv){log();}else{task();}}
function logShopJSON(data){data=data||{};data.mark='wg_wx.000004';logJSON(data);}
function trace(data){if(!window.ECC_cloud_report_pv){return;}
window.ja&&window.ja.trace(data);}
function skuRecomExposure(obj){if(!skuRecomExposure.datas){skuRecomExposure.datas=[];}
obj&&skuRecomExposure.datas.push(obj);if(!window.ECC_cloud_report_pv){skuRecomExposure.timer=setTimeout(function(){skuRecomExposure();},200);}else{skuRecomExposure.timer&&clearTimeout(skuRecomExposure.timer);skuRecomExposure.timer=null;while(obj=skuRecomExposure.datas.pop()){window.ja&&window.ja.skuRecomExposure&&window.ja.skuRecomExposure(obj);}}}
function guessyoulikeReport(obj){if(!guessyoulikeReport.datas){guessyoulikeReport.datas=[];}
obj&&guessyoulikeReport.datas.push(obj);if(!window.ECC_cloud_report_pv){guessyoulikeReport.timer=setTimeout(function(){guessyoulikeReport();},200);}else{guessyoulikeReport.timer&&clearTimeout(guessyoulikeReport.timer);guessyoulikeReport.timer=null;while(obj=guessyoulikeReport.datas.pop()){window.ja&&window.ja.guessyoulikeReport&&window.ja.guessyoulikeReport(obj);}}}
exports.pvReport=pvReport;exports.pvPortal=pvPortal;exports.trace=trace;exports.logJSON=logJSON;exports.logGoodsExposure=logGoodsExposure;exports.logShopJSON=logShopJSON;exports.setCookiePtag=setCookiePtag;exports.getADKEY=function(){return getPPRD_PValue('ADKEY')||'';}
exports.skuRecomExposure=skuRecomExposure;exports.guessyoulikeReport=guessyoulikeReport;});
;define('wq.loc.store',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),report=require('report'),mLs=require('loadJs'),mUtil=require('util'),itemUtil=require('jd.item.util'),getMyLocation=itemUtil.getMyLocation,$jsonToTpl=itemUtil.$jsonToTpl,showNotice=itemUtil.showNotice,shopid=JD.url.getHashParam('shopid'),locname=JD.url.getHashParam('locname'),venderid=JD.url.getUrlParam('venderid'),locGroupId=JD.url.getHashParam('locGroupId'),skuId=JD.url.getHashParam('sku'),ck=JD.cookie,userChangeLocation='2',shopBaseId=getShopBaseId(),locationid=shopBaseId&&shopBaseId.locationId,addrId=[],addrName=[],shopSelectCb,hasBindEvent=false,shopPriceMap={},currentShopList={},hasRequestLocAddress=false,getLocAddressTreeCallback=[],dataStore={},page={currentPage:1,totalPage:0},filterObj={},loadingList=false,needToBackTop=false,locAddressTree=null,changedAddr=false,locAddCartDirect=false;report.logGoodsExposure('7001.1.56');function getShopBaseId(){var shopBaseId=ck.get('shopBaseId')||false;if(shopBaseId){shopBaseId=JSON.parse(shopBaseId);}
return shopBaseId;}
function iChangeAddr(){changedAddr=false;locname=addrName.join('_').replace(/\_/g,' ');locationid=addrId.join('_').replace(/\_/g,'-');userChangeLocation='1';if(shopSelectCb){list();if(!locAddCartDirect)$.publish('item.store.refreshStoreList');}}
function handProviceData(iAddrId,iLevel,callback){var renderAddressPanel=function(nextRegions){$('#storeAreaAddressList').html('');if(iLevel>3)callback(nextRegions);if(iLevel>1&&nextRegions&&nextRegions.length>1&&nextRegions[0].addressId!=0){nextRegions.unshift({'addressId':0,'addressName':''});}
if(!nextRegions||nextRegions.length==0){$('#storeAreaAddressList').html('<p style="text-align: left;color: #999;"></p>');}else{var html=[];for(var i=0,j=nextRegions.length;i<j;i++){var _item=nextRegions[i],areaId=_item.addressId;if(i%4==0){if(i!==0)html.push('</div>');html.push('<div class="list_row">');}
html.push('<div data-level="'+iLevel+'"data-id="'+areaId+'" n="'+_item.addressName+'"'+((areaId==addrId[iLevel-1])?'class="selected"':'')+'><span>'+_item.addressName+'</span></div>');}
var emptySpanCount=4-(nextRegions.length%4);if(emptySpanCount==0||emptySpanCount==4){html.push('</div>');}else{while(emptySpanCount--){html.push('<div class="empty"></div>');if(emptySpanCount===0)html.push('</div>');}}
$('#storeAreaAddressList').html(html.join(''));}};var getNextRegions=function(locAddressTree,iLevel){if(iLevel===1){return locAddressTree;}else{for(var i=0;i<locAddressTree.length;i++){if(locAddressTree[i].addressId==iAddrId[0]){iAddrId.splice(0,1);return getNextRegions(locAddressTree[i].childNodes,iLevel-1);}}}};getLocAddress(function(locAddressTree){renderAddressPanel(getNextRegions(locAddressTree,iLevel));});}
function showLevel(iLevel,callback){if(iLevel===1){handProviceData([0,0,0,0],1);}else if(iLevel===2){handProviceData([addrId[0],0,0,0],2);}else if(iLevel===3){handProviceData([addrId[0],addrId[1],0,0],3);}else{handProviceData([addrId[0],addrId[1],addrId[2],0],iLevel,callback);}}
function bindEvent(){$(window).on('scroll',function(){if(location.hash!=='#store')return;if(page.totalPage>0&&page.currentPage<=page.totalPage&&$(window).scrollTop()>$(document).height()-$(window).height()-5){getShopList();}
var storeIdArr=[];$('#part_store .item_store').each(function(index,dom){var storeId=$(dom).attr('id').replace('store','');if(!$(dom).attr('data-loaded')&&dom.getBoundingClientRect().top<2*$(window).height()&&!shopPriceMap[storeId+'_'+skuId]){storeIdArr.push(storeId);}});setStorePrice(storeIdArr);});if(!locAddCartDirect){$('#part_store .list_store').on('click','.item_store .info',function(){var $this=$(this).parent();if($this.hasClass('selected'))return;$this.siblings().removeClass('selected');$this.addClass('selected');var shopid=$this.attr('id').replace('store','');currentShopList.shoplist.forEach(function(item){if(item.storeId==shopid){if(item.regionId){locationid=item.regionId;}
item.locationid=locationid;item.price=shopPriceMap[shopid+'_'+skuId]&&shopPriceMap[shopid+'_'+skuId][0]&&shopPriceMap[shopid+'_'+skuId][0].p;window.selectShop=item;}});if(!shopBaseId){shopBaseId={};}
shopBaseId.venderId=venderid;shopBaseId.locationId=locationid;shopBaseId.shopId=window.selectShop.storeId;ck.set('shopBaseId',JSON.stringify(shopBaseId),60,'/','jd.com');if(shopSelectCb){shopSelectCb(window.selectShop);}});}
$('#part_store .list_store').on('click','.item_store .btn',function(){var $this=$(this);if($this.attr('data-coords')){map($this.attr('data-coords'),$this.attr('data-shopinfo'),$this.attr('data-addr'));}});$('#part_store .address_info').on('click','.btn',function(e){var target=e.srcElement||e.target,em=target,i=1;while(em&&!em.id&&i<=4){em=em.parentNode;i++;}
if(!em||!em.id)return;var emId=em.id;if(emId.indexOf('storeAreaLevel')!==0)return;var level=emId.replace('storeAreaLevel','')-0;if($('#storeAreaLevel'+level).hasClass('open')){$('#storeAreaLevel'+level).removeClass('open');$('#part_store .address_pannel').hide();if(changedAddr)iChangeAddr();}else{var hasChoosedAbove=true;var currentLevel=level;while(currentLevel--){if(addrId[currentLevel-1]==0){hasChoosedAbove=false;}}
if(!hasChoosedAbove)return;$('#storeAreaLevel'+level).addClass('open');$('#storeAreaLevel'+level).siblings().removeClass('open');$('#part_store .address_pannel').show();showLevel(level);}});$('#storeAreaAddressList').on('click','.list_row >div',function(){var $this=$(this);var level=$this.attr('data-level')-0;if($this.hasClass('empty'))return;var choosedTxt=$this.text();addrId[level-1]=$this.attr('data-id')-0;addrName[level-1]=choosedTxt;if($this.hasClass('selected')){$('#storeAreaLevel'+level).removeClass('open');$('#part_store .address_pannel').hide();if(level==1)return;iChangeAddr();return;}
changedAddr=true;$this.addClass('selected');$('#storeAreaAddressList span').removeClass('selected');if(level==4){var levelsAreaName=$('#storeAreaLevel3').find('.txt span').html();$('#storeAreaLevel3').addClass('choosed').trigger('click').find('.txt span').html(levelsAreaName+choosedTxt);iChangeAddr();}else if(level==3){if(addrId[level-1]==0){$('#storeAreaLevel3').addClass('choosed').find('.txt span').html(choosedTxt);$('#storeAreaLevel'+level).removeClass('open');$('#part_store .address_pannel').hide();iChangeAddr();return;}
showLevel(4,function(data){if(data&&data.length>0){$('#choosedStoreAreaLevel3').html(choosedTxt);$('#address_pannel .last_level_choose_info').show();}else{$('#storeAreaLevel3').addClass('choosed').find('.txt span').html(choosedTxt);$('#storeAreaLevel'+level).removeClass('open');$('#part_store .address_pannel').hide();iChangeAddr();}});}else{$('#storeAreaLevel'+level).addClass('choosed').find('.txt span').html(choosedTxt);for(var i=level+1;i<=3;i++){$('#storeAreaLevel'+i).removeClass('choosed').find('.txt span').html('');addrId[i-1]=0;addrName[i-1]='';}
if(addrId[level-1]!=0){$('#storeAreaLevel'+(level+1)).trigger('click');}else{$('#storeAreaLevel'+level).removeClass('open');$('#part_store .address_pannel').hide();iChangeAddr();}}});hasBindEvent=true;}
function getRegionZhName(locationid,cb){var name=[];var idArray=locationid.split('-');var getName=function(locAddressTree){locAddressTree=locAddressTree||[];for(var i=0;i<locAddressTree.length;i++){if(locAddressTree[i].addressId==idArray[0]){name[0]=locAddressTree[i].addressName;if(idArray[1]!='0'){locAddressTree=locAddressTree[i].childNodes||[];for(var j=0;j<locAddressTree.length;j++){if(locAddressTree[j].addressId==idArray[1]){name[1]=locAddressTree[j].addressName;if(idArray[2]!='0'){locAddressTree=locAddressTree[j].childNodes||[];for(var k=0;k<locAddressTree.length;k++){if(locAddressTree[k].addressId==idArray[2]){name[2]=locAddressTree[k].addressName;}}}}}}}}
cb&&cb(name);};getLocAddress(function(locAddressTree){getName(locAddressTree);});}
function renderAddress(){if(!hasBindEvent)bindEvent();if(userChangeLocation==1)return;if(locname){var locNameArr=locname.split(' ');$('#storeAreaLevel1').addClass('choosed').find('.txt span').html(locNameArr[0]);$('#storeAreaLevel2').addClass('choosed').find('.txt span').html(locNameArr[1]||'');locNameArr[1]?$('#storeAreaLevel2').addClass('choosed'):$('#storeAreaLevel2').removeClass('choosed');$('#storeAreaLevel3').find('.txt span').html(locNameArr[2]||'');locNameArr[2]?$('#storeAreaLevel3').addClass('choosed'):$('#storeAreaLevel3').removeClass('choosed');}else{getRegionZhName(locationid,function(a){addrName=a;$('#storeAreaLevel1').addClass('choosed').find('.txt span').html(a[0]);$('#storeAreaLevel2').find('.txt span').html(a[1]||'');a[1]?$('#storeAreaLevel2').addClass('choosed'):$('#storeAreaLevel2').removeClass('choosed');$('#storeAreaLevel3').find('.txt span').html(a[2]||'');a[2]?$('#storeAreaLevel3').addClass('choosed'):$('#storeAreaLevel3').removeClass('choosed');});}}
function getPriceStr(p){var priceStr='';if(p>0){var parr=[],tplStr='&yen;<em>{#intP#}</em>.{#floatP#}';p=(p*1).toFixed(2);parr=p.split('.');priceStr=$jsonToTpl({intP:parr[0],floatP:parr[1]},tplStr);}
return priceStr;}
function setStorePrice(storeIdArr){if(locAddCartDirect)return;if(!storeIdArr||storeIdArr.length<1)return;for(var i=0;i<storeIdArr.length;i++){var storeId=storeIdArr[i];if(shopPriceMap[storeId+'_'+skuId]){window['shopPriceCallback'+storeId+'_'+skuId](shopPriceMap[storeId+'_'+skuId]);}else{if(window['shopPriceCallback'+storeId+'_'+skuId])return;(function(storeId,skuId){window['shopPriceCallback'+storeId+'_'+skuId]=function(json){shopPriceMap[storeId+'_'+skuId]=json;$('#store'+storeId).find('.price').html(getPriceStr(json&&json[0]&&json[0].p));$('#store'+storeId).attr('data-loaded',true);};})(storeId,skuId);mLs.loadScript('//pe.3.cn/prices/pcpmgets?skuids='+skuId+'&origin='+((mUtil.isWX()||JD.device.scene==='qqbrower')?5:4)+'&source=wxsqitemsou&ext=111&pin='+encodeURIComponent(ck.get('pin')||'')+'&area='+locationid+'&storeid='+storeId+'&callback=shopPriceCallback'+storeId+'_'+skuId+'&t='+Math.random());}}}
function renderShopList(d){var html,showMap=true;var storeIdArr=[];if(d&&d.length>0){var tpl='<div class="item_store" id=store{#id#}>'+'<div class="info" '+(locAddCartDirect?'style="padding-left: 10px;"':'')+'">'+
(locAddCartDirect?'':'<i class="icon"></i>')+'<div class="info_row" '+(locAddCartDirect?'style="padding-left: 10px;"':'')+'>'+'<span class="name">{#name#}</span>'+'<span class="price">{#price#}</span>'+'</div>'+'<div class="info_row" '+(locAddCartDirect?'style="padding-left: 10px;"':'')+'>{#fulladdr#}</div>'+'</div>'+'<div class="de_row btns {#pair#}">'+'<a class="btn" href="{#phone#}"><i class="icon icon_o_phone"></i></a>{#map#}'+
(locAddCartDirect?'<a class="btn" href="//md-mobile.jd.com/storefromwxmobileqq/storeInfoloc?skuId='+skuId+'&venderId='+venderid+'&storeId={#id#}&lat={#lat#}&lng={#lng#}"><i class="icon icon_o_shop"></i></a>':'')+'</div>'+'</div>';var storeListHtml='';for(var i=0;i<d.length;i++){if(i<5)storeIdArr.push(d[i].storeId);var coordinateArr=(d[i].coordinate||'').split(',');storeListHtml+=$jsonToTpl({id:d[i].storeId,name:d[i].name,price:shopPriceMap[d[i].id+'_'+skuId]?getPriceStr(shopPriceMap[d[i].id+'_'+skuId][0]&&shopPriceMap[d[i].id+'_'+skuId][0].p):'',fulladdr:d[i].fullAddress,pair:(mUtil.isWX()||mUtil.isSQ()||locAddCartDirect)?'pair':'',phone:'tel:'+d[i].phone,map:(showMap&&(mUtil.isWX()||mUtil.isSQ()))?'<span class="btn" data-coords="'+d[i].coordinate+'" data-shopinfo="'+d[i].name+'" data-addr="'+d[i].fullAddress+'"><i class="icon icon_o_adds"></i></span>':'',lat:coordinateArr[0]||'',lng:coordinateArr[1]||''},tpl);}
html=storeListHtml;$('#part_store .list_store').append(html);}else if(page.currentPage==1){html='<div class="empty_tip">'+'<p class="big"></p>'+'<p> </p>'+'</div>';$('#part_store .list_store').html(html);}
setTimeout(function(){$('#part_store .list_store').css('min-height',$(window).height()-2*$('#part_store .header').height()+16);if(needToBackTop){needToBackTop=false;window.scrollTo(0,0);}},200);setStorePrice(storeIdArr);if(userChangeLocation==2)$('#store'+shopid).addClass('selected');}
function list(){page.currentPage=1;page.totalPage=0;filterObj={};needToBackTop=true;$('#part_store .list_store').html('');var arg=arguments,_useCoords='1';if(arg[0]){locAddCartDirect=!!arg[0]['locAddCartDirect'];locationid=arg[0]['locationid']||'';addrId=locationid.split('-');addrName=(arg[0]['jdAddrName']||[]).slice();locname=addrName.join(' ');shopid=arg[0]['shopid'];venderid=arg[0]['venderid'];locGroupId=arg[0]['locGroupId'];skuId=arg[0]['skuId'];}
if(arg[1])shopSelectCb=arg[1];var loc1=(shopBaseId.locationId||'').split('-').slice(0,3).join('-');var loc2=(locationid||'').split('-').slice(0,3).join('-');if((shopBaseId&&shopBaseId.locationId&&loc1==loc2)||userChangeLocation=='1'){_useCoords=2;}
if(locAddCartDirect)_useCoords=2;getLocAddress();if(_useCoords=='1'){getMyLocation(function(obj){if(obj&&obj.longitude&&obj.latitude){getRegioninfoBylnglat({longitude:obj.longitude,latitude:obj.latitude},function(){getShopList();});}else{getShopList();}});}else{getShopList();}}
function getLocAddress(callback){if(locAddressTree){callback&&callback(locAddressTree);return;}
getLocAddressTreeCallback.push(callback);if(hasRequestLocAddress)return;hasRequestLocAddress=true;if(!window.getLocAddrTreeCb){window.getLocAddrTreeCb=function(json){if(json&&json.data&&json.data.length>0){locAddressTree=json.data;getLocAddressTreeCallback&&getLocAddressTreeCallback.forEach(function(cb){cb&&cb(locAddressTree);});getLocAddressTreeCallback=[];}};}
mLs.loadScript('//wq.jd.com/commodity/lbslocshop/getaddrtree',{data:{venderid:venderid,shopgroupid:locGroupId,callback:'getLocAddrTreeCb'},onError:function(){hasRequestLocAddress=false;}});}
function getRegioninfoBylnglat(data,callback){if(!data||!data.longitude||!data.latitude)return;if(!window.getregioninfobylnglatCb){window.getregioninfobylnglatCb=function(json){if(json&&json.addrLvlIds){if(json.addrLvlIds.dwProvinceId){locationid=json.addrLvlIds.dwProvinceId+'-'+json.addrLvlIds.dwCityId+'-0';addrId=locationid.split('-');}
if(json.addrLvlIds.strProvinceName){locname=json.addrLvlIds.strProvinceName+' '+(json.addrLvlIds.strCityName||'');addrName[0]=json.addrLvlIds.strProvinceName;addrName[1]=(json.addrLvlIds.strCityName||'');}
callback();}};}
mLs.loadScript('//wq.jd.com/deal/trademisc/getregioninfobylnglat',{data:{lng:data.longitude,lat:data.latitude,callback:'getregioninfobylnglatCb'}});}
function getShopList(){if(loadingList)return;loadingList=true;var level=0,addressid=0;for(var i=0;i<addrId.length;i++){if(addrId[i]>0)level++;}
addressid=addrId[level-1];window.getshoplistbyaddridCb=function(json){loadingList=false;dataStore['getshoplistbyaddridCb'+'-'+level+'-'+addressid+'-'+page.currentPage]=json;page.totalPage=json&&json.data&&json.data.totalPage;if(level>1&&(!json||!json.data||!json.data.itemList||json.data.itemList.length<1)){addrId[1]='0';addrId[2]='0';locationid=addrId.join('-');locname=locname.split(' ').splice(0,1).join(' ');getShopList();}else if(json&&json.data&&json.data.itemList){renderAddress();var d=json.data;var itemList=[],allItemList=[];for(var j=0;j<d.itemList.length;j++){if(!filterObj[d.itemList[j].storeId]){filterObj[d.itemList[j].storeId]=d.itemList[j];itemList.push(d.itemList[j]);}}
for(var key in filterObj){allItemList.push(filterObj[key]);}
currentShopList={shoplist:allItemList};renderShopList(itemList);page.currentPage++;}};if(dataStore['getshoplistbyaddridCb'+'-'+level+'-'+addressid+'-'+page.currentPage]){window.getshoplistbyaddridCb(dataStore['getshoplistbyaddridCb'+'-'+level+'-'+addressid+'-'+page.currentPage]);}else{mLs.loadScript('//wq.jd.com/commodity/lbslocshop/getshoplistbyaddrid',{data:{venderid:venderid,shopgroupid:locGroupId,addressid:addressid,level:level,page:page.currentPage,pagesize:10,callback:'getshoplistbyaddridCb'},onError:function(msg){loadingList=false;showNotice({str:msg||''});}});}}
function map(coords,name,addr){if(!coords){return;}
var latitude,longitude,_coords,mapurl,tmp;_coords=coords.split(',');latitude=_coords[0]-0;longitude=_coords[1]-0;if(latitude>longitude){tmp=latitude;latitude=longitude;longitude=tmp;}
if(navigator.userAgent.indexOf('MicroMessenger')>0){JD.wxapi&&JD.wxapi.ready&&JD.wxapi.ready(function(config){config.beta=true;wx.openLocation({latitude:latitude,longitude:longitude,name:name,address:addr,scale:15,infoUrl:''});});}else if(/qq\/([\d\.]+)*/.test(navigator.userAgent.toLowerCase())){mapurl='//apis.map.qq.com/tools/poimarker?marker=coord:'+latitude+','+longitude+';title:'+name+';addr:'+addr+'&referer=myapp&key=AEXBZ-2MUKJ-YSVF6-KIYLB-44AA3-3QFEK';window.mqq&&window.mqq.ui&&window.mqq.ui.openUrl&&window.mqq.ui.openUrl({'url':mapurl,'target':1,'style':1,'animation':0});}}
function reset(){userChangeLocation='2';}
function refreshSku(newSkuId){skuId=newSkuId;shopid='';list();}
exports.list=list;exports.reset=reset;exports.map=map;exports.refreshSku=refreshSku;});
;define('jd.item.loginHandler',function(require,exports,module){var __cacheThisModule__,wqLogin=require('login'),cookie=require('cookie'),cache=require('cachev1'),ls=require('loadJs'),util=require('util'),isWX=util.isWX(),isMScene=false,domainStr=(document.domain).split('.').slice(-2).join('.'),locationUrl=(location.href||'').split('#')[0],isCrossDomain=(document.domain).split('.').slice(-2).join('.')!=='jd.com',alreadyRequestSetCookie=false,alreadySetCookie=false,isLogin=(window._isLogin=='1'),isLoginAct=false,loginSetCookieCbs=[];function init(config){config=config||{};isMScene=!!config.isMScene;isLoginAct=config.isLoginAct;}
function isAlreadySetCookie(){return alreadySetCookie;}
function getLoginStatus(){return isLogin;}
function setLoginStatus(value){isLogin=value;}
function loginLocation(url){if(!url)return;if(isLogin){location.href=url;}else{login(url);}}
function loginSetCookie(cb){loginSetCookieCbs.push(cb);if(!isCrossDomain||alreadySetCookie){loginSetCookieCbs.forEach(function(cb){cb&&cb();});loginSetCookieCbs=[];return;}
if(isMScene){if(alreadyRequestSetCookie)return;alreadyRequestSetCookie=true;window.setCookieCB=function(json){for(var key in json){if(json[key]&&!cookie.get(key))cookie.set(key,json[key],10080,'/',domainStr);if(json[key]){if(key=='visitkey')window._syncVk=json[key];}}
alreadySetCookie=true;loginSetCookieCbs.forEach(function(cb){cb&&cb();});loginSetCookieCbs=[];};ls.loadScript({url:'//wqitem.jd.com/item/cookiesync?callback=setCookieCB&t='+Math.random(),onError:function(){alreadySetCookie=true;loginSetCookieCbs.forEach(function(cb){cb&&cb();});loginSetCookieCbs=[];}});}else{if(alreadyRequestSetCookie)return;alreadyRequestSetCookie=true;window.setCookieCB=function(json){if(json.retcode==0){for(var key in json){if(key!='retcode'&&key!='errmsg'&&json.hasOwnProperty(key)&&json[key]){cookie.set(key,encodeURI(json[key]),43200,'/',domainStr);}}}
alreadySetCookie=true;loginSetCookieCbs.forEach(function(cb){cb&&cb(json.retcode);});loginSetCookieCbs=[];};ls.loadScript({url:(isWX?'//wq.jd.com/mlogin/wxv3/LoginExplicit?':'//wq.jd.com/mlogin/h5v1/LoginExplicit?')+'callback=setCookieCB&t='+Math.random(),onError:function(){alreadySetCookie=true;loginSetCookieCbs.forEach(function(cb){cb&&cb();});loginSetCookieCbs=[];}});}
window.setTimeout(function(){alreadySetCookie=true;},2000);}
function login(reUrl,cb){reUrl=reUrl||locationUrl;try{if(isLoginAct&&isCrossDomain){var limit=null,t=20;limit=setInterval(function(){t--;if(t<=0||isLogin){clearInterval(limit);limit=null;isLogin=true;cb&&cb();}},100);return;}
cache.setItem('itemLogin','1',60);}catch(e){}
var option={rurl:reUrl,bj:true};if(isMScene)option.env='jdm';wqLogin.login(option);}
function loginAuth(opt){if(!opt||!opt.biz)return;var redirect=opt.redirect;if(isLogin){if(isMScene){opt.cb&&opt.cb();}else{window.tokenRedirectCb=function(json){if(json.retcode==0){opt.cb&&opt.cb();}else{if(opt.forceLogin){window.location.href='//wq.jd.com/pinbind/pintokenredirect?biz='+opt.biz+'&url='+encodeURIComponent(redirect);}else if(json.retcode==2&&opt.addEnterFun){opt.addEnterFun('//wq.jd.com/pinbind/pintokenredirect?biz='+opt.biz+'&url='+encodeURIComponent(redirect));}}};ls.loadScript('//wq.jd.com/pinbind/TokenRedirectCb?callback=tokenRedirectCb&biz='+opt.biz+'&t='+Math.random());}}else{if(opt.forceLogin){login(redirect);}}}
exports.init=init;exports.getLoginStatus=getLoginStatus;exports.setLoginStatus=setLoginStatus;exports.loginLocation=loginLocation;exports.loginSetCookie=loginSetCookie;exports.login=login;exports.loginAuth=loginAuth;exports.isAlreadySetCookie=isAlreadySetCookie;});
;define('jd.item.user',function(require,exports,module){var _cacheThisModule_,ls=require('loadJs'),cookie=require('cookie'),loginHandler=require('jd.item.loginHandler'),util=require('util'),isWX=util.isWX(),jdSkuInfo={};function getUserLevel(e){switch(e){case-1:return'';case 50:case 59:return'';case 56:return'';case 60:case 61:return'';case 62:return'';case 63:return'';case 64:return'';case 110:return'VIP';case 66:return'';case 88:case 103:case 104:case 105:return'';case 90:return'';case 5001:case 5002:case 5003:case 5004:case 5005:return'VIP';case 6010:return'PLUS';case 6020:return'PLUS';}return'';}
function userLevel(opt){opt=opt||{};var type=opt.type||'3';if(!loginHandler.getLoginStatus())return;window.userLevelCB=function(json){if(json.retcode==0&&json.data){jdSkuInfo.userLevel=json;var data=json.data,status=data.mapingstatus,out={isFormal:status===201,isTrial:status===101,level:data.vipLevel,levelName:getUserLevel(data.vipLevel)};opt.cb&&opt.cb(out);}else{opt.cb&&opt.cb({});}};if(jdSkuInfo.userLevel){window.userLevelCB(jdSkuInfo.userLevel);}else{ls.loadScript(['//wq.jd.com/vipplus/GetPlusVerifyStatusInfo?'+(window.isMScene?'sceneval=2&':'')+'callback=userLevelCB&type='+type,window.isMScene?'scene=weixin':'scene='+(isWX?'weixin':'qq'),'t='+Math.random()].join('&'));}}
function getPinStatus(opt){opt=opt||{};var cb=opt.cb,url=opt.url,sceneid=opt.sceneid||'';if(window.isMScene){cb&&cb({});return;}
var domainStr=(document.domain).split('.').slice(-2).join('.');if(!~domainStr.indexOf('jd.com')&&!loginHandler.isAlreadySetCookie()){window.setTimeout(function(){getPinStatus(opt);},100);return;}
if(!loginHandler.getLoginStatus()){cb&&cb({});return;}
if(jdSkuInfo.pinStatusHold){jdSkuInfo.pinStatusCBs.push(cb);return;}
jdSkuInfo.pinStatusCBs=[cb];var rurl=url||(location.href||'').split('#')[0];window.pinStatusCB=function(json){jdSkuInfo.pinStatus=json;var isDefault=false,isPerfect=false,isBind=false,isSwitch=false;if(json.errcode===0){var state=json.state;isDefault=(state===1||state===2);isPerfect=(state===1);isBind=(state===2||state===4);isSwitch=(state===3&&json.defaultFlag===1);}
if(jdSkuInfo.pinStatusCBs&&jdSkuInfo.pinStatusCBs.length){jdSkuInfo.pinStatusCBs.forEach(function(cb){cb&&cb({isDefault:isDefault,isPerfect:isPerfect,isBind:isBind,isSwitch:isSwitch,url:json.url,json:json});});}
jdSkuInfo.pinStatusHold=false;jdSkuInfo.pinStatusCBs=[];};if(jdSkuInfo.pinStatus){window.pinStatusCB(jdSkuInfo.pinStatus);}else{var wid=(cookie.get('wq_uin')||'');jdSkuInfo.pinStatusHold=true;ls.loadScript(['//wq.jd.com/pinbind/QueryPinStatus?callback=pinStatusCB&wid='+wid,'rurl='+encodeURIComponent(rurl),'source='+(isWX?'2':'1'),'sceneid='+sceneid,'t='+Math.random()].join('&'));}}
exports.getUserLevel=getUserLevel;exports.userLevel=userLevel;exports.getPinStatus=getPinStatus;});
;define("m.itemSpecV2",function(require,exports,module){var _cacheThisModule_,$=require('zepto'),mLs=require('loadJs'),mWfdata=require('wfdata'),mUtil=require('util'),mCookie=require('cookie'),mLoc=require('wq.loc.store'),itemComm=require('wq.item.common'),loginHandler=require('jd.item.loginHandler'),userInfo=require('jd.item.user'),numberp=require('numberp'),itemUtil=require('jd.item.util'),getImgUrl=itemUtil.getImgUrl,formatTime=itemUtil.formatTime,showNotice=itemUtil.showNotice,popUp=itemUtil.popUp,umpMonitor=itemUtil.umpMonitor,reporter=itemUtil.reporter,$jsonToTpl=itemUtil.$jsonToTpl,getMyLocation=itemUtil.getMyLocation,jumpMap=itemUtil.jumpMap,bizid='718',gVar={isInitZxService:false,comboSkuInfo:null,skuAttachNo:-1,cfee:null,jdSkuInfo:{},isBargain:true,timmer:{},pageWidth:$(window).width(),pageHeight:$(window).height()},base={getUrlParam:function(name){var u=arguments[1]||window.location.search,reg=new RegExp('(^|&)'+name+'=([^&]*)(&|$)','i'),r=u.substr(u.indexOf('\?')+1).match(reg);return r!=null?r[2]:'';}};function initStatus(opt){opt=opt||{};if(opt.itemType!='heyue'){gVar.comboSkuInfo=null;gVar.skuAttachNo=-1;gVar.cfee=null;$('#skuAttach1,#skuAttach2').remove();$('#popupSkuAttach').hide();}
gVar.isBargain=false;$('#mupWrap,#oldNewWrap,#threeDLink,#eBookUrl,#tencentWrap,#traceBack').hide();$('#barGroup,#buyNoticeArea,#taxTip,#certificationNotice,#specTimer,#secondHand,#imgLeftUp,#drugCart').hide();$('#plusGuide,#promoteAtmosphereTimer,#imgLeftDown,#videoUrl').hide();}
function yuShouSetDom(flag){$('#favShopGuideContainer').hide();$('#postNotice').html('');$('#priceBlock').hide();$('#priceTag').addClass('hide').hide();var priceStr=$('#priceSale').html();var domStr='',outClass={1:'bg_red2',2:'bg_red3',3:'bg_red2',4:'bg_red',5:'bg_red',6:'bg_orange'},iconClass={1:'',2:'logo type_presell_v2',3:'logo type_seckill',4:'logo type_seckill',5:'logo type_seckill'},titleObj={1:'',2:'',3:'',4:'',5:''};if(flag==6){domStr='<div class="price" id="specPrice"></div>'+'<div class="msg">'+'<div class="text">'+'<span class="tips tip_black" id="ysNumTip"></span>'+'</div>'+'<div class="text">'+'<span class="logo type_presell_dream" id="goalNum"></span>'+'</div>'+'</div>'+'<div class="countdown new_v" id="specTimer">';}else if(flag==2){domStr='<div class="msg msg_twoline">'+'<div class="text">'+'<span class="price" id="ysOriPrice">'+priceStr+'</span> '+'<span class="'+iconClass[flag]+'">'+titleObj[flag]+'</span>'+'</div>'+'<div class="text">'+'<span class="earnest_price" id="ysPrice"></span>'+'</div>'+'</div>'+'<div class="text text_right" id="ysNumTip"></div>';}else{domStr='<div class="price" id="'+(flag==2?'ysOriPrice':'specPrice')+'">'+priceStr+'</div>'+'<div class="msg">'+'<div class="text" id="ysPrice"><span id="ysTips"></span><del class="old_price" id="specOldPrice" style="display:none;"></del></div>'+'<div class="text">'+'<span class="'+iconClass[flag]+'">'+titleObj[flag]+'</span>'+
(flag<3?'<span class="participant" id="'+(flag==2?'ysNumTip':'yyNumTip')+'"></span>':'')+'</div>'+'</div>'+'<div class="countdown" id="specTimer" style="display:none;">'+'</div>';}
if(domStr){var priceSpec=$('#priceSpec');priceSpec.addClass(outClass[flag]);priceSpec.html(domStr).show();$('#fav').appendTo($('#favWrap'));$('.fn_goods_name').addClass('fgn_old');}}
function dreamBuy(obj,data){data=data||{};var status=data.status-0;obj.ysNoWayInfo.yuShouNoWayStatus=status;obj.jdStatus=true;var setDom=function(){yuShouSetDom(6);$('#specPrice,#priceSale2').html(obj.itemPrice.setSpecPrice({p:data.currentPrice,flag:2}));$('#ysNumTip').html(status==0?'':''+(data.count||0)+'');$('#goalNum').html(''+(data.produceLimitNum||0)+'');if(status==1&&data.count>=data.produceLimitNum&&data.count>0){$('#priceSpec').addClass('tag_realized');}
if(!$('#dreamProcessTip').length)$('#priceSpec').after('<div class="process_tip" id="dreamProcessTip"><div class="step step_1"><i></i></div><div class="step step_2"><i></i>'+(data.produceLimitNum||0)+'</div></div>');$('#dreamRefundTip').show().off().on('click',function(){popUp.createPopup({flag:11,title:'',msg:'1<br>2 <br>3<br>4<br>57<br>6'});});showSpecLimit(obj,{note:status==0?'limit':'limit',limit:data.d,limitAll:true,fun:function(){if(status==0){yuShouNoWay(obj);}else{$('#priceSpec,#dreamProcessTip,#dreamRefundTip,#shareBtn1,#shareBtn2').hide();$('#priceBlock').show();obj.skuJson[obj.skuId]=null;obj.setItemInfo();}}});if(data.shipTime){var arr1=data.shipTime.split(' '),arr2=[],len=0;if(arr1[0]){arr2=arr1[0].split('-');len=arr2.length;}
if(arr2[len-2]!==undefined||arr2[len-1]!==undefined||arr1[1]!==undefined){obj.dreamBuy.shipStr=''+(arr2[len-2]?arr2[len-2]+'':'')+(arr2[len-1]?arr2[len-1]+'':'')+(arr1[1]||'')+'';}}
if(status==0)$('#postNotice').html(['<small><span>','','</span><b id="postTip">',obj.dreamBuy.shipStr||'','</b></small>'].join(''));};obj.dreamBuy={};obj.dreamBuy.status=status;switch(status){case 0:obj.jdStatus=false;obj.setBtnStatus({buyBtnConfig:{disable:true,txt:''},addBtnConfig:{showType:-1}});$('#shareBtn1,#shareBtn2').hide();setDom();break;case 1:obj.jdStatus=true;obj.setBtnStatus({buyBtnConfig:{disable:false,txt:''},addBtnConfig:{showType:-1}});$('#buyBtn2,#buyBtn1').attr('ptag','7001.1.315');reporter.reportExposure({ptag:'7001.1.313'});$('#shareBtn1,#shareBtn2').show().off().on('click',function(){reporter.reports({ptag:'7001.1.312'});if($(this).hasClass('btn_disable')||$(this).hasClass('disabled_1'))return;var tpl='<div class="mod_dream_share show" id="dreamShare">'+'<p class="orange"></p>'+'<p></p>'+'<div class="dream_process_container">'+'<div class="dream_process detail_decoration bg_orange">'+'<div class="msg">'+'<div class="text">'+'<span class="tips tip_black">{#count#}</span>'+'</div>'+'<div class="text">'+'<span class="logo type_presell_dream">{#produceLimitNum#}</span>'+'</div>'+'</div>'+'<div class="countdown new_v">'+'<p class="countdown_text"></p>'+'<p class="countdown_nums">{#timeStr#}</p>'+'</div>'+'</div>'+'</div>'+'<p class="middle">{#produceLimitNum#}</p>'+'</div>';if($('#dreamShare').length)$('#dreamShare').remove();$(document.body).append($jsonToTpl({count:data.count,produceLimitNum:data.produceLimitNum,timeStr:$('#timeLimit').html()},tpl));$('#dreamShare').off().on('click',function(){$('#dreamShare').remove();});});setDom();obj.getSkuStock();break;case 2:case 3:case 4:obj.jdStatus=true;obj.getSkuStock();break;default:break;}}
function yuShouNoWay(obj){if(obj.isJDChoice){window.location.href=obj.getNewSkuUrl(obj.skuId,'general');return;}
var item=obj.item();obj.ysNoWayInfo.isYuShouNoWay=true;window.yushouNoWayJDCB=function(json){if(!json||!json.ret||json.type==1||json.error){obj.ysNoWayInfo.isYuShouNoWay=false;return;}
if(json.ret&&json.ret.bizType==1){dreamBuy(obj,json.ret);return;}
window.wa&&window.wa('ptagExposure',{ptag:(obj.isWX?'7492.1.1':'7492.2.1')});var ret=json.ret||{},ysPrice=(ret.currentPrice>0?(ret.currentPrice*1).toFixed(2):0),pmPrice=ret.earnest>0?(ret.earnest*1).toFixed(2):'',ysPriceHtmlStr='<span>&yen;'+pmPrice+'</span>',yxExpTip='',noticeHtmlStr='',isHidePrice=false,ysOriPriceStr='';obj.setBtnStatus({buyBtnConfig:{txt:''+(pmPrice!=''?''+pmPrice:'')},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2}});yuShouSetDom(2);var isAllMoney=false,$ysPrice=$('#ysPrice'),yushouTextObj=obj.specTextConfigs['yushouguize']||{};if((json.ret&&json.ret.presalePayType=='1')||(item.spAttr&&item.spAttr.YushouStepType==='1')){$ysPrice.hide().parent('.text').hide();obj.setBtnStatus({buyBtnConfig:{txt:''}},true);isAllMoney=true;}
$('#buyBtn2,#buyBtn1').attr('ptag',(obj.isWX?'7492.1.2':'7492.2.2'));if(ret.stepType!=1){var tpl='<li class="group_nav_v2_item {#onClass#}">{#num#} <span class="group_nav_v2_price">{#priceStr#}</span></li>',stepHtmlArr=[],stepItem={},priceStr='',len=ret.stepRule&&ret.stepRule.length||0;for(var i=0;i<len;i++){if(i>2)break;stepItem=ret.stepRule[i];if(ret.hidePrice==1&&i==2){priceStr='&yen;???';if(ret.currentStep===3){isHidePrice=true;ysOriPriceStr='&yen;???';}}else{priceStr='&yen;'+(stepItem.m*1).toFixed(2);}
stepHtmlArr.push($jsonToTpl({onClass:(i==ret.currentStep-1?'on':''),num:stepItem.c,priceStr:priceStr},tpl));}
if(stepHtmlArr.length>0){noticeHtmlStr='<ul class="group_nav_v2_list">'+stepHtmlArr.join('')+'</ul>';}}
if(ret.hideRealPrice==1){isHidePrice=true;}
if(ret.expAmount>0){if(isHidePrice){ysPrice=0;}else if(ret.oriPrice>0){ysPrice=numberp.round(ret.oriPrice,2);}else{ysPrice=0;}
var extPrice=numberp.round(ret.expAmount,2),pmExtPrice=numberp.round(numberp.plus([pmPrice,extPrice]),2),endPrice=numberp.round(numberp.minus([ysPrice,pmExtPrice]),2);if(ret.discountType==2){ysPriceHtmlStr+='<span class="tips tip_black"> <b class="price_special_tips_price">&yen;'+extPrice+'</b></span><i class="info"></i>'
yxExpTip='<p style="text-align:left; font-size:12px;">'+pmPrice+''+extPrice+''+(endPrice>0?endPrice+'':'')+'</p>';}else{ysPriceHtmlStr+='<span class="tips tip_black"> <b class="price_special_tips_price">&yen;'+pmExtPrice+'</b></span><i class="info"></i>';yxExpTip='<p style="text-align:left; font-size:12px;">'+pmPrice+''+pmExtPrice+''+(endPrice>0?endPrice+'':'')+'</p>';}}
$ysPrice.html(ysPriceHtmlStr);if(!ysOriPriceStr){if(!isHidePrice&&ysPrice>0){ysOriPriceStr=obj.itemPrice.setSpecPrice({p:ysPrice,flag:2});}else{ysOriPriceStr='<strong></strong>';}}
$('#ysOriPrice,#priceSale2').html(ysOriPriceStr);if(yxExpTip){$ysPrice.off().on('click','i.info',function(){popUp.createPopup({flag:3,msg:yxExpTip});});}
var hideYushouNum=(ret.count===undefined||ret.count==='')||(isAllMoney&&obj.skuId&&window._itemSpecSkus&&window._itemSpecSkus[1]&&window._itemSpecSkus[1].skuList&&!!~('|'+window._itemSpecSkus[1].skuList+'|').indexOf('|'+obj.skuId+'|'));if(hideYushouNum){$('#ysNumTip').parent('.price_special_tag').removeClass('double_line');}else if(ret.count>0){$('#ysNumTip').text(''+(ret.count>10000?(ret.count/10000).toFixed(2)+'':(ret.count||0))+'').parent('.price_special_tag').addClass('double_line');}
var stepArr=[],timeStr='';if(ret.presaleStartTime&&ret.presaleEndTime){timeStr=ret.presaleStartTime.replace(/\/|-/g,'.')+'-'+ret.presaleEndTime.replace(/\/|-/g,'.');}
if(isAllMoney){stepArr.push({title:'',tip:'1. 2.'+(yushouTextObj.textContent?'<i class="buy_tip_v2_icon_info"></i>':'')});if(timeStr){stepArr.push({title:'',tip:timeStr});}}else{stepArr.push({title:'',tip:'1. 2. 3.'+(yushouTextObj.textContent?'<i class="buy_tip_v2_icon_info"></i>':'')});if(timeStr){stepArr.push({title:'',tip:timeStr});}
timeStr='';if(ret.balanceBeginTime&&ret.balanceEndTime){timeStr=ret.balanceBeginTime.replace(/\/|-/g,'.')+'-'+ret.balanceEndTime.replace(/\/|-/g,'.');}
if(timeStr){stepArr.push({title:'',tip:timeStr});}}
setStepDom({htmlStr:noticeHtmlStr,stepArr:stepArr,eventDom:'i.buy_tip_v2_icon_info',eventFunc:function(){popUp.createPopup({flag:2,title:yushouTextObj.textTitle||'',msg:yushouTextObj.textContent});}});obj.ysNoWayInfo.yuShouNoWayStatus=ret.status;obj.jdStatus=true;var shipStr=ret.shipTime?''+decodeURI(ret.shipTime).replace(/\/|-/g,'.')+'':'';switch(ret.status){case 0:obj.jdStatus=false;obj.setBtnStatus({buyBtnConfig:{disable:true,txt:''}},true);break;case 1:obj.jdStatus=true;obj.ysNoWayInfo.shipStr=shipStr;obj.getSkuStock();break;case 4:case 41:obj.jdStatus=false;obj.setBtnStatus({buyBtnConfig:{disable:true}},true);break;case 2:case 21:case 3:case 31:obj.jdStatus=true;if(!isAllMoney){obj.setBtnStatus({buyBtnConfig:{txt:''}},true);}
obj.ysNoWayInfo.shipStr=shipStr;obj.getSkuStock();break;default:break;}};mLs.loadScript('//yuding.jd.com/presaleInfo/getPresaleInfo.action?callback=yushouNoWayJDCB&sku='+obj.skuId+'&t='+Math.random());}
function yuShou(obj,opt){if(obj.isJDChoice){window.location.href=obj.getNewSkuUrl(obj.skuId,'general');return;}
opt=opt||{};obj.setBtnStatus({msgConfig:{hideMsg:true},buyBtnConfig:{txt:''},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2}});var btnStr=((obj.cfeeType&&obj.cfeeType.ft!=100)?getFeeBtnStr(obj.cfeeType.ft):''),needCgi=opt.needCgi,isSwitch=opt.isSwitch,noStock=opt.noStock;obj.jdStatus=false;yuShouSetDom(1);window.wa&&window.wa('ptagExposure',{ptag:(obj.isWX?'7341.2.1':'7341.3.1')});$('#buyBtn2,#buyBtn1').attr('ptag',(obj.isWX?'7341.2.2':'7341.3.2'));window.yushouJDCB=function(json,isPlus){obj.skuJson[obj.skuId].yuyue=json;umpMonitor.delTimeout('itil17');JD.report.umpBiz({bizid:bizid,operation:'17',result:'0',source:'0',message:'item yushou api success'});var note='',des='',limit=0;if(!isSwitch||json.state!=3){obj.setBtnStatus({buyBtnConfig:{disable:true}},true);}
if(json.type==2){obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{disable:true,txt:''}},true);return;}
obj.yushouStatus=json.state;limit=json.d;var qiangTimeBet=[];if(json.state>1&&json.num>0){$('#yyNumTip').show().text(json.num+'');$('#priceSpec div.price_special_tag').addClass('double_line');}else{$('#yyNumTip').hide();$('#priceSpec div.price_special_tag').removeClass('double_line');}
var stepArr=[{title:'',tip:'1. 2. 3.'}];if(json.qiangStime&&json.qiangEtime){var qiangStime=json.qiangStime;if(json.plusType>0&&json.plusEtime){qiangStime=json.plusEtime;}
qiangTimeBet=[qiangStime.replace(/\/|-/g,'.'),json.qiangEtime.replace(/\/|-/g,'.')];stepArr.push({title:'',tip:qiangTimeBet[0]+'-'+qiangTimeBet[1]});}else{stepArr.push({title:'',tip:''});}
setStepDom({htmlStr:'',stepArr:stepArr});if(!isPlus&&json.plusType>0&&json.isBefore===1&&obj.yushouStatus===4){obj.yushouStatus=3;}
if(isPlus&&json.state===3){limit=json.plusD;}
$('#plusGuide').hide();obj.itemPrice&&obj.itemPrice.hideSpecPrice(obj.yushouStatus<=3&&json.hidePrice===1);switch(obj.yushouStatus){case 0:des='';break;case 1:note='limit';break;case 2:note='limit';obj.setBtnStatus({buyBtnConfig:{disable:false},popupBuyAreaConfig:{disablePopupConfirm:false}},true);if(obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].price&&obj.skuJson[obj.skuId].price.np){var np=obj.skuJson[obj.skuId].price.np;if(np.t==1&&np.type==3&&np.p&&(np.p-0)<(obj.jdPrice-0)&&json.showPromoPrice==='1'){var yuyuePrice=numberp.round(np.p*1,2);var yuyuePricePair=yuyuePrice.split('.');$('#priceSale2').html('&yen;<em>'+yuyuePricePair[0]+'</em>.'+yuyuePricePair[1]);var stockState=obj.skuJson[obj.skuId].stock&&obj.skuJson[obj.skuId].stock.StockState;if(json.sellWhilePresell=='1'&&~' 33 39 40 36 '.indexOf(' '+stockState+' ')){var jdPrice=numberp.round(obj.jdPrice*1,2);var jdPricePair=jdPrice.split('.');$('#addCart2,#addCart1').html('<span class="price">&yen;<strong>'+jdPricePair[0]+'</strong>.'+jdPricePair[1]+'</span><span class="txt"></span>').show();$('#buyBtn2,#buyBtn1').html('<span class="price">&yen;<strong>'+yuyuePricePair[0]+'</strong>.'+yuyuePricePair[1]+'</span><span class="txt"></span>').show();$('#priceSpec').prepend('<div class="double_price">'+'<div class="price_main">'+'<span class="txt"></span>&yen;<em>'+yuyuePricePair[0]+'</em>.'+yuyuePricePair[1]+'</div>'+'<div class="price_sub">'+'<span class="txt"></span>&yen;'+jdPrice+'</div>'+'</div>');$('#specPrice').remove();obj.sellWhilePresell=true;var popupAreaType=$('#popupBuyArea').attr('type');if(popupAreaType=='1'){$('#priceSale2').html('&yen;<em>'+jdPricePair[0]+'</em>.'+jdPricePair[1]);$('#popupDoublePrice').show();$('#popupConfirm').text('').removeClass('red').addClass('yellow');}else if(popupAreaType=='2'){$('#priceSale2').html('&yen;<em>'+yuyuePricePair[0]+'</em>.'+yuyuePricePair[1]);$('#popupDoublePrice').hide();$('#popupConfirm').text('').removeClass('yellow').addClass('red');}else if(popupAreaType=='0'){$('#priceSale2').hide();$('#popupDoublePrice').hide();if(!$('#sellWhilePresellPrice').length)$('#priceSale2').after('<div class="double_price" id="sellWhilePresellPrice"><div class="price_main">&yen;<em>'+yuyuePricePair[0]+'</em>.'+yuyuePricePair[1]+'</div><div class="price_sub"><span class="txt"></span>&yen;'+jdPrice+'</div></div>');}
popUp.setPopupArea(true,{yuyuePrice:yuyuePrice,jdPrice:jdPrice});}else{$('#specPrice').html('&yen;<em>'+yuyuePricePair[0]+'</em>.'+yuyuePricePair[1]);$('#specOldPrice').html('&yen;'+obj.jdPrice).show();}}}
break;case 3:if(limit<0){note='';des='';}else{note=(json.state===4?'limit':'limit');}
if(!isSwitch){obj.setBtnStatus({buyBtnConfig:{disable:true,txt:(btnStr||'')},popupBuyAreaConfig:{disablePopupConfirm:true}},true);}
break;case 4:note=(json.isBefore===1&&isPlus?'limit':'limit');obj.setBtnStatus({buyBtnConfig:{disable:false,txt:(btnStr||'')},addBtnConfig:{showType:0}},true);if(!noStock)obj.getSkuStock();if(obj.koStatus!=1&&obj.koStatus!=2){specStateSwitch(obj,{is_Yushou_KO:true,qiangTimeBet:qiangTimeBet});}
break;case 5:des='';obj.setBtnStatus({buyBtnConfig:{disable:true,txt:(btnStr||'')},popupBuyAreaConfig:{disablePopupConfirm:true}},true);specStateSwitch(obj);break;default:obj.setBtnStatus({buyBtnConfig:{disable:false,txt:(btnStr||'')}},true);specStateSwitch(obj);break;}
if(obj.koStatus!=2&&limit>0){showSpecLimit(obj,{note:note,des:des,limit:limit,fun:function(){var param={needCgi:true,noStock:true};if(obj.yushouStatus===3){param.isSwitch=true;obj.setBtnStatus({buyBtnConfig:{txt:''}},true);}
if(obj.skuJson[obj.skuId].miao)obj.skuJson[obj.skuId].miao.serverTime+=2;setTimeout(function(){yuShou(obj,param);},2000);}});}
if(!isPlus){plusPriorBuy(obj,json,true);}};if(!needCgi&&obj.skuJson[obj.skuId].yuyue&&obj.skuJson[obj.skuId].yuyue.d>=0){window.yushouJDCB(obj.skuJson[obj.skuId].yuyue);}else{umpMonitor.createTimeout('17','item yushou api fail'+obj.skuId);mLs.loadScript({url:'//yushou.jd.com/youshouinfo.action?callback=yushouJDCB&sku='+obj.skuId+'&t='+Math.random(),onError:function(){obj.setBtnStatus({buyBtnConfig:{disable:false,txt:(btnStr||'')}},true);}});}}
function qianggou(obj,opt){if(obj.isJDChoice){window.location.href=obj.getNewSkuUrl(obj.skuId,'general');return;}
opt=opt||{};(new Image).src='//wq.jd.com/deal/miao/IsMiao?callback=aa&skuid='+obj.skuId+'&t='+Math.random();var btnStr=(obj.cfeeType&&obj.cfeeType.ft!=100?getFeeBtnStr(obj.cfeeType.ft):''),is_Yushou_KO=opt.is_Yushou_KO,is_SpecKill_KO=opt.is_SpecKill_KO,qiangTimeBet=opt.qiangTimeBet||[],isSpecSku=obj.isSpecSku();obj.koStatus=1;if(qiangTimeBet.length>1){var yuyueStartTime=(new Date(qiangTimeBet[0].replace(/\./g,'/')).getTime())/1000,yuyueEndTime=(new Date(qiangTimeBet[1].replace(/\./g,'/')).getTime())/1000;}
if(!is_Yushou_KO&&!is_SpecKill_KO){obj.setBtnStatus({buyBtnConfig:{disable:true,txt:(btnStr||'')},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2,disablePopupConfirm:true}});yuShouSetDom(3);}
window.qiangCB=function(json,isPlus){umpMonitor.delTimeout('itil18');JD.report.umpBiz({bizid:bizid,operation:'18',result:'0',source:'0',message:'item miao api success'});obj.miaoErr={errId:json.errId,errMsg:json.errMsg};json.startTime=json.startTime*1;json.endTime=json.endTime*1;json.serverTime=json.serverTime*1;json.plusSeconds=json.plusSeconds*1;var note='',des='',qiangTimeStr='',stepArr=[],startTime=json.startTime,endTime=json.endTime,serverTime=json.serverTime,useYuyueTime=false;if(json.isKo==0&&json.errId!='16385'&&!is_Yushou_KO&&!is_SpecKill_KO){obj.koStatus=3;des='';return;}
if(yuyueStartTime&&yuyueEndTime&&yuyueStartTime>0&&yuyueEndTime>0&&yuyueEndTime>serverTime){useYuyueTime=true;}
var leadSeconds=0,plusType=json.plusType*1;if(startTime>0&&endTime>0){if(plusType>0&&json.plusSeconds>0){leadSeconds=json.plusSeconds;}
startTime+=leadSeconds;try{var setTimeStr=function(date){date=formatTime(new Date(date*1000));return[date.year,date.month,date.day].join('.')+' '+[date.hour,date.min].join(':');};if(useYuyueTime){qiangTimeStr=setTimeStr(yuyueStartTime)+' - '+setTimeStr(yuyueEndTime);stepArr=[{title:'',tip:qiangTimeStr}];}}catch(e){}
if(isPlus){startTime-=leadSeconds;}}
var limit=0,stat=1;if(startTime-serverTime>0){if(!is_Yushou_KO&&!is_SpecKill_KO){note=(leadSeconds>0&&serverTime<startTime-leadSeconds?'limit':'limit');obj.setBtnStatus({buyBtnConfig:{disable:true,txt:(btnStr||'')},addBtnConfig:{disable:true},popupBuyAreaConfig:{disablePopupConfirm:true}},true);limit=startTime-serverTime;}
obj.koStatus=1;}
else if(endTime-serverTime>0||json.errId=='16385'){if(is_Yushou_KO||is_SpecKill_KO){obj.setBtnStatus({buyBtnConfig:{txt:(btnStr||'')},addBtnConfig:{showType:-1}},true);$('#priceSpec i.price_special_icon').removeClass('clock').addClass('timer');$('#specTitle').text(is_Yushou_KO?'':'');if(is_Yushou_KO){stepArr.unshift({title:'',tip:'1. 2. 3.'});}}
obj.setBtnStatus({buyBtnConfig:{disable:false,txt:(btnStr||'')},addBtnConfig:{disable:false,},popupBuyAreaConfig:{disablePopupConfirm:false}},true);obj.koStatus=2;if(useYuyueTime){note='limit';limit=yuyueEndTime-serverTime;}
else if(isPlus&&leadSeconds>0&&serverTime-startTime<leadSeconds){note='limit';limit=startTime+leadSeconds-serverTime;}else{note='limit';limit=endTime-serverTime;}
if(!is_Yushou_KO&&!is_SpecKill_KO)obj.getSkuStock();if(json.errId=='16385')$('#statusNotice').hide();}
else if(endTime>0&&serverTime-endTime>0){if(!is_Yushou_KO&&!is_SpecKill_KO){des='';}
obj.koStatus=3;}
else{if(!is_Yushou_KO&&!is_SpecKill_KO){obj.setBtnStatus({buyBtnConfig:{disable:false,txt:(btnStr||'')},addBtnConfig:{disable:false,},popupBuyAreaConfig:{disablePopupConfirm:false}},true);}
obj.koStatus=2;}
stat=obj.koStatus;if(json.certifiction=='1')setCertification(obj);if(obj.koStatus!=2&&(is_Yushou_KO||is_SpecKill_KO))return;!isSpecSku&&setStepDom({htmlStr:'',stepArr:stepArr});if(obj.koStatus!=2||useYuyueTime){showSpecLimit(obj,{note:note,des:des,limit:limit,hideTimer:isSpecSku,fun:function(){var setEnd=function(){obj.koStatus=3;$('#specTimer').show().html('<p></p>');obj.setBtnStatus({buyBtnConfig:{disable:true,txt:(btnStr||'')},addBtnConfig:{disable:true},popupBuyAreaConfig:{disablePopupConfirm:true}},true);},setTimer=function(flag){$('#plusGuide').hide();if(flag){note='limit';limit=endTime-startTime-leadSeconds;showSpecLimit(obj,{note:note,limit:limit,hideTimer:isSpecSku,fun:setEnd});}else{setEnd();}};if(stat==1){if(isPlus&&leadSeconds>0){note='limit';limit=leadSeconds;$('#plusGuide span.plus_desc').text('PLUS'+(plusType===1?'':'')+'');}else{note='limit';limit=endTime-startTime;$('#plusGuide').hide();}
obj.setBtnStatus({buyBtnConfig:{disable:false,txt:(btnStr||'')},addBtnConfig:{disable:false,},popupBuyAreaConfig:{disablePopupConfirm:false}},true);obj.koStatus=2;stat=2;showSpecLimit(obj,{note:note,limit:limit,hideTimer:isSpecSku,fun:function(){setTimer(isPlus&&leadSeconds>0);}});}
else if(stat==2){setTimer(isPlus&&leadSeconds>0&&serverTime-startTime<leadSeconds);}}});}
if(!isPlus){plusPriorBuy(obj,json);}
if(json.voiceCheck=='1'&&json.voiceCheckStime&&json.voiceCheckEtime){var voiceCheckStime=json.voiceCheckStime*1,voiceCheckEtime=json.voiceCheckEtime*1;var key='voiceCheck';var voiceCheckLimit=voiceCheckStime-serverTime;var voiceCheckEndLimit=voiceCheckEtime-serverTime;if(serverTime<voiceCheckStime){clearInterval(gVar.timmer[key]);gVar.timmer[key]=setInterval(function(){voiceCheckLimit--;voiceCheckEndLimit--;if(voiceCheckLimit<=0&&!obj.isVoiceCheck){obj.isVoiceCheck=true;}
if(voiceCheckEndLimit<=0){clearInterval(gVar.timmer[key]);obj.isVoiceCheck=false;}},1000);}else if(serverTime>=voiceCheckStime&&serverTime<=voiceCheckEtime){obj.isVoiceCheck=true;gVar.timmer[key]=setInterval(function(){voiceCheckEndLimit--;if(voiceCheckEndLimit<=0){clearInterval(gVar.timmer[key]);obj.isVoiceCheck=false;}},1000);}}};if(obj.skuJson[obj.skuId].miao){window.qiangCB(obj.skuJson[obj.skuId].miao);}
else{umpMonitor.createTimeout('18','item miao api fail'+obj.skuId);mLs.loadScript('//wq.jd.com/deal/miao/IsMiao?callback=qiangCB&skuid='+obj.skuId+'&t='+Math.random());}}
function secondKill(obj,opt){var secData=obj.skuJson[obj.skuId].promomiao,isFlash=false,showFlash=false,price={};if(!secData){secData=obj.skuJson[obj.skuId].flashpurchase;if(secData&&secData.yn===1&&secData.st&&secData.et){isFlash=true;showFlash=true;var timeStr=function(date){var dateObj=formatTime(new Date(date));return dateObj.year+'-'+dateObj.month+'-'+dateObj.day+' '+dateObj.hour+':'+dateObj.min+':'+dateObj.sec;};secData.startTime=timeStr(secData.st);secData.endTime=timeStr(secData.et);price=obj.skuJson[obj.skuId].price||{};secData.miaoShaPrice=price.p;secData.jdPrice=price.l||price.op||0;}else{secData=false;}}
if(secData&&secData.startTime&&secData.endTime){if(secData.seckillType=='5')showFlash=true;obj.isSecKill=true;reporter.pingClick('MProductdetail_SecKillPV','','',obj.skuId);if(obj.isJDChoice){window.location.href=obj.getNewSkuUrl(obj.skuId,'general');;return;}
var startTime=new Date(secData.startTime.replace(/-/g,'/')).getTime(),endTime=new Date(secData.endTime.replace(/-/g,'/')).getTime(),serverTime=secData.serverTime*1000,is_Yushou_KO=opt&&opt.is_Yushou_KO,limit=0,note='',secStat=0,setStatDom=function(noStock){var btnStr=((obj.cfeeType&&obj.cfeeType.ft!=100)?getFeeBtnStr(obj.cfeeType.ft):'');obj.setBtnStatus({buyBtnConfig:{disable:false,txt:(btnStr||'')},addBtnConfig:{disable:false},popupBuyAreaConfig:{disablePopupConfirm:false}},true);if(!noStock)obj.getSkuStock();var $announce=$('#secondKillAnnounce'),$notice=$('#buyNoticeArea');if(secStat===1){var disShow=false;if(secData.displayTime){var displayTime=new Date(secData.displayTime.replace(/-/g,'/')).getTime();if(serverTime>=displayTime){disShow=true;}}else if(serverTime+86400000>=startTime){disShow=true;}
if(!$announce.length){$notice.prepend('<div id="secondKillAnnounce" class="price_wrap"><span class="tip_red">'+(showFlash?' ':' ')+'</span><span class="desc de_c_red">'+(showFlash?(''):'')+'</span></div>');$announce=$('#secondKillAnnounce');}
if(disShow){$notice.show();}else{$notice.hide();}}else{$notice.hide();if(secData.miaoShaPrice*1>0&&secData.miaoShaPrice*1<secData.jdPrice*1){var $dom=$('#specOldPrice');$dom.html('&yen;'+(secData.jdPrice*1).toFixed(2)).show();}}};if(serverTime<startTime){if(isFlash){if(serverTime>secData.pst)secStat=1;}else{secStat=1;}
profitBelt(obj);}else if(serverTime>startTime&&serverTime<endTime){if(showFlash&&price.tkp&&price.tkp>0&&price.tkp<price.p)return;secStat=2;note=(showFlash?'limit':'limit');limit=endTime-serverTime;}
if(is_Yushou_KO&&secStat<2)return;limit/=1000;if(secStat>0){var stepArr=[];if(is_Yushou_KO){$('#specTitle').text(showFlash?'':'');stepArr.push({title:'',tip:showFlash?'1. 2. 3.':'1. 2. 3.'});}else{if(secStat===2)yuShouSetDom(showFlash?5:4);}
stepArr.push({title:showFlash?'':'',tip:secData.startTime.replace(/-/g,'.')+'-'+secData.endTime.replace(/-/g,'.')});setStepDom({htmlStr:'',stepArr:stepArr});setStatDom(!is_Yushou_KO);if(limit>0){showSpecLimit(obj,{note:note,limit:limit,limitAll:showFlash,fun:function(){var setEnd=function(){secStat=3;$('#priceSpec,#buyNoticeArea').hide();$('#priceBlock').show();$('#favShopGuideContainer').show();limit=0;setStatDom();};if(secStat===1){secStat=2;note=(showFlash?'limit':'limit');limit=endTime-startTime;setStatDom();}else{setEnd();}
if(limit>0){showSpecLimit(obj,{note:note,limit:limit,fun:setEnd});}}});}}}else{obj.isSecKill=false;if(!obj.isJDChoice&&!obj.isInit&&obj.isJx){window.location.href=obj.getNewSkuUrl(obj.skuId,'jx');}else if(!obj.isJDChoice&&opt&&opt.needBanner){profitBelt(obj);}}}
function setStepDom(opt){opt=opt||{};opt.htmlStr=(opt.htmlStr||'');if(opt.stepArr&&opt.stepArr.length>0){var flowHtmlArr=[],stepItem={},flowTpl='<li class="buy_tip_v2_line"><span class="buy_tip_v2_title">{#title#}</span>{#tip#}</li>';for(var i=0,len=opt.stepArr.length;i<len;i++){stepItem=opt.stepArr[i];if(stepItem.title&&stepItem.tip){flowHtmlArr.push($jsonToTpl(stepItem,flowTpl));}}
if(flowHtmlArr.length>0){opt.htmlStr+='<ul class="buy_tip_v2">'+flowHtmlArr.join('')+'</ul>';}}
if(opt.htmlStr){var $notice=$('#buyNoticeArea');if(!$notice.length){var lastChildId=opt.lastChildId||'priceSpec2';$('#'+lastChildId).after('<div class="de_buy_tip" id="buyNoticeArea"></div>');$notice=$('#buyNoticeArea');}
$notice.html(opt.htmlStr).show();if(opt.eventFunc){$notice.off().on('click',opt.eventDom,opt.eventFunc);}}}
function specStateSwitch(obj,opt){opt=opt||{};var is_Yushou_KO=opt.is_Yushou_KO,is_SpecKill_KO=opt.is_SpecKill_KO,qiangTimeBet=opt.qiangTimeBet||[];if(is_Yushou_KO||is_SpecKill_KO){if(is_Yushou_KO){secondKill(obj,opt);}
var koParam={is_Yushou_KO:is_Yushou_KO,is_SpecKill_KO:is_SpecKill_KO,qiangTimeBet:qiangTimeBet};if((obj.item().spAttr&&obj.item().spAttr.isKO=='1')||(obj.skuJson[obj.skuId].miao&&obj.skuJson[obj.skuId].miao.isKo=='1')){qianggou(obj,koParam);return;}
window.isMiaoCB=function(miaoData){if(miaoData.isKo==1){obj.skuJson[obj.skuId].miao=miaoData;qianggou(obj,koParam);}};mLs.loadScript('//wq.jd.com/deal/miao/IsMiao?callback=isMiaoCB&skuid='+obj.skuId+'&t='+Math.random());}}
function remainTime(remain){var addZero=function(num){return(num*1<10?'0':'')+num;};var sec=remain%60;remain=(remain-sec)/60;sec=addZero(sec);var minute=remain%60;remain=(remain-minute)/60;minute=addZero(minute);var hour=remain%24;remain=(remain-hour)/24;hour=addZero(hour);var day=remain;if(day>0){day=addZero(day);}
return{day:day,hour:hour,min:minute,sec:sec};}
function setTimeLimit(opt){var limit=opt.limit,fun=opt.fun,key=opt.key,t=limit,timmer=gVar.timmer[key],tpl=opt.tpl,$timer=opt.$timer;if(timmer)clearInterval(timmer);timmer=null;if(limit>0){var remainTimeStr=function(remain){var timeObj=remainTime(remain),outStr='';if(opt.dayTpl&&timeObj.day>0){outStr=$jsonToTpl({day:timeObj.day},opt.dayTpl);}
outStr+=$jsonToTpl(timeObj,tpl);return outStr;};timmer=setInterval(function(){t--;if(t>0){$timer.html(remainTimeStr(t));}
else{clearInterval(timmer);timmer=null;fun&&fun();}},1000);}}
function showSpecLimit(obj,opt){opt=opt||{};var limit=opt.limit,fun=opt.fun,note=opt.note||'',des=opt.des||'',$time=$('#specTimer'),limitStr='';if(note){limitStr+='<p class="countdown_text">'+note.replace('limit','')+'</p>';}
if(des){limitStr+='<p class="countdown_des">'+des+'</p>';}
if(~note.indexOf('limit')){limitStr+='<p class="countdown_nums" id="timeLimit"></p>';!opt.hideTimer&&$time.html(limitStr).show();var $dom=$('#timeLimit');if(limit<0||(!opt.limitAll&&limit>3600*24*3)){$dom.hide();if(limit>3600*24*3)$time.hide();return;}
$dom.show();var remainTimeStr=function(remain){var timeObj=remainTime(remain),outStr='';if(timeObj.day*1>0){outStr='<span class="box type_big">'+timeObj.day+'</span>';}else{[timeObj.hour,timeObj.min,timeObj.sec].forEach(function(val){outStr+='<span class="box">'+val+'</span>';outStr+=':';});}
return outStr.replace(/\:$/,'');};var t=limit;clearInterval(obj.timmer);obj.timmer=null;obj.timmer=setInterval(function(){t--;if(obj.skuJson[obj.skuId]){if(obj.skuJson[obj.skuId].miao)obj.skuJson[obj.skuId].miao.serverTime++;if(obj.skuJson[obj.skuId].promomiao)obj.skuJson[obj.skuId].promomiao.serverTime++;if(obj.skuJson[obj.skuId].yuyue)obj.skuJson[obj.skuId].yuyue.d--;if(obj.skuJson[obj.skuId].flashpurchase)obj.skuJson[obj.skuId].flashpurchase.serverTime++;}
if(t<=0){clearInterval(obj.timmer);obj.timmer=null;fun&&fun();}
else{$dom.html(remainTimeStr(t));}},1000);}else{!opt.hideTimer&&$time.html(limitStr).show();}}
function setCertification(obj){if(!loginHandler.getLoginStatus()){loginHandler.login(null,function(){setCertification(obj);});return;}
var $dom=$('#certificationNotice');if(!$dom.length){$('#part_main').append('<div class="detail_realName" id="certificationNotice">'+'  <p class="tips"></p>'+' </div>');$dom=$('#certificationNotice');}
$dom.show();var $domTip=$dom.find('p.tips');$domTip.html('');$('#popupNotice').hide();$('.mod_aside_v2').css('bottom','106px;');obj.realNameAuth({cb:function(isVerify){if(isVerify){$domTip.html('');}else{obj.setBtnStatus({buyBtnConfig:{disable:true},addBtnConfig:{disable:true},popupBuyAreaConfig:{disablePopupConfirm:true}},true);var buyUrl=obj.locationUrl;if(obj.koStatus==2||obj.yushouStatus==4){buyUrl=(obj.getBuyLink()||buyUrl);}
userInfo.getPinStatus({url:buyUrl,cb:function(pinObj){pinObj=pinObj||{};var tourl='//msc.jd.com/auth/loginpage/wcoo/toAuthPage?source=4&businessType=539&directReturnUrl='+encodeURIComponent(buyUrl),tipStr='';if(pinObj.isPerfect){tipStr='';}else if(pinObj.isBind){tipStr='';}else if(pinObj.isSwitch){tipStr='';}else{tipStr='';}
$domTip.html('<span>'+tipStr+'&gt;&gt;</span>').off().on('click','span',function(){window.location.href=tourl;});}});}}});}
function setSkuAttach(obj,json){if(obj.isHeyueChange){obj.isHeyueChange=false;return;}
var html=[],popHtml=[],fee=json.datas,cno=mCookie.get('ftNo');mCookie.del('ftNo');gVar.comboSkuInfo=fee;obj.setBtnStatus({popupBuyAreaConfig:{btnShowType:2}},true);if(json.dis){obj.setBtnStatus({msgConfig:{msg:''+obj.jdAddrName[1]+obj.jdAddrName[2]},buyBtnConfig:{disable:true},addBtnConfig:{disable:true}},true);return;}
var ots='',popots='',feeItem={},skuStrArr=[],popskuStrArr=[];for(var i=0,len=fee.length;i<len;i++){feeItem=fee[i];ots=' option_selected';popots=' active';if(cno>0){ots=(cno-1===i?ots:'');popots=(cno-1===i?popots:'');}
else if(feeItem.che!=1){ots='';popots='';}
html.push('<span indx='+i+' class="option'+ots+'">'+feeItem.name+'</span>');popHtml.push('<span indx='+i+' class="item'+popots+'">'+feeItem.name+'</span>');if(ots){gVar.skuAttachNo=i;gVar.cfee=feeItem;}}
if(html.length){skuStrArr.push($jsonToTpl({no:'Attach1',name:'',option:html.join('')},window._skuTpl));popskuStrArr.push($jsonToTpl({no:'Attach1',name:'',option:popHtml.join('')},window._skuPopTpl));}
if(gVar.cfee){var htmlArr=setCfeeType(obj,null);if(htmlArr.length>0){skuStrArr.push(htmlArr[0]||'');popskuStrArr.push(htmlArr[1]||'');}
if(skuStrArr.length>0){$('#popupSkuAttach').html(popskuStrArr.join('')).show();}
$('#skuAttach1,#skuPopAttach1').off().on('click','span',function(){obj.isChangeSku=true;var $target=$(this),spanIndex=$target.index();if($target.hasClass('active|option_selected'))return;$('#skuAttach1 span').removeClass('option_selected').eq(spanIndex).addClass('option_selected');$('#skuPopAttach1 span').removeClass('active').eq(spanIndex).addClass('active');gVar.skuAttachNo=$target.attr('indx');gVar.cfee=gVar.comboSkuInfo[gVar.skuAttachNo];obj.jdStatus=true;setCfeeType(obj,null);if(!obj.cfeeType)return;if(obj.cfeeType.sku!=obj.skuId){mCookie.set('ftNo',gVar.skuAttachNo*1+1,1);location.href=location.href.replace(obj.baseSkuId,obj.cfeeType.sku);return;}
if((obj.yushouStatus==0&&obj.koStatus==0)||obj.yushouStatus==4||obj.koStatus==2)setHeyueStatNew(obj.cfeeType&&obj.cfeeType.ft);if(obj.timmer){clearInterval(obj.timmer);obj.timmer=null;}
obj.isHeyueChange=true;obj.setItemInfo();});$('#skuAttach2,#skuPopAttach2').off().on('click','span',function(){obj.isChangeSku=true;var $target=$(this),spanIndex=$target.index();if($target.hasClass('active|option_selected'))return;$('#skuAttach2 span').removeClass('option_selected').eq(spanIndex).addClass('option_selected');$('#skuPopAttach2 span').removeClass('active').eq(spanIndex).addClass('active');obj.jdStatus=true;setCfeeType(obj,$target.attr('indx')*1+1);if(obj.cfeeType&&obj.cfeeType.sku&&obj.jdStatus){obj.jdSkuStatus=true;obj.changeSkuId=obj.cfeeType.sku;$('#statusNotice,#popupNotice').hide();obj.setItemInfo({itemType:'heyue'});}else{obj.jdSkuStatus=false;}});}}
function setCfeeType(obj,cno){if(!gVar.cfee)return[];gVar.cfee.feetypes=gVar.cfee.feetypes||[];var len=gVar.cfee.feetypes.length,html=[],popHtml=[],feeItem={},ots='',popots='',outStrArr=[];if(cno>0){obj.cfeeType=gVar.cfee.feetypes[cno-1];}else if(len>1){for(var i=0;i<len;i++){feeItem=gVar.cfee.feetypes[i];ots='';popots='';if(feeItem.che===1){ots=' option_selected';popots=' active';obj.cfeeType=feeItem;}
html.push('<span indx='+i+' class="option'+ots+'">'+feeItem.name+'</span>');popHtml.push('<span indx='+i+' class="item'+popots+'">'+feeItem.name+'</span>');}
outStrArr.push($jsonToTpl({no:'Attach2',name:'',option:html.join('')},window._skuTpl));outStrArr.push($jsonToTpl({no:'Attach2',name:'',option:popHtml.join('')},window._skuPopTpl));}else{obj.cfeeType=gVar.cfee.feetypes[0];}
feeItem=obj.cfeeType;if(feeItem){obj.maxBuyNum=(feeItem.ft==100?200:1);(feeItem.ft==12&&feeItem.sids)?obj.itemPrice.getComboSkuPrice(feeItem.sids,function(){obj.jdPrice=obj.itemPrice.jdPrice;}):obj.itemPrice.getSingleSkuPrice(feeItem.sku,function(){obj.jdPrice=obj.itemPrice.jdPrice;});if(feeItem.ft!=100){obj.setBtnStatus({buyBtnConfig:{txt:getFeeBtnStr(feeItem.ft)},addBtnConfig:{showType:-1}},true);}
if(feeItem.stat==0){obj.setBtnStatus({buyBtnConfig:{disable:true},addBtnConfig:{disable:true},popupBuyAreaConfig:{disablePopupConfirm:true}},true);return outStrArr;}
var wxSupport=((obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].feetype&&obj.skuJson[obj.skuId].feetype.group&&obj.skuJson[obj.skuId].feetype.group.mobile)||'');if(~wxSupport.indexOf(feeItem.ft)){obj.setBtnStatus({buyBtnConfig:{disable:false},addBtnConfig:{disable:false,},popupBuyAreaConfig:{disablePopupConfirm:false}},true);}else{obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{disable:true},addBtnConfig:{disable:true},popupBuyAreaConfig:{disablePopupConfirm:true}},true);}}
return outStrArr;}
function setHeyueStatNew(ft){if(ft!=100){$('#buyBtn2 span.txt,#buyBtn1').html(getFeeBtnStr(ft));$('#addCart2,#addCart1').hide();}
else{$('#buyBtn2 span.txt,#buyBtn1').html('');$('#addCart2,#addCart1').show();}}
function getFeeBtnStr(ft){if(ft==18)return'';if(ft==100)return'';return'';}
function setStorePriceTip(param,obj){if(obj&&obj.locAddCartDirect)return;var $storePrice=$('#priceSale,#priceSale1,#priceSale2,#priceSaleStore'),$storePriceTip1=$('#storePriceTip1'),$storePriceTip2=$('#storePriceTip2');if(param){$storePrice.html(param);$storePriceTip1.hide();$storePriceTip2.show();}else{$storePriceTip1.show();$storePriceTip2.hide();}
if(!gVar.hasBindStorePriceTipEvent){$('#storePriceTip1, #storePriceTip2').on('click',function(){popUp.createPopup({flag:11,title:'',msg:''});});gVar.hasBindStorePriceTipEvent=true;}}
function showStore(obj){obj.locShopInfo.isLOC=true;if(!(obj.venderId*1))return;$('#sendArea').hide();$('#storeChoose2').html('');$('#storeSkuChoose').html(obj.skuChooseArr.concat(obj.buyNumController.buyNum+'').join(','));if(obj.cpart=='store'&&!obj.isInit){window.wa&&window.wa('jdClick',{ptag:'7001.1.307'});mLoc.refreshSku(obj.skuId);deleteChoosedStore(obj);return;}
var shopBaseId=false;if(document.referrer&&document.referrer.indexOf('cart/cart.action')>0){try{if(!obj.isZxService){shopBaseId=JSON.parse(mCookie.get('shopBaseId')||'{}');}}catch(e){}
if(!shopBaseId||!(shopBaseId.locationId&&shopBaseId.locationId.split('-').length==3)||!shopBaseId.shopId||shopBaseId.venderId!=obj.venderId){shopBaseId=false;}}
obj.locShopInfo.locGroupId=(obj.item().spAttr?obj.item().spAttr.locGroupId:'');$('#storePanel,#storePanel2,#specBuyBtn,#specBuyBtn1').off().on('click',function(){try{window.wa&&wa('jdClick',{sku_id:obj.skuId,vender_id:obj.venderId||'',ptag:'7001.1.55'});}catch(e){}
history.pushState({page:1},'title 1','#store');obj.historyStateChange('#store');obj.storeHash=true;storeChoose(obj);});if(obj.isWholeVehicle){reporter.reportExposure({ptag:'7001.6.43'});$('#specBuyBtn,#specBuyBtn1').off().on('click',function(){var burl='//carbrand.jd.com/m/html/reservationCar.html?skuId='+obj.changeSkuId;if(obj.storeData&&obj.storeData.storeId){burl+='&storeId='+obj.storeData.storeId;}
location.href=burl;});}
$('#storeSkuChoose').off().on('click',function(){popUp.showPopupArea(3);});$('#storePopupConfirm').off().on('click',function(){if(!obj.jdSkuStatus){obj.skuSwitch.showSkuArea();return;}
popUp.showHidePopup($('#popupBuyArea'),false);});$.subscribe('item.store.refreshStoreList',function(){deleteChoosedStore(obj);});$(window).on('hashchange',function(){if(window.location.hash==='#store')return;if(!obj.storeHash)return;popUp.showHidePopup($('#popupBuyArea'),false);obj.storeHash=false;mLoc.reset();if(obj.locAddCartDirect)return;if(!obj.storeData){if(!obj.isWareOff&&obj.stockState[obj.skuId]!=3){obj.setBtnStatus({msgConfig:{msg:obj.isWholeVehicle||obj.locAddCartDirect?'':''},buyBtnConfig:{showType:1,txt:obj.isWholeVehicle?'':''},addBtnConfig:{showType:obj.isWholeVehicle?0:-1},popupBuyAreaConfig:{btnShowType:2}},true);}}else{setStoreArea(obj.storeData,obj);}});if(shopBaseId){obj.locShopInfo['shopBaseId']=shopBaseId;var locShops=[];var currentPage=1;var requestData=function(){var addrId=shopBaseId.locationId.split('-');var level=0,addressid=0;for(var i=0;i<addrId.length;i++){if(addrId[i]>0)level++;}
addressid=addrId[level-1];mLs.loadScript(['//wq.jd.com/commodity/lbslocshop/getshoplistbyaddrid?callback=storeInfo&pagesize=20','page='+currentPage,'venderid='+obj.venderId,'shopgroupid='+obj.locShopInfo.locGroupId,'addressid='+addressid,'level='+level,'t='+Math.random()].join('&'));};requestData();window.storeInfo=function(json){if(json&&json.data){locShops=locShops.concat(json.data.itemList||[]);if(json.data.totalPage>currentPage){currentPage++;requestData();return;}}
var locShop=locShops[0];if(shopBaseId){for(var i=0,len=locShops.length;i<len;i++){if(shopBaseId.shopId==locShops[i].storeId){locShop=locShops[i];break;}}}
if(!locShop){$('#storeName').html(' '+(decodeURIComponent(shopBaseId.locname)||'')+' ');setStorePriceTip(false,obj);$('#storeAttrPhone').hide();return;}
setStoreArea(locShop,obj);};obj.isZxService?$('#storePanel2').show():$('#storePanel').show();}else{var coords=mCookie.get('coords');try{coords=JSON.parse(coords);}catch(e){}
$('#storeName').html(obj.locAddCartDirect?'':'').addClass('de_c_red');setStorePriceTip(false,obj);$('#storeAttrPhone').hide();obj.isZxService?$('#storePanel2').show():$('#storePanel').show();if(!obj.isWholeVehicle&&!obj.locAddCartDirect){obj.setBtnStatus({msgConfig:{msg:''}},true);}
if(!coords||!coords.longitude||!coords.latitude){mCookie.del('coords','/',obj.domainStr);umpMonitor.createTimeout('12','item getloc api timeout');}
else{obj.locShopInfo['locCoords']=coords;}
getMyLocation(function(location){if(obj.locAddCartDirect&&((location&&location.longitude&&location.latitude)||obj.locShopInfo['locCoords'])){var longitude=(location&&location.longitude)||(obj.locShopInfo['locCoords']&&obj.locShopInfo['locCoords'].longitude);var latitude=(location&&location.latitude)||(obj.locShopInfo['locCoords']&&obj.locShopInfo['locCoords'].latitude);if(!window.getNearLocShop){window.getNearLocShop=function(body){if(body.errcode==0&&body.data&&body.data[0]){var result=body.data[0];setStoreArea({locationid:result.addOneCode&&result.addSecCode?result.addOneCode+'-'+result.addSecCode+'-'+(result.addCode||0):'',id:result.storeId,name:result.storeName,fullAddress:result.storeAddress,phone:result.phone},obj);obj.locAddCartDirectUseGeo=true;}};}
mLs.loadScript(['//wq.jd.com/commodity/lbslocshop/getnearlocshop?callback=getNearLocShop','shopgroupid='+obj.locShopInfo.locGroupId,'longitude='+longitude,'latitude='+latitude].join('&'));}else if(obj.locAddCartDirect){if(!window.oneStoreInfo){window.oneStoreInfo=function(json){if(json&&json.data&&json.data.itemList&&json.data.itemList.length>0){setStoreArea(json.data.itemList[0],obj);}};}
mLs.loadScript(['//wq.jd.com/commodity/lbslocshop/getshoplistbyaddrid?callback=oneStoreInfo&pagesize=10&page=1&level=2','venderid='+obj.venderId,'shopgroupid='+obj.locShopInfo.locGroupId,'addressid='+obj.jdAddrId[1],'t='+Math.random()].join('&'));}
umpMonitor.delTimeout('itil12');JD.report.umpBiz({bizid:bizid,operation:'12',result:'0',source:'0',message:'item getloc api timeout'});if(!obj.locShopInfo.locCoords){coords=mCookie.get('coords');try{coords=JSON.parse(coords);}catch(e){}
obj.locShopInfo.locCoords=coords;}});}}
function deleteChoosedStore(obj){obj.hasChoosedStore=false;obj.storeData=null;setStorePriceTip(false,obj);obj.locShopInfo.shopId='';obj.locShopInfo.locationId='';$('#storeName').html(obj.locAddCartDirect?'':'').addClass('de_c_red');$('#storeAttrPhone').hide();if(!obj.isWareOff&&obj.stockState[obj.skuId]!=3){obj.setBtnStatus({msgConfig:{hideMsg:true},buyBtnConfig:{showType:obj.isWholeVehicle?1:(obj.jdStatus?0:-1),txt:obj.isWholeVehicle?'':''},addBtnConfig:{showType:obj.isWholeVehicle?0:(obj.jdStatus?0:-1)}});}}
function setStoreArea(data,obj){obj.storeData=data;var shopBaseId={};obj.locShopInfo.shopId=data.storeId;obj.locShopInfo.locationId=(data.regionId?data.regionId.split('-').slice(0,2).join('-')+'-0':(data.locationid||(obj.locShopInfo&&obj.locShopInfo.shopBaseId&&obj.locShopInfo.shopBaseId.locationId)));var strs=data.name+''+(data.distance>0?('<span class="de_c_orange"> (: '+(data.distance/1000).toFixed(1)+' KM)</span>'):'');if(obj.isZxService){$('#storeChoose2').html(strs);}else{$('#storeName').html(strs).removeClass('de_c_red');}
$('#storeAttr').html(data.fullAddress);if(data.phone){$('#storePhone').html(data.phone);$('#storePhoneItem').attr('href','tel:'+data.phone);}else{$('#storePhoneItem').hide();}
$('#storeAttrPhone').show();if(!data.fullAddress)$('#storeAttrItem').hide();if(!data.fullAddress&&!data.phone)$('#storeAttrPhone').hide();if(!obj.isWareOff&&obj.stockState[obj.skuId]!=3){obj.setBtnStatus({msgConfig:{hideMsg:true},buyBtnConfig:{showType:obj.isWholeVehicle?1:(obj.jdStatus?0:-1),txt:obj.isWholeVehicle?'':''},addBtnConfig:{showType:obj.isWholeVehicle?0:(obj.jdStatus?0:-1)}});obj.jdStatus=true;obj.getSkuStock(obj.skuJson[obj.skuId].stock);}
shopBaseId.venderId=obj.venderId;shopBaseId.locationId=obj.jdAddrId.slice(0,2).join('-')+'-0';if(obj.locShopInfo.locationId&&obj.locShopInfo.locationId.split('-').length==3){shopBaseId.locationId=obj.locShopInfo.locationId;}
shopBaseId.shopId=obj.locShopInfo.shopId;var val=JSON.stringify(shopBaseId);!obj.isZxService&&mCookie.set('shopBaseId',val,60,'/',obj.domainStr);obj.locShopInfo.shopBaseId=shopBaseId;}
function storeChoose(obj){if((!obj.locShopInfo.shopBaseId)&&(!obj.locShopInfo.locCoords)){var coords={longitude:116.397947,latitude:39.9081726},val=JSON.stringify(coords);mCookie.set('coords',val,60,'/',obj.domainStr);}
mLoc.list({'locAddCartDirect':obj.locAddCartDirect,'locationid':obj.locAddCartDirectUseGeo?obj.locShopInfo.locationId:(obj.locShopInfo.locationId||(obj.jdAddrId.slice(0,2).join('-')+'-0')),'jdAddrName':obj.locAddCartDirectUseGeo?[]:obj.jdAddrName,'venderid':obj.venderId,'shopid':obj.locShopInfo.shopId,'locGroupId':obj.locShopInfo.locGroupId,'skuId':obj.skuId,'needCoords':!obj.isZxService,},function(data){if(!data)return;obj.storeData=data;obj.hasChoosedStore=true;var priceStr=obj.itemPrice.setSpecPrice({p:data.price,flag:2});setStorePriceTip(priceStr,obj);obj.locShopInfo.shopId=data.storeId;obj.locShopInfo.locationId=(data.regionId?data.regionId.split('-').slice(0,2).join('-')+'-0':(data.locationid||obj.locShopInfo.shopBaseId.locationId));obj.getSkuStock(obj.skuJson[obj.skuId].stock);});obj.hasChoosedStore=!!obj.locShopInfo.shopId;setTimeout(function(){if(!obj.isWareOff&&obj.stockState[obj.skuId]!=3){if(!obj.isWholeVehicle){obj.setBtnStatus({msgConfig:{hideMsg:true},buyBtnConfig:{showType:(obj.jdStatus?0:-1),txt:''},addBtnConfig:{showType:(obj.jdStatus?0:-1)}});}}
window.scroll(0,0);},300);}
function tencentVideo(){$('#gotoCart,#sendArea').hide();reporter.reports({ptag:'7404.1.1'});var $dom=$('#tencentWrap');if(!$dom.length){$('#sendArea').after('<div class="detail_row dispatch_way" id="tencentWrap"><div class="de_row"><div class="tit"><br></div><div class="de_span info"><div class="name"></div></div></div><div class="de_row addr"><i class="icon_point"></i><div class="de_span"><div class="de_oline"></div></div></div></div>');$dom=$('#tencentWrap');$dom.off().on('click','div.de_row.addr',function(){window.location.href='//wqs.jd.com/event/promote/TVmemberactivate/index.shtml';});}
$dom.show();}
function showJdGame(obj,ruId){var isJXBM=(ruId=='45054404');reporter.reports({ptag:'7358.1.4'});$('#gotoCart,#popupCount,#sendArea').hide();obj.locJdGame.isGame=true;loadMartData(obj);obj.loadScriptJs({tag:'svg',url:'//wq.360buyimg.com/fd/h5/base/detail/js/detail.min_0c34fc02.js'});$('#specBuyBtn,#specBuyBtn1').off().on('click',function(){var $this=$(this);if($this.hasClass('btn_disable')||$this.hasClass('disabled_1'))return;reporter.txReport({ptag:'7001.1.8'});location.href='//wqs.jd.com/item/jd_game.shtml?'+(ruId?'ruId='+ruId+'&':'')+'sceneval=2&sku='+obj.skuId+'&ptag=7358.1.1&venderid='+obj.venderId+'&commlist='+[obj.skuId,obj.itemId,obj.buyNumController.buyNum,obj.skuId,'1,0,0'].join(',');});window.jdGameCB=function(json){if(json.retCode=='0'&&json.locmatchinfo){obj.jdSkuInfo['jdGame'+obj.skuId]=json;if(!$('#jdGameWrap').length&&!isJXBM){$('#sendArea').after('<div class="detail_competition" id="jdGameWrap" ptag="7358.1.3"></div>');}
var htmlStr='<i class="link" id="jdGameLink"></i>',gameInfo=json.locmatchinfo,startTime=formatTime(new Date(gameInfo.activityBegin*1)),endTime=formatTime(new Date(gameInfo.activityEnd*1)),timeStr=function(v){return v.year+''+v.month+''+v.day+''+v.hour+':'+v.min;},serTime=(json.sertime*1000||(new Date().getTime()));if(gameInfo.detailAddress){var detailAddress=(gameInfo.provinceName||'')+(gameInfo.cityName||'')+(gameInfo.countyName||'')+(gameInfo.townName||'')+gameInfo.detailAddress;htmlStr+='<p class="msg" id="jdGameAddr"><span class="title"></span>'+detailAddress+'</p>';htmlStr+='<p class="msg"><span class="title"></span>'+timeStr(startTime)+'-'+timeStr(endTime)+'</p>';htmlStr+='<p class="msg"><span class="title"></span>'+gameInfo.activitiesIllustration+'</p>';if(gameInfo.stock!=-1){htmlStr+='<p class="msg"><span class="title"></span>'+(gameInfo.stock>0?gameInfo.stock:0)+'</p>';}
if((gameInfo.stock<=0&&gameInfo.stock!=-1)||serTime>gameInfo.activityEnd){obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{disable:true}},true);}
var coords=gameInfo.coordinate,addrName=detailAddress;if(!isJXBM)$('#jdGameWrap').html(htmlStr).show();if(!coords){$('#jdGameLink').hide();}else{$('#jdGameAddr,#jdGameLink').off().on('click',function(){jumpMap(coords,addrName,addrName);});}}}};if(obj.jdSkuInfo['jdGame'+obj.skuId]){window.jdGameCB(obj.jdSkuInfo['jdGame'+obj.skuId]);}else{mLs.loadScript('//wq.jd.com/commodity/locmatch/getlocmatchinfo?callback=jdGameCB&sceneval=2&skuid='+obj.skuId+'&t='+Math.random());}}
function loadMartData(obj){if(!obj.locJdGame.isGame)return;var actId='71351',areaIds=['123080','122494','122493','126025'],svg=['shoe','clothes','dumbbell','cup'],svgWidth=[23,14,18,14],svgName=['','','',''],martCB=function(json){if(json.errCode=='0'&&json.data&&json.data.length>0){if(!obj.jdSkuInfo.gameMart)obj.jdSkuInfo.gameMart=json;var areaItem={},areaItemId='',areaList=[],tabTpl='<a href="javascript:void(0);" class="tab_item" areaid="{#areaid#}" id="game_{#areaid#}"><svg style="width:{#width#}px;height:23px;"> <use xmlns:xlink="//www.w3.org/1999/xlink" xlink:href="#{#svg#}"></use></svg> {#svgName#} </a>',bdTpl='<li class="grid_item"><a href="{#sUrl#}" onclick="return !window.holdAction;"><div class="img_wrap"><img back_src="{#imgUrl#}"></div><h1 class="name">{#sItemName#}</h1><div class="buy_wrap"><span class="price">{#price#}</span></div></a></li>',tabHtml=[],bdHtml=[],priceStr='';for(var i=0,len=json.data.length;i<len;i++){areaItem=json.data[i];areaList=areaItem.list||[];if(areaList.length>0){areaItemId=areaList[0].dwAreaId;obj.jdSkuInfo['game'+areaItemId]=areaList.slice(0,12);}}
var showArea=false;for(var i=0,len=areaIds.length;i<len;i++){tabHtml.push($jsonToTpl({areaid:areaIds[i],width:svgWidth[i],svg:svg[i],svgName:svgName[i]},tabTpl));areaList=obj.jdSkuInfo['game'+areaIds[i]]||[];bdHtml=[];for(var j=0,lenj=areaList.length;j<lenj;j++){areaItem=areaList[j];areaItem.imgUrl=JD.img.getImgUrl(areaItem.sImg200x200||'',316,421);areaItem.sUrl=mUtil.addRd(areaItem.sUrl,'7358.1.2');priceStr='';if(areaItem.dwActMinPrice>0){priceStr=obj.itemPrice.setSpecPrice({p:areaItem.dwActMinPrice,flag:1});}
areaItem.price=priceStr;bdHtml.push($jsonToTpl(areaItem,bdTpl));}
obj.locJdGame[areaIds[i]]=bdHtml;if(bdHtml.length>0){showArea=true;}}
if(showArea&&!$('#gameArea').length){$('#guessArea').hide();$('#guessArea').before('<div class="detail_cmd" id="gameArea"><div class="detail_cmd_tab_competition" id="gameTab"></div><div class="bd" id="gameBd"></div></div>');}
$('#gameTab').html(tabHtml.join(''));$('#game_'+areaIds[0]).addClass('cur');$('#gameBd').html($jsonToTpl({accessoryTab:'',tag:'game'},$('#guessTpl').html()));obj.setLoopDom({html:obj.locJdGame[areaIds[0]],tag:'game',loopScroll:true,divClassName:'slider_page competition_goods',ulClassName:'grid',num:4});obj.locJdGame.areaId=areaIds[0];}};if(obj.jdSkuInfo.gameMart){$('#gameArea').show();$('#guessArea').hide();}else{mWfdata.getData({dataType:mWfdata.DataType.MART_MUTI,param:{tpl:6,pcs:actId+':'+areaIds.join(':20,'+actId+':')+':20',callback:'gameMartCB'},cb:martCB});}}
function landingMatch(obj){$('#landingMatch').hide();var item=obj.item().spAttr,isLOC=(item&&item.isLOC>0);if(isLOC)return;var category1=obj.jdCategory[0],venderId=obj.venderId;var isFreeload=item.isFreeload&&item.isFreeload==1;if(isFreeload){var stock=((obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].stock)||{}),vsc=stock.vsc,infoKey='vsc'+obj.skuId+'_'+obj.buyNumController.buyNum;window.landingVscCB=function(json){var vsc=json.vsc;if(json.stock!=1){gVar.jdSkuInfo[infoKey]=json;}
var tpl='<li>{#name#}<span class="money">&yen;{#charge#}</span></li>',htmlArr=[],partTpl='<h1>{#name#}</h1><p>{#desc#}</p>{#desc1#}',partArr=[],no=1;vsc=vsc.sort(function(a,b){if(a.isDefault&&!b.isDefault){return-1;}else if(b.isDefault&&!a.isDefault){return 1;}else{return a.seq-b.seq;}});for(var i=0,len=vsc.length;i<len;i++){item=vsc[i];if(obj.isZiying&&item.id&&item.isDefault&&!obj.svcid){obj.svcid=[obj.skuId,item.id].join('|');}
if(item.name&&item.id!=100000){item.name+='  ';item.no=(no++);item.charge=(item.charge>0?item.charge:0);item.charge=(item.charge*1).toFixed(2);htmlArr.push($jsonToTpl(item,tpl));partArr.push($jsonToTpl(item,partTpl));}}
if(htmlArr.length>0){if(!$('#landingMatch').length){$('#sendArea').after('<div class="detail_row detail_deliver_serve" id="landingMatch"><div class="de_row"><div class="tit"><br></div><div class="de_span"><p class="deliver_head"><i class="get_info" id="landingDetail"></i></p><ul class="deliver_list" id="landingList"></ul></div></div></div>');$('#part_main').after('<div class="mod_serve_illustration" id="part_landing" style="display:none;"><div class="head"><div class="p_wrap"> <p></p> <p>, , </p></div></div><article class="illustration" id="partLanding"></article><div class="bottom_fix_btn bg_blue"></div></div>');if(obj.isZiying){$('#landingMatch .deliver_head').text('');$('#landingDetail').hide();}
$('#landingDetail').off().on('click',function(){history.pushState({page:1},"title 1","#landing");obj.historyStateChange('#landing');});$('#part_landing').off().on('click','div.bottom_fix_btn.bg_blue',function(){history.pushState({page:1},"title 1","#main");obj.historyStateChange('#main');});}
$('#landingList').html(htmlArr.join(''));$('#partLanding').html(partArr.join(''));$('#landingMatch').show();}};if(gVar.jdSkuInfo[infoKey]){window.landingVscCB(gVar.jdSkuInfo[infoKey]);}else if(vsc&&vsc.length){window.landingVscCB({stock:1,vsc:vsc});}}}
function isHuanAlert(obj){obj.isHuan=false;var huan=base.getUrlParam('huan'),isSamHuan=base.getUrlParam('isSamGoods'),isNeverBack=base.getUrlParam('neverBack');if(isNeverBack=='1'){JD.report.umpBiz({bizid:bizid,operation:'9',result:'17',source:'0',message:'pinggou error '+obj.skuId});}
if(window.sessionStorage&&sessionStorage.getItem('itemAlert')==obj.skuId){return;}
if(isSamHuan=='1'||huan>0){obj.isHuan=true;popUp.createPopup({flag:3,msg:''});window.sessionStorage&&sessionStorage.setItem('itemAlert',obj.skuId);}}
function samInfo(obj){var $samVip=$('#samVip');if(!$samVip.length){$('#taxTip').after('<div class="sams_bar" id="samVip"><a class="go_buy" href="javascript:void(0);" id="samVipBuy">Sam\'s</a><span class="go_bandding float">Sam\'s<a href="//home.m.jd.com/sam/bandCard.action?samFrom=1&bisVal='+obj.skuId+'&sid='+mCookie.get('sid')+'" id="samVipBind"></a></span></div>');$samVip=$('#samVip');}
$samVip.hide();$('#samVipBuy').attr('href',obj.getNewSkuUrl('200100420635'));if(!loginHandler.getLoginStatus()){$samVip.show();if(!loginHandler.getLoginStatus()&&obj.isZxLx){loginHandler.login();}
return;}
window.samVipCB=function(json){$samVip.show();if(json.retcode=='0'){gVar.jdSkuInfo.samVip=json;if(json.sam_is_bind=='1'&&json.sam_card_status=='1'){$samVip.hide();obj.isSamVip=true;}else{obj.isSamVip=false;if(obj.isZxLx){obj.setBtnStatus({msgConfig:{msg:'Sam\'s'},buyBtnConfig:{showType:-1},addBtnConfig:{showType:-1},showViewGuess:false,showArrivalNotice:false,popupBuyAreaConfig:{btnShowType:0}},true);$('#samVipBuy2,#bindSamVipBtn2').on('click',function(e){var tar=$(this),id=tar.attr('id');if(id=='samVipBuy2'){location.href=obj.getNewSkuUrl('200100420635');}else{location.href='//home.m.jd.com/sam/bandCard.action?samFrom=1&bisVal='+obj.skuId+'&sid='+mCookie.get('sid')+''}}).show();}}
obj.itemPrice&&obj.itemPrice.adjustPriceSize(2,obj.isSamVip);}};if(gVar.jdSkuInfo.samVip){window.samVipCB(gVar.jdSkuInfo.samVip);}else{mLs.loadScript('//wq.jd.com/samclubmember/getcardstate?sceneval=2&callback=samVipCB&t='+Math.random());}}
function addEnter(obj,opt){if(!obj.jdCategory||obj.jdCategory.length<3||obj.venderId=='686083'||(obj.soldOversea>0&&obj.isOverseaAddr)||obj.is9669order)return;var idSuffix='_YwEnter';var category=obj.jdCategory,category1=category[0],category2=category[1],category3=category[2],spAttr=obj.item().spAttr||{},tpl='<h3 class="title">{#title#}</h3><p class="business_detail"><span class="text">{#txt#}</span></p></p>',tpl1='<img src="{#imgPath#}" class="business_icon"><h3 class="title">{#title#}</h3><p class="business_detail"><span class="text">{#txt#}</span></p>',tpl2='<i class="icon"><img src="{#icon#}"></i><h3 class="title">{#title#}</h3><p class="business_detail"><span class="text">{#txt#}</span></p>';function addPortal(option){var $enterDom=$('#'+option.enterDom),$divDom=$('#'+(option.divDom||'enterArea1')),$ulDom=$divDom.find('ul.specBusiness_list'),maxNum=(obj.pageWidth>359?3:2);if(!$enterDom.length||!option.content||!$enterDom.length){return;}
if(option.ptagExposure&&$enterDom.css('display')=='none'){window.wa&&window.wa('ptagExposure',{ptag:option.ptagExposure});}
$enterDom.html(option.content).show();$divDom.show();$divDom.next('div.detail_gap').show();var $liDom=$divDom.find('li.specBusiness:visible');$ulDom.removeClass('normal').removeClass('slideMore').removeClass('arrow_right');if($liDom.length==1){$ulDom.addClass('arrow_right');}else if($liDom.length>maxNum){$ulDom.addClass('slideMore');}else{$ulDom.addClass('normal');}
option.cb&&option.cb();};function normalAddPortal(item){addPortal({enterDom:item.domId+idSuffix,content:$jsonToTpl({title:item.enterTitle,txt:item.enterText,imgPath:JD.img.getImgUrl(obj.isJDChoice?item.jxEnterIcon:item.enterIcon),},tpl1),ptagExposure:item.exposureRd,cb:function(){$('#'+item.domId+idSuffix).show().off().on('click',function(){var $this=$(this),url=$this.attr('tourl');if(!url)return;(item.pinbind==1)?loginHandler.loginLocation(url):(location.href=url);}).attr('ptag',item.clickRd).attr('tourl',item.enterLink);}});}
window.showPageData33558=function(json){gVar.jdSkuInfo.enterInfo=json;if(json&&json.data&&json.data.length>0){var data=json.data;function getErShou(item){if(!item)return;window.ershouSkuNumCB=function(ershou){gVar.jdSkuInfo.ershouSkuNum=ershou;if(ershou&&ershou.errcode==0&&ershou.data&&ershou.data.CheckSkuResult&&ershou.data.CheckSkuResult.length>0){if((ershou.data.CheckSkuResult[0].skuNum*1)>0){item.enterLink=$jsonToTpl({'skuId':obj.skuId,'cid1':category1,'cid2':category2,'cid3':category3},item.enterLink);normalAddPortal(item);}}};if(gVar.jdSkuInfo.ershouSkuNum){window.ershouSkuNumCB(gVar.jdSkuInfo.ershouSkuNum);}else{mLs.loadScript('//wq.jd.com/commodity/ershou/GetSkuNumByUsed?callback=ershouSkuNumCB&sceneval=2&skuIds='+obj.skuId+'&t='+Math.random());}}
function getXinPin(item){if(!item)return;window.xinpinCB=function(xinpin){gVar.jdSkuInfo.xinpin=xinpin;if(xinpin&&xinpin.errcode==0&&xinpin.data&&xinpin.data.newSkuResult&&xinpin.data.newSkuResult.newSkuId&&xinpin.data.newSkuResult.price){if((xinpin.data.newSkuResult.price*1)>0){item.enterLink=item.enterLink.replace(/{#skuId#}/g,xinpin.data.newSkuResult.newSkuId);item.enterText=item.enterText.replace(/{#price#}/g,xinpin.data.newSkuResult.price);normalAddPortal(item);}}};if(gVar.jdSkuInfo.xinpin){window.xinpinCB(gVar.jdSkuInfo.xinpin);}else{mLs.loadScript('//wq.jd.com/commodity/ershou/GetSkuByUsedSku?callback=xinpinCB&sceneval=2&usedSkuId='+obj.skuId+'&t='+Math.random());}}
function getHuanXin(item){if(!item){return;}
if(item.enterLink){item.enterLink=$jsonToTpl({'skuId':obj.skuId,'cid1':category1,'cid2':category2,'cid3':category3},item.enterLink);}
normalAddPortal(item);window.huanxinCB=function(huanxin){if(!huanxin||huanxin.code!='200')return;var url=huanxin.data;if(url){if(item.whiteList){var reg=new RegExp(item.whiteList);if(!reg.test(url)){url='';}}
url&&$('#'+item.domId+idSuffix).attr('tourl',url);}};mLs.loadScript('//hsapi.jd.com/urlM?callback=huanxinCB&skuId='+obj.skuId
+'&cid1='+category1
+'&cid2='+category2
+'&cid3='+category3
+'&province='+obj.jdAddrId[0]
+'&city='+obj.jdAddrId[1]
+'&county='+obj.jdAddrId[2]
+'&source=2'
+'&commodityType='+(obj.isZiying?'2':'1')
+'&t='+Math.random());}
var checkShow=function(item,type){if(!item)return false;var result=true;type=type||1;if(!item.domId||!item.enterTitle||!item.enterText||(!obj.isJDChoice&&!item.enterIcon)||(obj.isJDChoice&&!item.jxEnterIcon)){result=false}
if(!item.source||item.source.indexOf('2')<0)result=false;if(result){switch(type){case 1:break;case 2:var checkCid=true,checkSpecMark=true;if((!item.cid1s||item.cid1s=='||')&&(!item.cid2s||item.cid2s=='||')&&(!item.cid3s||item.cid3s=='||')){checkCid=false;}
if(!item.specMark||!item.specMarkVal){checkSpecMark=false;}
item.cid1s='|'+item.cid1s+'|';item.cid2s='|'+item.cid2s+'|';item.cid3s='|'+item.cid3s+'|';item.specMarkVal='|'+item.specMarkVal+'|';if(checkCid&&((!~item.cid1s.indexOf('|'+category1+'|'))&&(!~item.cid2s.indexOf('|'+category2+'|'))&&(!~item.cid3s.indexOf('|'+category3+'|')))){result=false;}
if(checkSpecMark&&(!spAttr[item.specMark]||!~item.specMarkVal.indexOf('|'+spAttr[item.specMark]+'|'))){result=false;}
break;}}
return result;};var specEnter=function(item){if(!item.domId)return false;switch(item.domId){case'yijiuhuanxin':getHuanXin(item);return false;break;case'jingda':if(item.enterLink){item.enterLink=JD.url.addUrlParam(item.enterLink,{'clientType':(obj.isWX?'2':'1')});}
return item;break;case'tongkuanershou':if(category1!=='13765'){getErShou(item);}
return false;break;case'ziyingxinpin':getXinPin(item);return false;break;default:return item;break;}}
var $ulDom=$('#enterList1'),liArr=[];data.forEach(function(item,idx){if(checkShow(item)){liArr.push('<li class="specBusiness public" id="'+item.domId+idSuffix+'" style="display:none;"></li>');}});if(liArr.length>0){$ulDom.html(liArr.join(''));data.forEach(function(item,idx){if(checkShow(item,2)){if(item.enterLink)item.enterLink=$jsonToTpl({'skuId':obj.skuId,'cid1':category1,'cid2':category2,'cid3':category3},item.enterLink);item=specEnter(item);if(item){normalAddPortal(item);}}});}}};if(gVar.jdSkuInfo.enterInfo){window.showPageData33558(gVar.jdSkuInfo.enterInfo);}else{mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v33558'}});}
if(category3=='12187'){$('#enterAreaXt').show().off().on('click',function(){window.wa&&window.wa('jdClick',{ptag:'7001.6.42'});window.setTimeout(function(){location.href='//wqs.jd.com/smarthealth/bs.index.shtml';},200);});$('#enterAreaXt').next('.detail_gap').show();window.wa&&window.wa('ptagExposure',{ptag:'7001.6.41'});}}
function plusGiftLogic(obj){var price=obj.itemPrice.priceObj;var hasPlusChoiceBar=false;var listenStock=function(){JD.events.listen('item.main.stockStateChange',function(stockState){var $plusChoice=$('#plusChoice');if(stockState==3){$plusChoice.hide();}else if(hasPlusChoiceBar){$plusChoice.show();}});}
if(obj.promotion&&((obj.promotion.giftFlag&2)!=0)){var tspan=$('#plusGuide>span'),ttext=tspan.text(),tspan2=$('#plusChoice p.text'),ttext2=tspan2.text();if(ttext&&!//.test(ttext)){tspan.text(ttext+'');}
if(ttext2&&!//.test(ttext2)){tspan2.text(ttext2+'');}
if(obj.itemPrice.pricePriority(price,'pp')&&obj.itemPrice.pricePriority(price,'tpp')&&(!price.pp||price.p<price.pp)&&(!price.tpp||price.p<price.tpp)){if(loginHandler.getLoginStatus()){if(obj.isJDChoice){userInfo.getPinStatus({url:'//plus.m.jd.com/index?s=wq&ptag=7001.4.4',sceneid:521190259,cb:function(pinObj){if(pinObj&&(pinObj.isDefault||pinObj.isPerfect||pinObj.isBind)){obj.stockState[obj.skuId]!=3&&showPlusChoiceEnter(pinObj.url);listenStock();hasPlusChoiceBar=true;}else{userInfo.userLevel({cb:function(data){if(!data.isFormal&&!data.isTrial){obj.stockState[obj.skuId]!=3&&showPlusChoiceEnter();listenStock();hasPlusChoiceBar=true;}}});}}});}else{userInfo.userLevel({cb:function(data){if(!data.isFormal&&!data.isTrial){$('#promoteList .plus_prom,#promoteList2 .plus_prom').show();}}});}}else{if(obj.isJDChoice){obj.stockState[obj.skuId]!=3&&showPlusChoiceEnter();listenStock();hasPlusChoiceBar=true;}else{$('#promoteList .plus_prom,#promoteList2 .plus_prom').show();}}}}
if(obj.promotion&&obj.promotion.giftFlag==3){$('#promoteList div[mark="plusgd"],#promoteList2 div[mark="plusgd"]').show();}}
function showPlusChoiceEnter(url){var dUrl=url||'//plus.m.jd.com/index?s=wq&ptag=7001.4.4',title='PLUS',desc=url?'':'',$plusChoice=$('#plusChoice');$plusChoice.attr('href',dUrl).show().find('p.text').text(title);if(desc){$plusChoice.find('p.sub_text').text(desc).show();}else{$plusChoice.find('p.sub_text').hide();}
$('.mod_aside_v2').css('bottom','96px;');window.wa&&window.wa('ptagExposure',{ptag:'7001.4.3'});}
function plusPriorBuy(obj,opt,flag){opt=opt||{};var type=opt.plusType*1;if(type>0){var setDom=function(domOpt){var desc='',haveGo=false,plusUrl='//plus.m.jd.com/index?s=wq&ptag=7001.1.90',leadDate='',plusStart=false;if(flag){plusStart=(opt.state===4&&opt.isBefore===1);if(opt.plusEtime&&opt.qiangStime&&(opt.state===2||opt.state===3||plusStart)){leadDate=opt.qiangStime.replace(/\/|-/g,'.');}}else{var serverTime=opt.serverTime,startTime=opt.startTime,endTime=opt.endTime;plusStart=(serverTime-startTime>0&&serverTime-startTime<opt.plusSeconds&&endTime-serverTime>0);if(opt.plusSeconds>0&&(serverTime-startTime<0||plusStart)){var t=formatTime(new Date(parseInt(startTime)*1000))
leadDate=t.year+'.'+t.month+'.'+t.day+' '+t.hour+':'+t.min+':'+t.sec;}}
if(leadDate){desc='PLUS'+(type===1?'':'')+''+(flag&&(opt.state===3||opt.state===4)&&(opt.category==='1'||opt.category==='3'||opt.category==='4')?'':'')+(plusStart?'':'<span>'+leadDate+'</span>');if(plusStart)desc.replace('','');if(domOpt){var isFormal=domOpt.isFormal,isTrial=domOpt.isTrial;if(isFormal||(type===2&&isTrial)){if(flag){window.yushouJDCB(opt,true);}else{window.qiangCB(opt,true);}}else{desc=''+desc;haveGo=true;}}else{}
if(obj.isSpecSku()){desc='PLUS';}
var $dom=$('#plusGuide');$dom.addClass('rob').show().html('<div class="mod_sign_tip bg_4"><b><i class="icon_plus"></i></b></div><span class="plus_desc">'+desc+'</span>'+(haveGo?'<span class="go"></span>':''));$dom.off();if(haveGo){$dom.on('click',function(){loginHandler.loginLocation(plusUrl);}).attr('ptag','7001.1.90');}}}
if(loginHandler.getLoginStatus()){userInfo.userLevel({cb:function(level){setDom(level);}});}else{setDom();}}}
function addrCookieRp(){var wqAddr=(mCookie.get('wq_addr')||'').split('|'),jdAddrId=(mCookie.get('jdAddrId')||'').split('_'),noAddr=0;if(!wqAddr[1]){noAddr++;}
if(jdAddrId.length<2){noAddr++;}
JD.report.umpBiz({bizid:bizid,operation:'24',result:noAddr,source:'0',message:wqAddr.join('|')+'...'+jdAddrId.join('_')});}
function wqmnxCookieRp(obj){if(window.jdm){var wqmnx=mCookie.get('wqmnx')||'',wqVal=obj.isWX?'180850892b323d04f811f0ab89cbex88':'180850892b323d04f811f0ab89cbhq86',resultVal=(wqmnx===wqVal?0:(wqmnx?1:2));if(resultVal>0&&!obj.isWX)resultVal++;JD.report.umpBiz({bizid:bizid,operation:'25',result:resultVal,source:'0',message:obj.locationUrl+'|'+wqmnx});}}
function isZengJiLv(obj){var json=obj.skuJson[obj.skuId]||{};var promos=((json.promov2&&json.promov2[0]&&json.promov2[0]['pis'])||[]);var result=false;for(var i=0;i<promos.length;i++){var item=promos[i],itemEtg=(item.etg||'').split(',');if(~itemEtg.indexOf('20'))result=true;}
return result;}
function carInfo(obj){if(obj.isSamGoods||obj.isSamGoods2)return;var category=obj.jdCategory||[0,0,0];var $carBind=$('#carBind');$carBind.hide();obj.carInfo=false;if(~' 11849 11850 11852 6767 9248 11859 9971 6766 6756 13295 6972 11883 6768 11882 6798 11881 14879 14880 14888 14889 14890 13992 13244 14890 14889 14888 14879 6798 9248 6767 6768 '.indexOf(' '+category[2]+' ')){obj.carInfo=true;var $carCont=$('#carCont').hide(),addCarEnter=function(url){if(!url){return;}
var htmlStr='<div class="detail_carsku">'+'  <h3 class="detail_carsku_title"><span id="carTip"></span></h3>'+'  <ul class="detail_carsku_wrap" id="carCont">'+'  </ul>'+'   </div>',content='<li class="detail_carsku_item">'+'   <a href="'+url+'" id="addCarInfo" class="detail_carsku_edit" ptag ="7001.1.139">'+'     <p></p>'+'     <p></p>'+'   </a>'+'    </li>';$carBind.html(htmlStr).show();$carCont=$('#carCont');$carCont.html(content);reporter.reportExposure({ptag:'7001.1.129'});};addCarEnter('javascript:void(0);');$('#addCarInfo').off().on('click',function(e){e.preventDefault();loginHandler.login();});if(loginHandler.getLoginStatus()){window.carInfoCB=function(json){if(json.errcode=='13'){loginHandler.login();}else if(json.errcode=='0'&&json.data&&json.data.isSuccess){var tpl='<li class="detail_carsku_item" modelid="{#modelId#}" ptag="7001.1.128">'+'<div class="detail_carsku_item_name">{#seriesName#}</div>'+'<div class="detail_carsku_item_kind">{#modelName#}</div>'+'</li>',htmlArr=[];for(var i=0,leni=(json.data.model||[]).length,itemi;i<leni;i++){itemi=json.data.model[i];if(itemi&&itemi.modelId){htmlArr.push($jsonToTpl(itemi,tpl));}}
if(htmlArr.length>0){obj.carInfoObj.zengJiLv=isZengJiLv(obj);var tip=obj.carInfoObj.zengJiLv?'':'';htmlArr.push('<li class="detail_carsku_item">'+'   <a href="//car.m.jd.com/h5/carManageForApp.html?source=wxdetail" class="detail_carsku_edit" ptag ="7001.1.139">'+'     <p></p>'+'     <p></p>'+'   </a>'+'    </li>');var htmlStr='<div class="detail_carsku">'+'  <h3 class="detail_carsku_title"> <span id="carTip" '+(obj.carInfoObj.zengJiLv?'style="color:#e4393c;':'')+'>'+tip+'</span></h3>'+'  <ul class="detail_carsku_wrap" id="carCont">'+'  </ul>'+'   </div>';$carBind.html(htmlStr).show();$carCont=$('#carCont');$('#carTip').text(tip);obj.carInfoObj.zengJiLv?$('#carTip').css('color','#e4393c'):'';$carCont.html(htmlArr.join('')).show().off().on('click','li.detail_carsku_item',function(){var $this=$(this),modelId=$this.attr('modelid');gVar.jdSkuInfo.carFailList=[];if($this.hasClass('cur')){obj.carPassList=false;$this.removeClass('cur');obj.skuSwitch.checkSkuListNew();obj.carInfoObj.modelId=0;mCookie.del('wq_carmid','/',obj.domainStr);checkCarSku(obj);}else if(modelId){obj.carPassList=[];$this.addClass('cur').siblings().removeClass('cur');window.carContCB=function(carContData){carContData=carContData||{};if(carContData.code==='0'){gVar.jdSkuInfo['car'+modelId]=carContData;}
gVar.jdSkuInfo.carFailList=(carContData.data&&carContData.data.failList)||[];obj.carPassList=(carContData.data&&carContData.data.passList)||[];obj.skuSwitch.checkSkuListNew();checkCarSku(obj,modelId);};if(gVar.jdSkuInfo['car'+modelId]){window.carContCB(gVar.jdSkuInfo['car'+modelId]);}else{mLs.loadScript({url:'//cargw.jd.com/wxClient?functionId=carSku&callback=carContCB&clientVersion=1.6.0&body='+JSON.stringify({'carModelId':modelId,'operate':'1','skus':obj.skuSwitch.jdSkuIds}),onError:function(){window.carContCB();}});}}});var carModelIdCookie=mCookie.get('wq_carmid'),carModelIdCookieDom=$carCont.find('.detail_carsku_item[modelid="'+carModelIdCookie+'"]');if(carModelIdCookie&&carModelIdCookieDom.length>0){carModelIdCookieDom.trigger('click');var offsetLeft=carModelIdCookieDom.offset().left||0;if(offsetLeft>obj.pageWidth){$carCont.scrollLeft(offsetLeft);}}
reporter.reportExposure({ptag:'7001.1.127'});}else{addCarEnter('//car.m.jd.com/h5/list.html');}}else{addCarEnter('//car.m.jd.com/h5/list.html');}};mLs.loadScript('//wq.jd.com/commodity/aiche/listcarusermodelbypin?callback=carInfoCB&t='+Math.random());}}}
function checkCarSku(obj,modelId){if(!obj.carInfo)return;var failList=gVar.jdSkuInfo.carFailList,passList=obj.carPassList;$('#statusNotice,#popupNotice,#carGift').hide();$('#goodGift').show();if(passList){if(passList.length>0){if(modelId){obj.carInfoObj.modelId=modelId
mCookie.set('wq_carmid',modelId,86400,'/',obj.domainStr);}
if(failList&&failList.length>0){for(var i=0,leni=failList.length,itemi;i<leni;i++){itemi=failList[i];}}
if(obj.carInfoObj.modelId){var showHidegift=function(isShow,giftinfo){if(isShow&&giftinfo&&giftinfo.skuName&&giftinfo.mainImage&&giftinfo.sku){var $giftDom=$('#carGift'),$defalutGiftDom=$('#goodGift');if(!$giftDom.length){if($defalutGiftDom.length){$defalutGiftDom.after('<div tourl="" class="de_row prom_item " id="carGift" sku="'+giftinfo.sku+'"></div>');}else{$('#promoteList').append('<div tourl="" class="de_row prom_item " id="carGift" sku="'+giftinfo.sku+'"></div>');}
$giftDom=$('#carGift');}
var tpl='<div class="de_tag">'+'<em class="hl_red_bg"></em>'+'</div>'+'<div class="de_span">'+'<div class="prom_flex_box"><span></span></div>'+'<div class="de_pm_list" tourl="//wqitem.jd.com/item/view?sku={#sku#}">'+'<div class="item">'+'<div class="img " tag="" title="">'+'<img src="//img13.360buyimg.com/n4/{#mainImage#}" alt="">'+'<span class="gift_num" style="{#storeStyle#}"></span>'+'</div>'+'<div class="info"><div class="name">{#skuName#}</div><div class="desc">x 1</div></div>'+'<div class="de_point"><i class="icon_point"></i></div>'+'</div>'+'</div>'+'</div>';if(giftinfo.hashStore){giftinfo.storeStyle='display:none;';}
$defalutGiftDom.hide();$giftDom.html($jsonToTpl(giftinfo,tpl)).show();if(obj.promotion){if(!~obj.promotion.iconHtml.indexOf(''))obj.promotion.appendIconHtml('<em class="hl_red_bg"></em>');obj.promotion.setPromoteTitle();}
$giftDom.off().on('click','.de_pm_list',function(e){var tar=$(this),toul=tar.attr('tourl')||'';if(toul){window.location.href=toul;}
e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();});$('#promoteList').show();$('#promotePanel').show();}else{$('#carGift').hide();}};window.carGiftCB=function(json){obj.carInfoObj[obj.skuSwitch.jdSkuIds.join(',')+'_'+obj.carInfoObj.modelId+'_'+obj.jdAddrId.join('-')]=json;if(json&&json.code==0&&json.model){var item=false;for(var key in json.model){if(key==obj.skuId){item=json.model[key];break;}}
if(item){showHidegift(true,item);}else{showHidegift(false);}}};if(obj.carInfoObj&&obj.carInfoObj[obj.skuSwitch.jdSkuIds.join(',')+'_'+obj.carInfoObj.modelId+'_'+obj.jdAddrId.join('-')]){window.carGiftCB(obj.carInfoObj[obj.skuSwitch.jdSkuIds.join(',')+'_'+obj.carInfoObj.modelId+'_'+obj.jdAddrId.join('-')]);}else{mLs.loadScript('//wq.jd.com/bases/carskusoaservice/getgift?callback=carGiftCB&skuids='+obj.skuSwitch.jdSkuIds.join(',')+'&carmodelid='+obj.carInfoObj.modelId+'&area='+obj.jdAddrId.join('_'));}}}else{obj.carInfo.model=0;showNotice({str:''});$('#carCont li.cur').trigger('click');}}}
function checkSkuListForCar(obj,skuPro){var propArr=skuPro.propArr,idPro=skuPro.id,propSeq=skuPro.propSeq,$sku='',$skuPop='',passList=obj.carPassList,skuSelect='option_selected',skuPopSelect='active',disarray=[];if(passList&&passList.length>0){for(var i=0,leni=propArr.length;i<leni;i++){var nameRelated=[],isRelated=0,saleName='',$skuJ='',$skuPopJ='';for(var key in idPro){if(idPro.hasOwnProperty(key)&&idPro[key]){nameRelated.push({arr:idPro[key],isCar:!!~passList.indexOf(key*1)});}}
for(var i=0,leni=propArr.length;i<leni;i++){$sku=$('#sku'+(i+1)+' span');$skuPop=$('#skuPop'+(i+1)+' span');for(var j=0,lenj=propSeq[propArr[i]].length;j<lenj;j++){saleName=propSeq[propArr[i]][j];isRelated=false;for(var k=0,lenk=nameRelated.length;k<lenk;k++){if(nameRelated[k]['arr'][i]===saleName){if(nameRelated[k]['isCar']){isRelated=1;break;}}}
$skuJ=$sku.eq(j);$skuPopJ=$skuPop.eq(j);if(!isRelated){$skuJ.hide();$skuPopJ.hide();if($skuJ.hasClass(skuSelect)){$skuJ.removeClass(skuSelect).attr('dis','1');disarray[i]=true;}
if($skuPopJ.hasClass(skuPopSelect)){$skuPopJ.removeClass(skuPopSelect).attr('dis','1');disarray[i]=true;}}else{$skuJ.show();$skuPopJ.show();}}}}
for(var k=0,klen=disarray.length;k<klen;++k){if(disarray[k]){$sku=$('#sku'+(k+1)+' span[dis="0"]:visible').first().trigger('click');$skuPop=$('#skuPop'+(k+1)+' span[dis="0"]:visible').first().trigger('click');}}}else{for(var i=0,leni=propArr.length;i<leni;i++){$('#sku'+(i+1)+' span').show();$('#skuPop'+(i+1)+' span').show();}}}
function secondHand(obj){var $dom=$('#secondHand');if(!$dom.length){$('#detail3Normal').prepend('<div id="secondHand"><div class="mod_tit_line"><h3>FAQ</h3></div><img src="'+JD.img.getImgUrl(obj.jdCategory&&(obj.jdCategory[2]=='13768'||obj.jdCategory[2]=='13771')?'//img14.360buyimg.com/paipai/jfs/t1/55158/39/13602/322661/5da5a7a1E88fea3bd/37e6a7d9b1f0f2f0.jpg':'//img11.360buyimg.com/jdphoto/s750x1500_jfs/t4033/276/1277644953/416241/fbb0b67f/586f5fdbNe907ef8d.jpg')+'"></div>');$dom=$('#secondHand');}
$dom.show();}
function prescribeDrug(obj){if(obj.isJDChoice){window.location.href=obj.getNewSkuUrl(obj.skuId,'general');return;}
reporter.reports({ptag:'7435.1.1'});$('#headEval').addClass('hide');$('#summaryEnter').hide().next().hide().next().hide();var $drugCart=$('#drugCart'),$gotoCart=$('#gotoCart').hide();if(!$('#drugTip').length){$('#priceSpec2').after('<div class="buy_tip_v2 type_medicine" id="drugTip"><p class="buy_tip_v2_line">'+obj.domainStr+'<br>12331</p></div>');}
if(obj.newDrugGray){$('#specBuyBtn,#specBuyBtn1').off().on('click',function(){loginHandler.login('//wq.jd.com/pinbind/pintokenredirect?biz=nethp-diag&url='+encodeURIComponent('https://yiyaoapp-gw.healthjd.com/redirect/sku?skuId='+obj.skuId));});}else{if(!$drugCart.length){$gotoCart.after('<div class="icon_btn icon_medicine_list" id="drugCart">'+'<span class="add_num" id="poponeDrug"></span>'+'    <i class="icon"><span class="num"></span></i>'+'    <span class="txt"></span>'+'</div>');$drugCart=$('#drugCart');}
$drugCart.show().off().on('click',function(){if(loginHandler.getLoginStatus())reporter.pingClick('MProductdetail_MedicineList','','3');setTimeout(function(){loginHandler.loginLocation('//yao.jkcsjd.com/cart/index.html');},100);}).find('span.num').hide();setDrugNum();$('#specAddBtn,#specAddBtn1').off().on('click',function(){reporter.txReport({ptag:'7001.1.10'});if(loginHandler.getLoginStatus())reporter.pingAddClick("MProductdetail_MedicineAdd",obj.skuId,"5",obj.skuId);obj.throttle(obj.addCart,obj,200,{firstDo:true});}).attr('ptag','7435.1.3');$('#specBuyBtn,#specBuyBtn1').off().on('click',function(){reporter.txReport({ptag:'7001.1.8'});reporter.pingAddClick('MProductdetail_Easybuy',obj.skuId+'_0','5',obj.skuId);var url=obj.getBuyLink();if(url){setTimeout(function(){location.href=url;},200);}});}
$('#priceDescDetail').hide();$('#detail3Normal').html(['<div class="mod_tit_line"><h3></h3></div><div class="for_separator"></div>RX','<div class="mod_tit_line"><h3></h3></div><p>1</p><p>2</p><p> 3</p><p>1 </p><p>2 </p><p>3</p><p><strong></strong></p>','<div class="mod_tit_line"><h3></h3></div><p>1/</p><p>2</p><p>3</p>'].join(''));}
function setDrugNum(num){var $drugCartNum=$('#drugCart').find('span.num');if(num>0){JD.store.setItem('drugCartNum',num,99999,null,'wqs.jd.com');$drugCartNum.show().text(num>99?'99+':num);}else{JD.store.getItem('drugCartNum',function(a,b){if(b>0){$drugCartNum.show().text(b>99?'99+':b);}},'wqs.jd.com');}}
function askAnswer(obj){JD.events.listen('item.comment.sensitiveBook',function(){obj.isSensitiveBook=true;var $answerArea=$('#answerArea');if($answerArea.length>0)$answerArea.hide().next('.detail_gap').hide();});if(obj.isSensitiveBook)return;var category=obj.jdCategory;if(!~' 12813 6321 13314 6324 12814 '.indexOf(' '+category[0]+' ')&&!~' 9196 '.indexOf(' '+category[1]+' ')){window.showPageData31334=function(json){if(obj.isSensitiveBook)return;var data=json.data;if(data&&data[0]&&data[0].askanswer==='1'){var answerHtml=['<div class="detail_faqbox" id="answerArea">',' <div class="detail_faqbox_head">','   <div class="detail_faqbox_head_tit"></div>','   <div class="detail_faqbox_head_num" style="display:none;"></div>','   <div class="detail_faqbox_head_empty"><span></span></div>',' </div>',' <ul class="detail_faqbox_list" style="display:none;">',' </ul>','  </div>'].join('');if(!obj.isJDChoice){answerHtml+='<div class="detail_gap"></div>';$('#shopArea').before(answerHtml);}else{answerHtml+='<div class="detail_gap"></div>';$('#commentChoice').after(answerHtml);}
window.wa&&window.wa('ptagExposure',{ptag:obj.isJDChoice?'7001.4.27':'7001.1.123'});var $answerArea=$('#answerArea'),isEmpty=true;window.askAnswerCB=function(json){if(obj.isSensitiveBook)return;if(json.resultCode==='0'){gVar.jdSkuInfo.askAnswer=json;if(json.result&&json.result.questionList&&json.result.questionList.length>0){var questionList=json.result.questionList,htmlArr=[],unanswerArr=[],tpl=['<li>','<p class="detail_faqbox_list_desc">{#content#}</p>','<span class="detail_faqbox_list_num">{#answerStr#}</span>','</li>'].join('');for(var i=0,leni=questionList.length,itemi;i<leni;i++){itemi=questionList[i];itemi.answerStr=(itemi.answerCount>0?''+itemi.answerCount+'':'')
if(itemi.content){itemi.content=window.htmlEncode&&window.htmlEncode(itemi.content)||itemi.content;if(itemi.answerCount>0){itemi.answerStr=''+itemi.answerCount+'';htmlArr.push($jsonToTpl(itemi,tpl));}else{itemi.answerStr='';unanswerArr.push($jsonToTpl(itemi,tpl));}}}
htmlArr=htmlArr.concat(unanswerArr).slice(0,2);if(htmlArr.length>0){isEmpty=false;$answerArea.find('div.detail_faqbox_head_num').show().text('');$answerArea.find('ul.detail_faqbox_list').show().html(htmlArr.join(''));$answerArea.find('div.detail_faqbox_head_empty').hide();$('#answerArea').show();}else{$answerArea.find('div.detail_faqbox_head_empty').show();}}}};setTimeout(function(){if(isEmpty){$answerArea.find('div.detail_faqbox_head_empty').show();}},1000);$answerArea.off().on('click',function(){location.href='//wqs.jd.com/faqs/index.html?sceneval=2&ptag='+(obj.isJDChoice?'7001.4.28':'7001.1.124')+'&productId='+obj.skuId;});if(gVar.jdSkuInfo.askAnswer){window.askAnswerCB(gVar.jdSkuInfo.askAnswer);}else{mLs.loadScript('//wq.jd.com/questionanswer/GetSkuQuestionListWeChat?callback=askAnswerCB&productId='+obj.skuId+'&t='+Math.random());}}};mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v31334'}});}}
function bigProPri(item,obj){if(!item.p&&item.t==2)item.p=obj.itemPrice&&obj.itemPrice.jdPrice;if(!item||!item.p||!item.s)return;if(item.t==2&&item.type!=1)return;if(!$('#bigProPri').length){item.c=item.c||'';var priceArr=(item.p-0).toFixed(2).split('.'),stTemp=formatTime(new Date(parseInt(item.s))),today=formatTime(new Date()),tmorrow=formatTime((new Date(new Date().getTime()+24*3600*1000))),startTime='';if(stTemp.year==today.year&&stTemp.month==today.month&&stTemp.day==today.day){startTime+='';}else if(stTemp.year==tmorrow.year&&stTemp.month==tmorrow.month&&stTemp.day==tmorrow.day){startTime+='';}else if(stTemp.year==today.year){startTime+=parseInt(stTemp.month)+''+parseInt(stTemp.day)+'';}else{startTime+=stTemp.year+''+parseInt(stTemp.month)+''+parseInt(stTemp.day)+'';}
startTime+=[stTemp.hour,stTemp.min].join(':');priceArr[1]=priceArr[1]?'.'+priceArr[1]:'';var type=(item.type||'0')-0,BigProPriStr='';switch(type){case 1:if(item.t==1){BigProPriStr='<div class="forenotice" id="bigProPri"><div class="forenotice_info"><p class="forenotice_info_price"><i class="mod_sign_tip"><span></span></i>&yen; <em class="forenotice_info_price_int">'+priceArr[0]+'</em>'+(priceArr[1]||'')+'</p>'+(item.m?'<p class="forenotice_info_tips">'+startTime+''+item.m+'</p>':'')+'</div></div>';}else if(item.t==2&&item.m){BigProPriStr='<div id="bigProPri" style="background: transparent;color: #333;padding: 8px 10px 12px 10px;">'+item.m+''+priceArr[0]+''+(priceArr[1]||'')+'</div>';}
break;case 2:var limitHour=0;if(item.e)limitHour=parseInt(10*(item.e-item.s)/(1000*60*60))/10;BigProPriStr='<div class="forenotice" id="bigProPri"><div class="forenotice_info"><p class="forenotice_info_price"><i class="mod_sign_tip"><span></span></i>'+item.c+'&yen; <em class="forenotice_info_price_int">'+priceArr[0]+'</em>'+(priceArr[1]||'')+'</p>'+(limitHour>0?'<p class="forenotice_info_tips">'+startTime+''+limitHour+'</p>':'')+'</div></div>';break;case 0:default:BigProPriStr='<div class="forenotice" id="bigProPri"><div class="forenotice_info"><p class="forenotice_info_price"><i class="mod_sign_tip"><span></span></i>'+item.c+'&yen; <em class="forenotice_info_price_int">'+priceArr[0]+'</em>'+(priceArr[1]||'')+'</p><p class="forenotice_info_tips">'+startTime+'</p></div></div>';break;}
$('#priceSpec2').after(BigProPriStr);}}
function promoteAtmosphere(obj){window.showPageData31246=function(json){gVar.jdSkuInfo.promoteAtmosphere=json;if(json&&json.data&&json.data.length>0){var data=json.data,category=obj.jdCategory,category1='|'+category[0]+'|',category2='|'+category[1]+'|',category3='|'+category[2]+'|',sku='|'+obj.skuId+'|',pTag=obj.item().pTag?('|'+obj.item().pTag+'|'):'',nowTime=(new Date()).getTime(),matid='',activestage=0,dcstarttime=0,dcendtime=0;if(obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].price&&obj.skuJson[obj.skuId].price.np){var np=obj.skuJson[obj.skuId].price.np;matid=np.id||'',activestage=np.t||0,dcstarttime=np.s||0,dcendtime=np.e||0;bigProPri(np,obj);}
var dataItem=data.filter(function(s){var isPromoe=s&&s.bannerimg&&s.backcolor&&s.textcolor&&s.numcolor&&s.numbackcolor&&(s.matid&&matid!=''&&s.matid==matid)&&(s.activestage&&~s.activestage.indexOf(activestage))&&(dcendtime&&dcendtime>nowTime);return s&&s.bannerimg&&s.backcolor&&s.textcolor&&s.numcolor&&s.numbackcolor&&((s.category1&&~s.category1.indexOf(category1))||(s.category2&&~s.category2.indexOf(category2))||(s.category3&&~s.category3.indexOf(category3))||(s.sku&&~s.sku.indexOf(sku))||(s.promoteid&&pTag!=''&&~s.promoteid.indexOf(pTag)))&&(s.starttime&&(new Date(s.starttime)).getTime()<nowTime)&&(s.endtime&&(new Date(s.endtime)).getTime()>nowTime)||isPromoe;})[0];if(dataItem){var $dom=$('#promoteAtmosphereTimer');if(!$dom.length){$('#colorSwitch').after(['<div class="detail_decoration ddno_mb" id="promoteAtmosphereTimer">',' <div class="banner">',' </div>',' <div class="remind">','   <div class="content_wrap">','  <p class="text">'+(dataItem.descword?dataItem.descword:'')+'</p>','  <p class="time"></p>','   </div>',' </div>','  </div>'].join(''));$dom=$('#promoteAtmosphereTimer');}
$dom.find('div.banner').html('<img src="'+dataItem.bannerimg+'">');$dom.find('div.remind').css({'background-color':dataItem.backcolor,'color':dataItem.textcolor});if(dataItem.matid){if(activestage==2){var limit=Math.ceil((dcendtime-nowTime)/1000);}else{var limit=Math.ceil((dcstarttime-nowTime)/1000);}
var tplFun=function(s){return'<span class="box" style="color:'+dataItem.numcolor+';background-color:'+dataItem.numbackcolor+';">{#'+s+'#}</span>';}
setTimeLimit({limit:limit,dayTpl:tplFun('day')+'',tpl:['hour','min','sec'].map(tplFun).join(':'),key:'promoteAtmosphere',$timer:$dom.find('p.time'),fun:function(){$dom.hide();}});$dom.show();}else{var limit=Math.ceil((new Date(dataItem.endtime).getTime()-nowTime)/1000);if(limit>0){var tplFun=function(s){return'<span class="box" style="color:'+dataItem.numcolor+';background-color:'+dataItem.numbackcolor+';">{#'+s+'#}</span>';}
setTimeLimit({limit:limit,dayTpl:tplFun('day')+'',tpl:['hour','min','sec'].map(tplFun).join(':'),key:'promoteAtmosphere',$timer:$dom.find('p.time'),fun:function(){$dom.hide();}});$dom.show();}else{$dom.hide();}}}else if(obj.bigPromoteInfo&&obj.bigPromoteInfo.bannerImg){if($('#bigPromoteBanner').length){$('#bigPromoteBanner').show();}else{$('#colorSwitch').after('<div class="detail_decoration ddno_mb" id="bigPromoteBanner"><div class="banner"><img src="'+JD.img.getImgUrl(obj.bigPromoteInfo.bannerImg)+'"></div></div>');}}}};if(gVar.jdSkuInfo.promoteAtmosphere){window.showPageData31246(gVar.jdSkuInfo.promoteAtmosphere);}else{gVar.jdSkuInfo.promoteAtmosphereCgi=true;mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v31246'}});}}
function profitBelt(obj){var spAttr=obj.item().spAttr||{};var pTag=obj.item().pTag||'';var url=['//wq.jd.com/bases/waistbandservice/waistband?callback=profitBeltCb','source=3','search='+[obj.skuId,(spAttr.isCanUseDQ=='0'?'0':'1'),(spAttr.isCanUseJQ=='0'?'0':'1'),(obj.isOverseaPurchase>0?'1':'0'),obj.jdCategory[2],(obj.venderId||0),(pTag?pTag:'0')].join('_'),'t='+Math.random()].join('&');window.profitBeltCb=function(json){var nowTime=(new Date()).getTime();if(json&&json.data&&json.data[0]){var item=json.data[0];item.forecastDate=item.forecastDate||0;item.endDate=item.endDate||0;item.startDate=item.startDate||0;if((parseInt(item.forecastDate))<nowTime&&(parseInt(item.endDate))>nowTime&&item.waistBandUrl){var tempArr=item.waistBandUrl.split(',');item.waistBandUrl=tempArr[0];var $dom=$('#promoteAtmosphereTimer');if(!$dom.length){$('#colorSwitch').after(['<div class="detail_decoration ddno_mb" id="promoteAtmosphereTimer">',' <div class="banner">',' </div>',].join(''));$dom=$('#promoteAtmosphereTimer');}
$dom.show().find('div.banner').html('<img src="'+item.waistBandUrl+'">');$dom.find('img').on('error',(function(commId){$dom.hide();}));if(obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].price&&obj.skuJson[obj.skuId].price.np){var np=obj.skuJson[obj.skuId].price.np;if(np.s==(parseInt(item.startDate))&&np.e==(parseInt(item.endDate))){bigProPri(np,obj);}}}else{promoteAtmosphere(obj);}}else{promoteAtmosphere(obj);}};mLs.loadScript({url:url});}
function fqyPay(obj){setStepDom({lastChildId:'keyParametersFloor',htmlStr:['<div class="installment">','  <div class="installment_head"><span></span></div>','  <div class="installment_line">','    <div class="installment_line_item"><i class="num">1</i></div>','    <div class="installment_line_item"><i class="num">2</i></div>','    <div class="installment_line_item"><i class="num">3</i></div>','    <div class="installment_line_item"><i class="num">4</i></div>','  </div>','  <div class="installment_line">','    <div class="installment_line_item"><i class="num">5</i></div>','    <div class="installment_line_item"><i class="num">6</i></div>','    <div class="installment_line_item"></div>','    <div class="installment_line_item"></div>','  </div>','   </div>'].join('')});window.fqypriceCB=function(json){if(json.errcode===0&&json.result&&json.result.data&&json.result.data.leastPlanAmount){gVar.jdSkuInfo['fqyprice'+obj.skuId]=json;var jdPriceTpl='<span id="jdPrice" class="description">&nbsp;&nbsp;'+obj.jdPrice+'</span>',fqyPriceTpl='<span class="price" id="fqyPrice">&yen;<em>'+parseFloat(json.result.data.leastPlanAmount).toFixed(2)+'</em>/&nbsp;</span>',$priceSaleDom=$('#priceSale'),$fqyPriceDom=$('#fqyPrice'),$jdPriceDom=$('#jdPrice');$priceSaleDom.hide();!$fqyPriceDom.length?$priceSaleDom.after(fqyPriceTpl):$fqyPriceDom.html(fqyPriceTpl).show();$fqyPriceDom=$('#fqyPrice');!$jdPriceDom.length?$fqyPriceDom.after(jdPriceTpl):$jdPriceDom.html(jdPriceTpl).show();}};if(gVar.jdSkuInfo['fqyprice'+obj.skuId]){window.fqypriceCB(gVar.jdSkuInfo['fqyprice'+obj.skuId]);}else{mLs.loadScript(['//wq.jd.com/commodity/extension/fqyprice?callback=fqypriceCB&sceneval=2','sku='+obj.skuId,'area='+obj.jdAddrId.join('-'),'t='+Math.random()].join('&'));}
var check=function(cb){if(loginHandler.getLoginStatus()){window.fqyCB=function(json){var result=json.result,isActive=false,tip='';if(json.errcode==='13'){loginHandler.login();}else if(json.errcode===0&&result&&result.isSucc){gVar.jdSkuInfo.fqy=json;isActive=(result.activatedStatus==='1');tip='';}else{tip='';}
if(tip)cb(isActive,tip);};if(gVar.jdSkuInfo.fqy){window.fqyCB(gVar.jdSkuInfo.fqy);}else{mLs.loadScript({url:'//wq.jd.com/commodity/extension/checkfqycredit?callback=fqyCB&sceneval=2&t='+Math.random(),onError:function(){cb(false,'');}});}}else{loginHandler.login();}};$('#specBuyBtn,#specBuyBtn1').off().on('click',function(){reporter.txReport({ptag:'7001.1.8'});check(function(isActive,tip){if(isActive){reporter.pingClick('MProductdetail_fenqiyong',obj.skuId,'5',obj.skuId);setTimeout(function(){location.href='//fenqiyong.m.jd.com/?sourcekey=m&skuId='+obj.skuId;},200);}else{popUp.createPopup({flag:3,msg:tip});}});});}
function accessory(obj){if(obj.isJDChoice)return;if(!obj||!obj.skuId||!obj.jdCategory){return;}
var hideMoreEnter=function(){obj.accessoryNeedMore=false;$('#accessoryWrap').find('.hot_more').hide();};if(!window.showPageData33316){window.showPageData33316=function(ppms){gVar.jdSkuInfo.accessoryInfo=ppms;if(ppms.data&&ppms.data.length>0){var dataItem=ppms.data.filter(function(s){return s&&s.cid3s&&~('|'+s.cid3s+'|').indexOf('|'+obj.jdCategory[2]+'|');})[0];if(dataItem){if(dataItem.enterText){$('#accessoryArea').find('.detail_accessory_more').text(dataItem.enterText);}
window.categoryCB=function(json){if(!json||json.errcode!=0){hideMoreEnter();return;}
var tpl='<li class="detail_accessory_list_item" categoryId="{#id#}"><div class="detail_accessory_list_item_cover"><img src="{#imgpath#}"></div><p class="detail_accessory_list_item_name">{#name#}</p></li>',htmlArr=[],accyCategory=[];if(json.data&&json.data.category&&json.data.category.length>3){accyCategory=json.data.category;accyCategory.forEach(function(val){val.imgpath=val.itemLogoUrl;if(val.imgpath){htmlArr.push($jsonToTpl(val,tpl));}});if(htmlArr.length>3){$('#accessoryArea ul.detail_accessory_list').html(htmlArr.join(''));$('#accessoryArea').show().next('div.detail_gap').show();window.wa&&window.wa('ptagExposure',{ptag:'7001.1.142'});$('#accessoryArea ul.detail_accessory_list').on('click','li',function(){var tar=$(this),categoryId=tar.attr('categoryId')||0;location.href='//3c-peijian.jd.com/index?banner=null&ABTestFlag=0&eventId=6&sku='+obj.skuId
+'&cid='+obj.jdCategory[2]
+'&accyCategoryId='+categoryId;});$('#accessoryArea a.detail_accessory_more').on('click',function(){location.href='//3c-peijian.jd.com/index?accyCategoryId=&banner=null&ABTestFlag=0&eventId=6&sku='+obj.skuId+'&cid='+obj.jdCategory[2];});}else{hideMoreEnter();}}else{hideMoreEnter();}};mLs.loadScript(['//wq.jd.com/commodity/peijian/categorylist?sceneval=2&sku='+obj.skuId,'source=item','cat='+obj.jdCategory[2],'callback=categoryCB','t='+Math.random()].join('&'));}}};}
if(gVar.jdSkuInfo.accessoryInfo){window.showPageData33316(gVar.jdSkuInfo.accessoryInfo);return;}
mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v33316'}});}
function zxService(obj){var decorate=obj.decorate;if(decorate.toUserPrice>0){$('#priceDis').html('<span> &yen; '+decorate.toUserPrice+'</span>').show();}
if(decorate.fitRfPrice&&decorate.fitRfPrice!='0'){$('#priceDesc').text('');$('#pcPriceDesc').html(decorate.fitRfPrice+'<i class="sams_info"></i>');$('#pcPriceDesc,#priceTag,#priceDesc').show();$('#pcPriceDesc i.sams_info').on('click',function(){popUp.createPopup({flag:3,msg:'<div class="inner"><dl><dd></dd></dl></div>'});});}
if(!gVar.isInitZxService){$('#sendArea').hide().next('div.detail_gap').hide();$('#detailTab div[no]').eq(1).text('');$('#popupSkuArea').hide();$('#skuWindow').next('div.detail_gap').hide();$('#skuCity').show();$('#storePanel2').next('div.detail_gap').show();$('#storePanel2').after($('#serviceArea'));}
if(decorate.fitCaseHtmlPc){if($('#zxDetail').length==0){$('#detailTab div[no]').eq(1).after('<div class="item" no="3" ptag="7001.1.15"></div>');$('#detailTab div[no]').each(function(ind,item){$(item).attr('no',ind+1);});$('#detail3').attr('id','detail4');$('#detail2').after('<div class="detail_item p_desc" id="detail3"><div><div id="zxDetail" class="detail_pc"></div></div></div>');}
$('#zxDetail').html(itemComm.tavlHTML(decorate.fitCaseHtmlPc));itemComm.initLoadImg({commId:'zxDetail'});}
window.zxcityCallBack=function(city){var item=obj.item(),arr=item.newColorSize,cityData=city.getCityData(arr),len=arr.length;if(len>0){for(var i=0;i<len;++i){var item=arr[i];if(item.skuId==obj.changeSkuId){var c1=item['1'];if(c1){var province=city.getProvinceByCityName(c1);$('#skuCityTips').text(province[1]+' '+c1);obj.locShopInfo.locationId=province[0]+'-'+city.getCityId(c1)+'-0';}else{$('#skuCity').hide();}
break;}}}
setZxServiceDom(obj,cityData,city);}
mLs.loadScript({url:'//wq.360buyimg.com/js/common/dest/wq.item.city.min.js?t=201708081735',isToken:false});gVar.isInitZxService=true;}
function setZxServiceDom(obj,cityData,city){if($('#popupAddr2').length==0){var out='<div class="mod_address_slide" style="display:none;" id="popupAddr2"><div class="mod_address_slide_main type_flex"><div class="mod_address_slide_head" id="popupAddrHead2"><i class="close"></i></div><div class="mod_address_slide_body" id="addrBody2"></div><div class="mod_address_slide_foot"></div></div></div>';$('body').append(out);}else{$('#addrBody2').html('');}
var ul1=[],ul2=[],areas=obj.locShopInfo.locationId?obj.locShopInfo.locationId.split('-'):['19','1607','0'];for(var i=0,len=cityData.data['0'].length;i<len;++i){var d=cityData.data['0'][i];ul1.push('<li filter-type="area" tid="'+d.id+'" tname="'+d.name+'" class="">'+d.name+'</li>');}
for(var i=0,len=cityData.data['1'].length;i<len;++i){var d=cityData.data['1'][i];ul2.push('<li filter-type="area" tid="'+d.id+'" pid="'+d.pid+'" tname="'+d.name+'" class="">'+d.name+'</li>');}
var addrBody=$('#addrBody2');addrBody.prepend('<ul class="mod_address_slide_tabs_1" id="ulAddrTab2"><li class="cur" ind="0" tid="0"><span></span></li></ul>');addrBody.append('<ul class="mod_address_slide_list_2" id="ulAddrList2_1">'+ul1.join('')+'</ul>');addrBody.append('<ul class="mod_address_slide_list_2" id="ulAddrList2_2" style="display:none;">'+ul2.join('')+'</ul>');$('#popupAddr2').on('click','i.close',function(e){close();});$('#skuCity').on('click',function(e){obj.mainViewScroll=$(window).scrollTop();$('body').addClass('overflowHide');$('#popupAddr2').addClass('show').show();});$('#ulAddrTab2').on('click','li',function(e){var tar=$(this),ind=tar.attr('ind'),tid=tar.attr('tid');if(ind==0){$('#ulAddrList2_2').hide();$('#ulAddrList2_1').show();$('#ulAddrList2_1 li').each(function(ind,item){var tar2=$(item),tid2=tar2.attr('tid');if(tid2==tid){tar2.addClass('on');}else{tar2.removeClass('on');}});$('#ulAddrTab2').html('<li class="cur" ind="0" tid="0"><span></span></li>');}});$('#ulAddrList2_1').on('click','li',function(e){var tar=$(this),tid=tar.attr('tid');$('#ulAddrTab2').html('<li class="" ind="0" tid="'+tid+'"><span>'+tar.text()+'</span></li><li class="cur" ind="1" tid="0"><span></span></li>');$('#ulAddrList2_2 li').each(function(ind,item){var tar2=$(item),pid=tar2.attr('pid');if(pid==tid){tar2.show();}else{tar2.hide();}});$('#ulAddrList2_1').hide();$('#ulAddrList2_2').show();areas[0]=tid;});$('#ulAddrList2_2').on('click','li',function(e){var tar=$(this),tid=tar.attr('tid');var c1=tar.text(),province=city.getProvinceByCityName(c1);$('#skuCityTips').text(province[1]+' '+c1);areas[1]=tid;obj.locShopInfo.locationId=areas.join('-');var skuName=[c1],sku=cityData.skuMap[c1];if(sku){obj.jdSkuStatus=true;obj.changeSkuId=sku;obj.skuChooseArr=[].concat(skuName);skuName.push(obj.buyNumController.buyNum+'');$('#skuChoose').html(skuName.join(','));$('#popupSkuChoose').html('<span></span>'+' '+skuName.join(','));obj.locShopInfo.shopId='';obj.setItemInfo();}
close();});function close(){$('#popupAddr2').removeClass('show').hide();$('body').removeClass('overflowHide');window.scrollTo(0,obj.mainViewScroll);}}
function wuyouInsurance(obj){if(!obj.isZiying)return;if(!window.showPageData33252){window.showPageData33252=function(json){gVar.jdSkuInfo.wuyou=json;var dataItemArr=[],data=json.data,category=obj.jdCategory,category1='|'+category[0]+'|',category2='|'+category[1]+'|',category3='|'+category[2]+'|',item=obj.item()||{},spAttr=item.spAttr||{},brandId='|'+item.brandId+'|',adIdArr=[];dataItemArr=data.filter(function(s){var checkCid=true,checkBrand=true,checkSpAttr=true,result=true;if(!s||!s.describe||!s.icon||!s.link){return false;}
if(!s.cid1s&&!s.cid2s&&!s.cid3s){checkCid=false;}
if(!s.brandId||brandId=='||'){checkBrand=false;}
if(!s.specMark||!s.specMarkVal){checkSpAttr=false;}
s.cid1s='|'+s.cid1s+'|';s.cid2s='|'+s.cid2s+'|';s.cid3s='|'+s.cid3s+'|';s.cid3s='|'+s.cid3s+'|';s.brandId='|'+s.brandId+'|';s.specMarkVal='|'+s.specMarkVal+'|';if(checkCid&&((!~s.cid1s.indexOf(category1))&&(!~s.cid2s.indexOf(category2))&&(!~s.cid3s.indexOf(category3)))){result=false;}
if(checkBrand&&(!~s.brandId.indexOf(brandId))){result=false;}
if(checkSpAttr&&(!~s.specMarkVal.indexOf('|'+spAttr[s.specMark]+'|'))){result=false;}
return result;});if(dataItemArr.length>0){var $dom=$('#wuyouInsurance'),$bzDom=$('#normalServerPromise');var tpl='<div class="blue_row" style="{#background#}"><a href="{#link#}" class="txt" ptag="{#clickRd#}" style="{#style#}"><img src="{#icon#}" class="row_icon">{#describe#}</a></div>',bzTpl='<div><div class="mod_tit_line"><h3>{#bzTitle#}</h3></div>{#bzContent#}</div>';html=[],bzHtml=[];dataItemArr.forEach(function(dataItem,idx,arr){if(dataItem.background){dataItem.background='background:'+dataItem.background+';';}
dataItem.style='';if(dataItem.describeColor){dataItem.style='color:'+dataItem.describeColor;}
if(dataItem.exposureRd){window.wa&&window.wa('ptagExposure',{ptag:dataItem.exposureRd});}
html.push($jsonToTpl(dataItem,tpl));if(dataItem.bzTitle&&dataItem.bzContent){bzHtml.push($jsonToTpl(dataItem,bzTpl));}});html.length&&$dom.length&&$dom.html(html.join('')).show();bzHtml.length&&$bzDom.length&&$bzDom.html(bzHtml.join('')).show();}};}
if(gVar.jdSkuInfo.wuyou){window.showPageData33252(gVar.jdSkuInfo.wuyou);return;}
mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v33252'}});}
function globalBuyService(obj,taxinfo){if(obj.isOverseaPurchase<=0||!taxinfo)return;var spAttr=obj.item().spAttr,str='',serviceStr='<ul>';if(spAttr.qqjx){if(taxinfo.jingXuanVo&&taxinfo.jingXuanVo.serviceList&&taxinfo.jingXuanVo.serviceList.length>0){for(var i=0;i<taxinfo.jingXuanVo.serviceList.length;i++){var t=(taxinfo.jingXuanVo.serviceList[i].title||'').replace(/(^\s*)|(\s*$)/g,'');var c=(taxinfo.jingXuanVo.serviceList[i].content||'').replace(/(^\s*)|(\s*$)/g,'');if(t){str+=(i==0?'':'  ')+t;serviceStr+='<li><div class="title">'+t+'</div><div class="content">'+c+'</div></li>';}}
serviceStr+='</ul>';popUp.setPopupBody('globalService',serviceStr);$('#globalBuyServiceArea>span').html(str);$('#globalBuyServiceArea').show().addClass('show');window.wa&&window.wa('ptagExposure',{ptag:'7001.1.205'});}}else{if(taxinfo.iconInfoVoList&&taxinfo.iconInfoVoList.length>0){for(var i=0;i<taxinfo.iconInfoVoList.length;i++){var t=(taxinfo.iconInfoVoList[i].title||'').replace(/(^\s*)|(\s*$)/g,'');var c=(taxinfo.iconInfoVoList[i].content||'').replace(/(^\s*)|(\s*$)/g,'');if(t){str+=(i==0?'':'  ')+t;serviceStr+='<li><div class="title">'+t+'</div><div class="content">'+c+'</div></li>';}}
serviceStr+='</ul>';popUp.setPopupBody('globalService',serviceStr);$('#globalBuyServiceArea>span').html(str);$('#globalBuyServiceArea').show().addClass('show');window.wa&&window.wa('ptagExposure',{ptag:'7001.1.203'});}}}
function jzService(obj,brandId,jdzzDesc){if(obj.isJDChoice)return;if(!obj.isInit){$('#jzPoint').hide();$('#jzServiceArea').hide().removeClass('show');}
if(brandId!=299330)return;if(jdzzDesc)$('#jzPoint').html(jdzzDesc).show();$('#jzServiceArea').show().addClass('show');if(obj.isInit){popUp.setPopupBody('jzService','<ul>'+'<li>'+'<div class="title">'+'<i></i>'+'</div>'+'<div class="content">'+''+'</div>'+'</li>'+'<li>'+'<div class="title">'+'<i></i>'+'</div>'+'<div class="content">'+''+'</div>'+'</li>'+'</ul>');}}
function eCard(obj,yysfhf){if(yysfhf==1){$('#gotoCart').hide();$('#popupCount').hide();}else{$('#specAddBtn,#specAddBtn1').off().on('click',function(event){event.preventDefault&&event.preventDefault();event.stopPropagation&&event.stopPropagation();reporter.txReport({ptag:'7001.1.10'});loginHandler.loginAuth({biz:'car',forceLogin:true,redirect:obj.locationUrl,cb:function(){window.giftcardAddCartsCB=function(json){if(json.result){showNotice({str:'',iconFlag:1});var $popDom=$('#popone');$popDom.html('+'+obj.buyNumController.buyNum).addClass('show');setTimeout(function(){$popDom.removeClass('show');},2000);reporter.pingClick("MProductdetail_EcardAddCart",obj.skuId,"5",obj.skuId);}else{showNotice({str:'',iconFlag:2});}};mLs.loadScript({url:['//giftcard.jd.com/giftcardpurchase/addCartsWX.action?callback=giftcardAddCartsCB','skuId='+obj.skuId,'num='+obj.buyNumController.buyNum,'t='+Math.random()].join('&'),onError:function(){showNotice({str:'',iconFlag:2});}});}});});$('#cartNum').hide();$('#gotoCart').find('.txt').text('');$('#gotoCart').off().on('click',function(event){event.preventDefault&&event.preventDefault();event.stopPropagation&&event.stopPropagation();obj.leavePage('http://giftcard.jd.com/giftcardpurchase/listGiftCardsForM.action');});}
$('#specBuyBtn,#specBuyBtn1').off().on('click',function(event){event.preventDefault&&event.preventDefault();event.stopPropagation&&event.stopPropagation();reporter.txReport({ptag:'7001.1.8'});reporter.pingClick('MProductdetail_EcardBuy',obj.skuId,'5',obj.skuId);setTimeout(function(){location.href='http://giftcard.jd.com/giftcardpurchase/mIndex?skuNumInfo='+obj.skuId+','+obj.buyNumController.buyNum+'&addressId='+obj.addrId;},200);});}
function setArtScene(obj){if(obj.isJDChoice)return;var skuId=obj.skuId;window.artAuthorCB=function(json){if(json&&json.data&&json.data.artistName){gVar.jdSkuInfo['artAuthor'+skuId]=json;$('#artAuthor').html('<a href="//art.m.jd.com/artwork/artistDetail.html?skuId='+skuId+'" ptag="7001.1.209">'+json.data.artistName+'</a><span class="cup"> </span>').show();window.wa&&window.wa('ptagExposure',{ptag:'7001.1.210'});}};if(gVar.jdSkuInfo['artAuthor'+skuId]){window.artAuthorCB(gVar.jdSkuInfo['artAuthor'+skuId]);}else{mLs.loadScript('//api.m.jd.com/api?jsonp=artAuthorCB&functionId=getArtistInfo&body={"skuId":'+skuId+'}&client=artwork&clientVersion=1.0.0&t='+Math.random(),{keepProtocol:true});}}
function setConservationArea(obj){var $enterArea=$('#enterArea'),$conservationArea=$('#conservationArea');$enterArea.hide();$conservationArea.hide();var spAttr=obj.item().spAttr;if(spAttr.JNBT!=1||obj.isHuan||obj.isWareOff||obj.stockState[obj.skuId]==3||obj.jdAddrId[0]!=1)return;$enterArea.show();$conservationArea.show();$conservationArea.off('click').on('click',function(){loginHandler.loginLocation('//renzheng.jd.com/productSelected.jdhtml?sku='+obj.skuId);});}
function handleClothes(obj,colorList){if(obj.isInit){$('#colorSwitch').on('click','.expand_area',function(){$('#colorSwitch').toggleClass('fold');});$('#colorSwitch').on('click','li',function(e){var $cLi=$(this),colorTxt=$cLi.find('p').html()||'',colorTxt=colorTxt.replace(/(^\s*)|(\s*$)/g,"");$('#popupSkuArea span.item').each(function(index,item){var optionStr=$(item).html()||'',optionStr=optionStr.replace(/(^\s*)|(\s*$)/g,"");if(optionStr==colorTxt){obj.noRefreshClothesColorList=true;$('#colorSwitch li').removeClass('current');$cLi.addClass('current');$(item).trigger('click');}});});if($('#colorSwitch').hasClass('show')){window.wa&&window.wa('ptagExposure',{ptag:'7001.1.264'});}}else{if(obj.noRefreshClothesColorList){obj.noRefreshClothesColorList=false;return;}
$('#loopImgDiv').removeClass('right_bottom_tag_move');$('#colorSwitch').removeClass('show');$('#colorList').html('');if(!colorList||colorList.length<=1)return;$('#loopImgDiv').addClass('right_bottom_tag_move');colorList=colorList.map(function(it){for(var key in it){var val=it[key];if(typeof(val)!="string")continue;it[key]=htmlEncode(it[key]);}
return it;});var str='';for(var i=0,len=colorList.length;i<len;i++){var imgUrl=getImgUrl(colorList[i].imagePath,'80x80');str+='<li '+(colorList[i].select?'class="current"':'')+' data-sku="'+colorList[i].sku+'" ptag="7001.1.265">'+'<img src="'+imgUrl+'" />'+'<p>'+colorList[i].color+'</p>'+'</li>';}
$('#colorList').html(str);$('#colorSwitch').addClass('show');$('#colorSwitchCount').html(colorList.length);if(66*colorList.length<document.body.clientWidth){$('#colorList').addClass('justify_center');}else{$('#colorList').removeClass('justify_center');}}}
function checkClothesColorListNew(obj){if(obj.isJDChoice)return;if(!$('#colorSwitch').hasClass('show'))return;var item=obj.item(),saleProp=item.saleProp||{};for(var index in saleProp){if(saleProp[index]==''){var $disableColors=$('#sku'+index+' span.option_disabled');if($disableColors.length){var disableColorStr=$disableColors.text();$('#colorSwitch li').each(function(index,item){var cStr=$(item).find('p').text()||'',cStr=cStr.replace(/(^\s*)|(\s*$)/g,"");if(disableColorStr.indexOf(cStr)>=0){$(item).remove();}});}}}
if($('#colorSwitch li').length<2){$('#colorSwitch').removeClass('show');}}
function xianxiaStore(obj){$('#storeArea').hide().next('div.detail_gap').hide();var item=obj.item(),spAttr=item.spAttr||{},skumark=item.skumark||0;var isStoreGang=((item.skuMark&&item.skuMark.isSds==1)||spAttr.fdms==1||spAttr.tssp==4);var isBrandStore=(spAttr.wjtyd==1);if(obj.isJDChoice||(!isStoreGang&&!isBrandStore))return;var showStoreDom=function(opt){opt=opt||{};var $storeArea=$('#storeArea'),$storeList=$('#storeList'),$headTitle=$storeArea.find('.detail_mendian_head_tit'),$storeMore=$storeArea.find('.detail_mendian_head_more'),$storeName=$storeList.find('.detail_mendian_list_name').eq(0),$storeAddress=$storeList.find('.detail_mendian_list_desc').eq(0),$storeDistance=$storeList.find('.detail_mendian_list_distance').eq(0);var distance=(opt.storeDistance*1/1000).toFixed(1);$headTitle.text(opt.headTitle||'');$storeName.html(opt.storeName);$storeAddress.html(opt.storeAddress);if(distance>0){distance=distance>999?'999+':distance;$storeDistance.html(distance+'km');}
$('#storeArea').show().next('div.detail_gap').show();$storeMore.off().on('click',function(e){location.href=opt.viewMoreUrl;e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();});};var brandStore=function(opt){opt=opt||{};var viewMoreUrl='//jwm.jd.com/shop_list.html?skuId='+obj.skuId;if(!isBrandStore){if(opt.lat&&opt.lon){storeGang(opt);}
return;}
window.brandStoreCB=function(json){if(json&&json.model&&json.model.storeName&&json.model.storeProvinceCode&&json.model.storeCityCode&&json.model.storeProvince&&json.model.storeCity&&json.model.storeCounty){if(opt.lat&&opt.lon){viewMoreUrl=[viewMoreUrl,'lat='+opt.lat,'lon='+opt.lon,'provinceId='+json.model.storeProvinceCode,'cityId='+json.model.storeCityCode].join('&');}else{viewMoreUrl=[viewMoreUrl,'provinceId='+json.model.storeProvinceCode,'cityId='+json.model.storeCityCode,'addressName='+opt.address].join('&');}
showStoreDom({headTitle:'',viewMoreUrl:viewMoreUrl,storeName:json.model.storeName,storeAddress:json.model.storeProvince+json.model.storeCity+json.model.storeCounty+json.model.storeTown+json.model.address,storeDistance:json.model.distance});}else{if(opt.lat&&opt.lon){storeGang(opt);}}};if(opt.lat&&opt.lon){mLs.loadScript(['//wq.jd.com/bases/offlinestoreservice/getoffinestore?callback=brandStoreCB','skuid='+obj.skuId,'longitude='+opt.lon,'latitude='+opt.lat,'t='+Math.random()].join('&'));}else{mLs.loadScript(['//wq.jd.com/bases/offlinestoreservice/getoffinestore?callback=brandStoreCB','skuid='+obj.skuId,'address='+opt.address,'addrcode='+opt.addrcode,'t='+Math.random()].join('&'));}};var storeGang=function(opt){opt=opt||{};var viewMoreUrl='//md-mobile.jd.com/storefromwxmobileqq/storeinfolistview?skuId='+obj.skuId+'&venderId='+obj.venderId+'&lng='+opt.lon+'&lat='+opt.lat+'&firstAddress=&secondAddress=&thirdAddress=&tssp='+spAttr.tssp+'&fdms='+spAttr.fdms+'&skumark='+skumark;window.storeGangCB=function(json){if(json&&json.errcode==0&&json.result&&json.result.strFullAddress&&json.result.strName&&json.result.ddDistance){showStoreDom({headTitle:'',viewMoreUrl:viewMoreUrl,storeName:json.result.strName,storeAddress:json.result.strFullAddress,storeDistance:json.result.ddDistance});}};mLs.loadScript(['//wq.jd.com/commodity/extension/StoreInfo?callback=storeGangCB','venid='+obj.venderId,'longitude='+opt.lon,'latitude='+opt.lat,'tssp='+(spAttr.tssp||''),'fdms='+(spAttr.fdms||''),'skumark='+skumark,'t='+Math.random()].join('&'));};getMyLocation(function(item){if(item&&item.latitude&&item.longitude){brandStore({lat:item.latitude,lon:item.longitude});}else if(obj.jdAddrId&&obj.jdDetailAddr){brandStore({address:obj.jdDetailAddr,addrcode:obj.jdAddrId.slice(0,4).join('_')});}});}
exports.initStatus=initStatus;exports.yuShou=yuShou;exports.qianggou=qianggou;exports.secondKill=secondKill;exports.yuShouNoWay=yuShouNoWay;exports.setSkuAttach=setSkuAttach;exports.showStore=showStore;exports.showJdGame=showJdGame;exports.landingMatch=landingMatch;exports.isHuanAlert=isHuanAlert;exports.samInfo=samInfo;exports.addEnter=addEnter;exports.tencentVideo=tencentVideo;exports.addrCookieRp=addrCookieRp;exports.wqmnxCookieRp=wqmnxCookieRp;exports.carInfo=carInfo;exports.checkCarSku=checkCarSku;exports.checkSkuListForCar=checkSkuListForCar;exports.secondHand=secondHand;exports.prescribeDrug=prescribeDrug;exports.setDrugNum=setDrugNum;exports.askAnswer=askAnswer;exports.promoteAtmosphere=promoteAtmosphere;exports.fqyPay=fqyPay;exports.accessory=accessory;exports.zxService=zxService;exports.profitBelt=profitBelt;exports.plusGiftLogic=plusGiftLogic;exports.wuyouInsurance=wuyouInsurance;exports.globalBuyService=globalBuyService;exports.jzService=jzService;exports.eCard=eCard;exports.setArtScene=setArtScene;exports.setConservationArea=setConservationArea;exports.handleClothes=handleClothes;exports.checkClothesColorListNew=checkClothesColorListNew;exports.xianxiaStore=xianxiaStore;});
;define('lazyLoad',function(require,exports,module){var _cacheThisModule_;var $=require('zepto');var g={};g.autoLoadImage=function(option){var opt={scrollOffsetH:100,initSrcName:'init_src',container:document.body,fadeIn:false,zoom:1,skip_invisible:false,afterImgLoaded:null};if(option){for(var key in option){opt[key]=option[key];}}
function init(){var cont=typeof opt.container=="string"?$("#"+opt.container):$(opt.container);var objImages=$("img["+opt.initSrcName+"]",cont);objImages.each(function(i){var dom=$(this);var src=dom.attr(opt.initSrcName);if(window.JD){var size=dom.attr('data-size')||'';var width=0,height=0,cutstr='!cc_';if(/^(\d+)x(\d+)$/i.test(size)){width=RegExp.$1;height=RegExp.$2;if(+width>0&&+height>0){cutstr=cutstr+width+'x'+height;src=JD.img.getImgUrl(src,width,height,cutstr);}}
src=JD.url.getImageUrl(src,width,height);}
images_data.cache.push({url:src,loaded:0,slider:dom.attr("slider"),obj:dom,top:(opt.skip_invisible&&isElementHidden(dom)?Infinity:dom[0].getBoundingClientRect().top)*opt.zoom+window.pageYOffset});});images_data.num=images_data.cache.length;}
var images_data={viewHeight:$(window).height(),viewWidth:$(window).width(),ptr:"",cache:[],num:0};init();if(images_data.ptr){clearInterval(images_data.ptr);}
images_data.ptr=setInterval(doScroll,100);function doScroll(){var scrollHeight=window.pageYOffset,visibleHeight=images_data.viewHeight+opt.scrollOffsetH+scrollHeight,visibleWidth=images_data.viewWidth;$.each(images_data.cache,function(i,data){var element=data.obj,loaded=data.loaded;if(visibleHeight>data.top&&!loaded){if(data.slider){if(element.offset().left>visibleWidth||element.offset().left<0){return;}}
if(data.slider){element.attr("slider","");data.slider=null;}
element.attr("onerror","__reloadResource(this)");element.attr("src",data.url);element.on("load",function(){opt.afterImgLoaded&&opt.afterImgLoaded(element);})
element.removeAttr(opt.initSrcName);data.loaded=images_data.num;element.attr("loaded",images_data.num);opt.fadeIn&&element.css("opacity","1");images_data.num--;}});if(images_data.num==0){clearInterval(images_data.ptr);images_data.ptr=null;}
opt.callback&&opt.callback();}}
function isElementHidden(ele){var _relate=$(ele).parents().concat();_relate.unshift($(ele)[0]);return _relate.some(function(e){if(getComputedStyle(e,'').getPropertyValue("display")=="none"){return true;}});}
module.exports=g;});
;define("ajax",function(require,exports,module){var _cacheThisModule_;var loading=false;var dataCache={};var ajaxSettings={type:'GET',success:empty,error:empty,complete:empty,load:empty,context:null,global:true,retryCount:0,globalLock:0,lockCallback:null,cgiKey:false,setCache:function(data){if(!this.cgiKey){throw Error("cgiKey");}
dataCache[this.cgiKey]=data;},degrade:false,xhr:function(){return new window.XMLHttpRequest()},ump:{bizId:'',opId:'',ret:'errCode,errcode,retCode,retcode,ret,errId,iRet,ret_code',errBizId:'',errOpId:'',errRetId:1,reportHook:null},dataType:'json',accepts:{script:'text/javascript, application/javascript, application/x-javascript',json:'application/json',xml:'application/xml, text/xml',html:'text/html',text:'text/plain'},crossDomain:false,timeout:8,processData:true,cache:false,wqunit:/[?&]_wqunit_=1/.test(location.search),setReportUrl:""}
var globallKey="";if(window.JD){if(!JD.ajax)JD.ajax={};globallKey=JD.ajax;}else{globallKey=window;}
if(!globallKey.callbackName){var callbackSuffix=['A','B','C','D','E','F','G','H','I','J','K',"L",'M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(var i=0;i<3;i++){for(var j=0;j<26;j++){callbackSuffix.push(callbackSuffix[i*26+j]+callbackSuffix[j]);}}
globallKey.callbackName=callbackSuffix;}
globallKey.ajaxCount=globallKey.ajaxCount||0;var reportUrl="";var sceneval=window.JD&&JD.url&&JD.url.getUrlParam("sceneval")||(/(\.|^)m\.jd\.com/.test(window.location.hostname)?2:0);var isRequestNum=0;exports.load=ajax;var g_login_type=(function detectPTK(){var ua=navigator.userAgent.toLowerCase();var type=0;if(window.JD&&JD.wxapp&&JD.wxapp.wxappType==3){type=1;}else if(sceneval){type=1;}else if(/jdapp;/.test(ua)){type=1;}
return type;})();exports.addToken=addToken;function assign(config){config=config||{};var arg=arguments;for(var i=1,len=arg.length;i<len;i++){for(var key in arg[i]){if(typeof arg[i][key]=="object"){config[key]=assign(config[key],arg[i][key]);}else if(typeof config[key]=="undefined"){config[key]=arg[i][key];}}}
return config;}
function ajax(options){if(!options)return false;var settings=assign(options,ajaxSettings);if(settings.globalLock){if(loading){console.log("ajax loading ...");typeof settings.lockCallback=='function'&&settings.lockCallback();return false;}
loading=true;}
if(settings.cgiKey){window.cgiData=dataCache;}
if(settings.cgiKey&&dataCache[settings.cgiKey]){console.log("ajax");settings.isCache=1;ajaxSuccess(dataCache[settings.cgiKey],"",settings);return false;}
if(location.hostname=="ppms.jd.com"){settings.dataType='jsonp';}
settings.url=settings.url.replace(/^http:/,"");if(settings.setReportUrl&&typeof settings.setReportUrl=="function"){reportUrl=settings.setReportUrl();!reportUrl&&(reportUrl=settings.url);}else{reportUrl=window.CGI302ReportKeepUrl?settings.url:settings.url.replace(/\?.*/,'');}
if(!settings.crossDomain)settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host;if(settings.crossDomain)settings.xhrFields={withCredentials:true};if(!settings.url)settings.url=window.location.toString();serializeData(settings);var dataType=settings.dataType,hasPlaceholder=/\?.+=\?/.test(settings.url);if(hasPlaceholder)dataType='jsonp';if(settings.cache===false||((!options||options.cache!==true)&&('script'==dataType||'jsonp'==dataType)))
settings.url=appendQuery(settings.url,'_='+Date.now());if(!options.noSceneVal&&sceneval){settings.url=appendQuery(settings.url,'sceneval='+sceneval);}
settings.url=appendQuery(settings.url,'g_login_type='+g_login_type);if('jsonp'==dataType||settings.wqunit){if(!hasPlaceholder){settings.urlbak=settings.url;settings.url=appendQuery(settings.url,settings.jsonp?(settings.jsonp+'=?'):settings.jsonp===false?'':'callback=?')}
settings.url=addToken(settings.url,"ls");return ajaxJSONP(settings)}
if(settings.type.toLowerCase()=='post'&&settings.jsonpCallback){settings.url=addToken(settings.url,"fr");return ajaxPost(settings);}
if(/[?&]ajaxtest=1/.test(location.search)&&dataType=='json')settings.url=settings.url.replace("http://wq.jd.com","http://wqs.jd.com");settings.url=addToken(settings.url,"ajax");if(window.JD){settings.url=JD.url.getCgiUrl(settings.url);}
var mime=settings.accepts[dataType],headers={},setHeader=function(name,value){headers[name.toLowerCase()]=[name,value]},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=settings.xhr(),nativeSetHeader=xhr.setRequestHeader,abortTimeout;if(!settings.crossDomain)setHeader('X-Requested-With','XMLHttpRequest')
setHeader('Accept',mime||'*/*');if(mime=settings.mimeType||mime){if(mime.indexOf(',')>-1)mime=mime.split(',',2)[0];xhr.overrideMimeType&&xhr.overrideMimeType(mime)}
if(settings.contentType||(settings.contentType!==false&&settings.data&&settings.type.toUpperCase()!='GET'))
setHeader('Content-Type',settings.contentType||'application/x-www-form-urlencoded')
if(settings.headers)for(name in settings.headers)setHeader(name,settings.headers[name]);xhr.setRequestHeader=setHeader;xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;clearTimeout(abortTimeout);var result,error=false;if((xhr.status>=200&&xhr.status<300)||xhr.status==304||(xhr.status==0&&protocol=='file:')){dataType=dataType||mimeToDataType(settings.mimeType||xhr.getResponseHeader('content-type'));result=xhr.responseText;try{if(dataType=='script')(1,eval)(result)
else if(dataType=='xml')result=xhr.responseXML
else if(dataType=='json')result=/^\s*$/.test(result)?null:parseJSON(result)}catch(e){error=e}
if(error)ajaxError(error,'parsererror',xhr,settings)
else ajaxSuccess(result,xhr,settings)}else{console.log("ajax error",xhr);ajaxError(xhr.statusText||null,"load",xhr,settings)}}}
var async='async'in settings?settings.async:true;xhr.open(settings.type,settings.url,async,settings.username,settings.password);if(settings.xhrFields)for(name in settings.xhrFields)xhr[name]=settings.xhrFields[name];for(name in headers)nativeSetHeader.apply(xhr,headers[name]);if(settings.timeout>0)abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty;xhr.abort();ajaxError(null,'timeout',xhr,settings);},settings.timeout*1000);xhr.send(settings.data?settings.data:null);return xhr}
function parseJSON(data){if(!data||typeof(data)!="string"){return data;}
data=data.replace(/^\s+|\s+$/g,"");if(!data)return data;return JSON.parse(data);};function sendUB(data,type){}
function ajaxJSONP(options){var callbackName;if(/(http(s)?:)?\/\/wq(coss)?\.jd\.com\/mcoss\//.test(options.url)&&window.JD&&JD.cgi.getCallback){callbackName=JD.cgi.getCallback(options.url);}
if(!callbackName){var _callbackName=options.jsonpCallback;callbackName=(typeof _callbackName=='function'?_callbackName():_callbackName)||('jsonpCBK'+(globallKey.callbackName[(globallKey.ajaxCount++)%globallKey.callbackName.length]));}
var script=document.createElement('script'),responseData,xhr={abort:abort},abortTimeout,abort=function(errorType){isTimeout=1;isRequestNum--;console.log(options.url,"timeout");sendUB(isRequestNum,"timeout");ajaxError(null,"timeout",xhr,options);},isTimeout=0;options.callbackName=callbackName;script.charset=options.charset||"utf-8";isRequestNum++;script.onload=script.onerror=function(e,errorType){clearTimeout(abortTimeout);if(isTimeout){console.log("timeout");return false;}
isRequestNum--;if(e.type=='error'){console.log(options.url,errorType||e.type||'error');sendUB(isRequestNum,"error");ajaxError(null,'error',xhr,options);}else if(!responseData){sendUB(isRequestNum,"load");ajaxError(null,e.type,xhr,options);window.onerror('','','','',{stack:'servererror:'+reportUrl});}else{if(responseData[0]&&responseData[0].retcode==-1&&responseData[0].message==""&&responseData[0].unitReload==1){options.wqunit=false;options.url=options.urlbak;ajax(options);}else{ajaxSuccess(responseData[0],xhr,options);}}
responseData=undefined;script.parentNode.removeChild(script);}
window[callbackName]=function(){responseData=arguments;}
options.url=options.url.replace(/\?(.+)=\?/,'?$1='+callbackName);script.src=options.url;if(options.wqunit){script.src="http://ppms.jd.com/wqunit/unittest?pageUrl="+encodeURIComponent(location.href)+"&cgiUrl="+encodeURIComponent(script.src)+"&callback="+callbackName;}
document.head.appendChild(script);if(options.timeout>0)abortTimeout=setTimeout(function(){abort('timeout');},options.timeout*1000);return xhr;}
function ajaxPost(options){var _callbackName=options.jsonpCallback,callbackName=(typeof _callbackName=='function'?_callbackName():_callbackName)||('jsonpCBK'+(callbackSuffix[(jsonpID++)%callbackSuffix.length])),abortTimeout,xhr={abort:abort},abort=function(errorType){isTimeout=1;console.log(options.url,"timeout");ajaxError(null,"timeout",xhr,options);},isTimeout=0;window[callbackName]=function(){clearTimeout(abortTimeout);responseData=arguments;var form=document.getElementById("ajaxPostForm");form&&form.remove();var iframe=document.getElementById("ajaxPostIframe");iframe&&iframe.remove();ajaxSuccess(responseData[0],xhr,options);}
options.data.callback=callbackName;options.data.g_tk=getToken();formPost(options,options.isFile);if(options.timeout>0)abortTimeout=setTimeout(function(){window[callbackName]=empty;abort('timeout');},options.timeout*1000);}
function formPost(options,isFile){var form=document.getElementById("ajaxPostForm");var iframe=document.getElementById("ajaxPostIframe");if(!form){form=document.createElement("form");form.id="ajaxPostForm";iframe=document.createElement("iframe");iframe.height=0;iframe.width=0;iframe.id=iframe.name="ajaxPostIframe";iframe.style.display="none";form.style.display="none";document.body.appendChild(iframe);document.body.appendChild(form);}
$("input",form).remove();for(var i in options.data){var tempInput=document.createElement("input");$(form).append($(tempInput).attr("type","hidden").attr("name",i).attr("value",options.data[i]));}
form.target="ajaxPostIframe";form.action=options.url;form.method="POST";form.enctype=isFile?"multipart/form-data":"application/x-www-form-urlencoded";form.submit();}
function bizUmp(settings,data){var ump=settings.ump;if(!data||!ump||!ump.bizId||!ump.opId)return;var code={code:"2000",message:"default"};if(typeof ump.reportHook=="function"){code=ump.reportHook.call(null,data);}else if(ump.ret){var ret=ump.ret.split(",");for(var k in ret){if(ret[k]&&typeof data[ret[k]]!="undefined"){code={code:data[ret[k]]};break;}}}else{code={code:1000,message:"not find report code"};}
umpReport(ump.bizId,ump.opId,code.code,code.message);}
function bizUmpE(settings,code){var ump=settings.ump;if(!ump)return;if(!ump.errBizId||!ump.errOpId){if(!ump.ret)return;var ret=ump.ret.split(",")[0];bizUmp(settings,{ret:code});return;}
umpReport(ump.errBizId,ump.errOpId,ump.errRetId,code);}
function umpReport(biz,op,result,msg){JD.report.umpBiz({bizid:biz,operation:op,result:result,source:'0',message:msg||''});}
function ajaxSuccess(data,xhr,settings){settings.globalLock&&(loading=false);var context=settings.context,status='success';bizUmp(settings,data);settings.success.call(context,data,settings,status,xhr);ajaxComplete(status,xhr,settings);}
function ajaxError(error,type,xhr,settings,deferred){if(settings.retryCount<=0||settings.type.toLowerCase()=='post'){ajaxErrorCallback(error,type,xhr,settings);return;}
if(["error","parsererror"].indexOf(type)>=0){ajaxErrorCallback(error,type,xhr,settings);return;}
setTimeout(function(){settings.url=settings.url.replace(/(&)?(_|g_tk|g_ty|callback)=\w+/g,"");console.log("start retry,"+settings);settings.retryCount--;settings.globalLock&&(loading=false);ajax(settings);},0);}
function ajaxErrorCallback(error,type,xhr,settings){settings.globalLock&&(loading=false);var context=settings.context;console.log(settings.url,type,error);if(settings.degrade){console.log("",settings.degrade);settings.isDegrade=1;settings.success.call(context,settings.degrade,settings);}
var code={timeout:8000,error:5000,load:3020,abort:5001,parsererror:3021};bizUmpE(settings,code[type]);settings.error.call(context,type,code[type]||9000,settings,error,xhr);ajaxComplete(type,xhr,settings);}
function ajaxComplete(status,xhr,settings){var context=settings.context;settings.complete.call(context,status,xhr);}
function empty(){}
function serializeData(options){if(options.processData&&options.data&&typeof options.data!="string"){if(options.type.toLowerCase()=='post'&&options.jsonpCallback){return;}
options.data=param(options.data);}
if(options.data&&(!options.type||options.type.toUpperCase()=='GET'))
options.url=appendQuery(options.url,options.data),options.data=undefined}
function mimeToDataType(mime){if(mime)mime=mime.split(';',2)[0]
return mime&&(mime==htmlType?'html':mime==jsonType?'json':scriptTypeRE.test(mime)?'script':xmlTypeRE.test(mime)&&'xml')||'text'}
function appendQuery(url,query){if(query=='')return url
return(url+'&'+query).replace(/[&?]{1,2}/,'?')}
function addToken(url,type){var token=getToken();if(url==""||(url.indexOf("://")<0?location.href:url).indexOf("http")!=0){return url;}
if(url.indexOf("#")!=-1){var f1=url.match(/\?.+\#/);if(f1){var t=f1[0].split("#"),newPara=[t[0],"&g_tk=",token,"&g_ty=",type,"#",t[1]].join("");return url.replace(f1[0],newPara);}else{var t=url.split("#");return[t[0],"?g_tk=",token,"&g_ty=",type,"#",t[1]].join("");}}
return token==""?(url+(url.indexOf("?")!=-1?"&":"?")+"g_ty="+type):(url+(url.indexOf("?")!=-1?"&":"?")+"g_tk="+token+"&g_ty="+type);};function getToken(){var skey=getCookie("wq_skey"),token=skey==null?"":time33(skey);return token;};function time33(str){for(var i=0,len=str.length,hash=5381;i<len;++i){hash+=(hash<<5)+str.charAt(i).charCodeAt();};return hash&0x7fffffff;}
function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]):""):null;}
var escape=encodeURIComponent;function serialize(params,obj){for(var key in obj){params.add(key,obj[key]);}}
function param(obj){var params=[];params.add=function(k,v){this.push(escape(k)+'='+escape(v));};serialize(params,obj);return params.join('&').replace(/%20/g,'+');}
window.addEventListener('message',function(e){if(!e||!e.data)return false;var callback=e.data.callback;if(callback&&window[callback]){window[callback](e.data.data);}});});
;define('ui',function(require,exports,module){var _cacheThisModule_,container=document.body,removeAlertCoverDiv=0;var bInit1111Tips=false;var goLink="//wqs.jd.com/my/mywx1111.shtml?p=my1111Record";var alertCoverDiv=document.createElement('div');alertCoverDiv.className='mod_alert_mask show';function notNeedLoadCss(){var uiCSSUrl2='base/gb/css/gb.min_',uiCSSUrl3='wx/gb/css/gb.min_',uiCSSUrl4='sq/gb/css/gb.min_',uiCSSUrl6='wxsq_dev/gb/css/gb.min_',uiCSSUrl7='wxsq_dev/gb/css/failover_gb.min_',uiCSSUrl5='mod_alert.min',uiCSSUrl8='page_hdcp/gb/css/gb.min_',uiCSSUrl9='nb1807/gb/css/gb.min_',links=document.getElementsByTagName('link'),isHave=false;var homeUrl=window.JD?JD.url.homeUrl:'//wq.jd.com/mcoss/wxportal/mainentry?tpl=index_v5';if(location.href.indexOf(homeUrl)>-1){isHave=true;}
for(var i=0,l=links.length;i<l;i++){if(links[i].rel=='stylesheet'&&(links[i].href.indexOf(uiCSSUrl2)>=0||links[i].href.indexOf(uiCSSUrl3)>=0||links[i].href.indexOf(uiCSSUrl4)>=0||links[i].href.indexOf(uiCSSUrl5)>=0||links[i].href.indexOf(uiCSSUrl8)>=0||links[i].href.indexOf(uiCSSUrl9)>=0||links[i].href.indexOf(uiCSSUrl6)>=0)||links[i].href.indexOf(uiCSSUrl7)>=0){isHave=true;break;}}
return isHave;}
function loadCss(url){if(notNeedLoadCss()){return;}
var l=document.createElement('link');l.setAttribute('type','text/css');l.setAttribute('rel','stylesheet');l.setAttribute('href',url);document.getElementsByTagName("head")[0].appendChild(l);}
function showTip(obj){if(!obj)return;var className=obj.className||'g_small_tips',tips=document.querySelector("."+className),t=obj.t||2000,title=obj.title||'!';if(!tips){tips=document.createElement('div');tips.className=className;document.body.appendChild(tips);}
tips.innerText=title;tips.style.display='block';setTimeout(function(){tips.style.display='none';},t);}
function extend(a,b){for(var i in b){if(b.hasOwnProperty(i)){a[i]=b[i];}}
return a;}
function info(opts){var option={msg:"",icon:"none",delay:2000,showcoverdiv:false};opts=opts||{};extend(option,opts);var el=document.createElement('div');el.className="mod_alert show fixed";el.innerHTML=(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p>';container.appendChild(el);if(option.showcoverdiv){document.body.appendChild(alertCoverDiv);removeAlertCoverDiv++;}
setTimeout(function(){clear();},option.delay);function clear(){if(option.showcoverdiv){removeAlertCoverDiv--;removeAlertCoverDiv<1&&document.body.contains(alertCoverDiv)&&document.body.removeChild(alertCoverDiv);}
el.style.display='none';container.contains(el)&&container.removeChild(el);}}
function alert(opts){var option={showClose:false,msg:"",confirmText:'',icon:"none",onConfirm:null,stopMove:false,btnClass:'btn_1',confirmColor:""},stopMove=function(e){e.preventDefault();},el=document.createElement('div');opts=opts||{};extend(option,opts);option.delay=parseInt(option.delay||0);container=opts.container||container;el.className="mod_alert show fixed";el.innerHTML=(option.showClose?'<span class="close"></span>':'')+(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p>'+(option.subMsg?'<p class="small">'+option.subMsg+'</p>':'')+'<p class="btns"><a href="javascript:;" '+(option.confirmColor?('style="color:'+option.confirmColor+'"'):'')+' class="btn '+option.btnClass+'">'+option.confirmText+'</a></p>';container.appendChild(el);option.showClose&&(el.querySelector(".close").onclick=function(e){option.onCancel&&option.onCancel();this.onclick=null;clear();});el.querySelector(".btn").onclick=function(e){option.onConfirm&&option.onConfirm();this.onclick=null;clear();};option.delay&&setTimeout(function(){clear();},option.delay);document.body.appendChild(alertCoverDiv);option.stopMove&&document.addEventListener("touchmove",stopMove,false);removeAlertCoverDiv++;function clear(){removeAlertCoverDiv--;removeAlertCoverDiv<1&&document.body.contains(alertCoverDiv)&&document.body.removeChild(alertCoverDiv);el.style.display='none';container.contains(el)&&container.removeChild(el);option.stopMove&&document.removeEventListener("touchmove",stopMove,false);}}
function confirm(opts){var option={msg:"",icon:"none",okText:"",cancelText:"",onConfirm:null,onCancel:null,onClearCb:null,okClass:'btn_1',cancelClass:'btn_1',cancelColor:"",confirmColor:""};opts=opts||{};extend(option,opts);container=opts.container||container;var el=document.createElement('div');el.className="mod_alert show fixed";el.innerHTML=(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p>'+(option.subMsg?'<p class="small">'+option.subMsg+'</p>':'')+'<p class="btns"><a href="javascript:;" id="ui_btn_confirm" '+(option.confirmColor?('style="color:'+option.confirmColor+'"'):'')+' class="btn '+option.okClass+'">'+option.okText+'</a><a href="javascript:;" id="ui_btn_cancel" '+(option.cancelColor?('style="color:'+option.cancelColor+'"'):'')+' class="btn '+option.cancelClass+'">'+option.cancelText+'</a></p>';container.appendChild(el);document.body.appendChild(alertCoverDiv);el.querySelector("#ui_btn_cancel").onclick=function(e){option.onCancel&&option.onCancel();clear();};el.querySelector("#ui_btn_confirm").onclick=function(e){option.onConfirm&&option.onConfirm();clear();};removeAlertCoverDiv++;function clear(){removeAlertCoverDiv--;el.style.display='none';container.contains(el)&&container.removeChild(el);removeAlertCoverDiv<1&&document.body.contains(alertCoverDiv)&&document.body.removeChild(alertCoverDiv);option.onClearCb&&option.onClearCb();}}
var toast=function(){var wrap=document.createElement('div');wrap.style.cssText='text-align: center; position: fixed; z-index: 310; top: 40%; width: 100%;';var main=document.createElement('p');var mainCssText='display: inline-block; padding: 10px 15px; background-color: rgba(0,0,0,.7); border-radius: 4px; color: #fff; font-size: 14px; text-align: left; word-break: break-all; max-width: 70%; transition: opacity .7s;';wrap.appendChild(main);var timeout;return function(opts){var _opts={msg:'',style:'',delay:2000};opts=typeof opts==='object'?opts:{msg:opts};_opts=extend(_opts,opts);main.innerText=_opts.msg;main.style.cssText=mainCssText+_opts.style;main.style.opacity='1';document.body.appendChild(wrap);clearTimeout(timeout);timeout=setTimeout(function(){main.style.opacity='0';timeout=setTimeout(function(){document.body.removeChild(wrap);},700);},_opts.delay);}}();loadCss(JD.url.getStaticDisRec("//wq.360buyimg.com/fd/h5/base/gb/css/mod_alert.min_79c590c3.css"));module.exports={showTip:showTip,toast:toast,info:info,alert:alert,confirm:confirm};});
;define('wq.data.draw',function(require,exports,module){var _cacheThisModule_;var ajax=require("ajax");var login=require("login");var $=require("zepto");var ui=require("ui");var lock=false;exports.draw=_draw;exports.antiBrush=_antiBrush;exports.handleRetCode=_handleRetCode;function _draw(active,level,callback,opt){if(lock)return;lock=true;opt=opt||{};var option={active:"",level:"",callback:null,customUrl:"",customParam:{},sceneid:"",verifycode:"",verifysession:"",deal_id:"",dataType:"jsonp",degrade:{},stopAutoLogin:false,manuallyHandle:false,errorback:null,prizename:"",alertbtncb:null,lockCallback:null,customCall:null};if(typeof active=="object"){for(var i in option){option[i]=typeof active[i]!="undefined"?active[i]:option[i];}}else{option.active=active;option.level=level;option.callback=callback;for(var i in option){option[i]=typeof opt[i]!="undefined"?opt[i]:option[i];}}
if(!option.callback&&!option.customCall){option.callback=function(ret,data){ui.alert({showClose:false,msg:data.retmsg.replace(//g,option.prizename)||"~",icon:ret==0?"success":"fail",onConfirm:option.alertbtncb?option.alertbtncb:null});}}
if(option.customUrl){var url=option.customUrl;var data=option.customParam;}else{var url="//wq.jd.com/active/active_draw";var data={active:option.active,level:option.level,sceneid:option.sceneid,ifycode:option.verifycode,verifysession:option.verifysession,deal_id:option.deal_id,ext:'hj:'+(JD.device.scene=='qq'?'q':JD.device.scene=='jdapp'?'app':JD.device.scene=='mobile'||JD.device.scene=='qqbrower'?'m':'w')};for(var i in data){if(!data[i])delete data[i];}}
_antiBrush(function(flag,errorCode){if(flag){ajax.load({url:url,data:data,dataType:option.dataType,degrade:option.degrade,lockCallback:option.lockCallback,success:function(obj,settings){lock=false;_handleRetCode(obj,option.active,option.level,option.callback,option.manuallyHandle,option.errorback,settings,{prizename:option.prizename,sceneid:option.sceneid,alertbtncb:option.alertbtncb,options:option});},error:function(ret,settings){lock=false;JD.report.umpBiz({bizid:"320",operation:"0",result:"1",source:"0",message:"5:"+location.protocol+"//"+location.host+location.pathname+":"+ret});option.callback&&option.callback(8,{ret:8,retmsg:".",_errorBack_:1},settings);}});}else{lock=false;if(errorCode==2){option.callback&&option.callback(2,{ret:2,retmsg:".",needLogin:true});return false;}
if(errorCode!=0){option.callback&&option.callback(147,{ret:147,retmsg:"."});return false;}}},2,option.stopAutoLogin,true);}
function _handleRetCode(data,active,level,callback,manuallyHandle,errorback,settings,options){if(!settings){settings={};}
data.needLogin=data.needBind=data.needRealName=data.couponObtained=data.couponOver=false;if(data.ret==2){if(!options.options.stopAutoLogin){login.login();return true;}else{data.needLogin=true;}}
if(!options.options.customUrl&&data.active!=active){callback&&callback(8,{ret:8,retmsg:""},settings);return false;}
try{wa&&wa('shDeviceId',{type:1,activeInfo:{active:data.active,level:level?level:""}});}
catch(e){}
if(data.ret==0){if(options.options.customUrl){JD.report.umpBiz({bizid:"320",operation:"0",result:"0",source:"0",message:"2:"+location.protocol+"//"+location.host+location.pathname});callback&&callback(data.ret,data,settings);}else{if(data.bingo&&data.bingo.bingoret==0&&data.bingo.bingolevel>0){if(level&&data.bingo.bingolevel!=level){callback&&callback(8,{ret:8,retmsg:".."},settings);return false;}
JD.report.umpBiz({bizid:"320",operation:"0",result:"0",source:"0",message:"2:"+location.protocol+"//"+location.host+location.pathname});if(typeof cgiData=="object"){cgiData["querybingo_"+active]=null;}
callback&&callback(data.ret,data,settings);}
else{JD.report.umpBiz({bizid:"320",operation:"0",result:"1",source:"0",message:"3:"+location.protocol+"//"+location.host+location.pathname});callback&&callback(8,{ret:8,retmsg:"!"},settings);}}
return true;}
JD.report.umpBiz({bizid:"320",operation:"0",result:"0",source:"0",message:"4:"+location.protocol+"//"+location.host+location.pathname+":"+data.ret});if(data.ret==164||data.ret==163){if(!manuallyHandle){ui.alert({showClose:true,msg:"<br />"+(level?"":"")+"",confirmText:'',onConfirm:function(){location.href="//wqs.jd.com/my/bindpopupv2/index.shtml?returnUrl="+encodeURIComponent(location.href)+"&sceneid="+(options.sceneid?options.sceneid:"621394479")+"&ptag=138268.2.15";}});errorback&&errorback(data.ret,data,settings);return;}else{data.needBind=true;}}
if(data.ret==197){data.needRealName=true;}else if(data.ret==10){data.couponObtained=true;}else if([5,6,7,11].indexOf(data.ret)>=0){data.couponOver=true;}
if(options.options.customCall&&options.options.customCall(data.ret,data)){return true;}
if(!manuallyHandle&&(data.ret!=3&&data.ret!=4&&data.ret!=8&&data.ret!=2)){ui.alert({showClose:false,msg:data.retmsg.replace(//g,options.prizename)||"~",icon:"fail",onConfirm:options.alertbtncb?options.alertbtncb:null});errorback&&errorback(data.ret,data,settings);}
else{callback&&callback(data.ret,data,settings);}}
function _antiBrush(callback,times,stopAutoLogin,stopAutoRequest){if(JD.cookie.get("promotejs")&&stopAutoRequest){typeof callback==='function'&&callback&&callback(true);return true;}
times=typeof times!="undefined"?times:2;if(times==0){callback&&callback(false,-9999);return false;}
ajax.load({success:function(data,settings){if(data.errorCode==2&&!stopAutoLogin){return login.login();}
if(data.errorCode==0){JD.report.umpBiz({bizid:"320",operation:"4",result:"0",source:"0",message:""});data.function(data.TOKEN);if(!stopAutoRequest){setTimeout(function(){_antiBrush(null,2,stopAutoLogin);},270000);}
callback&&callback(true);}
else{JD.report.umpBiz({bizid:"320",operation:"4",result:"1",source:"0",message:data.errorCode});callback&&callback(false,data.errorCode);}},error:function(ret,settings){JD.report.umpBiz({bizid:"320",operation:"4",result:"1",source:"0",message:location.protocol+"//"+location.host+location.pathname+":"+ret});_antiBrush(callback,times-1,stopAutoLogin);},dataType:'jsonp',url:"//wq.jd.com/active/getfunction"});}});
;define('wq.data.active',function(require,exports,module){var _cacheThisModule_;var ajax=require("ajax");var login=require("login");var $=require("zepto");var ui=require("ui");var drawFunc=require("wq.data.draw");var _isjstoken=false;var _jstokenResult=false;var curEnv=JD.device.scene;var lock=false;if(!(JD.url.getUrlParam("activenologin")||window._activenologin)){drawFunc.antiBrush(function(ret){_jstokenResult=ret;_isjstoken=true;});}
exports.draw=drawFunc.draw;exports.showUserForm=_showUserForm;exports.submitInfo=_submitInfo;exports.queryInfo=_queryInfo;exports.queryBingos=_queryBingos;exports.reportinteraction=_reportinteraction;exports.antiBrush=drawFunc.antiBrush;exports.jstokenReady=function(callback){var _jstokenTimer=setInterval(function(){if(_isjstoken){callback&&callback(_jstokenResult);clearInterval(_jstokenTimer);}},50);}
exports.handleRetCode=drawFunc.handleRetCode;exports.reportAddress=_reportAddress;exports.queryAddress=_queryAddress;exports.showAddressTost=_showAddressTost;exports.showUserFormV2=_showUserFormV2;function _showUserForm(dialog,id,active,level,errBack,opt){if(!dialog||!id){errBack&&errBack({ret:1,msg:"dialog or id not exist"});return;}
if(!/^market00\d+$/.test(id)){errBack&&errBack({ret:2,msg:"biztype must be like this market001234"});return;}
if(active&&level){_queryBingos(active,function(data,oridata,settings){if(data.some(function(ceil){return ceil.level==level&&oridata.active==active;})){__handle();}
else{errBack&&errBack({ret:3,msg:"no bingo"});return;}});}
else{__handle();}
function __handle(){dialog=typeof dialog=='string'?$('#'+dialog):dialog.length?dialog:$(dialog);var errInfo=dialog.find('[tag=errInfo]'),name=dialog.find('[tag=fName]'),phone=dialog.find('[tag=fPhone]'),address=dialog.find('[tag=fAddress]'),msg,obj,info,form;dialog.find('[tag=cancel],[tag=close]').off().on("click",function(){dialog.hide();});errInfo.length&&errInfo.html('&nbsp;');name.val('');phone.val('');address.val('');_queryInfo(id,function(data){if(data.iRet==0&&data.sMsgContent){var anchor=document.createElement("a");anchor.innerHTML=data.sMsgContent;msg=anchor.innerText.split("|");name.val(msg[0]||'');phone.val(msg[1]||'');address.val(msg[2]||'');}});dialog.show();dialog.find('[tag=confirm]').off().on("click",function(event){var nameVal=$.trim(name.val()),phoneVal=$.trim(phone.val()),addressVal=$.trim(address.val());if(!nameVal){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
name.focus();return false;}
if(!phoneVal){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
phone.focus();return false;}
if(!/^((13[0-9]|15[012356789]|166|17[012345678]|18[0-9]|19[89]|14[56789])([0-9]{8})|((86)?(-)?(0[0-9]{2,3})?(-)?([0-9]{7,8})(-)?([0-9]{3,5})?))$/.test(phoneVal)){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
phone.focus();return false;}
if(!addressVal){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
address.focus();return false;}
errInfo.length&&errInfo.html('&nbsp;');form=nameVal+"|"+phoneVal+"|"+addressVal;_submitInfo(id,form,function(result){if(result.iRet==0){if(typeof cgiData=="object"){cgiData['appoint_'+id]=null;}
if(opt&&opt.success){opt.success();}
else{ui.info({msg:""});}}
else{if(opt&&opt.error){opt.error();}
else{ui.info({msg:""});}}
dialog.hide();});});}};function _submitInfo(biztype,value,callback){var postData={platform:JD.device.scene=='jdapp'?"3":JD.device.scene=='qq'?"1":"2"};if(biztype instanceof Array){postData.b_biztype=biztype.join("|");postData.b_msgcontent=value.join("|");}
else{postData.biztype=biztype;postData.msgcontent=value;}
ajax.load({success:function(data,settings){if(data.iRet==9999){login.login();}
else{JD.report.umpBiz({bizid:"320",operation:"3",result:"0",source:"0",message:location.protocol+"//"+location.host+location.pathname});callback&&callback(data,settings);}},error:function(ret,settings){JD.report.umpBiz({bizid:"320",operation:"3",result:"1",source:"0",message:location.protocol+"//"+location.host+location.pathname+":"+ret+"|"+biztype+"|"+value});callback&&callback({"iRet":"-25",errMsg:ret,_errorBack_:1},settings);},url:biztype instanceof Array?"//wq.jd.com/appointment/CommonBatchAppointSubmit":"//wq.jd.com/appointment/CommonAppointSubmit",data:postData,dataType:'jsonp'});}
function _queryInfo(biztype,callback,needcgikey){ajax.load({success:function(data,settings){if(data.iRet==9999){login.login();}
else{if(data.iRet==0&&needcgikey){settings.setCache(data);}
JD.report.umpBiz({bizid:"320",operation:"2",result:"0",source:"0",message:location.protocol+"//"+location.host+location.pathname});callback&&callback(data,settings);}},error:function(ret,settings){JD.report.umpBiz({bizid:"320",operation:"2",result:"1",source:"0",message:location.protocol+"//"+location.host+location.pathname+":"+ret+"|"+biztype});callback&&callback({"iRet":"-25","errMsg":ret,_errorBack_:1},settings);},retryCount:1,timeout:4,cgiKey:needcgikey?("appoint_"+(biztype instanceof Array?biztype.join("|"):biztype)):"",url:biztype instanceof Array?"//wq.jd.com/appointment/CommonBatchAppointQuery":"//wq.jd.com/appointment/CommonAppointQuery",data:{biztype:biztype instanceof Array?biztype.join("|"):biztype},dataType:'jsonp'});}
function _queryBingos(actid,callback,needcgikey){if(!actid)return;if(actid instanceof Array){var key="querybingolist_"+actid.join(",");var param={activelist:actid.join(",")}}
else{var key="querybingo_"+actid;var param={active:actid}}
ajax.load({success:function(data,settings){if(data.errorCode==2){login.login();}
else{if(data.errorCode==0&&needcgikey){settings.setCache(data);}
if(!(actid instanceof Array)&&data.active!=actid){callback&&callback([],{"errorCode":"-26","errMsg":"ID",_errorBack_:1},settings);return false;}
JD.report.umpBiz({bizid:"320",operation:"1",result:"0",source:"0",message:location.protocol+"//"+location.host+location.pathname});callback&&callback(actid instanceof Array?data.result:data.bingos,data,settings);}},error:function(ret,settings){JD.report.umpBiz({bizid:"320",operation:"1",result:"1",source:"0",message:location.protocol+"//"+location.host+location.pathname+":"+ret});callback&&callback([],{"errorCode":"-25","errMsg":ret,_errorBack_:1},settings);},retryCount:1,timeout:4,url:"//wq.jd.com/active/"+(actid instanceof Array?"querybingolist":"querybingo"),data:param,cgiKey:needcgikey?key:"",dataType:'jsonp'});}
function _reportinteraction(active,awid,pwid,callback){ajax.load({success:function(data,settings){if(!(data.retcode==0||data.retcode==2)){JD.report.umpBiz({bizid:"571",operation:"1",result:"1",source:"0",message:data.retcode});}
else{JD.report.umpBiz({bizid:"571",operation:"1",result:"0",source:"0",message:data.retcode});}
callback&&callback(data,settings);},error:function(ret,settings){callback&&callback({"retcode":"-999"},settings);JD.report.umpBiz({bizid:"571",operation:"1",result:"1",source:"0",message:ret});},data:{active:active,awid:awid,pwid:pwid,behavior:"1"},dataType:'jsonp',url:"//wq.jd.com/activepersistent/interaction/reportinteraction"});}
function _reportAddress(opts){var dfd=$.Deferred();var options={active:"",msgcontent:"",reporttype:"",addressid:"",};$.extend(options,opts);delete options.reporttype;options.msgcontent=options.msgcontent.replace(/\|/g,'-');ajax.load({url:"//wq.jd.com/activep2/swaddress/reportswaddress",dataType:'jsonp',data:options,success:function(data,settings){if(data.iRet==2){login.login();}
else{JD.report.umpBiz({bizid:"320",operation:"9",result:"0",source:"0",message:location.protocol+"//"+location.host+location.pathname});dfd.resolve(data,settings);}},error:function(ret,settings){JD.report.umpBiz({bizid:"320",operation:"9",result:"1",source:"0",message:location.protocol+"//"+location.host+location.pathname+"|"+ret+"|"+options.biztype});dfd.resolve({"iRet":"-25","errMsg":ret,_errorBack_:1},settings);}});return dfd.promise();};function _queryAddress(opts){var dfd=$.Deferred();var options={active:"",level:"",biztype:"",};$.extend(options,opts);ajax.load({retryCount:1,timeout:4,url:"//wq.jd.com/activep2/swaddress/queryswaddress",data:options,dataType:'jsonp',success:function(data,settings){if(data.iRet==2){login.login();}
else{JD.report.umpBiz({bizid:"320",operation:"10",result:"0",source:"0",message:location.protocol+"//"+location.host+location.pathname});data['model']={name:'',phone:'',address:''};if(data&&data.sMsgContent){try{var _tmpEvl=data.sMsgContent.split('|');if(_tmpEvl.length>=3){data['model']={name:_tmpEvl[0],phone:_tmpEvl[1],address:_tmpEvl[2]};}
else{data.sMsgContent=data.sMsgContent.replace(/&amp;quot;/g,'"').replace(/&amp;#44;/g,',');data.sMsgContent=data.sMsgContent.replace(/&quot;/g,'"').replace(/&#44;/g,',').replace(/<BR\/>/g,'');data['model']=JSON.parse(data.sMsgContent);}}
catch(ex){console.error(ex);}}
var result=$.extend(data,options);dfd.resolve(result,settings);options.callback&&options.callback(result,settings);}},error:function(ret,settings){JD.report.umpBiz({bizid:"320",operation:"10",result:"1",source:"0",message:location.protocol+"//"+location.host+location.pathname+"|"+ret+"|"+options.biztype});var result={model:{name:'',phone:'',address:''},"iRet":"-25","errMsg":ret};dfd.resolve(result,settings);options.callback&&options.callback(result,settings);}});return dfd.promise();};function _showUserFormV2(dialog,active,level,opts){var options={reporttype:'',bizType:'',success:function(){},error:function(){}};$.extend(options,opts);if(!dialog){options.error({ret:1,msg:"dialog  is not exist"});return;}
if(active&&level){_queryBingos(active,function(data,oridata,settings){if(data.some(function(ceil){return ceil.level==level&&oridata.active==active;})){__handle();}
else{options.error({ret:3,msg:"no bingo"});return;}});}
else{__handle();}
function __handle(){dialog=typeof dialog=='string'?$('#'+dialog):dialog.length?dialog:$(dialog);var errInfo=dialog.find('[tag=errInfo]'),name=dialog.find('[tag=fName]'),phone=dialog.find('[tag=fPhone]'),address=dialog.find('[tag=fAddress]');dialog.find('[tag=cancel],[tag=close]').off().on("click",function(){dialog.hide();});errInfo.length&&errInfo.html('&nbsp;');name.val('');phone.val('');address.val('');_queryAddress({active:active,level:level,biztype:options.bizType}).then(function(addressInfo){if(addressInfo&&addressInfo.model){name.val(addressInfo.model.name||'');phone.val(addressInfo.model.phone||'');address.val(addressInfo.model.address||'');}
dialog.show();dialog.find('[tag=confirm]').off().on("click",function(){var nameVal=$.trim(name.val()),phoneVal=$.trim(phone.val()),addressVal=$.trim(address.val());var isUpdate=_isUpdate({oldVal:addressInfo.model,newVal:{name:nameVal,phone:phoneVal,address:addressVal}});if(isUpdate){if(!nameVal){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
name.focus();return false;}
else{if(!/^[\u4E00-\u9FA5A-Za-z]+$/.test(nameVal)){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
name.focus();return false;}}
if(!phoneVal){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
phone.focus();return false;}
else{if(phoneVal.indexOf('***')==-1){if(!/^((13[0-9]|15[012356789]|166|17[012345678]|18[0-9]|19[89]|14[56789])([0-9]{8})|((86)?(-)?(0[0-9]{2,3})?(-)?([0-9]{7,8})(-)?([0-9]{3,5})?))$/.test(phoneVal)){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
phone.focus();return false;}}}
if(!addressVal){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
address.focus();return false;}
else{if(!/^[\u4E00-\u9FA5A-Za-z0-9]+$/.test(addressVal)){if(errInfo.length){errInfo.html('');}
else{ui.info({msg:""});}
address.focus();return false;}}
errInfo.length&&errInfo.html('&nbsp;');var reportModel={active:active,reporttype:options.reporttype,msgcontent:JSON.stringify({name:nameVal,phone:phoneVal,address:addressVal}),};console.log('Report Address String--->',reportModel);if(lock){return;}
lock=true;_reportAddress(reportModel).then(function(report){lock=false;report.iRet==0?options.success():options.error({ret:4});dialog.hide();});}
else{dialog.hide();options.success();}});phone.on('focus',function(){var $this=$(this);if($this.val().indexOf('***')!=-1){$this.val('');}});});};function _isUpdate(opts){var options={oldVal:{},newVal:{}};$.extend(options,opts);var upFlag=false;if(Object.keys(options.oldVal).length<3||Object.keys(options.newVal).length<3){upFlag=true;}
else{$.each(options.oldVal,function(){$.each(options.newVal,function(newKey){if(!options.newVal[newKey]||(options.newVal[newKey]!=options.oldVal[newKey])){upFlag=true;}});});}
return upFlag;};};function _showAddressTost(opts){var _this=this;var options={outerBox:'body',template:'',active:'',level:'',readOnly:false,submitText:'',updateText:'',onReady:function(){},onClose:function(){},onSuccess:function(){},onError:function(error){},};$.extend(options,opts);var resultModel={ret:0,msg:''};$.each(options,function(key,item){if(item===''||item===null||item==undefined){resultModel={ret:999,msg:key+" is not exist"};return false;}});if(resultModel.ret!=0){options.onError(resultModel);return false;}
_this.valiModel=function(opts){var options={name:'',phone:'',address:'',};$.extend(options,opts);var MsgModel={name:{regEx:/^[\u4E00-\u9FA5A-Za-z]+$/,empty:"",error:""},phone:{regEx:/^((13[0-9]|15[012356789]|166|17[012345678]|18[0-9]|19[89]|14[56789])([0-9]{8})|((86)?(-)?(0[0-9]{2,3})?(-)?([0-9]{7,8})(-)?([0-9]{3,5})?))$/,empty:"",error:""},address:{regEx:/^[\u4E00-\u9FA5A-Za-z0-9]+$/,empty:"",error:""}};var result={valiFlag:true,valiMsg:'',model:options};$.each(options,function(key,value){if(!value){result.valiFlag=false;result.valiMsg=MsgModel[key].empty;return false;}});if(result.valiFlag){if(options.phone.indexOf('***')==-1){if(!MsgModel.phone.regEx.test(options.phone)){result.valiFlag=false;result.valiMsg=MsgModel.phone.error;}}
if(!MsgModel.name.regEx.test(options.name)){result.valiFlag=false;result.valiMsg=MsgModel.name.error;}
if(!MsgModel.address.regEx.test(options.address)){result.valiFlag=false;result.valiMsg=MsgModel.address.error;}}
return result;};_this.isUpdate=function(opts){var options={oldVal:{},newVal:{}};$.extend(options,opts);var upFlag=false;if(Object.keys(options.oldVal).length<3||Object.keys(options.newVal).length<3){upFlag=true;}
else{$.each(options.oldVal,function(){$.each(options.newVal,function(newKey){if(!options.newVal[newKey]||(options.newVal[newKey]!=options.oldVal[newKey])){upFlag=true;}});});}
return upFlag;};_queryBingos(options.active,function(bingos,oridata){var haveBingo=bingos.some(function(bingo){if(bingo.level==options.level&&oridata.active==options.active){return true;}
return false;});if(haveBingo){$(options.outerBox).append(options.template);options.onReady();var dialogBox=$('[box-type="dialog"]'),closeBox=dialogBox.find('[tag="close"]'),confirmBox=dialogBox.find('[tag="confirm"]'),formEvl=dialogBox.find('input,textarea'),nameVal=dialogBox.find('[tag="name"]'),phoneVal=dialogBox.find('[tag="phone"]'),addressVal=dialogBox.find('[tag="address"]'),errorVal=dialogBox.find('[tag="errorMsg"]');confirmBox.html(options.submitText);_queryAddress({active:options.active,level:options.level}).then(function(address){nameVal.val(address.model.name);phoneVal.val(address.model.phone);addressVal.val(address.model.address);if(address.model.name||address.model.phone||address.model.address){confirmBox.html(options.updateText);}
if(options.readOnly){nameVal.attr('readonly',true);phoneVal.attr('readonly',true);addressVal.attr('readonly',true);}
closeBox.on('click',function(){dialogBox.remove();options.onClose();});confirmBox.on('click',function(e){e.preventDefault();if(!options.readOnly){var newModel={name:nameVal.val(),phone:phoneVal.val(),address:addressVal.val()};var isUpdate=_this.isUpdate({oldVal:address.model,newVal:newModel});if(isUpdate){var valiModel=_this.valiModel(newModel);if(valiModel.valiFlag){var reportModel={active:options.active,reporttype:options.reporttype,msgcontent:JSON.stringify(valiModel.model),};console.log('Report Address String--->',reportModel);if(lock){return;}
lock=true;_reportAddress(reportModel).then(function(report){lock=false;dialogBox.remove();report.iRet==0?options.onSuccess({ret:0,msg:''}):options.onError({ret:report.iRet,msg:'TWS Error Code '+report.iRet})});}
else{errorVal.html(valiModel.valiMsg).show();options.onError({ret:997,msg:valiModel.valiMsg});}}
else{dialogBox.remove();options.onSuccess({ret:0,msg:''})}}
else{dialogBox.remove();options.onSuccess({ret:0,msg:''})}});formEvl.on('focus',function(){errorVal.html('').hide();});phoneVal.on('focus',function(){var $this=$(this);if($this.val().indexOf('***')!=-1){$this.val('');}});});}
else{options.onError({ret:998,msg:"no bingo"});}});};});
;define("m.item.kepler",function(require,exports,module){var _cacheThisModule_,$=require('zepto'),itemUtil=require('jd.item.util'),popUp=itemUtil.popUp,mWfdata=require('wfdata'),ppmsData={superReturnDes:null,keplerTip:null};function getsuperReturnRatio(superrebate){var ratio=(superrebate&&superrebate.ratio)||'';return ratio.replace('%','')-0;}
function superReturn(ratio){itemUtil.reporter.pingClick('MProductdetail_SuperBackPV','','','','');var $superReturnNotice=$('#superReturnNotice');$superReturnNotice.find('.rebate').html(ratio+'%');$superReturnNotice.show();getSuperReturnInfo(function(data){if(!data||!data.length)return;var htmlArr=$.map(data,function(item){if(item.title&&item.content){return'<li><div class="title">'+item.title+'</div><div class="content">'+item.content+'</div></li>';}});if(!htmlArr.length)return;popUp.setPopupBody('superReturnInfo','<ul>'+htmlArr.join('')+'</ul>');$superReturnNotice.off('click').on('click',function(){popUp.createPopDom({isCoupon:false,isSku:true,className:'detail_kepler_return_main',title:'',body:popUp.popupBody.superReturnInfo,btnTxt:'',closeClass:'close_sp'});});});}
function getSuperReturnInfo(callback){if(!window.showPageData33966){window.showPageData33966=function(json){ppmsData.superReturnDes=json;callback(json&&json.data);};}
if(ppmsData.superReturnDes){window.showPageData33966(ppmsData.superReturnDes);}else{mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v33966'}});}}
function setKeplerTip(){if(!window.showPageData33994){window.showPageData33994=function(json){if(!json||!json.data)return;ppmsData.keplerTip=json;var channel=window._keplerConfig&&window._keplerConfig.channel,source=window._keplerConfig&&window._keplerConfig.source;$.each(json.data,function(index,item){if(item.channel==channel&&item.source==source){if(item.tip){var $keplerNotice=$('#keplerNotice');$keplerNotice.find('.content').html(item.tip);$keplerNotice.show();$('#keplerNotice .close').on('click',function(){$keplerNotice.hide();});}}});};}
if(ppmsData.keplerTip){window.showPageData33994(ppmsData.keplerTip);}else{mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v33994'}});}}
exports.getsuperReturnRatio=getsuperReturnRatio;exports.superReturn=superReturn;exports.setKeplerTip=setKeplerTip;});
;define("m.item.banner",function(require,exports,module){var _cacheThisModule_,$=require('zepto'),mWfdata=require('wfdata');function isShowDrainage(blackList){var show=true;if(!blackList||!blackList.length)return show;blackList.forEach(function(v,i){var uaTag=(v.uaTag||'').toLowerCase(),os=v.os,uaStr=navigator.userAgent.toLowerCase();if(uaTag&&os){if(uaStr.indexOf(uaTag)>-1&&((os.indexOf('1')>-1&&!!$.os.android)||(os.indexOf('2')>-1&&(!!$.os.iphone||!!$.os.ios)))){show=false;}}});return show;}
function getGuideBannerConfig(callback){if(!window.showPageData33990){window.showPageData33990=function(json){callback(json&&json.data);};}
mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v33990'}});}
function getBannerConfig(callback){if(!window.showPageData33986){window.showPageData33986=function(json){callback(json&&json.data);};}
mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v33986'}});}
exports.init=function(obj){getGuideBannerConfig(function(data){var showDrainage=isShowDrainage(data&&data[0]&&data[0].blackList);var $drainageBanner=$('#drainageBanner');var $downloadFloor=$('#downloadFloor');var bannerImg=data&&data[0]&&data[0].bannerImg;if(showDrainage&&$downloadFloor.length&&bannerImg){$downloadFloor.find('img').attr('src',JD.img.getImgUrl(bannerImg));$downloadFloor.css({display:'block',overflow:'hidden',maxHeight:obj.pageWidth*145/750});$downloadFloor.show();$drainageBanner.show();}else{var $operationBanner=$('#operationBanner');if(!$operationBanner.length)return;obj.queryIsNewUser(function(isNewUser){getBannerConfig(function(data){var bannerData={};if(isNewUser==1){data&&data.forEach(function(item,index){if(item.isNew=='false'){bannerData=item;}});}else{data&&data.forEach(function(item,index){if(item.isNew=='true'){bannerData=item;}});}
$operationBanner.attr('link',bannerData.bannerUrl);$operationBanner.find('img').attr('src',JD.img.getImgUrl(bannerData.bannerImg));$operationBanner.css({display:'block',overflow:'hidden',maxHeight:obj.pageWidth*145/750});$operationBanner.show();$drainageBanner.show();$operationBanner.on('click',function(e){var $em=$(this);setTimeout(function(){location.href=$em.attr('link');},200);});});});}});};});
;define('jd.item.commonBusiness',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),address=require('wq.address'),ls=require('loadJs'),itemUtil=require('jd.item.util'),$jsonToTpl=itemUtil.$jsonToTpl,popUp=itemUtil.popUp,getMyLocation=itemUtil.getMyLocation,reporter=itemUtil.reporter;function handleAdultTip(category){var $adultTip=$('#adultTip');$adultTip.hide();if(!category||category.length<3)return;if(!window._adultCategoryInfo)return;var isAdultItem=false;var tip='';window._adultCategoryInfo.forEach(function(ele){if(ele.tip&&(ele.cid1s||ele.cid2s||ele.cid3s)&&((~ele.cid1s.indexOf('|'+category[0]+'|'))||(~ele.cid2s.indexOf('|'+category[1]+'|'))||(~ele.cid3s.indexOf('|'+category[2]+'|')))){isAdultItem=true;tip=ele.tip;}});if(isAdultItem){$adultTip.html('<i class="info_icon"></i>'+tip).show();}}
var categoryNameCache={cbList:[]};function getCateNameById(opt){if(!opt||!opt.cb||!opt.jdCategory){return opt.cb&&opt.cb();}
categoryNameCache.cbList.push(opt.cb);if(categoryNameCache.hold){return;}
var category3=opt.jdCategory[2];if(!category3||category3=='0')return opt.cb&&opt.cb();window.catcnnameCb=function(json){var result;if(json&&json.result&&json.result.length){result=json.result;}
categoryNameCache.cbList.forEach(function(CB){CB(result);});categoryNameCache[category3]=json;categoryNameCache.cbList=[];categoryNameCache.hold=false;};if(categoryNameCache[category3]){window.catcnnameCb(categoryNameCache[category3]);}else{categoryNameCache.hold=true;ls.loadScript({'url':'//wq.jd.com/commodity/extension/getcatcnname?callback=catcnnameCb&source=item&cat3rd='+category3,onError:function(){window.catcnnameCb(null);}});}}
function goodRecommend(opt){if(!opt||!opt.isWx||!opt.skuId)return;if(JD.wxapp&&JD.wxapp.wxappType==3)return;if(JD.device&&JD.device.isAndroid){var regArr=/micromessenger(\/([\d\.]+))*/.exec(navigator.userAgent.toLowerCase())
var wxVer=regArr&&regArr[2]&&regArr[2].split('.')||[];wxVer=''+wxVer[0]+wxVer[1]+wxVer[2];if(wxVer<704)return;}
var $detailAnchor=$('#detailAnchor');$detailAnchor.addClass('show_share');var $detailAnchorLine=$('#detailAnchorLine'),$activeItem=$detailAnchor.find('.detail_anchor_item.active span'),itemLeft=$activeItem.position()&&$activeItem.position().left,itemWidth=$activeItem.width();$detailAnchorLine.css({'-webkit-transform':'translate3d('+itemLeft+'px,0,0)','transform':'translate3d('+itemLeft+'px,0,0)','width':itemWidth+'px'});var viewScroll=0;var handleOverflowHide=function(flag){if(flag){viewScroll=$(window).scrollTop();$('body').css('top','-'+viewScroll+'px').addClass('overflowHide');}else{$('body').removeClass('overflowHide').css('top','0');window.scrollTo(0,viewScroll);}};var $shareTip=$('#shareTip');var $anchorShareBtn=$('#anchorShareBtn');$anchorShareBtn.off().on('click',function(){$shareTip.show().addClass('show');reporter.reports({ptag:'7001.14.15'});});$shareTip.off().on('click',function(){$shareTip.removeClass('show').hide();handleOverflowHide(false);});if(opt.focusImages){opt.focusImages=opt.focusImages.map(function(jfsimg){return JD.img.getScaleImgDpg('//m.360buyimg.com/mobilecms/'+jfsimg,800,800).replace(/^(http:)*\/\//,'https://');});}
JD.wxapi&&JD.wxapi.ready(function(jsApiSign){if(window.wx&&window.wx.apiCheckResult&&window.wx.apiCheckResult.openBusinessView){if(!window.getWxJsApiSignCb){window.getWxJsApiSignCb=function(json){if(!json||!json.appId||!json.timestamp||!json.nonceStr||!json.signature)return;var $sharePopup=$('#sharePopup');var $sharePopupMain=$('#sharePopup .main');var $goodRecommend=$('#goodRecommend');var $shareToFirend=$('#shareToFirend');$anchorShareBtn.off().on('click',function(){$sharePopup.show().addClass('show');handleOverflowHide(true);reporter.reports({ptag:opt.isPingouScene?'7001.12.37':'7001.14.13'});});$sharePopup.off().on('click',function(){$sharePopup.removeClass('show').hide();handleOverflowHide(false);});$sharePopupMain.off().on('click',function(event){event.stopPropagation&&event.stopPropagation();});$sharePopupMain.on('click','i.close,i.close_sp',function(){$sharePopup.removeClass('show').hide();handleOverflowHide(false);reporter.reports({ptag:opt.isPingouScene?'7001.12.39':'7001.14.14'});});$shareToFirend.off().on('click',function(){$shareTip.show().addClass('show');$sharePopup.removeClass('show').hide();reporter.reports({ptag:opt.isPingouScene?'7001.12.40':'7001.14.5'});});$goodRecommend.show().off().on('click',function(){reporter.reports({ptag:opt.isPingouScene?'7001.12.36':'7001.14.11'});getCateNameById({jdCategory:opt.jdCategory,cb:function(categoryName){var jsCheckObject={appid:json.appId,timestamp:parseInt(json.timestamp),noncestr:json.nonceStr,signature:json.signature,url:location.href.split("#")[0]};var productObject={item_code:opt.skuId+'',title:opt.title,desc:opt.title,category_list:categoryName||opt.jdCategory,image_list:opt.focusImages,src_wxapp_id:'wx91d27dbf599dff74',src_wxapp_path:'pages/item/detail/detail?sku='+opt.skuId+'&ptag=138612.1.1',brand_info:{name:''}};if(opt.jdPrice>0&&opt.originPrice>0){productObject.sku_list=[{sku_id:opt.skuId,price:parseInt(opt.jdPrice*100),original_price:parseInt(opt.originPrice*100),status:1}];}
var queryString='jsCheck='+encodeURIComponent(JSON.stringify(jsCheckObject))+'&product='+encodeURIComponent(JSON.stringify(productObject));wx.openBusinessView({businessType:'friendGoodsRecommend',queryString:queryString,success:function(){reporter.reports({ptag:opt.isPingouScene?'7001.12.41':'7001.14.12'});},fail:function(err){}})
$sharePopup.removeClass('show').hide();handleOverflowHide(false);}});});};}
if(jsApiSign&&jsApiSign.appId){window.getWxJsApiSignCb(jsApiSign);}else{ls.loadScript('//wq.jd.com/bases/jssdk/GetWxJsApiSign?callback=getWxJsApiSignCb&url='+encodeURIComponent(location.href.split("#")[0]));}}})}
function sendToHome(daojia,upc){$('#daojiaRecommendArea').hide().next('.detail_gap').hide();if(daojia!='1'||!upc)return;var setRecommenddaojia=function(lat,lng,cityId){var tpl='<div class="header">'+'<span class="title"></span>'+'<span class="des">{#strRecommendWords#}</span>'+'</div>'+'<div class="content">'+'<div class="good_pic">'+'<img src="{#strImgUrl#}" />'+'<div class="price">{#strPrice#}</div>'+'</div>'+'<div class="good_info">'+'<div class="info_title">'+'<span class="icon_daojia"></span><span class="name">{#strStoreName#}</span><span class="dis">{#distance#}</span>'+'</div>'+'<div class="info-delivery">{#strDeliverTimeDesc#}{#infoTipTpl#}</div>'+'<div class="coupon_list">'+'{#couponTpl#}'+'</div>'+'</div>'+'<div class="entry_btn"></div>'+'</div>';if(!window.recommenddaojiaCb){window.recommenddaojiaCb=function(res){if(!res||res.errcode!=0||!res.result)return;var data=res.result;if(!data||!data.strImgUrl||!data.strPrice||!data.strStoreName||!data.strDistance||!data.strDeliverTimeDesc||!data.strPath)return;var disMatch=data.strDistance.match(/\d+\.*\d*/);if(!disMatch||!disMatch[0])return;data.distance=disMatch[0]+(data.strDistance.indexOf('')>0?'km':'m');if(data.oDeliverTip&&data.oDeliverTip.strDetail)data.infoTipTpl='<span class="icon_info"></span>';data.couponTpl='';if(data.listTags&&data.listTags.length>0){for(var i=0;i<data.listTags.length;i++){if(data.listTags[i])data.couponTpl+='<span class="coupon">'+data.listTags[i]+'</span>';}}
$('#daojiaRecommendArea').html($jsonToTpl(data,tpl)).show().next('.detail_gap').show();reporter.reportExposure({ptag:'7001.1.347'});$('#daojiaRecommendArea').off();if(data.oDeliverTip&&data.oDeliverTip.strDetail){$('#daojiaRecommendArea').on('click','.icon_info',function(){popUp.createPopup({flag:11,title:data.oDeliverTip&&data.oDeliverTip.strTitle,msg:data.oDeliverTip&&data.oDeliverTip.strDetail,onConfirm:function(){},onCancel:function(){}});});}
$('#daojiaRecommendArea').on('click','.entry_btn',function(){reporter.reports({ptag:'7001.1.346'});setTimeout(function(){location.href=data.strPath;},200);});};}
ls.loadScript('//wq.jd.com/commodity/extension/recommenddaojiasku?callback=recommenddaojiaCb&longitude='+lng+'&latitude='+lat+'&upc='+upc+'&cityId='+cityId);};var addr=address.getAddrInfo()||{},lat=addr.latitude,lng=addr.longitude,cityId=addr.id;if(!lat||!lng){getMyLocation(function(data){lat=data.latitude;lng=data.longitude;if(lat&&lng)setRecommenddaojia(lat,lng,'');});}else{setRecommenddaojia(lat,lng,cityId);}}
function handleJx(isJx){var changeClassFromId={'#jxRowArea':['','show'],'#addCart2':['btn_orange','btn_yellow'],'#buyBtn2':['btn_buy','btn_black'],'#addCart1':['yellow','golden'],'#buyBtn1':['red','black'],'#popupConfirm':['','golden']}
for(var id in changeClassFromId){var classArr=changeClassFromId[id];var normalClass=classArr[0];var jxClass=classArr[1];var $dom=$(id);if(isJx){normalClass&&$dom.removeClass(normalClass);jxClass&&$dom.addClass(jxClass);}else{normalClass&&$dom.addClass(normalClass);jxClass&&$dom.removeClass(jxClass);}}}
exports.handleAdultTip=handleAdultTip;exports.goodRecommend=goodRecommend;exports.sendToHome=sendToHome;exports.handleJx=handleJx;});
;define('wq.item.loopScroll',function(require,exports,module){var $=require('zepto');function Slide(elem){this.elem=elem;this.oBox=document.querySelector(elem);this.aLi=document.querySelectorAll(elem+' [data-ul-child=child]');this.oUl=document.querySelector(elem+' [data-slide-ul=firstUl]');this.now=0;this.on0ff=false;}
Slide.prototype={initParam:function(options){var _this=this;var aLi=this.aLi;options=options||{};this.defaults={imgSrc:'imgsrc',startIndex:0,loop:false,smallBtn:false,number:false,laseMoveFn:false,location:false,preDef:'lnr',autoPlay:false,autoHeight:false,preFn:null,lastImgSlider:false,playTime:6000,mpingEvent:"",wareId:"",callback:null,verticalCenter:false,fullScreen:true,total:0,isBanOneImg:true,whRatio:1,numberWrapId:null};Slide.extend(this.defaults,options);_this.imgSrc=_this.defaults.imgSrc;this.now=this.defaults.startIndex;if(aLi.length>0){this.initBtn();this.liInit();this.bind();}
if(this.defaults.autoPlay){this.pause();this.play();}},initBtn:function(){this.aLi=document.querySelectorAll(this.elem+' [data-ul-child=child]');var aLi=this.aLi;if(this.defaults.callback){this.defaults.callback(1);}
if(this.defaults.smallBtn){this.oSmallBtn=document.querySelector(this.elem+' [data-small-btn="smallbtn"]');this.oSmallBtn.innerHTML=this.addSmallBtn();this.btns=document.querySelectorAll(this.elem+' [data-ol-btn="btn"]');for(var i=0;i<this.btns.length;i++){this.btns[i].className='';}
this.btns[Slide.getNow(this.now,aLi.length)].className='active';}
if(this.defaults.number){this.slideNub=document.querySelector(this.defaults.numberWrapId+' [data-slide-num="slideNub"]');this.slideSum=document.querySelector(this.defaults.numberWrapId+' [data-slide-num="slideSum"]');if(this.aLi.length==1){this.slideNub.innerHTML=1;}else{this.slideNub.innerHTML=(this.now+1)%(this.aLi.length);}
this.slideSum.innerHTML=this.aLi.length;}
this.defaults.total=this.aLi.length;if(this.aLi.length==2||this.aLi.length==3){if(this.defaults.loop){this.oUl.innerHTML+=this.oUl.innerHTML;this.need=true;}
this.aLi=document.querySelectorAll(this.elem+' [data-ul-child=child]');}},bind:function(){var oBox=this.oBox,device=Slide._device();if(!device.hasTouch){oBox.style.cursor='pointer';oBox.ondragstart=function(ev){if(ev){return false;}
return true;};}
var supportsOrientationChange="onorientationchange"in window;var resize=supportsOrientationChange?"orientationchange":"resize";window.addEventListener(resize,this);if(this.aLi.length<2){if(this.defaults.smallBtn){this.oSmallBtn.style.display='none';}
if(this.defaults.isBanOneImg){return}}
oBox.addEventListener(device.startEvt,this);window.addEventListener('touchcancel',this);if(navigator.userAgent.indexOf('baidubrowser')!=-1){window.addEventListener('focusin',this);window.addEventListener('focusout',this);}else{window.addEventListener('blur',this);window.addEventListener('focus',this);}},removeListener:function(){window.removeEventListener('focus',this);window.removeEventListener('blur',this);window.removeEventListener('focusout',this);window.removeEventListener('focusin',this);window.removeEventListener('touchcancel',this);var supportsOrientationChange="onorientationchange"in window;var resize=supportsOrientationChange?"orientationchange":"resize";window.removeEventListener(resize,this);var oBox=this.oBox,device=Slide._device();oBox.removeEventListener(device.startEvt,this);oBox.removeEventListener(device.endEvt,this);oBox.removeEventListener(device.moveEvt,this);},liInit:function(){var aLi=this.aLi,length=aLi.length,boxW=320,now=this.now,clientW=document.documentElement.clientWidth,whRatio=this.defaults.whRatio,that=this;if(this.defaults.preFn){this.defaults.preFn()}
for(var i=0;i<length;i++){Slide.setStyle(aLi[i],{WebkitTransition:'all 0ms '+'ease',transition:'all 0ms '+'ease',height:'auto'})}
if(this.defaults.fullScreen){boxW=clientW;}else{boxW=this.oBox.offsetWidth;}
if(boxW>=640){boxW=640;}
if(this.defaults.autoHeight){aLi[0].style.width=boxW+'px';if(aLi[0]){var pic=aLi[0].getElementsByTagName('img')[0];if(pic){var img=new Image();img.onload=function(){whRatio=aLi[0].offsetWidth/aLi[0].offsetHeight;that.setWhFn(boxW,whRatio);}
img.src=pic.src;}}}else{this.setWhFn(boxW,whRatio);}
if(this.defaults.loop){for(var i=0;i<length;i++){Slide.setStyle(aLi[i],{position:'absolute',left:0,top:0});if(i==Slide.getNow(now,length)){that.loadImg(aLi[i]);Slide.setStyle(aLi[i],{WebkitTransform:'translate3d('+0+'px, 0px, 0px)',transform:'translate3d('+0+'px, 0px, 0px)',zIndex:10});}else if(i==Slide.getPre(now,length)){Slide.setStyle(aLi[i],{WebkitTransform:'translate3d('+-boxW+'px, 0px, 0px)',transform:'translate3d('+-boxW+'px, 0px, 0px)',zIndex:10});}else if(i==Slide.getNext(now,length)){Slide.setStyle(aLi[i],{WebkitTransform:'translate3d('+boxW+'px, 0px, 0px)',transform:'translate3d('+boxW+'px, 0px, 0px)',zIndex:10});}else if(i==Slide.getNextNew(now,length)){Slide.setStyle(aLi[i],{WebkitTransform:'translate3d('+boxW*2+'px, 0px, 0px)',transform:'translate3d('+boxW*2+'px, 0px, 0px)',zIndex:10});}else{Slide.setStyle(aLi[i],{WebkitTransform:'translate3d('+-boxW+'px, 0px, 0px)',transform:'translate3d('+-boxW+'px, 0px, 0px)',zIndex:9});}}}else{for(var i=0;i<length;i++){Slide.setStyle(aLi[i],{WebkitTransform:'translate3d('+now*-boxW+'px, 0px, 0px)',transform:'translate3d('+now*-boxW+'px, 0px, 0px)'});}}},setWhFn:function(w,r){var aLi=this.aLi,length=aLi.length,oUl=this.oUl,oBox=this.oBox;oBox.style.width=w+'px';oBox.style.height=(w/r)+'px';oUl.style.width=w*length+'px';oUl.style.height=(w/r)+'px';for(var i=0;i<length;i++){aLi[i].style.width=w+'px';aLi[i].style.height=(w/r)+'px';}},handleEvent:function(ev){var device=Slide._device(),oBox=this.oBox;switch(ev.type){case device.startEvt:if(this.defaults.autoPlay)this.pause();this.startHandler(ev);break;case device.moveEvt:if(this.defaults.autoPlay)this.pause();this.moveHandler(ev);break;case device.endEvt:if(this.defaults.autoPlay){this.pause();this.play();}
this.endHandler(ev);break;case'touchcancel':if(this.defaults.autoPlay){this.pause();this.play();}
this.endHandler(ev);break;case'orientationchange':this.orientationchangeHandler();break;case'resize':this.orientationchangeHandler();break;case'focus':if(this.defaults.autoPlay){this.pause();this.play();}
break;case'blur':if(this.defaults.autoPlay){this.pause();}
break;case'focusin':if(this.defaults.autoPlay){this.pause();this.play();}
break;case'focusout':if(this.defaults.autoPlay){this.pause();}
break;}},startHandler:function(ev){this.on0ff=true;var device=Slide._device(),hasTouch=device.hasTouch,oBox=this.oBox,now=this.now,aLi=this.aLi
oBox.addEventListener(device.moveEvt,this);oBox.addEventListener(device.endEvt,this);this.downTime=Date.now();this.downX=hasTouch?ev.targetTouches[0].pageX:ev.clientX-oBox.offsetLeft;this.downY=hasTouch?ev.targetTouches[0].pageY:ev.clientY-oBox.offsetTop;this.startT=Slide.getTranX(aLi[Slide.getNow(now,aLi.length)]);this.startNowT=Slide.getTranX(aLi[Slide.getNow(now,aLi.length)]);this.startPreT=Slide.getTranX(aLi[Slide.getPre(now,aLi.length)]);this.startNextT=Slide.getTranX(aLi[Slide.getNext(now,aLi.length)]);this.startNextN=Slide.getTranX(aLi[Slide.getNextNew(now,aLi.length)]);Slide.stopPropagation(ev);},moveHandler:function(ev){var oBox=this.oBox,device=Slide._device();if(this.on0ff){var hasTouch=device.hasTouch;var nowX=hasTouch?ev.targetTouches[0].pageX:ev.clientX-oBox.offsetLeft;var nowY=hasTouch?ev.targetTouches[0].pageY:ev.clientY-oBox.offsetTop;var aLi=this.aLi,length=aLi.length,now=this.now,w=aLi[0].offsetWidth;if(this.defaults.preDef=='all'){Slide.stopDefault(ev);}
for(var i=0;i<length;i++){Slide.setStyle(aLi[i],{WebkitTransition:'all 0ms '+'ease',transition:'all 0ms '+'ease'})}
if(Math.abs(nowX-this.downX)<Math.abs(nowY-this.downY)){if(this.defaults.preDef=='tnd'&&this.defaults.preDef!='all'){Slide.stopDefault(ev);}}else{if(Math.abs(nowX-this.downX)>10){if(this.defaults.preDef=='lnr'&&this.defaults.preDef!='all'){Slide.stopDefault(ev);}
if(this.defaults.loop){nowT=(this.startNowT+nowX-this.downX).toFixed(4);var preT=(this.startPreT+nowX-this.downX).toFixed(4);var nextT=(this.startNextT+nowX-this.downX).toFixed(4);var nextN=(this.startNextN+nowX-this.downX).toFixed(4);Slide.move(aLi[Slide.getNow(now,length)],nowT,10,this.defaults.fullScreen);Slide.move(aLi[Slide.getPre(now,length)],preT,10,this.defaults.fullScreen);Slide.move(aLi[Slide.getNext(now,length)],nextT,10,this.defaults.fullScreen);Slide.move(aLi[Slide.getNextNew(now,length)],nextN,10,this.defaults.fullScreen);}else{var nowT=Slide.getTranX(aLi[now]);if(nowT>0){var tansX=((this.startT+nowX-this.downX)/3).toFixed(4);for(var i=0;i<length;i++){Slide.move(aLi[i],tansX,10,this.defaults.fullScreen);}}else if(Math.abs(nowT)>=Math.abs((length-1)*w)){var tansX=(this.startT+(nowX-this.downX)/3).toFixed(4);for(var i=0;i<length;i++){Slide.move(aLi[i],tansX,10,this.defaults.fullScreen);}
if(this.defaults.laseMoveFn&&typeof this.defaults.laseMoveFn=='function'){var x=(tansX-this.startT).toFixed(4);this.defaults.laseMoveFn(x);}}else{var tansX=(this.startT+nowX-this.downX).toFixed(4);for(var i=0;i<length;i++){Slide.move(aLi[i],tansX,10,this.defaults.fullScreen);}}}}}}else{oBox.removeEventListener(device.moveEvt,this);oBox.removeEventListener(device.endEvt,this);}
Slide.stopPropagation(ev);},endHandler:function(ev){ev.stopPropagation();this.on0ff=false;var endTime=Date.now(),device=Slide._device(),hasTouch=device.hasTouch,oBox=this.oBox,endX=hasTouch?ev.changedTouches[0].pageX:ev.clientX-oBox.offsetLeft,endY=hasTouch?ev.changedTouches[0].pageY:ev.clientY-oBox.offsetTop,aLi=this.aLi,w=aLi[0].offsetWidth,endT=Slide.getTranX(aLi[Slide.getNow(this.now,aLi.length)]);if(endX-this.downX<30&&endX-this.downX>=0&&Math.abs(endY-this.downY)<30){this.tab(endT,'+=');return'click';}else if(endX-this.downX>-30&&endX-this.downX<=0&&Math.abs(endY-this.downY)<30){this.tab(endT,'-=');return'click';}else{if(Math.abs(endY-this.downY)-Math.abs(endX-this.downX)>30&&endX-this.downX<0)
{this.tab(endT,'-=');return;}
if(Math.abs(endY-this.downY)-Math.abs(endX-this.downX)>30&&endX-this.downX>0)
{this.tab(endT,'+=');return;}
if(endX<this.downX){if(this.downX-endX>w/3||endTime-this.downTime<200){this.now++;this.tab(endT,'++');return'left';}else{this.tab(endT,'+=');return'stay';}}else{if(endX-this.downX>w/3||endTime-this.downTime<200){this.now--;this.tab(endT,'--');return'right';}else{this.tab(endT,'-=');return'stay';}}}
Slide.stopPropagation(ev);oBox.removeEventListener(device.moveEvt,this);oBox.removeEventListener(device.endEvt,this);},tab:function(endT,sign,timer){var aLi=this.aLi,length=aLi.length,w=aLi[0].offsetWidth,that=this,now=this.now;if(this.defaults.callback&&(sign=='++'||sign=='--')){if(!this.loop){if(now==this.defaults.total){this.defaults.callback(now);}else if(now<0){this.defaults.callback(1);}else{this.defaults.callback((Slide.getNow(now,length)+1)%this.defaults.total==0?this.defaults.total:(Slide.getNow(now,length)+1)%this.defaults.total);}}else{this.defaults.callback((Slide.getNow(now,length)+1)%this.defaults.total==0?this.defaults.total:(Slide.getNow(now,length)+1)%this.defaults.total);}}
that.loadImg(aLi[Slide.getNow(that.now,length)]);that.loadImg(aLi[Slide.getNow(that.now+1,length)]);if(this.defaults.loop){if(now<0){now=length-1;this.now=length-1;}
for(var i=0;i<length;i++){if(i==Slide.getPre(now,length)){var runing;switch(sign){case'++':runing=300;break;case'--':runing=0;break;case'+=':runing=0;break;case'-=':runing=300;break;default:break;}
Slide.setStyle(aLi[Slide.getPre(now,length)],{WebkitTransform:'translate3d('+-w+'px, 0px, 0px)',transform:'translate3d('+-w+'px, 0px, 0px)',zIndex:10,WebkitTransition:'all '+runing+'ms '+'ease',transition:'all '+runing+'ms '+'ease'});}else if(i==Slide.getNow(now,length)){Slide.setStyle(aLi[Slide.getNow(now,length)],{WebkitTransform:'translate3d('+0+'px, 0px, 0px)',transform:'translate3d('+0+'px, 0px, 0px)',zIndex:10,WebkitTransition:'all '+300+'ms '+'ease',transition:'all '+300+'ms '+'ease'});}else if(i==Slide.getNext(now,length)){var runing=300;switch(sign){case'++':runing=0;break;case'--':runing=300;break;case'+=':runing=300;break;case'-=':runing=0;break;default:break;}
Slide.setStyle(aLi[Slide.getNext(now,length)],{WebkitTransform:'translate3d('+w+'px, 0px, 0px)',transform:'translate3d('+w+'px, 0px, 0px)',zIndex:10,WebkitTransition:'all '+runing+'ms '+'ease',transition:'all '+runing+'ms '+'ease'})}else if(i==Slide.getNextNew(now,length)){var runing;switch(sign){case'++':runing=0;break;case'--':runing=300;break;case'+=':runing=300;break;case'-=':runing=0;break;default:break;}
Slide.setStyle(aLi[Slide.getNextNew(now,length)],{WebkitTransform:'translate3d('+w*2+'px, 0px, 0px)',transform:'translate3d('+w*2+'px, 0px, 0px)',zIndex:10,WebkitTransition:'all '+runing+'ms '+'ease',transition:'all '+runing+'ms '+'ease'})}else{Slide.setStyle(aLi[i],{WebkitTransform:'translate3d('+w*2+'px, 0px, 0px)',transform:'translate3d('+w*2+'px, 0px, 0px)',zIndex:9,WebkitTransition:'all '+0+'ms '+'ease',transition:'all '+0+'ms '+'ease'})}}}else{for(var i=0;i<length;i++){Slide.setStyle(aLi[i],{WebkitTransition:'all '+300+'ms '+'ease',transition:'all '+300+'ms '+'ease'})}
if(now<=0){now=0;this.now=0;}
if(now>length-1){if(timer){now=0;this.now=0;}else{now=length-1;this.now=length-1;}}
for(var j=0;j<length;j++){Slide.setStyle(aLi[j],{WebkitTransform:'translate3d('+(-now*w)+'px, 0px, 0px)',transform:'translate3d('+(-now*w)+'px, 0px, 0px)'})}}
if(this.defaults.smallBtn){for(var i=0;i<this.btns.length;i++){this.btns[i].className='';};if(this.need){this.btns[Slide.getNow(now,length/2)].className='active';}else{this.btns[Slide.getNow(now,length)].className='active';}}
if(this.defaults.number){this.slideNub.innerHTML=((Slide.getNow(now,length)+1)%this.defaults.total==0?this.defaults.total:(Slide.getNow(now,length)+1)%this.defaults.total);}
aLi[Slide.getNow(now,length)].addEventListener("webkitTransitionEnd",end,false);aLi[Slide.getNow(now,length)].addEventListener("transitionend",end,false);function end(){if(that.defaults.location){if(endT<-(length-1)*w-w/6){if(that.defaults.lastImgSlider&&typeof that.defaults.lastImgSlider=='function'){that.defaults.laseMoveFn(0);that.defaults.lastImgSlider();}}}
aLi[Slide.getNow(that.now,length)].removeEventListener("webkitTransitionEnd",end,false);aLi[Slide.getNow(that.now,length)].removeEventListener("transitionend",end,false);}},play:function(){var that=this;that.timer=setInterval(function(){that.now++;that.tab(null,'++',true);},this.defaults.playTime)},pause:function(){var that=this;clearInterval(that.timer);},orientationchangeHandler:function(){var that=this;setTimeout(function(){that.liInit();},300);},addSmallBtn:function(){var smallBtnHtml='',aLi=this.aLi;for(var i=0;i<aLi.length;i++){if(i==this.defaults.startIndex){smallBtnHtml+='<span class="active" data-ol-btn="btn"></span>';}else{smallBtnHtml+='<span data-ol-btn="btn"></span>';}}
return smallBtnHtml;},checkIphone:function(){var ua=window.navigator.userAgent.toLowerCase();if(/iphone|ipd|ipod/.test(ua)){return true;}else{return false;}},changSrc:function(img){var _this=this;var src=img.attr(''+_this.imgSrc+'');var imgN=new Image();var newSrc=src;img.css('opacity',0);imgN.src=newSrc;imgN.onload=function(){img.attr('src',newSrc).removeAttr(''+_this.imgSrc+'').css('opacity',1);};imgN.onerror=function(){img.attr('src',src).removeAttr(''+_this.imgSrc+'').css('opacity',1);}},loadImg:function(obj){var _this=this;var showImg=$(obj).find('img');var imgSrc=$(obj).find('img').attr(''+_this.imgSrc+'');if(imgSrc){_this.changSrc(showImg);}},show:function(){this.oBox.style.display='inline-block';},hide:function(){this.oBox.style.display='none';}};Slide.extend=function(target,source){for(name in source){if(source[name]!==undefined)target[name]=source[name]}};Slide.extend(Slide,{setStyle:function(obj,json){for(name in json){obj.style[name]=json[name];}},getTranX:function(obj){var getT=obj.style.WebkitTransform||obj.style.transform;var getIndex=getT.indexOf('translate3d(');var nowT=parseInt(getT.substring(getIndex+12,getT.length-13));return nowT;},_device:function(){var hasTouch=!!('ontouchstart'in window||window.DocumentTouch&&document instanceof window.DocumentTouch);var startEvt='touchstart';var moveEvt='touchmove';var endEvt='touchend';return{hasTouch:hasTouch,startEvt:startEvt,moveEvt:moveEvt,endEvt:endEvt};},getNow:function(n,length){return n%length;},getPre:function(n,length){if(n%length-1<0){var pre=length-1}else{var pre=n%length-1;}
return pre;},getNext:function(n,length){var next=(n+1)%length;return next;},getNextNew:function(n,length){var next=(n+2)%length;return next;},move:function(obj,x,index,tag){var zIndex=index||null;if(zIndex)obj.style.zIndex=zIndex;Slide.setStyle(obj,{WebkitTransform:'translate3d('+x+'px, 0px, 0px)',transform:'translate3d('+x+'px, 0px, 0px)'});},stopDefault:function(ev){if(ev&&ev.preventDefault)
ev.preventDefault();else
window.event.returnValue=false;return false;},stopPropagation:function(ev){if(ev&&ev.stopPropagation)
ev.stopPropagation();else
ev.cancelBubble=true;}});exports.init=function(opt){return new Slide(opt);};});
;define('jd.item.focusSlide',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),itemLoopScroll=require('wq.item.loopScroll'),itemUtil=require('jd.item.util'),reporter=itemUtil.reporter,wb=document.body.clientWidth;var FocusSlide=function(){var opt={itemLoop:'',isLastImg:false,containerId:'loopImgDiv',imgContainerId:'loopImgUl',imgBarContainerId:'loopImgBar',isImgInit:true,images:[],loopImg:[],shareImg:'',currentIndex:0,hasSetImages:false,defaultOriginImg:'//img12.360buyimg.com/jdphoto/jfs/t11506/139/448468161/290/701986d3/59f085fbN2932bfce.jpg',defaultImg:JD&&JD.img&&JD.img.getImgUrl('//img12.360buyimg.com/jdphoto/jfs/t11506/139/448468161/290/701986d3/59f085fbN2932bfce.jpg')};$.extend(this,opt);};FocusSlide.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.$container=$('#'+obj.containerId);obj.$imgContainer=$('#'+obj.imgContainerId);obj.$imgBarContainer=$('#'+obj.imgBarContainerId);obj.checkNetwork(obj.images);setTimeout(function(){obj.bindEvents();},400);};FocusSlide.prototype.refreshImages=function(images){var obj=this;obj.hasSetImages=false;obj.images=images;obj.hasInsertFirst=false;obj.checkNetwork();};FocusSlide.prototype.checkNetwork=function(){var obj=this,images=obj.images;obj.loopImg[0]='//wq.360buyimg.com/fd/h5/base/detail/images/transparent_a38f0a03.png';if(images&&images.length){obj.shareImg=(window.location.protocol||'http:')+'//img14.360buyimg.com/n4/'+images[0];obj.loopImg[0]='//img14.360buyimg.com/n4/'+images[0];}
obj.setProtalImg(images);};FocusSlide.prototype.setProtalImg=function(images){var obj=this;obj.hasSetImages=true;if(!images||images.length==0)return;var imgStr=[],tab=[];var wh='style="width:'+wb+'px; height:'+wb+'px;"';obj.loopImg=[];var getProtalImgUrl=function(jfsimg){var pageWidth2=$(window).width()*2,width=750;if(pageWidth2<=750){width=720;}else if(pageWidth2>750&&pageWidth2<=1080){width=750;}else{width=800;}
return JD.img.getScaleImgDpg('//m.360buyimg.com/mobilecms/'+jfsimg,width,width);};var defaultImg=obj.defaultImg||obj.defaultOriginImg;for(var i=0;i<images.length;i++){tab.push('<li no="'+(i+1)+'"></li>');var src=getProtalImgUrl(images[i]);obj.loopImg.push(src.replace(/\s+/g,''));if(obj.isImgInit&&i==0)continue;imgStr.push('<li data-ul-child="child"'+wh+(i==0?' id="firstImgLi"':'')+'><img src="'+defaultImg+'" back_src="'+src+'" onerror="__reloadResource(this)" /></li>');}
obj.$imgBarContainer.html(tab.join(''));obj.isImgInit?obj.$imgContainer.append(imgStr.join('')):obj.$imgContainer.html(imgStr.join(''));obj.$imgContainer.css({left:'0px'});var $firstImg=$('#firstImgLi img');if($firstImg.length&&$firstImg.attr('back_src')){$firstImg.attr('src',$firstImg.attr('back_src')).css({'opacity':1});}
if(obj.showLastImgSliderIndicator&&!$('#tittup').length){obj.$imgContainer.after('<div class="tittup" id="tittup"><span class="inner"><em class="arrow"></em><span class="txt"></span></span></div>');}
obj.slide();obj.isImgInit=false;};FocusSlide.prototype.slide=function(callback){var obj=this;obj.sliderProtal={'index':1};if(obj.itemLoop&&obj.itemLoop.removeListener){obj.itemLoop.removeListener();}
obj.itemLoop=itemLoopScroll.init('#'+obj.containerId);obj.itemLoop.initParam({startIndex:0,imgSrc:'back_src',laseMoveFn:function(x){var oDiv=$('#tittup');if(oDiv.css('display')=='none')return;var w=obj.$container.offset().width;if(x<-w/6){oDiv.find('.arrow').addClass('rotate');oDiv.find('.txt').html('\u91ca\u653e\u67e5\u770b\u8be6\u60c5');}
if(x>-w/6){oDiv.find('.arrow').removeClass('rotate');oDiv.find('.txt').html('\u6ed1\u52a8\u67e5\u770b\u8be6\u60c5');}
oDiv.css('WebkitTransform','translateX('+x+'px)');oDiv.css('transform','translateX('+x+'px)');},lastImgSlider:function(){if($('#tittup').css('display')=='none')return;obj.lastImgSliderCallback&&obj.lastImgSliderCallback();},preDef:'lnr',location:true,autoPlay:false,autoHeight:false,isBanOneImg:false,callback:function(x){obj.currentIndex=x;obj.$imgBarContainer.find('li[no="'+x+'"]').addClass('cur').siblings().removeClass('cur');var loopImgLen=$('#mainVideoLi').length?obj.loopImg.length+1:obj.loopImg.length;if(x==loopImgLen){obj.isLastImg=true;}else{obj.isLastImg=false;}
if(x==loopImgLen&&(!location.hash||location.hash=='#main')){reporter.reportExposure({ptag:'7001.1.211'});loopImgLen>1&&JD.events.trigger('item.comment.showBubble');}else{loopImgLen>1&&JD.events.trigger('item.comment.hideBubble');}
obj.slideCallback&&obj.slideCallback(x);callback&&callback(x);}});};FocusSlide.prototype.insertFirstSlide=function(id,tabClass,htmlStr,callback){var obj=this;var firstImgUrl=$('#firstImg').attr('src')||obj.loopImg[0];var wh='style="width:'+wb+'px; height:'+wb+'px;"';var firstSlideStr='<li data-ul-child="child"'+wh+' id="'+id+'">'+'<img src="'+firstImgUrl+'" onerror="__reloadResource(this)">'+
htmlStr+'</li>';obj.$imgContainer.html(firstSlideStr+obj.$imgContainer.html());var tab=[];tab[0]='<li no="1" class="'+tabClass+'"></li>';for(var i=0;i<obj.loopImg.length;i++){tab.push('<li no="'+(i+2)+'"></li>');}
obj.$imgBarContainer.html(tab.join(''));obj.hasInsertFirst=true;obj.slide(callback);};FocusSlide.prototype.preview=function(){var obj=this;if(!obj.loopImg.length)return;reporter.reports({ptag:'7001.1.3'});obj.isPreview=!obj.isPreview;if(obj.loopImg.length==1){itemUtil.imageViewer.previewImage(obj.loopImg[0]);}else{var domainStr=document.domain.split('.').slice(1).join('.');if(~domainStr.indexOf('jd.com')&&window.WeixinJSBridge&&window.location.hash!='#img'){var index=obj.hasInsertFirst?1:0;var loopImg=[];for(var i=0,len=obj.loopImg.length;i<len;i++){loopImg.push((obj.loopImg[i].indexOf('http')>-1?'':'http:')+obj.loopImg[i]);}
try{window.WeixinJSBridge.invoke('imagePreview',{'current':loopImg[obj.currentIndex-1-index],'urls':loopImg});}catch(e){}}else{if(obj.isPreview){obj.$container.addClass('mod_slider_viewer');$('#tittup').hide();itemUtil.imageViewer.toggleBlackCover(true);obj.isLastImg&&JD.events.trigger('item.comment.hideBubble');}else{window.history.go(-1);obj.isLastImg&&JD.events.trigger('item.comment.showBubble');}}}};FocusSlide.prototype.bindEvents=function(){var obj=this;obj.$imgContainer.off('click').on('click',function(){obj.preview();});$(window).on('hashchange',function(){if(window.location.hash!='#img'){obj.isPreview=false;obj.$container.removeClass('mod_slider_viewer');$('#tittup').show();}});};exports.init=function(config){var focusSlide=new FocusSlide();focusSlide.init(config);return focusSlide;};});
;define("jd.item.label",function(require,exports,module){var _cacheThisModule_,$=require('zepto'),mLs=require('loadJs'),itemUtil=require('jd.item.util'),reporter=itemUtil.reporter,popUp=itemUtil.popUp,getNetWork=itemUtil.getNetWork,gVar={jdSkuInfo:{},tags:[]};function addLeftUpLabel(obj,configShow){if(obj.isJDChoice||!configShow)return;var className='',content='';if(obj.isOnlineBook){className='linear_red';content='<i class="icon ebook"></i><span class="content"></span>';}
if(className){var $imgDom=$('#imgLeftUp'),$dom=$('#loopImgDiv div.inner');if(!$imgDom.length){$dom.append('<div id="imgLeftUp" followFirstImg="1"></div>');$imgDom=$('#imgLeftUp');}
$imgDom.attr('class','').addClass('corner_tag '+className).html(content).show();}}
function addLeftDownLabel(obj,configShow){if(obj.isJDChoice||!configShow)return;var spAttr=obj.item().spAttr||{},category=obj.jdCategory,category1=category[0],showLeftDownLabel=function(imgUrl,ptag){imgUrl=JD.img.getImgUrl(imgUrl,200,200);if(!$('#imgLeftDown').length){$('#loopImgDiv div.inner').append('<img class="service_tag" id="imgLeftDown" followFirstImg="1" src="'+imgUrl+'">');}else{$('#imgLeftDown').attr('src',imgUrl).show();}
reporter.reportExposure({ptag:ptag});};if(spAttr.isFzxp==='1'||spAttr.isFzxp==='2'){showLeftDownLabel('//img11.360buyimg.com/jdphoto/s200x200_jfs/t4837/130/1067752991/3352/67ee71f1/58ec4c22N7a6f24c9.png','7001.1.258');}else{if(obj.loadJdPayYouHui){obj.loadJdPayYouHui(function(jdpayInfo){if(jdpayInfo&&jdpayInfo.leftDownImg){showLeftDownLabel(jdpayInfo.leftDownImg);}});}}}
function rightUpSpecLabel(obj){var canShowMianDan=function(){if((!window._itemGlobal||(window.isMScene&&!window._itemGlobal.M_mianDanLabelSwitch)||(!window.isMScene&&!window._itemGlobal.mianDanLabelSwitch)))return false;var st=Date.parse('2018/6/1 00:00:00'),et=Date.parse('2018/6/20 23:59:59'),now=(new Date()).getTime();if(st>now||et<now)return false;var item=obj.item()||{},spAttr=item.spAttr||{};if(spAttr.isFlimPrint=='1')return false;if(spAttr.isSelfService=='1')return false;if(spAttr.isLOC=='2')return false;if(spAttr.isKO=='1'||(obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].miao&&obj.skuJson[obj.skuId].miao.isKo=='1'))return false;if(spAttr.YuShou=='1')return false;if((item.skuMark&&item.skuMark.presale)||(spAttr.YuShouNoWay=='1'&&spAttr.YuShou=='1'))return false;if(obj.isOTC)return false;if(obj.isPrescribeDrug)return false;if(obj.isOverseaPurchase>0)return false;if(obj.cfeeType&&obj.cfeeType.ft!=100)return false;if(obj.isHYKHSP)return false;if(obj.isEcard)return false;if(obj.isfqy)return false;if(spAttr.Customize=='1'||spAttr.Customize=='2')return false;if(spAttr.isLOC=='3')return false;if(spAttr.isLOC=='4')return false;if(obj.jdCategory[0]=='4938')return false;if(spAttr.isWeChatStock*1>0&&!(((spAttr.isWeChatStock*1)&1)&&((spAttr.isWeChatStock*1)&4)&&((spAttr.isWeChatStock*1)&16)))return false;if((obj.jdCategory[2]=='12856'&&obj.isZiying)||obj.venderId=='1000089641')return false;return true;};var showMianDanLabel=canShowMianDan(),$imgDom=$('#imgLabel'),$dom=$('#loopImgDiv div.inner'),addLabel=function(opt){if(!opt||!opt.img)return;opt.className=opt.className||'activity_tag';$imgDom=$('#imgLabel');if(!$imgDom.length){$dom.append('<img id="imgLabel" followFirstImg="1" class="'+opt.className+'" src="'+(opt.img?JD.img.getImgUrl(opt.img):'')+'" >');}else{$imgDom.attr({src:opt.img,class:opt.className});}
$imgDom=$('#imgLabel');opt.hide?$imgDom.hide():$imgDom.show();};if(showMianDanLabel&&(obj.bigPromoteInfo&&obj.bigPromoteInfo.rightupImg)){addLabel({'img':'//img30.360buyimg.com/jdphoto/jfs/t20845/337/365216380/23394/fbc457f3/5b0b9d46Nbb8de4db.png'});$imgDom.attr('beforePPMS','1');}else if(showMianDanLabel){addLabel({'img':'//img11.360buyimg.com/jdphoto/jfs/t20965/338/367855398/18659/71fb5a34/5b0b9d2eN1c2bd46a.png'});$imgDom.attr('beforePPMS','1');}else if(obj.bigPromoteInfo&&obj.bigPromoteInfo.rightupImg){addLabel({'img':obj.bigPromoteInfo.rightupImg,'hide':true});setTimeout(function(){$imgDom.show();},1000);}}
function addRightDownLabel(obj,config){config=config||{};if(obj.isJDChoice)return;if(obj.isCjg){sceneUrl(obj.skuId);}else{if(config.video!==false&&obj.mainVideoId){videoUrl(obj);}else{threeDUrl(obj);eBookUrl(obj);panoramaUrl(obj);}}}
function threeDUrl(obj){var sku=obj.skuId,category=obj.jdCategory;if(sku&&category&&category.length){if(~' 878 880 '.indexOf(' '+category[2]+' ')){window.threeDCB=function(json){if(json.errcode=='0'){gVar.jdSkuInfo['threeD'+sku]=json;var urlReg=/^(https*:){0,1}\/\//;if(json.data&&json.data.yn=='1'&&json.data.videoType=='2'&&urlReg.test(json.data.videoPath)){var $dom=$('#threeDLink'),threeUrl=json.data.videoPath;if($('#panoramaUrl').length){$('#panoramaUrl').hide();}
if(!$dom.length){$('#loopImgDiv div.inner').append('<a href="javascript:void(0);" class="lnk_3d" id="threeDLink" ptag="7001.1.87" followfirstimg="1">3D</a>');$dom=$('#threeDLink');}
$dom.off().on('click',function(e){if((getNetWork()||'').toLowerCase()==='wifi'){window.location.href=threeUrl;}else{popUp.createPopup({flag:4,icon:'info',msg:'3DWiFi~',okText:'',cancelText:'',onConfirm:function(){window.location.href=threeUrl;}});e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();}}).show();reporter.reports({ptag:'7001.1.86'});}}};if(gVar.jdSkuInfo['threeD'+sku]){window.threeDCB(gVar.jdSkuInfo['threeD'+sku]);}else{mLs.loadScript('//wq.jd.com/commodity/extension/get3dimage?skuid='+sku+'&callback=threeDCB&t='+Math.random()+(window.isMScene?'&sceneval=2':''));}}}}
function sceneUrl(skuId){if(!$('#sceneUrl').length){$('#loopImgDiv div.inner').append('<a href="//art.m.jd.com/artwork/scene.html?skuId='+skuId+'" class="lnk_scene" id="sceneUrl" ptag="7001.1.207" followfirstimg="1"></a>');}else{$('#sceneUrl').attr('href','//art.m.jd.com/artwork/scene.html?skuId='+skuId);}
$('#sceneUrl').show();reporter.reportExposure({ptag:'7001.1.208'});}
function videoUrl(obj){var videoId=obj.mainVideoId;if(!videoId)return;window.videoUrlCB=function(json){if(json.errcode==0&&json.result&&json.result.data&&json.result.data.length>0){gVar.jdSkuInfo['video'+obj.skuId]=json;var definitionObj={'low':1,'high':2,'yuanhua':3},urlObj=json.result.data.filter(function(s){return s&&s.main_url;}).sort(function(a,b){return definitionObj[a.sharpness]-definitionObj[b.sharpness];})[0];if(!urlObj){return;}
var url='//wqs.jd.com/item/video.shtml?ptag=7001.1.126&videourl='+encodeURIComponent(urlObj.main_url);var $dom=$('#videoUrl');if(!$dom.length){$('#loopImgDiv div.inner').append('<a href="javascript:void(0);" id="videoUrl" followFirstImg="1" class="lnk_video"></a>');$dom=$('#videoUrl');}
$dom.off().on('click',function(e){if((getNetWork()||'').toLowerCase()==='wifi'){window.location.href=url;}else{popUp.createPopup({flag:4,icon:'info',msg:'WiFi',okText:'',cancelText:'',onConfirm:function(){window.location.href=url;}});e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();}}).show();reporter.reportExposure({ptag:'7001.1.125'});}else{threeDUrl(obj);eBookUrl(obj);panoramaUrl(obj);}};if(gVar.jdSkuInfo['video'+obj.skuId]){window.videoUrlCB(gVar.jdSkuInfo['video'+obj.skuId]);}else{mLs.loadScript('//wq.jd.com/commodity/extension/getplayurl?callback=videoUrlCB&type=1&vid='+videoId+(window.isMScene?'&sceneval=2':''));}}
function panoramaUrl(obj){if(!obj.isPanorama)return;window.panoramaUrlCB=function(json){if(json.errcode==0&&json.result&&json.result.allOverImg&&json.result.allOverImg.length>0){gVar.jdSkuInfo['panorama'+obj.skuId]=json;if($('#eBookUrl,#threeDLink').length){return;}
var url='//wqs.jd.com/item/panorama.shtml?ptag=7001.1.160&skuId='+obj.skuId;var $dom=$('#panoramaUrl');if(!$dom.length){$('#loopImgDiv div.inner').append('<a href="javascript:void(0);" followFirstImg="1" id="panoramaUrl" class="lnk_3d"></a>');$dom=$('#panoramaUrl');}
reporter.reportExposure({ptag:'7001.1.159'});$dom.off().on('click',function(e){if((getNetWork()||'').toLowerCase()==='wifi'){window.location.href=url;}else{popUp.createPopup({flag:4,icon:'info',msg:'WIFI',okText:'',cancelText:'',onConfirm:function(){window.location.href=url;}});e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();}}).show();}};if(gVar.jdSkuInfo['panorama'+obj.skuId]){window.panoramaUrlCB(gVar.jdSkuInfo['panorama'+obj.skuId]);}else{mLs.loadScript('//wq.jd.com/commodity/extension/alloverimg?callback=panoramaUrlCB&skuid='+obj.skuId+(window.isMScene?'&sceneval=2':''));}}
function eBookUrl(obj){var skuId=obj.skuId,category1=obj.jdCategory[0];if(obj.isAndroid||category1!=='1713')return;window.eBookUrlCB=function(json){if(json.code==='1'){gVar.jdSkuInfo['eBook'+skuId]=json;if(json.info&&json.info.length>0){var eBookId=json.info[0].ebookId;if(eBookId){var $dom=$('#eBookUrl'),url='//e-m.jd.com/ebook/read/'+eBookId+'-0-1.html?sid=&source=wxsq';if(!$dom.length){$('#loopImgDiv div.inner').append('<a href="javascript:void(0);" followFirstImg="1" class="lnk_read" id="eBookUrl" ptag="7001.1.93"></a>');$dom=$('#eBookUrl');}
if($('#panoramaUrl').length){$('#panoramaUrl').hide();}
$dom.show().attr('href',url);reporter.reports({ptag:'7001.1.92'});}}}};if(gVar.jdSkuInfo['eBook'+skuId]){window.eBookUrlCB(gVar.jdSkuInfo['eBook'+skuId]);}else{mLs.loadScript('//gw-e.jd.com/forBookCode/forBookCode_getBathEbookIdForJs.action?callback=eBookUrlCB&bookCode='+skuId);}}
exports.setLabel=function(obj,config){var defaultConfig={leftUp:true,leftDown:true,rightUp:true,rightDown:{video:true}}
config=$.extend({},defaultConfig,config);addLeftUpLabel(obj,config.leftUp);addLeftDownLabel(obj,config.leftDown);rightUpSpecLabel(obj,config.rightUp);addRightDownLabel(obj,config.rightDown);};});
;define('jd.item.favour',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),cookie=require('cookie'),ls=require('loadJs'),loginHandler=require('jd.item.loginHandler'),itemUtil=require('jd.item.util'),umpMonitor=itemUtil.umpMonitor,showNotice=itemUtil.showNotice,reporter=itemUtil.reporter,urlParam=require('url'),scanOrig=urlParam.getUrlParam('scan_orig');var ItemFavour=function(){var opt={isMScene:false,isLoginAct:false,containerId:'fav',favourText:'',skuId:'',jdCategory:[],jdSkuIds:[],favInfo:{},venderId:''};$.extend(this,opt);};ItemFavour.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.$container=$('#'+obj.containerId);obj.setFavStatus();loginHandler.loginSetCookie(function(){obj.checkFav();});obj.bindEvent();};ItemFavour.prototype.changeSku=function(skuId){if(!skuId)return;var obj=this;obj.skuId=skuId;obj.setFavStatus();};ItemFavour.prototype.checkFav=function(){var obj=this;if(cookie.get('dofav')){cookie.del('dofav');obj.fav();}else if(loginHandler.getLoginStatus()){umpMonitor.createTimeout('6','item collection api(check) timeout');window.checkFav=function(json){if(json.iRet!='0')return;var data=json.data;for(var i=0;i<data.length;i++){obj.favInfo[data[i].skuid]=data[i].state=='1';}
obj.setFavStatus();umpMonitor.delTimeout('itil6');};var param={'commId':(obj.jdSkuIds||[]).join(','),'shopId':(obj.venderId||0),'t':Math.random()};setTimeout(function(){ls.loadScript('//wq.jd.com/fav/comm/FavManyCommQuery?callback=checkFav&'+$.param(param)+(obj.isMScene?'&sceneval=2':''));},1500);}};ItemFavour.prototype.setFavStatus=function(){var obj=this;if(obj.favInfo[obj.skuId]){obj.$container.addClass('yes').html(''+obj.favourText);}else{obj.$container.removeClass('yes').html(obj.favourText);}};ItemFavour.prototype.fav=function(isFav,noNotice,callback){var obj=this;if(obj.isHoldFav)return;obj.isHoldFav=true;setTimeout(function(){obj.isHoldFav=false;},600);umpMonitor.createTimeout('6','item collection api timeout');if(obj.favInfo[obj.skuId]){if(isFav)return;window.cancelFav=function(json){if(json.iRet=='9999'){callback&&callback(false);return;}
obj.favInfo[obj.skuId]=false;obj.setFavStatus();if(!noNotice)showNotice({str:''});umpMonitor.delTimeout('itil6');callback&&callback(true);};ls.loadScript({url:'//wq.jd.com/fav/comm/FavCommDel?callback=cancelFav'+(obj.isMScene?'&sceneval=2':'')+'&'+$.param({'commId':obj.skuId,'shopId':(obj.venderId||0),'t':Math.random()}),onError:function(){showNotice({str:''});}});}else{window.addFav=function(json){if(json.iRet=='9999'){if(obj.isLoginAct){obj.isLoginAct=false;callback&&callback(false);umpMonitor.report({operation:'6',result:'0',source:'0',message:'item collection api loaded'});return;}
cookie.set('dofav','ok',1);loginHandler.login();}
else if(json.iRet=='2'){showNotice({str:''});callback&&callback(false);}
else if(json.iRet=='0'||json.iRet=='3'){obj.favInfo[obj.skuId]=true;obj.setFavStatus();callback&&callback(true);if(!noNotice)showNotice({str:obj.favourText+''});JD.events.trigger('item.favour.addFavSuc','1');var shareObj=window.mchb&&window.mchb.getCommonShare&&window.mchb.getCommonShare();if(shareObj&&!cookie.get('hasShownFavorSharePannel')){var $shareMod=$('#shareMod');if(!$shareMod.length){$(document.body).append('<div class="mod_share" id="shareMod"><div class="favor_share_content"><div class="tip"></div><div class="btn"><i></i>&nbsp;</div><i class="close"></i></div></div>');$shareMod=$('#shareMod');setTimeout(function(){$shareMod.addClass('show');},0);reporter.reportExposure({ptag:'7001.14.1'});reporter.pingClick('MProductdetail_FocusShareFloatExpo',window.isPingouScene?'1':'0');$shareMod.on('click','.btn',function(){reporter.reports({ptag:'7001.14.2'});reporter.pingClick('MProductdetail_FocusShare',window.isPingouScene?'1':'0');$shareMod.hide();$shareMod.removeClass('show');shareObj.show();});$shareMod.on('click','.close',function(){reporter.reports({ptag:'7001.14.3'});reporter.pingClick('MProductdetail_FocusShareClose',window.isPingouScene?'1':'0');cookie.set('hasShownFavorSharePannel','1',24*60,'',document.domain);$shareMod.hide();$shareMod.removeClass('show');});}else{$shareMod.show();$shareMod.addClass('show');}}}else{callback&&callback(false);showNotice({str:''});}
umpMonitor.delTimeout('itil6');};var param=['//wq.jd.com/fav/comm/FavCommAdd?callback=addFav&commId='+obj.skuId+(obj.isMScene?'&sceneval=2':''),'category='+(obj.jdCategory.slice(0,3).join('_')),'t='+Math.random()];if(scanOrig)param.push('scan_orig='+scanOrig);ls.loadScript({url:param.join('&'),onError:function(){showNotice({str:''});}});}};ItemFavour.prototype.bindEvent=function(){var obj=this;obj.$container.on('click',function(){itemUtil.reporter.txReport({ptag:'7001.1.22'});obj.fav();});};exports.init=function(config){var itemFavour=new ItemFavour();itemFavour.init(config);return itemFavour;};});
;/**
 * Created by sunjunwei on 2018/3/27.
 */
define('favGiftAlert',function (require, exports, module) {

    var $ = require('zepto');

    /*
     * opts
     *      favResult --- string
     *      favDesc  --- string
     *      giftInfo --- array
     *      giftInfo
     *      giftInfo = [{type:"jifen",desc:"*10"},{type:"dongjuan",desc:"100"}]
     *          type
     *              jifen
     *              dongjuan
     *              jingjuan
     *              jingdou
     *          desc
     *              
     */
    function showFavGiftAlert(opts) {
        var option = {
            favResult:"",
            favDesc:"",
            giftInfo: []
        };

        opts = opts || {};
        extend(option, opts);

        var giftInfoLen = option.giftInfo.length;
        option.giftInfo.forEach(function (item) {
            if(item.type == "jifen"){ //
                item.giftImgClass = giftInfoLen == 1 ? "shop_jifen_single" : "shop_jifen_multi";//

            }else if(item.type == "jingdou"){ //
                item.giftImgClass = giftInfoLen == 1 ? "shop_jingdou_single" : "shop_jingdou_multi";

            }else if(item.type == "dongjuan"){ //
                item.giftImgClass = giftInfoLen == 1 ? "shop_dongjuan_single" : "shop_dongjuan_multi";

            }else if(item.type == "jingjuan"){ //
                item.giftImgClass = giftInfoLen == 1 ? "shop_jingjuan_single" : "shop_jingjuan_multi";

            }
        });

        //
        var giftLiList = "";
        for(var i=0; i<option.giftInfo.length; i++){

            var item=option.giftInfo[i];
            item.desc = item.desc || "";
            if(item.type && ["jifen","jingdou","dongjuan","jingjuan"].indexOf(item.type) !== -1){
                giftLiList = giftLiList +   '<li class="reward_item">' +
                                                '<div class="reward_item_img ' + item.giftImgClass + '"></div>' +
                                                '<p class="reward_item_text">' + item.desc + '</p>' +
                                            '</li>';
            }
            if( (i+1)!==option.giftInfo.length && (i+1)%3!==0 ){
                giftLiList = giftLiList + '<li class="item_add"><i></i></li>';
            }
        }

        var html = 	'<div class="fav_success_alert fixed">' +
                        '<div class="fav_alert_icon icon_success"></div>' +
                        '<div class="fav_success_alert_title">' + option.favResult + '</div>' +
                        '<div class="fav_success_alert_text">' + option.favDesc + '</div>' +
                        '<ul class="fav_success_alert_reward">' +
                            giftLiList +
                        '</ul>' +
                        '<div class="fav_success_alert_confirm"></div>' +
                    '</div>' +
                    '<div class="mod_alert_mask"></div>';

        $("body").append(html);
        $(".mod_alert_mask").show();

        $(".fav_success_alert_confirm").click(function () {
            $(".mod_alert_mask").hide();
            if($("body .fav_success_alert").length > 0){
                $("body .fav_success_alert").remove();
            }
            $(".fav_success_alert_confirm").unbind("click");
        });

    }

    function extend(a, b) {
        for (var i in b) {
            if (b.hasOwnProperty(i)) {
                a[i] = b[i];
            }
        }
        return a;
    }

    /*
     *css
     */
    function loadCss(url) {
        var l = document.createElement('link');
        l.setAttribute('type', 'text/css');
        l.setAttribute('rel', 'stylesheet');
        l.setAttribute('href', url);
        document.getElementsByTagName("head")[0].appendChild(l);
    }
    loadCss("//wq.360buyimg.com/fd/h5/wxsq_dev/fav/css/favGiftAlert.min_ff78f2e1.css");

    module.exports = {
        showFavGiftAlert: showFavGiftAlert
    };

});
;define('jd.item.shop',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),util=require('util'),ls=require('loadJs'),cookie=require('cookie'),itemUtil=require('jd.item.util'),showNotice=itemUtil.showNotice,reporter=itemUtil.reporter,umpMonitor=itemUtil.umpMonitor,$jsonToTpl=itemUtil.$jsonToTpl,itemComm=require('wq.item.common'),loginHandler=require('jd.item.loginHandler'),favGiftAlert=require('favGiftAlert'),isWX=util.isWX(),pageWidth=$(window).width();var Shop=function(){var opt={isLoginAct:false,isMScene:false,isJDChoice:false,containerId:'shopArea',favourText:'',showShopEntry:true,shopFavStatus:0,isZiying:false,isOverseaPurchase:false,isFCS:false,isSCF:false,stock:null,venderId:'',venderName:'',shopId:'',skuId:'',mainImg:'',skuName:'',jdPrice:'',jdCategory:[],setShopDraw:false,phoneNum:'',isWoma:'',isSam:'',isJDAPP:JD&&JD.device&&JD.device.scene=='jdapp',isJdPgApp:JD&&JD.device&&JD.device.scene=='jdpingou',isSqEnv:/qq\/([\d\.]+)*/.test(navigator.userAgent.toLowerCase()),};$.extend(this,opt);};Shop.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.isJxChannel=obj.isJdPgApp||obj.isSqEnv||isWX;if(obj.isMScene)obj.favourText='';obj.$container=$('#'+obj.containerId);obj.getShopId();obj.shopUrl=obj.isMScene?'//shop.m.jd.com/?shopId='+obj.shopId+'&skuId='+obj.skuId+'&categoryId='+obj.jdCategory.join('_'):'//wqshop.jd.com/mshop/gethomepage?ptag='+(obj.isJDChoice?'7001.4.32':'7001.1.21')+'&venderId='+obj.venderId+'&source='+(isWX?1:0)+'&sid='+cookie.get('sid')+'&loginFlag=1#/index?recItem='+obj.skuId+'_'+obj.jdCategory.join('_');obj.getVenderInfo();obj.showShopEntry&&obj.checkChatStatus();loginHandler.loginSetCookie(function(){obj.checkIsFavShop();});obj.bindEvent();};Shop.prototype.getShopId=function(){var obj=this;if(obj.isZiying){obj.shopId=obj.stock&&obj.stock.self_D&&obj.stock.self_D.id;}else{obj.shopId=obj.stock&&obj.stock.D&&obj.stock.D.id;}};Shop.prototype.getVenderInfo=function(){var obj=this;obj.$container.hide().next('div.detail_gap').hide();if(obj.isJDChoice){$('#jxShop2').hide();$('#jxShop1').show();}
if(!obj.venderId||obj.venderId=='0')return;window.getVenderInfoCB=function(data){if(data.errcode===0&&data.data&&data.data.length>0){if(data.data[0].shopId)obj.shopId=data.data[0].shopId;obj.shopUrl=obj.isMScene?'//shop.m.jd.com/?shopId='+obj.shopId+'&skuId='+obj.skuId+'&categoryId='+obj.jdCategory.join('_'):'//wqshop.jd.com/mshop/gethomepage?ptag='+(obj.isJDChoice?'7001.4.32':'7001.1.21')+'&venderId='+obj.venderId+'&source='+(isWX?1:0)+'&sid='+cookie.get('sid')+'&loginFlag=1#/index?recItem='+obj.skuId+'_'+obj.jdCategory.join('_');var shopData=data.data[0]||{};var shopInfo=shopData.shopInfo;if(shopInfo&&shopInfo.venderId===obj.venderId){obj.phoneNum=shopInfo.phoneNum;if(obj.jdCategory[1]=='2615'&&(!obj.isOverseaPurchase||obj.isOverseaPurchase<=0)&&obj.isZiying){obj.phoneNum=obj.phoneNum||'400-608-5500';}
obj.phoneNum&&obj.setServiceEntry();obj.venderName=shopInfo.shopName;$('#shopName').html(obj.venderName);var commonGoodShopCode=shopData.commonGoodShopCode||0,categoryGoodShopCode=shopData.categoryGoodShopCode||0,decoUnionCode=shopData.decoUnionCode||0,showPhoneNum=(!obj.isZiying&&!obj.isOverseaPurchase>0&&!obj.isFCS&&shopInfo.phoneNum),shopInfoHtml='<div class="name '+(((shopData.scoreRankRateGrade>0&&commonGoodShopCode!='1'&&categoryGoodShopCode!='1002'&&!obj.isFCS)||showPhoneNum)?'':'jd_self')+'"><span class="_n">'+obj.venderName+'</span>';var onlyZiying=obj.isWoma||obj.isSam;if(onlyZiying){shopInfoHtml+='<em class="jd" shopIcon="1"></em>';}
else if(shopData.commonGoodShopCode=='2'){shopInfoHtml+='<img src="//img11.360buyimg.com/jdphoto/s108x28_jfs/t1/47659/5/3832/2614/5d1b0c8aE7ca69afb/97e6ea792a0917ea.png" class="shop_icon" shopIcon="1">';}
else if(obj.isOverseaPurchase>0){if(obj.isZiying||obj.isFCS){shopInfoHtml+='<img src="//img10.360buyimg.com/jdphoto/s137x28_jfs/t25534/202/2651478252/3370/7c896143/5bed0603Nee9be7ec.png" class="shop_icon" shopIcon="1">';}else{shopInfoHtml+='<img src="//img10.360buyimg.com/jdphoto/s88x28_jfs/t26368/182/1794930675/2452/b4547785/5bed0603N53a5230b.png" class="shop_icon" shopIcon="1">';}}else if(decoUnionCode=='1'){shopInfoHtml+='<img src="//img11.360buyimg.com/jdphoto/s88x28_jfs/t1/24919/12/3295/2568/5c25d067Ea0f4e690/9e94e17f36f626d9.png" class="shop_icon" shopIcon="1">';}else if(commonGoodShopCode=='1'){shopInfoHtml+='<img src="//img11.360buyimg.com/jdphoto/s112x28_jfs/t1/34687/34/7550/4081/5cd14247E09fbbaf1/8ba9682b55f4a61d.png" class="shop_icon" shopIcon="1">';}else if(categoryGoodShopCode=='1002'){shopInfoHtml+='<img src="//img10.360buyimg.com/jdphoto/jfs/t15811/234/1732333581/5189/29205c8/5a5d667fNd8ae2c02.png" class="shop_icon" shopIcon="1">';}else if(obj.isZiying||obj.isFCS||obj.isSCF){shopInfoHtml+='<em class="jd" shopIcon="1"></em>';}
if(shopData.scoreRankRateGrade>0&&commonGoodShopCode!='1'&&categoryGoodShopCode!='1002'&&!obj.isFCS&&decoUnionCode!='1'&&!onlyZiying){var thirdClass='',fourClass='',fiveClass='';if(shopData.scoreRankRateGrade==2.5){thirdClass='half';fourClass='empty';fiveClass='empty';}else if(shopData.scoreRankRateGrade==3){fourClass='empty';fiveClass='empty';}else if(shopData.scoreRankRateGrade==3.5){fourClass='half';fiveClass='empty';}else if(shopData.scoreRankRateGrade==4){fiveClass='empty';}else if(shopData.scoreRankRateGrade==4.5){fiveClass='half';}else if(shopData.scoreRankRateGrade==4.9){fiveClass='ninety';}
shopInfoHtml+='<p class="desc"><span class="star"><i class="star_icon"></i><i class="star_icon"></i><i class="star_icon '+thirdClass+'"></i><i class="star_icon '+fourClass+'"></i><i class="star_icon '+fiveClass+'"></i></span></p>';}else if(showPhoneNum){shopInfoHtml+='<p class="desc">'+shopInfo.phoneNum+'</p>';}
shopInfoHtml+='</div>';$('#shopInfo').html(shopInfoHtml);$('#shopArea').show().next('div.detail_gap').show();if(obj.isJDChoice){$('#jxShop2').show();$('#jxShop1').hide();}
if(obj.showShopEntry){$('#gotoShop').show();reporter.reportExposure({ptag:'7418.2.4'});obj.adjustBtns();}
if(shopInfo.goodsNum>0||shopInfo.shopFansNum>0){var tpl='<div class="tab_item"><p class="num">{#num#}</p><p class="desc">{#desc#}</p></div>',html=[];html.push(itemComm.jsonToTpl({num:shopInfo.shopFansNum||'0',desc:''},tpl));html.push(itemComm.jsonToTpl({num:shopInfo.goodsNum||'0',desc:''},tpl));if(shopData.userEvaluateScore>0&&shopData.afterServiceScore>0&&shopData.logisticsLvyueScore>0&&shopData.commentFactorScoreRankGrade&&shopData.logisticsFactorScoreRankGrade&&shopData.afsFactorScoreRankGrade&&!obj.isFCS&&!onlyZiying){var tpl1='<div class="evaluation"><div class="evaluation_wrap">'+'<div class="evaluation_list {#commentClass#}"><span class="evaluation_list_head"></span>{#userEvaluateScore#} | {#commentFactorScoreRankGrade#}</div>'+'<div class="evaluation_list {#logisticsClass#}"><span class="evaluation_list_head"></span>{#logisticsLvyueScore#} | {#logisticsFactorScoreRankGrade#}</div>'+'<div class="evaluation_list {#serviceClass#}"><span class="evaluation_list_head"></span>{#afterServiceScore#} | {#afsFactorScoreRankGrade#}</div></div></div>',item={userEvaluateScore:parseFloat(shopData.userEvaluateScore).toFixed(2),commentFactorScoreRankGrade:shopData.commentFactorScoreRankGrade,afterServiceScore:parseFloat(shopData.afterServiceScore).toFixed(2),afsFactorScoreRankGrade:shopData.afsFactorScoreRankGrade,logisticsLvyueScore:parseFloat(shopData.logisticsLvyueScore).toFixed(2),logisticsFactorScoreRankGrade:shopData.logisticsFactorScoreRankGrade};var calClass=function(prefix,grade){if(grade==''){item[prefix+'Class']='low';}};calClass('comment',item.commentFactorScoreRankGrade);calClass('service',item.afsFactorScoreRankGrade);calClass('logistics',item.logisticsFactorScoreRankGrade);html.push(itemComm.jsonToTpl(item,tpl1));}
$('#shopBaseInfo').html(html.join('')).show();}
var shopLogoUrl=shopData.rectLogo;if(obj.isJxChannel){if(shopLogoUrl=='//img30.360buyimg.com/cms/jfs/t15700/184/2185271099/1989/79924965/5a951714Nee8bb188.png')shopLogoUrl='//img11.360buyimg.com/jdphoto/s180x60_jfs/t1/41073/40/14743/1866/5d79f7b5E35c0816b/d8ceae882f67e7eb.png';}
if(shopLogoUrl){$('#shopLogo,#luckyMoneyLogo').attr('src',JD.img.getImgUrl(shopLogoUrl));}!obj.isMScene&&obj.shopEnterGift();if(!window.isPingouScene&&data.data[0].productDetailShopEnteranceFlag=='1'&&shopInfo.fPicUrl&&data.data[0].shopEnterHotCateName1&&data.data[0].shopEnterHotCateName2&&data.data[0].shopEnterHotCateName3){var lTpl='<div class="shop_leading" id="shopLeading">'+'<img class="shop_leading_ad" src="{#fPicUrl#}" onerror="__reloadResource(this)" />'+'<div class="shop_leading_cat">'+'<div class="leading_cat_li first" data-cate3="{#shopEnterHotCateId1#}">{#shopEnterHotCateName1#}</div>'+'<div class="leading_cat_li" data-cate3="{#shopEnterHotCateId2#}">{#shopEnterHotCateName2#}</div>'+'<div class="leading_cat_li" data-cate3="{#shopEnterHotCateId3#}">{#shopEnterHotCateName3#}</div>'+'</div>'+'</div>';data.data[0].fPicUrl=JD.img.getImgUrl(shopInfo.fPicUrl);$('#shopBaseInfo').after($jsonToTpl(data.data[0],lTpl));$('#shopLeading').on('click','.shop_leading_ad',function(){location.href=obj.shopUrl;});$('#shopLeading').on('click','.leading_cat_li',function(){var $this=$(this),url=obj.isMScene?'//shop.m.jd.com/?shopId='+obj.shopId:'//wqshop.jd.com/mshop/GetHomePage?venderId='+obj.venderId;url+='&sceneId=1001&categoryId3='+$this.attr('data-cate3');if($this.hasClass('first')){url+='&skuId='+obj.skuId;}
location.href=url;});}
reporter.reportExposure({ptag:obj.isJDChoice?'7001.4.30':'7001.1.140'});}}};ls.loadScript('//wq.jd.com/mshop/BatchGetShopInfoByVenderId?callback=getVenderInfoCB&venderIds='+obj.venderId+'&t='+Math.random());};Shop.prototype.checkIsFavShop=function(){var obj=this;if(!loginHandler.getLoginStatus()){$.publish('item.shop.favStatusChange',[obj.shopFavStatus]);return;}
window.checkFavShopCB=function(json){if(json.iRet=='0'){if(json.state=='0'){$('#shopFav').removeClass('favor').html('<i class="icon_unfavor"></i>'+obj.favourText+'');if(cookie.get('shopFav')){cookie.del('shopFav');obj.shopFav();}}else{$('#shopFav').addClass('favor').html('<i class="icon_favor"></i>'+obj.favourText+'');}!obj.isMScene&&obj.shopFavGift(1);obj.shopFavStatus=json.state-0;}
$.publish('item.shop.favStatusChange',[obj.shopFavStatus]);};ls.loadScript('//wq.jd.com/fav/shop/QueryOneShopFav?venderId='+obj.venderId+'&callback=checkFavShopCB&t='+Math.random()+(obj.isMScene?'&sceneval=2':''));};Shop.prototype.shopFav=function(isAddFav){var obj=this,$btn=$('#shopFav');if(!loginHandler.getLoginStatus()){loginHandler.login(null,function(){obj.shopFav();});return;}
if(obj.isHoldFav)return;obj.isHoldFav=true;setTimeout(function(){obj.isHoldFav=false;},600);if(!isAddFav&&$btn.hasClass('favor')){window.delShopFavCB=function(json){if(json.iRet=='9999'){if(obj.isLoginAct){obj.isLoginAct=false;umpMonitor.report({operation:'6',result:'0',source:'0',message:'item collection api loaded'});return;}
loginHandler.login();return;}
if(json.iRet=='0'||json.iRet=='20'){$btn.removeClass('favor').html('<i class="icon_unfavor"></i>'+obj.favourText+'');itemUtil.showNotice({str:''});obj.shopFavGift(1);obj.shopFavStatus=0;$.publish('item.shop.favStatusChange',[obj.shopFavStatus]);}else{itemUtil.showNotice({str:''+obj.favourText+''});}};ls.loadScript({url:'//wq.jd.com/fav/shop/DelShopFav?venderId='+obj.venderId+'&callback=delShopFavCB&t='+Math.random()+(obj.isMScene?'&sceneval=2':''),onError:function(){itemUtil.showNotice({str:''+obj.favourText+''});}});}else{window.addShopFavCB=function(json){if(json.iRet=='9999'){if(obj.isLoginAct){obj.isLoginAct=false;umpMonitor.report({operation:'6',result:'0',source:'0',message:'item collection api loaded'});return;}
cookie.set('shopFav','ok',1);loginHandler.login();return;}
if(json.iRet=='0'||json.iRet=='2'){if($btn.hasClass('favor_gift')&&obj.shopgift){obj.shopFavGift(2);}else{itemUtil.showNotice({str:obj.favourText+'',iconFlag:1,t:2500});}
$btn.addClass('favor').html('<i class="icon_favor"></i>'+obj.favourText+'');obj.shopFavStatus=1;$.publish('item.shop.favStatusChange',[obj.shopFavStatus]);}else{itemUtil.showNotice({str:obj.favourText+'',iconFlag:2});}};ls.loadScript({url:'//wq.jd.com/fav/shop/AddShopFav?venderId='+obj.venderId+'&callback=addShopFavCB&t='+Math.random()+(obj.isMScene?'&sceneval=2':''),onError:function(){itemUtil.showNotice({str:obj.favourText+'',iconFlag:2});}});}};Shop.prototype.gotoShop=function(url){var obj=this;$.publish('item.main.leavePage');if(obj.isJDAPP){window.location.href='openapp.jdmobile://virtual?params={"des":"jshopMain","category":"jump","venderId":"'+obj.venderId+'","shopId":"'+obj.shopId+'"}';}else if(obj.isMScene){setTimeout(function(){location.href=url||obj.shopUrl;},100);}else{window.location.href=url||obj.shopUrl;}};Shop.prototype.checkChatStatus=function(){var obj=this;window.checkChatStatuCb=function(json){obj.onlineServiceStatus=parseInt(json&&json.code);obj.setServiceEntry();};ls.loadScript({url:'//chat1.jd.com/api/checkChat?callback=checkChatStatuCb&pid='+obj.skuId+'&t='+Math.random(),onError:function(){obj.onlineServiceStatus=0;obj.setServiceEntry();}});};Shop.prototype.setServiceEntry=function(){var obj=this;if(obj.onlineServiceStatus===undefined)return;var isMeitu=/com\.meitu\.myxj/.test(navigator.userAgent);obj.shopImLink=obj.isMScene?[(obj.isJdPgApp?'//chat.jd.com/chat/index.action?pid='+obj.skuId:'//chat.jd.com/merchant/index?v=6&sku='+obj.skuId)+(isMeitu?'&mtype=meitu':''),'entry='+(obj.isJdPgApp?'jd_m_pingouapp':'m_item'),'imgUrl='+(encodeURIComponent(obj.mainImg)),'goodName='+(encodeURIComponent(obj.skuName)),'jdPrice='+obj.jdPrice,'sid='+encodeURIComponent(cookie.get('sid')||'')].join('&'):['//wq.jd.com/mjgj/dongdong/goodsquery?skuid='+obj.skuId,'imgUrl='+(encodeURIComponent(obj.mainImg)),'name='+(encodeURIComponent(obj.skuName)),'price='+(obj.jdPrice||'KONG'),isWX?'source=0&entry=2':'source=1&entry=7','sid='+encodeURIComponent(cookie.get('sid')||'')].join('&');if(obj.isJDAPP){obj.shopImLink='openapp.jdmobile://virtual?params={"des":"im","category":"jump","skuId":"'+obj.skuId+'","name":"'+obj.skuName+'","imgUrl":"'+obj.mainImg+'","price":"'+obj.jdPrice+'"}';}
var $shopIM=$('#shopIM');if(obj.isJxChannel)$shopIM.find('.icon').css('background-image','url("https://img11.360buyimg.com/jdphoto/s40x40_jfs/t1/75122/32/9731/564/5d7615beE29c49add/c3b257c5b3c4825a.png")');if(obj.phoneNum){$shopIM.show();obj.adjustBtns();$shopIM.attr('popup','1');var arr=obj.phoneNum.split('');$('#servicePhone').html(' '+obj.phoneNum);$('#servicePhone').parent().attr('href','tel:'+arr[0]);if(obj.onlineServiceStatus!==1&&obj.onlineServiceStatus!==3){obj.shopImLink='';$('#shopIM2').hide();$('#servicePhone').removeClass('underline');}}else{if(obj.onlineServiceStatus===0){}else if(obj.onlineServiceStatus===1||obj.onlineServiceStatus===3){$shopIM.show();obj.adjustBtns();}else{$shopIM.show();obj.adjustBtns();$shopIM.addClass('disabled');}}};Shop.prototype.adjustBtns=function(){var $orginBuyBtnPriceDom=$('#orginBuyBtn .price'),$tuanBtnPriceDom=$('#tuanBtn .price');setTimeout(function(){if($orginBuyBtnPriceDom.height()>20||$tuanBtnPriceDom.height()>20){$orginBuyBtnPriceDom.find('strong').css('font-size','12px');$tuanBtnPriceDom.find('strong').css('font-size','12px');}},0);setTimeout(function(){if($tuanBtnPriceDom.height()>20){$tuanBtnPriceDom.find('.cash_return').hide();}},0);};Shop.prototype.bindEvent=function(){var obj=this;obj.$container.on('click',function(e){var target=e.srcElement||e.target,em=target,i=1;while(em&&!em.id&&i<=4){em=em.parentNode;i++;}
if(!em||!em.id)return;var emId=em.id;switch(emId)
{case'shopFav':obj.shopFav();break;case'shopLinks':case'shopLogoInfo':case'shopBaseInfo':case'shopLogo':case'shopInfo':var eventParam=obj.shopId+'_';if(obj.isOverseaPurchase){eventParam+='1';}else if(obj.isOTC){eventParam+='2';}else if(obj.isPresale||obj.isYuShou||obj.isYuShouNoWay){eventParam+='3';}else if(obj.isHeyue){eventParam+='4';}else if(obj.isLoc){eventParam+='5';}else{eventParam+='0';}
reporter.pingClick('MProductdetail_EnterShop',eventParam,'3',obj.skuId);obj.gotoShop();break;}});$('#shopFav1').on('click',function(){reporter.reports({ptag:'7001.1.274'});obj.shopFav(true);});$('#gotoShop').on('click',function(){if(obj.isMScene){reporter.pingClick('MProductdetail_BottomToShop','','3');obj.gotoShop();}else{obj.gotoShop(JD.url.addRd(obj.shopUrl,'7001.1.61'));}
reporter.reports({ptag:'7418.2.5'});});$('#shopIM').on('click',function(){if($(this).attr('popup')=='1'){obj.mainViewScroll=$(window).scrollTop();$('#servicePopup').show().addClass('show');$('body').css('top','-'+obj.mainViewScroll+'px').addClass('overflowHide');reporter.reportExposure({ptag:obj.isJDChoice?'7001.4.41':'7001.1.169'});}else{if($(this).hasClass('disabled')){showNotice({str:'<br/>'});}else{$.publish('item.main.leavePage');loginHandler.loginLocation(obj.shopImLink);}}});$('#servicePopup').on('click',function(){var $servicePopup=$('#servicePopup');$servicePopup.removeClass('show').off('transitionend').on('transitionend',function(){$servicePopup.hide();$servicePopup.off('transitionend');});$('body').removeClass('overflowHide').css('top','0');window.scrollTo(0,obj.mainViewScroll);});$('#serviceList').on('click',function(event){event.stopPropagation&&event.stopPropagation();});$('#shopIM2').on('click',function(event){event.preventDefault&&event.preventDefault();event.stopPropagation&&event.stopPropagation();$.publish('item.main.leavePage');loginHandler.loginLocation(obj.shopImLink);});$.subscribe('item.skuSwitch.switch',function(){setTimeout(function(){obj.adjustBtns();},100);});};Shop.prototype.shopEnterGift=function(){var obj=this;window.shopEnterGiftCB=function(json){if(json&&json.errcode==0&&json.shopgift&&json.shopgift.length>0){var giftList=json.shopgift.filter(function(s){return s&&s.discount&&s.discount>0&&s.prizeType;});if(giftList&&giftList.length>0){$('#shopLinks').addClass('shop_gift').html('<i class="icon_gift"></i>');var $shopInfo=$('#shopInfo'),$shopIcon=$shopInfo.find('[shopIcon="1"]').filter(':visible');if($shopInfo.find('.icon_promote').length<1&&(!$shopIcon.length||(pageWidth-$shopIcon.position().left-$shopIcon.width())>49)){$shopInfo.append('<i class="icon_promote"></i>');}}else{obj.shopDrawSign();}}else{obj.shopDrawSign();}};ls.loadScript('//wq.jd.com/mjgj/column/QueryShopGiftList?callback=shopEnterGiftCB&venderId='+obj.venderId+'&channel='+(isWX?'6':'7')+'&t='+Math.random());};Shop.prototype.shopDrawSign=function(){var obj=this;if(!obj.setShopDraw)return;if(!loginHandler.getLoginStatus()&&$('#shopLinks').hasClass('shop_gift'))return;window.shopDrawSignCB=function(json){if(json&&json.errcode==0&&json.data&&json.data.code==='0'&&json.data.type&&(json.data.type==='0'||json.data.type==='1')&&!$('#shopLinks').hasClass('shop_gift')){var tplObj={'0':{'html':'<i class="icon_shop_gift"></i>','clickPtag':obj.isJDChoice?'7001.4.51':'7001.1.272','exposurePtag':obj.isJDChoice?'7001.4.50':'7001.1.271'},'1':{'html':'<i class="icon_shop_calendar"></i>','clickPtag':obj.isJDChoice?'7001.4.49':'7001.1.270','exposurePtag':obj.isJDChoice?'7001.4.48':'7001.1.269'}},$shopLinks=$('#shopLinks'),$shopInfo=$('#shopInfo'),$shopIcon=$shopInfo.find('[shopIcon="1"]').filter(':visible');if(tplObj[json.data.type]){var data=tplObj[json.data.type];$shopLinks.html(data.html);reporter.reportExposure({ptag:data.exposurePtag});obj.shopUrl=JD.url.addUrlParam(obj.shopUrl,{'ptag':data.clickPtag});if($shopInfo.find('.icon_promote').length<1&&(!$shopIcon.length||(pageWidth-$shopIcon.position().left-$shopIcon.width())>49)){$shopInfo.append('<i class="icon_promote"></i>');}}}};ls.loadScript('//wq.jd.com/mjgj/column/QueryShopSignDraw?callback=shopDrawSignCB&channel=2&venderId='+obj.venderId+'&t='+Math.random());};Shop.prototype.shopFavGift=function(type){var obj=this;if(!obj.setShopDraw)return;if(!type||type==1){window.favShopGiftCB=function(json){if(json&&json.iRet==0&&json.gift&&json.gift.length>0){obj.shopgift={giftList:[],activeId:'',giftId:''};var giftInfo=json.gift.filter(function(s){return s&&s.giftType===0&&s.activeId&&s.giftId&&s.giftLeftState==0&&s.state==1&&((s.dongCoupon&&s.dongCoupon.discount)||(s.jingBean&&s.jingBean.sendCount)||(s.jingCoupon&&s.jingCoupon.discount)||(s.point&&s.point.sendCount));})[0];if(!giftInfo||$('#shopFav').hasClass('favor'))return;obj.shopgift.activeId=giftInfo.activeId;obj.shopgift.giftId=giftInfo.giftId;var giftObj={'jingCoupon':{type:'jingjuan',desc:'{#discount#}'},'dongCoupon':{type:'dongjuan',desc:'{#discount#}'},'jingBean':{type:'jingdou',desc:'{#sendCount#}'},'point':{type:'jifen',desc:'{#sendCount#}'}};for(var type in giftObj){if(giftInfo[type]&&(giftInfo[type].discount||giftInfo[type].sendCount)){var tempObj=giftObj[type]||{};tempObj.desc=tempObj.desc.replace('{#discount#}',giftInfo[type].discount).replace('{#sendCount#}',giftInfo[type].sendCount);obj.shopgift.giftList.push(tempObj);}}
$('#shopFav').addClass('favor_gift').html('<i class="icon_gift"></i>');reporter.reportExposure({ptag:'7515.3.2',venderId:obj.venderId});}};ls.loadScript('//wq.jd.com/fav_snsgift/QueryShopActive?callback=favShopGiftCB&venderId='+obj.venderId+'&t='+Math.random());}else{if(!obj.shopgift)return;window.drawFavShopGiftCB=function(json){var tipObj={'201':'','402':'','badNetWork':'','default':''};if(json&&json.retCode==0){var favDesc='';obj.shopgift.giftList.forEach(function(item){if(item.type=='jifen'){favDesc='&';return false;}});favGiftAlert.showFavGiftAlert({favResult:'',favDesc:favDesc,giftInfo:obj.shopgift.giftList});}else if(json&&tipObj[json.retCode]){favGiftAlert.showFavGiftAlert({favResult:'',favDesc:tipObj[json.retCode]});}else{favGiftAlert.showFavGiftAlert({favResult:'',favDesc:tipObj['default']});}
reporter.reports({ptag:'7515.3.1',venderId:obj.venderId});obj.shopgift.giftList=[];};ls.loadScript({url:'//wq.jd.com/fav_snsgift/GiveShopGift?callback=drawFavShopGiftCB&venderId='+obj.venderId+'&activeId='+obj.shopgift.activeId+'&giftId='+obj.shopgift.giftId+'&t='+Math.random(),onError:function(){showNotice({str:''});}});}};exports.init=function(config){var shop=new Shop();shop.init(config);return shop;};});
;define('jd.item.skuSwitch',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),itemUtil=require('jd.item.util'),util=require('util'),reporter=itemUtil.reporter,popUp=itemUtil.popUp,showNotice=itemUtil.showNotice;var SkuSwitch=function(){var opt={newColorSize:[],salePropSeq:{},saleProp:{},skuId:'',jdSkuIds:[],skuPro:{},disableCanChoose:true,canCancelChoose:true,spuId:'',cmmzName:'',cmmz:''};$.extend(this,opt);};SkuSwitch.prototype.init=function(config){config=config||{};var obj=this,spuChange=false;if(config.spuId&&obj.spuId!==config.spuId)spuChange=true;$.extend(obj,config);if(window._itemInfo)obj.skuPro=window._itemInfo.skuPro||{};obj.setSkuInfoNew();obj.bindEvent();if(spuChange){obj.cmGuide();}};SkuSwitch.prototype.setSkuInfoNew=function(){var obj=this,arr=obj.newColorSize||[],propSeq=obj.salePropSeq||{},saleProp=obj.saleProp||{},propArr=[],propSeqItemArr=[],propItem='';obj.skuPro.name={};obj.skuPro.id={};if(!arr||!arr.length){obj.jdSkuIds.push(obj.skuId);return;}
if(!obj.skuPro.propArr){for(var key in saleProp){if(saleProp.hasOwnProperty(key)&&saleProp[key]){propArr.push(key);}}
propArr.sort();var propName='',propNameArr=[];for(var i=0,leni=propArr.length;i<leni;i++){propItem=propArr[i];propSeqItemArr=(propSeq[propItem]||[]).filter(function(s){return $.trim(s||'');});propSeq[propItem]=propSeqItemArr;if(propSeqItemArr.length>0){propName=saleProp[propItem]||'';if(propName.length>2){propName=propName.replace(/^/,'').substr(0,4);}
propNameArr.push(propName);}else{propArr[i]='';}}
propArr=propArr.filter(function(s){return s!=='';});obj.skuPro.propArr=propArr;obj.skuPro.propSeq=propSeq;obj.skuPro.propName=propNameArr;}else{propArr=obj.skuPro.propArr;propSeq=obj.skuPro.propSeq;}
var arrItem={},nameArr=[],cskuArr=[];for(var i=0,leni=arr.length;i<leni;i++){arrItem=arr[i];nameArr=[];for(var j=0,lenj=propArr.length;j<lenj;j++){nameArr.push(arrItem[propArr[j]]);}
if(nameArr.length>0){obj.jdSkuIds.push(arrItem.skuId);obj.skuPro.name[nameArr.join('~~')]=arrItem.skuId;obj.skuPro.id[arrItem.skuId]=nameArr;if(arrItem.skuId==obj.skuId)cskuArr=nameArr;}}
if(!obj.jdSkuIds.length)obj.jdSkuIds.push(obj.skuId);for(var i=0,leni=propArr.length;i<leni;i++){propItem=propArr[i];for(var j=0,lenj=propSeq[propItem].length;j<lenj;j++){if(cskuArr[i]===$.trim(propSeq[propItem][j]||'')){$('#sku'+(i+1)+' span').eq(j).addClass('option_selected');$('#skuPop'+(i+1)+' span').eq(j).addClass('active');break;}}}
obj.checkSkuListNew();};SkuSwitch.prototype.checkSkuListNew=function(opt){opt=opt||{};var obj=this,skuNo=opt.skuNo,cName=opt.cName,propArr=obj.skuPro.propArr,idPro=obj.skuPro.id,propSeq=obj.skuPro.propSeq,$sku='',$skuPop='',skuDisable='option_disabled',skuPopDisable='over',skuSelect='option_selected',skuPopSelect='active',setDom=function(no,name){var nameRelated=[],passList=obj.carPassList;for(var key in idPro){if(idPro.hasOwnProperty(key)&&idPro[key]&&idPro[key][no-1]){if(idPro[key][no-1]===name){if(passList){nameRelated.push({arr:idPro[key],isCar:(~passList.indexOf(key*1)?0:1)});}else{nameRelated.push({arr:idPro[key]});}}}}
var isRelated=0,saleName='',$skuJ='',$skuPopJ='';for(var i=0,leni=propArr.length;i<leni;i++){if(no-1===i)continue;$sku=$('#sku'+(i+1)+' span');$skuPop=$('#skuPop'+(i+1)+' span');for(var j=0,lenj=propSeq[propArr[i]].length;j<lenj;j++){saleName=propSeq[propArr[i]][j];isRelated=false;for(var k=0,lenk=nameRelated.length;k<lenk;k++){if(nameRelated[k]['arr'][i]===saleName){if(nameRelated[k]['isCar']===1){isRelated=1;}else{isRelated=2;break;}}}
$skuJ=$sku.eq(j);$skuPopJ=$skuPop.eq(j);if(isRelated===2){if($skuJ.attr('dis')!=='1'&&$skuJ.removeClass(skuDisable).attr('dissel')==='1'){$skuJ.addClass(skuSelect).attr('dissel','0');}
if($skuPopJ.attr('dis')!=='1'&&$skuPopJ.removeClass(skuPopDisable).attr('dissel')==='1'){$skuPopJ.addClass(skuPopSelect).attr('dissel','0');}}else if(isRelated===1){if(!$skuJ.hasClass(skuSelect)){$skuJ.addClass(skuDisable).attr('dis','1');}
if(!$skuPopJ.hasClass(skuPopSelect)){$skuPopJ.addClass(skuPopDisable).attr('dis','1');}}else{$skuJ.attr('dis','1');$skuPopJ.attr('dis','1');if($skuJ.addClass(skuDisable).hasClass(skuSelect)){$skuJ.removeClass(skuSelect).attr('dissel','1');}
if($skuPopJ.addClass(skuPopDisable).hasClass(skuPopSelect)){$skuPopJ.removeClass(skuPopSelect).attr('dissel','1');}}}}};$('#propertyDiv span.option').removeClass(skuDisable).attr('dis','0');$('#popupSkuArea span.item').removeClass(skuPopDisable).attr('dis','0');$.publish('item.skuSwitch.checkSkuListNew',[obj.skuPro]);if(skuNo>0&&cName){setDom(skuNo,cName);}
var $domSelect='';for(var i=0,leni=propArr.length;i<leni;i++){if(skuNo-1===i)continue;$sku=$('#sku'+(i+1));$skuPop=$('#skuPop'+(i+1));if($sku.length>0){$domSelect=$sku.find('span.'+skuSelect);}else{$domSelect=$skuPop.find('span.'+skuPopSelect);}
if($domSelect.length>0){setDom(i+1,$domSelect[0].innerHTML);}}};SkuSwitch.prototype.showSkuArea=function(msg){var obj=this;if(!msg&&obj.skuPro.unSelectName&&obj.skuPro.unSelectName.length>0){msg=' '+obj.skuPro.unSelectName.join(' ');}
if(!$('#popupBuyArea').hasClass('show'))popUp.showHidePopup($('#popupBuyArea'),true);showNotice({str:msg||'/'});};SkuSwitch.prototype.bindEvent=function(){var obj=this;$('#propertyDiv,#popupSkuArea').on('click','span',function(){var $target=$(this);if($target.hasClass('option_disabled|over')&&!obj.disableCanChoose)return;if($target.hasClass('active|option_selected')&&!obj.canCancelChoose)return;var cname=$target[0].innerHTML,no=$target.attr('no')||'',spanIndex=$target.index(),emId='sku'+no,popemId='skuPop'+no,$emSpan=$('#'+emId+' span'),$popemSpan=$('#'+popemId+' span'),switchAct=function(){if($target.hasClass('active|option_selected')){$emSpan.eq(spanIndex).removeClass('option_selected');$popemSpan.eq(spanIndex).removeClass('active');obj.checkSkuListNew();}else{if($target.hasClass('option_disabled|over')){showNotice({str:''});}
$emSpan.removeClass('option_selected').attr('dissel','0');$popemSpan.removeClass('active').attr('dissel','0');$emSpan.eq(spanIndex).removeClass('option_disabled').addClass('option_selected');$popemSpan.eq(spanIndex).removeClass('over').addClass('active');obj.checkSkuListNew({skuNo:no,cName:cname});}
var skuWrapId='propertyDiv',selectClass='option_selected';var parentId=$target.parent().attr('id')||'';if(~parentId.indexOf('skuPop')){skuWrapId='popupSkuArea';selectClass='active';reporter.reports({ptag:'7001.11.2'});}
var $selectDom=$('#'+skuWrapId+' span.'+selectClass),outArr=[],selectNo=[],propName=obj.skuPro.propName,unSelectName=[];for(var i=0,leni=$selectDom.length,$selectDomi;i<leni;i++){$selectDomi=$selectDom.eq(i);outArr.push($selectDomi[0].innerHTML);selectNo.push($selectDomi.attr('no'));}
if(propName&&propName.length>0){for(var i=0,leni=propName.length;i<leni;i++){if(selectNo.indexOf(i+1+'')===-1){unSelectName.push(propName[i]);$('#sku'+(i+1)).addClass('color_red');}else{$('#sku'+(i+1)).removeClass('color_red');}}}
obj.skuPro.unSelectName=unSelectName;return outArr;};var skuName=switchAct();var sid='';if(skuName.length>0)sid=obj.skuPro.name[skuName.join('~~')];$.publish('item.skuSwitch.switch',[sid,skuName]);});$('#popupBuyArea').on('click',function(e){var target=e.srcElement||e.target,em=target,i=1;while(em&&!em.id&&i<=4){em=em.parentNode;i++;}
if(!em||!em.id)return;var emId=em.id;if(emId=='popupClose'||emId=='popupBuyArea'){popUp.showHidePopup($('#popupBuyArea'));$('#popupConfirm').attr('tag','0');reporter.reports({ptag:'7001.1.236'});reporter.reports({ptag:'7001.11.3'});$.publish('item.skuSwitch.closePop');}});$('#skuWindow').on('click',function(){popUp.showPopupArea();$.publish('item.skuSwitch.openPop');});$('#popupBuyArea').on('click','#cmGuide',function(){reporter.reports({ptag:'7001.1.64'});location.href='//m.toplife.com/sizeGuide.html?skuId='+obj.skuId+'&productId='+obj.spuId+'&sizeCode='+obj.cmmz;});};SkuSwitch.prototype.cmGuide=function(){var obj=this;obj.cmmzName={3:'',4:'',5:'',6:'',7:'',8:'',9:'',10:'',11:'',12:'',13:'',14:'',15:''}[obj.cmmz];if(!obj.cmmzName){$('#cmmzName, #cmGuide').remove();return;}
var $sku_kind=$('#popupSkuArea .sku_kind');$sku_kind.forEach(function(tar){var $tar=$(tar);if($.trim($tar.html())===''){$tar.html('<span id="cmmzName">'+obj.cmmzName+'</span><span id="cmGuide" class="guide"></span>');reporter.reportExposure({ptag:'7001.1.332'});}});};exports.init=function(config){var skuSwitch=new SkuSwitch();skuSwitch.init(config);return skuSwitch;};});
;define('jd.item.buyNumController',function(require,exports,module){var _cacheThisModule_,$=require('zepto'),ls=require('loadJs'),itemUtil=require('jd.item.util'),showNotice=itemUtil.showNotice,reporter=itemUtil.reporter,isAndroid=$.os&&$.os.android;var BuyNumController=function(){var opt={skuId:'',jdAddrId:[],jdCategory:[],venderId:'',skuName:'',promov2:null,lowestBuy:0,mnum:0,disableChangeBuyNum:false,canOnlyBuyOne:false,hideNumTip:false,$numTip:null,stockNum:-1,buyNum:1,minBuyNum:1,maxBuyNum:200};$.extend(this,opt);};BuyNumController.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.$numTip=$('#popupCount .store');obj.setBuyNumInfo();obj.bindEvent();};BuyNumController.prototype.refresh=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.stockNum=-1;obj.minBuyNum=1;obj.maxBuyNum=200;obj.$numTip.hide();obj.setBuyNumInfo();};BuyNumController.prototype.getRestrictBuyInfo=function(){var obj=this;var promoid='',promotype='',promoprice='',promos=((obj.promov2&&obj.promov2[0]&&obj.promov2[0]['pis'])||[]);for(var i=0;i<promos.length;i++){for(var key in promos[i]){if(key==3){var arr=(promos[i].pid||'').split('_');promoid=arr[0];promotype=arr[1];var customtag={};try{customtag=JSON.parse(promos[i].customtag);}catch(e){}
promoprice=(customtag.p*100)||'';}}}
if(!window.getRestrictBuyInfoCB){window.getRestrictBuyInfoCB=function(data){if(!data||data.errcode!=0||!data.limitbuy)return;if(data.limitbuy.noSaleFlag){JD.events.trigger('item.buyNumController.noSale');}
if(data.limitbuy.promotionText){$('#promoteList .de_tag[tag="3"],#promoteList2 .de_tag[tag="3"],#promoteChoice .de_tag[tag="3"]').siblings('.de_span').find('span').html(data.limitbuy.promotionText);}
if(!obj.canOnlyBuyOne&&data.limitbuy.limitNum&&data.limitbuy.limitNum>0){obj.restrictBuyNum(2,data.limitbuy.limitNum);}};}
ls.loadScript('//wq.jd.com/commodity/jdsbranch/get?callback=getRestrictBuyInfoCB&functionids=10&promoid='+promoid+'&promotype='+promotype+'&promoprice='+promoprice+'&skuid='+obj.skuId+'&skuname='+encodeURIComponent(obj.skuName)+'&area='+obj.jdAddrId.slice(0,4).join('_')+'&cat='+obj.jdCategory.join(',')+'&venderid='+obj.venderId);};BuyNumController.prototype.restrictBuyNum=function(type,num){if(!type||!num||num<0)return;var obj=this;if(type==1){obj.minBuyNum=num;obj.setRestrictBuyInfo();}else if(type==2){obj.maxBuyNum=num;obj.setRestrictBuyInfo();}else if(type==3){obj.minBuyNum=num;obj.maxBuyNum=num;obj.setRestrictBuyInfo();}};BuyNumController.prototype.setNumTip=function(){var obj=this,popStr=[];if(obj.stockNum>0&&obj.stockNum<6)popStr.push(''+obj.stockNum+'');if(obj.minBuyNum>1)popStr.push(obj.minBuyNum+'');if(obj.maxBuyNum==1){popStr.push('1');}else if(obj.maxBuyNum<200){popStr.push(''+obj.maxBuyNum+'');}
if(popStr.length>0){obj.$numTip.html(popStr.join(''));if(!obj.hideNumTip){obj.$numTip.show();}else{obj.$numTip.hide();}}};BuyNumController.prototype.setNumTipHidden=function(){this.hideNumTip=true;this.$numTip.hide();};BuyNumController.prototype.setDisabledBuyNum=function(disabled){if(disabled){$('#minus1').addClass('disable');$('#minusStore').addClass('minus_disabled');$('#plus1').addClass('disable');$('#plusStore').addClass('plus_disabled');$('#buyNum1,#buyNumStore').prop('disabled','true');}else{$('#minus1').removeClass('disable');$('#minusStore').removeClass('minus_disabled');$('#plus1').removeClass('disable');$('#plusStore').removeClass('plus_disabled');$('#buyNum1,#buyNumStore').prop('disabled','');}};BuyNumController.prototype.setRestrictBuyInfo=function(){var obj=this;if(obj.minBuyNum>obj.maxBuyNum){obj.minBuyNum=1;obj.maxBuyNum=200;obj.buyNum=1;obj.$numTip.hide();}
obj.setBuyNum(obj.buyNum);obj.setNumTip();};BuyNumController.prototype.setBuyNumInfo=function(){var obj=this;if(obj.canOnlyBuyOne){obj.minBuyNum=1;obj.maxBuyNum=1;obj.buyNum=1;}else{if(obj.lowestBuy>1&&obj.lowestBuy<200){obj.minBuyNum=obj.lowestBuy;if(obj.buyNum<obj.minBuyNum)obj.buyNum=obj.minBuyNum;}
if(obj.mnum>0){if(obj.mnum>9999)obj.mnum=9999;}else if(obj.jdCategory&&obj.jdCategory[0]==='1713'){obj.mnum=1000;}
if(obj.mnum>0&&obj.maxBuyNum===200)obj.maxBuyNum=obj.mnum;}
obj.getRestrictBuyInfo();obj.setRestrictBuyInfo();if(obj.disableChangeBuyNum)obj.setDisabledBuyNum(true);};BuyNumController.prototype.setBuyNum=function(num,flag){var minNum=this.minBuyNum,maxNum=Math.min(this.maxBuyNum,this.stockNum===-1?this.maxBuyNum:this.stockNum);num=num*1||minNum;var tmp=num;num=Math.max(minNum,num);num=Math.min(maxNum,num);if(minNum>maxNum){num=minNum;}
this.buyNum=num;$('#buyNum1,#buyNumStore').val(num);JD.events.trigger('item.buyNumController.buyNumChange',this.buyNum);var tipStr='';if(minNum>maxNum){tipStr=''+minNum+'~';}else if(tmp<minNum&&minNum>1){tipStr=''+minNum+'~';}else if(tmp>maxNum){if(maxNum==1){tipStr='1';}else{tipStr=''+maxNum+'';}}
if(tipStr&&flag)showNotice({str:tipStr});if(num==minNum){$('#minus1').addClass('disable');$('#minusStore').addClass('minus_disabled');}else{$('#minus1').removeClass('disable');$('#minusStore').removeClass('minus_disabled');}
if(maxNum>num){$('#plus1').removeClass('disable');$('#plusStore').removeClass('plus_disabled');}else{$('#plus1').addClass('disable');$('#plusStore').addClass('plus_disabled');}
if(minNum==maxNum){$('#buyNum1,#buyNumStore').prop('disabled','true');}else{$('#buyNum1,#buyNumStore').prop('disabled','');}};BuyNumController.prototype.bindEvent=function(){var obj=this;$('#buyNum1,#buyNumStore').on({click:function(){if(!isAndroid)setTimeout(function(){$('#btnTools').removeClass('fixed');},200);},input:function(){if(this.value)obj.setBuyNum(this.value,true);},blur:function(){obj.setBuyNum(this.value,true);$('#btnTools').addClass('fixed');setTimeout(function(){var $popupBuyArea=$('#popupBuyArea');$popupBuyArea[0].scrollIntoView&&$popupBuyArea[0].scrollIntoView(true);},200);}});$('#popupBuyArea,#part_store .num_wrap').on('click',function(e){var target=e.srcElement||e.target,em=target,i=1;while(em&&!em.id&&i<=4){em=em.parentNode;i++;}
if(!em||!em.id)return;var $em=$(em),emId=em.id;if(emId=='plus1'||emId=='minus1')reporter.reports({ptag:'7001.11.2'});if($em.hasClass('minus_disabled|disable|plus_disabled'))return;if(emId=='plus1'||emId=='plusStore'){obj.setBuyNum(obj.buyNum+1,true);}
if(emId=='minus1'||emId=='minusStore'){obj.setBuyNum(obj.buyNum-1,true);}});JD.events.listen('item.main.stockNumChange',function(rn){obj.stockNum=rn*1;obj.setNumTip();if(obj.stockNum<obj.buyNum){obj.setBuyNum(obj.stockNum);}});};exports.init=function(config){var buyNumController=new BuyNumController();buyNumController.init(config);return buyNumController;};});
;define('formatJson',function(require,exports,module){var _cacheThisModule_;var _formatJson_cache={};$formatJson=function(str,data){var fn=!/\W/.test(str)?_formatJson_cache[str]=_formatJson_cache[str]||$formatJson(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join(String.fromCharCode(9)).replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split(String.fromCharCode(9)).join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return data?fn(data):fn;}
exports.formatJson=$formatJson;});
;define('wg.giftpool.component',function(require,exports,module){var $=require('zepto'),mFJ=require('formatJson'),_isM=/(\.|^)m\.jd\.com/.test(location.host)||/[?&]sceneval=2/.test(location.search),oldSelectGift=[],hadChooseNum=0,opt={domId:'',good:{},listGiftPools:[],giftPoolType:'',pageTitle:'',tipTitle:'',addCb:function(){}};var comGiftPoolObj={init:function(obj){if(!obj.domId||!obj.good||!obj.listGiftPools||!obj.listGiftPools.length){console.warn('');return;}
if(!$('#giftPoolPageTmpl').length){console.warn('');return;}
opt=$.extend(opt,obj);document.title=opt.pageTitle||'';html=mFJ.formatJson($('#giftPoolPageTmpl').html(),{good:opt.good,tipTitle:opt.tipTitle,listGiftPools:opt.listGiftPools,giftPoolType:opt.giftPoolType,isM:_isM});$('#'+opt.domId).html(html);this.calAndRenderFixBar(opt.listGiftPools,opt.giftPoolType);var selectedGiftObj=this.getSelectGift();oldSelectGift=selectedGiftObj&&selectedGiftObj.selectGiftArr||[];this.bindEvent();},calAndRenderFixBar:function(listGiftPools,giftPoolType){hadChooseNum=0;if(giftPoolType==28){listGiftPools&&listGiftPools.forEach(function(el){el.skus&&el.skus.forEach(function(gift){if(gift.selectState==2){hadChooseNum+=gift.num*1;}})})
this.changeFixbarNum();$('#modGiftPoolDom .swap_btm').show();}},changeFixbarNum:function(){var remainNum=opt.good.num-hadChooseNum;$('.swap_btm_content .hadChoose').html(hadChooseNum);$('.swap_btm_content .elseCanChoose').html(remainNum);},bindEvent:function(){var that=this;$('#modGiftPoolDom').off().on('click',function(event){event.preventDefault();event.stopPropagation();var dSrc=$(event.target),sAttr=dSrc.attr('attr-tag');switch(sAttr){case'jumpToHref':that.jumpToHref(dSrc);break;case'giftIconSelect':that.bindCheck(dSrc);break;case'giftSureToAdd':that.bindSureToAdd(dSrc);break;}})
this.bindModifyNum($('#modGiftPoolDom'),'.num_wrap_v2');},bindModifyNum:function($fdom,childSelector){var that=this;$fdom.on('blur',childSelector,function(e){e.preventDefault();e.stopPropagation();var $ipt=$(this).find('input.text'),value=$ipt.val()*1,prevalue=$ipt.attr('prevalue')*1,$gift=$(this).parents('.gift'),isSelected=$gift.find('.gift_icon_select').hasClass('selected');value=value>0?parseInt(value):1;if(isSelected){if(hadChooseNum-prevalue+value<=opt.good.num){hadChooseNum=hadChooseNum-prevalue+value;that.iptModify($ipt,$gift,value,true);}else{$ipt.val(prevalue);showNotice(''+opt.good.num+'')}}else{that.iptModify($ipt,$gift,value);}}).on('focus',childSelector,function(e){e.preventDefault();e.stopPropagation();}).on('keypress',childSelector,function(e){if(e&&e.keyCode==13){$(this).blur();}});this.bindPlusMinusEve(childSelector);},bindPlusMinusEve:function(childSelector){var that=this;var _checkClick=function(dSrc,isPlus){var $gift=dSrc.parents('.gift');$ipt=$gift.find('input'),isSelected=$gift.find('.gift_icon_select').hasClass('selected'),value=$ipt.val()*1;if(dSrc.hasClass('disabled')){return;}
if(isPlus){if(isSelected){if(hadChooseNum+1<=opt.good.num){hadChooseNum+=1;dSrc.siblings('.minus').removeClass('disabled');that.iptModify($ipt,$gift,value+1,true);}else{showNotice(''+opt.good.num+'');}}else{dSrc.siblings('.minus').removeClass('disabled');that.iptModify($ipt,$gift,value+1);}}else{if(value<=1){dSrc.addClass('disabled');}else{if(isSelected){hadChooseNum-=1;that.iptModify($ipt,$gift,value-1,true);}else{that.iptModify($ipt,$gift,value-1);}}}}
$(childSelector).on('click','.minus',function(){_checkClick($(this),false);});$(childSelector).on('click','.plus',function(){_checkClick($(this),true);})},iptModify:function($ipt,$gift,value,isSelected){$ipt.val(value);$ipt.attr('prevalue',value);$gift.attr('num',value);isSelected&&this.changeFixbarNum();},bindCheck:function(dSrc){if(!dSrc.hasClass('gift_icon_select')){dSrc=dSrc.closest('.gift').find('.gift_icon_select');}
if(opt.giftPoolType==28){var $gift=dSrc.parents('.gift');var num=$gift.attr('num')*1;if($(dSrc).hasClass('selected')){$(dSrc).removeClass('selected');hadChooseNum-=num;this.changeFixbarNum();}else{if(hadChooseNum+num<=opt.good.num){hadChooseNum+=num;this.changeFixbarNum();$(dSrc).addClass('selected');}else{showNotice(''+opt.good.num+'')}}}else{var pool=dSrc.parents('.main');var giftSib=pool.find('.gift');giftSib.forEach(function(ele){$(ele).find('.gift_icon_select').removeClass('selected');})
$(dSrc).addClass('selected');}},jumpToHref:function(dSrc){var $image=dSrc.parents('.gifts').find('.image');href=$image&&$image.attr('attr-href');if(href){location.href=href;}},checkGiftArrChange:function(newGiftArr,oldGiftArr){if(newGiftArr.length!=oldGiftArr.length){return true;}
var newGiftObj={};var oldGiftObj={};newGiftArr.forEach(function(el){newGiftObj[el.giftId]=el.num;})
oldGiftArr.forEach(function(el){oldGiftObj[el.giftId]=el.num;})
for(var giftId in newGiftObj){if(newGiftObj[giftId]!=oldGiftObj[giftId]){return true;}}
return false;},getSelectGift:function(){var selectGiftArr=[];var hadChooseNum=0;$('.gift_icon_select.selected').forEach(function(ele){var $gift=$(ele).parents('.gift'),giftId=$gift.attr('giftId'),num=$gift.attr('num');selectGiftArr.push({giftId:giftId,num:num*1});hadChooseNum+=num*1;})
return{selectGiftArr:selectGiftArr,hadChooseNum:hadChooseNum};},bindSureToAdd:function(){var selectedGiftObj=this.getSelectGift();if(opt.giftPoolType==28&&selectedGiftObj.hadChooseNum!=opt.good.num){showNotice(''+opt.good.num+'');return;}
newSelectGift=selectedGiftObj.selectGiftArr;var isChange=this.checkGiftArrChange(newSelectGift,oldSelectGift);var param={giftData:newSelectGift,hadChange:isChange};typeof opt.addCb=='function'&&opt.addCb(param);history.back();}}
function showNotice(str,t){if(!str)return;t=t?t:2000;$('#giftPoolNotice p').html(str);$('#giftPoolNotice').addClass('show');setTimeout(function(){$('#giftPoolNotice').removeClass('show');},t);};exports.init=function(opt){comGiftPoolObj.init(opt);};})
;define('jd.item.promotion',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),cache=require('cachev1'),ls=require('loadJs'),itemComm=require('wq.item.common'),util=require('util'),loginHandler=require('jd.item.loginHandler'),comGiftPoolObj=require('wg.giftpool.component'),userInfo=require('jd.item.user'),getUserLevel=userInfo.getUserLevel,itemUtil=require('jd.item.util'),formatTime=itemUtil.formatTime,$jsonToTpl=itemUtil.$jsonToTpl,popUp=itemUtil.popUp,getAppWebviewUrl=itemUtil.getAppWebviewUrl,reporter=itemUtil.reporter,isWX=util.isWX(),pageWidth=$(window).width();var Promotion=function(){var opt={isMScene:false,version:1,isJDChoice:false,is9669order:false,isAd:false,isAd2:false,isPrescribeDrug:false,skuId:'',skuName:'',jdPrice:0,firstImg:'',buyNum:0,displayQQMemPrice:false,promov2:[],bankpromo:{},priceExt:{},plusFlag:'',iconHtml:'',promoteTag10:0,giftFlag:0,giftPool:{},giftData:[],isGiftPool:false,giftPoolType:'',promoteTags:[],showPhoneCard:false,limitWhiteObj:null,limitBlackObj:null,hideSalePromoteJump:false,hideOtherPromoteJump:false,isPingouScene:false,isPingouShop:false,hidePromotion:false,outTags:[],isJxChannel:false,duoDanFan:{}};$.extend(this,opt);};Promotion.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.version===1?obj.showPromotion():obj.showPromotion2();obj.bindEvent();};Promotion.prototype.refresh=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.iconHtml='';obj.promoteTag10=0;obj.giftFlag=0;obj.giftPool={};obj.giftData=[];obj.isGiftPool=false;obj.promoteTags=[];$('#promotePanel,#giftPool,#giftPool2').hide();$('#discountFloor').find('.dicount_plus,.detail_prom').hide();$('#discountPopup').find('.floor_plus').hide();$('#qqMemBar').attr('qqmemprice',0).hide();if(obj.hidePromotion)return;obj.version===1?obj.showPromotion():obj.showPromotion2();};Promotion.prototype.appendIconHtml=function(html){this.iconHtml+=(html||'');};Promotion.prototype.showPromotion=function(){var obj=this,priceProm={},jsonData={},htmlArr=[],nomalTpl=['<div tourl="{#link#}" class="de_row prom_item {#itemClass#}" promotionid="{#promotionId#}" id="{#domId#}">','<div class="de_tag" tag="{#tag#}">','    {#emRedBg#}','</div>','<div class="de_span">','     {#emSpan#}','</div>','    {#emPoint#}','</div>'].join(''),promoteTpl=nomalTpl,iconHtml='',promoteChoiceArr=[],nomalChoiceTpl=['<div tourl="{#link#}" class="de_row prom_item {#itemClass#}" promotionid="{#promotionId#}" id="{#domId#}">','<div class="de_tag" tag="{#tag#}">','<em class="hl_gold_bg">{#title#}</em>{#subTag#}','</div>','<div class="de_span">','{#emSpan#}','</div>{#emPoint#}','</div>'].join(''),promoteChoiceTpl=nomalChoiceTpl;window.promotionCB=function(json,bankpromo,priceProm){var promTip={'1':'','2':'','3':'','4':'','6':'','7':'','9':'','10':'','11':'','15':'','16':'','17':'','18':'','19':'','20':'','21':'','22':'QQ','23':'','36':'','60':'','80':'PLUS','1001':'PLUS','1002':'PLUS'},promTags=obj.isMScene?['1','2','3','4','6','7','9','10','11','15','16','17','18','19','20','21','23','29','36','60','80','1001','1002']:['1','2','3','4','6','7','9','10','11','15','16','17','18','19','20','21','22','23','29','36','60','80','1001','1002'],promos=((json&&json[0]&&json[0]['pis'])||[]),item={},itemContent={},tagTypes=[],content='',conArr=[],tag='',pid=[],tagName='',promotionId=[],itemEtg='',customtag={},isNeedPre=false,isNeedPoint=false,$promote=$('#promoteList'),fullFreeTimes=0,blockPlusConfine=false,getFullFreeUrl=function(){if(fullFreeTimes>0)return;fullFreeTimes++;window.showPageData28048=function(json){var data=json.data,iitem={},jitem={},promoItem={},nowTime=new Date().getTime();if(!data.length)return;for(var i=0,leni=data.length;i<leni;i++){iitem=data[i];if(!iitem||!iitem.id)continue;promoItem=promotionId.filter(function(item){return item.promotionId==iitem.id})[0];if(!promoItem)continue;var $dom=$promote.find('[promotionid="'+iitem.id+'"]');if(promoItem.flag==2){jitem=iitem.list.filter(function(item){return~item.env.indexOf(isWX?'1':'2')&&(nowTime>new Date(item.bdate).getTime()&&nowTime<new Date(item.edate));})[0];if(jitem&&jitem.desc){obj.iconHtml=obj.iconHtml.replace('','');$dom.find('em.hl_red_bg').html('');$dom.find('div.de_span').html('<span>'+iitem.list[0].desc+'</span>');}}else{jitem=iitem.list.filter(function(item){return~item.env.indexOf(isWX?'1':'2')&&(nowTime>new Date(item.bdate).getTime()&&nowTime<new Date(item.edate));})[0];if(jitem&&jitem.url){$dom.attr('tourl',jitem.url);}}}};ls.loadScript('//wq.360buyimg.com/data/ppms/js/ppms.pagev28048.jsonp?t='+Math.random());},str2json=function(str){if(!str)return false;try{var outObj=JSON.parse(str.replace('\t',''));return outObj;}catch(e){return false;}},getAdUrl=function(url,ptag){var adUrl='';if(window._itemGlobal&&window._itemGlobal.adGray){try{adUrl=itemComm.adverTransfer((url||'').replace(/\s/g,''),true,ptag);}catch(e){}}
return adUrl;};for(var i=0;i<promos.length;i++){item=promos[i];itemEtg=(item.etg||'').split(',');customtag=item.customtag&&JSON.parse(item.customtag)||{};if(~itemEtg.indexOf('11'))continue;tagTypes=[];for(var key in item){if(promTags.indexOf(key)>-1){tagTypes.push(key);}}
pid=(item.pid||'').split('_');if(pid[1]=='10')obj.promoteTag10++;for(var j=0;j<tagTypes.length;j++){isNeedPre=false;isNeedPoint=false;tag=tagTypes[j];if(obj.isAd&&(~' 15 23 36 '.indexOf(' '+tag+' ')&&~itemEtg.indexOf(({'15':'4','23':'9','36':'14'})[tag])))continue;if(obj.isAd&&~' 15 19 '.indexOf(' '+tag+' ')&&(~itemEtg.indexOf('25')||~itemEtg.indexOf('26')||~itemEtg.indexOf('27')))continue;if(obj.isPrescribeDrug&&(tag==='10'||tag==='18'||tag==='80'))continue;var isSalePromote=!!~['15','16','17','18','19','23','36','60'].indexOf(tag);try{var subextinfo=JSON.parse(item.subextinfo||'{}');}catch(e){}
var subExtType=subextinfo&&subextinfo.subExtType&&subextinfo.subExtType.toString()||'';if(obj.limitWhiteObj){if(!obj.limitWhiteObj[tag]||(obj.limitWhiteObj[tag]!='all'&&!~(obj.limitWhiteObj[tag].split(',')).indexOf(subExtType))){continue;}}
if(obj.limitBlackObj){if(obj.limitBlackObj[tag]&&(obj.limitBlackObj[tag]=='all'||~(obj.limitBlackObj[tag].split(',')).indexOf(subExtType))){continue;}}
if((obj.hideSalePromoteJump&&isSalePromote)||(obj.hideOtherPromoteJump&&!isSalePromote)){promoteChoiceTpl=nomalChoiceTpl.replace('{#link#}','').replace('{#emPoint#}','');promoteTpl=promoteTpl.replace('{#link#}','').replace('{#emPoint#}','');}else{promoteChoiceTpl=nomalChoiceTpl;promoteTpl=nomalTpl;}
tagName=promTip[tag];content=(item[tag]||'').replace(/(\.00|\.0[^\d])/g,'');conArr=(content.indexOf('!@@!')>-1?content.split('!@@!'):[]);jsonData={};jsonData.tag=tag;jsonData.promotionId=pid[0]||'0';jsonData.itemClass='';switch(tag){case'1':if(conArr.length>0){var isVip=(~itemEtg.indexOf('16'));if(loginHandler.getLoginStatus()){if(json[0].hit=='1'){content=''+getUserLevel((~' 5001 5002 5003 5004 5005 '.indexOf(' '+conArr[0]+' ')?json[0].vl*1:(~' 6010 6020 '.indexOf(' '+conArr[0]+' ')?json[0].pl*1:json[0].jl*1))||conArr[0]*1).replace('PLUS','PLUS')+''+(isVip?'':'')+'&yen;'+conArr[1];if(isVip&&(conArr[0]=='50'||conArr[0]=='59')){tagName='';content='&yen;'+conArr[1];}}else{content=(isVip?'':''+getUserLevel(conArr[0]*1)+''+'&yen;'+conArr[1]+'');}}else{content=(isVip?' ':getUserLevel(conArr[0]*1)+''+'&yen;'+conArr[1]+'');}}else{content='';}
if(~content.indexOf('PLUS'))content='';break;case'10':case'80':var contentInfo=str2json(conArr.length>0?conArr[0]:content),isPg=tag==80,hlclass=isPg?'hl_gold_bg':'hl_red_bg';if(!contentInfo||!contentInfo.length){content='';break;}
obj.giftFlag|=(isPg?2:1);if(tag=='10'&&customtag['2']){tagName='';}
var setHtml=function(jsonData,tagName,content){jsonData.link=jsonData.link||'';jsonData.emPoint='';jsonData.domId=(tag==10&&(tagName==''||tagName==''))?'goodGift':'';jsonData.emSpan=jsonData.emSpan||'<span>'+content+'</span >';var tempTpl=promoteTpl;if(obj.isJDChoice){tempTpl=promoteChoiceTpl;promoteChoiceArr.push({title:tagName,desc:content});jsonData.title=tagName;}else{iconHtml+=' <em class="'+hlclass+'">'+tagName+'</em>';jsonData.emRedBg='<em class="'+hlclass+'">'+tagName+'</em>';}
if(isPg){tempTpl+='<div class="prom_item plus_prom" style="display:none;"><div class="de_span"><span>PLUS</span></div><div class="de_point"><i class="icon_point"></i></div></div>';}
htmlArr.push(itemComm.jsonToTpl(jsonData,tempTpl));};var giftArr=[],giftData={},giftHtml=[],giftPopHtml=[],giftMoreNum=(pageWidth>374?4:3),giftKey='detail_promote_B_main '+obj.skuId+i+j+'-1';giftArr=contentInfo.filter(function(a){return a&&a.gt=='2'&&a.num>0;});var giftNum=giftArr.length,giftHtmlStr='',giftTpl='<div class="img {#moreClass#}" tag="{#tag#}" title="'+(tagName==''?'':'')+'"><img src="{#giftImg#}" alt="">{#numStr#}</div>',giftInfoTpl='<div class="info"><div class="name">{#giftName#}</div><div class="desc">x {#num#}</div></div><div class="de_point"><i class="icon_point"></i></div>';if(giftNum>0){for(var k=0;k<giftNum;k++){itemContent=giftArr[k];giftData.link=obj.isMScene?'//item.m.jd.com/product/'+itemContent.sid+'.html?ptag=7001.1.52':'//wqitem.jd.com/item/view?ptag=7001.1.52&sku='+itemContent.sid;giftData.giftImg=itemContent.mp?'//img13.360buyimg.com/n4/'+itemContent.mp:'//img20.360buyimg.com/jdphoto/jfs/t7558/171/659017679/3593/ceaac071/59958e76Nca6b9c33.png';giftData.giftName=itemContent.nm;giftData.num=itemContent.num;giftData.numStr='';giftData.moreClass='';giftData.tag='';if(giftNum==1){giftHtmlStr=itemComm.jsonToTpl(giftData,'<div class="de_pm_list" tourl={#link#}><div class="item">'+giftTpl+giftInfoTpl+'</div></div>');}else{giftData.tag=giftKey;if(giftData.num>1)giftData.numStr='<span class="gift_num">x '+giftData.num+'</span>';if(k==giftMoreNum)giftData.moreClass='for_more';if(k<giftMoreNum+1)giftHtml.push(itemComm.jsonToTpl(giftData,giftTpl));giftData.moreClass='';giftData.numStr='';giftPopHtml.push(itemComm.jsonToTpl(giftData,'<div class="de_pm_list" tourl="{#link#}"><div class="item">'+giftTpl+giftInfoTpl+'</div></div>'));}}
if(giftNum>1){popUp.setPopupBody(giftKey,'<div class="detail_prom">'+giftPopHtml.join('')+'</div>');giftHtmlStr='<div class="de_pm_list"><div class="item">'+giftHtml.join('')+'</div></div>';}
if(isPg){content=(conArr.length>1?conArr.slice(1).join('').replace(/\(|\|\)|\/g,''):'PLUS');jsonData.emSpan='<div class="prom_flex_box"><span>'+content+'</span></div>'+giftHtmlStr+'<div class="de_desc" mark="plusgd" style="display:none;">PLUSPLUS</div>';}else{content=(conArr.length>1?conArr.slice(1).join(''):'');jsonData.emSpan='<div class="prom_flex_box"><span>'+content+'</span></div>'+giftHtmlStr;content=''+content;}
setHtml(jsonData,tagName,content);}
var attachmentArr=[],attachmentData={},attachmentHtml=[],attachmentPopHtml=[],attachmentMoreNum=(pageWidth>374?4:3),attachmentKey='detail_promote_B_main '+obj.skuId+i+j+'-2';attachmentArr=contentInfo.filter(function(a){return a&&a.gt=='1'&&a.num>0&&a.ss=='1';});var attachmentNum=attachmentArr.length,attachmentHtmlStr='',attachmentTpl='<div class="img {#moreClass#}" tag="{#tag#}" title=""><img src="{#attachmentImg#}" alt="">{#numStr#}</div>',attachmentInfoTpl='<div class="info"><div class="name">{#attachmentName#}</div><div class="desc">x {#num#}</div></div><div class="de_point"><i class="icon_point"></i></div>';if(attachmentNum>0){for(var k=0;k<attachmentNum;k++){itemContent=attachmentArr[k];attachmentData.link=obj.isMScene?'//item.m.jd.com/product/'+itemContent.sid+'.html':'//wqitem.jd.com/item/view?sku='+itemContent.sid;attachmentData.attachmentImg=itemContent.mp?'//img13.360buyimg.com/n4/'+itemContent.mp:'//img13.360buyimg.com/jdphoto/jfs/t7288/113/649307008/3531/9e3b3408/59958e5eNcf9ab359.png';attachmentData.attachmentName=itemContent.nm;attachmentData.num=itemContent.num;attachmentData.numStr='';attachmentData.moreClass='';attachmentData.tag='';if(attachmentNum==1){attachmentHtmlStr=itemComm.jsonToTpl(attachmentData,'<div class="de_pm_list" tourl={#link#}><div class="item">'+attachmentTpl+attachmentInfoTpl+'</div></div>');}else{attachmentData.tag=attachmentKey;if(attachmentData.num>1)attachmentData.numStr='<span class="attachment_num">x '+attachmentData.num+'</span>';if(k==attachmentMoreNum)attachmentData.moreClass='for_more';if(k<attachmentMoreNum+1)attachmentHtml.push(itemComm.jsonToTpl(attachmentData,attachmentTpl));attachmentData.moreClass='';attachmentData.numStr='';attachmentPopHtml.push(itemComm.jsonToTpl(attachmentData,'<div class="de_pm_list" tourl="{#link#}"><div class="item">'+attachmentTpl+attachmentInfoTpl+'</div></div>'));}}
if(attachmentNum>1){popUp.setPopupBody(attachmentKey,'<div class="detail_prom">'+attachmentPopHtml.join('')+'</div>');attachmentHtmlStr='<div class="de_pm_list"><div class="item">'+attachmentHtml.join('')+'</div></div>';}
content='';jsonData.emSpan='<div class="prom_flex_box"><span>'+content+'</span></div>'+attachmentHtmlStr;setHtml(jsonData,'',content);}
content='';break;case'15':case'23':case'36':case'19':var nowTime=new Date().getTime(),isKuaDianPu=false;if(~itemEtg.indexOf(({'15':'4','23':'9','36':'14'})[tag])){tagName=({'15':'','23':'','36':''})[tag];isKuaDianPu=true;}
if((tag=='15'||tag=='19')){if(~itemEtg.indexOf('25')){tagName=(item['st']*1000<nowTime&&customtag.mli)?customtag.mli:'/';isKuaDianPu=true;}
if(~itemEtg.indexOf('26')){tagName=(item['st']*1000<nowTime&&customtag.mli)?customtag.mli:'/';isKuaDianPu=true;}
if(~itemEtg.indexOf('27')){tagName=(item['st']*1000<nowTime&&customtag.mli)?customtag.mli:'/';isKuaDianPu=true;}}
if(isKuaDianPu){if(item['st']*1000<nowTime){jsonData.emRedBg='<em class="hl_red_bg">'+tagName+'</em>'+'<span class="sub_tag red"></span>';jsonData.subTag='<span class="sub_tag red"></span>';}else{var stTime=formatTime(new Date(item['st']*1000));content=stTime.month+''+stTime.day+''+stTime.hour+':'+stTime.min+''+tagName+''+content;jsonData.emRedBg='<em class="hl_red_bg">'+tagName+'</em>'+'<span class="sub_tag blue"></span>';jsonData.subTag='<span class="sub_tag blue"></span>';}
isNeedPre=true;jsonData.link=getAdUrl(item.adurl,'37287.6.2');jsonData.itemClass='higher_de_tag';promotionId.push({promotionId:pid[0]});}
isNeedPoint=true;break;case'22':if(obj.displayQQMemPrice)obj.showQQMemPrice((content||'').replace(/|/,''));content='';break;case'16':case'17':case'18':if(tag=='17'){promotionId.push({promotionId:pid[0],flag:2});}
isNeedPoint=true;break;case'29':content=str2json(conArr.length>0?conArr[0]:content);if(!content||!content.length){content='';break;}
obj.giftPool=[];var poolIndex={};obj.giftPoolGetInfoBySku={};for(var k=0,lenk=content.length;k<lenk;k++){itemContent=content[k]||{};if(!itemContent.pno||itemContent.gt!='2')continue;if(itemContent.mp){itemContent.image=JD.img.getImgUrl('//img13.360buyimg.com/n5/'+itemContent.mp);itemContent.imgBig=JD.img.getImgUrl('//img13.360buyimg.com/n3/'+itemContent.mp);}else{itemContent.image='//misc.360buyimg.com/product/skin/2012/i/gift.png';itemContent.imgBig='//misc.360buyimg.com/product/skin/2012/i/gift.png';}
if(!poolIndex[itemContent.pno]&&poolIndex[itemContent.pno]!==0){obj.giftPool.push({PoolNo:itemContent.pno,PoolName:itemContent.poolName,skus:[{id:itemContent.sid,name:itemContent.nm,image:itemContent.mp,num:itemContent.num,selectState:2}]});poolIndex[itemContent.pno]=obj.giftPool.length-1;obj.giftData.push({giftId:itemContent.sid,num:itemContent.num});itemContent.poolIndex=poolIndex[itemContent.pno];itemContent.skuIndex=0;}else{obj.giftPool[(poolIndex[itemContent.pno])].skus.push({id:itemContent.sid,name:itemContent.nm,image:itemContent.mp,num:itemContent.num,selectState:1});itemContent.poolIndex=poolIndex[itemContent.pno];itemContent.skuIndex=obj.giftPool[(poolIndex[itemContent.pno])].skus.length-1;}
obj.giftPoolGetInfoBySku[itemContent.sid]=itemContent;}
obj.giftPoolType=(customtag&&customtag.ifg=='1')?'28':'';obj.isGiftPool=true;obj.showGiftPool();content='';break;case'60':if(pid[0]){jsonData.link='//wqs.jd.com/item/add_buy.shtml?ptag=7014.19.9&activity_id='+pid[0]+'&sku='+obj.skuId;reporter.reports({ptag:'7014.19.8'});}
break;case'3':if(priceProm&&priceProm.PLUS&&priceProm.PLUS.limit_text){content='PLUS'+content;}
break;case'9':if(content.indexOf('')===-1){blockPlusConfine=true;}
break;default:break;}
if(content.indexOf('')===-1&&!obj.isAd2){jsonData.link=jsonData.link||'';jsonData.emPoint='';if((isNeedPoint&&pid[0])||jsonData.link){jsonData.link=jsonData.link||(obj.isMScene?('//so.m.jd.com/list/itemSearch.action?ptag=37287.6.3&promotion_aggregation=yes&activityId='+pid[0]+'&skuId='+obj.skuId+'&pro_d='+(encodeURIComponent(tagName))+'&pro_s='+(encodeURIComponent(content))):('//wqsou.jd.com/coprsearch/prsearch?ptag=37287.6.3&promotion_aggregation=yes&activity_id='+pid[0]+'&pro_d='+(tag=='16'?'':encodeURIComponent(tagName))+'&pro_s='+(encodeURIComponent(content))));jsonData.emPoint='<div class="de_point"><i class="icon_point"></i></div>';}
jsonData.emSpan=jsonData.emSpan||'<span>'+content+'</span >';if(obj.isJDChoice){promoteChoiceArr.push({title:tagName,desc:content});jsonData.title=tagName;htmlArr.push(itemComm.jsonToTpl(jsonData,promoteChoiceTpl));}else{if(isNeedPre){iconHtml='<em class="hl_red_bg">'+tagName+'</em> '+iconHtml;}else{iconHtml+=' <em class="hl_red_bg">'+tagName+'</em>';}
jsonData.emRedBg=jsonData.emRedBg||'<em class="hl_red_bg">'+tagName+'</em>';htmlArr.push(itemComm.jsonToTpl(jsonData,promoteTpl));}}}}
if(priceProm&&priceProm.PLUS){var plusPriceProm=priceProm.PLUS;var tag='';jsonData={};if(plusPriceProm.limit_text&&(!obj.limitWhiteObj||obj.limitWhiteObj['1001'])&&!(obj.limitBlackObj&&obj.limitBlackObj['1001'])){tag='1001';var hlclass='hl_gold_bg',tagName=promTip[tag],content=plusPriceProm.limit_text;jsonData.hlclass=hlclass;jsonData.emSpan='<span>'+content+'</span >';if(obj.isJDChoice){promoteChoiceArr.push({title:tagName,desc:content});jsonData.title=tagName;htmlArr.push(itemComm.jsonToTpl(jsonData,promoteChoiceTpl));}else{iconHtml+=' <em class="'+hlclass+'">'+tagName+'</em>';jsonData.emRedBg='<em class="'+hlclass+'">'+tagName+'</em>';htmlArr.push(itemComm.jsonToTpl(jsonData,promoteTpl));}}
if(!blockPlusConfine&&plusPriceProm.confine_text&&(!obj.limitWhiteObj||obj.limitWhiteObj['1002'])&&!(obj.limitBlackObj&&obj.limitBlackObj['1002'])){tag='1002';var hlclass='hl_gold_bg',tagName=promTip[tag],content=plusPriceProm.confine_text;jsonData.hlclass=hlclass;jsonData.emSpan='<span>'+content+'</span >';if(obj.isJDChoice){promoteChoiceArr.push({title:tagName,desc:content});jsonData.title=tagName;htmlArr.push(itemComm.jsonToTpl(jsonData,promoteChoiceTpl));}else{iconHtml+=' <em class="'+hlclass+'">'+tagName+'</em>';jsonData.emRedBg='<em class="'+hlclass+'">'+tagName+'</em>';htmlArr.push(itemComm.jsonToTpl(jsonData,promoteTpl));}}}
if(bankpromo&&bankpromo.title&&!obj.isAd2){jsonData.link=getAdUrl(bankpromo.actUrl,'37287.6.3');if(!jsonData.link&&bankpromo.activityId){jsonData.link='//wqsou.jd.com/coprsearch/prsearch?ptag=37287.6.6&rebate_id='+bankpromo.activityId;}
if(jsonData.link){jsonData.emPoint='<div class="de_point"><i class="icon_point"></i></div>';}else{jsonData.emPoint='';}
jsonData.emRedBg='<em class="hl_red_bg"></em>';jsonData.emSpan='<span>'+bankpromo.title+'</span >';iconHtml+=' <em class="hl_red_bg"></em>';if(obj.isJDChoice){promoteChoiceArr.push({title:'',desc:bankpromo.title});jsonData.title='';jsonData.desc=bankpromo.title;htmlArr.push(itemComm.jsonToTpl(jsonData,promoteChoiceTpl));}else{htmlArr.push(itemComm.jsonToTpl(jsonData,promoteTpl));}}
if(obj.showPhoneCard){iconHtml+=' <em class="hl_red_bg"></em>';promoteChoiceArr.push({title:'',desc:''});htmlArr.push(itemComm.jsonToTpl({domId:'phoneCardPromote',emPoint:obj.hideOtherPromoteJump?'':'<div class="de_point"><i class="icon_point"></i></div>',emRedBg:'<em class="hl_red_bg"></em>',hlClass:obj.isJDChoice?'hl_gold_bg':'hl_red_bg',title:'',itemClass:'',link:'',emSpan:'<div class="de_span"><span></span></div>'},obj.isJDChoice?promoteChoiceTpl:promoteTpl));}
if(htmlArr.length>0){obj.iconHtml+=iconHtml;$promote.html(htmlArr.join('')).show().off().on('click','.prom_item.de_row,.de_pm_list,.item',function(){var $this=$(this),urlReg=/^(https*:){0,1}\/\//,tourl=$this.attr('tourl');if(!tourl&&$this.hasClass('item')){tourl=$this.parent('.de_pm_list').attr('tourl');}
if(tourl&&urlReg.test(tourl)){if(obj.isJxChannel&&(/^(https*:){0,1}\/\/wqsou\.jd\.com\/coprsearch\/prsearch/.test(tourl)||/^(https*:){0,1}\/\/wqs\.jd\.com\/item\/add_buy.shtml/.test(tourl))){if(obj.isPingouShop){tourl=JD.url.addUrlParam(tourl,{filt_type:'productext2,b40v1'});}else{tourl=JD.url.addUrlParam(tourl,{filt_type:'productext2,b40v0'});}}
window.location.href=getAppWebviewUrl(tourl);}}).on('click','div.img',function(){var $this=$(this),tag=$this.attr('tag'),title=$this.attr('title');if(tag&&popUp.popupBody[tag]&&title){if(obj.isJDChoice){popUp.showHidePopup($('#promotePopup'));}
popUp.createPopDom({isSku:true,isPresent:true,className:tag,title:title,body:popUp.popupBody[tag]});}});if(htmlArr.length==1&&!obj.isPingouScene){$('#promoteDiv').hide();}
if(promotionId.length>0){getFullFreeUrl();}
reporter.reportExposure({ptag:'7001.1.158'});}else{$promote.hide();}
obj.choicePromote(promoteChoiceArr);};try{priceProm=JSON.parse(obj.priceExt);}catch(e){}
if((obj.promov2&&obj.promov2[0]&&obj.promov2[0]['pis'])||(obj.bankpromo&&obj.bankpromo.title)||(priceProm&&priceProm.PLUS)){itemUtil.setDelayTime();window.promotionCB(obj.promov2,obj.bankpromo,priceProm);if(!obj.isJDChoice)obj.setPromoteTitle(2);}else if(obj.isPingouScene){obj.pingouPromote([]);}};Promotion.prototype.showPromotion2=function(){var obj=this,priceProm={},jsonData={},htmlArr=[],htmlObjs=[],nomalTpl=['<div tourl="{#link#}" class="de_row prom_item {#itemClass#}" promotionid="{#promotionId#}" id="{#domId#}">','<div class="de_tag" tag="{#tag#}">','<em class="{#hlClass#}">{#title#}</em>{#subTag#}','</div>','<div class="de_span">','{#emSpan#}','</div>{#emPoint#}','</div>'].join(''),promoteTpl=nomalTpl,iconHtml='',promoteChoiceArr=[],nomalChoiceTpl=['<div tourl="{#link#}" class="de_row prom_item {#itemClass#}" promotionid="{#promotionId#}" id="{#domId#}">','<div class="de_tag" tag="{#tag#}">','<em class="{#hlClass#}">{#title#}</em>{#subTag#}','</div>','<div class="de_span">','{#emSpan#}','</div>{#emPoint#}','</div>'].join(''),promoteChoiceTpl=nomalChoiceTpl;window.promotionCB=function(json,bankpromo,priceProm){var promTip={'1':'','2':'','3':'','4':'','6':'','7':'','9':'','10':'','11':'','15':'','16':'','17':'','18':'','19':'','20':'','21':'','22':'QQ','23':'','36':'','60':'','80':'PLUS','1001':'PLUS','1002':'PLUS'},promTags=obj.isMScene?['1','2','3','4','6','7','9','10','11','15','16','17','18','19','20','21','23','29','36','40','60','80','1001','1002']:['1','2','3','4','6','7','9','10','11','15','16','17','18','19','20','21','22','23','29','36','40','60','80','1001','1002'],promSortMap={'1':99,'10':98,'80':97,'7':96,'6':95,'23':94,'36':93,'15':92,'19':91,'16':90,'18':89,'60':88,'17':87,'20':86,'3':85,'1001':84,'11':83,'9':82,'1002':81},promos=((json&&json[0]&&json[0]['pis'])||[]),item={},itemContent={},tagTypes=[],content='',conArr=[],tag='',pid=[],tagName='',promotionId=[],itemEtg='',customtag={},isNeedPoint=false,$promote=$('#promoteList'),fullFreeTimes=0,blockPlusConfine=false,getFullFreeUrl=function(){if(fullFreeTimes>0)return;fullFreeTimes++;window.showPageData28048=function(json){var data=json.data,iitem={},jitem={},promoItem={},nowTime=new Date().getTime();if(!data.length)return;for(var i=0,leni=data.length;i<leni;i++){iitem=data[i];if(!iitem||!iitem.id)continue;promoItem=promotionId.filter(function(item){return item.promotionId==iitem.id})[0];if(!promoItem)continue;var $dom=$promote.find('[promotionid="'+iitem.id+'"]');if(promoItem.flag==2){jitem=iitem.list.filter(function(item){return~item.env.indexOf(isWX?'1':'2')&&(nowTime>new Date(item.bdate).getTime()&&nowTime<new Date(item.edate));})[0];if(jitem&&jitem.desc){obj.iconHtml=obj.iconHtml.replace('','');$dom.find('em.hl_red_bg').html('');$dom.find('div.de_span').html('<span>'+iitem.list[0].desc+'</span>');}}else{jitem=iitem.list.filter(function(item){return~item.env.indexOf(isWX?'1':'2')&&(nowTime>new Date(item.bdate).getTime()&&nowTime<new Date(item.edate));})[0];if(jitem&&jitem.url){$dom.attr('tourl',jitem.url);}}}};ls.loadScript('//wq.360buyimg.com/data/ppms/js/ppms.pagev28048.jsonp?t='+Math.random());},str2json=function(str){if(!str)return false;try{var outObj=JSON.parse(str.replace('\t',''));return outObj;}catch(e){return false;}},getAdUrl=function(url,ptag){var adUrl='';if(window._itemGlobal&&window._itemGlobal.adGray){try{adUrl=itemComm.adverTransfer((url||'').replace(/\s/g,''),true,ptag);}catch(e){}}
return adUrl;};for(var i=0;i<promos.length;i++){item=promos[i];itemEtg=(item.etg||'').split(',');customtag=item.customtag&&JSON.parse(item.customtag)||{};if(~itemEtg.indexOf('11'))continue;tagTypes=[];for(var key in item){if(promTags.indexOf(key)>-1){tagTypes.push(key);}}
pid=(item.pid||'').split('_');if(pid[1]=='10')obj.promoteTag10++;for(var j=0;j<tagTypes.length;j++){isNeedPoint=false;tag=tagTypes[j];if(obj.isAd&&(~' 15 23 36 '.indexOf(' '+tag+' ')&&~itemEtg.indexOf(({'15':'4','23':'9','36':'14'})[tag])))continue;if(obj.isAd&&~' 15 19 '.indexOf(' '+tag+' ')&&(~itemEtg.indexOf('25')||~itemEtg.indexOf('26')||~itemEtg.indexOf('27')))continue;if(obj.isPrescribeDrug&&(tag==='10'||tag==='18'||tag==='80'))continue;var isSalePromote=!!~['15','16','17','18','19','23','36','60'].indexOf(tag);try{var subextinfo=JSON.parse(item.subextinfo||'{}');}catch(e){}
var subExtType=subextinfo&&subextinfo.subExtType&&subextinfo.subExtType.toString()||'';if(obj.limitWhiteObj){if(!obj.limitWhiteObj[tag]||(obj.limitWhiteObj[tag]!='all'&&!~(obj.limitWhiteObj[tag].split(',')).indexOf(subExtType))){continue;}}
if(obj.limitBlackObj){if(obj.limitBlackObj[tag]&&(obj.limitBlackObj[tag]=='all'||~(obj.limitBlackObj[tag].split(',')).indexOf(subExtType))){continue;}}
if((obj.hideSalePromoteJump&&isSalePromote)||(obj.hideOtherPromoteJump&&!isSalePromote)){promoteChoiceTpl=nomalChoiceTpl.replace('{#link#}','').replace('{#emPoint#}','');promoteTpl=promoteTpl.replace('{#link#}','').replace('{#emPoint#}','');}else{promoteChoiceTpl=nomalChoiceTpl;promoteTpl=nomalTpl;}
tagName=promTip[tag];content=(item[tag]||'').replace(/(\.00|\.0[^\d])/g,'');conArr=(content.indexOf('!@@!')>-1?content.split('!@@!'):[]);jsonData={};jsonData.promotionId=pid[0]||'0';jsonData.itemClass='';switch(tag){case'1':if(conArr.length>0){var isVip=(~itemEtg.indexOf('16'));if(loginHandler.getLoginStatus()){if(json[0].hit=='1'){content=''+getUserLevel((~' 5001 5002 5003 5004 5005 '.indexOf(' '+conArr[0]+' ')?json[0].vl*1:(~' 6010 6020 '.indexOf(' '+conArr[0]+' ')?json[0].pl*1:json[0].jl*1))||conArr[0]*1).replace('PLUS','PLUS')+''+(isVip?'':'')+'&yen;'+conArr[1];if(isVip&&(conArr[0]=='50'||conArr[0]=='59')){tagName='';content='&yen;'+conArr[1];}}else{content=(isVip?'':''+getUserLevel(conArr[0]*1)+''+'&yen;'+conArr[1]+'');}}else{content=(isVip?' ':getUserLevel(conArr[0]*1)+''+'&yen;'+conArr[1]+'');}}else{content='';}
if(~content.indexOf('PLUS'))content='';break;case'10':case'80':var contentInfo=str2json(conArr.length>0?conArr[0]:content),isPg=tag==80,hlclass=obj.isJDChoice||isPg?'hl_gold_bg':'hl_red_bg';if(!contentInfo||!contentInfo.length){content='';break;}
obj.giftFlag|=(isPg?2:1);if(tag=='10'&&customtag['2']){tagName='';}
var setHtml=function(jsonData,tagName,content){jsonData.link=jsonData.link||'';jsonData.emPoint='';jsonData.domId=(tag==10&&(tagName==''||tagName==''))?'goodGift':'';jsonData.emSpan=jsonData.emSpan||'<span>'+content+'</span >';jsonData.domId=(tag==10&&(tagName==''||tagName==''))?'goodGift':'';promoteChoiceArr.push({title:tagName,desc:content,tag:tag,pid:item.pid});jsonData.title=tagName;jsonData.hlClass=hlclass;var tempTpl=obj.isJDChoice?promoteChoiceTpl:promoteTpl;if(isPg){tempTpl+='<div class="prom_item plus_prom" style="display:none;"><div class="de_span"><span>PLUS</span></div><div class="de_point"><i class="icon_point"></i></div></div>';}
htmlObjs.push({tag:tag,html:itemComm.jsonToTpl(jsonData,tempTpl)});};var giftArr=[],giftData={},giftHtml=[],giftInfoArr=[];giftArr=contentInfo.filter(function(a){return a&&a.gt=='2'&&a.num>0;});var giftNum=giftArr.length,giftHtmlStr='',giftTpl='<div class="img {#moreClass#}" tag="{#tag#}" title="'+(tagName==""?"":"")+'"><img src="{#giftImg#}" alt="">{#numStr#}</div>',giftInfoTpl='<div class="info"><div class="name">{#giftName#}</div><div class="desc">x {#num#}</div></div><div class="de_point"><i class="icon_point"></i></div>';if(giftNum>0){for(var k=0;k<giftNum;k++){itemContent=giftArr[k];giftData.link=obj.isMScene?'//item.m.jd.com/product/'+itemContent.sid+'.html?ptag=7001.1.52':'//wqitem.jd.com/item/view?ptag=7001.1.52&sku='+itemContent.sid;giftData.giftImg=itemContent.mp?'//img13.360buyimg.com/n4/'+itemContent.mp:'//img20.360buyimg.com/jdphoto/jfs/t7558/171/659017679/3593/ceaac071/59958e76Nca6b9c33.png';giftData.giftName=itemContent.nm;giftData.num=itemContent.num||1;giftData.numStr='';giftData.moreClass='';giftInfoArr.push(giftData.giftName+' X'+giftData.num);if(giftData.num>1)giftData.numStr='<span class="gift_num">x '+giftData.num+'</span>';giftHtml.push(itemComm.jsonToTpl(giftData,'<div class="item" tourl="'+giftData.link+'">'+giftTpl+giftInfoTpl+'</div>'));giftData.moreClass='';giftData.numStr='';}
giftHtmlStr='<div class="de_pm_list">'+giftHtml.join('')+'</div>';if(isPg){content=(conArr.length>1?conArr.slice(1).join('').replace(/\(|\|\)|\/g,''):'PLUS');jsonData.emSpan='<div class="prom_flex_box"><span>'+content+'</span></div>'+giftHtmlStr+'<div class="de_desc" mark="plusgd" style="display:none;">PLUSPLUS</div>';}else{content=(conArr.length>1?conArr.slice(1).join(''):'');jsonData.emSpan='<div class="prom_flex_box"><span>'+content+'</span></div>'+giftHtmlStr;}
content=giftInfoArr.join('');setHtml(jsonData,tagName,content);}
var attachmentArr=[],attachmentData={},attachmentHtml=[],attachmentInfoArr=[];attachmentArr=contentInfo.filter(function(a){return a&&a.gt=='1'&&a.num>0&&a.ss=='1';});var attachmentNum=attachmentArr.length,attachmentHtmlStr='',attachmentTpl='<div class="img {#moreClass#}" tag="{#tag#}" title=""><img src="{#attachmentImg#}" alt="">{#numStr#}</div>',attachmentInfoTpl='<div class="info"><div class="name">{#attachmentName#}</div><div class="desc">x {#num#}</div></div><div class="de_point"><i class="icon_point"></i></div>';if(attachmentNum>0){for(var k=0;k<attachmentNum;k++){itemContent=attachmentArr[k];attachmentData.link=obj.isMScene?'//item.m.jd.com/product/'+itemContent.sid+'.html':'//wqitem.jd.com/item/view?sku='+itemContent.sid;attachmentData.attachmentImg=itemContent.mp?'//img13.360buyimg.com/n4/'+itemContent.mp:'//img13.360buyimg.com/jdphoto/jfs/t7288/113/649307008/3531/9e3b3408/59958e5eNcf9ab359.png';attachmentData.attachmentName=itemContent.nm;attachmentData.num=itemContent.num;attachmentData.numStr='';attachmentData.moreClass='';attachmentInfoArr.push(attachmentData.attachmentName+' X'+attachmentData.num);if(attachmentData.num>1)attachmentData.numStr='<span class="attachment_num">x '+attachmentData.num+'</span>';attachmentHtml.push(itemComm.jsonToTpl(attachmentData,'<div class="item" tourl="'+attachmentData.link+'">'+attachmentTpl+attachmentInfoTpl+'</div>'));attachmentData.moreClass='';attachmentData.numStr='';}
attachmentHtmlStr='<div class="de_pm_list" tourl="'+attachmentData.link+'">'+attachmentHtml.join('')+'</div>';content='';jsonData.emSpan='<div class="prom_flex_box"><span>'+content+'</span></div>'+attachmentHtmlStr;content=attachmentInfoArr.join('');setHtml(jsonData,'',content);}
content='';break;case'15':case'23':case'36':case'19':var nowTime=new Date().getTime(),isKuaDianPu=false;if(~itemEtg.indexOf(({'15':'4','23':'9','36':'14'})[tag])){tagName=({'15':'','23':'','36':''})[tag];isKuaDianPu=true;}
if((tag=='15'||tag=='19')){if(~itemEtg.indexOf('25')){tagName=(item['st']*1000<nowTime&&customtag.mli)?customtag.mli:'/';isKuaDianPu=true;}
if(~itemEtg.indexOf('26')){tagName=(item['st']*1000<nowTime&&customtag.mli)?customtag.mli:'/';isKuaDianPu=true;}
if(~itemEtg.indexOf('27')){tagName=(item['st']*1000<nowTime&&customtag.mli)?customtag.mli:'/';isKuaDianPu=true;}}
if(isKuaDianPu){if(item['st']*1000<nowTime){jsonData.emRedBg='<em class="hl_red_bg">'+tagName+'</em>'+'<span class="sub_tag red"></span>';jsonData.subTag='<span class="sub_tag red"></span>';}else{var stTime=formatTime(new Date(item['st']*1000));content=stTime.month+''+stTime.day+''+stTime.hour+':'+stTime.min+''+tagName+''+content;jsonData.emRedBg='<em class="hl_red_bg">'+tagName+'</em>'+'<span class="sub_tag blue"></span>';jsonData.subTag='<span class="sub_tag blue"></span>';}
isNeedPre=true;jsonData.link=getAdUrl(item.adurl,'37287.6.2');jsonData.itemClass='higher_de_tag';promotionId.push({promotionId:pid[0]});}
isNeedPoint=true;break;case'22':if(obj.displayQQMemPrice)obj.showQQMemPrice(obj,(content||'').replace(/|/,''));break;case'16':case'17':case'18':if(tag=='17'){promotionId.push({promotionId:pid[0],flag:2});}
isNeedPoint=true;break;case'29':content=str2json(conArr.length>0?conArr[0]:content);if(!content||!content.length){content='';break;}
obj.giftPool=[];var poolIndex={};obj.giftPoolGetInfoBySku={};for(var k=0,lenk=content.length;k<lenk;k++){itemContent=content[k]||{};if(!itemContent.pno||itemContent.gt!='2')continue;if(itemContent.mp){itemContent.image=JD.img.getImgUrl('//img13.360buyimg.com/n5/'+itemContent.mp);itemContent.imgBig=JD.img.getImgUrl('//img13.360buyimg.com/n3/'+itemContent.mp);}else{itemContent.image='//misc.360buyimg.com/product/skin/2012/i/gift.png';itemContent.imgBig='//misc.360buyimg.com/product/skin/2012/i/gift.png';}
if(!poolIndex[itemContent.pno]&&poolIndex[itemContent.pno]!==0){obj.giftPool.push({PoolNo:itemContent.pno,PoolName:itemContent.poolName,skus:[{id:itemContent.sid,name:itemContent.nm,image:itemContent.mp,num:itemContent.num,selectState:2}]});poolIndex[itemContent.pno]=obj.giftPool.length-1;obj.giftData.push({giftId:itemContent.sid,num:itemContent.num});itemContent.poolIndex=poolIndex[itemContent.pno];itemContent.skuIndex=0;}else{obj.giftPool[(poolIndex[itemContent.pno])].skus.push({id:itemContent.sid,name:itemContent.nm,image:itemContent.mp,num:itemContent.num,selectState:1});itemContent.poolIndex=poolIndex[itemContent.pno];itemContent.skuIndex=obj.giftPool[(poolIndex[itemContent.pno])].skus.length-1;}
obj.giftPoolGetInfoBySku[itemContent.sid]=itemContent;}
obj.giftPoolType=(customtag&&customtag.ifg=='1')?'28':'';obj.isGiftPool=true;obj.showGiftPool();content='';break;case'60':if(pid[0]){jsonData.link='//wqs.jd.com/item/add_buy.shtml?ptag=7014.19.9&activity_id='+pid[0]+'&sku='+obj.skuId+(obj.isMScene?'&sceneval=2':'');reporter.reports({ptag:'7014.19.8'});}
break;case'3':if(priceProm&&priceProm.PLUS&&priceProm.PLUS.limit_text){content='PLUS'+content;}
break;case'9':if(content.indexOf('')===-1){blockPlusConfine=true;}
break;case'40':if(customtag&&customtag.discount=='9.5'&&(obj.plusFlag=='101'||obj.plusFlag=='201')){var $discountFloor=$('#discountFloor');if($discountFloor.css('display')=='none')reporter.reportExposure({ptag:'7001.1.350'});$discountFloor.show().find('.dicount_plus').show().find('span').html(content);$('#discountPopup').find('.floor_plus').show().find('.content').html(content).attr('tourl','//plus.m.jd.com/rights/plusRightsDetail?/detail13'+(window.isMScene?'':'&s=wq'));}
content='';break;default:break;}
if(content.indexOf('')===-1&&!obj.isAd2){jsonData.link=jsonData.link||'';jsonData.emPoint='';if((isNeedPoint&&pid[0])||jsonData.link){jsonData.link=jsonData.link||(obj.isMScene?('//so.m.jd.com/list/itemSearch.action?ptag=37287.6.5&promotion_aggregation=yes&activityId='+pid[0]+'&skuId='+obj.skuId+'&pro_d='+(encodeURIComponent(tagName))+'&pro_s='+(encodeURIComponent(content))):('//wqsou.jd.com/coprsearch/prsearch?ptag=37287.6.5&promotion_aggregation=yes&activity_id='+pid[0]+'&pro_d='+(encodeURIComponent(tagName))+'&pro_s='+(encodeURIComponent(content))));jsonData.emPoint='<div class="de_point"><i class="icon_point"></i></div>';}
jsonData.emSpan=jsonData.emSpan||'<span>'+content+'</span >';promoteChoiceArr.push({title:tagName,desc:content,tag:tag,pid:item.pid});jsonData.tag=tag;jsonData.title=tagName;jsonData.hlClass=obj.isJDChoice?'hl_gold_bg':'hl_red_bg';htmlObjs.push({tag:tag,html:itemComm.jsonToTpl(jsonData,obj.isJDChoice?promoteChoiceTpl:promoteTpl)});}}}
if(priceProm&&priceProm.PLUS){var plusPriceProm=priceProm.PLUS;var tag='';jsonData={};if(plusPriceProm.limit_text&&(!obj.limitWhiteObj||obj.limitWhiteObj['1001'])&&!(obj.limitBlackObj&&obj.limitBlackObj['1001'])){tag='1001';jsonData.hlClass='hl_gold_bg';jsonData.emSpan='<span>'+plusPriceProm.limit_text+'</span >';promoteChoiceArr.push({title:promTip[tag],desc:plusPriceProm.limit_text,tag:tag});jsonData.title=promTip[tag];jsonData.desc=plusPriceProm.limit_text;htmlObjs.push({tag:tag,html:itemComm.jsonToTpl(jsonData,obj.isJDChoice?promoteChoiceTpl:promoteTpl)});}
if(!blockPlusConfine&&plusPriceProm.confine_text&&(!obj.limitWhiteObj||obj.limitWhiteObj['1002'])&&!(obj.limitBlackObj&&obj.limitBlackObj['1002'])){tag='1002';jsonData.hlClass='hl_gold_bg';jsonData.emSpan='<span>'+plusPriceProm.confine_text+'</span >';promoteChoiceArr.push({title:promTip[tag],desc:plusPriceProm.confine_text,tag:tag});jsonData.title=promTip[tag];jsonData.desc=plusPriceProm.confine_text;htmlObjs.push({tag:tag,html:itemComm.jsonToTpl(jsonData,obj.isJDChoice?promoteChoiceTpl:promoteTpl)});}}
htmlObjs=htmlObjs.sort(function(a,b){var k1=promSortMap[a.tag]||0,k2=promSortMap[b.tag]||0;return k2-k1;});promoteChoiceArr=promoteChoiceArr.sort(function(a,b){var k1=promSortMap[a.tag]||0,k2=promSortMap[b.tag]||0;return k2-k1;});for(var i=0,len=htmlObjs.length;i<len;++i){htmlArr.push(htmlObjs[i].html);}
if(bankpromo&&bankpromo.title&&!obj.isAd2){jsonData.link=getAdUrl(bankpromo.actUrl,'37287.6.5');if(!jsonData.link&&bankpromo.activityId){jsonData.link='//wqsou.jd.com/coprsearch/prsearch?ptag=37287.6.6&rebate_id='+bankpromo.activityId;}
if(jsonData.link){jsonData.emPoint='<div class="de_point"><i class="icon_point"></i></div>';}else{jsonData.emPoint='';}
jsonData.hlClass=obj.isJDChoice?'hl_gold_bg':'hl_red_bg';jsonData.emRedBg='<em class="hl_red_bg"></em>';jsonData.emSpan='<span>'+bankpromo.title+'</span >';iconHtml+=' <em class="hl_red_bg"></em>';promoteChoiceArr.push({title:'',desc:bankpromo.title,tag:0});jsonData.title='';jsonData.desc=bankpromo.title;htmlArr.push(itemComm.jsonToTpl(jsonData,obj.isJDChoice?promoteChoiceTpl:promoteTpl));}
if(obj.showPhoneCard){iconHtml+=' <em class="hl_red_bg"></em>';promoteChoiceArr.push({title:'',desc:''});htmlArr.push(itemComm.jsonToTpl({domId:'phoneCardPromote',emPoint:obj.hideOtherPromoteJump?'':'<div class="de_point"><i class="icon_point"></i></div>',emRedBg:'<em class="hl_red_bg"></em>',hlClass:obj.isJDChoice?'hl_gold_bg':'hl_red_bg',title:'',itemClass:'',link:'',emSpan:'<div class="de_span"><span></span></div>'},obj.isJDChoice?promoteChoiceTpl:promoteTpl));}
if(htmlArr.length>0){obj.iconHtml+=iconHtml;$('#discountPopup').find('.floor_promo').show();$promote.html(htmlArr.join('')).show().off().on('click','.prom_item.de_row,.de_pm_list,.item',function(){var $this=$(this),urlReg=/^(https*:){0,1}\/\//,tourl=$this.attr('tourl');if(!tourl&&$this.hasClass('item')){tourl=$this.parent('.de_pm_list').attr('tourl');}
if(tourl&&urlReg.test(tourl)){if(obj.isJxChannel&&(/^(https*:){0,1}\/\/wqsou\.jd\.com\/coprsearch\/prsearch/.test(tourl)||/^(https*:){0,1}\/\/wqs\.jd\.com\/item\/add_buy.shtml/.test(tourl))){if(obj.isPingouShop){tourl=JD.url.addUrlParam(tourl,{filt_type:'productext2,b40v1'});}else{tourl=JD.url.addUrlParam(tourl,{filt_type:'productext2,b40v0'});}}
window.location.href=getAppWebviewUrl(tourl);}}).on('click','div.img',function(){var $this=$(this),tag=$this.attr('tag'),title=$this.attr('title');if(tag&&popUp.popupBody[tag]&&title){popUp.showHidePopup($('#promotePopup'));}});if(promotionId.length>0){getFullFreeUrl();}
reporter.reportExposure({ptag:'7001.1.151'});}else{$promote.hide();}
obj.choicePromote(promoteChoiceArr);};try{priceProm=JSON.parse(obj.priceExt);}catch(e){}
if((obj.promov2&&obj.promov2[0]&&obj.promov2[0]['pis'])||(obj.bankpromo&&obj.bankpromo.title)||(priceProm&&priceProm.PLUS)){itemUtil.setDelayTime();window.promotionCB(obj.promov2,obj.bankpromo,priceProm);}else if(obj.isPingouScene){obj.pingouPromote([])}};Promotion.prototype.showGiftPool=function(){var obj=this,pnoTpl='<li class="item" pno="{#pno#}" sku="{#sid#}" poolindex="{#poolIndex#}" skuindex="{#skuIndex#}"><img src="{#image#}" alt="">{#numberTpl#}</li>',pnoHtml=[],maxShowNum=4,dataTotal=0,dataGiftTotal=0;obj.giftData.forEach(function(item){var number=item.num;if(obj.giftPoolGetInfoBySku[item.giftId]){if(number>1){obj.giftPoolGetInfoBySku[item.giftId].numberTpl='<span class="gift_num">'+number+'</span>';}else{obj.giftPoolGetInfoBySku[item.giftId].numberTpl='';}
++dataTotal;dataGiftTotal+=number;if(pnoHtml.length<maxShowNum){pnoHtml.push($jsonToTpl(obj.giftPoolGetInfoBySku[item.giftId],pnoTpl));}}});obj.giftPool.forEach(function(item){item.skus.forEach(function(info){var dataItem=obj.giftData.filter(function(s){return s&&s.giftId&&s.giftId==info.id;})[0];if(dataItem){if(obj.giftPoolType==28)info.num=dataItem.num;info.selectState=2;}else{if(obj.giftPoolType==28)info.num=1;info.selectState=1;}});});if(pnoHtml.length>0){if(dataTotal>pnoHtml.length){pnoHtml.push('<li class="more"></li>');}
$('#giftPoolItem,#giftPoolItem2').html(pnoHtml.join(''));$('#giftPoolTip,#giftPoolTip2').html(obj.giftPoolType==28?'<span></span>'+dataGiftTotal+'':'<span></span>'+obj.giftPool.length+'');$('#giftPool,#giftPool2').show();}};Promotion.prototype.choicePromote=function(arr){var obj=this;if(obj.isPingouScene){obj.pingouPromote(arr);return;}
if(!(arr&&arr.length))return;var smallTpl=['<div class="de_row prom_item">','<div class="de_tag" tag="{#tag#}">','<em class="{#hlClass#}">{#title#}</em>','</div>','<div class="de_span line1">','<span>{#desc#}</span>','</div>','</div>'].join(''),tagTpl=['<div class="de_tag" tag="{#tag#}">','<em class="{#hlClass#}">{#title#}</em>','</div>'].join('');for(var i=0,leni=arr.length,itemi;i<leni;i++){itemi=arr[i];var fun='push';if(obj.isJDChoice||itemi.tag==80||itemi.tag==1001||itemi.tag==1002){itemi.hlClass='hl_gold_bg';}else{itemi.hlClass='hl_red_bg';}
obj.promoteTags[fun](itemi);}
var htmlStr='',arr1=[],arr2=[];if(obj.promoteTags.length>3){arr1=obj.promoteTags.slice(0,2);arr2=obj.promoteTags.slice(2);arr1=arr1.map(function(s){return $jsonToTpl(s,smallTpl);});arr2=arr2.map(function(s){return $jsonToTpl(s,tagTpl);});htmlStr=[arr1.join(''),'<div class="de_row prom_item">',arr2.join(''),'</div>'].join('');}else{arr1=obj.promoteTags.map(function(s){return $jsonToTpl(s,smallTpl);});htmlStr=arr1.join('');}
var $discountFloor=$('#discountFloor');if($discountFloor.css('display')=='none')reporter.reportExposure({ptag:'7001.1.350'});$discountFloor.show().find('div.detail_prom').html(htmlStr).show();$('#discountGap').show();};Promotion.prototype.pingouPromote=function(arr){var obj=this;var showDuoDanFan=obj.duoDanFan&&obj.duoDanFan.tips&&obj.duoDanFan.title&&obj.duoDanFan.desc
if(!(arr&&arr.length||showDuoDanFan))return;var $poromoteDiv=$('#poromoteDiv');var htmlArr=['<span class="title"></span><div class="content"><div class="row">'];if(showDuoDanFan){htmlArr.push('<span class="promote bg_golden">'+obj.duoDanFan.tips+'</span>');var $duoDanFan=$('#duoDanFan');$duoDanFan.find('.title').text(obj.duoDanFan.title);$duoDanFan.find('.extra-cash-return__tips').text(obj.duoDanFan.tips);$duoDanFan.find('.extra-cash-return__desc').text(obj.duoDanFan.desc);$duoDanFan.show();}
if(arr&&arr.length){var outTagtpl='<span class="promote {#class#}" style="{#style#}">{#text#}</span>';var outTagArr=obj.outTags;arr.forEach(function(val){if(val.pid){outTagArr.forEach(function(item){if(item.pid==val.pid){val.outTags=item.outTags}})}
val.outTagsShow=(arr.length>1||showDuoDanFan)&&val.outTags||[{text:val.title,type:"text"}];val.outTagsShow.forEach(function(item){htmlArr.push($jsonToTpl(item,outTagtpl))})});if(arr.length==1&&!showDuoDanFan){htmlArr.push('<span class="desc">'+arr[0].desc+'</span>')}}
htmlArr.push('</div></div>');$poromoteDiv.html(htmlArr.join('')).show();};Promotion.prototype.showQQMemPrice=function(qqMemPrice){var obj=this;var disCount=(obj.jdPrice*1-qqMemPrice*1).toFixed(2).replace('.00','').replace('.0','');if(disCount>0){var isAndroid=$.os&&$.os.android,locationUrl=(location.href||'').split('#')[0];var url='//mc.vip.qq.com/qqwallet/index?aid='+(isAndroid?'mvip.p.dx.hz_jdgw':'mios.p.dx.hz_jdgw')+'&type=!svip&month=1&send=0&ADTAG=jd001&return_url='+encodeURIComponent(locationUrl),$dom=$('#qqMemBar'),$domBar=$('#barGroup'),tpl='<a href="{#url#}" class="power_bar bars_group_item">'+'<i class="qq_vip"></i>QQ<em>&yen;{#price#}</em>'+'<div class="power_bar_right"><span>/</span></div>'+'</a>';if(!$dom.length){$domBar.prepend('<div class="bars_group_item" id="qqMemBar"></div>');$dom=$('#qqMemBar');}
$dom.attr('qqmemprice',qqMemPrice).html($jsonToTpl({url:url,price:(qqMemPrice*1).toFixed(2)},tpl)).show();$domBar.show();}};Promotion.prototype.setPromoteTitle=function(flag){var obj=this;if(!obj.iconHtml){return;}
if(obj.is9669order){return;}
$('#promotePanel').show();if(!flag){var itemPromote=cache.getItem('itemPromote',true);if(itemPromote=='1')flag=true;}
if(flag==2)flag=false;if(flag){$('#promote').html(obj.iconHtml).removeClass('de_c_red').addClass('de_span').children().hide();$('#promote em').show();$('#promoteIcon').removeClass('icon_point_up').addClass('icon_point_drop');$('#promGroup').hide();}else{var tipProm='';if(obj.isPingouScene){tipProm='';}else{if(obj.promoteTag10>1&&!obj.showPhoneCard){tipProm='';$('#promote').addClass('de_c_red').removeClass('de_span');}}
$('#promote').html(tipProm);$('#promoteIcon').removeClass('icon_point_drop').addClass('icon_point_up');$('#promGroup').show();}};Promotion.prototype.setPartGift=function($dom){var obj=this;if(!$dom||$dom.hasClass('none'))return;if(!$dom.hasClass('active')){$dom.addClass('active').siblings().removeClass('active');var sku=$dom.attr('sku'),pno=$dom.attr('pno'),item={},$partDetail=$('#partGiftDetail_'+pno);if(!this.giftPool[pno]){console.log(this.giftPool);console.log(pno);}
for(var i=0,len=this.giftPool[pno].inStock.length;i<len;i++){item=this.giftPool[pno].inStock[i];if(item.sid==sku){$partDetail.attr('href',obj.isMScene?'//item.m.jd.com/product/'+sku+'.html':'//wqitem.jd.com/item/view?sku='+sku);$partDetail.find('img').attr('src',item.imgBig);$partDetail.find('h1').html(item.nm);$partDetail.find('span.num').html('x'+item.num);break;}}}};Promotion.prototype.setGiftPool=function(){var $em='',pno='',item={},sku='',obj=this;$('#partGiftGroup li.active').each(function(indx,em){$em=$(em);pno=$em.attr('pno');sku=$em.attr('sku');if(!obj.giftPool[pno]||obj.giftPool[pno].inStock.length==0)return true;for(var i=0,len=obj.giftPool[pno].inStock.length;i<len;i++){item=obj.giftPool[pno].inStock[i];if(item.sid==sku){$('#giftPoolItem_'+pno).attr('sku',sku).find('img').attr('src',item.img);break;}}});};Promotion.prototype.getGiftPoolList=function(){var obj=this,poolList=[];if(obj.giftPoolType==28){obj.giftData.forEach(function(item){poolList.push(item.giftId+'|'+item.num);});}else{obj.giftData.forEach(function(item){poolList.push(item.giftId);});}
return poolList;};Promotion.prototype.bindEvent=function(){var obj=this;$('#promoteDiv').on('click',function(){var itemPromote=1;if($('#promoteIcon').hasClass('icon_point_up')){itemPromote=1;}else{itemPromote=2;}
cache.setItem('itemPromote',itemPromote,true,3600*24);obj.setPromoteTitle(itemPromote);});$.subscribe('item.related.addPromotion',function(e,title,desc){obj.iconHtml=obj.iconHtml+' <em class="hl_red_bg">'+title+'</em>';if(obj.version==2){obj.choicePromote([{title:title,desc:desc}]);}else{if($('#promoteList .de_row').length==0){$('#promoteDiv').hide();}else if($('#promoteList .de_row').length==1){$('#promoteDiv').show();}
obj.setPromoteTitle(2);}
$('#discountPopup').find('.floor_promo').show();});if(obj.isGiftPool){JD.events.listen('item.buyNumController.buyNumChange',function(buyNum){buyNum=buyNum||1;var diffNum=buyNum-obj.buyNum;if(diffNum==0)return;if(diffNum>0){obj.giftData.forEach(function(item,index){if(obj.giftPoolType==28&&index>0){return false;}
item.num+=diffNum;});}else{if(obj.giftPoolType==28){var limitNum=Math.abs(diffNum);obj.giftData.forEach(function(item){if(item.num>=limitNum){item.num=item.num-limitNum;limitNum=0;}else{limitNum=limitNum-item.num;item.num=0;}});obj.giftData=obj.giftData.filter(function(s){return s&&s.num&&s.num!=0;});}else{obj.giftData.forEach(function(item){item.num+=diffNum;});}}
obj.showGiftPool();obj.buyNum=buyNum;});$('#giftPool,#giftPool2').on('click',function(){comGiftPoolObj.init({domId:'part_gift',good:{'skuId':obj.skuId,'name':obj.skuName,'price':obj.jdPrice,'num':obj.buyNum,'img':obj.firstImg},listGiftPools:obj.giftPool,giftPoolType:obj.giftPoolType,pageTitle:document.title,addCb:function(param){if(param&&param.hadChange&&param.giftData){obj.giftData=param.giftData;obj.showGiftPool();}}});$.publish('item.main.gotoPage',['#gift']);});}
$('#part_gift').on('click',function(e){var target=e.srcElement||e.target,em=target,i=1;while(em&&!em.id&&i<=4){em=em.parentNode;i++;}
if(!em||!em.id)return;var $em=$(em),emId=em.id;if(emId.indexOf('partGiftItem_')>-1){obj.setPartGift($em);return;}
if(emId=='partGiftBtn'){itemUtil.setDelayTime();obj.setGiftPool();$.publish('item.main.gotoPage',['#main']);}});$('#promotePanel,#dicountFloor,#dicountPopup').on('click','div.plus_prom',function(){loginHandler.loginLocation('//plus.m.jd.com/index?s=wq&ptag=7001.1.90');});$('#phoneCardPromote').on('click',function(){if(obj.hideOtherPromoteJump)return;reporter.reports({ptag:'7001.1.311'});location.href='//m-eve.jd.com/tyk/activityInfo?channel=wqpage&busiType=1';});$('#discountPopup .floor_plus').on('click','.content',function(){window.location.href=$(this).attr('tourl');});};exports.init=function(config){if(config&&config.hidePromotion)return false;var promotion=new Promotion();promotion.init(config);return promotion;};});
;define('jd.item.related',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),urlParam=require('url'),itemUtil=require('jd.item.util'),popUp=itemUtil.popUp,getImgUrl=itemUtil.getImgUrl,reporter=itemUtil.reporter,umpMonitor=itemUtil.umpMonitor,ls=require('loadJs'),itemComm=require('wq.item.common'),util=require('util'),isWX=util.isWX();var Related=function(){var opt={isMScene:false,isJDChoice:false,isAd2:false,skuId:'',isPrescribeDrug:false,venderId:'',jdCategory:[],item:{},mainImg:'',jdAddrId:[],needRelate:false,needAccessory:false,jdSkuInfo:{},relatedItem:{},suitList:[],relatedIdx:[],skuPicUrl:'',relatedLastChoice:[],suitPriceCache:{},switchRelatedSku:false,hideRelated:false};$.extend(this,opt);};Related.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.loadRelatedItem();obj.bindEvent();};Related.prototype.refresh=function(config){config=config||{};var obj=this;$.extend(obj,config);$('#relatedEnter,#relatedEnter2').hide();!obj.hideRelated&&obj.loadRelatedItem();};Related.prototype.loadRelatedItem=function(){var obj=this,methodArr=[];if(obj.needRelate)methodArr.push('suitv2');if(obj.needAccessory)methodArr.push('accessories');if(!methodArr.length)return;window.relatedSuit=function(json){umpMonitor.report({operation:'10',result:'0',source:'0',message:'item relate api success'});umpMonitor.delTimeout('itil10');obj.jdSkuInfo['relate'+obj.skuId]=json;if(json&&json.accessories&&json.accessories.status==200&&obj.venderId!='686083'){$.publish('item.related.handleAccessories',[json.accessories]);}
if(!json||!json.suit||json.suit.status!=200||!json.suit.data||obj.isAd2)return;var ct=obj.item||{},newColorSize=ct.newColorSize||[],colorSizeArr=[];for(var i=0,itemi,leni=newColorSize.length;i<leni;i++){itemi=newColorSize[i];if(itemi.skuId==obj.skuId){for(var j=0,lenj=Object.keys(ct.saleProp).length;j<lenj;j++){itemi[j]?colorSizeArr.push(itemi[j]):'';}}}
var relateds=[],max=0,citem={skuClass:'sku',isHide:colorSizeArr.length==0?'hide':'',sku:obj.skuId,name:ct.skuName,num:1,img:obj.mainImg,choose:':'+colorSizeArr.join(' '),link:obj.isMScene?'//item.m.jd.com/product/'+obj.skuId+'.html?ptag=37287.6.3':'//wqitem.jd.com/item/view?sku='+obj.skuId+'&ptag=37287.6.3'},suitList=json.suit.data.packList,item={},pr={},tmp={},skuList=[],tmpItem={},tmpSku={},isTencentVideo=false,tencentMax=0,htmlArr=[],itemArr=[];if(!suitList||!suitList.length)return;obj.suitList=suitList;for(var i=0,len=suitList.length;i<len;i++){pr=suitList[i];if(pr.suitType==1||(pr.packType==7&&pr.extType==1))continue;pr.packPrice=pr.packPrice||{};isTencentVideo=(pr.packType==6);tmp={};skuList=[];itemArr=[];item=pr.poolList;max=Math.max(max,pr.baseSuitDiscount);if(isTencentVideo)tencentMax=Math.max(tencentMax,pr.baseSuitDiscount);tmp.reid=pr.packId;tmp.price=(pr.packPromotionPrice).toFixed(2);tmp.item=[citem];itemArr.push('<span class="scroll_box_item_good"><img src="'+citem.img+'"></span>');skuList.push(pr.packId);skuList.push(obj.skuId);if(isTencentVideo){tmp.tencentVideo='<div class="de_prom_page_tips"></div>';tmp.ptag='7404.1.2';}else{tmp.tencentVideo='';tmp.ptag='7001.1.44';}
var lenj=lenj=item.length;for(var j=0;j<lenj;j++){tmpItem=item[j]||{};if(tmpItem.selectState!=1)continue;var colorList=(tmpItem.colorList||[]).filter(function(a){return a&&a.skuId;}),colorLen=colorList.length;if(colorLen<1)continue;tmpSku=colorList[0];skuList.push(tmpSku.skuId);tmpSku.imgUrl=JD.img.getImgUrl('//img14.360buyimg.com/n4/'+tmpSku.skuPicUrl);var temColorSize=[];for(var k=0,itemk,lenk=tmpItem.saleNames.length;k<lenk;k++){itemk=tmpItem.saleNames[k];temColorSize.push(tmpSku[itemk]);}
tmp.item.push({skuClass:colorLen==1?'sku':'sku_select',sku:tmpSku.skuId,isHide:temColorSize.length==0?'hide':'',link:obj.isMScene?'//item.m.jd.com/product/'+tmpSku.skuId+'.html?ptag=37287.6.3':'//wqitem.jd.com/item/view?sku='+tmpSku.skuId+'&ptag=37287.6.3',name:tmpSku.skuName,choose:(colorLen==1?':':'')+temColorSize.join(' '),img:tmpSku.imgUrl,num:tmpItem.num,priceStr:(isTencentVideo&&tmpSku.finalPrice>0?'<div class="price">&yen;'+(tmpSku.finalPrice*1).toFixed(2)+'</div>':'')});itemArr.push('<span class="scroll_box_item_good"><img src="'+tmpSku.imgUrl+'"></span>');}
if(itemArr.length>0){htmlArr.push('<div class="scroll_box_item">'+itemArr.join('<span class="scroll_box_item_plus"></span>')+'</div>');}
tmp.cartid=skuList.join('_');obj.suitList[i].chooseSkuList=skuList;relateds.push(tmp);}
if(htmlArr.length>0){if(max>0)max=(max).toFixed(2);if(tencentMax>0)tencentMax=(tencentMax).toFixed(2);obj.relatedItem[json.suit.data.mainSkuId]=relateds;if(tencentMax>0){reporter.reports({ptag:'7404.1.1'});}
var desc=tencentMax>0?''+relateds.length+'':''+relateds.length+'';$('#relatedNotice,#relatedNotice2').text(desc);$('#relatedEnter,#relatedEnter2').show().find('.scroll_box').html(htmlArr.join(''));$.publish('item.related.addPromotion',['',desc]);}
obj.setRelated();};if(obj.jdSkuInfo['relate'+this.skuId]){window.relatedSuit(obj.jdSkuInfo['relate'+obj.skuId]);}else{umpMonitor.createTimeout('10','item relate api timeout');ls.loadScript({url:'//c.3.cn/recommend?callback=relatedSuit&channel='+(obj.isMScene?2:(isWX?4:5))+'&methods='+methodArr.join(',')+'&sku='+obj.skuId+'&cat='+obj.jdCategory.slice(0,3).join(',')+'&area='+obj.jdAddrId.slice(0,4).join('_'),charset:'GBK'});}};Related.prototype.setRelated=function(){var obj=this;var data=obj.relatedItem[obj.skuId];if(!data||data.length==0)return;var html=[],tpl=$('#relatedTpl').html(),tpl2=obj.isJDChoice?$('#relatedBigTpl1').html():$('#relatedBigTpl').html(),tpl3=$('#relatedSmallTpl').html();for(var i=0;i<data.length;i++){var html2=[],html3=[];for(var j=0;j<data[i].item.length;j++){html2.push(itemComm.jsonToTpl(data[i].item[j],tpl2));html3.push(itemComm.jsonToTpl(data[i].item[j],tpl3));}
data[i].no=i+1;data[i].itemBig=html2.join('');data[i].itemSmall=html3.join('');data[i].btnName=obj.isPrescribeDrug?'':'';html.push(itemComm.jsonToTpl(data[i],tpl));}
$('#relatedDet').html(html.join(''));$('#related_s_1').trigger('click');if(urlParam.getUrlParam('isrelated'))$.publish('item.main.gotoPage',['#related']);};Related.prototype.showRelatedItem=function(em){var id=em.id,cell=$(em.parentNode.parentNode);if(id.indexOf('_s_')>0){cell.addClass('detail_row_unfold');cell.find('[val="small"]').hide();cell.find('[val="big"]').show();itemUtil.setDelayTime();}else{cell.removeClass('detail_row_unfold');cell.find('[val="small"]').show();cell.find('[val="big"]').hide();}};Related.prototype.setSwitchSkuAreaContent=function(opt){var obj=this;var suitIdx=opt.suitListIdx,poolIdx=opt.poolListIdx;var data=obj.suitList;if(!data||data.length==0)return;obj.relatedIdx=[suitIdx,poolIdx];var html=[],tpl=$('#switchSkuTpl').html(),tpl2='<div class="sku_kind">{#name#}</div><div class="sku_choose sku_choose{#no#}" row={#no#}>{#option#}</div>',tpl3='<span class="item">{#colorSizeName#}</span>',colorSizeChinese={'color':'','size':''},item=data[suitIdx].poolList[poolIdx],output=item.colorList[0];var html2=[];for(var i=0,rowEmpty,itemi,outputi={},leni=item.saleNames.length;i<leni;i++){var html3=[];itemi=item.saleNames[i];rowEmpty=true;for(var j=0,outputj={},lenj=item.saleProp[itemi].length;j<lenj;j++){if($.trim(item.saleProp[itemi][j])!=''){rowEmpty=false;outputj={colorSizeName:item.saleProp[itemi][j]};}
html3.push(itemComm.jsonToTpl(outputj,tpl3));}
if(!rowEmpty){outputi={name:colorSizeChinese[itemi]||itemi,option:html3.join(''),no:i};}
html2.push(itemComm.jsonToTpl(outputi,tpl2));}
output.switchSkuArea=html2.join('');html.push(itemComm.jsonToTpl(output,tpl));$('#popupSwitchSku').html(html.join(''));obj.relatedDefaultChoice();};Related.prototype.relatedDefaultChoice=function(){var obj=this;if(obj.relatedLastChoice[obj.relatedIdx[0]]&&obj.relatedLastChoice[obj.relatedIdx[0]][obj.relatedIdx[1]]){var lastChoice=obj.relatedLastChoice[obj.relatedIdx[0]][obj.relatedIdx[1]].colorName;for(var i=0,leni=lastChoice.length;i<leni;i++){$('#popupSwitchSkuArea'+' > .sku_choose'+i+' > span').each(function(){if(lastChoice[i]==$.trim($(this).text())){$(this).addClass('active');}});}}else{var colorList=obj.suitList[obj.relatedIdx[0]].poolList[obj.relatedIdx[1]].colorList,saleNames=obj.suitList[obj.relatedIdx[0]].poolList[obj.relatedIdx[1]].saleNames,tmpName='';obj.relatedLastChoice[obj.relatedIdx[0]]?'':obj.relatedLastChoice[obj.relatedIdx[0]]=[];obj.relatedLastChoice[obj.relatedIdx[0]][obj.relatedIdx[1]]?'':obj.relatedLastChoice[obj.relatedIdx[0]][obj.relatedIdx[1]]={colorName:[]};var lastChoice=obj.relatedLastChoice[obj.relatedIdx[0]][obj.relatedIdx[1]].colorName;for(var i=0,leni=saleNames.length;i<leni;i++){tmpName=$.trim(colorList[0][saleNames[i]]);lastChoice[i]=tmpName;$('#popupSwitchSkuArea'+' > .sku_choose'+i+' > span').each(function(){if(tmpName==$.trim($(this).text())){$(this).addClass('active');}});}}
obj.checkRelatedStock();};Related.prototype.checkRelatedStock=function(show){var obj=this,eachRow=$('#popupSwitchSkuArea .sku_choose');for(var i=0,chooseArr=[],itemi=eachRow.length;i<itemi;i++){var idx=eachRow.eq(i).attr('row'),val=eachRow.eq(i).children('.active').text();chooseArr[idx]=val;}
$('#popupSwitchSkuChoose').html('<span></span> '+chooseArr.join(','));var colorList=obj.suitList[obj.relatedIdx[0]].poolList[obj.relatedIdx[1]].colorList,saleNames=obj.suitList[obj.relatedIdx[0]].poolList[obj.relatedIdx[1]].saleNames;if(colorList){var got,skuId,skuPicUrl,stock,cartid,skuName,dim=saleNames.length;for(var i=0,leni=colorList.length;i<leni;i++){got=true;for(var j=0;j<dim;j++){chooseArr[j]=$.trim(chooseArr[j]||'');if($.trim(colorList[i][saleNames[j]])!=chooseArr[j]){got=false;}}
if(got){skuId=colorList[i].skuId,skuPicUrl=getImgUrl(colorList[i].skuPicUrl,'150x150');stock=colorList[i].stock;skuName=colorList[i].skuName;obj.suitList[obj.relatedIdx[0]].chooseSkuList[obj.relatedIdx[1]+2]=skuId;$('#popupSwitchSkuImg').attr('src',skuPicUrl);obj.skuPicUrl=colorList[i].skuPicUrl;cartid=obj.suitList[obj.relatedIdx[0]].chooseSkuList.join('_');if(show){var ind=obj.relatedIdx[1]+1,tag=$('#relatedDet .detail_row').eq(obj.relatedIdx[0]).find('.item').eq(ind),link=tag.children('a'),pbox=tag.parents('.de_prom_page_box'),smallDom=pbox.children('[val="small"]'),tag2=smallDom.find('.item').eq(ind);tag.find('.sku_select').text(chooseArr.join(' '));tag.find('img').attr('src',skuPicUrl);tag.find('.name').text(skuName);$('#addCart_'+(obj.relatedIdx[0]+1)).attr('cartid',cartid);link.attr('href',link.attr('href').replace(/sku=\d+/,'sku='+skuId));tag2.find('img').attr('src',skuPicUrl);}
break;}}}
if(got){if(stock){$('#popupSwitchSkuConfirm').attr('tag',1).removeClass('disabled_1');}else{$('#popupSwitchSkuConfirm').attr('tag',0).addClass('disabled_1');}
if(show){obj.switchRelatedSku=false;if(obj.suitPriceCache[cartid]){obj.showRelatedPrice(obj.suitPriceCache[cartid]);}else{obj.getRelatedPrice(cartid);}}else{obj.switchRelatedSku=true;if(stock){if(obj.suitPriceCache[cartid]){obj.showRelatedPrice(obj.suitPriceCache[cartid]);}else{obj.getRelatedPrice(cartid);}}}}else{$('#popupSwitchSkuConfirm').attr('tag',0).addClass('disabled_1');}};Related.prototype.getRelatedPrice=function(cartid){var obj=this,chooseSkuList=obj.suitList[obj.relatedIdx[0]].chooseSkuList,url='//wq.jd.com/commodity/extension/suitprice?suitId={#suitId#}&skuIds={#skuIds#}&area={#area#}&webSite=1&callback=jdSuitpriceCb'.replace('{#suitId#}',chooseSkuList[0]).replace('{#skuIds#}',chooseSkuList.slice(1,chooseSkuList.length).join(',')).replace('{#area#}',obj.jdAddrId.slice(0,3).join('_'))+(obj.isMScene?'&sceneval=2':'');window.jdSuitpriceCb=function(json){if(!obj.suitPriceCache[cartid]){obj.suitPriceCache[cartid]=json;}
obj.showRelatedPrice(json);};ls.loadScript(url);};Related.prototype.showRelatedPrice=function(json){var obj=this,priceDom='',tcPrice='';if(obj.switchRelatedSku){priceDom=$('#switchSkupriceSale');}else{var dom=$('#relatedDet .detail_row').eq(obj.relatedIdx[0]);tcPrice=dom.find('.price');}
if(json&&json.errcode==0&&json.result&&json.result.suitSkuPriceList&&json.result.suitSkuPriceList.length>0&&json.result.packPromotionPrice&&json.result.packOriginalPrice&&json.result.suitDiscount){var finalPrice=json.result.suitSkuPriceList[obj.relatedIdx[1]+1].finalPrice;var finalPriceTmpArr=String(finalPrice.toFixed(2)).split('.');priceDom&&priceDom.html('&yen;<em>'+finalPriceTmpArr[0]+'</em>.'+finalPriceTmpArr[1]);tcPrice&&tcPrice.html('&yen;'+json.result.packPromotionPrice.toFixed(2));}else{$('#popupSwitchSkuConfirm').attr('tag',0).addClass('disabled_1');}};Related.prototype.bindEvent=function(){var obj=this;$('#relatedEnter,#relatedEnter2').on('click',function(){$.publish('item.main.gotoPage',['#related']);$('body').removeClass('overflowHide').css('top','0');});$('#part_related').on('click',function(e){var target=e.srcElement||e.target,em=target,i=1;while(em&&!em.id&&i<=4){em=em.parentNode;i++;}
if(!em||!em.id)return;var $em=$(em),emId=em.id;if(emId.indexOf('related_')>-1){obj.showRelatedItem(em);return;}
if(emId.indexOf('addCart_')>-1){var cartid=$em.attr('cartid')||'';var arr=cartid.split('_');var clickptag=$em.attr('clickptag')||'';if(clickptag)reporter.reports({ptag:clickptag,related_skus:arr.slice(1).join('_')});reporter.pingClick('MProductdetail_PackageAddToCart',arr.join('#').replace('#','_'),'5',obj.skuId);if(cartid)$.publish('item.related.addCart',[{type:0,commlist:[cartid,'',1,'','4,0,0'],isRelated:true}]);}
if(emId=='popupSwitchSkuClose'||emId=='popupSwitchSku'){popUp.showHidePopup($('#popupSwitchSku'));}});$('#part_related').on('click','.de_span .sku_select',function(e){e.preventDefault();var poolListIdx=$(this).parents('.item').index()-1,suitListIdx=$(this).parents('.de_prom_page_con').attr('idx')-1;obj.setSwitchSkuAreaContent({suitListIdx:suitListIdx,poolListIdx:poolListIdx});popUp.showHidePopup($('#popupSwitchSku'),true);$('#popupSwitchSkuConfirm').parent().addClass('show').show();});$('#part_related').on('click','.sku_choose .item',function(){$(this).siblings('span').removeClass('active');$(this).addClass('active');obj.checkRelatedStock();});$('#part_related').on('click','#popupSwitchSkuConfirm',function(){if($(this).attr('tag')==1){var eachRow=$('#popupSwitchSkuArea .sku_choose');for(var i=0,chooseArr=[],itemi=eachRow.length;i<itemi;i++){var idx=eachRow.eq(i).attr('row'),val=eachRow.eq(i).children('.active').text();chooseArr[idx]=val;}
obj.relatedLastChoice[obj.relatedIdx[0]]?'':obj.relatedLastChoice[obj.relatedIdx[0]]=[];obj.relatedLastChoice[obj.relatedIdx[0]][obj.relatedIdx[1]]?'':obj.relatedLastChoice[obj.relatedIdx[0]][obj.relatedIdx[1]]={colorName:[]};obj.relatedLastChoice[obj.relatedIdx[0]][obj.relatedIdx[1]].colorName=chooseArr;popUp.showHidePopup($('#popupSwitchSku'));obj.checkRelatedStock(true);}});$('#relatedDet').on('click','.de_ps_list',function(){var tar=$(this);var em=tar.parents('.de_prom_page_box').find('[val="small"] .de_prom_page_tit')[0];obj.showRelatedItem(em);});};exports.init=function(config){if(config&&config.hideRelated)return false;var related=new Related();related.init(config);return related;};});
;define("wq.item.detail",function(require,exports,module){var _cacheThisModule_,$=require("zepto"),mLs=require('loadJs'),itemComm=require('wq.item.common'),gVar={timeout:{},cgiTimeout:4000,pageWidth:$(window).width(),pageHeight:$(window).height(),cdnGray:window._itemGlobal&&window._itemGlobal.cdnGray,cdnFail:{}},cgiUrl={commdet:'//yx.3.cn/service/info.action?',newCommdet:'//wq.jd.com/commodity/introduction/get?',cdnCommdet:'//wqsitem.jd.com/detail/',notice:'//www.jd.hk/notice/getInfo.do?',newParam:'//wq.jd.com/commodity/itembranch/getspecification?'};function setDetPadding(opt){if(!opt||!opt.containerId||opt.padding===undefined)return;var $detContainer=$('#'+opt.containerId);if(!$detContainer.length)return;if($.isArray(opt.padding)){if(opt.padding[0].indexOf&&opt.padding[0].indexOf('px')>0){$detContainer.css('padding',opt.padding.join(' '));}else{$detContainer.css('padding',opt.padding.join('px ')+'px');}}else{$detContainer.css('padding',opt.padding);}
itemComm.setDetPadding(opt.padding);}
function isBlankHtml(html){if(!html)return true;var imgReg=/<img([^>]*?\s+)src=["']([^"']+)["']([^>]*>)/ig;if(imgReg.test(html))return false;html=html.replace(/<[^>]+>/gim,'').replace(/\s/g,'');if(!html)return true;return false;}
function getMainImgsHtml(mainImgs){mainImgs=mainImgs||[];var html='';mainImgs.forEach(function(item){html+='<img src="'+item+'"><br>';});if(html)html+='<br>';return html;}
function loadCommDet(opt){var skuType=opt.skuType,jsonData=opt.json,descriptionId=opt.descriptionId,callback=opt.callback,skuId=opt.skuId,showMobileDet=opt.showMobileDet,commId=opt.commId,pcLinkId=opt.pcLinkId,userType=opt.isPlus==1?'plus':'normal',mainImgs=opt.mainImgs;if(!commId)return;var $dom=$('#'+commId);$dom.attr('hasdata','0');if(!gVar.timeout.loadDetagain){gVar.timeout.loadDetagain=setTimeout(function(){if($dom.attr('hasdata')!='1'){loadCommDet(opt);}},gVar.cgiTimeout);}
if(skuType==2||skuType==3){loadCommDetAct(opt);return;}
if(showMobileDet){loadCommDetMobile(opt);return;}
window.commDetCallBack=function(json){if(!jsonData)JD.report.umpBiz({bizid:'25',operation:'9',result:'12',source:'0',message:'yx.3.cn back'});var str=getMainImgsHtml(mainImgs)||'<br>';if(json.success=='1'){var trvStr=itemComm.tavlHTML(json.content);if(trvStr&&!isBlankHtml(trvStr)){str=trvStr;JD.report.umpBiz({bizid:'25',operation:'98',result:'0',source:'0',message:skuId+' pc detail loaded rightly'});}else{if(!trvStr){JD.report.umpBiz({bizid:'25',operation:'98',result:'1',source:'0',message:skuId+' pc detail response empty data'});}else{JD.report.umpBiz({bizid:'25',operation:'98',result:'2',source:'0',message:skuId+' pc detail response empty content'});}}
$dom.html(str).attr('hasdata','1');itemComm.transEmbed(commId);$dom.find('tr').each(function(){var td=$(this).find('td');if(td.length==1){$(td[0]).css('width',gVar.pageWidth).css('background-size','contain');}});}else{JD.report.umpBiz({bizid:'25',operation:'98',result:'1',source:'0',message:skuId+' pc detail response empty data'});$dom.html(str).attr('hasdata','1');}
json.showMobileDet='1';$('#'+pcLinkId).hide();callback&&callback(json);itemComm.initLoadImg({commId:commId});};if(jsonData){window.commDetCallBack(jsonData);}else{descriptionId=(descriptionId||'d'+skuId);if(gVar.cdnGray&&!gVar.cdnFail[skuId]){window['cb0']=function(json){if(json&&json.retry==='1'){JD.report.umpBiz({bizid:'25',operation:'98',result:'3',source:'0',message:skuId+' pc detail response retry'});gVar.cdnFail[skuId]=true;opt.showMobileDet=false;loadCommDet(opt);return;}
window.commDetCallBack(json);};mLs.loadScript({url:cgiUrl.cdnCommdet+'0_'+descriptionId+'_'+userType+'.html',setReportUrl:function(){return cgiUrl.cdnCommdet;},onError:function(){window.commDetCallBack({});}});}else{mLs.loadScript({url:cgiUrl.commdet+'callback=commDetCallBack&source=wxsqitemsou&k='+descriptionId+'&type='+userType,onError:function(){window.commDetCallBack({});}});}}}
function loadCommDetAct(opt){var skuType=opt.skuType,jsonData=opt.json,descriptionId=opt.descriptionId,callback=opt.callback,skuId=opt.skuId,showMobileDet=opt.showMobileDet,commId=opt.commId,pcLinkId=opt.pcLinkId,userType=opt.isPlus==1?'plus':'normal',mainImgs=opt.mainImgs;if(!commId)return;window.commDetActCallBack=function(json){var str='',bookTitle={"productFeatures":"","editerDesc":"","contentDesc":"","authorDesc":"","image":"","comments":"","catalogue":"","bookAbstract":"","introduction":"/"},actTitle={"productFeatures":"","editerDesc":"","contentDesc":"","biography":"","catalogue":"","comments":"","image":"","mvdColor":""};if(json.success=='1'){if(json.isMobileDesc){str=itemComm.tavlHTML(json.content);$('#'+pcLinkId).show();bindImgEvents(opt);}else{var title=(skuType==2?bookTitle:actTitle);for(var key in title){if(json[key]){if(key=='image'&&json[key].indexOf('>')==-1)json[key]='<img src="'+json[key].replace(/;/g,'"><img src="')+'">';str+='<div class="p_desc_ptitle"><span class="p_desc_ptitle_text">'+title[key]+'</span></div>'+json[key];}}
if(str==''&&json.content){str=json.content;}
str=itemComm.tavlHTML(str);$('#'+pcLinkId).hide();}}
if(str==''||isBlankHtml(str)){if(str==''){JD.report.umpBiz({bizid:'25',operation:'98',result:'1',source:'0',message:''+skuId+' response empty data'});}else{JD.report.umpBiz({bizid:'25',operation:'98',result:'2',source:'0',message:''+skuId+' response empty content'});}
str=getMainImgsHtml(mainImgs)||'<br>';}else{JD.report.umpBiz({bizid:'25',operation:'98',result:'0',source:'0',message:''+skuId+' detail loaded rightly'});}
$('#'+commId).html(str).attr('hasdata','1');itemComm.transEmbed(commId);callback&&callback(json);itemComm.initLoadImg({commId:commId});};if(jsonData){window.commDetActCallBack(jsonData);}else{descriptionId=(descriptionId||'d'+skuId);var cbKey=(showMobileDet?skuId:'0');if(gVar.cdnGray&&!gVar.cdnFail[skuId]){window['cb'+cbKey]=function(json){if(json&&json.retry==='1'){JD.report.umpBiz({bizid:'25',operation:'98',result:'3',source:'0',message:''+skuId+' response retry'});gVar.cdnFail[skuId]=true;loadCommDetAct(opt);return;}
window.commDetActCallBack(json);};mLs.loadScript({url:cgiUrl.cdnCommdet+cbKey+'_'+descriptionId+'_'+userType+'.html',setReportUrl:function(){return cgiUrl.cdnCommdet;},onError:function(){window.commDetActCallBack({});}});}else{mLs.loadScript({url:cgiUrl.commdet+'callback=commDetActCallBack&source=wxsqitemsou'+(showMobileDet?('&skuId='+skuId):'')+'&k='+descriptionId+'&type='+userType,onError:function(){window.commDetActCallBack({});}});}}}
function loadCommDetMobile(opt){var jsonData=opt.json,descriptionId=opt.descriptionId,callback=opt.callback,userType=opt.isPlus==1?'plus':'normal',skuId=opt.skuId,commId=opt.commId,pcLinkId=opt.pcLinkId;if(!commId)return;window.commDetMobileCallBack=function(json){if(!jsonData)JD.report.umpBiz({bizid:'25',operation:'9',result:'10',source:'0',message:'yx.3.cn mobile back'});var str='';if(json.content){str=itemComm.tavlHTML(json.content);}
if(!str||isBlankHtml(str)){opt.showMobileDet=false;opt.json=null;loadCommDet(opt);if(!str){JD.report.umpBiz({bizid:'25',operation:'98',result:'1',source:'0',message:skuId+' mobile detail response empty data'});}else{JD.report.umpBiz({bizid:'25',operation:'98',result:'2',source:'0',message:skuId+' mobile detail response empty content'});}
return;}
JD.report.umpBiz({bizid:'25',operation:'98',result:'0',source:'0',message:skuId+' mobile detail loaded rightly'});$('#'+commId).html(str).attr('hasdata','1');itemComm.transEmbed(commId);if(json.isMobileDesc){$('#'+pcLinkId).show();bindImgEvents(opt);}
callback&&callback(json);itemComm.initLoadImg({commId:commId});};if(jsonData){window.commDetMobileCallBack(jsonData);}else{descriptionId=(descriptionId||'d'+skuId);if(gVar.cdnGray&&!gVar.cdnFail[skuId]){window['cb'+skuId]=function(json){if(json&&json.retry==='1'){JD.report.umpBiz({bizid:'25',operation:'98',result:'3',source:'0',message:skuId+' mobile detail response retry'});gVar.cdnFail[skuId]=true;loadCommDetMobile(opt);return;}
window.commDetMobileCallBack(json);};mLs.loadScript({url:cgiUrl.cdnCommdet+skuId+'_'+descriptionId+'_'+userType+'.html',setReportUrl:function(){return cgiUrl.cdnCommdet;},onError:function(){window.commDetMobileCallBack({});}});}else{mLs.loadScript({url:cgiUrl.commdet+'callback=commDetMobileCallBack&source=wxsqitemsou&skuId='+skuId+'&k='+descriptionId+'&type='+userType,onError:function(){window.commDetMobileCallBack({});}});}}}
function globalBuyNotice(opt){var jsonData=opt.json,category1=opt.category,callback=opt.callback,globalType=opt.type,commId=opt.commId;if(!category1||!(globalType>0))return;window.globalBuyNoticeCB=function(json){var $dom=$('#'+commId);if(json.resultCode=='1'&&json.notices&&json.notices.length){var notices=[];for(var i=0,leni=json.notices.length;i<leni;i++){if(json.notices[i].htmlNotice)notices.push(json.notices[i].htmlNotice);}
$dom.html(itemComm.tavlHTML(notices.join(''))).attr('hasdata','1').find('a').attr('href','javascript:void(0);');itemComm.initLoadImg({commId:commId});}else{$dom.attr('hasdata','0');}
callback&&callback(json);};if(jsonData){window.globalBuyNoticeCB(jsonData);}else{mLs.loadScript(cgiUrl.notice+'callback=globalBuyNoticeCB&platform=3&type='+globalType+'&category='+category1+'&t='+Math.random());}}
function bindImgEvents(opt){var pcLinkId=opt.pcLinkId,commId=opt.commId,callback=opt.callback;$('#'+pcLinkId).off().on('click',function(){opt.showMobileDet=false;opt.json=null;opt.callback=function(json){callback&&callback(json);if($('#detailBaseLine').offset())window.scrollTo(0,$('#detailBaseLine').offset().top+20);setTimeout(function(){var $em;for(var i=0;i<3;i++){$em=$('#'+commId+' img').eq(i);var init_src=$em.attr('init_src');if(init_src)$em.attr('src',init_src);}},200);};loadCommDet(opt);});}
function loadCommParam(opt){var isZiying=opt.isZiying,packId=opt.packId,skuType=opt.skuType,jsonData=opt.json,expandAttrDesc=opt.expandAttrDesc,specificationId=opt.specificationId,skuId=opt.skuId,callback=opt.callback,isBjsp=false;if(opt.jdCategory&&opt.jdCategory.length>1&&['9193','9194','9195'].indexOf(opt.jdCategory[1])>=0){isBjsp=true;}
if(!packId)return;if((skuType==2||skuType==3)&&isZiying!==false){loadCommParamAct(opt);callback&&callback();return;}
var commParamPlanB=function(data){window.commParamBCallBack=function(json){var showBjsp=false;var NOtr='<tr><td></td><td>'+skuId+'</td></tr>',str='<table cellpadding="0" cellspacing="1" width="100%" border="0" class="Ptable">';if(json.success=='1'){var content=json.content.replace(/>[^<]+</g,function($0){var temp=$0.replace(/^>|<$/g,'').split('|');if(temp.length>1){return'><p style="position:relative;display:inline-block;padding-right:20px;">'+temp[0]+'<i class="inline_tip" tips="'+temp[1].replace(/\"/g,'&quot;')+'"></i></p><';}else{return $0;}});if(content&&content.indexOf('table')>-1&&content.indexOf('</td></tr>')>-1){str=content;}else if(expandAttrDesc){var strTbody='<tbody>',expandStr='',expandArr=[];for(var key in expandAttrDesc){expandArr=expandAttrDesc[key]||[];expandStr=(isType('Array',expandArr)?expandArr[0]:expandArr);if(expandStr)strTbody+=('<tr><td class="tdTitle">'+key+'</td><td>'+expandStr+'</td></tr>');}
strTbody+='</tbody>';str+=strTbody+'</table>';}
$('#'+packId).html(str);$('#'+packId+' table').addClass('param_table').prepend(NOtr);if(isBjsp){if(~str.indexOf('')&&~str.indexOf('')){showBjsp=true;}}}
if(showBjsp){$('#adultTip').html('<i class="info_icon"></i>').show();}
callback&&callback(json);}
if(data){commParamBCallBack(data);}else{mLs.loadScript(cgiUrl.commdet+'callback=commParamBCallBack&source=wxsqitemsou&k='+(specificationId||'g'+skuId));}};var overTimer=window.setTimeout(function(){commParamPlanB();},4000);window.commParamCallBack=function(json){if(json&&json.errcode==0&&json.data&&json.data.propGroups&&json.data.propGroups.length>0){window.clearTimeout(overTimer);var propGroups=json.data.propGroups,$packDom=$('#'+packId),showBjsp=false;var htmlArr=['<table cellpadding="0" cellspacing="1" width="100%" border="0" class="Ptable param_table"><tr><td></td><td>'+skuId+'</td></tr><tbody>'];propGroups.forEach(function(val,idx){if(val.groupName&&val.atts&&val.atts.length>0){htmlArr.push('<tr><th class="tdTitle" colspan="2">'+val.groupName+'</th></tr>');val.atts=val.atts.sort(function(a,b){return a.sort-b.sort;});val.atts.forEach(function(item,index){if(item.attName&&item.vals&&item.vals.length>0){if(item.attRemark){htmlArr.push('<tr><td class="tdTitle">'+item.attName+'<i class="inline_tip" tips="'+item.attRemark.replace(/\"/g,'&quot;')+'"></i></td><td>'+item.vals.join('')+'</td></tr>');}else{htmlArr.push('<tr><td class="tdTitle">'+item.attName+'</td><td>'+item.vals.join('')+'</td></tr>');}
if(isBjsp){if(item.attName===''&&~item.vals.indexOf('')){showBjsp=true;}}}});}});htmlArr.push('</tbody></table>');if(htmlArr.length>2&&$packDom.length){$packDom.html(htmlArr.join(''));}
if(showBjsp){$('#adultTip').html('<i class="info_icon"></i>').show();}
callback&&callback(json);}else{window.clearTimeout(overTimer);commParamPlanB();}};if(jsonData){if(jsonData.content&&jsonData.content.indexOf('table')>-1){window.clearTimeout(overTimer);commParamPlanB(jsonData);}else{window.commParamCallBack(jsonData);}}
else{mLs.loadScript(cgiUrl.newParam+'callback=commParamCallBack&skuid='+skuId+'&t='+Math.random());}}
function loadCommParamAct(opt){var packId=opt.packId,skuType=opt.skuType,info=opt.infoItem,skuId=opt.skuId;if(!packId||!info)return;var str='<table class="param_table">',tr=function(t,n){return'<tr><td>'+t+'</td><td>'+n+'</td></tr>';};str+=tr('',skuId);var bookKey={ISBN:"ISBN",ISSN:"ISSN",BookName:"",ForeignBookName:"",Language:"",Author:"",Editer:"",Proofreader:"",Remarker:"",Transfer:"",Drawer:"",Publishers:"",PublishNo:"",Series:"",Brand:"",Format:"",Package:"()",Pages:"",BatchNo:"",PublishTime:"",SizeAndHeight:"",ChinaCatalog:"",Sheet:"",Papers:"",Attachment:"",AttachmentNum:"",PackNum:"",Letters:"",KeyWords:"",PickState:"",Compile:"",Photography:"",Dictation:"",Read:"",Finishing:"",Write:"",saleDate:"",Format:"",PicNo:""};var actKey={Aka:"",Brand:"",Foreignname:"",ISBN:"ISBN",Mvd_Wxjz:"",Mvd_Gqyz:"",Mvd_wyjz:"",ISRC:"ISRC",Mvd_Dcz:"",Mvd_Xcyg:"",Press:"",Publishing_Company:"",Production_Company:"",Copyright:"",Actor:"",Director:"",Dub:"",Voiceover:"",Screenwriter:"",Producer:"",Singer:"",Performer:"",Authorsstr:"",Compose:"",Command:"",Orchestra:"",Media:"",Soundtrack:"",Number_Of_Discs:"",Episode:"",Record_Number:"",Publication_Date:"",Release_Date:"",ReleaseDate:"",Accessories:"",Included_Additional_Item:"",Set_The_Number_Of:"",Format:"",Color:"",Region:"",Length:"",Screen_Ratio:"",Audio_Encoding_Chinese:"",Quality_Description:"",Dregion:"",Language:"",Language_Dubbed:"",Language_Subtitled:"",Version_Language:"",Language_Pronunciation:"",Menu_Language:"",Version:"",Type:"",Platform:"",Minimum_System_Requirement_Description:"",Recommended_System_Description:"",Online_Play_Description:"",Awards:"",Type_Keywords:"",Keywords:"",Readers:"",Number_Of_Players:"",Mfg_Minimum:"",Mfg_Maximum:"",Compile:"",Photography:"",Dictation:"",Read:"",Finishing:"",Write:"",Version:"",Color:"",Type:"",Format:"",saleDate:":"};if(skuType=='2'){for(var k in bookKey){if(info[k])str+=tr(bookKey[k],info[k]);}}else if(skuType=='3'){if(!info.Authorsstr){info.Authorsstr='';var tmp=[],aut=info.Authors||[],item={};for(var i=0;i<aut.length;i++){item=aut[i];item.author=item.author||[];for(var j=0;j<item.author.length;j++){tmp.push(item.author[j].author);}}
info.Authorsstr=tmp.join('');}
for(var k in actKey){if(info[k])str+=tr(actKey[k],info[k]);}}
$('#'+packId).html(str+'</table>');}
function loadPackgeSer(opt){var jsonData=opt.json,skuId=opt.skuId,callback=opt.callback,$detServer=$('#'+opt.detServer),$detPackage=$('#'+opt.detPackage);window.packageService=function(json){$detServer.html(json.afterSale||'');$detPackage.html(json.packList||'');callback&&callback(json);};if(jsonData){window.packageService(jsonData);}
else{if(!skuId)return;mLs.loadScript(cgiUrl.commdet+'k1='+skuId+'&source=wxsqitemsou&callback=packageService&t='+Math.random());}}
function isType(type,obj){return Object.prototype.toString.call(obj)==="[object "+type+"]"}
exports.setDetPadding=setDetPadding;exports.loadCommDet=loadCommDet;exports.loadCommParam=loadCommParam;exports.loadPackgeSer=loadPackgeSer;exports.globalBuyNotice=globalBuyNotice;});
;define("jdVideo",function(require,exports,e){"use strict";var _cacheThisModule_;var i=require("ui"),t=require("zepto"),o='<div class="play_btn" #show#></div>',n='<div class="video_loading" style="display: none"><i></i></div>',r='<div class="loading_info" style="display: none;"><img #src#/></div>',a="<img #src#/>",l='<div class=controlBar><div class=playBtn #nologo#><div class="play pBack" data-type=1></div><div class="pause pBack" data-type=2 style="display:none;"></div></div><div class="pBack playScroll" #nologoScroll# data-type=3><div class="barIco pBack" data-type=4></div><div class="playBar pBack playBack"></div><div class="bufferBar pBack playBack"></div><div class=time></div><div class=duration></div></div>#fullScreen#<div class=logo #nologLogo#><a href="#logoUrl#" style="display: block; "><img #src#></a></div></div>',s=g(),c=S(),d=JD.device.scene=="weixin"?1:0,f=navigator.userAgent,u=f.indexOf("Android")>-1||f.indexOf("Adr")>-1,v="";var p="//img11.360buyimg.com/jdphoto/";var m=setTimeout;var h={alertWifi:true,logoUrl:"//wqs.jd.com/",controlLogo:p+"s120x120_jfs/t5926/19/9735735212/19898/552afed6/5996c3f7N6a35210d.png",loadIngImg:p+"s300x225_jfs/t7750/306/693226527/33971/c53483cc/5996497fNe2c48721.png",autoplay:0,controlHeight:"-40",videoLogo:p+"s28x20_jfs/t9289/125/380510113/18261/1f420488/59a6af86Ne5ef1841.png"};exports.init=function(e){for(var i in e){h[i]=e[i]}if(JD.url.getUrlParam("ignore"))h.alertWifi=false;var o=t(".jdvideo_div");if(o.length==0)return;y(o)};function g(){return/ip(?:hone|ad|od)/.test(navigator.userAgent.toLowerCase())}function y(e){e.forEach(function(e){if(t(e).find("video").length==0&&!t(e).attr("src")||t(e).data("evented"))return;t(e).css("position","relative !important");var i=(!u||!d)&&h.autoplay==1;if(t(e).find("video").length>0){b(t(e),1,i)}else{b(t(e),0,i)}if(i){k(1,t(e));if(d){if(window.WeixinJSBridge){setTimeout(function(){_(t(e),1)},100)}else{document.addEventListener("WeixinJSBridgeReady",function(){_(t(e),1)})}}else{_(t(e),1)}return}_(t(e))})}function w(e,i,t,o){JD.report.umpBiz({bizid:o?o:"427",operation:e,result:i,source:"0",message:t||""})}function B(e,i){JD.events.trigger(e,i)}function T(e){return JD.img.getScaleImg(e)}function b(e,i){var d="";var f="";var u="",v="";var p=t(e).find("video");h.videoLogo&&(u=a.replace("#src#","src='"+T(h.videoLogo)+"' class='video_logo'"));if(!i){d='<video #contr# style="display: none;" preload="none" style="margin: auto;" webkit-playsinline="true" playsinline ></video>';h.loadIngImg&&(v=r.replace("#src#",'src="'+T(h.loadIngImg)+'"'))}if(e.attr("controls")||s||i&&p.attr("controls")){var m=o;if(i){p.attr("controls","controls");m=o.replace("#show#","style='display:none;'")}else{d=d.replace("#contr#","controls='controls'")}f=d+n+m+v+u}else{var g=l;if(h.controlLogo){g=g.replace("#logoUrl#",T(h.logoUrl)).replace("#src#","src='"+T(h.controlLogo)+"'")}else{g=g.replace("#nologLogo#","style='display:none'").replace("#nologo#","style='margin-left:-30px;'").replace("#nologoScroll#","style='margin-left:-30px;'")}if(c){g=g.replace("#fullScreen#",'<div class="full" data-type="5"><div class="fullScreen pBack"></div></div>')}else{g=g.replace("#fullScreen#","")}f=d+g+n+o+v+u}e.append(f)}function S(){var e=document.documentElement;return"requestFullscreen"in e||"webkitRequestFullScreen"in e}JD.events.listen("pageshow",function(){var e=document.querySelectorAll(".jdvideo_div video"),i=e.length;if(i==0)return;for(var t=0;t<i;t++){e[t].pause()}});function P(e){this._init(e)}P.fn=P.prototype;P.fn._init=function(e){var i=this;i.opt=e;i.item=e.item;var o=t(e.item).find("video");i.loadTimes=0;i.timer=0;i.controlTime=0;i.video=o;i.ld=o.siblings(".video_loading");i.pB=o.siblings(".play_btn");i.ldi=o.siblings(".loading_info");i.ow=0;i.errored=0;i.c=o.siblings(".controlBar");i.vpuB=i.c.find(".pause");i.vpB=i.c.find(".play");i.duration=o.data("duration")||0;i.isCd=false;i.lp=0;i.cS=0;i.loopTimes=1;i.isSelf=typeof o.attr("controls")=="undefined"?0:1;if(e.play){i.firstPlay()}i.bindEvent()};P.fn.firstPlay=function(){var e=this;var i=e.item.offset()||{height:200};e.ldi.css("line-height",i.height+"px");e.detectWifi(function(){e.pB.hide();e.item.find(".poster").hide();e.ldi.show();e.detectNetwork();e.tapPlay()})};P.fn.detectWifi=function(e){if(h.alertWifi){JD.device.getNetwork(function(t){if(t.toLowerCase()!="wifi"){var o={msg:"wifi,",icon:"info",okText:"",cancelText:"",onConfirm:function(){e()}};i.confirm(o)}else{e()}})}else{e()}};P.fn.detectNetwork=function(){var e=this;m(function(){if(!e.started){var t={msg:"",icon:"info"};i.info(t);m(function(){if(!e.started){var t={msg:"~",icon:"info",okText:"",cancelText:"",onConfirm:function(){},onCancel:function(){e.tapPlay()}};i.confirm(t)}},3e3)}},8e3)};P.fn.bindEvent=function(){var e=this;e.opt.eventArray&&e.opt.eventArray.forEach(function(i){e.video.on(i,function(){e[i].apply(e)})});e.pB.on("click",function(i){i.stopPropagation();if(!e.started){e.firstPlay()}else{e.tapPlay.apply(e)}});e.item.on("click","video",function(i){i.stopPropagation();e.cS=!e.cS;e.detectControl()});e.item.on("touchstart",".barIco",function(i){e.movePos=1});e.item.on("touchmove",".barIco",function(i){if(!e.movePos)return;e.moveBarIcon(i)});e.item.on("touchend",".barIco",function(i){e.video[0].currentTime=e.movePos;e.movePos=0;e.detectControl()});e.c.on("click","div",function(i){i.stopPropagation();e.handleControl(t(i.currentTarget),i)})};P.fn.handleControl=function(e,i){var t=e.data("type");if(!t){e=e.parent();t=e.data("type");if(!t){return}}var o=this;var n=o.item;var r=o.video;if(!r||r.length==0)return;o.detectControl();if(t==1){r[0].play();o.vpB.hide();o.vpuB.show();return}if(t==2){r[0].pause();o.vpuB.hide();o.vpB.show();return}if(t==3){var a=n.find(".playScroll").offset();var l=(i.pageX-a.left)/a.width;var s=l*o.duration;r[0].currentTime=s;var c=l*a.width;n.find(".barIco").css("left",c);n.find(".playBar").css("width",c);o.vpB.hide();o.vpuB.show();r[0].play();return}if(t==4){return}if(t==5){var d=r.get(0);if(d.requestFullscreen){d.requestFullscreen()}else if(d.webkitRequestFullScreen){d.webkitRequestFullScreen()}return}};P.fn.moveBarIcon=function(e){var i=this;var t=e.touches[0].pageX;if(t<i.ol)t=i.ol;else if(t>i.or)t=i.or;var o=t-i.ol;var n=o/i.ow*i.duration;i.movePos=n;i.moveProcess(o,n)};P.fn.moveProcess=function(e,i){var t=this;t.c.find(".barIco").css("left",e);t.c.find(".playBar").css("width",e);t.coputeUpdateTime(i)};P.fn.detectControl=function(){var e="5",i=this;clearTimeout(i.controlTime);if(i.cS){e=h.controlHeight;i.c.show();i.controlTime=m(function(){if(i.movePos)return;e="5";i.cS=false;if(i.timer==0){i.c.show();e=h.controlHeight;i.cS=true}else{t()}m(function(){i.c.css("marginTop",e+"px")},50)},5e3)}else{t()}m(function(){i.c.css("marginTop",e+"px")},50);function t(){m(function(){i.c.hide()},1e3)}};P.fn.playing=function(){var e=this;e.lp=0;if(e.timer)return;e.ldi.hide();e.video.show();!e.started&&(e.item.css({height:e.item.height()+2+"px",position:"relative !important"}),k(0,e.item));e.started=1;e.computeDuration();B("video_play",{code:0});w(4,0);e.ld.hide();e.pB.hide();e.vpB.hide();e.vpuB.show();e.loadTimes=0;m(function(){e.c.show();m(function(){e.cS=1;e.detectControl()},500)},1500);e.timer=setInterval(function(){e.loadTimes++;if(e.loadTimes>=2){e.ld.show()}else{e.ld.hide()}if(e.video[0].ended){e.clearTimer()}k(++e.loopTimes,e.item)},3e3)};P.fn.timeupdate=function(){var e=this;e.ld.hide();e.pB.hide();e.loadTimes=0;var i=e.video[0].currentTime;if(!e.ow){if(e.c.find(".playScroll").length>0){var t=e.c.find(".playScroll").offset();e.ow=t.width;e.ol=t.left;e.or=t.left+t.width}}var o=i/e.duration*e.ow;!e.movePos&&e.moveProcess(o,i)};P.fn.abort=function(){this.errors("abort:"+this.video[0].error)};P.fn.errors=function(e){var i=this;i.ld.hide();i.pB.show();i.clearTimer();i.errored++;if(i.errored<3){i.tapPlay()}else{w(4,1,e);B("video_play",{code:1,msg:i.video[0].error})}};P.fn.error=function(){this.errors("error:"+this.video[0].error)};P.fn.ended=function(){var e=this;e.ld.hide();e.pB.show();e.cS=0;e.detectControl();e.clearTimer();t(e.item).find(".time").html(t(e.item).find(".duration").html())};P.fn.pause=function(){var e=this;e.ld.hide();!e.isSelf&&e.pB.show();e.vpuB.hide();e.vpB.show();e.clearTimer()};P.fn.clearTimer=function(){var e=this;clearInterval(e.timer);e.ld.hide();e.timer=0};P.fn.durationchange=function(){this.computeDuration()};P.fn.loadedmetadata=function(){this.computeDuration()};P.fn.computeDuration=function(){var e=this;if(e.isCd)return;var i=e.video[0].duration;if(i>0){e.isCd=true;e.video.data("duration",i);e.duration=i;t(e.item).find(".duration").html(I(i));t(e.item).find(".time").html("00:00")}};P.fn.coputeUpdateTime=function(e){e=parseInt(e);if(Math.abs(e-this.lp)>=1){t(this.item).find(".time").html(I(e));this.lp=e}};P.fn.tapPlay=function(){var e=this;var i=function(){if(e.errored)e.video[0].load();e.pB.hide();e.vpB.hide();e.vpuB.show();e.video[0].play();e.errored=0};if(!e.video.attr("src")){e.video.attr("src",e.item.attr("src"));setTimeout(function(){i()},300)}else{i()}};function k(e,i){if(!h.rpt_t)return;if(!v&&typeof getFingerPrint=="function"){var t=getFingerPrint();v=t[2]}var o=i.attr("rpt_type");JD.sendJs("//wq.jd.com/ubanalysis?d="+e+"&t="+h.rpt_t+"&f="+v+"&tp="+((typeof o=="undefined"?h.rpt_type:o)||""))}function I(e){if(isNaN(e))return"";var i="";var t=parseInt(e/3600);if(t>0){if(t<10){i="0"+t}else{i=t}i+=":"}var o=e%3600;var n=parseInt(o/60);if(n<10){i+="0"+n}else{i+=n}i+=":";var r=Math.floor(o%60);if(r<10){i+="0"+r}else{i+=r}return i}function _(e,i){var o=t(e).find("video");t(e).data("evented",1);new P({item:e,eventArray:["playing","timeupdate","abort","error","ended","pause","durationchange","loadedmetadata"],play:i||0})}});;define("jd.item.detail",function(require,exports,module){var _cacheThisModule_,$=require('zepto'),util=require('util'),loopScroll=require('loopScroll'),commDet=require('wq.item.detail'),itemComm=require('wq.item.common'),mWfdata=require('wfdata'),mLs=require('loadJs'),jdVideo=require('jdVideo'),urlParam=require('url'),itemUtil=require('jd.item.util'),popUp=itemUtil.popUp,imageViewer=itemUtil.imageViewer,$jsonToTpl=itemUtil.$jsonToTpl,isWX=util.isWX(),pageWidth=$(window).width(),commParamkeyValues={},keyParametersValues={};var Detail=function(){var opt={isMScene:false,isJDChoice:false,isPlus:false,skuId:'',addBrandAct:false,addAd:false,isZiying:false,isFCS:false,venderId:'',skuType:'',descriptionId:'',specificationId:'',itemInfo:{},spAttr:{},expandAttrDesc:{},isOverseaPurchase:false,jdCategory:[],taxInfo:{},videoId:'',mainImgs:[],isLoadDet:[1,0,1,0],detIndex:0,detLowH:0,detailH:0,jdSkuInfo:{},showMobileDet:true};$.extend(this,opt);};Detail.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.detLowH=$(window).height()-$('#detailTab').height()+20;obj.setDetTab();obj.keyParameters();obj.detailAdvertise();obj.videoDetail();obj.globalBuyNotice();obj.reminder();obj.adjust();obj.bindEvent();if(config.jdCategory&&config.jdCategory.length>1&&['9193','9194','9195'].indexOf(config.jdCategory[1])>=0){obj.loadCommParam();}};Detail.prototype.refresh=function(config){config=config||{};var obj=this;var lastSkuId=obj.skuId;$.extend(obj,config);$('#videoMain').hide();$('#reminder').hide();obj.showMobileDet=true;if(lastSkuId!=obj.skuId)obj.keyParameters();obj.getTabData();obj.videoDetail();obj.globalBuyNotice();obj.reminder();obj.adjust();};Detail.prototype.adjust=function(){var obj=this;if(obj.isZiying&&obj.jdCategory[0]=='12218'){$('#detServer,#serverPromise').hide();$('#freshServerPromise').show();}
if(!obj.isZiying&&!obj.isFCS){$('#serverPromise').hide();}
if(obj.spAttr.sfkc==='1'){$('#skusfkc').show();}else{$('#skusfkc').hide();}};Detail.prototype.setDetTab=function(){var obj=this,wb=document.body.clientWidth;loopScroll.init({moveDom:$('#detailCont'),moveChild:$('#detailCont > div'),tab:$('#detailTab div.item'),viewDom:$('#detailCont'),index:1,lockScrY:true,min:pageWidth,step:Math.min(pageWidth,wb||540),fun:function(index){obj.showDetTab(index);}});};Detail.prototype.showDetTab=function(index){var obj=this,isChange=obj.detIndex!=index;if(!isChange)return;obj.detTabH=$('#detailBaseLine').offset().top;$.publish('item.detail.changeTab',[index,isChange]);obj.detIndex=index;if(index==1)obj.loadCommDet();if(index==2){obj.loadCommParam();obj.loadPackgeSer();}
if(index==3){obj.loadPackgeSer();if(!(obj.isOverseaPurchase>0)&&~' 798 870 878 880 12392 13690 13298 1300 757 758 753 751 672 1105 673 12798 688 717 718 720 719 722 1649 '.indexOf(' '+obj.jdCategory[2]+' ')){$('#ecoTip').show();}else{$('#ecoTip').hide();}
$('#detail3Normal').show();}
obj.setDetHeight();};Detail.prototype.getTabData=function(){if(this.detIndex==3){this.loadPackgeSer();}else if(this.detIndex==2){this.loadCommParam();this.loadPackgeSer();}else if(this.detIndex==1){this.loadCommDet();}};Detail.prototype.keyParameters=function(){var $keyParametersFloor=$('#keyParametersFloor');$keyParametersFloor.hide();var obj=this;if(!window.showPageData36260){window.showPageData36260=function(json){obj.jdSkuInfo.keyParameters=json;var data=(json&&json.data)||[];commParamkeyValues[obj.skuId]={};data.forEach(function(item){item=item||{};var content=item.content||[];if(content.length>2&&~(('|'+item.cid3s+'|').indexOf('|'+obj.jdCategory[2]+'|'))){var contentCanShow=content.filter(function(p){return p&&p.name&&p.image&&p.categoryGroupAttId;});if(contentCanShow.length<3)return;obj.loadCommParam(function(json){var commParams=json&&json.data;if(!commParams)return;var propGroups=commParams.propGroups;if(!propGroups||propGroups.length<=0)return;propGroups.forEach(function(v){if(!v)return;var atts=v.atts;if(!atts||atts.length<=0)return;atts.forEach(function(a){if(a&&a.categoryGroupAttId&&a.vals&&a.vals.length>0)commParamkeyValues[obj.skuId][a.categoryGroupAttId]=a.vals[0];});});contentCanShow=contentCanShow.filter(function(c){return!!commParamkeyValues[obj.skuId][c.categoryGroupAttId];});if(contentCanShow.length<3)return;var html='';contentCanShow.forEach(function(cont,index){if(index>7)return;cont.value=commParamkeyValues[obj.skuId][cont.categoryGroupAttId];html+='<div class="key_parameters_item"><img src="'+cont.image+'" /><p class="item_name">'+cont.name+'</p><p class="item_value">'+cont.value+'</p></div>';});keyParametersValues[obj.skuId]=contentCanShow;if(contentCanShow.length>4){$keyParametersFloor.addClass('scroll_container');}else{$keyParametersFloor.removeClass('scroll_container');}
$keyParametersFloor.html(html).show();itemUtil.reporter.reportExposure({ptag:'7001.1.354'});});}});};}
if(obj.jdSkuInfo.keyParameters){window.showPageData36260(obj.jdSkuInfo.keyParameters);return;}
mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v36260'}});};Detail.prototype.loadCommParam=function(callback){var obj=this;$('#package').hide();if(obj.isLoadDet[1]==obj.skuId){callback&&callback(obj.jdSkuInfo['param']&&obj.jdSkuInfo['param'][obj.skuId]);return;}
if(!obj.jdSkuInfo['param'])obj.jdSkuInfo['param']={};commDet.loadCommParam({isZiying:obj.isZiying,packId:'detParam',json:obj.jdSkuInfo['param'][obj.skuId],skuType:obj.skuType,infoItem:obj.itemInfo,expandAttrDesc:obj.expandAttrDesc,specificationId:obj.specificationId,skuId:obj.skuId,jdCategory:obj.jdCategory,callback:function(json){obj.jdSkuInfo['param'][obj.skuId]=json;obj.isLoadDet[1]=obj.skuId;callback&&callback(json);}});};Detail.prototype.loadCommDet=function(){if(this.isLoadDet[0]==this.skuId)return;var obj=this,key=obj.skuId,skuType=obj.skuType;if(obj.addBrandAct)obj.brandActInfo();if(obj.addAd)obj.adPosition();if(!obj.jdSkuInfo['det'])obj.jdSkuInfo['det']={};if(skuType!=2&&skuType!=3&&!obj.isZiying&&obj.venderId*1){key=obj.venderId;if(obj.jdSkuInfo['det'][key])return;}
if(obj.jdSkuInfo['det'][key+'pcdet']){obj.showMobileDet=false;key+='pcdet';}
if(skuType==2||skuType==3){$('#commDesc').addClass('strong_link');}else{commDet.setDetPadding({containerId:'detail1',padding:0});}
commDet.loadCommDet({commId:'commDesc',showMobileDet:obj.showMobileDet,pcLinkId:'pcItemLink',json:obj.jdSkuInfo['det'][key],skuType:skuType,descriptionId:obj.descriptionId,skuId:obj.skuId,isPlus:obj.isPlus,mainImgs:obj.mainImgs,callback:function(json){if(json.showMobileDet=='1'&&key.indexOf('pcdet')==-1)key+='pcdet';obj.jdSkuInfo['det'][key]=json;obj.isLoadDet[0]=obj.skuId;setTimeout(function(){var em=$('#commDesc img').eq(0),init_src=em.attr('init_src');if(init_src)em.attr('src',init_src);},2000);obj.setDetHeight();}});};Detail.prototype.brandActInfo=function(){var obj=this,brandId=obj.itemInfo.brandId,category=obj.jdCategory;if(!brandId||!category||obj.jdSkuInfo['brand_'+brandId+'_'+category[2]])return;var url='//wq.jd.com/commodity/itembranch/getbrandactivity?callback=brandactivityCb&brandid='+brandId+'&cat='+category[2]+(obj.isMScene?'&sceneval=2':'');window.brandactivityCb=function(json){if(json.errcode==0&&json.data&&json.data.success&&json.data.objs&&json.data.objs.length>0){json.data.objs=json.data.objs.filter(function(s){return s&&s.platform&&(isWX?s.platform&4==4:s.platform&8==8);});if(json.data.objs.length<=0){return;}
json.data.objs=json.data.objs.sort(function(a,b){return parseInt(a.type)-parseInt(b.type);});var $dom=$('#brandAct'),nowTime=(new Date()).getTime(),linkReg=/<a([^>]+)href\s*=\s*"([^"]+)"(.*?\/a>[,\?\.!:]*)/ig,content='';var linkAddPtag=function(html,ptag){html=html.replace(linkReg,function($0,$1,$2,$3){return(html?('<a'+$1+'href="'+JD.url.addRd($2,ptag)+'" '+$3).replace('_blank','_self'):'');});return html;};var insertHtml=function(id,dom,item,idx){if(parseInt(item.begintime)<nowTime&&nowTime<parseInt(item.endtime)){content=linkAddPtag(itemComm.tavlHTML(item.content),'37287.7.2');if(content){dom.append('<div><div id="'+id+'_'+idx+'" class="detail_pc">'+content+'</div></div>');itemComm.initLoadImg({commId:id+'_'+idx});}}};json.data.objs.forEach(function(val,idx){insertHtml('brandAct',$dom,val,idx);$dom.show();});}};mLs.loadScript({url:url});obj.jdSkuInfo['brand_'+brandId+'_'+category[2]]=true;};Detail.prototype.adPosition=function(){var obj=this,category=obj.jdCategory;if(!window.showPageData31886){window.showPageData31886=function(json){obj.jdSkuInfo.adPosition=json;var dataItem,data=json.data,adId='',adIdArr=[];$.each(data,function(index,el){dataItem=el.list.filter(function(s){return s&&s.categoryId&&s.category&&category[(s.category-1)]&&~s.categoryId.indexOf('|'+category[(s.category-1)]+'|');})[0];if(dataItem)return false;});if(dataItem){adId=dataItem.adId||'';adIdArr=adId.split('|');if(adIdArr[0]==''){adIdArr=adIdArr.slice(1,adIdArr.length);}
if(adIdArr[adIdArr.length-1]==''){adIdArr=adIdArr.slice(0,(adIdArr.length-1));}
if(adIdArr.length>0){var index=0;var nextUrl=function(){index++;if(index<adIdArr.length){mLs.loadScript('//nfa.jd.com/cpd_comm?aid='+adIdArr[index]+'&t='+Math.random());}};window.cpdCommCB=function(ad){ad=ad||[];if(ad.length>0){var divDom='<div><div class="detail_pc" id="adPosition'+index+'"></div></div>',tpl='<a href="{#href#}"><img item_init_src="{#src#}" src="//wq.360buyimg.com/fd/h5/base/detail/images/transparent_a38f0a03.png" alt="{#alt#}"></a>',$rootDom=$('#adPosition'),html=[];$rootDom.append(divDom).show();var $dom=$('#adPosition'+index);for(var i=0,leni=ad.length;i<leni;i++){ad[i].href=decodeURI(urlParam.getUrlParam('url',ad[i].href));ad[i].href=JD.url.addRd(ad[i].href,'37287.7.1');ad[i].src=JD.img.getImgUrl(ad[i].src);html.push($jsonToTpl(ad[i],tpl));}
$dom.html(itemComm.tavlHTML(html.join('')));itemComm.initLoadImg({commId:'adPosition'+index});}
nextUrl();};mLs.loadScript('//nfa.jd.com/cpd_comm?aid='+adIdArr[0]+'&t='+Math.random());}}};}
if(obj.jdSkuInfo.adPosition){window.showPageData31886(obj.jdSkuInfo.adPosition);return;}
mWfdata.getData({dataType:mWfdata.DataType.PPMS,param:{key:'v31886'}});};Detail.prototype.detailAdvertise=function(){var obj=this;if(obj.isJDChoice||!obj.venderId||obj.isZiying)return;var $detailAdvertise=$('#detailAdvertise');window.detailAdvertisePostCB=function(json){if(json.errcode===0&&json.data&&json.data.appContent){json.data.appContent=$.trim(json.data.appContent);if(json.data.appContent){if(!$('#detailAdvertisePost').length){json.data.appContent='<div><div class="detail_pc" id="detailAdvertisePost">'+json.data.appContent+'</div></div>';$detailAdvertise.append(itemComm.tavlHTML(json.data.appContent)).show();itemComm.initLoadImg({commId:'detailAdvertisePost'});}
$('#detailAdvertisePost').show();}}};mLs.loadScript('//wq.jd.com/commodity/introduction/getposter?callback=detailAdvertisePostCB&venderId='+obj.venderId+(obj.isMScene?'&sceneval=2':''));var wareId=(obj.descriptionId||'').replace(/^d/,'');if(wareId){window.detailAdvertiseStyleCB=function(json){if(json.errcode===0&&json.data){var result=json.data;result.mobileHeadContent=$.trim(result.mobileHeadContent);result.mobileBottomContent=$.trim(result.mobileBottomContent);if(result.mobileHeadContent){result.mobileHeadContent='<div><div class="detail_pc" id="detailAdvertiseStyle">'+result.mobileHeadContent+'</div></div>';if(!$('#detailAdvertiseStyle').length){$detailAdvertise.append(itemComm.tavlHTML(result.mobileHeadContent)).show();itemComm.initLoadImg({commId:'detailAdvertiseStyle'});}
$('#detailAdvertiseStyle').show();}
if(result.mobileBottomContent){$('#detailAdvertise1').html(itemComm.tavlHTML(result.mobileBottomContent)).show();itemComm.initLoadImg({commId:'detailAdvertise1'});}}};mLs.loadScript('//wq.jd.com/commodity/introduction/gettemplate?callback=detailAdvertiseStyleCB&venderId='+obj.venderId+'&wareId='+wareId+(obj.isMScene?'&sceneval=2':''));}};Detail.prototype.videoDetail=function(){var obj=this,videoId=obj.videoId;if(obj.isJDChoice||!videoId)return;window.videoDetailCB=function(json){if(json.errcode==0&&json.result&&json.result.data&&json.result.data.length>0){obj.jdSkuInfo['video2'+obj.skuId]=json;var definitionObj={'low':1,'high':2,'yuanhua':3},urlObj=json.result.data.filter(function(s){return s&&s.main_url;}).sort(function(a,b){return definitionObj[a.sharpness]-definitionObj[b.sharpness];})[0];if(!urlObj)return;var imageUrls=json.result.imageUrls;if(imageUrls&&imageUrls.length>0){$('#videoMain').attr('src',urlObj.main_url);$('#videoMain').html('<img class="poster" src="'+imageUrls[0]+'">');}else{$('#videoMain').html('<video preload="metadata" webkit-playsinline="true" playsinline><source id="videoDetail" src="'+urlObj.main_url+'" type="video/mp4"></video>');}
jdVideo.init({autoplay:0,alertWifi:false,logoUrl:'javascript:void(0);',controlLogo:''});$('#videoMain').css('margin-bottom','10px').show();itemUtil.reporter.reportExposure({ptag:'7001.1.175'});}};if(obj.jdSkuInfo['video2'+obj.skuId]){window.videoDetailCB(obj.jdSkuInfo['video2'+obj.skuId]);}else{mLs.loadScript('//wq.jd.com/commodity/extension/getplayurl?callback=videoDetailCB&type=1&vid='+videoId+(obj.isMScene?'&sceneval=2':''));}};Detail.prototype.globalBuyNotice=function(){var obj=this;if(!obj.isOverseaPurchase)return;obj.setOverseaTip();if(!obj.jdSkuInfo.globalNotice)obj.jdSkuInfo.globalNotice={};var category1=obj.jdCategory[0];if(!obj.isJDChoice){commDet.globalBuyNotice({json:obj.jdSkuInfo.globalNotice[category1],commId:'globalNoticeArea',category:category1,type:obj.isOverseaPurchase,callback:function(json){obj.jdSkuInfo.globalNotice[category1]=json;$('#globalNotice,#globalComm')[$('#globalNoticeArea').attr('hasdata')=='1'?'show':'hide']();}});}};Detail.prototype.reminder=function(){var obj=this;var category3=obj.jdCategory[2];var $reminder=$('#reminder');if(~' 13690 13691 18578 18577 '.indexOf(' '+category3+' ')){$reminder.text('').show();}};Detail.prototype.setOverseaTip=function(){var obj=this,isOverseaPurchase=obj.isOverseaPurchase,spAttr=obj.spAttr;if(isOverseaPurchase>0&&!obj.isInitDetail){obj.isInitDetail=true;$('#detail3Normal').addClass('de_serve_info_page').html('<div class="de_serve_info_panel"> <div class="hd"> <div class="tit"></div> </div> <div class="bd"> <div class="section"> <div class="tit"></div> <div class="row"></div> <div class="step step_point col_6"> <div class="step_item"><i class="icon_1_1"></i><span></span></div> <div class="step_item"><i class="icon_1_2"></i><span></span></div> <div class="step_item"><i class="icon_1_3"></i><span></span></div> <div class="step_item"><i class="icon_1_4"></i><span></span></div> <div class="step_item"><i class="icon_1_5"></i><span></span></div> <div class="step_item"><i class="icon_1_6"></i><span></span></div>   </div> </div> <div class="section"> <div class="tit"></div> <ul class="list"> <li> <span class="num">01.</span>100% </li> <li> <span class="num">02.</span> <div class="step step_add"> <div class="step_item"><i class="icon_2_1"></i><span></span></div> <div class="step_item"><i class="icon_2_2"></i><span></span></div> <div class="step_item"><i class="icon_2_3"></i><span></span></div> <div class="step_item"><i class="icon_2_4"></i><span></span></div> </div> </li> <li> <span class="num">03.</span> <div class="step step_add"> <div class="step_item"><i class="icon_3_1"></i><span></span></div> <div class="step_item"><i class="icon_3_2"></i><span></span></div> <div class="step_item"><i class="icon_3_3"></i><span></span></div> </div> </li> <li> <span class="num">04.</span>2000 <span class="tip"></span>2000</li> <li> <span class="num">05.</span> <span class="tip"></span> </li> <li> <span class="num">06.</span> 7 <div class="step step_add"> <div class="step_item"><i class="icon_4_1"></i><span>7 </span></div> </div> </li> </ul> '+((isOverseaPurchase==1||isOverseaPurchase==3)?'<div class="row"> </div>':'')+'<div class="row tip">*<dl><dd>1.'+(obj.isMScene?'mitem.jd.hk':'wqitem.jd.hk')+';</dd></dl><dl><dd>2.;</dd></dl><dl><dd>3.</dd></dl><dl><dd>4.</dd></dl><dl><dd>5.</dd></dl></div><div class="row" id="eBayTip">eBay<a href="//wqs.jd.com/help/ebay.html" style="color:#4e91fe">eBay</a></div></div></div></div>');$('#priceDescDetail').hide();$('#ecoTip').hide();}
if(spAttr.isEbay=='1'||spAttr.isEbay=='2'){$('#eBayTip').show();}else{$('#eBayTip').hide();}
if(obj.taxInfo&&obj.taxInfo.taxTitle&&obj.taxInfo.taxContent&&obj.taxInfo.taxDetail){var popTip='<dl><dd>'+obj.taxInfo.taxDetail.split('\r\n').join('</dd></dl><dl><dd>')+'</dd></dl>',wTip='';if(obj.taxInfo.nationName&&obj.taxInfo.nationImgMap&&obj.taxInfo.nationImgMap.m){wTip+='<span class="tax_tips_flag"><img src="'+obj.taxInfo.nationImgMap.m+'"></span>'
+'<span class="country">'+obj.taxInfo.nationName+'</span>';}
wTip+='<span class="tax_tips_text">'+obj.taxInfo.taxTitle+obj.taxInfo.taxContent+'</span><i class="ques"></i>';$('#taxTip').show().html(wTip).off().on('click','i.ques',function(){popUp.createPopup({flag:3,msg:'<h3 class="title"></h3><div class="inner" style="    text-align: left;">'+popTip+'</div>'});});}};Detail.prototype.loadPackgeSer=function(){var obj=this;if(!obj.jdSkuInfo['p_s'])obj.jdSkuInfo['p_s']={};commDet.loadPackgeSer({detServer:'detServer',detPackage:'detPackage',json:obj.jdSkuInfo['p_s'][obj.skuId],skuId:obj.skuId,callback:function(json){obj.jdSkuInfo['p_s'][obj.skuId]=json;$('#package')[json.packList?'show':'hide']();}});};Detail.prototype.setDetHeight=function(){var h=0;$('#detail'+this.detIndex).children().each(function(i,n){h+=$(n).height();});this.detailH=Math.max(h,this.detLowH);$('#detail').css('height',this.detailH+50);};Detail.prototype.bindEvent=function(){var obj=this;$(window).on('scroll',function(){obj.setDetHeight();if(obj.detIndex==1)itemComm.loadImg();});$('#detParam').on('click','i[tips]',function(){var tar=$(this),tips=tar.attr('tips');popUp.createPopup({flag:3,msg:'<div class="inner"><dl><dd>'+tips+'</dd></dl></div>'});});$('#commDesc,#globalNotice,#detailAdvertise,#detailAdvertise1').on('click','img',function(){var $this=$(this),src=$this.attr('prview')||$this.attr('src').replace(/\s+/g,''),aurl=$this.parents('a').attr('href');if(/^(https*:){0,1}\/\//.test(aurl))return;imageViewer.previewImage(src);});$('#keyParametersFloor').on('click',function(){if(!keyParametersValues[obj.skuId]||!keyParametersValues[obj.skuId].length)return;var html='<table><tbody>';keyParametersValues[obj.skuId].forEach(function(p){html+='<tr><td class="key">'+p.name+'</td><td>'+p.value+'</td></tr>';});html+='</tbody></table>';popUp.createPopDom({className:'parameters_detail_main',title:'',body:html,btnTxt:'',closeClass:'close_sp'});itemUtil.reporter.reports({ptag:'7001.1.355'});});};exports.init=function(config){var detail=new Detail();detail.init(config);return detail;};});
;define('spiderCheck',function(require,exports,module){var $=require('zepto'),ls=require('loadJs'),verifyImg='//wq.jd.com/bases/verify/captcha',tpl='<div style="display:none;position: fixed;top: 0;left: 0;bottom: 0;right: 0;z-index: 898;height: 100%;width: 100%;    background-color: rgba(0,0,0,.7);">'+'<div id="spiderCheckAlert" class="mod_alert" style="z-index: 899;position: fixed;left: 50%;top: 50%;margin: auto;-webkit-transform: translate(-50%,-50%);transform: translate(-50%,-50%);">'+'<i class="icon"></i>'+'<p area="alertTip">{#alertTip#}</p>'+'<div class="verify_input" style="position: relative;margin: 10px 0;padding: 0 90px 0 10px;background-color: #f7f7f7;">'+'<input class="input" type="text" area="verifyInput" style="padding: 7px 0;width: 100%;height: 30px;border: none;-webkit-appearance: none;color: #333;background-color: #f7f7f7;font-size: 14px;">'+'<span class="wrap" style="position: absolute;right: 2px;top: 2px;width: 80px;padding-top: 40px;">'+'<img src="'+verifyImg+'" alt="" area="verifyCodeImg" style="position: absolute;top: 0;right: 0;width: 80px;height: 40px;border-radius: 2px;"></span>'+'</div>'+'<p class="warn_text" area="warnTip" style="display: none;color: #e4393c;font-size: 12px;text-align: left;"></p>'+'<p class="btns" area="comfirmBtn"><a href="javascript:void(0);" class="btn btn_1"></a></p>'+'</div>'+'</div>',$spiderCheckAlert=$('#spiderCheckAlert'),$parentDiv=$('#spiderCheckAlert').parent('div'),$verifyInput=$spiderCheckAlert.find('[area="verifyInput"]'),$verifyCodeImg=$spiderCheckAlert.find('[area="verifyCodeImg"]'),$comfirmBtn=$spiderCheckAlert.find('[area="comfirmBtn"]'),$warnTip=$spiderCheckAlert.find('[area="warnTip"]'),$alertTip=$spiderCheckAlert.find('[area="alertTip"]'),scrollTop=0,config={source:'',successCB:null,errorCB:null},show=function(opt){opt=opt||{};$.extend(config,opt);config.alertTip=config.alertTip||'';verifyImg='//wq.jd.com/bases/verify/captcha?source='+config.source;showVerifyImg();bindEvent();},showVerifyImg=function(){if(!$spiderCheckAlert.length){$('body').append(tpl);$spiderCheckAlert=$('#spiderCheckAlert');$parentDiv=$('#spiderCheckAlert').parent('div');$verifyInput=$spiderCheckAlert.find('[area="verifyInput"]');$verifyCodeImg=$spiderCheckAlert.find('[area="verifyCodeImg"]');$comfirmBtn=$spiderCheckAlert.find('[area="comfirmBtn"]');$warnTip=$spiderCheckAlert.find('[area="warnTip"]');$alertTip=$spiderCheckAlert.find('[area="alertTip"]');}
scrollTop=$(window).scrollTop();$('body').css('top','-'+scrollTop+'px').addClass('overflowHide');$verifyCodeImg.attr('src',verifyImg+'&t='+Math.random());$alertTip.html(config.alertTip);$parentDiv.show();},bindEvent=function(){$verifyInput.off().on('focus',function(){$warnTip.hide();});$verifyCodeImg.off().on('click',function(){$verifyCodeImg.attr('src',verifyImg+'&t='+Math.random());});$comfirmBtn.off().on('click',function(){verifyCodeCheck();});},verifyCodeCheck=function(){var inputStr=$.trim($verifyInput.val());if(!inputStr){$warnTip.html('').show();config.errorCB&&config.errorCB();return;}
window.codeCheckCB=function(json){if(json.errCode=='0'){$('body').removeClass('overflowHide').css('top','');$(window).scrollTop(scrollTop);$verifyInput.val('');$parentDiv.hide();config.successCB&&config.successCB();}else{$warnTip.html('').show();config.errorCB&&config.errorCB();$verifyCodeImg.attr('src',verifyImg+'&t='+Math.random());}};ls.loadScript('//wq.jd.com/bases/verify/check?callback=codeCheckCB&source='+config.source+'&code='+inputStr);};exports.show=show;});
;define('jd.item.comment',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),itemComm=require('wq.item.common'),lazyLoad=require('lazyLoad'),ls=require('loadJs'),spiderCheck=require('spiderCheck'),itemUtil=require('jd.item.util'),getNetWork=itemUtil.getNetWork,reporter=itemUtil.reporter,imageViewer=itemUtil.imageViewer,popUp=itemUtil.popUp,pageWidth=$(window).width(),pageHight=$(window).height(),isAndroid=$.os&&$.os.android;var Comment=function(){var opt={isPingouScene:false,isMScene:false,isJDChoice:false,isAd2:false,guessGary:{},jdCategory:[],baseSkuId:'',skuId:'',cpart:'main',evalHold:false,evalTotal:0,evalPage:1,evalPageCur:1,evalLastPage:false,evalType:0,tagCount:{},isTagChoosed:false,defaultGoodCount:0,evalSkuCur:false,foldEvalIsOpen:false,isFoldEval:false,foldEvalPageCur:1,foldEvalLastPage:false,specReferrer:{'evalReply':false},jdSkuInfo:{},hasEnterSummaryPage:false,hideReply:false,hasSetEvalCount:0,hasSetTagCount:0};$.extend(this,opt);};Comment.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);$('#part_summary').css('min-height',pageHight);obj.setDefaultCommentShow();obj.loadEval(1);obj.bindEvent();};Comment.prototype.refresh=function(config){config=config||{};var obj=this;$.extend(obj,config);!obj.specReferrer.evalReply?obj.evalPageCur=1:'';!obj.specReferrer.evalReply?obj.evalType=obj.isJDChoice?0:0:'';obj.hasSetEvalCount=1;obj.hasSetTagCount=1;};Comment.prototype.setCpart=function(cpart){this.cpart=cpart;};Comment.prototype.enterSummary=function(){var obj=this;obj.hasEnterSummaryPage=true;obj.evalPageCur=1;if(!obj.evalType&&obj.evalType!==0){obj.evalType=obj.isJDChoice?0:0;}
$('#evalTag2 span[no="'+obj.evalType+'"]').addClass('selected').siblings().removeClass('selected');obj.cpart='summary';obj.loadEval(2);};Comment.prototype.setDefaultCommentShow=function(){var obj=this;if(!window._showCurrentSkuCommentConfig||!window._showCurrentSkuCommentConfig.length)return;var dataItem=window._showCurrentSkuCommentConfig.filter(function(s){return s&&s.categoryId&&s.category&&obj.jdCategory[(s.category-1)]&&~s.categoryId.indexOf('|'+obj.jdCategory[(s.category-1)]+'|');})[0];if(dataItem){obj.evalSkuCur=true;$('#evalCurOption').find('input').prop('checked','checked');}};Comment.prototype.setEvalHead=function(data,part){data=data||{};var obj=this;if(obj.hasSetEvalCount>1)return;obj.hasSetEvalCount++;var goodRateStr='',commentStr='';if(data.CommentCount>0&&data.GoodRate>0){goodRateStr=parseInt(data.GoodRate*100);commentStr=data.CommentCountStr;if(goodRateStr>=100&&data.PoorCount>0){goodRateStr='99';}
goodRateStr+='%';}
if(goodRateStr&&commentStr){if(part==1){$('#evalNo1, #evalNo2').text(commentStr);$('#evalNo2').parent().show();$('#commentChoice').find('div.detail_comment_num').text(''+commentStr+'');$('#evalRate').text(goodRateStr);$('#evalRateP').show();$('#commentChoice').find('p.detail_comment_tag_percent').text(goodRateStr);$('#evalChoice').show().text(' '+goodRateStr);$('#evalNone').hide();$('#summaryEnter').attr('empty','').show().next('.detail_cmt').show();$('#commentChoice').show();}else{$('#evalRate2').text(goodRateStr);$('#evalRateP2').show();}}else{if(part==1){$('#evalNo2').parent().hide();$('#evalChoice').hide();$('#evalRateP').hide();$('#evalNone').show();$('#summaryEnter').attr('empty','1').show().next('.detail_cmt').hide();$('#commentChoice').hide();}else{$('#evalRateP2').hide();}}};Comment.prototype.setEvalTag=function(json,part){var obj=this;if(obj.hasSetTagCount>1)return;obj.hasSetTagCount++;var tagHtml='',tags=json.hotCommentTagStatistics||[];var pcs=json.productCommentSummary||{};var $evalTag=$('#evalTag');if(part==2){$evalTag=$('#evalTag2');pcs.CommentCountStr?tagHtml+='<span no="0" ptag="7001.1.30">('+pcs.CommentCountStr+')</span>':'';tagHtml+='<span no="sort" ptag="7001.1.338"></span>';pcs.GoodCountStr?tagHtml+='<span no="3" ptag="7001.1.31">('+pcs.GoodCountStr+')</span>':'';pcs.GeneralCountStr?tagHtml+='<span no="2" ptag="7001.1.32">('+pcs.GeneralCountStr+')</span>':'';pcs.PoorCountStr?tagHtml+='<span no="1" ptag="7001.1.33" class="bad">('+pcs.PoorCountStr+')</span>':'';pcs.VideoCountStr?tagHtml+='<span no="7" ptag="7001.1.337">('+pcs.VideoCountStr+')</span>':'';pcs.ShowCountStr?tagHtml+='<span no="4" ptag="7001.1.34">('+pcs.ShowCountStr+')</span>':'';}
$evalTag.hide();$evalTag.find('span').not('[no]').remove();var commntBubbleArr=[];for(var i=0;i<tags.length;i++){obj.tagCount[tags[i].rid]=tags[i].count;if(tags[i].canBeFiltered&&tags[i].rid){tagHtml+='<span no="'+tags[i].rid+'" ptag="7001.1.218">'+tags[i].name+'('+tags[i].count+')</span>';commntBubbleArr.push('<div class="bubble"> <span>'+tags[i].name+'</span></div>');}else{tagHtml+='<span class="disabled" ptag="7001.1.218">'+tags[i].name+'('+tags[i].count+')</span>';}}
var commentStr=pcs.CommentCountStr;if(part=='1'&&pcs.CommentCount>0&&pcs.GoodRate>0&&commentStr&&!$('#commntBubble').length){$('#loopImgDiv div.inner').append('<div id="commntBubble" class="mod_comment_bubble" style="display:none;">'+'<div class="tag_warp">'+'</div>'+'<div class="comment_total bubble">'+commentStr+'</div>'+'</div>');var $commntBubble=$('#commntBubble');var $tagWarp=$commntBubble.find('.tag_warp');var $commentTotal=$commntBubble.find('.comment_total');var timer='';var isShow=false;$commentTotal.off().on('click',function(){$(obj.isJDChoice?'#commentChoice div.detail_comment_item':'#summaryEnter3').trigger('click');reporter.reports({ptag:'7001.1.353'});});JD.events.listen('item.comment.showBubble',function(){if(isShow)return;reporter.reportExposure({ptag:'7001.1.352'});isShow=true;var commntBubbleLen=commntBubbleArr.length;if(commntBubbleLen<=2){$tagWarp.html(commntBubbleArr.join('')).addClass('fadein');}else{var index=0;var takeTurns=function(){if(commntBubbleLen==index){index=0;takeTurns();return;}
else if(commntBubbleLen==index+1){$tagWarp.html([commntBubbleArr[index],commntBubbleArr[0]].join(''));index=1;}
else{$tagWarp.html([commntBubbleArr[index],commntBubbleArr[index+1]].join(''));index+=2;}
$tagWarp.removeClass('fadeout').addClass('fadein');setTimeout(function(){$tagWarp.removeClass('fadein').addClass('fadeout');},4000);};takeTurns();timer&&window.clearInterval(timer);timer=setInterval(function(){takeTurns();},5500)}
$commntBubble.show();});JD.events.listen('item.comment.hideBubble',function(){isShow=false;timer&&window.clearInterval(timer);$commntBubble.hide();});}
if(tagHtml){$evalTag.html(tagHtml).show();$('#evalTag').find('.disabled').attr('ptag','7001.1.217');$('#evalTag2 span[no="'+obj.evalType+'"]').addClass('selected').siblings().removeClass('selected');}
if(part!=1){$(document.body).append('<div id="calculator" style="position:absolute; bottom: 9000px; width: 100%;">'+$('#evalTag2')[0].outerHTML+'</div>');var $expandArea=$('#part_summary .cmt_tag_container .expand_area');if($('#calculator .threeLine')[0].scrollHeight>120){if(!$expandArea.length){$evalTag.after('<div class="expand_area"><i></i></div>');}}else if($expandArea.length){$expandArea.remove();}
$('#calculator').remove();}};Comment.prototype.loadEval=function(part,needCgi){var obj=this;if(this.evalHold||this.evalPageCur>this.evalPage&&$('#evalDet_summary .null').length>0||this.foldEvalLastPage||this.evalLastPage&&$('#evalDet_summary .null').length>0)return;$('#eveaLoading').show();obj.evalHold=true;var key=obj.skuId+(obj.evalSkuCur&&part!=1?'cur':'');window.skuJDEval=function(json){obj.callback&&obj.callback();if(obj.evalPageCur==1&&obj.jdSkuInfo.eval[key]){obj.jdSkuInfo.eval[key][obj.evalType]=json;}
if(json.errcode==='0'&&json.result){json=json.result;}else if(json.errcode==='11013'){spiderCheck.show({alertTip:'',source:'item_comment',successCB:function(){obj.evalHold=false;if(obj.evalPageCur==1){obj.loadEval(part,true);}}});return;}else{return;}
if(json.productCommentSummary&&json.productCommentSummary.SensitiveBook=='1'){JD.events.trigger('item.comment.sensitiveBook');json.comments=[];json.hotCommentTagStatistics=[];json.productCommentSummary.CommentCount=0;json.productCommentSummary.CommentCountStr='0';json.productCommentSummary.PoorCount=0;json.productCommentSummary.PoorCountStr='0';json.productCommentSummary.GeneralCount=0;json.productCommentSummary.GeneralCountStr='0';json.productCommentSummary.GoodCount=0;json.productCommentSummary.GoodCountStr='0';json.productCommentSummary.ShowCount=0;json.productCommentSummary.ShowCountStr='0';json.productCommentSummary.DefaultGoodCount=0;json.productCommentSummary.DefaultGoodCountStr='0';}
if(window._itemGlobal&&window._itemGlobal.showOneYear&&json&&json.productCommentSummary&&json.productCommentSummary.OneYear&&json.productCommentSummary.OneYear==1){$('#summaryTitle').text('');$('#evalRateP').css('left','90px');}
var productCommentSummary=json.productCommentSummary||'';productCommentSummary?obj.setEvalHead(productCommentSummary,part):'';var pcs=productCommentSummary||{},count=[];obj.defaultGoodCount=pcs.DefaultGoodCount||0;count=[pcs.CommentCount,pcs.PoorCount,pcs.GeneralCount,pcs.GoodCount,pcs.ShowCount];if(obj.isTagChoosed){obj.evalPage=Math.ceil(obj.tagCount[obj.evalType]/10)||1;}else{obj.evalPage=Math.ceil(count[obj.evalType=='sort'?0:obj.evalType]/10)||1;}
if(obj.specReferrer.evalReply){obj.specReferrer.evalReply=false;}
part==1?obj.loadEvalList(json,1):obj.loadEvalList(json,2);};window.skuJDFoldEval=function(json){if(json.errcode==='0'&&json.result){json=json.result;}else if(json.errcode==='11013'){spiderCheck.show({alertTip:'',source:'item_foldComment',successCB:function(){obj.evalHold=false;if(obj.foldEvalPageCur==1){obj.loadEval(part,true);}}});return;}
if(!json.comments||json.comments.length<10){obj.foldEvalLastPage=true;if(json.comments&&json.comments.length==0){obj.evalHold=false;$('#evalDet_fold').append('<li class="null"> </li>');return;}}
obj.loadEvalList(json,3);};if(!this.jdSkuInfo.eval)this.jdSkuInfo.eval={};if(!this.jdSkuInfo.eval[key])this.jdSkuInfo.eval[key]={};if(!this.jdSkuInfo.foldEval)this.jdSkuInfo.foldEval={};if(!this.jdSkuInfo.foldEval[this.skuId])this.jdSkuInfo.foldEval[this.skuId]={};if(this.jdSkuInfo.eval[key][this.evalType]&&obj.evalPageCur==1&&!needCgi){window.skuJDEval(this.jdSkuInfo.eval[key][this.evalType]);}else if(this.jdSkuInfo.foldEval[this.skuId][this.evalType]&&obj.foldEvalIsOpen&&obj.foldEvalPageCur==1&&!needCgi){window.skuJDFoldEval(this.jdSkuInfo.foldEval[this.skuId][this.evalType]);}else{var score=obj.evalType,sortType='5';if(obj.evalType=='sort'){score='0';sortType='6';}
if(obj.isFoldEval){if(!obj.foldEvalIsOpen||obj.foldEvalLastPage){this.evalHold=false;$('#eveaLoading').hide();return;}
ls.loadScript(['//wq.jd.com/commodity/comment/getfoldcommentlist?callback=skuJDFoldEval&pagesize=10'+(obj.isMScene?'&sceneval=2':'')+(obj.isTagChoosed?('&rid='+obj.evalType):('&score='+score)),'sku='+obj.skuId,'sorttype='+sortType,'page='+obj.foldEvalPageCur,'t='+Math.random()].join('&'));}else{ls.loadScript(['//wq.jd.com/commodity/comment/getcommentlist?callback=skuJDEval&pagesize=10'+(obj.isMScene?'&sceneval=2':'')+(obj.evalSkuCur&&part!=1?'&skucomment=1':'')+(obj.isTagChoosed?('&rid='+obj.evalType):('&score='+score)),'sku='+obj.skuId,'sorttype='+sortType,'page='+obj.evalPageCur,'t='+Math.random()].join('&'));}}};Comment.prototype.loadEvalList=function(json,flag,cacheObj){var obj=this,isMain=false,evalDom=$('#evalDet_summary');if(obj.cpart=='summary'&&!cacheObj&&flag==2){if(!obj.jdSkuInfo.evalSave)obj.jdSkuInfo.evalSave={};if(!obj.jdSkuInfo.evalSave[obj.baseSkuId])obj.jdSkuInfo.evalSave[obj.baseSkuId]={};if(!obj.jdSkuInfo.evalSave[obj.baseSkuId][obj.evalType]){obj.jdSkuInfo.evalSave[obj.baseSkuId][obj.evalType]=json;}else{obj.jdSkuInfo.evalSave[obj.baseSkuId][obj.evalType]['comments']=obj.jdSkuInfo.evalSave[obj.baseSkuId][obj.evalType]['comments'].concat(json.comments);}}
if(flag=='1'){isMain=true;evalDom=$('#evalDet_main');}else if(flag=='3'){if(!$('#evalDet_fold').length){$('#evalDet_summary').after('<ul class="cmt_list" id="evalDet_fold"></ul>');}
evalDom=$('#evalDet_fold');}
var sdVideo=function(videos,noImg){var str='',imgSrc='',videoSrc='',len=videos.length;for(var i=0;i<len;i++){imgSrc=videos[i].mainUrl.replace('http://','//');imgSrc=JD.img.getImgUrl(imgSrc,'','','!cc_100x100');videoSrc=videos[i].remark;var width='100%',height='100%';if(videos[i].videoWidth>videos[i].videoHeight){height='auto';}else{width='auto';}
if(imgSrc&&videoSrc){str+=obj.isJDChoice&&isMain?'<div class="detail_comment_video'+(noImg&&len==1?' big_size':'')+'" data-video="'+videoSrc+'"><video data-width="'+videos[i].videoWidth+'" data-height="'+videos[i].videoHeight+'" width="'+width+'" height="'+height+'" src="'+videoSrc+'" poster="'+imgSrc+'" webkit-playsinline="true" playsinline preload="none" muted="muted"></video><div class="button"></div></div>':'<span class="video'+(noImg&&len==1?' big_size':'')+'" data-video="'+videoSrc+'" style="overflow:hidden;"><video data-width="'+videos[i].videoWidth+'" data-height="'+videos[i].videoHeight+'" width="'+width+'" height="'+height+'" src="'+videoSrc+'"  poster="'+imgSrc+'" webkit-playsinline="true" playsinline preload="none" muted="muted"></video><div class="button"></div></span>';}}
return str;};var sdImg=function(imgs){var str='',p='',imgSrc='',len=imgs.length;for(var i=0;i<len;i++){imgSrc=imgs[i].imgUrl.replace('http://','//');p=JD.img.getImgUrl(imgSrc.replace('s128x96_',''));imgSrc=JD.img.getImgUrl(imgSrc,'','','!cc_100x100');str+=(obj.isJDChoice&&isMain?'<div class="detail_comment_img"><img ptag="7001.1.29" src="'+imgSrc+'" prview="'+p+'"/></div>':'<span class="img"><img ptag="7001.1.29" '+(obj.evalPageCur==1?'src':'init_src')+'="'+imgSrc+'" prview="'+p+'"/></span>');}
return str;};$('#eveaLoading').hide();var str='';if(obj.secondHtml&&(flag==2&&obj.evalPageCur==1&&~obj.insertTagTypes.join(' ').indexOf(obj.evalType))){str+=obj.secondHtml;}
var data=json.comments,html=[],tpl='<li>'+'<div class="cmt_user" ptag="{#ptag#}">'+'<img src="{#headimgurl#}" />'+'<span class="user">{#name#}</span>'+'{#plusHtml#}'+'<span class="credit {#starClassName#}"><span></span></span>'+'<span class="date">{#creationTime#}</span>'+'</div>'+'<div class="cmt_cnt" ptag="{#ptag#}">{#content#}</div>'+'<div class="cmt_att" ptag="{#ptag#}">{#shaidanImg#}</div>'+'{#carInfoHtml#}'+'<div class="cmt_sku">'+'{#sku#}'+'<div class="reply">'+'{#reply#}'+'</div>'+'</div>'+'</li>',dataItem={},starClassNames=['','star-one','star-two','star-three','star-four','star-five'];for(var i=0;data&&i<data.length;i++){if(isMain&&i>=2)break;if(obj.isJDChoice&&isMain&&i>0)break;dataItem=data[i];if(isMain)dataItem.ptag='7001.3.'+(i+7);dataItem.creationTime=dataItem.creationTime.slice(0,10);dataItem.headimgurl=dataItem.userImageUrl&&dataItem.userImageUrl!=='misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg'?'//'+dataItem.userImageUrl:'//img11.360buyimg.com/jdphoto/s40x40_jfs/t1/25255/18/10701/1678/5c89f892E78c04688/684d63c0d68e39b1.png';dataItem.name=dataItem.anonymousFlag==1?(dataItem.nickname.substr(0,1)+'***'+dataItem.nickname.substr(-1)):dataItem.nickname;dataItem.plusHtml=dataItem.userLevelName==='PLUS'?'<span class="plus"></span>':'';dataItem.levelName=dataItem.anonymousFlag==1?'':('('+dataItem.userLevelName+')');dataItem.sku=(dataItem.productColor?('<span>'+dataItem.productColor+'</span>'):'')+(dataItem.productSize?('  <span>'+dataItem.productSize+'</span>'):'');dataItem.shaidanImg=dataItem.videos?sdVideo(dataItem.videos,(!dataItem.images||dataItem.images.length<1)):'';dataItem.shaidanImg+=dataItem.images?sdImg(dataItem.images):'';dataItem.starClassName=(dataItem.score&&starClassNames[dataItem.score])||'';dataItem.reply='';dataItem.carInfoHtml='';if(!obj.hideReply){if(obj.isMScene){if(flag==3){dataItem.reply='<a href="//wqs.jd.com/wxsq_project/comment/commentDetail/index.html?sceneval=2&productid='+
dataItem.referenceId+'&guid='+dataItem.guid+'&orderid='+(dataItem.orderId||'0')+'&PTAG=37287.3.1" onclick="return !window.holdAction;" class="btn">'+(dataItem.replyCount>0?'<span class="num">'+dataItem.replyCount+'</span>':'')+'</a>';}else{dataItem.reply='<a href="javascript:void(0);" productid="'+dataItem.referenceId+'" orderid="'+(dataItem.orderId||'0')+'" guid="'+dataItem.guid+'"  class="reply_btn btn">'+(dataItem.replyCount>0?'<span class="num">'+dataItem.replyCount+'</span>':'')+'</a>';}}else{if(!obj.isAd2){if(flag==3){dataItem.reply='<a href="//wqs.jd.com/wxsq_project/comment/commentDetail/index.html?productid='+
dataItem.referenceId+'&guid='+dataItem.guid+'&orderid='+(dataItem.orderId||'0')+'&PTAG=37287.3.1" onclick="return !window.holdAction;"  class="btn">'+
(dataItem.replyCount>0?'<span class="num">'+dataItem.replyCount+'</span>':'')+'</a>';}else{dataItem.reply='<a href="javascript:void(0);" productid="'+dataItem.referenceId+'" orderid="'+(dataItem.orderId||'0')+'" guid="'+dataItem.guid+'"  class="reply_btn btn">'+
(dataItem.replyCount>0?'<span class="num">'+dataItem.replyCount+'</span>':'')+'</a>';}}}}
if(dataItem.carType&&dataItem.carType.seriesName&&dataItem.carType.brandName){dataItem.carInfoHtml='<div class="cmt_sku">'+dataItem.carType.brandName+'-'+dataItem.carType.seriesName+'</div>';}
if(obj.isJDChoice&&isMain){$('#commentChoice').find('div.detail_comment_content').text(dataItem.name+''+dataItem.content);$('#commentChoice').find('div.detail_comment_imgs').html(dataItem.shaidanImg)[dataItem.shaidanImg.length>0?'show':'hide']();}else{html.push(itemComm.jsonToTpl(dataItem,tpl));}}
if(flag==2&&!html.length&&obj.evalPageCur==1&&!$('evalDet_summary').children('.null').length&&!$('evalDet_main').children('.cmt_default_praise').length||flag==1&&!html.length&&!$('evalDet_main').children('.null').length&&!$('evalDet_main').children('.cmt_default_praise').length){str+=(obj.defaultGoodCount>0&&(obj.evalType==3||obj.evalType==0))?'<div class="cmt_default_praise">'+obj.defaultGoodCount+'</div>':'<li class="null"><center></center></li>';}else{str+=html.join('');}
if(flag==2&&html.length<10){obj.evalLastPage==true;}
if(flag==3){obj.foldEvalPageCur==1?evalDom.html(str):evalDom.append(str);}else{(obj.evalPageCur==1||isMain||cacheObj)?evalDom.html(str):evalDom.append(str);}
lazyLoad.autoLoadImage();if(isMain){if(html.length>=2){$('#summaryEnterIco').show();}else{$('#summaryEnterIco').hide();$('#summaryEnter3').hide();}
reporter.reportExposure({ptag:'7001.1.224'});}
flag!=3&&obj.setEvalTag(json,flag);flag==3?obj.foldEvalPageCur++:obj.evalPageCur++;if(flag==3){if(obj.foldEvalLastPage){evalDom.append('<li class="null"> </li>');}
obj.evalHold=false;}else if(!isMain&&obj.evalPageCur>obj.evalPage&&!evalDom.children('.null').length&&!evalDom.children('.cmt_default_praise').length||!isMain&&obj.evalLastPage&&!evalDom.children('.null').length&&!evalDom.children('.cmt_default_praise').length){if(obj.jdSkuInfo.foldEval&&obj.jdSkuInfo.foldEval[obj.skuId]&&obj.jdSkuInfo.foldEval[obj.skuId][obj.evalType]){obj.isFoldEval=true;obj.foldEvalPageCur=1;var html='';if(obj.defaultGoodCount>0&&(obj.evalType==3||obj.evalType==0)){html+='<div class="cmt_default_praise">'+obj.defaultGoodCount+'</div>';}
$('#foldEval').length?'':html+='<div class="cmt_fold_btn" id="foldEval"><span></span><i class="cmt_fold_btn_icon"></i></div>';evalDom.append(html);reporter.reportExposure({ptag:'7001.1.136'});$('#foldEval').off().on('click',function(){if(obj.foldEvalIsOpen){$('#foldEval').removeClass('cmt_fold_btn unfold').addClass('cmt_fold_btn');$('#foldEval span').text('');$('#evalDet_fold').hide();obj.foldEvalIsOpen=false;}else{obj.evalHold=false;$('#foldEval').removeClass('cmt_fold_btn').addClass('cmt_fold_btn unfold');$('#foldEval span').text('');obj.foldEvalIsOpen=true;obj.loadEval(2);$('#evalDet_fold').show();}}).attr('ptag','7001.1.137');obj.evalHold=false;}else{window.testHaveFoldEval=function(item){if(item.errcode!=='0'||!item.result||!item.result.comments||item.result.comments.length<1){obj.isFoldEval=true;obj.foldEvalLastPage=true;if(!evalDom.children('.null').length&&!evalDom.children('.cmt_default_praise').length){if(obj.defaultGoodCount>0&&(obj.evalType==3||obj.evalType==0)){evalDom.append('<div class="cmt_default_praise">'+obj.defaultGoodCount+'</div>');}else{evalDom.append('<li class="null"> </li>');}}}else{if(!obj.jdSkuInfo.foldEval)obj.jdSkuInfo.foldEval={};if(!obj.jdSkuInfo.foldEval[obj.skuId])obj.jdSkuInfo.foldEval[obj.skuId]={};obj.jdSkuInfo.foldEval[obj.skuId][obj.evalType]=item;obj.isFoldEval=true;obj.foldEvalPageCur=1;if(!$('#foldEval').length){var html='';if(obj.defaultGoodCount>0&&(obj.evalType==3||obj.evalType==0)){html+='<div class="cmt_default_praise">'+obj.defaultGoodCount+'</div>';}
html+='<div class="cmt_fold_btn" id="foldEval"><span></span><i class="cmt_fold_btn_icon"></i></div>';evalDom.append(html);reporter.reportExposure({ptag:'7001.1.136'});}
$('#foldEval').off().on('click',function(){if(obj.foldEvalIsOpen){$('#foldEval').removeClass('cmt_fold_btn unfold').addClass('cmt_fold_btn');$('#foldEval span').text('');$('#evalDet_fold').hide();obj.foldEvalIsOpen=false;}else{obj.evalHold=false;$('#foldEval').removeClass('cmt_fold_btn').addClass('cmt_fold_btn unfold');$('#foldEval span').text('');obj.foldEvalIsOpen=true;obj.loadEval(2);$('#evalDet_fold').show();}}).attr('ptag','7001.1.137');}
obj.evalHold=false;};ls.loadScript(['//wq.jd.com/commodity/comment/getfoldcommentlist?callback=testHaveFoldEval&sorttype=5&pagesize=10'+(obj.isMScene?'&sceneval=2':'')+(obj.isTagChoosed?('&rid='+obj.evalType):('&score='+obj.evalType)),'sku='+obj.skuId,'page='+obj.foldEvalPageCur,'t='+Math.random()].join('&'));}}else{obj.evalHold=false;}
if(!isMain){var time=0,timer=null;timer=setInterval(function(){time++;var $itemsToAdjust=$('#evalDet_summary .cmt_cnt:not(.adjust)'),notRenderItem=0;$itemsToAdjust.each(function(index,item){var $item=$(item);if(item.scrollHeight<1){notRenderItem++;}else{$item.addClass('adjust');if(item.scrollHeight>$item.height()){$item.addClass('full_content').append('<span class="fold_icon" style="display:none;"></span><span class="expand_icon"></span>');}}});if(notRenderItem<$itemsToAdjust.length||time>5)clearInterval(timer);},100);}
if(flag==2&&obj.evalMainClickIndex>0&&obj.cpart=='summary'){var $evalMainClick=$('#evalDet_summary').find('li').eq(obj.evalMainClickIndex-1);if($evalMainClick.length){setTimeout(function(){window.scrollTo(0,$evalMainClick.position().top);},200);obj.evalMainClickIndex=0;}}
if(cacheObj&&cacheObj.scrollTop){var timer=setInterval(function(){$(window).scrollTop(cacheObj.scrollTop);},200);setTimeout(function(){clearInterval(timer);},400);}};Comment.prototype.renderSummaryPage=function(item){if(!item)return;var obj=this;var scrollTop=item.viewScroll||0;obj.specReferrer.evalReply=true;var evalList=item.evalList[obj.skuId][item.evalType];if(!evalList.productCommentSummary)return;obj.evalSkuCur=item.evalSkuCur;$('#evalCurOption').find('input').prop('checked',obj.evalSkuCur?'checked':'');obj.evalPageCur=item.evalPageCur||1;obj.evalPage=item.evalPage||1;obj.evalType=item.evalType;obj.jdSkuInfo.evalSave=item.evalList;var pcs=evalList.productCommentSummary;obj.setEvalHead(pcs,2);obj.evalHold=true;obj.loadEvalList(evalList,2,{scrollTop:scrollTop});$('#evalTag2 span[no="'+obj.evalType+'"]').addClass('selected').siblings().removeClass('selected');var mainEvalTimer=setInterval(function(){if(!obj.evalHold){obj.evalHold=true;obj.loadEvalList(evalList,1);clearInterval(mainEvalTimer);}},200);setTimeout(function(){clearInterval(mainEvalTimer);},3000);};Comment.prototype.bindEvent=function(){var obj=this;var showTagComment=function(evalType){obj.evalType=evalType;if(~(' 0 1 2 3 4 7 sort ').indexOf(' '+obj.evalType+' ')){obj.isTagChoosed=false;}else{obj.isTagChoosed=true;}
obj.evalPageCur=1;obj.foldEvalIsOpen=false;obj.foldEvalPageCur=1;obj.isFoldEval=false;obj.foldEvalLastPage=false;obj.evalLastPage=false;obj.jdSkuInfo.evalSave={};if($('#evalDet_fold').length>0){$('#evalDet_fold').html('');}
if($('#evalDet_summary').children('li').length>0){$('#evalDet_summary').html('');}
$('#evalTag2 span[no="'+evalType+'"]').addClass('selected').siblings().removeClass('selected');if(obj.cpart=='main'){if($('#summaryEnter').attr('empty')=='1')return;$.publish('item.main.gotoPage',['#summary']);obj.enterSummary();}else{window.scroll(0,0);obj.loadEval(2);}};$.subscribe('item.main.insertComment',function(e,mainHtml,secondHtml,insertTagTypes){var $evalDetMain=$('#evalDet_main');var $spareEvalList=$evalDetMain.find('li:eq(1)');if($spareEvalList.length){$spareEvalList.hide();$('#summaryEnterIco').show();}
$evalDetMain.prepend(mainHtml);lazyLoad.autoLoadImage({container:'evalDet_main'});var $evalDetSummary=$('#evalDet_summary');obj.secondHtml=secondHtml;obj.insertTagTypes=insertTagTypes;if(!$evalDetSummary.html()||!~insertTagTypes.join(' ').indexOf(obj.evalType))return;$evalDetSummary.find('li:first').prepend(obj.secondHtml);var $comment=$evalDetSummary.find('li.shopping_zone').find('.cmt_cnt');if($comment[0].scrollHeight>$comment.height()){$comment.addClass('full_content').append('<span class="fold_icon" style="display:none;"></span><span class="expand_icon"></span>');}
lazyLoad.autoLoadImage({container:'evalDet_summary'});});$(window).on('scroll',function(){if(obj.cpart!='main'&&obj.cpart!='summary')return;var st=$(window).scrollTop();if(obj.cpart=='summary'){var height=$(document).height()-pageHight-220;height=height>0?height:0;if(st>0&&st>=height){obj.loadEval(2);}}
if(isAndroid||(getNetWork()||'').toLowerCase()!=='wifi')return;$('#evalDet_'+obj.cpart+(obj.isJDChoice&&obj.cpart=='main'?',#commentChoice':'')).find('.video,.detail_comment_video').each(function(index,videoContainer){var $videoContainer=$(videoContainer),$video=$videoContainer.find('video'),video=$video[0],$button=$videoContainer.find('.button'),height=$videoContainer.height(),top=$video.offset().top;if(top>st&&top+height<st+pageHight-100){video.play();$button.hide();video.onended=function(){$button.show();};}else{video.pause();$button.show();}});});$('#evalDet_main').on('click',function(ev){var $this=$(ev.target);if(!$this.hasClass('cmt_cnt'))return;obj.evalMainClickIndex=($this.parent('li').index()||0)+1;showTagComment('0');reporter.reports({ptag:'7001.1.298'});});$('#part_summary .cmt_tag_container').on('click','.expand_area',function(){var $this=$(this),$expandArea=$('#evalTag2');if($this.hasClass('expand')){$this.removeClass('expand');$expandArea.css('maxHeight','95px');}else{$this.addClass('expand');$expandArea.css('maxHeight','1000px');}});$('#evalDet_summary').on('click','.fold_icon',function(e){var $this=$(this),$content=$this.parent('.cmt_cnt');if($content.hasClass('full_content')){$content.removeClass('expand');$this.hide();$content.find('.expand_icon').show();}
reporter.reports({ptag:'7001.1.300'});e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();});$('#evalDet_summary').on('click','.expand_icon',function(e){var $this=$(this),$content=$this.parent('.cmt_cnt');if($content.hasClass('full_content')){$content.addClass('expand');$this.hide();$content.find('.fold_icon').show();}
reporter.reports({ptag:'7001.1.299'});e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();});var hasAllowedPlayVideo=false,videoMuted=true,adjustVideoPageStyle=function(){var $partVideoMain=$('#partVideoMain'),$videoDom=$partVideoMain.find('video');if($videoDom.length==0)return;var videoWidth=$videoDom.attr('data-width'),videoHeight=$videoDom.attr('data-height'),closeBtnHeight=52;var marginTop=0;if(videoWidth*0.1/videoHeight>pageWidth*0.1/(pageHight-closeBtnHeight)){marginTop=((pageHight-closeBtnHeight-videoHeight*pageWidth/videoWidth)/2);}else{$videoDom.css('width',((pageHight-closeBtnHeight)*videoWidth)*100/(videoHeight*pageWidth)+'%');}
$partVideoMain.css({'max-height':'none','marginTop':marginTop+'px'});},playVideo=function(videoDom,videoDomClone,$this){$('#partVideoMain').attr('data-type','comment').html(videoDom);var $videoDom=$(videoDom);$videoDom.attr('controls','controls');$videoDom.attr('preload',true);$videoDom.prop('muted',videoMuted);$videoDom.on('volumechange',function(){videoMuted=$(this).prop('muted');});$this.find('.button').before(videoDomClone);videoDom.play();adjustVideoPageStyle();location.hash='#video';};$('#evalDet_main,#evalDet_summary,#commentChoice').on('click','.video,.detail_comment_video',function(e){e.preventDefault();var $this=$(this),videoDom=$this.find('video')[0],videoDomClone=$(videoDom).clone()[0];if((getNetWork()||'').toLowerCase()!=='wifi'&&!hasAllowedPlayVideo){popUp.createPopup({flag:4,icon:'info',msg:obj.isMScene?'WiFi':'WIFI',okText:'',cancelText:'',onConfirm:function(){hasAllowedPlayVideo=true;playVideo(videoDom,videoDomClone,$this);}});}else{playVideo(videoDom,videoDomClone,$this);}});$(window).on('resize',function(){pageHight=$(window).height();adjustVideoPageStyle();});$(window).on('hashchange',function(){if(window.location.hash!='#video')$('#partVideoMain').html('');});$('#evalDet_summary,#evalDet_main,#commentChoice').on('click','img',function(e){var $this=$(this),src=$this.attr('prview')||$this.attr('src').replace(/\s+/g,''),aurl=$this.parents('a').attr('href'),urlReg=/^(https*:){0,1}\/\//;if(urlReg.test(aurl)){return;}
var $imgNode=$this.parents('.cmt_att').find('img'),$moreImg=$this.parents('.more_img'),imgList=[],curIndex=$this.parent().index()+1-$this.parent().siblings('.video,.detail_comment_video').length;if(~e.originalEvent.currentTarget.id.indexOf('commentChoice')){$imgNode=$this.parents('.detail_comment_imgs').find('img');}
if($moreImg.length){curIndex+=$moreImg.siblings('.img').length;}
$imgNode.each(function(){src=$(this).attr('prview')||$this.attr('src').replace(/\s+/g,'');src=(~src.indexOf('http')?'':(window.location.protocol||'http:'))+src;imgList.push(src);});if(imgList.length>1){imageViewer.loopImagesPreview({imgList:imgList,curIndex:curIndex});}else if(imgList.length==1){imageViewer.previewImage(imgList[0]);}});$('#evalCurOption input').on('click',function(){obj.evalSkuCur=$('#evalCurOption').find('input').is(':checked');if(obj.isTagChoosed){obj.isTagChoosed=false;obj.evalType=0;$('#evalTag2 span[no="'+obj.evalType+'"]').addClass('selected').siblings().removeClass('selected');}
obj.evalPageCur=1;obj.foldEvalIsOpen=false;obj.foldEvalPageCur=1;obj.isFoldEval=false;obj.foldEvalLastPage=false;obj.evalLastPage=false;obj.hasSetEvalCount=1;obj.hasSetTagCount=1;obj.jdSkuInfo.evalSave={};if($('#evalDet_fold').length>0){$('#evalDet_fold').html('');}
if($('#evalDet_summary').children('li').length>0)$('#evalDet_summary').html('');window.scroll(0,0);obj.loadEval(2);});$('#evalTag,#evalTag2').on('click','span',function(){var $this=$(this);if($this.hasClass('disabled'))return;showTagComment($this.attr('no'));});$('#summaryEnter,#summaryEnter3,#commentChoice div.detail_comment_item').on('click',function(e){if($('#summaryEnter').attr('empty')=='1')return;obj.evalType=obj.isJDChoice?0:0;if(obj.isJDChoice){var target=e.srcElement||e.target,$target=$(target);if($target.hasClass('detail_comment_img')||target.nodeName=='IMG')return;if($target.hasClass('detail_comment_video')||target.nodeName=='VIDEO'||$target.hasClass('button'))return;$.publish('item.main.gotoPage',['#summary']);obj.enterSummary();}else{showTagComment('0');}});$('#evalDet_summary').on('click','a.reply_btn',function(){var tar=$(this);$.publish('item.main.leavePage');setTimeout(function(){window.location.href='//wqs.jd.com/wxsq_project/comment/commentDetail/index.html?PTAG=37287.3.1&productid='+tar.attr('productid')+'&guid='+tar.attr('guid')+'&orderid='+tar.attr('orderid')+(obj.isMScene?'&sceneval=2':'');},100);});};exports.init=function(config){var comment=new Comment();comment.init(config);return comment;};});
;define('jd.item.yanbao',function(require,exports,module){var _cacheThisModule_,$=require('zepto'),ls=require('loadJs'),itemComm=require('wq.item.common'),loginHandler=require('jd.item.loginHandler'),itemUtil=require('jd.item.util'),$jsonToTpl=itemUtil.$jsonToTpl,popUp=itemUtil.popUp,showNotice=itemUtil.showNotice,reporter=itemUtil.reporter,imageViewer=itemUtil.imageViewer,pageWidth=$(window).width();var Yanbao=function(){var opt={isMScene:false,isWxWork:false,skuId:'',brandId:'',venderId:'',jdCategory:[],jdPrice:0,jdAddrId:[],isXnzt:false,hideYanbao:false,hideServiceEnter:false,hidePackageJd:false,setPackageGift:false,ybInfo:{},jdSkuInfo:{}};$.extend(this,opt);};Yanbao.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.loadVaService();obj.bindEvent();};Yanbao.prototype.refresh=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.ybInfo={};obj.loadVaService();};Yanbao.prototype.loadVaService=function(){var obj=this,funcArr=[];if(!obj.hideYanbao)funcArr.push(6);if(!obj.hidePackageJd)funcArr.push(7);if(obj.setPackageGift)funcArr.push(8);if(!funcArr.length)return;if(!window.vaServiceCB){window.vaServiceCB=function(json){if(!json||json.errcode!=0)return;obj.jdSkuInfo['vaService'+obj.skuId]=json;if(!obj.hideYanbao&&json.baozhang)obj.setYanbaoItem(json.baozhang);if(!obj.hidePackageJd&&json.svcplus)obj.setJdServiceItem(json.svcplus);if(obj.setPackageGift&&json.giftgou)obj.setPackageGiftItem(json.giftgou);obj.setYbArea();};}
if(obj.jdSkuInfo['vaService'+obj.skuId]){window.vaServiceCB(obj.jdSkuInfo['vaService'+obj.skuId]);}else{ls.loadScript(['//wq.jd.com/commodity/jdsbranch/get?callback=vaServiceCB&skuid='+obj.skuId,'cat='+obj.jdCategory.slice(0,3).join(','),'brandid='+(obj.brandId||''),'area='+obj.jdAddrId.slice(0,4).join('_'),'price='+(obj.jdPrice||0),'shopid='+(obj.venderId||''),'functionids='+funcArr.join(',')].join('&'));}};Yanbao.prototype.setYanbaoItem=function(data){if(!data||!data.length)return;var obj=this;var iconArr={'CXTH':11,'ZHBX':7,'YCBX':8,'FWBZ':10,'YWBH':9},ybItemHtml=[],skuList=[],ybItem={},skuItem={},tpl1='<div class="detail_new_mod_service protect" tab="bzfw" id="yb_{#categoryCode#}" style="display:none;"><span class="service_name"></span></div>',popybHtml=[],popskuHtml=[],popTpl2='<div class="service"><div class="title"><span class="name icon_ins_{#iconNo#}">{#displayName#}</span><span class="guide"></span></div><ul class="items">{#listStr#}</ul></div>',popTpl3='<li class="item" id="popybItem_{#bindSkuId#}" sku="{#bindSkuId#}" categorycode="{#categoryCode#}" skuname="{#bindSkuName#}" price="{#priceShow#}"><p class="type">{#bindSkuName#}{#favor#}<span class="price">&yen;{#priceShow#}</span></p><p class="content">{#tip#}</p></li>';for(var i=0,len=data.length;i<len;++i){popskuHtml=[];ybItem=data[i];skuList=ybItem.fuwuSkuDetailList;if(!ybItem.displayName||!skuList||skuList.length==0)continue;for(var j=0,jlen=skuList.length;j<jlen;++j){skuItem=skuList[j];skuItem.categoryCode=ybItem.categoryCode;skuItem.priceShow=(skuItem.price/100.0).toFixed(2)||'';skuItem.favor=(skuItem.activityWriter?'<span class="discount">'+skuItem.activityWriter+'</span>':'');popskuHtml.push(itemComm.jsonToTpl(skuItem,popTpl3));}
ybItem.iconNo=(iconArr[ybItem.categoryCode]||0);ybItemHtml.push(itemComm.jsonToTpl(ybItem,tpl1));ybItem.listStr=popskuHtml.join('');popybHtml.push(itemComm.jsonToTpl(ybItem,popTpl2));}
if(ybItemHtml.length>0){obj.ybInfo.isYanBao=true;obj.ybInfo.yanbaoStr=ybItemHtml.join('');obj.ybInfo.yanbaoLen=data.length;obj.ybInfo.yanbaoPopStr='<p class="title"></p>'+popybHtml.join('');}};Yanbao.prototype.setJdServiceItem=function(data){if(!data||!data.length)return;var obj=this;var popTpl2='<div class="service"><div class="title"><span class="name icon_ins_{#iconNo#}">{#scName#}</span></div><ul class="items">{#listStr#}</ul></div>',popTpl3='<li class="item" id="popybItem_{#serviceSku#}" sku="{#serviceSku#}" categorycode="{#categorycode#}" skuname="{#serviceSkuShortName#}" price="{#serviceSkuPriceShow#}"><p class="type">{#serviceSkuShortName#}<span class="price">&yen;{#serviceSkuPriceShow#}</span></p><p class="content">{#serviceSkuAdWord#}</p></li>',popliHtmlArr=[],popsectionHtmlArr=[];obj.ybInfo.jdServiceSmallItem='';data.forEach(function(list){popliHtmlArr=[];if(list.scName&&list.serviceSkuInfoList&&list.serviceSkuInfoList.length){obj.ybInfo.jdServiceSmallItem+='<div class="detail_new_mod_service protect" tab="jdfw" id="yb_JDFW'+list.scId+'" style="display:none;"><span class="service_name"></span></div>';list.serviceSkuInfoList.forEach(function(service){if(service&&service.serviceSku&&service.serviceSkuShortName){service.categorycode='JDFW'+list.scId;service.serviceSkuPriceShow=(service.serviceSkuPrice&&(service.serviceSkuPrice*1).toFixed(2))||'';popliHtmlArr.push($jsonToTpl(service,popTpl3));}});if(popliHtmlArr.length){popsectionHtmlArr.push($jsonToTpl({scName:list.scName,listStr:popliHtmlArr.join('')},popTpl2));}}});if(popsectionHtmlArr.length){obj.ybInfo.isJdService=true;obj.ybInfo.jdServicePopItem='<p class="title"></p>'+popsectionHtmlArr.join('');}};Yanbao.prototype.setPackageGiftItem=function(data){var packing=data&&data.result&&data.result.packing;if(!packing||!packing.sku||!packing.pic||!packing.price<0)return;var obj=this;obj.ybInfo.isGift=true;obj.ybInfo.giftSku=packing.serviceSku;obj.ybInfo.giftPopItem=$jsonToTpl({sku:obj.ybInfo.giftSku,price:(packing.price*1).toFixed(2),img:JD.img.getImgUrl('//img30.360buyimg.com/'+packing.pic,50,50),bigImg:JD.img.getImgUrl('//img30.360buyimg.com/'+packing.pic,pageWidth,pageWidth),cardBigImg:JD.img.getImgUrl('//img11.360buyimg.com/jdphoto/s750x750_jfs/t3520/58/387335052/143497/5f583f0b/58083393N8faa10f3.png',pageWidth,pageWidth)},'<p class="title"></p><div class="service">'+'<div class="title"><span class="name icon_ins_{#iconNo#}"></span></div><ul class="items">'+'<li class="item" id="popybItem_{#sku#}" sku="{#sku#}" categorycode="GIFT" skuname="" price="{#price#}">'+'<p class="type"><span class="price">&yen;{#price#}</span></p>'+'<small></small>'+'<div class="images">'+'<img src="{#img#}" prview="{#bigImg#}">'+'</div>'+'</li>'+'</ul>'+'</div>');obj.ybInfo.giftSmallItem='<div class="detail_new_mod_service package" id="yb_GIFT" style="display:none;"><span class="service_name"></span></div>';var tpl='<div class="mod_service_paper">'+'<div class="mod_service_paper_head">'+'<span>To</span>'+'<input type="text" id="toInput" value="{#receivename#}">'+'</div>'+'<div class="mod_service_paper_body">'+'<i></i><i></i><i></i><i></i><i></i>'+'<textarea id="giftTextArea" maxlength="120">{#content#}</textarea>'+'</div>'+'<div class="mod_service_paper_foot">'+'<span>From:</span>'+'<input type="text" id="fromInput" value="{#sendname#}">'+'</div>'+'<p class="mod_service_paper_tips">120</p>'+'</div>',jsonObj={receivename:'',sendname:'',content:''};popUp.setPopupBody('gift',$jsonToTpl(jsonObj,tpl));if(loginHandler.getLoginStatus()){window.packageGiftCardCB=function(json){if(json&&json.errcode==0&&json.result){obj.jdSkuInfo['packageGiftCard'+obj.skuId]=json;var itemObj=(json.result.mVo||{})[obj.skuId];if(itemObj){$.extend(jsonObj,{receivename:itemObj.receivename||'',sendname:itemObj.sendname||'',content:itemObj.content||jsonObj.content});popUp.setPopupBody('gift',$jsonToTpl(jsonObj,tpl));}}};if(obj.jdSkuInfo['packageGiftCard'+obj.skuId]){window.packageGiftCardCB(obj.jdSkuInfo['packageGiftCard'+obj.skuId]);}else{ls.loadScript('//wq.jd.com/commodity/extension/getgreetings?skuid='+obj.skuId+'&callback=packageGiftCardCB'+(obj.isMScene?'&sceneval=2':'')+'&t='+Math.random());}}
$('#ybService').off().on('click','span.btn',function(){if(!popUp.popupBody.gift)return;if(!loginHandler.getLoginStatus()){loginHandler.login();return;}
popUp.createPopDom({className:'mod_service_main',title:'',body:popUp.popupBody.gift,needConfirm:true,isGift:true,onConfirm:function(){var receiveName=$('#toInput').val()||'',sendName=$('#fromInput').val()||'',content=$('#giftTextArea').val()||'',reg=/\ud83c[\udc00-\udfff]|\ud83d[\udc00-\udfff]|[\u2000-\u2fff]/g;receiveName=receiveName.replace(reg,'');sendName=sendName.replace(reg,'');content=$.trim(content.replace(reg,''));if(content){popUp.showHidePopup($('#popupDom'));window.saveGiftCardCB=function(json){if(json.errcode==0){showNotice({str:''});}else if(json.errcode=='13'){loginHandler.login();}else{showNotice({str:''});}};ls.loadScript('//wq.jd.com/commodity/extension/savegreetings?'+(obj.isMScene?'sceneval=2&':'')+'skuid='+obj.skuId+'&callback=saveGiftCardCB&receiver='+encodeURIComponent(receiveName)+'&sender='+encodeURIComponent(sendName)+'&content='+encodeURIComponent(content));}else{showNotice({str:''});}}});});};Yanbao.prototype.setYbArea=function(){if(this.hideServiceEnter)return;var obj=this,tip='',ybStr='',$popupJdService=$('#popupJdService'),serviceArr=[];$popupJdService.html('');if(obj.ybInfo.isYanBao&&obj.ybInfo.yanbaoLen>0){serviceArr.push('');ybStr+=obj.ybInfo.yanbaoStr||'';$popupJdService.append(obj.ybInfo.yanbaoPopStr);}
if(obj.ybInfo.isJdService){serviceArr.push('');ybStr+=obj.ybInfo.jdServiceSmallItem||'';$popupJdService.append(obj.ybInfo.jdServicePopItem);}
if(obj.ybInfo.isGift&&!obj.isWxWork){serviceArr.push('');ybStr+=obj.ybInfo.giftSmallItem||'';$popupJdService.append(obj.ybInfo.giftPopItem);}
tip='<span class="text">'+serviceArr.join('')+'</span>';if(serviceArr.length>0){$('#ybArea3').html(tip);reporter.reportExposure({ptag:'7001.1.186'});}
obj.ybInfo.ybTip=tip;obj.ybInfo.ybStr=ybStr;};Yanbao.prototype.setNewYanBao=function(){var obj=this,$tar='',$selectedOut='',$dom='',$nameDom='';if(obj.ybInfo.isGift||obj.ybInfo.isJdService||obj.ybInfo.isYanBao){$selectedOut=$('#popupJdService li.checked');$dom=$('#ybArea3');$dom.html($selectedOut.length>0?obj.ybInfo.ybStr:obj.ybInfo.ybTip);$.publish('item.yanbao.selectYbItem',[$selectedOut.length]);}
var $item='',price='';if($selectedOut.length>0){$selectedOut.each(function(ind,item){$item=$(item);$tar=$('#yb_'+$item.attr('categorycode'));$tar.attr('sku',$item.attr('sku'));$nameDom=$tar.find('span.service_name');price=$item.attr('price')*1;$nameDom.html($item.attr('skuname')+'<em> &yen;'+price.toFixed(2)+'</em>');$tar.show();});reporter.txReport({ptag:'7001.1.65'});}
$('#ybChooseNum').html($selectedOut.length);};Yanbao.prototype.getNewYanBaoList=function(flag){var obj=this,skuids=[],$tar=[],sku='',$doms='';if(flag==1){$doms=$('#ybArea3 div.detail_new_mod_service.package');$doms.each(function(ind,item){$tar=$(item);sku=$tar.attr('sku');sku&&skuids.push(sku);});}else if(flag==2){$doms=$('#ybArea3 div.detail_new_mod_service.protect[tab="jdfw"]');$doms.each(function(ind,item){$tar=$(item);sku=$tar.attr('sku');if(sku){if(obj.isXnzt){skuids.push([sku,'0','0','0','0',obj.skuId,obj.skuId,'1'].join(','));}else{skuids.push([sku,'0','0','0','0',obj.skuId,'',''].join(','));}}});}else{$doms=$('#ybArea3 div.detail_new_mod_service.protect[tab="bzfw"]');$doms.each(function(ind,item){$tar=$(item);sku=$tar.attr('sku');sku&&skuids.push([sku,'0','0','0','0',obj.skuId,'0'].join(','));});}
return skuids;};Yanbao.prototype.bindEvent=function(){var obj=this;$('#popupBuyArea').on('click','li.item',function(e){var target=e.srcElement||e.target;if(target.nodeName=='IMG')return;var $this=$(this),emId=$this.attr('id');if(emId.indexOf('popybItem_')>-1){var ybSku=emId.replace(/(pop)?ybItem_/,'');$('#popybItem_'+ybSku).toggleClass('checked').siblings().removeClass('checked');reporter.reports({ptag:'7001.12.14'});obj.setNewYanBao();}});$('#popupBuyArea').on('click','.guide',function(e){var $this=$(this),$items=$this.parents('.title').next('.items'),$itemCheck=$items&&$items.find('.item.checked')&&$items.find('.item.checked').eq(0),$itemFirst=$items&&$items.find('.item')&&$items.find('.item').eq(0);bindSku=$itemCheck.attr('sku')||$itemFirst.attr('sku');location.href='//b.jr.jd.com/service/serveIntroduce/#/introduce?mainSkuId='+obj.skuId+'&bindSkuId='+bindSku;});$('#popupBuyArea').on('click','img',function(){var $this=$(this),src=$this.attr('prview')||$this.attr('src').replace(/\s+/g,''),aurl=$this.parents('a').attr('href');if(/^(https*:){0,1}\/\//.test(aurl))return;imageViewer.previewImage(src);});};exports.init=function(config){var yanbao=new Yanbao();yanbao.init(config);return yanbao;};});
;define('jd.item.price',function(require,exports,module){var _cacheThisModule_,$=require('zepto'),urlParam=require('url'),itemComm=require('wq.item.common'),cookie=require('cookie'),ls=require('loadJs'),util=require('util'),numberp=require('numberp'),isWX=util.isWX(),isQQbrowser=(JD.device.scene==='qqbrower'),loginHandler=require('jd.item.loginHandler'),userInfo=require('jd.item.user'),itemUtil=require('jd.item.util'),$jsonToTpl=itemUtil.$jsonToTpl,reporter=itemUtil.reporter,popUp=itemUtil.popUp;var Price=function(){var opt={isJDChoice:false,isAd2:false,isSamGoods:false,isSamGoods2:false,isSamVip:false,isZxService:false,isJump:false,skuId:'',isHyj:false,jdAddrId:[],venderId:'',jdCategory:[],isWareOff:false,isNormalAct:false,priceData:{},areaSkuId:'',isHideSpecPrice:false,jdMprice:0,giftFlag:0,plusFlag:'',isPresale:false,jdSkuInfo:{},priceObj:{},doublePriceShow:false,isInit:true};$.extend(this,opt);};Price.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.baseSkuId=obj.skuId;obj.$priceMarket=$('#priceMarket,#priceMarket1');obj.$priceDis=$('#priceDis');obj.$priceLineThrough=$('#priceLineThrough,#priceMarket1');obj.getSkuPrice(obj.priceData,obj.areaSkuId);};Price.prototype.refresh=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.doublePriceShow=false;obj.isInit=false;obj.isHideSpecPrice=false;$('#priceDesc').text('');$('#priceTag,#priceDesc').hide();obj.$priceMarket.hide();obj.$priceLineThrough.hide();$('#priceSpec,#priceSpec2,#specOldPrice').hide();$('#priceBlock').show();$('#priceSale').show().addClass('large_size');$('#fansPriceTag,#pricePlus,#samPriceTag').removeClass('large_size');$('#fansPriceTag,#fansPriceTag2,#fansPriceTagStore').hide().next('span.mod_fans_price').hide();$('#favShopGuideContainer').show();$('#favShopGuide').hide();$('#zsPriceTag,#zsPriceTag2,#zsPriceTagStore').hide().next('i.mod_tag').hide();$('#samPriceTag,#samPriceTag2,#samPriceTagStore').hide().next('span.mod_sams_price').hide();$('#priceBlock span.mod_sams_price,#priceBlock i.sams_info,#samVip').hide();$('#pricePlus,#pricePlus2,#pricePlusStore').hide().next('span.mod_plus_price').hide();$('#plusGuide').hide();$('#priceSaleChoice').hide();$('#priceSaleChoice1').next('span.mod_plus_price').hide();$('#priceNewer,#priceNewer2,#priceNewerStore').hide().next('span.mod_newer_price').hide();$('#fqyPrice, #jdPrice').hide();$('#priceStudent').hide().next('span.mod_student_price').hide().next('i.tip_info').hide();$('#priceStudent2').hide().next('span.mod_student_price').hide();obj.getSkuPrice(obj.priceData,obj.areaSkuId);};Price.prototype.setIsJump=function(value){this.isJump=value;};Price.prototype.showMarketPrice=function(){var obj=this,m=obj.priceObj.m>0?obj.priceObj.m:0,p=obj.priceObj.p>0?obj.priceObj.p:0;if(!obj.jdCategory||obj.isWareOff)return;if(obj.doublePriceShow)return;if(!obj.isNormalAct)return;if(m*100<=p*100)return;$('#priceTag,#priceDesc').show();obj.$priceMarket.html(m?('&yen;'+m):'').show();obj.$priceDis.html('<span>'+(Math.ceil(p*100/m)/10).toFixed(1)+'</span>').show();};Price.prototype.lineThroughPrice=function(){var obj=this;if(obj.isNormalAct)return;if(obj.doublePriceShow)return;if(!obj.priceObj||!obj.priceObj.l)return;if(obj.priceObj.l<=obj.priceObj.p)return;reporter.reportExposure({ptag:'7001.1.326'});obj.$priceLineThrough.html('&yen;'+obj.priceObj.l).show();};Price.prototype.getSkuPrice=function(json,areaSkuId){var obj=this;if(obj.isJump||obj.isPresale)return;window.skuPrice=function(arr){var tmp={id:obj.skuId,p:0,m:0,l:0,pcp:0,sp:0,pp:0,tpp:0,op:0,tkp:0,sfp:0,nup:0,bp:0,up:''};for(var i=0;i<arr.length;i++){if(arr[i].id==(obj.skuId)||arr[i].id==areaSkuId){tmp=arr[i];if(!window.isMScene)obj.getPCPrice(arr[i]);break;}}
tmp.p=tmp.p*1;tmp.m=tmp.m*1;tmp.l=tmp.l*1;tmp.pcp=tmp.pcp*1;tmp.sp=tmp.sp*1;tmp.pp=tmp.pp*1;tmp.tpp=tmp.tpp*1;tmp.op=tmp.op*1;tmp.tkp=tmp.tkp*1;tmp.sfp=tmp.sfp*1;tmp.nup=tmp.nup*1;tmp.bp=tmp.bp*1;tmp.stp=tmp.stp*1;obj.priceObj=tmp;var p=tmp.p>0?tmp.p:0;if(window._isKeplerScene=='1'&&tmp.bp>0)p=tmp.bp;if(!obj.isHyj){if((obj.isSamGoods||obj.isSamGoods2)&&obj.jdPrice>0&&p>0&&p!=obj.jdPrice){popUp.createPopup({flag:3,msg:''});}
obj.setP(p);obj.samPriceTag();obj.zsPriceTag();}
obj.shopFansPriceTag();obj.newerPriceTag();obj.studentPriceTag();if(obj.isJDChoice){obj.vipPlusChoice();obj.studentPriceChoice();}else{obj.vipPlusPrice();}
obj.showMarketPrice();obj.lineThroughPrice();};if(!json||!json.p||json.p<=0){var price=urlParam.getUrlParam('price');if(price>0)obj.setP(price);if(window.isMScene){ls.loadScript('//pm.3.cn/prices/pcpmgets?skuids='+this.skuId+'&origin=2&source=wxsqitemsou&ext=111&area='+this.jdAddrId.slice(0,3).join('_')+'&callback=skuPrice'+'&t='+Math.random());}else{ls.loadScript('//pe.3.cn/prices/pcpmgets?skuids='+this.skuId+'&origin='+((isWX||isQQbrowser)?5:4)+'&source=wxsqitemsou&ext=111&pin='+encodeURIComponent(cookie.get('pin')||'')+'&area='+this.jdAddrId.slice(0,3).join('_')+'&callback=skuPrice'+'&t='+Math.random());}}else{window.skuPrice([json]);}};Price.prototype.getPCPrice=function(price){var obj=this;if(!price||!(price.p>0)||!(price.pcp>0)){return;}
var disCount=numberp.minus([price.pcp,price.p]);if(disCount>0){var $wxsqTip=$('#wxSqTip'),$wxSqSpecTip=$('#wxSqSpecTip'),tipStr='<span>'+((isWX||isQQbrowser)?'':'Q')+'</span>';if(!$wxsqTip.length){obj.$priceDis.after('<div class="mod_sign_tip bor" id="wxSqTip"></div>');$wxsqTip=$('#wxSqTip');}
$wxsqTip.html(tipStr).show();$wxSqSpecTip.html(tipStr).show();$('#priceTag').show();}};Price.prototype.hideSpecPrice=function(hide){var obj=this;if(hide){obj.isHideSpecPrice=true;$('#specPrice').html('&yen;<em class="tip"><em>');}else{obj.isHideSpecPrice=false;obj.setP(obj.jdPrice);}};Price.prototype.setP=function(p){var priceStr='';if(p>0){this.jdPrice=numberp.round(p*1,2);priceStr=this.setSpecPrice({p:p,flag:2});}
if($('#priceSaleChoice1').length&&!~$('#priceSaleChoice1').html().indexOf('PLUS')){$('#priceSaleChoice1').html(this.jdPrice>0?('<i class="yen">&yen;</i> '+this.jdPrice):'');}
var $price=$('#priceSale,#priceSale2,#priceSaleStore,#specPrice');if(this.isHideSpecPrice){$price=$('#priceSale,#priceSale2,#priceSaleStore');}
$price.html(priceStr||'');};Price.prototype.setSpecPrice=function(opt){opt=opt||{};var p=opt.p,outStr='';if(p>0){var parr=[],tplStr='&yen;'+(opt.flag===1?'<span class="int">{#intP#}</span>.{#floatP#}':'<em>{#intP#}</em>.{#floatP#}');p=numberp.round(p*1,2);parr=p.split('.');outStr=itemComm.jsonToTpl({intP:parr[0],floatP:parr[1]},tplStr);}
return outStr;};Price.prototype.pricePriority=function(price,mark){var flag=true;if(price.up&&price.up.split(',')[0]!=mark){flag=false;}
return flag;};Price.prototype.studentPriceTag=function(){var obj=this,price=obj.priceObj;if(obj.isJDChoice||obj.isZxService)return;if(!obj.pricePriority(price,'stp')||price.up=='')return;if(price.stp>0&&price.stp<price.p){var $stPrice=$('#priceStudent'),$stPrice2=$('#priceStudent2'),$priceBlock=$('#priceBlock');$stPrice&&$stPrice.html(obj.setSpecPrice({p:price.stp,flag:2})).show();$priceBlock&&$priceBlock.find('.mod_student_price').show();$priceBlock&&$priceBlock.find('.tip_info').show().off().on('click',function(){popUp.createPopup({flag:3,msg:'<h3 class="title"></h3><div class="inner"><dl><dd></dd></dl></div>'});});$stPrice2&&$stPrice2.html(obj.setSpecPrice({p:price.stp,flag:2})).show();$stPrice2&&$stPrice2.next('.mod_student_price').show();}};Price.prototype.studentPriceChoice=function(){var obj=this,price=obj.priceObj;if(obj.isZxService)return;if(!obj.pricePriority(price,'stp')||price.up=='')return;if(price.stp>0&&price.stp<price.p){var $stPrice=$('#priceStudent'),$stPrice2=$('#priceStudent2');$stPrice.html('<i class="yen">&yen;</i> '+numberp.round(price.stp,2)).show();$stPrice.next('.mod_student_price').show();$stPrice2.html(obj.setSpecPrice({p:price.stp,flag:2})).show();$stPrice2.next('.mod_student_price').show();$('#stu_tip_info').show().off().on('click',function(){popUp.createPopup({flag:3,msg:'<h3 class="title"></h3><div class="inner"><dl><dd></dd></dl></div>'});});}}
Price.prototype.newerPriceTag=function(){var obj=this,price=obj.priceObj;if(!obj.pricePriority(price,'nup'))return;if(price.nup>0&&price.nup<price.p){userInfo.getPinStatus({cb:function(pinObj){pinObj=pinObj||{};var priceStr=obj.setSpecPrice({p:price.nup,flag:2});var tpl='<div class="newer_bar" id="newerGuideContainer">'+'<span class="price color_newer" id="priceNewerGuide">'+priceStr+'</span>'+'<span class="mod_newer_price"></span>'+'<span class="entry">{#guide#}</span>'+'</div>';var hasGuideContainer=$('#newerGuideContainer').length>0;if(pinObj.isDefault){reporter.reportExposure({ptag:'138268.2.36'});if(hasGuideContainer){$('#hasGuideContainer').html(priceStr);}else{$('#priceWrap').after($jsonToTpl({guide:''},tpl));$('#newerGuideContainer').on('click',function(){if(pinObj.url)location.href=pinObj.url;});}}else if(pinObj.isSwitch){reporter.reportExposure({ptag:'138268.2.36'});if(hasGuideContainer){$('#hasGuideContainer').html(priceStr);}else{$('#priceWrap').after($jsonToTpl({guide:''},tpl));$('#newerGuideContainer').on('click',function(){if(pinObj.url)location.href='//wqs.jd.com/my/bindpopupv2/index.shtml?returnText=&sceneid=721294561&returnUrl='+encodeURIComponent(window.location.href.replace(/#\w*/,'').replace(obj.baseSkuId,obj.skuId));});}}else{reporter.reportExposure({ptag:'138487.2.1'});$('#priceNewer,#priceNewer2,#priceNewerStore').html(priceStr).show();$('#priceNewer,#priceNewer2,#priceNewerStore').next('span.mod_newer_price').show();obj.doublePriceShow=true;obj.adjustPriceSize(4,true);}}});}};Price.prototype.zsPriceTag=function(){var obj=this,price=obj.priceObj;if(!obj.pricePriority(price,'tkp')||obj.isZxService)return;if(price.tkp>0&&price.tkp<price.p){var $zsPrice=$('#zsPriceTag'),$priceBlock=$('#priceBlock');$zsPrice.next('i.mod_tag').show();$('#zsPriceTag,#zsPriceTag2,#zsPriceTagStore').html(obj.setSpecPrice({p:price.tkp,flag:2})).show();$('#zsPriceTag,#zsPriceTag2,#zsPriceTagStore').next('i.mod_tag').show();obj.doublePriceShow=true;$zsPrice.addClass('large_size');$('#priceSale').removeClass('large_size');$priceBlock.find('i.sams_info').off().on('click',function(){popUp.createPopup({flag:3,msg:'<h3 class="title"></h3><div class="inner"><dl><dd></dd></dl></div>'});});reporter.reportExposure({ptag:'7001.1.141'});}};Price.prototype.shopFansPriceTag=function(){var obj=this,price=obj.priceObj;if(obj.isJDChoice||obj.isZxService)return;if(!obj.pricePriority(price,'sfp'))return;if(price.sfp>0&&price.sfp<price.p){$('#fansPriceTag,#fansPriceTag2,#fansPriceTagStore').html(obj.setSpecPrice({p:price.sfp,flag:2})).show();$('#fansPriceTag,#fansPriceTag2,#fansPriceTagStore').next('span.mod_fans_price').show();obj.doublePriceShow=true;$('#favShopGuide').find('i').css('left',($('#priceBlock .mod_fans_price').offset()&&$('#priceBlock .mod_fans_price').offset().left||0));if(!obj.isInit){obj.adjustPriceSize(1,obj.shopFavStatus);if(obj.shopFavStatus){$('#favShopGuide').hide();}else{$('#favShopGuide').show();reporter.reportExposure({ptag:'7001.1.273'});}}
$.unsubscribe('item.shop.favStatusChange');$.subscribe('item.shop.favStatusChange',function(e,shopFavStatus){obj.shopFavStatus=shopFavStatus;obj.adjustPriceSize(1,shopFavStatus);if(shopFavStatus){$('#favShopGuide').hide();}else{$('#favShopGuide').show();reporter.reportExposure({ptag:'7001.1.273'});}});}};Price.prototype.samPriceTag=function(){var obj=this,price=obj.priceObj;if((!obj.isSamGoods&&!obj.isSamGoods2)||!obj.pricePriority(price,'sp')||obj.isZxService||obj.isAd2)return;if(price.sp>0&&price.sp*1<price.p){var $priceBlock=$('#priceBlock');$('#samPriceTag,#samPriceTag2,#samPriceTagStore').html(obj.setSpecPrice({p:price.sp,flag:2})).show();$('#samPriceTag,#samPriceTag2,#samPriceTagStore').next('span.mod_sams_price').show().next('i.sams_info').show();obj.doublePriceShow=true;obj.adjustPriceSize(2,obj.isSamVip);$priceBlock.find('i.sams_info').off().on('click',function(){popUp.createPopup({flag:3,msg:'<h3 class="title"></h3><div class="inner"><dl><dd></dd></dl></div>'});});}};Price.prototype.vipPlusPrice=function(){var obj=this,price=obj.priceObj;if(obj.isJDChoice||(!obj.pricePriority(price,'pp')&&!obj.pricePriority(price,'tpp'))||obj.isZxService||obj.isAd2)return;if(price&&price.p>0&&(price.tpp>0&&price.p>price.tpp)){var setDefault=function(){var url='//plus.m.jd.com/index?s=wq&ptag=7001.1.90',priceVal=price.tpp,goTip='',discount=numberp.round(numberp.minus([price.p,price.tpp]),2),desc='PLUS &yen;'+discount,exposurePtag='7001.1.317',clickPtag='7001.1.90',today=new Date().getTime(),plusGuideBk={notryout:'PLUS,{}',tryoutExpired:'PLUS,{}',vipplusExpired:'PLUS,{}',goTip:''};if(!window.plusGuide||!window.plusGuide.notryout||!window.plusGuide.tryoutExpired||!window.plusGuide.vipplusExpired||today>Date.parse(window.plusGuide.effectEndTime)||today<Date.parse(window.plusGuide.effectstartTime)){window.plusGuide=plusGuideBk;}
if(obj.plusFlag=='201'||obj.plusFlag=='101'){url='';obj.adjustPriceSize(3,true);}else if(obj.plusFlag=='102'){desc=window.plusGuide.notryout.replace(/\{.*\}/,' &yen;'+discount);goTip=window.plusGuide.goTip;exposurePtag='7001.1.318';clickPtag='7001.1.319';}else if(obj.plusFlag=='103'){desc=window.plusGuide.tryoutExpired.replace(/\{.*\}/,' &yen;'+discount);}else if(obj.plusFlag=='203'){desc=window.plusGuide.vipplusExpired.replace(/\{.*\}/,' &yen;'+discount);}
$('#pricePlus,#pricePlus2,#pricePlusStore').html(obj.setSpecPrice({p:priceVal})).show().next('span.mod_plus_price').show();obj.doublePriceShow=true;reporter.reportExposure({ptag:'7001.1.320'});if(url){url=JD.url.addUrlParam(url,{'ptag':clickPtag});var $dom=$('#plusGuide');$dom.show().html('<div class="mod_sign_tip bg_4"><b><i class="icon_plus"></i></b></div><span class="text">'+desc+(goTip?'</span><span class="go">'+goTip+'</span>':'')).off().on('click',function(){loginHandler.loginLocation(url);});reporter.reportExposure({ptag:exposurePtag});}};setDefault();}};Price.prototype.vipPlusChoice=function(){var obj=this,price=obj.priceObj;if(obj.isAd2||obj.isZxService)return;if(!obj.pricePriority(price,'pp')&&!obj.pricePriority(price,'tpp'))return;if(price&&price.p>0&&(price.tpp>0&&price.p>price.tpp)){var setDefault=function(opt){var dUrl='//plus.m.jd.com/index?s=wq&ptag=7001.4.4',desc='',goTip='',discount=numberp.round(numberp.minus([price.p,price.tpp]),2),title='PLUS &yen;'+discount,$plusChoice=$('#plusChoice'),exposurePtag='7001.4.3',clickPtag='7001.4.4',today=new Date().getTime(),plusGuideBk={notryout:'PLUS,{}',tryoutExpired:'PLUS,{}',vipplusExpired:'PLUS,{}',goTip:''};opt=opt||{};$('#priceSaleChoice1').html('PLUS<i class="yen">&yen;</i> '+numberp.round(price.tpp,2)).next('span.mod_plus_price').show();$('#pricePlus2').html(obj.setSpecPrice({p:price.tpp})).show().next('span.mod_plus_price').show();reporter.reportExposure({ptag:'7001.4.2'});$('#priceSaleChoice').html('<i class="yen">&yen;</i> '+obj.jdPrice).show();if(!window.plusGuide||!window.plusGuide.notryout||!window.plusGuide.tryoutExpired||!window.plusGuide.vipplusExpired||today>Date.parse(window.plusGuide.effectEndTime)||today<Date.parse(window.plusGuide.effectstartTime)){window.plusGuide=plusGuideBk;}
if(loginHandler.getLoginStatus()){if(obj.plusFlag=='201'||obj.plusFlag=='101'){title='';desc='';}else if(opt.isDefault){dUrl=opt.url;desc='';}else if(obj.plusFlag=='102'){title=window.plusGuide.notryout.replace(/\{.*\}/,' &yen;'+discount);goTip=window.plusGuide.goTip;exposurePtag='7001.4.54';clickPtag='7001.4.55';}else if(obj.plusFlag=='103'){title=window.plusGuide.tryoutExpired.replace(/\{.*\}/,' &yen;'+discount);}else if(obj.plusFlag=='203'){title=window.plusGuide.vipplusExpired.replace(/\{.*\}/,' &yen;'+discount);}}
var hasPlusChoiceBar=false;if(title&&dUrl){hasPlusChoiceBar=true;dUrl=JD.url.addUrlParam(dUrl,{'ptag':clickPtag});$plusChoice.attr('href',dUrl).show().find('p.text').html(title);if(desc){$plusChoice.find('p.sub_text').text(desc).show();}else{$plusChoice.find('p.sub_text').hide();}
if(goTip){$plusChoice.find('div.go').text(goTip).show();}else{$plusChoice.find('div.go').hide();}
$('.mod_aside_v2').css('bottom','96px;');reporter.reportExposure({ptag:exposurePtag});}
JD.events.listen('item.main.stockStateChange',function(stockState){if(stockState==3){$plusChoice.hide();}else if(hasPlusChoiceBar){$plusChoice.show();}});};if(loginHandler.getLoginStatus()){userInfo.getPinStatus({url:'//plus.m.jd.com/index?s=wq&ptag=7001.4.4',sceneid:521190259,cb:function(pinObj){if(pinObj&&(pinObj.isDefault||pinObj.isPerfect||pinObj.isBind)){setDefault({isDefault:true,url:pinObj.url});}else{setDefault();}}});}else{setDefault();}}};Price.prototype.adjustPriceSize=function(type,isBig){var obj=this,price=obj.priceObj,$priceSale=$('#priceSale'),$doublePrice;switch(type-0){case 1:if(!obj.pricePriority(price,'sfp')||price.sfp<=0||price.sfp*1>=price.p)return;$doublePrice=$('#fansPriceTag');break;case 2:if(!obj.pricePriority(price,'sp')||price.sp<=0||price.sp*1>=price.p)return;$doublePrice=$('#samPriceTag');break;case 3:if(!obj.pricePriority(price,'tpp')||price.tpp<=0||price.tpp*1>=price.p)return;$doublePrice=$('#pricePlus');break;case 4:if(!obj.pricePriority(price,'nup')||price.nup<=0||price.nup*1>=price.p)return;$doublePrice=$('#priceNewer');break;default:break;}
if(isBig){$priceSale.removeClass('large_size');$doublePrice.addClass('large_size');}else{$priceSale.addClass('large_size');$doublePrice.removeClass('large_size');}};Price.prototype.getSingleSkuPrice=function(sku,cb){var obj=this;window.singlePrice=function(arr){obj.jdSkuInfo['price'+sku]=arr;var tmp=arr[0];for(var i=0;i<arr.length;i++){if(obj.jdSkuInfo['price'])obj.jdSkuInfo['price'].push(arr[i]);if(arr[i].id==('J_'+sku)||arr[i].id==sku){tmp=arr[i];break;}}
var p=tmp.p*1>0?tmp.p:0,m=tmp.m*1>0?tmp.m:0;obj.setP(p);obj.vipPlusPrice(tmp);if(obj.venderId*1)obj.$priceMarket.html(m?('&yen;'+m):'');if(window.is_xbox_yuyue&&window.xbox_price){$('#priceSale').html(window.xbox_price);obj.$priceMarket.html(window.xbox_price);}
cb&&cb();};if(!obj.jdSkuInfo['price'+sku]){if(window.isMScene){ls.loadScript('//pm.3.cn/prices/pcpmgets?skuids='+sku+'&origin=2&source=wxsqitemsou&ext=11&area='+obj.jdAddrId.slice(0,3).join('_')+'&callback=singlePrice'+'&t='+Math.random());}else{ls.loadScript('//pe.3.cn/prices/pcpmgets?skuids='+sku+'&origin='+(isWX?5:4)+'&source=wxsqitemsou&ext=11&pin='+encodeURIComponent(cookie.get('pin')||'')+'&area='+obj.jdAddrId.slice(0,3).join('_')+'&callback=singlePrice'+'&t='+Math.random());}}
else{window.singlePrice(obj.jdSkuInfo['price'+sku]);}};Price.prototype.getComboSkuPrice=function(skus,cb){var obj=this;window.comboPrice=function(json){obj.jdSkuInfo['comboPrice'+json.sid]=json;if(json.p)obj.setP(numberp.round(json.p,2));cb&&cb();};if(!obj.jdSkuInfo['comboPrice'+skus]){ls.loadScript(['//jprice.360buy.com/contractsuit/'+obj.skuId,skus,obj.jdAddrId.slice(0,3).join(','),1,obj.isWX?5:4,'comboPrice_html'].join('_'));}
else{window.comboPrice(obj.jdSkuInfo['comboPrice'+skus]);}};exports.init=function(config){var itemPrice=new Price();itemPrice.init(config);return itemPrice;};});
;define('jd.item.bargain',function(require,exports,module){var _cacheThisModule_,$=require('zepto'),ls=require('loadJs'),itemUtil=require('jd.item.util'),reporter=itemUtil.reporter,$jsonToTpl=itemUtil.$jsonToTpl;var Bargain=function(){var opt={hideEntry:false,skuId:'',price:'',lastSkuId:'',skuInfo:{}};$.extend(this,opt);};Bargain.prototype.init=function(config){config=config||{};var obj=this;$.extend(obj,config);obj.setBargain();obj.bindEvent();};Bargain.prototype.refresh=function(config){config=config||{};var obj=this;obj.lastSkuId=obj.skuId;$.extend(obj,config);obj.setBargain();};Bargain.prototype.setBargain=function(){var obj=this;if(obj.hideEntry){$('#bargain').hide();return;}else{$('#bargain').show();}
if(!obj.price||obj.price<=0)return;if(obj.lastSkuId==obj.skuId)return;$('#bargain').remove();var tpl='<div class="mod_bargain" id="bargain">'+'<div class="title">'+'<div class="mod_sign_tip bor"><span></span></div>{#priceInfo#}'+'</div>'+'{#infoStr#}'+'</div>';if(!window.bargainCB){window.bargainCB=function(json){if(!json||json.iRet!=0)return;obj.skuInfo['bargainCB_'+obj.skuId]=json;var data=json&&json.data&&json.data[0];if(data&&data.bIsShowAct&&data.strLinkUrl4H5){var priceInfo='';if(data.ddwEndPrice>0){var priceArr=(data.ddwEndPrice/100.0-0).toFixed(2).split('.');priceArr[1]=priceArr[1]?'.'+priceArr[1]:'';priceInfo='<span class="price">&yen; <em>'+priceArr[0]+'</em>'+priceArr[1]+'</span>';}else{priceInfo='';}
$('#taxTip').after($jsonToTpl({priceInfo:priceInfo,infoStr:data.dwBuyPerson>0?'<div class="info">'+data.dwBuyPerson+'</div>':''},tpl));reporter.reportExposure({ptag:'7001.1.316'});$('#bargain').off().on('click',function(){reporter.reports({ptag:'7001.1.325'});window.location.href=data.strLinkUrl4H5;});}};}
if(obj.skuInfo['bargainCB_'+obj.skuId]){window.bargainCB(obj.skuInfo['bargainCB_'+obj.skuId]);}else{ls.loadScript('//wq.jd.com/cutitem/MGetActInfoBySku?callback=bargainCB&source=itemdetail&sSkuInfo=[{"ddwSkuId":'+obj.skuId+',"ddwNowPrice":'+(obj.price*100)+'}]');}};Bargain.prototype.bindEvent=function(){var obj=this;JD.events.listen('item.main.stockStateChange',function(stockState){if(stockState==3||obj.hideEntry){obj.hideEntry=true;$('#bargain').hide();}else{$('#bargain').show();}});};exports.init=function(config){var bargain=new Bargain();bargain.init(config);return bargain;};});
;define('q',function(require,exports,module){var __cacheThisModule__;!function(a){"use strict";if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var b="undefined"!=typeof window?window:self,c=b.Q;b.Q=a(),b.Q.noConflict=function(){return b.Q=c,this}}}(function(){"use strict";function a(a){return function(){return W.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===ca(a)||a instanceof S}function d(a,b){if(P&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(da)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+da+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===R&&d>=T&&ia>=d}function i(){if(P)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return R=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return a instanceof o?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,Y(c,function(b,c){k.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=_(l.prototype),f=_(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=X(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):k.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&P)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||Y(d,function(b,c){k.nextTick(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=_(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return a instanceof o}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){ea.length=0,fa.length=0,ha||(ha=!0)}function x(a,b){ha&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){-1!==Z(fa,a)&&(process.emit("unhandledRejection",b,a),ga.push(a))}),fa.push(a),b&&"undefined"!=typeof b.stack?ea.push(b.stack):ea.push("(no stack) "+b))}function y(a){if(ha){var b=Z(fa,a);-1!==b&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){var c=Z(ga,a);-1!==c&&(process.emit("rejectionHandled",ea[b],a),ga.splice(c,1))}),fa.splice(b,1),ea.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ba(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return k.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function C(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})}function D(a,b,c){return k(a).spread(b,c)}function E(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?k(g.value):p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?k(h.value):z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function F(a){k.done(k.async(a)())}function G(a){throw new S(a)}function H(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return Y(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){if(0===a.length)return k.resolve();var b=k.defer(),c=0;return Y(a,function(d,e,f){function g(a){b.resolve(a)}function h(){c--,0===c&&b.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function i(a){b.notify({index:f,value:a})}var j=a[f];c++,p(j,g,h,i)},void 0),b.promise}function L(a){return p(a,function(a){return a=$(a,k),p(J($(a,function(a){return p(a,U,U)})),function(){return a})})}function M(a){return k(a).allSettled()}function N(a,b){return k(a).then(void 0,void 0,b)}function O(a,b){return k(a).nodeify(b)}var P=!1;try{throw new Error}catch(Q){P=!!Q.stack}var R,S,T=i(),U=function(){},V=function(){function a(){for(var a,d;c.next;)c=c.next,a=c.task,c.task=void 0,d=c.domain,d&&(c.domain=void 0,d.enter()),b(a,d);for(;h.length;)a=h.pop(),b(a);e=!1}function b(b,c){try{b()}catch(d){if(g)throw c&&c.exit(),setTimeout(a,0),c&&c.enter(),d;setTimeout(function(){throw d},0)}c&&c.exit()}var c={task:void 0,next:null},d=c,e=!1,f=void 0,g=!1,h=[];if(V=function(a){d=d.next={task:a,domain:g&&process.domain,next:null},e||(e=!0,f())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)g=!0,f=function(){process.nextTick(a)};else if("function"==typeof setImmediate)f="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var i=new MessageChannel;i.port1.onmessage=function(){f=j,i.port1.onmessage=a,a()};var j=function(){i.port2.postMessage(0)};f=function(){setTimeout(a,0),j()}}else f=function(){setTimeout(a,0)};return V.runAfter=function(a){h.push(a),e||(e=!0,f())},V}(),W=Function.call,X=a(Array.prototype.slice),Y=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Z=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),$=a(Array.prototype.map||function(a,b){var c=this,d=[];return Y(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),_=Object.create||function(a){function b(){}return b.prototype=a,new b},aa=a(Object.prototype.hasOwnProperty),ba=Object.keys||function(a){var b=[];for(var c in a)aa(a,c)&&b.push(c);return b},ca=a(Object.prototype.toString);S="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var da="From previous event:";k.resolve=k,k.nextTick=V,k.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(X(arguments,1)):a.resolve(c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return k.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.tap=function(a,b){return k(a).tap(b)},o.prototype.tap=function(a){return a=k(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ea=[],fa=[],ga=[],ha=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return ea.slice()},k.stopUnhandledRejectionTracking=function(){w(),ha=!1},w(),k.reject=z,k.fulfill=A,k.master=C,k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=E,k.spawn=F,k["return"]=G,k.promised=H,k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return k.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,X(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,X(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,X(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},k.fbind=function(a){var b=k(a),c=X(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(X(arguments))])}},o.prototype.fbind=function(){var a=this,b=X(arguments);return function(){return a.dispatch("apply",[this,b.concat(X(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.any=K,o.prototype.any=function(){return K(this)},k.allResolved=j(L,"allResolved","allSettled"),o.prototype.allResolved=function(){return L(this)},k.allSettled=M,o.prototype.allSettled=function(){return this.then(function(a){return J($(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=N,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){if(!a||"function"!=typeof a.apply)throw new Error("Can't apply finally callback");return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){k.nextTick(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=X(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=X(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=X(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=X(arguments,1);return function(){var c=b.concat(X(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=X(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=X(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(X(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=X(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=X(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=X(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=X(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=O,o.prototype.nodeify=function(a){return a?void this.then(function(b){k.nextTick(function(){a(null,b)})},function(b){k.nextTick(function(){a(b)})}):this},k.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ia=i();return k});});
;define('wq.jdshopQuickClean.v1',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),Q=require('q'),login=require("login"),mLoad=require('loadJs'),hadChange=false,cleanNum=0,_callback,url_domain=(window.userRouter&&window.userRouter.getHost&&window.userRouter.getHost())||'//wq.jd.com/',cart_cgi={"cartView":url_domain+"deal/mshopcart/cartview?templete=1&"+(window._MCart?'sceneval=2&':''),'addToFavor':'//wq.jd.com/fav/comm/FavCommBatchAdd?'+(window._MCart?'sceneval=2&':''),'getClearCart':url_domain+'deal/mshopcart/getclearcart?'+(window._MCart?'sceneval=2&':''),'removeClearCart':url_domain+'deal/mshopcart/removeclearcart?'+(window._MCart?'sceneval=2&':''),},clear_cart={oDialog:null,addrObj:{addrId:'0',addrName:'',id:'1_72_2819_0',areaId:'1-72-2819',name:'___'},currentCount:null,maxCount:null,};var QuickClean={show:function(){var me=this;hadChange=false;cleanNum=0;me.getClearCart(function(json){if(json.errId==0&&json.clearcart){clear_cart.currentCount=json.currentCount;clear_cart.maxCount=json.maxCount;me.render(json.clearcart);me.bindEve();}else{me.checkError(json);}})
me.stopBodyScroll(true);},quickCleanTmpl:function(it){var out=' <div class="quick_clean_header"><span class="tit">'+((it.mainSkuCount>=it.maxCount)?'':(it.mainSkuCount<80?'':''))+'</span><i class="quick_clean_close"></i></div> <div class="quick_clean_body"> ';var groups=[['noStock',''],['oneYear',''],['halfYear',''],['oneMonth',''],['inAMonth','']];for(var i=0,len=groups.length;i<len;i++){var cate=groups[i][0],noStock=cate=='noStock'?'1':'0',item=it.clearcart[cate],placeholderNum=Math.ceil(item.totalNum/it.imgNumInOneLine)*it.imgNumInOneLine-item.totalNum;out+=' ';if(item.totalNum>0&&item.allPros.length>0){out+=' <div class="quick_clean_group '+(cate)+'"> <div class="quick_clean_cate"> <i class="icon_select"></i> <span class="cate_tit">'+(groups[i][1])+'</span> <span class="info"><span class="selectNum">0</span>/'+(item.totalNum)+'</span> </div> <div class="quick_clean_list"> ';for(var allProsIndex=0,allProsLen=item.allPros.length;allProsIndex<allProsLen;allProsIndex++){var pro=item.allPros[allProsIndex];out+=' ';if(pro.products){var prosInSuit=pro.products;out+=' ';for(var proInSuitIndex=0,proInSuitLen=prosInSuit.length;proInSuitIndex<proInSuitLen;proInSuitIndex++){var proItem=prosInSuit[proInSuitIndex];out+=' <div class="quick_clean_item" skuid="'+(proItem.skuId)+'" itemtype="'+(pro.itemType)+'" issuit="1" vskuid="'+(pro.vskuId)+'" promoid="'+(pro.promoId)+'" nostock="'+(noStock)+'"> <img src="//img10.360buyimg.com/n4/'+(proItem.imgUrl)+'"> <i class="icon_select"></i> <i class="icon_suit"></i> </div> ';}
out+=' ';}else{out+=' <div class="quick_clean_item" skuid="'+(pro.skuId)+'" itemtype="'+(pro.itemType)+'" nostock="'+(noStock)+'"> <img src="//img10.360buyimg.com/n4/'+(pro.imgUrl)+'"> <i class="icon_select"></i> </div> ';}
out+=' ';}
out+=' ';for(var a=0,aLen=placeholderNum;a<aLen;a++){out+=' <div class="placeholder"></div> ';}
out+=' </div> </div> ';}
out+=' ';}
out+=' </div> <div class="quick_clean_footer"> <p class="selected_total"><span class="num">0</span></p> <div class="to_fav" ptag="7014.29.25"></div> <div class="to_del" ptag="7014.29.24"></div> </div>';return out;},sortByTime:function(clearCart){var newClearCart={};for(var key in clearCart){var obj={},result=[],proArr=clearCart[key].products,suitArr=clearCart[key].suits,totalNum=clearCart[key].totalNum,i=0,j=0,k=0;while(i<proArr.length&&j<suitArr.length){if(proArr[i].timestamp<=suitArr[j].timestamp){result[k++]=proArr[i++];}else{result[k++]=suitArr[j++];}}
while(i<proArr.length){result[k++]=proArr[i++];}
while(j<suitArr.length){result[k++]=suitArr[j++];}
obj.allPros=result;obj.totalNum=totalNum;newClearCart[key]=obj;}
return newClearCart;},render:function(clearCartObj){if(document.querySelector('.quick_clean')==null){var quickCleanDom=document.createElement('div');quickCleanDom.className='quick_clean';quickCleanDom.id='quickCleanDetail';quickCleanDom.innerHTML='<div class="quick_clean_main"></div>';document.body.appendChild(quickCleanDom);}
var me=this,quickCleanMain=$('#quickCleanDetail .quick_clean_main'),mainSkuCount=clear_cart.currentCount,maxCount=clear_cart.maxCount||120;windowWidth=$(window).width(),imgNumInOneLine=parseInt((windowWidth-windowWidth/375*20)/67);var clearCart=me.sortByTime(clearCartObj);quickCleanMain.html(me.quickCleanTmpl({clearcart:clearCart,mainSkuCount:mainSkuCount*1,maxCount:maxCount*1,imgNumInOneLine:imgNumInOneLine}));if($('.quick_clean_main .quick_clean_group.noStock').length>0){wa('ptagExposure',{ptag:'7014.29.15'});}
if($('.quick_clean_main .quick_clean_group.oneYear').length>0){wa('ptagExposure',{ptag:'7014.29.17'});}
if($('.quick_clean_main .quick_clean_group.halfYear').length>0){wa('ptagExposure',{ptag:'7014.29.19'});}
if($('.quick_clean_main .quick_clean_group.oneMonth').length>0){wa('ptagExposure',{ptag:'7014.29.21'});}
if($('.quick_clean_main .quick_clean_group.inAMonth').length>0){wa('ptagExposure',{ptag:'7014.29.22'});}},bindEve:function(){var me=this,quickCleanDetail=$('#quickCleanDetail');quickCleanDetail.show().off().on('click',function(e){me.toHide(e.target);}).on('click','.quick_clean_cate .icon_select',function(){me.checkOneCate(this);}).on('click','.quick_clean_item',function(){me.checkOneItem(this);}).on('click','.to_fav',function(){me.favEve();me.rdReport();}).on('click','.to_del',function(){me.delEve();me.rdReport();})
setTimeout(function(){quickCleanDetail.addClass('show');},100);},toHide:function(tar){var me=this;function popClose($dom){$dom.removeClass('show');setTimeout(function(){$dom.hide();},100);}
if($(tar).parents(".quick_clean_main").length==0||$(tar).hasClass("quick_clean_close")){popClose($('#quickCleanDetail'));!window._MCart&&$('#moreAct').show();me.stopBodyScroll();hadChange&&typeof _callback=='function'&&_callback();}},checkOneCate:function(dsrc){var quickCleanGroup=$(dsrc).parents('.quick_clean_group'),quickCleanCate=$(dsrc).parents('.quick_clean_cate'),quickCleanItems=quickCleanGroup.find('.quick_clean_item'),selectNum=quickCleanCate.find('.selectNum'),totalSelect=$('.selected_total .num');if(quickCleanCate.hasClass('selected')){quickCleanCate.removeClass('selected');quickCleanItems.removeClass('selected');}else{quickCleanCate.addClass('selected');quickCleanItems.addClass('selected');}
selectNum.html(quickCleanGroup.find('.quick_clean_item.selected').length);totalSelect.html($('.quick_clean_item.selected').length);},checkOneItem:function(dsrc){var quickCleanGroup=$(dsrc).parents('.quick_clean_group'),quickCleanCate=quickCleanGroup.find('.quick_clean_cate'),selectNum=quickCleanCate.find('.selectNum'),totalSelect=$('.selected_total .num');if($(dsrc).attr('issuit')==1){var promoId=$(dsrc).attr('promoid');$('[promoid="'+promoId+'"]').toggleClass('selected');}else{$(dsrc).toggleClass('selected');}
quickCleanGroup.find('.quick_clean_item').length==quickCleanGroup.find('.quick_clean_item.selected').length?quickCleanCate.addClass('selected'):quickCleanCate.removeClass('selected');selectNum.html(quickCleanGroup.find('.quick_clean_item.selected').length);totalSelect.html($('.quick_clean_item.selected').length);},rdReport:function(){var selectedArr=$('.quick_clean .quick_clean_item.selected');rd={'noStock':false,'oneYear':false,'halfYear':false,'oneMonth':false,'inAMonth':false};selectedArr.forEach(function(el){var cate=$(el).parents('.quick_clean_group');if(!rd['noStock']&&$(cate).hasClass('noStock')){wa('jdClick',{ptag:'7014.29.14'});rd['noStock']=true;}
if(!rd['oneYear']&&$(cate).hasClass('oneYear')){wa('jdClick',{ptag:'7014.29.16'});rd['oneYear']=true;}
if(!rd['halfYear']&&$(cate).hasClass('halfYear')){wa('jdClick',{ptag:'7014.29.18'});rd['halfYear']=true;}
if(!rd['oneMonth']&&$(cate).hasClass('oneMonth')){wa('jdClick',{ptag:'7014.29.20'});rd['oneMonth']=true;}
if(!rd['inAMonth']&&$(cate).hasClass('inAMonth')){wa('jdClick',{ptag:'7014.29.23'});rd['inAMonth']=true;}})},getOptArr:function(selectedArr){var me=this,otherNoStockArr=[];$('.quick_clean_group.noStock .quick_clean_item').forEach(function(el){!$(el).hasClass('selected')&&otherNoStockArr.push($(el));})
var getNewCommlist=function(dSrcArr,notDel){var optArr=[],itemId='',itemType='',suitType='',noStock=''
addParam='';dSrcArr.forEach(function(el){itemId=$(el).attr('vskuid')||$(el).attr('promoid')||$(el).attr('skuid');suitType=$(el).attr('issuit')?($(el).attr('vskuid')?'1':'0'):'';itemType=$(el).attr('itemtype');noStock=notDel?'1':($(el).attr('nostock')==1?'2':'0');addParam=suitType.length>0?('suitType:'+suitType+'@@noStock:'+noStock):('noStock:'+noStock);optArr.push([itemId,'','','',itemType,'','',addParam].join(','));})
return optArr.join('$');}
var result=otherNoStockArr.length>0?getNewCommlist(selectedArr)+'$'+getNewCommlist(otherNoStockArr,true):getNewCommlist(selectedArr);return result;},delEve:function(isFavToDel){var me=this,commlist,selectedArr=$('.quick_clean .quick_clean_item.selected');if(selectedArr.length==0){me.showNotice('');return;}
commlist=me.getOptArr(selectedArr);hadChange=true;me.removeClearCart({commlist:commlist},function(json){if(json.errId==0&&json.clearcart){me.render(json.clearcart);cleanNum+=selectedArr.length
var str=''+cleanNum+'';var leftNum=0;for(var key in json.clearcart){leftNum+=+json.clearcart[key].totalNum;}
if(leftNum==0){$('.quick_clean_close').trigger('click');me.showNotice(isFavToDel?'':'');return;}
me.showNotice(isFavToDel?'':'');!isFavToDel&&wa('ptagExposure',{ptag:'7014.29.27'});$('.quick_clean .quick_clean_header .tit').html(str);}else if(json.errId==13){login.login();}else{me.showNotice('');}})},favEve:function(){var me=this,optArr=[],ids=[],selectedArr=$('.quick_clean .quick_clean_item.selected');if(selectedArr.length==0){me.showNotice('');return;}
if(selectedArr.length>40){me.showNotice('40');return;}
selectedArr.forEach(function(el){ids.push($(el).attr('skuid'));});(function(){var deferred=Q.defer();me.addToFavor({commId:ids.join(',')},function(obj){if(obj.iRet=='0'){wa('ptagExposure',{ptag:'7014.29.26'});deferred.resolve();}else if(obj.iRet=='9999'){login.login();}else{deferred.reject();}});return deferred.promise;}()).then(function(){var deferred=Q.defer();me.delEve(true);deferred.resolve();return deferred.promise;}).then(function(){}).fail(function(){});},stopBodyScroll:function(isFixed){var bodyEl=document.body;if(isFixed){nowScrollTop=window.scrollY;bodyEl.style.position="fixed";bodyEl.style.top=-nowScrollTop+"px";$(".shopheadJs").removeClass("fixed_1");$(".head_notice").removeClass("fixedJs_1");stopShopFix=true;}else{bodyEl.style.position="";bodyEl.style.top="";stopShopFix=false;window.scrollTo(0,nowScrollTop)}},showNotice:function(str,t){if(!str)return;t=t?t:2000;$('#noticeStr').html(str);$('#noticePanel').show();setTimeout(function(){$('#noticePanel').hide();},t);},checkError:function(obj){window.gbIsEditing=false;var me=this;if(obj.errId==='13'&&obj.nextUrl){var sUrl=obj.nextUrl;if(sUrl.indexOf('sid=')>-1){window.location.href=sUrl.split('?')[0]+'?sid='+JD.cookie.get('sid')+'&rurl='+encodeURIComponent(location.href);}else{window.location.href=sUrl+encodeURIComponent(location.href);}}else if(obj.errId==='44444'){clear_cart.oDialog=me.dialog({msg:'',confirmBtnTxt:'',cancelBtnTxt:'',style:'confirm',onConfirm:function(){location.reload();}});}else{var aDialog=me.dialog({style:'alert',msg:obj.errMsg||''});setTimeout(function(){aDialog&&aDialog.close();},3000);}},removeClearCart:function(optArr,callback){var me=this,commlist=optArr.commlist;var _opt={commlist:commlist,callback:"removeClearCartCb",templete:0,locationid:clear_cart.addrObj.areaId,reg:1,t:Math.random()};me.getIntfData(cart_cgi.removeClearCart,{params:_opt,onTimeout:function(){callback&&callback({errId:'44444'});},onError:function(){callback&&callback({errId:'33333'});}},function(json){callback&&callback(json);});},getClearCart:function(callback){var me=this;var _opt={templete:0,callback:"getClearCartCb",locationid:clear_cart.addrObj.areaId,reg:1,t:Math.random()};me.getIntfData(cart_cgi.getClearCart,{params:_opt,onTimeout:function(){callback&&callback({errId:'44444'});},onError:function(){callback&&callback({errId:'33333'});}},function(json){callback&&callback(json);});},addToFavor:function(opt,callback){var me=this,_opt={commId:opt.commId,callback:'addToFavorCb',t:Math.random()};me.getIntfData(cart_cgi.addToFavor,{params:_opt},function(json){callback&&callback(json);});},getIntfData:function(url,option,cbFun){var g_timeout=(JD.cookie.get("network")||'wifi')==='wifi'?10000:20000,_params=option.params||{},_cbName=option.params.callback,_errlogText=option.errlogText||(" "+_cbName+" ~~~ "),_timeout=option.timeout||g_timeout,_onTimeout=option.onTimeout||function(){console.log(_errlogText+"  ");},_onError=option.onError||function(){console.log(_errlogText+"  ");};window[_cbName]=function(json){delete window[_cbName];cbFun(json);}
var arrParam=[];for(var key in _params){arrParam.push(key+'='+_params[key]);}
mLoad.loadScript({url:url+arrParam.join("&"),charset:'utf-8',onTimeout:_onTimeout,timeout:_timeout,onError:_onError});},dialog:function(opt){var _opt=$.extend({tmpl:'<i class="{#icon#}"></i><p>{#msg#}</p>{#submsg#}{#btnHtml#}',confirmBtnHtml:'<p class="btns"><a href="javascript:;" class="btn">{#cancelBtnTxt#}</a><a href="javascript:;" class="btn btn_1" attr-tag="ok">{#confirmBtnTxt#}</a></p>',icon:'icon',style:'alert',msg:'',submsg:'',confirmBtnTxt:'',cancelBtnTxt:'',onBeforeConfirm:function(){},onBeforeCancel:function(){},onConfirm:function(){},onCancel:function(){}},opt),dFloat=document.getElementById('dialogConent'),dMask=document.getElementById('dialogMask'),sShowCls='show',me=this;if(_opt.style=='loading'){$('#wxloading').show();}else{if(!dFloat){dFloat=document.createElement('DIV');dFloat.id='dialogConent';document.body.appendChild(dFloat);}
dFloat.innerHTML=_opt.tmpl.replace('{#msg#}',_opt.msg).replace('{#submsg#}',_opt.submsg?'<p class="small">'+_opt.submsg+'</p>':'').replace('{#icon#}',_opt.icon).replace('{#btnHtml#}',_opt.style==='confirm'?_opt.confirmBtnHtml:'').replace('{#confirmBtnTxt#}',_opt.confirmBtnTxt).replace('{#cancelBtnTxt#}',_opt.cancelBtnTxt);dFloat.className='mod_alert fixed show';if(!dMask){dMask=document.createElement('DIV');dMask.className='mod_alert_mask show';dMask.id='dialogMask';document.body.appendChild(dMask);}else{$(dMask).addClass(sShowCls);}
$([dFloat,_opt.style==='alert'?dMask:{}]).on('click',function(e){var dSrc=e.target;if(dSrc.getAttribute('attr-tag')==='ok'){var res=_opt.onBeforeConfirm&&_opt.onBeforeConfirm.call(me);if(res!==false){_close();_opt.onConfirm&&_opt.onConfirm.call(me);}}else{var res=(_opt.onBeforeCancel&&_opt.onBeforeCancel.call(me));if(res!==false){_close();_opt.onCancel&&_opt.onCancel.call(me);}}
e.preventDefault();e.stopPropagation();});}
function _close(){$(dFloat).unbind('click').remove();$(dMask).unbind('click').removeClass(sShowCls);$('#wxloading').hide();gbIsEditing=false;}
return{close:_close};}}
exports.show=function(callback){_callback=callback;$('#moreAct').hide();QuickClean.show();}})
;/**
 *@author huangcailing
 *@version 2016/7/6
 * @description
 */
define('base64', function (require, exports, module) {
    var _cacheThisModule_;


    var _base64DecodeChars = new Array(
        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63,
        52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1,
        -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
        15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1,
        -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
        41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);
    var _base64EncodeChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";

    /*
     * base64
     * {@param str }
     * */
    function base64encode(str) {
        var out, i, len;
        var c1, c2, c3;
        len = str.length;
        i = 0;
        out = "";
        while (i < len) {
            c1 = str.charCodeAt(i++) & 0xff;
            if (i == len) {
                out += _base64EncodeChars.charAt(c1 >> 2);
                out += _base64EncodeChars.charAt((c1 & 0x3) << 4);
                out += "==";
                break;
            }
            c2 = str.charCodeAt(i++);
            if (i == len) {
                out += _base64EncodeChars.charAt(c1 >> 2);
                out += _base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
                out += _base64EncodeChars.charAt((c2 & 0xF) << 2);
                out += "=";
                break;
            }
            c3 = str.charCodeAt(i++);
            out += _base64EncodeChars.charAt(c1 >> 2);
            out += _base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
            out += _base64EncodeChars.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >> 6));
            out += _base64EncodeChars.charAt(c3 & 0x3F);
        }
        return out;
    }

    /**
     * base64
     * @param {str}
     */
    function base64decode(str){
        var c1, c2, c3, c4;
        var i, len, out;
        len = str.length;
        i = 0;
        out = "";
        while (i < len) {
            /* c1 */
            do {
                c1 = _base64DecodeChars[str.charCodeAt(i++) & 0xff];
            }
            while (i < len && c1 == -1);
            if (c1 == -1)
                break;
            /* c2 */
            do {
                c2 = _base64DecodeChars[str.charCodeAt(i++) & 0xff];
            }
            while (i < len && c2 == -1);
            if (c2 == -1)
                break;
            out += String.fromCharCode((c1 << 2) | ((c2 & 0x30) >> 4));
            /* c3 */
            do {
                c3 = str.charCodeAt(i++) & 0xff;
                if (c3 == 61)
                    return out;
                c3 = _base64DecodeChars[c3];
            }
            while (i < len && c3 == -1);
            if (c3 == -1)
                break;
            out += String.fromCharCode(((c2 & 0XF) << 4) | ((c3 & 0x3C) >> 2));
            /* c4 */
            do {
                c4 = str.charCodeAt(i++) & 0xff;
                if (c4 == 61)
                    return out;
                c4 = _base64DecodeChars[c4];
            }
            while (i < len && c4 == -1);
            if (c4 == -1)
                break;
            out += String.fromCharCode(((c3 & 0x03) << 6) | c4);
        }
        return out;
    }

    module.exports = {
        base64encode: base64encode,
        base64decode:base64decode
    };
});
;define("pinlike.report",function(require,exports,module){var base64=require('base64');var utils={umpBiz:function(bizid,operation,result,message){window.JD.report.umpBiz({bizid:bizid,operation:operation,result:result,source:'0',message:message||""});},sendByImage:function(url,params){if(!url)return;var image=document.createElement('img');var items=[];if(Object.prototype.toString.call(params)=='[object Object]'){for(var key in params){if(params[key]){items.push(key+'='+encodeURIComponent(params[key]));}}}
image.onload=image.onerror=function(){image=image.onload=image.onerror=null;};image.src=url+(url.indexOf('?')<0?'?':'&')+items.join('&');},getUrlParam:function(name,url){var u=arguments[1]||window.location.search,reg=new RegExp('(^|&)'+name+'=([^&]*)(&|$)','i'),r=u.substr(u.indexOf('\?')+1).match(reg);return r!=null?r[2]:'';},getCookie:function(name){var reg=new RegExp('(^| )'+name+'(?:=([^;]*))?(;|$)'),val=document.cookie.match(reg);if(!val||!val[2]){return'';}
var res=val[2];try{if(/(%[0-9A-F]{2}){2,}/.test(res)){return decodeURIComponent(res);}else{return unescape(res);}}catch(e){return unescape(res);}},setCookie:function(name,value,expires,path,domain,secure){var exp=new Date();expires=expires||null;path=path||'/';domain=domain||null;secure=secure||false;expires&&exp.setMinutes(exp.getMinutes()+parseInt(expires));document.cookie=name+'='+escape(value)+(expires?';expires='+exp.toGMTString():'')+(path?';path='+path:'')+(domain?';domain='+domain:'')+(secure?';secure':'');},getClientid:function(){var ua=navigator.userAgent;var m=ua.match(/([^;]*);network\/.*/);if(m){return m[1];}
return'';},setVisitkey:function(callback){function checkVK(visitkey){return visitkey!=''&&/\d+/.test(visitkey)&&visitkey>4294967295;}
function setVK(visitkey,onlySetLs){!onlySetLs&&utils.setCookie('visitkey',visitkey,52560000,'/','jd.com');}
function exeCallback(){typeof callback=='function'&&callback()}
var visitkey=utils.getUrlParam('visitkey')||'';if(checkVK(visitkey)){setVK(visitkey);exeCallback();return;}
visitkey=utils.getCookie('visitkey');if(checkVK(visitkey)){setVK(visitkey,true);exeCallback();return;}
if(window.JD){window.JD.events.listen('vkReady',function(){exeCallback();});return;}
window.loadPPVisitKey=function(datas){if(datas&&datas.visitkey){setVK(datas.visitkey);exeCallback();}};window.JD.sendJs('//wq.jd.com/mlogin/pvlog/set_visitkey?from_domain=jd&callback=loadPPVisitKey&_t='+Math.random());},getPPRD_PValue:function(prefix){var regs={QZGDT:/QZGDT\.([^\.\-]+)/gim,QZZTC:/QZZTC\.([^\.\-]+)/gim,ADKEY:/ADKEY\.([^\.\-]+)/gim,UUID:/UUID\.([^\.\-]+)/gim,WQVERSION:/WQVERSION\.([^\.\-]+)/gim,JZTK:/JZTK\.([^\.\-]+)/gim,EA:/EA\.((\d+)\.(\d+)\.(\d+))(\D?)/gim},pprd_p=utils.getCookie('PPRD_P')||'',paramIsArr=Array.isArray(prefix),rs={};prefix=paramIsArr?prefix:[prefix];pprd_p&&prefix.forEach(function(elem){if(regs[elem]&&regs[elem].test(pprd_p)){rs[elem]=RegExp.$1||'';}});return paramIsArr?rs:rs[prefix[0]];},getCookiePtag:function(){var reg="",resultArr=[],tmpArr="";var pprd_p=utils.getCookie("PPRD_P")||"";var regs={EA:/EA\.(\d+)\.(\d+)\.(\d+)/gim,IA:/IA\.(\d+)\.(\d+)\.(\d+)/gim,CT:/CT\.(\d+)\.(\d+)\.(\d+)/gim,PD:/PD\.(\d+)\.(\d+)\.(\d+)/gim};if(pprd_p.length){for(var prefix in regs){reg=regs[prefix];tmpArr=pprd_p.match(reg);tmpArr&&tmpArr.length&&resultArr.push(tmpArr[0]);}
return resultArr.join('-');}
return"";},StringBuffer:function(){this._strings_=[];this.append=function(str){this._strings_.push(str);}
this.toString=function(){return this._strings_.join('');}},vtoString:function(){var sb=new utils.StringBuffer();for(var key in this){if(this.hasOwnProperty(key)){if(typeof this[key]=='function'){continue;}
sb.append(key);sb.append('=');if(this[key]||this[key]===0){sb.append(this[key]);}
sb.append('$')}}
var data=sb.toString();return data.substring(0,data.length-1);},getRecommendParams:function(opt,type){var _paramsStr='';if(opt&&opt.pps){if(type=='EXPOSURE'){_paramsStr=(opt.pps||'')+','+(opt.ptag||'');}
if(type=='CLICK'){_paramsStr=opt.pps||'';}}
return _paramsStr;},getADParams:function(opt,type){var reportType={'EXPOSURE':'ad_expose','CLICK':'ad_click'}
var _options={};if(opt){_options={report_type:reportType[type]||'',source:opt.source||'',ad_sid:opt.sid||opt.ad_sid||'',reqsig:opt.reqsig||'',ad_type:opt.ad_type||3,skuid:opt.skuid||'',id:opt.id||0,page:opt.page||0,index:opt.index||0,broker_info:opt.broker_info&&base64.base64encode(JSON.stringify(opt.broker_info))||'',recpos:opt.recpos||''}}
return _options;},getBasicVParams:function(){var network=utils.getCookie('network'),nt=99;var channelType=(function(){var ua=navigator.userAgent.toLowerCase(),channelType='mobile',regsMap={'wxwork':/wxwork/gi,'weixin':/micromessenger/gi,'qq':/qq\/([\d\.]+)*/gi,'jdapp':/jdapp/gi,'skapp':/skapp/gi,'jdpingou':/jdpingou/gi,'jxj':/jxj\/([.\d])*/gi,'jdjr':/jdjr/gi};for(var key in regsMap){if(regsMap[key].test(ua)){channelType=key;break;}}
if(channelType!=='jdapp'&&channelType!=='skapp'&&channelType!=='jdpingou'&&(utils.getUrlParam('sceneval')==2||document.domain=='shop.m.jd.com'||document.domain=='coupon.m.jd.com'||document.domain=='s.m.jd.com'||document.domain=='so.m.jd.com'||document.domain=='p.m.jd.com'||document.domain=='home.m.jd.com'||document.domain=='item.m.jd.com'||document.domain=='m.yiyaojd.com'||document.domain=='mitem.jd.hk')){channelType='jdmobile';}
var wxapp_type=utils.getCookie('wxapp_type');var wxappver=utils.getUrlParam('wxappver');var wxappus=navigator.userAgent.toLowerCase();if(/miniprogram/gi.test(wxappus)||window.__wxjs_environment==='miniprogram'||!!wxapp_type||!!wxappver){channelType='xcx';}
var urlPath=(location.hostname+location.pathname)||'';if(urlPath&&urlPath.indexOf('wqs.jd.com/dataproduct')!==-1){channelType='gx';}
var kpl_source=utils.getCookie('source')||'';if(/^3_[0-9]+$/.test(kpl_source)){channelType='kpl';}
return channelType;})();var openidKey=channelType=='weixin'?'open_id':'sq_open_id',openidVal;if(window.localStorage){openidVal=localStorage.getItem('_tj_'+openidKey)||utils.getCookie(openidKey)||'';}
if(openidVal){localStorage.setItem('_tj_'+openidKey,openidVal);}
var screen=(function(){var a={},c=window.screen;a.size=c?c.width+'x'+c.height:'-';a.color=c?c.colorDepth+'-bit':'-';return a;})();var device_type=''
var os=(function(){var ua=navigator.userAgent,os={},android=ua.match(/(Android);?[\s\/]+([\d.]+)?/),ipad=ua.match(/(iPad).*OS\s([\d_]+)/),ipod=ua.match(/(iPod)(.*OS\s([\d_]+))?/),iphone=!ipad&&ua.match(/(iPhone\sOS)\s([\d_]+)/);if(android){os.android=true;os.version=android[2];device_type='android';}
if(iphone&&!ipod){os.ios=true;os.version=iphone[2].replace(/_/g,'.');device_type='iphone';}
if(ipad){os.ios=true;os.version=ipad[2].replace(/_/g,'.');device_type='ipad';}
if(ipod){os.ios=true;os.version=ipod[3]?ipod[3].replace(/_/g,'.'):null;device_type='ipod';}
if(!os.android&&!os.ios){os.other='';device_type='other';}
var o='';for(var key in os){if(key!='version'){o=key+'/'+(os.version||'');}}
return o;})();var browser=(function(){var b={name:'other',version:'0'},ua=navigator.userAgent.toLowerCase(),i,browsers=[],match;browsers=[['WeiXin',/micromessenger\/([^\s]+)/],['QQ',/qq\/([^\s]+)/],['QQBrowser',/(?:qqbrowser|qqlivebrowser)\/([^\s]+)/],['JDAPP',/jdapp;/],['QIHU',/qihu|360se/],['LieBao',/(?:lbbrowser|liebaofast)\/?([\d\.]+)?/],['Sogou',/(?:metasr|sogou[\w]*)[ \/]([\d\.]+)/],['Opera',/(?:opera|opr|oupeng)\/([\d\.]+)/],['BaiduBrowser',/(?:bidubrowser|baidubrowser)[\/ ]?([\d\.\w]+)/],['BaiduBox',/baiduboxapp|baiduboxpad/],['UC',/(?:ucweb|ucbrowser)\/?([\d\.]+)/],['Maxthon',/maxthon\/([\d\.]+)/],['Samsung',/samsungbrowser\/([\d\.]+)/],['Dolphin',/aphone|apad/],['2345',/2345/],['Miui',/miuibrowser\/([\d\.]+)/],['OppoBrowser',/oppobrowser\/([\d\.]+)/],['MeiZu',/mz-/],['Weibo',/weibo/],['Youku',/youku/],['NewsApp',/newsapp/],['AliApp',/aliapp/],['Firefox',/firefox\/([\d\.\w]+)/],['Chrome',/chrome\/([\d\.]+)/],['IE',/msie[ ](\d+\.\d+)/],['Safari',/safari\/([\d\.]+)/]];for(i=0;i<browsers.length;i++){match=ua.match(browsers[i][1]);if(match){b.name=browsers[i][0];b.version=match[1]||'0';break;}}
return b;})();var jda=(function(){var c=utils.getCookie('__wga'),rs={},defaultval=Date.now();c=c?c.split('.'):[]
rs.now_session_time=c[1]?c[1]:defaultval;rs.prev_session_time=c[2]?c[2]:defaultval;rs.first_session_time=c[3]?c[3]:defaultval;rs.page_seq=c[4]?c[4]:1;rs.session_seq=c[5]?c[5]:1;return rs;})();if(/wifi/i.test(network)){nt=1;}else if(/4g|3g+/i.test(network)){nt=4;}else if(/3g/i.test(network)){nt=3;}else if(/2g/i.test(network)){nt=2;}
return{logid:Date.now()+'.'+Math.round(Math.random()*2147483647),wq_unionid:utils.getCookie('wq_unionid')||'',uuid:utils.getPPRD_PValue('UUID')||'',jd_uuid:utils.getCookie('__jda')?(utils.getCookie('__jda')).split('.')[1]:'',chan_type:({weixin:1,qq:2,mobile:3,jdpingou:4,jdapp:6,jdmobile:7,wxwork:8,xcx:5,jdjr:9,kpl:10,skapp:11,gx:22})[channelType]||3,net_type:nt,pinid:utils.getCookie('pinId')||utils.getCookie('pinid')||'',wid:utils.getCookie('buy_uin')||'',openid:openidVal,screen:screen.size,color:screen.color,os:os,browser:browser.name+'/'+browser.version,device_type:device_type,fst:jda.first_session_time,pst:jda.prev_session_time,vct:jda.now_session_time,visit_times:jda.page_seq,jdv:utils.getCookie('__jdv')||'',unpl:utils.getCookie('unpl')||'',clientid:utils.getClientid(),wxapp_type:utils.getCookie('wxapp_type')||'',appkey:utils.getCookie('appkey')||'',wxapp_uuid:utils.getCookie('wxapp_uuid')||'',user_type_gx:(window.localStorage&&localStorage.getItem('accountType'))||'',pin_status:utils.getCookie('pinStatus')||'',wq_uits:utils.getCookie('wq_uits')||'',cookie_ptag:utils.getCookiePtag()};}}
function userDefinedReport(options){var urlArray=[];if(Array.isArray(options)){options.forEach(function(opt){if(opt.report_url){urlArray.push(opt.report_url);}})}else{if(options.report_url){urlArray.push(options.report_url);}}
if(urlArray.length>0){urlArray.forEach(function(url){utils.sendByImage(url)})}}
function recommendReport(type,options,refUrl){var val='';if(Array.isArray(options)){var valArray=[];options.forEach(function(opt){valArray.push(utils.getRecommendParams(opt,type));})
if(type=='EXPOSURE'){val=valArray.join('|');}
if(type=='CLICK'){val=valArray.join(',');}}else{val=utils.getRecommendParams(options,type);}
var params={}
if(type=='CLICK'){params.type='click2';params.pps=encodeURIComponent(val);}
if(type=='EXPOSURE'){params.refer=refUrl;params.val=encodeURIComponent(val);}
var recommendUrlMap={'EXPOSURE':'https://wq.jd.com/mcoss/rpds/batchrp','CLICK':'https://wq.jd.com/mcoss/rpds/report'}
utils.sendByImage(recommendUrlMap[type],params)}
function addAdvertisingReport(pageUrl,refUrl,opts){var v=utils.getBasicVParams();if(opts){for(var key in opts){if(opts.hasOwnProperty(key)){v[key]=opts[key];}}}
var visitKey=utils.getCookie('visitkey');if(!visitKey){utils.setVisitkey(function(){report()})}else{report()}
function report(){var data={t:'wg_wx.000007',m:'MO_J2011-2',pin:utils.getCookie('pin')||'-',sid:utils.getCookie('visitkey')+'|'+v.visit_times,url:pageUrl,ref:refUrl,rm:Date.now(),v:utils.vtoString.call(v)};utils.sendByImage('https://hermes.jd.com/log.gif',data)}}
function adReport(pageUrl,refUrl,opts,type){if(Array.isArray(opts)){opts.forEach(function(opt){var _options=utils.getADParams(opt,type);addAdvertisingReport(pageUrl,refUrl,_options)})}else{var _options=utils.getADParams(opts,type);addAdvertisingReport(pageUrl,refUrl,_options);}}
function pinLikeReport(options,type){var url=window.location.href||'';var ref=document.referrer||utils.getUrlParam('wdref')||'';userDefinedReport(options)
recommendReport(type,options,ref)
adReport(url,ref,options,type)}
module.exports={pinLikeExposure:function(opt){pinLikeReport(opt,'EXPOSURE');},pinLikeClick:function(opt){pinLikeReport(opt,'CLICK');}}})
;define('m.itemV2',function(require,exports,module){var __cacheThisModule__,$=require('zepto'),urlParam=require('url'),loopScroll=require('loopScroll'),ls=require('loadJs'),util=require('util'),cookie=require('cookie'),address=require('wq.address'),itemComm=require('wq.item.common'),mItemComm=require('m.item.common'),regionReport=require('wq.lib.regionReport'),skuImgPrice=require('wq.skuImgPrice'),itemSpec=require('m.itemSpecV2'),lazyLoad=require('lazyLoad'),activeDraw=require('wq.data.active'),cache=require('cachev1'),kepler=require('m.item.kepler'),banner=require('m.item.banner'),commonBusiness=require('jd.item.commonBusiness'),focusSlide=require('jd.item.focusSlide'),itemLabel=require('jd.item.label'),loginHandler=require('jd.item.loginHandler'),itemFavour=require('jd.item.favour'),shop=require('jd.item.shop'),skuSwitch=require('jd.item.skuSwitch'),buyNumController=require('jd.item.buyNumController'),promotion=require('jd.item.promotion'),related=require('jd.item.related'),detail=require('jd.item.detail'),comment=require('jd.item.comment'),userInfo=require('jd.item.user'),yanbao=require('jd.item.yanbao'),itemPrice=require('jd.item.price'),bargain=require('jd.item.bargain'),itemUtil=require('jd.item.util'),jdshopQuickClean=require('wq.jdshopQuickClean.v1'),numberp=require('numberp'),formatTime=itemUtil.formatTime,showNotice=itemUtil.showNotice,imageViewer=itemUtil.imageViewer,popUp=itemUtil.popUp,umpMonitor=itemUtil.umpMonitor,reporter=itemUtil.reporter,ReportManager=require('pinlike.report'),bizid='718';var ItemDet=function(){var opt={protocol:'http:',domainStr:'',isCrossDomain:false,locationUrl:'',isAndroid:false,isAndroid23:false,isUseSticky:false,isWX:false,isSQ:false,isSqEnv:/qq\/([\d\.]+)*/.test(navigator.userAgent.toLowerCase()),isKeplerScene:false,isLoginAct:false,isLoginInit:true,isImgInit:true,isZiying:false,isJDChoice:window._itemGlobal.isJDChoice,isExpByjd:false,isCashDelivery:false,isLoadCoupon:!(window._loadCoupon===false),isLoadYanbao:!(window._loadYanbao===false),isWareOff:false,isXnzt:false,isNormalAct:false,bid:urlParam.getUrlParam('bid'),itemId:urlParam.getUrlParam('ic'),skuType:"1",loopImg:[],pageHight:$(window).height(),pageWidth:$(window).width(),urlReg:/^(https*:){0,1}\/\//,mainViewScroll:0,viewScrollObj:{},scanOrig:urlParam.getUrlParam('scan_orig'),skuJson:{},skuChooseArr:[],noSkuArea:false,timeout:{},isInit:true,skuId:'',changeSkuId:'',baseSkuId:'',isChangeSku:false,descriptionId:'',specificationId:'',lastJdCategory:[],jdCategory:[],jdPrice:0,jdMprice:0,opPrice:0,jdStatus:true,jdSkuStatus:true,jdSkuInfo:{},jdDetailAddr:'',addrId:'',jdAddrId:[],jdAddrName:[],jdAddrUpgrade:false,koStatus:0,yushouStatus:0,ysNoWayInfo:{},venderId:0,venderName:'',isSpecItem:false,isHYKHSP:false,cpart:'main',isJx:false,isDist:false,isWoma:false,womaPostStr:'',isDzItem:false,pgInfo:{},guessGary:{},isOverseaPurchase:0,isOTC:0,cfeeType:null,timmer:null,stockState:{},locShopInfo:{},locJdGame:{},isSamGoods:false,isSamGoods2:false,isZxLx:false,isJdGame:false,isZxService:false,miaoErr:{errId:'',errMsg:''},network:'',isPlus:0,chnImg:[],accessoryNeedMore:true,isPanorama:false,isVoiceCheck:false,highlightedTimer:'',svcid:'',mainVideoId:'',infoVideoId:'',isOverseaAddr:false,soldOversea:0,taxInfo:null,isFCS:false,is9669order:false,isNewer:false,promiseNewParam:{'isPlus':'','magic':'','utype':'','ulevel':''},cidConfigs:{},specTextConfigs:{},cannotBuy:false,initHash:window.location.hash||'#main',lastHash:window.location.hash||'#main',nowHash:window.location.hash||'#main',carInfoObj:{modelId:0,zengJiLv:false},newerCouponObj:{libaoType:1,hasJsToken:false,timer:null,activeId:'',needPopup:false},buyConfigObj:{}};$.extend(this,opt);};ItemDet.prototype.init=function(){if(window._PFM_TIMING){try{window._PFM_TIMING[2]=new Date();if(!window._PFM_TIMING[4]){$('#firstImg').get(0).onload=function(){window._PFM_TIMING[4]=new Date();};}}catch(e){}}
umpMonitor.setBizid(bizid);this.protocol=window.location.protocol||this.protocol;this.locationUrl=(location.href||'').split('#')[0];this.isDist=(urlParam.getUrlParam('dist')==='jd');this.domainStr=(document.domain).split('.').slice(-2).join('.');this.isCrossDomain=(this.domainStr.indexOf('jd.com')!=0);if(this.isJDChoice){$('#buyBtn2').removeClass('btn_buy').addClass('btn_black');}
var os=$.os;this.isAndroid23=os&&os.android&&(os.version.indexOf('2.3')!=-1);this.isAndroid=os&&os.android;if(this.isAndroid23)$('body').addClass('android_23_fix');var obj=this;window._buyConfigInfo&&window._buyConfigInfo.forEach(function(v){if(v.key)obj.buyConfigObj[v.key]=v.value;});obj.buyConfigObj.buyJumpDelay=(obj.buyConfigObj.buyJumpDelay&&(obj.buyConfigObj.buyJumpDelay-0))||200;obj.buyConfigObj.buyTimeout=(obj.buyConfigObj.buyTimeout&&(obj.buyConfigObj.buyTimeout-0))||4000;obj.isJdPgApp=JD&&JD.device&&JD.device.scene=='jdpingou';window.isMScene=true;this.isKeplerScene=(window._isKeplerScene=='1');this.isSuperReturnChannel=(window._keplerConfig&&window._keplerConfig.channel&&window._keplerConfig.channel=='30a8d67966b144ada41ad1ce3f4b0972');this.isOperatorWalletApp=(window._keplerConfig&&window._keplerConfig.mopenbp21=='1');this.isSpecKepler22=(window._keplerConfig&&window._keplerConfig.mopenbp22=='1');this.isSpecKepler23=(window._keplerConfig&&window._keplerConfig.mopenbp23=='1');this.isLoginAct=(cookie.get('doAddCart')||cookie.get('dofav')||cookie.get('shopfav')||cache.getItem('itemLogin'));cache.removeItem('itemLogin');loginHandler.init({isMScene:isMScene,isLoginAct:this.isLoginAct});JD.report.umpBiz({bizid:bizid,operation:'22',result:loginHandler.getLoginStatus()?'0':'1',source:'0',message:'item login'});this.initCategoryConfigs();this.initSpecTextConfigs();this.initRecommendTabsConfigs();this.addressInit();this.setAddrId();address.clearCookies();itemSpec.addrCookieRp();this.baseSkuId=this.changeSkuId=this.skuId=window._itemOnly&&window._itemOnly.item&&window._itemOnly.item.skuId;if(window._itemInfo){this.skuJson[this.skuId]=window._itemInfo;this.isPlus=window._itemInfo.plusMemberType||0;this.chnImg=window._itemInfo.chnImg||[];this.skuChooseArr=window._itemInfo.skuChooseArr||[];this.noSkuArea=window._itemInfo.noSkuArea||1;this.isPanorama=(window._itemInfo.allOverImg&&window._itemInfo.allOverImg==1);this.taxInfo=window._itemInfo.taxinfov2;this.mainVideoId=window._itemInfo.mainVideoId;this.infoVideoId=window._itemInfo.infoVideoId;this.promiseNewParam.isPlus=window._itemInfo.plusFlag||'';this.promiseNewParam.magic=window._itemInfo.magicLevel||'';this.promiseNewParam.utype=window._itemInfo.uType||'';this.promiseNewParam.ulevel=window._itemInfo.uLevel||'';JD.report.umpBiz({bizid:bizid,operation:'16',result:'0',source:'0',message:'item straight success'});}else{JD.report.umpBiz({bizid:bizid,operation:'16',result:'1',source:'0',message:'item straight fail '+this.skuId});}
itemComm.setItemOrderChannel(obj.skuId);this.setItemInfo();itemSpec.isHuanAlert(this);this.bindEvent();if($('#drainageBanner').length)banner.init(this);itemComm.moduleReport();itemSpec.wqmnxCookieRp(this);};ItemDet.prototype.initCategoryConfigs=function(){var obj=this;if(window._categoryInfo){if(window._categoryInfo.length>0){obj.cidConfigs.weiKuanCid1s='|'+window._categoryInfo[0].cid1s+'|';obj.cidConfigs.weiKuanCid2s='|'+window._categoryInfo[0].cid2s+'|';obj.cidConfigs.weiKuanCid3s='|'+window._categoryInfo[0].cid3s+'|';}
if(window._categoryInfo.length>1){obj.cidConfigs.profitBeltCid1s='|'+window._categoryInfo[1].cid1s+'|';obj.cidConfigs.profitBeltCid2s='|'+window._categoryInfo[1].cid2s+'|';obj.cidConfigs.profitBeltCid3s='|'+window._categoryInfo[1].cid3s+'|';}
if(window._categoryInfo.length>2){obj.cidConfigs.rankingCid1s='|'+window._categoryInfo[2].cid1s+'|';obj.cidConfigs.rankingCid2s='|'+window._categoryInfo[2].cid2s+'|';obj.cidConfigs.rankingCid3s='|'+window._categoryInfo[2].cid3s+'|';}
if(window._categoryInfo.length>3){obj.cidConfigs.qualityInfoCid1s='|'+window._categoryInfo[3].cid1s+'|';obj.cidConfigs.qualityInfoCid2s='|'+window._categoryInfo[3].cid2s+'|';obj.cidConfigs.qualityInfoCid3s='|'+window._categoryInfo[3].cid3s+'|';}}};ItemDet.prototype.initSpecTextConfigs=function(){var obj=this;if(window._specText&&window._specText.length>0){window._specText.forEach(function(item,index){if(item.textId){obj.specTextConfigs[item.textId]=item;}});}};ItemDet.prototype.initRecommendTabsConfigs=function(){var obj=this;obj.recommendTabsConfigs={};if(window._recommendTabsSwitch&&window._recommendTabsSwitch.length>0){window._recommendTabsSwitch.forEach(function(item){if(item.tabId){obj.recommendTabsConfigs[item.tabId]=item;}});}};ItemDet.prototype.initStatus=function(opt){opt=opt||{};this.noSale=false;this.svcid='';this.jdStatus=true;this.jdSkuStatus=true;this.ysNoWayInfo={};this.dontSetBtnStatusAnyMore=false;if(this.sellWhilePresell){$('#addCart2,#addCart1').html('');$('#buyBtn2,#buyBtn1').find('.price').remove();$('#buyBtn1,#buyBtn2 span.txt').text('');$('#popupConfirm').text('').removeClass('yellow').addClass('red');popUp.setPopupArea(false,null);$('#priceSale2').show();$('#popupDoublePrice').show();$('#sellWhilePresellPrice').remove();this.sellWhilePresell=false;}
if(opt.itemType!='heyue'){this.cfeeType=null;this.maxBuyNum=200;}
$('#discountFloor').hide().find('.dicount_coupon').hide();$('#discountGap').hide();$('#globalBuyServiceArea').hide().removeClass('show');$('#artAuthor').hide();$('#addCart1,#addCart2').removeClass('btn_art');$('#statusNotice,#popupNotice,#ziYingMsg,#viewGuess,#arrivalNotice,#specBuyBtn,#specBuyBtn1,#jdCouponTip,#itemDesc,#globalNotice,#globalComm,#pcItemLink').hide();$('#serviceInfo,#actTitleDesc,#baitiaoDiv,#jdGameWrap').hide();$('#statusNoticeLink,#pcPriceDesc,#wxSqTip,#wxSqSpecTip,#doubleLabel,#postArea').hide();$('#cheaperNotice').show();$('#headEval').addClass('hide');$('#promShopFullfree').html('').hide();$('#sendArea').show();$('#aboveTitleTag, #beforeStockTag').hide();itemSpec.initStatus(opt);if(this.isSpecItem){this.koStatus=0;this.yushouStatus=0;if(this.timmer){clearInterval(this.timmer);this.timmer=null;}
this.locShopInfo.isLOC=false;this.locJdGame.isGame=false;$('#priceGroupStyle,#popSale').hide();$('#fav,#gotoCart').show();$('#favWrap').addClass('fn_goods_name');$('#itemDesc').addClass('right_shorter');}
if(opt.itemType!='heyue')this.isSpecItem=false;$('#priceNewer,#priceNewer2,#priceNewerStore').next('.mod_newer_price').remove();$('#priceNewer,#priceNewer2,#priceNewerStore').remove();};ItemDet.prototype.dxInit=function(){var obj=this;if(!obj.guessGary.isNewGuess)return;if(obj.guessGary.isGuessBottom){$('#detail').after($('#guessArea'));$('#guessArea').before('<div class="detail_gap"></div>');$('#detailAnchor a[dtype="guess"]').before($('#detailAnchor a[dtype="detail"]'));}else{$('#detailAnchor a[dtype="guess"]').before($('#detailAnchor a[dtype="detail"]'));}
$('#evalTag, #evalTag2').addClass('cmt_tag_new');$('#summaryEnter3').show();if(obj.guessGary.isShowTopTabs){$('#detailAnchor').on('click','a',function(e){var tar=$(this),dtype=tar.attr('dtype');if(!dtype)return;var domid='loopImgDiv',cptag='';switch(dtype){case'item':cptag='7001.1.147';break;case'comment':domid='summaryEnter';cptag='7001.1.148';break;case'detail':domid='detailBaseLine';cptag='7001.1.149';break;case'guess':domid='guessArea';cptag='7001.1.150';break;}
obj.scrollToBlock(domid,-44);cptag&&window.wa&&wa('jdClick',{ptag:cptag});});window.wa&&window.wa('ptagExposure',{ptag:'7001.1.146'});}};ItemDet.prototype.setCheaperEvalVisible=function(stockState){var obj=this;obj.isHideCheaper=(obj.isWareOff||obj.isfqy||obj.canNotBuyAlone||obj.canNotBuyHere||(obj.isJMa&&!obj.hasBigouma)||obj.isYuShou||obj.qianggou);if(obj.isHideCheaper||stockState==3){$('#headEval').removeClass('hide');$('#cheaperNotice').hide();}else{$('#headEval').addClass('hide');$('#cheaperNotice').show();}};ItemDet.prototype.calculateItemSpAttr=function(json){var obj=this;var item=json.item||{},stock=json.stock,spAttr=item.spAttr||{};obj.taxInfo=json.taxinfov2;obj.mainVideoId=json.mainVideoId||0;obj.infoVideoId=json.infoVideoId||0;obj.isJx=(spAttr.IsJX=='1');obj.bigPromoteInfo=obj.getBigPromoteInfo();obj.isOverseaPurchase=spAttr.isOverseaPurchase>0?spAttr.isOverseaPurchase:0;obj.soldOversea=spAttr.SoldOversea?parseInt(spAttr.SoldOversea):0;obj.isNormalAct=((obj.skuType==2||obj.skuType==3)&&obj.jdCategory[1]!='14669'&&obj.jdCategory[1]!='4855'&&obj.jdCategory[1]!='6929');obj.isOnlineBook=/^3\d{7}$/.test(obj.skuId);obj.isWoma=(obj.venderId=='663284');obj.isSam=(obj.venderId=='603837');obj.isSamGoods=(spAttr.isSamGoods=='1');obj.isSamGoods2=(obj.venderId=='684711');obj.isZxLx=(spAttr.zxLx=='1');obj.isDzItem=(spAttr.Customize=='1'||spAttr.Customize=='2');obj.is9669order=(spAttr.isSelfService=='1'&&obj.venderId!='1000089641'&&(!obj.isZiying||obj.jdCategory[2]!='12856'));obj.isOTC=(obj.jdCategory[1]=='12632'?3:0);obj.isXnzt=(spAttr.isXnzt=='1');obj.venderType=stock&&stock.D&&stock.D.type;obj.stockSid=stock&&stock.sid;obj.isFCS=(obj.venderType==100);obj.isSCF=(window._itemGlobal&&window._itemGlobal.scfGray)&&(obj.venderType==110);obj.isJMa=(spAttr.isJMa=='1');obj.isHYKHSP=(spAttr.HYKHSP=='1'||obj.jdCategory[2]=='1195');obj.isZxService=(json.decorate&&json.decorate.isZx==1&&~' 9944 9953 9945 9946 9947 9948 '.indexOf(' '+obj.jdCategory[2]+' '));obj.isSupportCard=(spAttr.isSupportCard==='1');obj.isEcard=(obj.jdCategory[2]=='6980');obj.isFlimPrint=spAttr.isFlimPrint;obj.isYsp=(spAttr.ysp==1||spAttr.ysp==3);obj.isCjg=(spAttr.ysp==2||spAttr.ysp==3);obj.isSecondHand=(obj.jdCategory[0]==='13765');obj.isfqy=(spAttr.fqy==='1');obj.isPaiPai=(obj.isSecondHand||obj.isfqy);obj.isPrescribeDrug=!!(~' 13315 13326 13335 13349 13354 13362 13380 13388 13424 13430 13446 13456 13468 13488 13494 13500 13504 13518 13527 '.indexOf(' '+obj.jdCategory[1]+' '));obj.isJzzy=((obj.isZiying||obj.isFCS)&&item.brandId=='299330');obj.isHeyue=(json.feetype&&json.feetype.datas&&json.feetype.datas.length>0);obj.isLoc=spAttr.isLOC;obj.isLocStore=(spAttr.isLOC=='1');obj.isOnlineService=(spAttr.isLOC=='2');obj.isJdGame=(spAttr.isLOC=='3');obj.isTencentVideo=(spAttr.isLOC=='4');obj.isXnkq=(spAttr.xnkq=='2');obj.isAutoXufei=spAttr.hyxf&&' 15048 4836 '.indexOf(' '+obj.jdCategory[2]+' ')>=0;obj.isCzGoods=obj.jdCategory&&' 4835 4836 12276 12277 15048 '.indexOf(' '+obj.jdCategory[2]+' ')>=0;obj.jdfwj=spAttr.jdfwj;obj.zyTravel=(spAttr.factoryShip=='1'&&' 003 103 104 105 106 107 '.indexOf(' '+spAttr.VirtualSpecial+' ')>=0);obj.isSxdzq=(spAttr.isSelfService=='32');obj.isOilCard=(obj.jdCategory&&obj.jdCategory[2]=='14410');obj.isPresale=(item.skuMark&&item.skuMark.presale);obj.isYuShou=(spAttr.YuShou=='1');obj.isYuShouNoWay=(spAttr.YuShouNoWay=='1');obj.qianggou=(spAttr.isKO=='1')||(json.miao&&json.miao.isKo=='1');obj.newDrugGray=obj.jdCategory&&obj.jdCategory[0]=='13314'&&obj.isZiying&&window._itemGlobal&&window._itemGlobal.M_drugSwitch;obj.isNewJdGame=(spAttr.xnzysp=='1');obj.isWholeVehicle=obj.jdCategory&&obj.jdCategory[0]=='12379';obj.isDidiCard=obj.jdCategory[2]=='13758';if(obj.isEcard||obj.isDzItem||obj.isHYKHSP||obj.isPresale||obj.isYuShou||obj.qianggou||obj.isHeyue||obj.isPrescribeDrug||obj.isfqy||(obj.isSamGoods||obj.isSamGoods2)||(obj.isJMa&&obj.hasBigouma)||obj.isLocStore||obj.isOnlineService||obj.isJdGame||obj.isTencentVideo||obj.isNewJdGame){obj.isSpecItem=true;}else{obj.isSpecItem=false;}
obj.canNotBuyAlone=(obj.jdfwj=='1'||obj.jdfwj=='3'||spAttr.isSelfService==='1'||spAttr.isSelfService==='2'||spAttr.isSelfService==='5'||spAttr.GiftsGoods=='1'||spAttr.isPackBox==='1'||spAttr.isGiftCard==='1');var isTicketItem=(obj.skuId>=200000000000&&obj.skuId<=209999999999&&!~' 7074 4944 4945 4946 4947 4948 4949 4950 13046 7086 12294 5156 12423 13663 12198 12422 15294 14696 '.indexOf(' '+obj.jdCategory[2]+' '));obj.canNotBuyHere=(!obj.isSpecItem&&~' 12274 13121 13532 12277 12276 12278 13046 4833 4835 4836 7073 7074 7086 12095 12273 14410 '.indexOf(' '+obj.jdCategory[2]+' ')||~' 591371 198809 117761 621014 '.indexOf(' '+obj.venderId+' ')||obj.isZiying&&obj.jdCategory[2]=='12856'||(spAttr.isWeChatStock*1>0&&!((spAttr.isWeChatStock*1)&4))||~' 4 5 6 '.indexOf(' '+spAttr.isLOC+' ')||~' 1 2 '.indexOf(' '+spAttr.tsop+' ')||(~' 14402 14385 14386 14387 14389 14390 14391 14392 14395 14399 14400 14388 14393 14394 14396 14397 14398 14401 '.indexOf(' '+obj.jdCategory[2]+' ')&&/20(\d{10})/.test(obj.skuId))||(spAttr.LeaseType==3)||obj.isOnlineBook)||obj.isAutoXufei||obj.venderType=='101'||isTicketItem;if((obj.isXnkq&&obj.jdPrice>=0)||(obj.isCzGoods&&!obj.isAutoXufei)||obj.jdfwj=='2'||obj.zyTravel||obj.isSxdzq||obj.isOilCard||obj.isOnlineService||obj.is9669order||obj.isDidiCard){obj.isSpecItem=true;obj.canNotBuyAlone=false;obj.canNotBuyHere=false;}
if(obj.isOperatorWalletApp&&(!obj.isZiying||obj.jdCategory[0]=='13887'||obj.jdCategory[0]=='4053'||(~' 14088 14097 11849 13295 16874 16875 13992 '.indexOf(' '+obj.jdCategory[2]+' '))||(~' 9192 1713 4053 '.indexOf(' '+obj.jdCategory[0]+' '))||(~' 17325 7041 13210 13205 13206 13209 13207 13208 13211 15115 15114 13278 13279 13280 379 17200 13225 13224 13223 13222 12976 13188 13189 13196 13203 13199 13197 9897 13200 15104 13201 13198 13202 16825 16956 13237 13236 16964 16963 1012 13235 16967 16966 13239 13238 16965 13191 13190 13193 13194 13192 13195 12793 13104 1137 13227 7069 6980 4988 12079 14237 13226 14932 12585 13181 13177 13179 13180 13178 647 17038 17206 17204 17205 12258 17201 17202 13271 13272 13277 1203 13273 13274 982 13275 13276 13282 11757 13281 17375 9113 13285 13187 13186 13185 12426 13183 12425 13184 12068 13173 13171 13174 13175 13172 13170 16872 13169 13176 13283 11407 13284 13948 13947 13954 13928 13929 13939 13166 13168 13167 13160 17403 13164 15297 13162 15294 15570 15296 13165 13159 12774 13233 13217 13220 13212 13214 13215 13218 13216 6166 13219 13221 13213 '.indexOf(' '+obj.jdCategory[2]+' ')||~' 14692 13654 703 807 13529 4828 4975 4826 9862 15600 4976 4979 17467 17427 17314 12402 4980 12854 4973 4830 14372 17449 4974 17450 13113 13726 14203 4971 4972 4978 15682 15680 '.indexOf(' '+obj.jdCategory[1]+' ')||~' 13996 4938 15083 13678 15980 15298 9669 12650 5272 7191 12367 6321 12379 12814 '.indexOf(' '+obj.jdCategory[0]+' ')))){obj.canNotBuyHere=true;}
if(obj.isSpecKepler23&&(obj.jdCategory[2]=='1195'||obj.jdCategory[2]=='6881'||obj.jdCategory[1]=='9196')){obj.canNotBuyHere=true;}
try{if(obj.isJzzy)reporter.pingClick('MProductdetail_JZProDetailPV');if(obj.isEcard)reporter.pingClick("MProductdetail_EcardPV",'','',obj.skuId);if(obj.isJx)reporter.pingClick("MProductdetail_SelectedProduct");if(obj.isHeyue){reporter.pingClick("MProductdetail_Contract");}else if(obj.isOTC){reporter.pingClick("MProductdetail_OTCPV");}else if(obj.isOverseaPurchase>0){reporter.pingClick("MProductdetail_Global");}else if(obj.isPresale||(obj.isYuShouNoWay&&obj.isYuShou)){reporter.pingClick("MProductdetail_PreSale");}else if(obj.isSamGoods||obj.isSamGoods2){reporter.pingClick("MProductdetail_SamPV",'A');}else if(obj.isOilCard){reporter.pingClick("MProductdetail_OilCardPV");}else if(obj.isDzItem){reporter.pingClick("MProductdetail_CustomizationPV");}else if(obj.isCzGoods){reporter.pingClick("MProductdetail_GameCardPV");}else if(obj.isPrescribeDrug){reporter.pingClick("MProductdetail_MedicinePV");}else{reporter.pingClick("MProductdetail_Normal",'','',obj.skuId);}}catch(e){}};ItemDet.prototype.setItemInfo=function(param){var obj=this;param=param||{};umpMonitor.createTimeout('1','item view api fail');window.skuInfoCB=function(json){if(json.huanUrl){JD.report.umpBiz({bizid:bizid,operation:'28',result:'1',source:'0',message:'item view api return huan url'});location.href=json.huanUrl;return;}
if(!obj.isInit&&json.redirectUrl){JD.report.umpBiz({bizid:bizid,operation:'28',result:'2',source:'0',message:'item view api return redirect url'});location.href=json.redirectUrl;return;}
if(json.errCode=='20160304'){JD.report.umpBiz({bizid:bizid,operation:'28',result:'4',source:'0',message:'item view api return errCode 20160304'});popUp.createPopup({flag:4,msg:'',icon:'info',okText:'',cancelText:'',onConfirm:function(){location.href='//so.m.jd.com/category/all.html';},onCancel:function(){location.href='//m.jd.com';}});return;}
if(!obj.isInit&&json.pingou&&json.pingou==1){JD.report.umpBiz({bizid:bizid,operation:'28',result:'3',source:'0',message:'item view api return redirect url'});location.href='//wqs.jd.com/pingou/item.shtml?sku='+obj.changeSkuId;return;}
var item=json.item||{},stock=json.stock,spAttr=item.spAttr||{};if(item.skuMark&&(typeof item.skuMark)=='string'){item.skuMark=JSON.parse(item.skuMark);}
if(!(item.skuMark&&item.skuMark.presale)&&!(spAttr.YuShouNoWay=='1'&&spAttr.YuShou=='1')){if(!obj.isInit&&json.pingou&&json.pingou==1){if(obj.isJDApp){location.href='//wqs.jd.com/pingou/item.shtml?sku='+obj.changeSkuId;}else{location.href=JD.url.addUrlParam(location.href.replace(obj.baseSkuId,obj.changeSkuId),{neverBack:'0'});}
return;}}
JD.report.umpBiz({bizid:bizid,operation:'28',result:'0',source:'0',message:'item view api has no existing business error'});!obj.isInit&&obj.initStatus(param);obj.skuJson[obj.changeSkuId]=json;obj.skuId=obj.changeSkuId;if(!json.item||!json.item.category||!json.item.category.length){JD.report.umpBiz({bizid:bizid,operation:'15',result:(!json.item?'5':'6'),source:'0',message:'item view api noitemcategory'+obj.skuId});}
obj.isFestival=json.isFestival||0;obj.superrebate=json.superrebate;obj.descriptionId=item.description||'';obj.specificationId=item.specification;obj.jdPrice=(obj.isKeplerScene&&json.price&&json.price.bp)||(json.price?json.price.p:0)||urlParam.getUrlParam('price');obj.jdMprice=json.price?json.price.m:0;obj.jdMprice=json.price?json.price.m:0;obj.opPrice=json.price?json.price.op:0;obj.skuType=item.skuType;obj.isZiying=!item.isPop;obj.venderId=item.venderID;obj.lastJdCategory=obj.jdCategory;obj.jdCategory=item.category||[];if(window._jdApp)window._jdApp.category=obj.jdCategory[0];obj.decorate=json.decorate;obj.isWareOff=(item.warestatus!='1');obj.hasBigouma=(json.bigouinfo=='1');obj.isLoadCoupon=(spAttr.isKO!='1');obj.isPingou=json.pingou==1;obj.isPingouShop=json.pingouShop==='1';obj.calculateItemSpAttr(json);if(obj.isLocStore){obj.locAddCartDirect=false;if(spAttr.locfwlx){var locfwlxStrArr=(spAttr.locfwlx||'').split(',');locfwlxStrArr.forEach(function(l){if(l=='1')obj.locAddCartDirect=true;});}}
mItemComm.jumpToWQ(obj);if(obj.isJDChoice&&(obj.isLocStore||obj.isJdGame||(obj.isSamGoods||obj.isSamGoods2))){window.location.href=obj.getNewSkuUrl(obj.skuId,'general');return;}
obj.guessGary=obj.guessGaryFun();obj.dxInit();if(!obj.isInit){if(typeof setAppGuide=='function')window.setAppGuide(obj.skuId);if(typeof setBannerAppGuide=='function')window.setBannerAppGuide(obj.skuId);}
commonBusiness.handleJx(obj.isJx);commonBusiness.handleAdultTip(obj.jdCategory);commonBusiness.sendToHome(spAttr.zywtzbs,json.upc);if(obj.isJx){reporter.reportExposure({ptag:'7001.4.1'});}
var focusImages=item.image;if(obj.isPlus==1&&obj.chnImg.length>=1){focusImages=obj.chnImg;}
if(!obj.focusSlide){obj.focusSlide=focusSlide.init({containerId:'loopImgDiv',imgContainerId:'loopImgUl',imgBarContainerId:'loopImgBar',images:focusImages,slideCallback:function(x){if(x==1){$('#loopImgDiv [followfirstimg="1"]').show();}else{$('#loopImgDiv [followfirstimg="1"]').hide();}},showLastImgSliderIndicator:true,lastImgSliderCallback:function(){var offset=0,dxDom=$('#detailAnchor');if(dxDom&&dxDom.length&&dxDom.css("display")!="none"){offset=-44;}
window.wa&&wa('jdClick',{ptag:'7001.1.212'});obj.scrollToBlock('detailBaseLine',offset);}});}else{obj.focusSlide.refreshImages(focusImages);}
obj.loopImg=obj.focusSlide.loopImg;if(!obj.isInit){$('#popupImg').attr('src',obj.loopImg[0]);var shareObj=window.mchb&&window.mchb.getCommonShare&&window.mchb.getCommonShare();shareObj&&shareObj.resetConfig&&shareObj.resetConfig({url:(location.origin+location.pathname).replace(obj.baseSkuId,obj.skuId)+'?utm_campaign=t_1001328990',title:item.skuName,img:obj.loopImg[0],titleWbQz:item.skuName});}
obj.setThreeDimensionalEntry(json.model3DId);itemLabel.setLabel(obj);itemSpec.handleClothes(obj,json.clothesColor);obj.setIconTitle({skuName:item.skuName,stock:stock});obj.setAdvertTip(json.AdvertCount&&json.AdvertCount.ad);var jxdesc=json.jxdesc||{};if(obj.isJDChoice&&jxdesc.title&&jxdesc.desc){$('#descriptionChoice').show().html('<i class="quotation type_s"></i><em>'+jxdesc.title+'</em> '+jxdesc.desc+'<i class="quotation type_e"></i>');}else{$('#descriptionChoice').hide();}
if(obj.skuType==2||obj.skuType==3)obj.loadActTitleDesc();if(!obj.isSuperReturnChannel){var promotionConfig={isMScene:true,hidePromotion:(obj.isNewJdGame),version:2,isJDChoice:obj.isJDChoice,is9669order:obj.is9669order,isPrescribeDrug:obj.isPrescribeDrug,skuId:obj.skuId,skuName:item.skuName,firstImg:item.image&&item.image[0],jdPrice:obj.jdPrice,buyNum:(obj.buyNumController&&obj.buyNumController.buyNum)||1,promov2:json.promov2,bankpromo:json.bankpromo,priceExt:json.price&&json.price.ext,showPhoneCard:(~['830'].indexOf(obj.jdCategory[1])||~['655','2694','5146','12348','12093'].indexOf(obj.jdCategory[2])),plusFlag:json.plusFlag||'',};if(!obj.promotion){obj.promotion=promotion.init(promotionConfig);}else{obj.promotion.refresh(promotionConfig);}}
var priceConfig={isJDChoice:obj.isJDChoice,isSamGoods:obj.isSamGoods,isSamGoods2:obj.isSamGoods2,isPresale:obj.isPresale,isSamVip:obj.isSamVip,isZxService:obj.isZxService,skuId:obj.skuId,isHyj:!(!obj.cfeeType||obj.cfeeType.ft==100),jdAddrId:obj.jdAddrId,venderId:obj.venderId,jdCategory:obj.jdCategory,isWareOff:obj.isWareOff,isNormalAct:obj.isNormalAct,priceData:json.price,areaSkuId:item.areaSkuId,jdMprice:obj.jdMprice,giftFlag:obj.promotion&&obj.promotion.giftFlag,plusFlag:json.plusFlag||''};if(obj.isInit){obj.itemPrice=itemPrice.init(priceConfig);}else{obj.itemPrice.refresh(priceConfig);}
obj.jdPrice=obj.itemPrice.jdPrice||obj.jdPrice;obj.setShareConfig();if(!obj.isSuperReturnChannel)itemSpec.plusGiftLogic(obj);obj.setCheaperEvalVisible();itemSpec.wuyouInsurance(obj);itemSpec.globalBuyService(obj,json.taxinfov2);itemSpec.jzService(obj,item.brandId,json.jdzzDesc);if(obj.isInit){obj.skuSwitch=skuSwitch.init({newColorSize:item.newColorSize,salePropSeq:item.salePropSeq||{},saleProp:item.saleProp||{},skuId:obj.skuId,spuId:obj.descriptionId.replace(/^d/,''),cmmz:spAttr.cmmz});}
var buyNumConfig={skuId:obj.skuId,jdAddrId:obj.jdAddrId,venderId:obj.venderId,skuName:item.skuName,promov2:json.promov2,lowestBuy:spAttr.LowestBuy||1,mnum:spAttr.MN*1,jdCategory:obj.jdCategory,disableChangeBuyNum:(obj.isJMa&&obj.hasBigouma)||obj.isCzGoods,canOnlyBuyOne:(obj.isHeyue||obj.isfqy||obj.jdfwj=='2')};if(obj.isInit){obj.buyNumController=buyNumController.init(buyNumConfig);}else{obj.buyNumController.refresh(buyNumConfig);}
obj.getBaiTiao();var yanbaoConfig={isMScene:window.isMScene,isWxWork:obj.isWxWork,skuId:obj.skuId,brandId:item.brandId,venderId:obj.venderId,jdCategory:obj.jdCategory,jdPrice:obj.jdPrice,jdAddrId:obj.jdAddrId,isXnzt:obj.isXnzt,hideYanbao:(!obj.isLoadYanbao||obj.isfqy||window.isSpecWxapp||obj.isPresale),hideServiceEnter:(obj.soldOversea>0&&obj.isOverseaAddr||obj.is9669order||window.isSpecWxapp||obj.isPresale),hidePackageJd:(spAttr.YuShou=='1'||obj.isPresale||(spAttr.YuShouNoWay=='1'&&spAttr.YuShou=='1')||obj.isOverseaPurchase>0||spAttr.factoryShip=='1'||obj.stockSid=='52'),setPackageGift:!obj.isWareOff&&!obj.canNotBuyHere&&!obj.canNotBuyAlone&&!obj.isYuShou&&!obj.qianggou&&!obj.isLocStore&&!obj.isJdGame&&spAttr.isSupportCard==='1'&&spAttr.isXnzt!=='1'&&!obj.isfqy};if(obj.isInit){obj.yanbao=yanbao.init(yanbaoConfig);}else{obj.yanbao.refresh(yanbaoConfig);}
itemSpec.setConservationArea(obj);itemSpec.addEnter(obj);itemSpec.xianxiaStore(obj);if(obj.isInit){obj.itemFavour=itemFavour.init({isMScene:isMScene,isLoginAct:obj.isLoginAct,containerId:'fav',skuId:obj.skuId,jdCategory:obj.jdCategory,jdSkuIds:obj.skuSwitch.jdSkuIds,venderId:obj.venderId});}else{obj.itemFavour.changeSku(obj.skuId);}
if(obj.isInit){obj.shop=shop.init({isLoginAct:obj.isLoginAct,isMScene:true,isJDChoice:obj.isJDChoice,containerId:'shopArea',favourText:'',isZiying:obj.isZiying,isOverseaPurchase:obj.isOverseaPurchase,isFCS:obj.isFCS,isSCF:obj.isSCF,stock:stock,venderId:obj.venderId,skuId:obj.skuId,mainImg:obj.loopImg[0],skuName:item.skuName,jdPrice:obj.jdPrice,jdCategory:obj.jdCategory,isWoma:obj.isWoma,isSam:obj.isSam});}
if(!obj.isPrescribeDrug){var commentConfig={isMScene:window.isMScene,isJDChoice:obj.isJDChoice,initHash:obj.initHash,guessGary:obj.guessGary,jdCategory:obj.jdCategory,baseSkuId:obj.baseSkuId,skuId:obj.skuId};if(obj.isInit){obj.comment=comment.init(commentConfig);try{if(cache.getItem('evalInfo')){var evalInfo=JSON.parse(cache.getItem('evalInfo'));cache.removeItem('evalInfo');if(evalInfo.evalList&&evalInfo.evalList[obj.skuId]&&evalInfo.evalList[obj.skuId][evalInfo.evalType]){if(window.location.hash!='#summary')window.history.pushState({page:1},'title 1','#summary');obj.historyStateChange('#summary');obj.lastHash='#main';obj.comment.renderSummaryPage(evalInfo);}else{if(window.location.hash&&'#main'.indexOf(window.location.hash)<0){window.history.pushState({page:1},'title 1','#main');this.initHash=window.location.hash;}}}else{if(window.location.hash&&'#main'.indexOf(window.location.hash)<0){window.history.pushState({page:1},'title 1','#main');this.initHash=window.location.hash;}}}catch(e){if(window.location.hash&&'#main'.indexOf(window.location.hash)<0){window.history.pushState({page:1},'title 1','#main');this.initHash=window.location.hash;}}}else{obj.comment.refresh(commentConfig);}}
obj.isInit&&itemSpec.askAnswer(obj);mItemComm.setWiki(obj,obj.jdCategory&&obj.jdCategory[2]);!obj.isJDChoice&&obj.loadRecommendSecondHand(obj.isInit);if(obj.isInit){if(!obj.isJDChoice){itemSpec.accessory(obj);obj.loadRecommendSuit();obj.loadDesignerCollocation();}
obj.loadGuess();}
var detailConfig={isMScene:true,isJDChoice:obj.isJDChoice,isPlus:obj.isPlus,skuId:obj.skuId,addBrandAct:obj.isZiying&&!obj.isOverseaPurchase,addAd:!obj.isJDChoice&&!obj.isSamGoods&&!obj.isSamGoods2,isZiying:obj.isZiying,isFCS:obj.isFCS,venderId:obj.venderId,skuType:obj.skuType,descriptionId:obj.descriptionId,specificationId:obj.specificationId,itemInfo:obj.item(),spAttr:spAttr,expandAttrDesc:(obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].expAttr)?obj.skuJson[obj.skuId].expAttr:(obj.item().expandAttrDesc||{}),isOverseaPurchase:obj.isOverseaPurchase,jdCategory:obj.jdCategory,taxInfo:obj.taxInfo,videoId:obj.infoVideoId,mainImgs:obj.loopImg};if(obj.isInit){obj.detail=detail.init(detailConfig);}else{obj.detail.refresh(detailConfig);}
if(param.itemType!="heyue"){obj.initCartBuy(spAttr,function(canBuy){if(canBuy&&obj.isHeyue)itemSpec.setSkuAttach(obj,json.feetype);});}
if(!obj.isWareOff&&!obj.canNotBuyHere&&!obj.canNotBuyAlone){if(obj.isPresale||(obj.isYuShouNoWay&&obj.isYuShou)){itemSpec.yuShouNoWay(obj);}else if(obj.isYuShou){obj.maxBuyNum=1;itemSpec.yuShou(obj);}else if(obj.qianggou){obj.maxBuyNum=1;itemSpec.qianggou(obj);}else{itemSpec.secondKill(obj,{'needBanner':true});}
if(!(obj.isPresale||(obj.isYuShouNoWay&&obj.isYuShou))&&!obj.isYuShou&&!obj.qianggou&&!obj.isLocStore&&!obj.isJdGame){obj.getSkuStock(stock);}}
var bargainConfig={hideEntry:(obj.isJDChoice||json.kanjia!=1||obj.stockState[obj.skuId]==3||(item.skuMark&&item.skuMark.presale)||spAttr.YuShou=='1'||spAttr.isKO=='1'||(json.miao&&json.miao.isKo=='1')||obj.isSecKill),skuId:obj.skuId,price:obj.jdPrice};if(obj.isInit){obj.bargain=bargain.init(bargainConfig);}else{obj.bargain.refresh(bargainConfig);}
obj.getPostPrice();obj.setServiceArea();loginHandler.loginSetCookie(function(){if(cookie.get('_mkjdcn')&&window._useCommonHeader){$('#detailAnchor').show();$('#content').show();obj.adjustHeaderHeight();}
if(!loginHandler.getLoginStatus()&&!obj.isLoginAct&&cache.getItem('itemCoupon')){loginHandler.login();return;}
if(!loginHandler.getLoginStatus())window.wa&&window.wa('ptagExposure',{ptag:'7001.1.245'});if(!obj.isSuperReturnChannel&&!obj.isNewJdGame){if(obj.isCrossDomain){obj.getCouponList();}else{obj.liBaoCoupon();}}
obj.setCartNum();if(obj.isLoginInit){if(cookie.get('doAddCart')){var cookirStr=cookie.get('doAddCart');cookie.del('doAddCart');cookie.del('doAddCart','/','jd.com');if(cookirStr!='ok'){try{cookirStr=JSON.parse(cookirStr);}catch(e){}}
obj.addCart(cookirStr);}}
obj.isLoginInit=false;});if(obj.isPrescribeDrug)itemSpec.prescribeDrug(obj);if(obj.isfqy)itemSpec.fqyPay(obj);if(obj.isZxService)itemSpec.zxService(obj);if(obj.isSamGoods||obj.isSamGoods2)itemSpec.samInfo(obj);if(obj.isYsp)itemSpec.setArtScene(obj);if(obj.isSecondHand)itemSpec.secondHand(obj);if(obj.isEcard)itemSpec.eCard(obj,spAttr.yysfhf);if(obj.isLocStore)itemSpec.showStore(obj);if(obj.isJdGame)itemSpec.showJdGame(obj,json.ruId);if(obj.isTencentVideo)itemSpec.tencentVideo(obj);if(obj.is9669order)$('#popupSkuArea').hide();if(obj.isDidiCard)$('#popupCount').hide();if(obj.isNewJdGame){$('#specBuyBtn,#specBuyBtn1').off().on('click',function(){var $this=$(this);if($this.hasClass('btn_disable')||$this.hasClass('disabled_1'))return;location.href='//junion.m.jd.com/settlement/'+obj.skuId;});}
if(obj.isFlimPrint=='1'||obj.isFlimPrint=='3'){$('#specBuyBtn,#specBuyBtn1').off().on('click',function(){var $this=$(this);if($this.hasClass('btn_disable')||$this.hasClass('disabled_1'))return;location.href='//printing.m.jd.com/index.html#/?skuId='+obj.skuId;});}
obj.setInstallService(spAttr);itemSpec.checkCarSku(obj);if(obj.isInit||(obj.jdCategory.length>2&&obj.lastJdCategory.length>2&&obj.jdCategory[2]!=obj.lastJdCategory[2])){itemSpec.carInfo(obj);}
if(!obj.newDrugGray){var hideRelated=(obj.isNewJdGame);if(!obj.related){obj.related=related.init({isMScene:true,hideRelated:hideRelated,isJDChoice:obj.isJDChoice,skuId:obj.skuId,isPrescribeDrug:obj.isPrescribeDrug,venderId:obj.venderId,jdCategory:obj.jdCategory,item:item,mainImg:obj.loopImg[0],jdAddrId:obj.jdAddrId,needRelate:!obj.isfqy,needAccessory:~' 655 831 832 834 5012 2694 672 1105 '.indexOf(' '+obj.jdCategory[2]+' ')&&(!obj.locJdGame.isGame||!obj.isJDChoice)});}else{obj.related.refresh({skuId:obj.skuId,hideRelated:hideRelated,isPrescribeDrug:obj.isPrescribeDrug,venderId:obj.venderId,jdCategory:obj.jdCategory,item:item,mainImg:obj.loopImg[0],jdAddrId:obj.jdAddrId,needRelate:!obj.isfqy,needAccessory:~' 655 831 832 834 5012 2694 672 1105 '.indexOf(' '+obj.jdCategory[2]+' ')&&(!obj.locJdGame.isGame||!obj.isJDChoice)});}}
try{regionReport.report({bid:6});reporter.init({isJDChoice:obj.isJDChoice,koStatus:obj.koStatus,baseSkuId:obj.baseSkuId,skuId:obj.skuId,isZiying:obj.isZiying,jdCategory:obj.jdCategory,jdPrice:obj.jdPrice,venderName:obj.venderName,venderId:obj.venderId,brandName:item.brandName,brandId:item.brandId,jdAddrId:obj.jdAddrId,pTag:item.pTag});reporter.reports({ptag:'7001.7.3'});if(!obj.isHideCheaper)reporter.reports({ptag:'7001.1.110'});}catch(e){}
umpMonitor.delTimeout('itil1');JD.report.umpBiz({bizid:bizid,operation:'1',result:'0',source:'0',message:'item view api loaded'});obj.isInit=false;};if(obj.skuJson[obj.changeSkuId]){window.skuInfoCB(obj.skuJson[obj.changeSkuId]);}else{var viewUrl=[location.origin+'/item/mview2?datatype=1&callback=skuInfoCB&cgi_source=mitem'+(obj.isCrossDomain&&urlParam.getUrlParam('_mt')?'&_mt='+urlParam.getUrlParam('_mt'):''),'sku='+this.changeSkuId,'t='+Math.random()];if(obj.isSamGoods||obj.isSamGoods2){viewUrl.push('isSamGoods=1');}
ls.loadScript(viewUrl.join('&'));}};ItemDet.prototype.adjustHeaderHeight=function(){setTimeout(function(){var $mHeader=$('#m_header'),headerHeight=$mHeader.height(),commonHeaderHeight=$('#m_common_header').height(),contentHeight=$('#m_header .header_content').height();if(window.location.hash.indexOf('#main')!==-1||window.location.hash===''){$mHeader.css('height',contentHeight-commonHeaderHeight);}else{if(Math.abs(contentHeight-headerHeight)>10){$mHeader.css('height',contentHeight);}}},0);};ItemDet.prototype.setThreeDimensionalEntry=function(model3DId){var obj=this;$('#tdEntry').hide();if(!model3DId)return;var range=((model3DId+'').substring(0,4))-0;if(range!=1000&&range!=2000)return;reporter.reportExposure({ptag:'7001.1.333'});reporter.pingClick('MProductdetail_3DPicExpo',obj.skuId+'_0');setTimeout(function(){if(!$('#tdEntry').length){$('#firstImgLi').append('<div id="tdEntry" class="td_entry"></div>');}
$('#tdEntry').show();var canReport=true;$('#tdEntry').off().on('tap',function(){if(!canReport)return;canReport=false;setTimeout(function(){canReport=true;},20);reporter.reports({ptag:'7001.1.334'});reporter.pingClick('MProductdetail_3DPicExpo',obj.skuId+'_0');}).on('click',function(e){e.stopPropagation();setTimeout(function(){location.href='//ar.jd.com/task/3dModelH5View.do?sku='+obj.skuId;},300);});},2000);};ItemDet.prototype.bindEvent=function(){var obj=this;$(window).on("scroll",function(){obj.scroll();});$.subscribe('item.skuSwitch.switch',function(e,skuId,skuName){obj.isChangeSku=true;if(skuId){obj.jdSkuStatus=true;obj.changeSkuId=skuId;if(obj.ysNoWayInfo.isYuShouNoWay){window.setTimeout(function(){location.href=obj.locationUrl.replace(obj.baseSkuId,skuId);},200);}else{obj.skuChooseArr=[].concat(skuName);skuName.push(obj.buyNumController.buyNum+'');$('#popupSkuChoose').html('<span></span>'+' '+skuName.join(','));$('#storeSkuChoose').html(skuName.join(' '));obj.setItemInfo();}}else{obj.jdSkuStatus=false;itemSpec.checkClothesColorListNew(obj);}});$.subscribe('item.skuSwitch.checkSkuListNew',function(e,skuPro){if(obj.carInfo)itemSpec.checkSkuListForCar(obj,skuPro);});$.subscribe('item.main.gotoPage',function(e,hash){if(!hash)return;window.history.pushState({page:1},'title 1',hash);obj.historyStateChange(hash);});$.subscribe('item.related.addCart',function(e,param){obj.addCart(param);});$.subscribe('item.related.handleAccessories',function(e,accessories){obj.renderAccessory(accessories);});$.subscribe('item.comment.commentHeaderRendered',function(){obj.adjustHeaderHeight();});$.subscribe('item.main.leavePage',function(){obj.saveEvalListCache();});JD.events.listen('item.buyNumController.buyNumChange',function(num){$('#popupSkuChoose').html('<span></span>'+' '+obj.skuChooseArr.concat(num+'').join(','));$('#skuChoose1,#storeSkuChoose').html(obj.skuChooseArr.concat(num+'').join(','));itemSpec.landingMatch(obj);});JD.events.listen('item.buyNumController.noSale',function(){obj.noSale=true;$('#postNotice small span').html('');$('#postTip').html('');obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{disable:true},addBtnConfig:{disable:true},popupBuyAreaConfig:{disablePopupConfirm:true}});});var replaceDom=function(opt){opt=opt||{};var flag=opt.flag,isAccessory=(flag==1),$dom=opt.$dom,typeId=$dom.attr(isAccessory?'typeid':'areaid'),oldTypeId=(isAccessory?obj.jdSkuInfo.accessory.typeId:obj.locJdGame.areaId),oldSlideBox=$(isAccessory?'#accessoryWrap':'#gameWrap');if(isAccessory){obj.jdSkuInfo.accessory.typeId=typeId;}else{obj.locJdGame.areaId=typeId;}
popUp.replaceDom({$old:oldSlideBox,oldKey:(isAccessory?'accessory':'jdgame')+oldTypeId,newKey:(isAccessory?'accessory':'jdgame')+typeId,cb:function(hasNew){if(!hasNew){if(isAccessory){obj.setLoopDom({html:obj.jdSkuInfo.accessory[typeId],tag:'accessory',loopScroll:true,divClassName:'slider_page cols_3',ulClassName:'grid',num:6});obj.setAccessoryPrice();}else{obj.setLoopDom({html:obj.locJdGame[typeId],tag:'game',loopScroll:true,divClassName:'slider_page competition_goods',ulClassName:'grid',num:4});}}}});};var $discountFloor=$('#discountFloor'),$discountPopup=$('#discountPopup');$discountFloor.on('click',function(){$discountPopup.find('.main').css({'min-height':parseInt(obj.pageHight*0.5997),'max-height':parseInt(obj.pageHight*0.832)});$discountPopup.find('.body').css({'max-height':parseInt(obj.pageHight*0.832)-($discountPopup.find('.header').height()||46)});popUp.showHidePopup($discountPopup,true);if(obj.autoGetCoupon&&obj.autoGetCoupon.key&&obj.autoGetCoupon.roleid){window.setTimeout(function(){var $em=$('.coupon_voucher3[key="'+obj.autoGetCoupon.key+'"][roleid="'+obj.autoGetCoupon.roleid+'"]');$em.find('.coupon_voucher3_info_btn').addClass('disabled').text('');$em.attr('key','').attr('roleid','');},100);}
for(var roleId in obj.fansCouponRoleIdObj){reporter.reportExposure({ptag:'7001.8.5',venderid:obj.venderId,roleId:roleId});}
if($discountFloor.find('.coupon').length>0){reporter.reports({ptag:'7001.1.70'});reporter.pingClick('MProductdetail_NewCouponFloor','','',obj.skuId);}
reporter.reports({ptag:'7001.1.351'});});$discountPopup.on('click',function(){popUp.showHidePopup($discountPopup);});$discountPopup.find('.main').on('click',function(event){event.preventDefault&&event.preventDefault();event.stopPropagation&&event.stopPropagation();});$discountPopup.find('i.close').on('click',function(){popUp.showHidePopup($discountPopup);});$discountPopup.find('.floor_coupon').on('click','.coupon_voucher3',function(){var tar=$(this);var reportObj={'total':$('#popupDom').find('.coupon_voucher3').length,'index':(tar.index()*1+1),'type':tar.attr('type'),'ptag':'7001.1.256'};reporter.reports(reportObj);obj.throttle(obj.getCoupon,obj,200,{firstDo:true,param:[$(this)]});});var buyTimes=0,buyAction=function($em){var emId=$em.attr('id');if(obj.noSkuArea==1&&(!obj.isSpecItem||obj.sellWhilePresell)&&emId=='buyBtn2'&&!$('#buyBtn2').hasClass('btn_disable')&&!obj.popupBuyAreaClicked){popUp.showPopupArea('2');return;}
if(emId=='popupConfirm'){if($em.attr('tag')=='1'){obj.sellWhilePresellBuy=false;if(obj.sellWhilePresell){obj.sellWhilePresellBuy=true;}else{try{var eventParam=obj.skuId+"_";if(obj.isOverseaPurchase){eventParam+="1";}else if(obj.isOTC){eventParam+="2";}else if(obj.isSamGoods||obj.isSamGoods2){eventParam+="3";}else if(obj.isSecKill){eventParam+="4";}else{eventParam+="0";}
reporter.pingAddClick("MProductdetail_Addtocart",eventParam,"5",obj.skuId);reporter.txReport({ptag:'7001.1.10'});}catch(e){}
obj.addCart(null,function(){$('#popupClose').trigger('click');});return;}}}
try{var url=obj.getBuyLink();if(url){buyTimes++;if(buyTimes>1){JD.report.umpBiz({bizid:bizid,operation:'15',result:'10',source:'0',message:['item buy times',buyTimes,obj.skuId,url].join('_')});}else{umpMonitor.createTimeout('26','item buy click fail'+obj.skuId,obj.buyConfigObj.buyTimeout);}}
try{cookie.set('buysku',obj.skuId,30);if(window.jdm&&window.jdm.x){var v=window.jdm.x(window.jdm.y);window.jdm.z&&cookie.set(window.jdm.z,v,999999,"/",obj.domainStr);cookie.set('wqmnx',window.jdm.w||'1bcd1c43jdm356a3e3a6hpea2b4e4130',999999,"/",obj.domainStr);}
if(url){if(obj.isJMa&&obj.hasBigouma){url=util.addRd(url,'7464.1.1');}}else{umpMonitor.delTimeout('itil21');}}catch(e){}
if(url){if(obj.isJMa&&obj.hasBigouma){popUp.createPopup({flag:4,msg:'',icon:'info',okText:'',cancelText:'',onConfirm:function(){obj.leavePage(url,false,'order');},onCancel:null});}else if(obj.isHYKHSP){obj.jumpHkBuyLink(url);}else{setTimeout(function(){itemUtil.judgeBuyLink(url,function(tourl,iswxapp){if(iswxapp){obj.leavePage();JD.wxapp.goto(tourl);}else{obj.leavePage(tourl,false,'order');}});},obj.buyConfigObj.buyJumpDelay);}
JD.report.umpBiz({bizid:bizid,operation:'26',result:'0',source:'0',message:'item buy clicked'});}}
catch(e){if(url){setTimeout(function(){obj.leavePage(url,false,'order');},obj.buyConfigObj.buyJumpDelay);}
JD.report.umpBiz({bizid:bizid,operation:'15',result:'8',source:'0',message:'item buy jserror'+e});}};var canReport=true;$('#buyBtn1,#buyBtn2,#popupConfirm').on('tap',function(){if(!canReport)return;canReport=false;setTimeout(function(){canReport=true;},20);var $em=$(this),ptag=(obj.koStatus>0?'7001.1.9':'7001.1.8');var emId=$em.attr('id');if(emId=='popupConfirm')reporter.reports({ptag:'7001.11.8'});if(obj.noSkuArea==1&&(!obj.isSpecItem||obj.sellWhilePresell)&&emId=='buyBtn2'&&!$('#buyBtn2').hasClass('btn_disable')&&!obj.popupBuyAreaClicked){return;}
if(emId=='popupConfirm'&&$em.attr('tag')==='1'){return;}
reporter.txReport({ptag:ptag});try{if(obj.isJMa&&obj.hasBigouma){reporter.pingAddClick('MProductdetail_ShoppingCodeBuy',obj.skuId,'5',obj.skuId);}else if(obj.isHeyue){reporter.pingClick('MProductdetail_Contractbuy',obj.skuId,'5',obj.skuId);}else if(obj.yushouStatus==2){reporter.pingClick('MProductdetail_SubscribeImmediately',obj.skuId,'5',obj.skuId);}else if(obj.koStatus==1||obj.koStatus==2){reporter.pingAddClick('MProductdetail_PurchaseImmediately',obj.skuId,'5',obj.skuId);}else if(obj.ysNoWayInfo.yuShouNoWayStatus==1){reporter.pingAddClick('MProductdetail_OrderImmediately',obj.skuId,'5',obj.skuId);}else if(obj.isOilCard){reporter.pingClick('MProductdetail_OilCardOrder',obj.skuId,'5',obj.skuId);}else if(obj.isXnkq){reporter.pingClick('MProductdetail_AppleCardOrder',obj.skuId,'5',obj.skuId);}else if(obj.isCzGoods){reporter.pingClick('MProductdetail_GameCardOrder',obj.skuId,'5');}else{var easyType="0";if(obj.isSecKill)easyType="1";reporter.pingAddClick('MProductdetail_Easybuy',obj.skuId+'_'+easyType,'5',obj.skuId);}}catch(e){}}).on('click',function(){if(obj.cpart=='store'&&!obj.hasChoosedStore&&!obj.locAddCartDirect){showNotice({str:''});return;}
if(obj.isCarInstall&&obj.carInstallChoose==='1'){if($(this).attr('id')=='buyBtn2'){popUp.showPopupArea('2');}else{showNotice({str:''});$('#carInstallPop')[0].scrollIntoView();}
return;}
obj.throttle(buyAction,obj,500,{firstDo:!window.__wxjs_is_wkwebview,param:[$(this)]});});var canReport1=true;$('#addCart1,#addCart2').on('tap',function(){if(!canReport1)return;canReport1=false;setTimeout(function(){canReport1=true;},20);var $em=$(this);var emId=$em.attr('id');if(obj.noSkuArea==1&&(!obj.isSpecItem||obj.sellWhilePresell)&&emId=='addCart2'&&!$('#addCart2').hasClass('btn_disable')){return;}
if(obj.sellWhilePresell){reporter.txReport({ptag:'7001.1.8'});reporter.pingAddClick('MProductdetail_Easybuy',obj.skuId+'_0','5',obj.skuId);}}).on('click',function(){if(obj.cpart!='store'&&(obj.isWholeVehicle&&!obj.locAddCartDirect)&&!obj.hasChoosedStore){$('#storePanel').trigger('click');return;}
if(obj.cpart=='store'&&!obj.hasChoosedStore&&!obj.locAddCartDirect){showNotice({str:''});return;}
if(obj.isCarInstall&&obj.carInstallChoose==='1'){if($(this).attr('id')=='addCart2'){popUp.showPopupArea('1');}else{showNotice({str:''});$('#carInstallPop')[0].scrollIntoView();}
return;}
var emId=$(this).attr('id');if(obj.noSkuArea==1&&(!obj.isSpecItem||obj.sellWhilePresell)&&emId=='addCart2'&&!$('#addCart2').hasClass('btn_disable')){popUp.showPopupArea('1');return;}
obj.sellWhilePresellBuy=false;if(obj.sellWhilePresell){obj.sellWhilePresellBuy=true;obj.throttle(buyAction,obj,500,{firstDo:!window.__wxjs_is_wkwebview,param:[$(this)]});return;}
try{var eventParam=obj.skuId+"_";if(obj.isOverseaPurchase){eventParam+="1";}else if(obj.isOTC){eventParam+="2";}else if(obj.isSamGoods||obj.isSamGoods2){eventParam+="3";}else if(obj.isSecKill){eventParam+="4";}else{eventParam+="0";}
reporter.pingAddClick("MProductdetail_Addtocart",eventParam,"5",obj.skuId);reporter.txReport({ptag:'7001.1.10'});}catch(e){}
obj.throttle(obj.addCart,obj,500,{firstDo:true,param:['null',function(){emId!='addCart2'&&$('#popupClose').trigger('click');}]});});$('#addrArea').off().on('click',function(){obj.mainViewScroll=$(window).scrollTop();address.show();});$('#popupImg').on('click',function(e){obj.focusSlide.preview();});$('#part_main,#part_store,#btnTools,#popupBuyArea').on('click',function(e){var target=e.srcElement||e.target,em=target,i=1;while(em&&!em.id&&i<=4){em=em.parentNode;i++;}
if(!em||!em.id)return;var $em=$(em),emId=em.id;if(~emId.indexOf('accessory_')||~emId.indexOf('game_')){if($em.hasClass('cur'))return;$em.addClass('cur').siblings().removeClass('cur');replaceDom({flag:(~emId.indexOf('accessory_')?1:2),$dom:$em});return;}
if(~emId.indexOf('accessoryCart_')){var skuId=$em.attr('sku');if(skuId){reporter.txReport({ptag:'7001.1.19',skuId:skuId});obj.addCart({type:0,commlist:[skuId,'',1,skuId,'1,0,0'],isAccessory:true});}
return;}
switch(emId){case'viewGuess':case'viewGuess1':obj.leavePage('//home.m.jd.com/myjd/similar/list.action?skuId='+obj.skuId);break;case'arrivalNotice':case'arrivalNotice1':obj.setArrivalNotice();break;case'gotoCart':reporter.reports({ptag:'7001.1.1'});reporter.pingClick('MProductdetail_GotoCart',obj.skuId,'',obj.skuId);setTimeout(function(){var ptag=$('#cartNum').css('display')!='none'?'138442.1.3':'138442.1.4';if(obj.isJdPgApp){obj.leavePage('//p.m.jd.com/cart/cart.action?ptag='+ptag+'&pingouchannel=0');}else{obj.leavePage('//p.m.jd.com/cart/cart.action?ptag='+ptag);}},200);break;case'dapeiTab':case'designTab':case'accessoryTab':case'guessTab':case'rankTab':case'secondhandTab':var $target=$(target),tag=$target.attr('tag');if($target.hasClass('cur'))return;$('#dapeiBd,#designBd,#accessoryBd,#guessBd,#rankBd,#secondhandBd').hide();$('#'+tag+'Bd').show();$target.addClass('cur').siblings().removeClass('cur');obj.tabIndx={sku:obj.baseSkuId,tag:tag};break;case'popupSkuCont':popUp.createPopDom();break;case'baitiaoItem':case'serviceAreaDiv':case'serviceArea':case'globalBuyServiceArea':case'easeBuyServiceArea':case'jzServiceArea':var isBaiTiao=~emId.indexOf('baitiao'),isGlobalBuy=~emId.indexOf('globalBuy'),isGlobalChoice=~emId.indexOf('globalChoice'),isEaseBuy=~emId.indexOf('easeBuy'),isJz=~emId.indexOf('jz');if(isBaiTiao&&$('#baitiaoDiv').hasClass('spec_no_point')){break;}
popUp.createPopDom({skuId:obj.skuId,isSku:true,className:(isBaiTiao?'detail_baitiao_main':(isGlobalBuy?'detail_global_service_v2_main':(isGlobalChoice?'detail_global_choice_service_main':(isEaseBuy?(obj.isOverseaPurchase==2?'detail_ease_global_service_main':'detail_ease_service_main'):(isJz?'detail_jz_service_main':'detail_serve_main'))))),title:(isBaiTiao?'':(isGlobalBuy?'':(isGlobalChoice?'':(isEaseBuy?(obj.isOverseaPurchase==2?'':''):(isEaseBuy?(obj.isOverseaPurchase==2?'':''):(isJz?'':'')))))),body:popUp.popupBody[(isBaiTiao?'baitiao':(isGlobalBuy||isGlobalChoice?'globalService':(isEaseBuy?'easeService':(isJz?'jzService':'service'))))],btnTxt:(isBaiTiao?'':''),closeClass:(isGlobalBuy||isGlobalChoice||isEaseBuy||isJz)?'close_sp':'close',});break;case'headEval':case'evalNo1':case'evalNo3':document.getElementById('summaryEnter').scrollIntoView(true);break;case'cheaperNotice':obj.setCheaperNotice();break;default:break;}});$('body').on('tap',function(e){var target=e.srcElement||e.target,em=target,i=1;try{while(em&&em.nodeName!='BODY'&&!em.getAttribute('ptag')&&i<=4){em=em.parentNode;i++;}
if(!em||!em.getAttribute('ptag'))return;var ptag=em.getAttribute('ptag');reporter.txReport({ptag:ptag,noJd:true});}catch(e){}});$('#part_video').on('click','.video_fixed_close',function(){window.history.go(-1);});$('#itemName').off().on('click',function(e){e.preventDefault();var offset=0,dxDom=$('#detailAnchor');if(dxDom&&dxDom.length&&dxDom.css("display")!="none"){offset=-44;}
obj.scrollToBlock('detailBaseLine',offset);}).attr('ptag','7001.1.163');$('#guessArea').on('click','a',function(){var tar=$(this),href=tar.attr('href'),urlReg=/^(https*:){0,1}\/\//;if(href&&urlReg.test(href)){var tag=$('#guessArea .tab_item.cur').attr('tag');cache.setItem('guesstabindx',JSON.stringify({sku:obj.baseSkuId,tag:tag,scrollTop:$(window).scrollTop()}),60);location.href=href;}});$(window).on('hashchange',function(){obj.historyStateChange(window.location.hash||'#main');});$('#popupBuyArea').on('tap','.detail_carsku_item, .btn_choose, .sku_choose>.item, .minus:not(.disable), .plus:not(.disable), .text_wrap, .service_choose .item, .btns>.btn:not(.disabled_1)',function(){obj.popupBuyAreaClicked=true;$('#popupBuyArea').off('tap');});};ItemDet.prototype.scroll=function(){var obj=this;if(imageViewer.blackCoverShow){window.scrollTo(0,imageViewer.lockScrollH);return;}
var st=$(window).scrollTop();if(obj.guessGary.isShowTopTabs&&(!obj.nowHash||obj.nowHash=='#main')){window.clearTimeout(obj.highlightedTimer);obj.highlightedTimer=setTimeout(function(){obj.highlightedTopTabs(st);},50);}
var $ybNavTab=$('#ybNavTab .nav_tab');if(st>0){$ybNavTab.addClass('fixed').css('top',($('#m_common_header').height()||0)+'px');}else{$ybNavTab.removeClass('fixed').css('top','0px');}
obj.guessExposal();};ItemDet.prototype.highlightedTopTabs=function(st){var obj=this,ind=0,sts=[],dtypes=[];tabs=$('#detailAnchor a[dtype]'),mainDom=$('#part_main'),parentDom=$('#detailAnchor'),itemdom=$('#loopImgDiv'),comdom=$('#summaryEnter'),detaildom=$('#detailBaseLine'),guessdom=$('#guessArea');if(!mainDom.length||mainDom.css('display')=='none'){return;}
if(itemdom.length>0&&itemdom.css('display')!='none'){sts.push((itemdom.position().top-44));dtypes.push('item');}
if(comdom.length>0&&comdom.css('display')!='none'){sts.push((comdom.position().top-44));dtypes.push('comment');}
if(obj.guessGary.isGuessBottom){if(detaildom.length>0&&detaildom.css('display')!='none'){sts.push((detaildom.position().top-44));dtypes.push('detail');}
if(guessdom.length>0&&guessdom.css('display')!='none'){sts.push((guessdom.position().top-44));dtypes.push('guess');}}else{if(guessdom.length>0&&guessdom.css('display')!='none'){sts.push((guessdom.position().top-44));dtypes.push('guess');}
if(detaildom.length>0&&detaildom.css('display')!='none'){sts.push((detaildom.position().top-44));dtypes.push('detail');}}
sts.push(9999999);for(var i=0;i<sts.length;++i){if(sts[i]<=st&&sts[i+1]>st){ind=i;continue;}}
if(ind!=obj.guessGary.tabind){obj.guessGary.tabind=ind;$('#detailAnchor a[dtype].cur').removeClass('cur');parentDom.find('[dtype="'+dtypes[obj.guessGary.tabind]+'"]').addClass('cur');}};ItemDet.prototype.showPart=function(part,func){var lastCpart=this.cpart;this.cpart=part;this.comment&&this.comment.setCpart(this.cpart);var obj=this,arr=['main','address','tab','summary','related','gift','landing','store','video'],needBtnTools=' summary store ',$btnTools=$('#btnTools');if(part!='main'){$('#jdBtmLogo').parent().hide();}else{$('#jdBtmLogo').parent().show();}
if(lastCpart=='main'||lastCpart=='summary')this.mainViewScroll=$(window).scrollTop();setTimeout(function(){for(var i=0;i<arr.length;i++){arr[i]==part?$('#part_'+arr[i]).show():$('#part_'+arr[i]).hide();}
if(part!='main'&&$('#popupBuyArea').hasClass('show')){obj.popupBuyAreaShow=true;popUp.showHidePopup($('#popupBuyArea'),false);}
if(lastCpart!='store'&&part=='main'&&obj.popupBuyAreaShow){obj.popupBuyAreaShow=false;popUp.showHidePopup($('#popupBuyArea'),true);}
if(part=='summary'){$('#cmt_header').show();}else{$('#cmt_header').hide();}
$('#m_common_header .jd-header-new-title>span').hide();$('#'+part+'_title').show();obj.adjustHeaderHeight();part=='main'||(part=='summary'&&lastCpart=='video')?window.scrollTo(0,obj.mainViewScroll):window.scrollTo(0,0);if(func)func();if(part=='summary'&&obj.evalMainClickIndex>0){var $evalMainClick=$('#evalDet_summary').find('li').eq(obj.evalMainClickIndex-1);if($evalMainClick.length){obj.viewScrollObj['summary']=$evalMainClick.position().top||0;window.scrollTo(0,obj.viewScrollObj['summary']);setTimeout(function(){window.scrollTo(0,obj.viewScrollObj['summary']);},50);}
obj.evalMainClickIndex=0;}
if(part=='main'||(~needBtnTools.indexOf(' '+part+' ')&&window._itemGlobal&&window._itemGlobal.summaryBottomGray)){$btnTools.show();}else{$btnTools.hide();}
if(part=='store'){$btnTools.addClass('store_page');$('#m_header').hide();$('#bottomYLBtn').hide();}else{$btnTools.removeClass('store_page');$('#m_header').show();$('#bottomYLBtn').show();}
setTimeout(function(){obj.guessExposal();},100);},100);};ItemDet.prototype.historyStateChange=function(hash){var obj=this;obj.lastHash=obj.nowHash;obj.nowHash=hash;if(!(window._itemGlobal.getUrlParam('utm_term')=='Wxfriends')||!window._itemGlobal.shareImkGray){if(window.location.hash.indexOf('#main')!==-1||window.location.hash===''){window.mchb&&window.mchb.setHeaderStype(2);}else{window.mchb&&window.mchb.setHeaderStype(1);}}
switch(hash){case'#related':obj.showPart('related');break;case'#summary':if(obj.lastHash!='#img'){obj.showPart('summary');}
break;case'#gift':obj.showPart('gift');break;case'#landing':obj.showPart('landing');break;case'#main':obj.showPart('main');popUp.popupshow&&$('body').css('top','-'+$(window).scrollTop()+'px').addClass('overflowHide');break;case'#video':obj.showPart('video');break;case'#store':obj.showPart('store');break;default:break;}};ItemDet.prototype.leavePage=function(url,needLogin,scene){var obj=this;obj.saveEvalListCache();if(!url)return;if(scene=='order'){popUp.showHidePopup($('#popupBuyArea'),false);try{var version=obj.isJdPgApp&&navigator.userAgent.toLowerCase().split(';')[2]||'';var canUsePgm=version.split('.')[0]>=2;if(canUsePgm){var isAndroid=JD.device.isAndroid;var des=isAndroid?'pgm':'pgmnew';url=isAndroid?url:encodeURI(url);location.href='openApp.jdpingou://virtual?params={"des":"'+des+'","url":"'+url+'"}';return;}}catch(e){}}
if(needLogin){loginHandler.loginLocation(url);}else{window.location.href=url;}};ItemDet.prototype.saveEvalListCache=function(){var obj=this;if(obj.cpart=='summary'){var item={'evalSkuCur':obj.comment&&obj.comment.evalSkuCur,'evalType':obj.comment&&obj.comment.evalType,'evalPageCur':obj.comment&&obj.comment.evalPageCur,'evalPage':obj.comment&&obj.comment.evalPage,'evalList':obj.comment&&obj.comment.jdSkuInfo.evalSave,'isNewGuess':obj.guessGary.isNewGuess,'mainViewScroll':obj.mainViewScroll,'viewScrollObj':obj.viewScrollObj};cache.setItem('evalInfo',JSON.stringify(item),600);}};ItemDet.prototype.getBigPromoteInfo=function(){var obj=this,item=obj.item()||{},spAttr=item.spAttr||{},category=item.category||[],cid1s='|'+category[0]+'|',cid2s='|'+category[1]+'|',cid3s='|'+category[2]+'|',brandId='|'+item.brandId+'|',venderId='|'+obj.venderId+'|',pTag='|'+item.pTag+'|',nowTime=(new Date()).getTime(),buyBtnClass='promoteBuyBtn',cartBtnClass='promoteCartBtn',promoteInfo,price=obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].price||{},hasPlusPrice=((price.pp>0&&price.p>price.pp)||(price.tpp>0&&price.p>price.tpp))&&!obj.isZxService&&!obj.isAd2;$('#imgLabel,#bigPromoteBanner').remove();$('.'+buyBtnClass).removeClass(buyBtnClass);$('.'+cartBtnClass).removeClass(cartBtnClass);if(!window._bigPromoteList||!window._bigPromoteList.length){return false;}
promoteInfo=window._bigPromoteList.filter(function(s){var source=s.source&&s.source.split(';')||[];if(s.remarks=='plus'){if(!hasPlusPrice)return false;}
return((~source.indexOf(obj.isJdPgApp?'6':'3'))&&(!s.pTag||~('|'+s.pTag+'|').indexOf(pTag))&&((!s.cid1s&&!s.cid2s&&!s.cid3s)||((s.cid1s&&~('|'+s.cid1s+'|').indexOf(cid1s))||(s.cid2s&&~('|'+s.cid2s+'|').indexOf(cid2s))||(s.cid3s&&~('|'+s.cid3s+'|').indexOf(cid3s))))&&(!s.specMark||!s.specMarkVal||~('|'+s.specMarkVal+'|').indexOf('|'+spAttr[s.specMark]+'|'))&&(!s.brandId||~('|'+s.brandId+'|').indexOf(brandId))&&(!s.venderId||~('|'+s.venderId+'|').indexOf(venderId))&&(!s.startTime||(new Date(s.startTime)).getTime()<nowTime)&&(!s.endTime||(new Date(s.endTime)).getTime()>nowTime));})[0];if(!promoteInfo)return false;if(promoteInfo&&((!obj.isJx&&(promoteInfo.cartBtnColor||promoteInfo.buyBtnColor))||(obj.isJx&&(promoteInfo.choiseCartBtnColor||promoteInfo.choiseBuyBtnColor)))){promoteInfo.buyBtnClass=buyBtnClass;promoteInfo.cartBtnClass=cartBtnClass;var $cssDom=$('#bigPromoteStyle');$cssDom.html('');var addStyle=function(className,color){if(!className||!color){return;}
var styleContent='';if(~color.indexOf(',')){var tempArr=color.split(','),tempColor='(to right,'+tempArr[0]+','+tempArr[1]+')';styleContent='.'+className+'{background:-webkit-linear-gradient'+tempColor+' !important;'+'background: linear-gradient'+tempColor+' !important;}';}else{styleContent='.'+className+'{background:'+color+' !important;}';}
$cssDom.html($cssDom.html()+styleContent);};if(obj.isJx){addStyle(promoteInfo.cartBtnClass,promoteInfo.choiseCartBtnColor);addStyle(promoteInfo.buyBtnClass,promoteInfo.choiseBuyBtnColor);}else{addStyle(promoteInfo.cartBtnClass,promoteInfo.cartBtnColor);addStyle(promoteInfo.buyBtnClass,promoteInfo.buyBtnColor);}}
return promoteInfo;};ItemDet.prototype.loadJdPayYouHui=function(callback){var obj=this,nowTime=new Date().getTime(),category=obj.jdCategory;if(obj.jdSkuInfo.pingouJdPay&&obj.jdSkuInfo.pingouJdPay.hold){obj.jdSkuInfo.pingouJdPayCBs&&obj.jdSkuInfo.pingouJdPayCBs.push(callback);return;}
obj.jdSkuInfo.pingouJdPayCBs=[callback];obj.jdSkuInfo.pingouJdPay={'hold':true};var ppmsJdPay=function(cb){var category1='|'+category[0]+'|',category2='|'+category[1]+'|',category3='|'+category[2]+'|';if(!window._jdpayInfo||window._jdpayInfo.length<1){cb&&cb(false);return;}
obj.queryIsNewUser(function(newUser){var isnewer=(newUser==2||!loginHandler.getLoginStatus());var payInfo=window._jdpayInfo.filter(function(s){var sourceArr=s.source.split(';');return((~sourceArr.indexOf('2'))&&(s.discountText||s.leftDownImg)&&((!s.cid1s&&!s.cid2s&&!s.cid3s)||((s.cid1s&&~('|'+s.cid1s+'|').indexOf(category1))||(s.cid2s&&~('|'+s.cid2s+'|').indexOf(category2))||(s.cid3s&&~('|'+s.cid3s+'|').indexOf(category3))))&&(s.startTime&&(new Date(s.startTime)).getTime()<nowTime)&&(s.endTime&&(new Date(s.endTime)).getTime()>nowTime)&&(!s.onlyNewer||s.onlyNewer=='0'||(s.onlyNewer=='1'&&isnewer==true)||(s.onlyNewer=='2'&&isnewer==false)));})[0];if(!payInfo){cb&&cb(false);return;}
if(payInfo.leftDownImg&&((payInfo.labelWhiteCid1s&&~('|'+payInfo.labelWhiteCid1s+'|').indexOf(category1))||(payInfo.labelWhiteCid2s&&~('|'+payInfo.labelWhiteCid2s+'|').indexOf(category2))||(payInfo.labelWhiteCid3s&&~('|'+payInfo.labelWhiteCid3s+'|').indexOf(category3)))){payInfo.leftDownImg='';}
cb&&cb(payInfo);});};var showJdPay=function(jdpayInfo){obj.jdSkuInfo['jdpayInfo_'+obj.skuId]=jdpayInfo;obj.jdSkuInfo.pingouJdPayCBs&&obj.jdSkuInfo.pingouJdPayCBs.forEach(function(CB){CB&&CB(jdpayInfo);});obj.jdSkuInfo.pingouJdPay={'hold':false};};if(obj.jdSkuInfo['jdpayInfo_'+obj.skuId]){showJdPay(obj.jdSkuInfo['jdpayInfo_'+obj.skuId]);}else{ppmsJdPay(function(info2){showJdPay(info2);});}};ItemDet.prototype.setIconTitle=function(opt){var obj=this;var skuName=opt.skuName||'',stock=opt.stock||{},promoteIco='',choicePromoteIco='';if(urlParam.getUrlParam('extlogo')=='gh'){promoteIco='<span class="tag"></span>';}
if(obj.bigPromoteInfo){if(obj.bigPromoteInfo.beforeTitleTag){promoteIco+='<i class="mod_tag mod_tag_big"><img src="'+obj.bigPromoteInfo.beforeTitleTag+'" /></i>';choicePromoteIco+='<i class="mod_tag mod_tag_big"><img src="'+obj.bigPromoteInfo.beforeTitleTag+'" /></i>';}}
if(obj.isJDChoice){if(obj.isZiying){$('#jdChosenIcon').show();}else{choicePromoteIco+='<div class="mod_sign_tip type_jingxuan"></div>';}}
if(window._itemTitleTag&&window._itemTitleTag.length){var tempArr=[],tagNo1='',tagNo2='',aboveTitle='',beforeStock='',item=obj.item()||{},spAttr=item.spAttr||{},brandId='|'+item.brandId+'|',venderId='|'+obj.venderId+'|',category=obj.jdCategory,cid1s='|'+category[0]+'|',cid2s='|'+category[1]+'|',cid3s='|'+category[2]+'|',ziying=(obj.isZiying||obj.isFCS||obj.isSCF),venderType=(stock&&stock.D&&stock.D.type),isJDexpress=(stock&&stock.isJDexpress);tempArr=window._itemTitleTag.filter(function(s){return s&&((s.ziyingIcon&&ziying&&!(spAttr.factoryShip==1&&spAttr.isnoZY==1))||(s.popIcon&&!ziying));});var filterCommon=function(arr,position){position=position||1;var res=arr.filter(function(s){if(!s)return false;var remarks=s.remarks&&s.remarks.split('-')||[];if(~remarks.indexOf('jingdongwuliu')){if(!obj.isSam&&!obj.isWoma&&s.position==position&&((venderType==0&&isJDexpress==1)||venderType==1||(!obj.isZiying&&item.skuMark&&item.skuMark.isSopUseSelfStock==1))){return true;}
return false;}
if(~remarks.indexOf('yaopin')){if(~'|7373035|7159286|7373033|7373031|7159314|7159312|7159310|7373029|7159308|7159306|7373027|7159304|7373003|7159302|7159300|7159284|7159298|7373001|7373025|7159370|7159334|7159350|7373045|7159320|7373057|7373067|7373069|7159328|7159362|'.indexOf('|'+obj.skuId+'|')){return false;}}
if(~remarks.indexOf('ziying')){if(s.position==position&&s.ziyingIcon){return true;}
return false;}
if(~remarks.indexOf('mdfh')){if(s.position==position&&((item.skuMark&&item.skuMark.isSds==1)||spAttr.fdms==1)){return true;}}
if(!s.cid1s&&!s.cid2s&&!s.cid3s&&!s.specMark&&!s.brandId&&!s.venderId)return false;return s.position==position&&((!s.cid1s&&!s.cid2s&&!s.cid3s)||((s.cid1s&&~('|'+s.cid1s+'|').indexOf(cid1s))||(s.cid2s&&~('|'+s.cid2s+'|').indexOf(cid2s))||(s.cid3s&&~('|'+s.cid3s+'|').indexOf(cid3s))))&&(!s.specMark||!s.specMarkVal||~('|'+s.specMarkVal+'|').indexOf('|'+spAttr[s.specMark]+'|'))&&(!s.brandId||~('|'+s.brandId+'|').indexOf(brandId))&&(!s.venderId||~('|'+s.venderId+'|').indexOf(venderId));})[0];if(!res)return false;var icon=res[ziying?'ziyingIcon':'popIcon'];if(!icon)return false;return{icon:icon,desc:res.desc||''};};if(tempArr.length){tagNo1=filterCommon(tempArr,1);tagNo2=filterCommon(tempArr,2);aboveTitle=filterCommon(tempArr,3);beforeStock=filterCommon(tempArr,4);if(aboveTitle){$('#aboveTitleTag').show().find('.fn_text_wrap').html('<i class="mod_tag mod_tag_big"><img src="'+aboveTitle.icon+'"></i>'+(aboveTitle.desc||''));}
if(beforeStock){$('#beforeStockTag').show().html('<img src="'+beforeStock.icon+'">');}}}
if(tagNo1){choicePromoteIco+='<i class="mod_tag mod_tag_big"><img src="'+tagNo1.icon+'" /></i>';promoteIco+='<i class="mod_tag mod_tag_big"><img src="'+tagNo1.icon+'" /></i>';}
if(tagNo2){choicePromoteIco+='<i class="mod_tag mod_tag_big"><img src="'+tagNo2.icon+'" /></i>';promoteIco+='<i class="mod_tag mod_tag_big"><img src="'+tagNo2.icon+'" /></i>';}
if(obj.isJDChoice){$('#itemName').text(skuName).prepend(choicePromoteIco);}else{$('#itemName').text(skuName).prepend(promoteIco);}};ItemDet.prototype.setAdvertTip=function(advertTip){advertTip=advertTip||'';if(window._itemGlobal&&window._itemGlobal.adGray){advertTip=itemComm.adverTransfer(advertTip,false,'37287.6.1');advertTip=itemComm.adverChangeLinkShow(advertTip);}else{advertTip=advertTip.replace(/<a.*\/a>[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|,|\?|\.|!|:]*/ig,'');if(~advertTip.toLowerCase().indexOf('app')){advertTip='';}}
if(advertTip){advertTip+='<span class="desc_more" id="adverMore"></span>';var itemDesc=this.isJDChoice?$('#itemDescChoice'):$('#itemDesc');itemDesc.html(advertTip).show();if(itemDesc.height()>35){itemDesc.addClass('has_more more_off');var adverMore=$('#adverMore');adverMore.on('click',function(){if(itemDesc.hasClass('more_off')){itemDesc.removeClass('more_off').addClass('more_on');}else{itemDesc.removeClass('more_on').addClass('more_off');}});}}else{this.isJDChoice?$('#itemDescChoice').html('').hide():$('#itemDesc').html('').hide();}};ItemDet.prototype.loadActTitleDesc=function(){var info=this.item(),type=info.skuType,str='';var autherStr=function(astr){var auther=astr.replace(/]/g,']<a>').replace(/\[/g,'</a>,[').replace(//g,'</a>,<a>')+'</a>';if(auther.indexOf('[')!==0)auther='<a>'+auther;return auther.replace(/\[/g,'<span class="cup">[').replace(/\]/g,']</span>').replace(/,/g,'');};(info.Author&&type==2)&&(str+=autherStr(info.Author)+'<span class="cup"> ; </span>');(info.Editer&&type==2)&&(str+=autherStr(info.Editer)+'<span class="cup"> ; </span>');(info.Drawer&&type==2)&&(str+=autherStr(info.Drawer)+'<span class="cup"> ; </span>');(info.Photography&&type==2)&&(str+=autherStr(info.Photography)+'<span class="cup"> ; </span>');(info.Write&&type==2)&&(str+=autherStr(info.Write)+'<span class="cup"> ; </span>');if(info.Authors&&type==3){if(!info.Authorsstr){info.Authorsstr='';var tmp=[],aut=info.Authors;for(var i=0;i<aut.length;i++){var ta=[];for(var j=0;j<aut[i].author.length;j++){ta.push('<a>'+aut[i].author[j].author+'</a>');if(ta.length==3){ta[2]=ta[2]+'...';break;}}
tmp.push('<span class="cup">'+aut[i].title+'</span>'+ta.join(''));}
if(info.Publishing_Company){tmp.push('<br/><span class="cup"></span><a>'+info.Publishing_Company+'</a>');}
info.Authorsstr=tmp.join(' ');}
str+=info.Authorsstr;}
if(info.Transfer)str+=autherStr(info.Transfer.replace('',''))+'<span class="cup"> </span>';if(info.Publishers)str+='<br><a>'+info.Publishers+'</a>';str=str.replace(//g,'</a><a>').replace(/<\/a>/g,'</a>');if(str)$('#actTitleDesc').show().html(str);$('#actTitleDesc a').each(function(){this.href='//so.m.jd.com/ware/search.action?ptag=7001.1.54&keyword='+encodeURIComponent(this.innerHTML);});var spanTag=$('#actTitleDesc').find('span'),spanLen=spanTag.length;(spanLen>0)&&spanTag.eq(spanLen-1).text(spanTag.eq(spanLen-1).text().replace('; ',''));};ItemDet.prototype.addressInit=function(){var obj=this;address.init({isNeedFixed:true,isNeedCommon:loginHandler.getLoginStatus(),onClose:function(){window.scrollTo(0,obj.mainViewScroll);},onFinish:function(){obj.setAddrId();if(obj.cfeeType&&obj.cfeeType.ft!=100){var url=obj.locationUrl.replace(obj.baseSkuId,obj.skuId);if(url.indexOf('?')>0){url+='&t='+Math.random();}else{url+='?t='+Math.random();}
location.href=url;return;}
obj.skuJson={};obj.jdSkuInfo['promiseCgi'+obj.skuId]=0;obj.setItemInfo();}});};ItemDet.prototype.setAddrId=function(){var obj=this;var addrInfo=window._itemInfo&&window._itemInfo.addrInfo&&window._itemInfo.addrInfo||{};address.setAddrCookies({ids:addrInfo.fourLevelAddrId&&addrInfo.fourLevelAddrId.split('_')||'',names:addrInfo.fourLevelAddr&&addrInfo.fourLevelAddr.split('_')||'',id:addrInfo.usualAddrId||'',name:addrInfo.usualAddr||'',longitude:addrInfo.lng||'',latitude:addrInfo.lat||'',});var addr=address.getAddrInfo(true,function(flag){obj.jdAddrUpgrade=flag;if(flag){if(obj.stockState[obj.skuId]===3){obj.jdStatus=true;obj.getSkuStock({StockState:33});}}});this.addrId=addr.addrId;this.jdAddrId=addr.id.split('_');this.jdAddrName=addr.name.split('_');for(var i=0;i<4;i++){if(!this.jdAddrId[i])this.jdAddrId[i]=0;if(!this.jdAddrName[i])this.jdAddrName[i]='';}
this.jdDetailAddr=addr.addrName||'';$('#addrName').html(addr.addrName||this.jdAddrName.join(''));if(this.jdAddrId&&~' 32 52993 53283 '.indexOf(' '+this.jdAddrId[0]+' ')){this.isOverseaAddr=true;}else{this.isOverseaAddr=false;}};ItemDet.prototype.setFullAddr=function(){if(this.getAddrTime===undefined)this.getAddrTime=0;this.getAddrTime++;if(this.getAddrTime>4)return;var index=0,obj=this;for(var i=0;i<this.jdAddrId.length;i++){if(this.jdAddrId[i]*1<1)break;index=i;}
window.setAddrCB=function(arr){if(arr.length){obj.jdAddrId[index+1]=arr[0].id;obj.jdAddrName[index+1]=arr[0].name;cookie.set('jdAddrId',obj.jdAddrId.join('_'),999999);cookie.set('jdAddrName',obj.jdAddrName.join('_'),999999);obj.setFullAddr();}else{obj.jdStatus=true;obj.getSkuStock();}};ls.loadScript('//d.jd.com/area/get?fid='+this.jdAddrId[index]+'&callback=setAddrCB&t='+Math.random());};ItemDet.prototype.setServiceArea=function(){var obj=this,stock=(obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].stock)||{};var spAttr=obj.item().spAttr||{},html=[],htmlDetail=[],wuliyouIconCode=['service_qitiantuihuo','service_huiyuanzunxiang','service_noreturn','service_15daystuihuo','service_15dayshuiyuanzunxiang','service_30daystuihuo','service_30dayshuiyuanzunxiang','service_15dayjxzzunxiang','service_30dayjxzzunxiang'],popEaseBuyIconCode=(window._easeServiceIconCode&&window._easeServiceIconCode[0]&&window._easeServiceIconCode[0].popIconCode)||'',zyEaseBuyIconCode=(window._easeServiceIconCode&&window._easeServiceIconCode[0]&&window._easeServiceIconCode[0].zyIconCode)||'',tpl='<li class="detail_serve_item {#disabled#}" tag="{#titleTag#}" {#style#}>{#title#}</li>',detailTpl='<div class="section" tag="{#titleTag#}"><div class="detail_serve_main_tit {#disabled#}">{#title#}</div><p class="detail_serve_main_content">{#detail#}</p></div>',aDetailTpl='<a href={#href#} class="section" tag="{#titleTag#}"><div class="detail_serve_main_tit {#disabled#}">{#title#}</div><p class="detail_serve_main_content">{#detail#}</p></a>',sendDetail='',sendTip='',$stockTip=$('#postNotice small span'),$postTip=$('#postTip');if(obj.isOverseaPurchase==2){$('#easeBuyServiceArea').removeClass('ease_buy_service').addClass('ease_global_buy_service').append('<span class="three_dot"></span>').find('i').removeClass('icon_ease_buy').addClass('icon_global_ease_buy');}else{$('#easeBuyServiceArea').addClass('ease_buy_service').removeClass('ease_global_buy_service').find('i').addClass('icon_ease_buy').removeClass('icon_global_ease_buy');$('#easeBuyServiceArea .three_dot').remove();}
if(obj.is9669order){$('#serviceArea').hide();$('#serviceArea').next('.detail_gap').hide();return;}
if(stock.shortTitle&&stock.serviceInfo){if(obj.isPrescribeDrug){sendDetail='';sendTip='';}else{sendTip=stock.shortTitle;sendDetail=stock.serviceInfo;}
if(stock.dcName){if(stock.crossRegionCharge){$stockTip.html(',');}else{$stockTip.html(',');}}}else{if(stock.serviceInfo)sendDetail=stock.serviceInfo.replace(/<.*?>/ig,'');var stockTip='';if(/(,|)(,||.)/.test(sendDetail)){stockTip=',';sendDetail=sendDetail.replace(/(,|)(,||.)/,'');}else if(/(,|)(,||.)/.test(sendDetail)){stockTip=',';sendDetail=sendDetail.replace(/(,|)(,||.)/,'');}else if(~sendDetail.indexOf('')){stockTip='';}
if(stockTip){$stockTip.html(stockTip);}
var sendArr=sendDetail.split(/,|/),send0=$.trim(sendArr[0]||'').replace(/\s+/g,''),send1=$.trim(sendArr[1]||'');if(obj.venderId)obj.venderName=(stock.self_D||stock.D||{vender:''})['vender'];if(obj.isPrescribeDrug){sendDetail='';sendTip='';}else if(spAttr.factoryShip=='1'){if(stock.isJDexpress==1){sendDetail='';sendTip='';}else{sendDetail='';sendTip='';}}else if(obj.isOTC>0||~send0.indexOf('')){sendDetail='  ';sendTip='&';}else if(obj.isOverseaPurchase=='3'){sendTip='&';sendDetail='';}else if(obj.isOverseaPurchase=='2'&&stock.isJDexpress==1){sendTip='&';sendDetail='';}else if(obj.isOverseaPurchase=='1'){sendTip='&';}else if(obj.isZiying||obj.isExpByjd||(~send0.indexOf('')&&send0.indexOf(obj.venderName)===-1)){if(!obj.venderId||/^(| )?/.test(send1))sendTip='&';if(~send1.indexOf(obj.venderName)){sendTip='&';}else if(~send1.indexOf('')){sendTip='&';}}else{if(~send0.indexOf(obj.venderName)){sendTip='&'+(~send1.indexOf('')?'':'')+'';}}}
if(obj.isSCF&&sendTip=='&'){sendTip='&';sendDetail='';}
if($postTip.html()==''&&stock&&stock.D&&stock.D.type==0&&stock.D.df&&stock.isJDexpress!=1){$postTip.html(' '+stock.D.df+' ');}
sendTip=sendTip||'&';if(spAttr.factoryShip=='1'&&~' 1000072514 1000013241 '.indexOf(' '+obj.venderId+' ')){}else if(sendDetail&&sendTip){html.push(itemComm.jsonToTpl({disabled:'',title:sendTip},tpl));htmlDetail.push(itemComm.jsonToTpl({disabled:'',title:sendTip,detail:sendDetail},detailTpl));}
if(stock.promiseYX&&stock.promiseYX.showName&&stock.promiseYX.iconTip&&stock.promiseYX.iconSrc){var disabled='',title=stock.promiseYX.showName;if(~stock.promiseYX.showName.indexOf('')){disabled='disabled';}
if(~wuliyouIconCode.indexOf(stock.promiseYX.iconCode)){title=stock.promiseYX.iconSrc;}
html.push(itemComm.jsonToTpl({disabled:disabled,title:title},tpl));htmlDetail.push(itemComm.jsonToTpl({disabled:disabled,title:title,detail:stock.promiseYX.iconTip},detailTpl));}
if(spAttr.HealthProducts=='1'){html.push(itemComm.jsonToTpl({disabled:'disabled',title:''},tpl));htmlDetail.push(itemComm.jsonToTpl({disabled:'disabled',title:'',detail:''},detailTpl));}
html.push(itemComm.jsonToTpl({disabled:'disabled',title:'',titleTag:'jqdqTitle',style:'style="display:none;"'},tpl));popUp.setPopupBody('jqdqService','<div style="display:none;" tag="jqdqDetail"></div>');htmlDetail.push(popUp.popupBody.jqdqService);if(obj.isOTC>0){html.push(itemComm.jsonToTpl({disabled:'',title:''},tpl));htmlDetail.push(itemComm.jsonToTpl({disabled:'',title:'',detail:''},detailTpl));}
var ir=stock.ir||[],irItem={},icoName={sendpay_211:'211',pop_PaymentCod:'',sendpay_411:'',appliances_PaymenCod:''},fxg3List=[];for(var i=0,len=ir.length;i<len;i++){irItem=ir[i];if(irItem.iconCode=='pop_PaymentCod')obj.isCashDelivery=true;irItem.title=icoName[irItem.iconCode]||irItem.showName;if(obj.isPrescribeDrug&&~irItem.title.indexOf(''))continue;if((irItem.iconCode=='service_shantui'||irItem.iconCode=='appliance_shangmenhx')&&stock.afsCode&&(stock.afsCode==1||stock.afsCode==2)){continue;}
irItem.disabled='';irItem.detail=irItem.iconTip;if(irItem.iconCode=='service_noreturn'){irItem.disabled='disabled';}
if(~wuliyouIconCode.indexOf(irItem.iconCode)){irItem.title=irItem.iconSrc;}
if(irItem.resultCode==1){if(spAttr.fxg=='1'&&~(' '+popEaseBuyIconCode+' ').indexOf(' '+irItem.iconCode+' ')){fxg3List.push(irItem);}else{var funStr='push';if(!obj.isXnzt&&(irItem.iconCode==='free_delivery'||irItem.iconCode==='free_delivery_zhong')){if(obj.isWoma){funStr='';}else{funStr='unshift';}}
if(funStr){html[funStr](itemComm.jsonToTpl(irItem,tpl));if(irItem.iconCode=='service_shangjiazx'){irItem.href='//baozhang.jd.com/baoxian/qrxDesc?isPhone=0&skuId='+obj.skuId;htmlDetail[funStr](itemComm.jsonToTpl(irItem,aDetailTpl));}else{htmlDetail[funStr](itemComm.jsonToTpl(irItem,detailTpl));}}}}}
$('#easeBuyServiceArea').hide().removeClass('show');if(fxg3List.length){var fxg3ShowName='',fxg3PopupBody='<ul>',maxLength=obj.pageWidth>374?4:3;for(var i=0,fxg3;i<fxg3List.length;i++){fxg3=fxg3List[i];if(i<maxLength){fxg3ShowName+='<span>'+(i==0?'':'  ')+fxg3.showName+'</span>';}
fxg3PopupBody+='<li><div class="title">'+fxg3.showName+'</div><div class="content">'+fxg3.iconTip+'</div></li>';}
fxg3PopupBody+='</ul>';$('#easeBuyServiceArea').show().addClass('show');$('#easeBuyServiceArea .ease_buy_tag').html(fxg3ShowName);popUp.setPopupBody('easeService',fxg3PopupBody);reporter.reportExposure({ptag:'7001.1.323'});}
var sr=stock.sr||[],isZyfxg=false,zyfxgList=[];for(var i=0,len=sr.length;i<len;i++){var item=sr[i];if(item.iconCode=='service_zyfangxingou'||item.iconCode=='appliances_zyfangxingou'){item.showIconResults&&item.showIconResults.forEach(function(v){if(~(' '+zyEaseBuyIconCode+' ').indexOf(' '+v.iconCode+' ')){zyfxgList.push(v);isZyfxg=true;}});}}
if(isZyfxg&&zyfxgList.length){var zyfxgShowName='',zyfxgPopupBody='<p style="padding: 12px 10px 0 10px;"></p><ul>';maxLength=obj.pageWidth>374?4:3;for(var i=0,zyfxg;i<zyfxgList.length;i++){zyfxg=zyfxgList[i];if(i<maxLength){zyfxgShowName+='<span>'+(i==0?'':'  ')+zyfxg.showName+'</span>';}
zyfxgPopupBody+='<li><div class="title">'+zyfxg.showName+'</div><div class="content">'+zyfxg.iconTip+'</div></li>';}
fxg3PopupBody+='</ul>';$('#easeBuyServiceArea').show().addClass('show');$('#easeBuyServiceArea .ease_buy_tag').html(zyfxgShowName);popUp.setPopupBody('easeService',zyfxgPopupBody);reporter.reportExposure({ptag:'7001.1.321'});}
if(obj.isZxService){var specialService=obj.decorate.specialService;for(var i=0,len=specialService.length;i<len;++i){html.push(itemComm.jsonToTpl({disabled:'',title:specialService[i]},tpl));htmlDetail.push(itemComm.jsonToTpl({disabled:'',title:specialService[i],detail:''+specialService[i]+''},detailTpl));}}
if(obj.soldOversea>0){var soldOverseaObj={'1':{'shortTitle':'','detail':''},'2':{'shortTitle':'','detail':''},'3':{'shortTitle':'','detail':''},'4':{'shortTitle':'','detail':''},'5':{'shortTitle':'','detail':''},'6':{'shortTitle':'','detail':''},'7':{'shortTitle':'','detail':''}};if(soldOverseaObj[obj.soldOversea]){html.push(itemComm.jsonToTpl({disabled:'',title:soldOverseaObj[obj.soldOversea].shortTitle},tpl));htmlDetail.push(itemComm.jsonToTpl({disabled:'',title:soldOverseaObj[obj.soldOversea].shortTitle,detail:soldOverseaObj[obj.soldOversea].detail},detailTpl));}}
var $serviceArea=$('#serviceArea'),$serviceAreaDiv=$('#serviceAreaDiv'),$detailServeTitle=$serviceArea.prev('div.detail_serve_title');if(html.length>0){$serviceArea.show().html(html.join(''));popUp.setPopupBody('service',htmlDetail.join(''));}else{$serviceArea.hide();}
if(obj.isJDChoice){if(html.length>0){if(obj.isZiying){$detailServeTitle.show();$serviceAreaDiv.show();}else{$detailServeTitle.hide();$serviceAreaDiv.show().css('paddingLeft','10px');}}else{$('#serviceArea').parent().hide();}}};ItemDet.prototype.guessGaryFun=function(){var obj=this,isDress=false,isNewGuess=false,oldPtag='',newPtag='',oldPtag2='',newPtag2='',dxSwitch=0;if(window.guessPPMS&&window.guessPPMS.length>0&&!obj.isSamGoods&&!obj.isSamGoods2&&!obj.isJdGame){window.guessPPMS=window.guessPPMS.filter(function(a){return a&&(a.category3||a.category1)&&a.ratio>0;});var pinArr=[],pin='1234567890',category3=[],category1=[],itemPPMS={},jdCategory1=obj.jdCategory[0],vk=cookie.get('visitkey'),jdCategory3=obj.jdCategory[2];for(var i=0,leni=window.guessPPMS.length;i<leni;i++){itemPPMS=window.guessPPMS[i];pinArr=(itemPPMS.whitePin||'').split('|');category3=(itemPPMS.category3||'').split('|');category1=(itemPPMS.category1||'').split('|');if(~category1.indexOf(jdCategory1)||~category3.indexOf(jdCategory3)){isDress=true;oldPtag=itemPPMS.oldPtag;oldPtag2=itemPPMS.oldPtag2;if(~pinArr.indexOf(pin)){isNewGuess=true;}else if((vk||'0').substr(-2)<itemPPMS.ratio*100){isNewGuess=true;}else{isNewGuess=false;}
if(isNewGuess){newPtag=itemPPMS.newPtag;newPtag2=itemPPMS.newPtag2;dxSwitch=parseInt(itemPPMS.dxSwitch||'3');}
break;}}}
return{isNewGuess:true,isShowTopTabs:true,isGuessBottom:false,isDress:isDress,oldPtag:oldPtag,newPtag:newPtag,oldPtag2:oldPtag2,newPtag2:newPtag2};};ItemDet.prototype.setGuessAreaHtml=function(opt){var html=opt.html;var tag=opt.tag;var $domBd=$('#'+tag+'Bd');var isHide=opt.isHide;var isInit=(opt.isInit==undefined?true:opt.isInit);var $domTag=$('#'+tag+'Tab');if(isHide){$domTag.hide();$domBd.attr('hasdata','0').hide();}else{if(!(html.length>0)){$domBd.attr('hasdata','0');return;}
$domBd.attr('hasdata','1');$domTag.show();}
var dataNum=($('#dapeiBd').attr('hasdata')||0)*1+($('#designBd').attr('hasdata')||0)*1+($('#accessoryBd').attr('hasdata')||0)*1+($('#guessBd').attr('hasdata')||0)*1+($('#rankBd').attr('hasdata')||0)*1+($('#secondhandBd').attr('hasdata')||0)*1;if(isHide&&!$domTag.hasClass('cur')){if(dataNum==1){$('#guessOnly').html('').show();$('#guessRecommend').hide();$('#guessBd').show();}
return;}
$('#dapeiBd,#designBd,#accessoryBd,#guessBd,#rankBd,#secondhandBd').hide();if(isHide){if(dataNum==0){$('#guessArea').hide();return;}else if(dataNum==1){$('#guessOnly').html('').show();$('#guessRecommend').hide();$('#guessBd').show();return;}}
if(dataNum>1){$('#guessOnly').hide();$('#guessRecommend').show();if(!this.tabIndx){try{this.tabIndx=JSON.parse(cache.getItem('guesstabindx')||'');}catch(e){}}
var cacheTag='';var tabIndx=this.tabIndx||'';if(tabIndx&&tabIndx.sku==this.baseSkuId&&tabIndx.tag){cacheTag=tabIndx.tag;tabIndx.scrollTop&&window.scrollTo(0,tabIndx.scrollTop);cache.removeItem('guesstabindx');}
var tagStore='guess';if($('#'+cacheTag+'Bd').attr('hasdata')==1){tagStore=cacheTag;}else if(isInit||(isHide&&$domTag.hasClass('cur'))){if(tag!='guess'){if($('#accessoryBd').attr('hasdata')==1&&!$('#guessTab').hasClass('cur'))tagStore='accessory';if($('#dapeiBd').attr('hasdata')==1&&!$('#guessTab').hasClass('cur'))tagStore='dapei';}}else{tagStore=$('#guessRecommend').find('.tab_item.cur').attr('tag');}
if($('#'+tagStore+'Bd').attr('hasdata')!=1){tagStore=tag;}
$('#'+tagStore+'Tab').addClass('cur').siblings().removeClass('cur');$('#'+tagStore+'Bd').show();}else{if(opt.recommendName)$('#guessOnly').html(opt.recommendName).show();$('#guessRecommend').hide();$domBd.show();$('#guessTab').addClass('cur');}
$('#gameArea').hide();$('#guessArea').show();this.setLoopDom(opt);};ItemDet.prototype.loadRecommendSuit=function(){var obj=this,category1=obj.jdCategory[0],isCloth=(~' 11729 1315 1318 1672 5025 6144 '.indexOf(' '+category1+' ')),isFurnishing=(~' 1620 6196 9847 9855 9570 '.indexOf(' '+category1+' '));if(obj.locJdGame.isGame||!(isCloth||isFurnishing))return;umpMonitor.createTimeout('20','item recommendSuitCB api timeout');window.recommendSuitCB=function(json){umpMonitor.delTimeout('itil20');if(!json||json.errCode!=0){JD.report.umpBiz({bizid:'25',operation:20,result:'2',source:'0',message:'item recommendSuitCB api fail'+obj.skuId});return;}
JD.report.umpBiz({bizid:'25',operation:20,result:'0',source:'0',message:'item recommendSuitCB api success'+obj.skuId});if(!json.recommend_dapei||!json.recommend_dapei.length||(isCloth&&!json.tag)){console.log('no dapei data, cat: '+obj.jdCategory.join(','));return;}
var recommendList=json.recommend_dapei,tagMap=isCloth?json.tag:{},dataItem={},dataTagItem={},tagStr=[],htmlStr=[],linkPre=(obj.isWX?'//wqs.jd.com/portal/wx/collocation_detail.shtml?':'//wqs.jd.com/portal/sq/collocation_detail.shtml?'),tpl='<li><a href="{#link#}"><div class="coll_cover"><img '+(obj.guessGary.isGuessBottom?'init_src':'back_src')+'="{#image#}"></div><div class="coll_info"><div class="icon_tag_blue">{#tagStr#}</div><p class="name">{#title#}</p><div class="price"><i class="icon_tag_red"><span class="tag"></span>{#numStr#}</i>{#priceStr#}</div><p class="discount">{#discountStr#}</p></div></a></li>',ptag='37287.4.1';if(isFurnishing){ptag='7001.1.82';tpl='<li><a href="{#link#}"><div class="cover"><img '+(obj.guessGary.isGuessBottom?'init_src':'back_src')+'="{#image#}">{#anchorStr#}</div><div class="info"><p class="name">{#title#}</p><p class="price"><span class="tag_coll"><b></b>{#numStr#}</span>{#priceStr#}<small class="orgin">{#discountStr#}</small></p></div></a></li>';}
recommendList=recommendList.filter(function(a){return a&&(a.price_disabled=='1'||a.price>0)&&((isFurnishing&&a.type=='4')||(isCloth&&a.type=='2'));});recommendList=recommendList.sort(function(a,b){return a.price_disabled-b.price_disabled;});for(var i=0,len=recommendList.length;i<len;i++){dataItem=recommendList[i];tagStr=[];dataItem.link=linkPre+'id='+dataItem.dapei_id+'&ptag='+ptag;dataItem.image=JD.img.getImgUrl('//img14.360buyimg.com/dapei/'+dataItem.mainlogo);if(isCloth){for(var j=0,lenJ=dataItem.taglist.length;j<lenJ;j++){dataTagItem=dataItem.taglist[j];if(dataTagItem.tagcategory!=1||!tagMap[dataTagItem.tagid])continue;tagStr.push(tagMap[dataTagItem.tagid].tagname);}
dataItem.tagStr=(tagStr.length>0?'<span>'+tagStr.join('</span><span>')+'</span>':'');dataItem.numStr=(dataItem.item_count>0?'<span class="num">'+dataItem.item_count+'</span>':'');}else if(isFurnishing){dataItem.anchorStr='';if(dataItem.anchor&&dataItem.anchor.length>0){for(var j=0,lenJ=dataItem.anchor.length;j<lenJ;j++){dataTagItem=dataItem.anchor[j];dataTagItem.className=(dataTagItem.angle>90?'tag_r':'tag_l');tagStr.push(itemComm.jsonToTpl(dataTagItem,'<span class="tag {#className#}" style="top:{#y#}%;left:{#x#}%;"><i></i>{#title#}</span>'));}
dataItem.anchorStr=tagStr.join('');}
dataItem.numStr=(dataItem.item_count>0?dataItem.item_count+'':'');}
if(dataItem.price_disabled=='1'){dataItem.priceStr='<span class="tip"></span>';dataItem.discountStr='';}else{dataItem.priceStr=obj.itemPrice.setSpecPrice({p:dataItem.price,flag:1});dataItem.discountStr=((dataItem.chnl_price-dataItem.price>0)?'&yen;'+(dataItem.chnl_price-dataItem.price).toFixed(2):'&nbsp;');}
htmlStr.push(itemComm.jsonToTpl(dataItem,tpl));}
if(isFurnishing)htmlStr=htmlStr.slice(0,5);$('#dapeiBd').html(itemComm.jsonToTpl({accessoryTab:'',tag:'dapei'},$('#guessTpl').html()));obj.setGuessAreaHtml({recommendName:'',html:htmlStr,tag:'dapei',loopScroll:true,divClassName:(isCloth?'wei_sub_colls':''),ulClassName:(isCloth?'coll_grid':'coll_furns'),num:(isCloth?2:1)});if(isCloth){window.wa&&window.wa('ptagExposure',{ptag:'7001.1.301'});$('#dapeiTab').attr('ptag','7001.1.302');}};ls.loadScript({url:'//wq.jd.com/bases/recommend/recommend?callback=recommendSuitCB&page=1&pagesize=10&scene=1&datatype=0&skuid='+obj.skuId+'&areaid='+obj.jdAddrId.slice(0,4).join(',')+'&t='+Math.random(),onError:function(){JD.report.umpBiz({bizid:'25',operation:20,result:'2',source:'0',message:'item recommendSuitCB api fail'+obj.skuId});}});};ItemDet.prototype.loadDesignerCollocation=function(){var obj=this,category1=obj.jdCategory[0],canShow=(~' 1620 9570 9855 1672 14343 9847 '.indexOf(' '+category1+' '));if(obj.locJdGame.isGame||!canShow)return;window.designerCollocationCB=function(json){if(!json||!json.model||!json.model.value||!json.model.value.collocations||!json.model.value.collocations.length)return;var recommendList=json.model.value.collocations,tpl='<li>'+'<a href="//sheji.m.jd.com/#/collodtl?ptag=7001.1.284&articleId={#id#}">'+'<div class="cover">'+'<img src="{#imgPath#}">'+'</div>'+'<div class="info_v2" {#style#}>'+'<p class="name">{#title#}</p>'+'<p class="view"><i></i> {#browsecount#}</p>'+'<p class="tag">{#tag#}</p>'+'</div>'+'</a>'+'</li>',dataItem,htmlStr=[],tagStr=[];recommendList=recommendList.filter(function(s){return s&&s.id&&s.title&&s.titlePicUrl;});if(!recommendList.length){window.wa&&wa('jdClick',{'ptag':'7001.1.286'});return;}else{window.wa&&wa('jdClick',{'ptag':'7001.1.285','num':recommendList.length});}
recommendList=recommendList.slice(0,5);for(var i=0,len=recommendList.length;i<len;i++){dataItem=recommendList[i];dataItem.browsecount=dataItem.browsecount||0;dataItem.title=dataItem.title.replace(/(|-|-||-)/g,'');dataItem.imgPath=JD.img.getImgUrl('//m.360buyimg.com/mobilecms/s700x500_'+dataItem.titlePicUrl);tagStr=[];(dataItem.articleAnchorVos2D||[]).forEach(function(item){tagStr.push(itemComm.jsonToTpl(item,'<span class="tag_item"><i></i>{#anchorName#}</span>'));});dataItem.tag=tagStr.join('');if(recommendList.length==1){dataItem.style='style="margin-bottom: 5px;"';}
htmlStr.push(itemComm.jsonToTpl(dataItem,tpl));}
$('#designBd').html(itemComm.jsonToTpl({accessoryTab:'',tag:'design'},$('#guessTpl').html()));obj.setGuessAreaHtml({recommendName:'',html:htmlStr,tag:'design',loopScroll:true,divClassName:'',ulClassName:'coll_furns',num:1});};ls.loadScript('//homeapi.jd.com/api/jz/getHardCoverList.do?callback=designerCollocationCB&sort=2&articletype=2&collocationSize=5&hardCoverSize=5&skuId='+obj.skuId);};ItemDet.prototype.loadRecommendSecondHand=function(isInit){var obj=this;var tag='secondhand';obj.setGuessAreaHtml({recommendName:'',tag:tag,isHide:true,isInit:isInit});var category=obj.jdCategory||[],cid1s='|'+category[0]+'|',cid2s='|'+category[1]+'|',cid3s='|'+category[2]+'|',venderId='|'+obj.venderId+'|';var config=obj.recommendTabsConfigs['tkes'];var canShow=!!(config&&((config.cid1s&&~('|'+config.cid1s+'|').indexOf(cid1s))||(config.cid2s&&~('|'+config.cid2s+'|').indexOf(cid2s))||(config.cid3s&&~('|'+config.cid3s+'|').indexOf(cid3s))||(config.venderId&&~('|'+config.venderId+'|').indexOf(venderId))));if(obj.locJdGame.isGame||!canShow)return;window.recommendSecondHandCB=function(json){obj.jdSkuInfo['recommendSecondHand'+obj.skuId+'_'+obj.jdAddrId.slice(0,4).join('-')]=json;if(!json||!json.result||!json.data||!json.data.listSkuRelation||!json.data.listSkuRelation.length)return;var secondHandList=(json.data.listSkuRelation.filter(function(s){return s&&s.skuId&&s.price>0&&s.productName&&s.mainImgPath;})||[]).slice(0,12);if(secondHandList.length<10)return;var tpl='<li>'+'<a href="{#link#}" class="row_item" onclick="return !window.holdAction;">'+'<div class="img_wrap"><img back_src="{#image#}"></div>'+'<div class="name">{#productName#}</div>'+'<div class="buy_wrap"><span class="price">{#priceShow#}</span></div>'+'</a>'+'</li>';var htmlStr=[];var dataItem;for(var i=0,len=secondHandList.length;i<len;i++){dataItem=secondHandList[i];dataItem.image=JD.img.getImgUrl(dataItem.mainImgPath,400,400);dataItem.link=window.getMItemLink(dataItem.skuId+'','7001.15.4');dataItem.priceShow=obj.itemPrice.setSpecPrice({p:numberp.round(numberp.divide([dataItem.price,100]),2),flag:1});htmlStr.push(itemComm.jsonToTpl(dataItem,tpl));}
$('#'+tag+'Bd').html(itemComm.jsonToTpl({accessoryTab:'',tag:tag},$('#guessTpl').html()));obj.setGuessAreaHtml({recommendName:'',html:htmlStr,tag:tag,isInit:isInit,loopScroll:true,divClassName:'slider_page',ulClassName:'row',num:6});reporter.reportExposure({ptag:'7001.15.3'});};if(obj.jdSkuInfo['recommendSecondHand'+obj.skuId+'_'+obj.jdAddrId.slice(0,4).join('-')]){window.recommendSecondHandCB(obj.jdSkuInfo['recommendSecondHand'+obj.skuId+'_'+obj.jdAddrId.slice(0,4).join('-')]);}else{ls.loadScript('//used-api.jd.com/productRelation/ware/recommend?callback=recommendSecondHandCB&source=WQ&count=12&skuId='+obj.skuId+'&area='+obj.jdAddrId.slice(0,4).join('-'));}};ItemDet.prototype.loadGuess=function(){var obj=this,tjw='902007',wqtjw='6159',expVal='1859',itemNum=30;if(obj.locJdGame.isGame||obj.isSpecKepler22)return;if(!this.timeout.reloadGuess&&!obj.guessGary.isNewGuess&&!obj.isJDChoice){this.timeout.reloadGuess=setTimeout(function(){if($('#guessBd').attr('hasdata')!=1)obj.loadGuess();},6000);}
var showNewGuess=false,newPtag='';if(window.guessGray&&window.guessGray.length>0){window.guessGray.forEach(function(item){if(showNewGuess)return false;if((item.cid1s||item.cid2s||item.cid3s)){if(((~item.cid1s.indexOf('|'+obj.jdCategory[0]+'|'))||(~item.cid2s.indexOf('|'+obj.jdCategory[1]+'|'))||(~item.cid3s.indexOf('|'+obj.jdCategory[2]+'|')))){showNewGuess=window.gray&&gray({'num':item.gray});newPtag=showNewGuess?item.newPtag:item.oldPtag;obj.showNewGuess=showNewGuess;}}});}
if(showNewGuess){itemNum=45;}else if(obj.guessGary.isGuessBottom){itemNum=31;}
var usePinlike=false;obj.pinlikeRecpos=usePinlike&&(obj.isSqEnv?'7425':'5719');if(usePinlike){obj.isPinlike=true;window.getPinlikeCB=function(json){if(!json&&!json.data&&json.data.length<1)return;var itemList=json&&json.data||[],tpl='<li>'+'<a href="javascript:void(0);" tourl="{#skuUrl#}" exposalurl="{#client_exposal_url#}" exposalflag="0" dataIndex="{#index#}" class="row_item {#adClass#} row_item_v2" source="{#source#}" repURL="{#clk#}" onclick="return !window.holdAction;">'+'<div class="img_wrap"><img back_src="{#skuImg#}"></div>'+'<div class="name">{#skuName#}</div>'+'<div class="buy_wrap">',tplPrice=showNewGuess?'<span class="price" id="guessPrice_{#skuId#}">&yen;{#skuIntPrice#}.{#skuFloatPrice#}</span>':'<span class="price" id="guessPrice_{#skuId#}">&yen;<span class="int">{#skuIntPrice#}</span>.{#skuFloatPrice#}</span>',tmpTpl='',html=[];obj.pinlikeList=itemList;itemList.forEach(function(item,index){var price=(item.ispg=='1'?item.pgprice:item.realprice)||0
var priceLength=price.length;var tmp={index:index,adClass:item.source=='1'?'ad_item':'',source:item.source,clk:item.click_url,skuUrl:obj.getPingouurl(item.url,'138264.1.2'),skuImg:JD.img.getImgUrl('//img14.360buyimg.com/mobilecms/s300x300_'+item.img),skuName:item.name,skuIntPrice:price.substring(0,priceLength-2),skuFloatPrice:price.substring(priceLength-2),skuId:item.sku,memcount:item.memcount,fxrightlabel:item.fxrightlabel||'',fxleftlabel:item.fxleftlabel||'',apiCategory:2,};if(tmp.fxrightlabel){tmpTpl=tpl+tplPrice+'<span class="cash_return"><em class="cash_return_icon">{#fxleftlabel#}</em><em class="cash_return_price">{#fxrightlabel#}</em></span></div></a></li>';}else{if(tmp.memcount>0){tmpTpl=tpl+'<span class="tip">{#memcount#}</span>'+tplPrice+'</div></a></li>';}else{tmpTpl=tpl+tplPrice+'</div></a></li>';}}
html.push(itemComm.jsonToTpl(tmp,tmpTpl));});$('#guessBd').html(itemComm.jsonToTpl({accessoryTab:'',tag:'guess'},$('#guessTpl').html()));obj.setGuessAreaHtml({recommendName:'',html:html,tag:'guess',loopScroll:true,divClassName:'slider_page'+(showNewGuess?' gird':''),ulClassName:'row',num:(showNewGuess?9:6)});reporter.reportExposure({ptag:'7001.12.18'});var clickEvent=function($em){var toLink=$em.attr('tourl'),repurl=$em.attr('repURL'),itemSource=$em.attr('source')||'0',dataIndex=$em.attr('dataIndex');var item=itemList[dataIndex];ReportManager.pinLikeClick&&ReportManager.pinLikeClick([{report_url:item.click_url,source:itemSource,sid:item.sid,reqsig:item.reqsig,ad_type:3,id:'',skuid:item.sku,page:(Math.floor(dataIndex/(obj.showNewGuess?9:6))+1),index:dataIndex%(obj.showNewGuess?9:6)+1,broker_info:item.broker_info,pps:item.pps,recpos:obj.pinlikeRecpos}]);toLink=JD.url.addUrlParam(toLink,{'pps':''});setTimeout(function(){location.href=toLink;},400);};$('#guessItem').on('click','a',function(){var $em=$(this);clickEvent($em);});};}else{window['cb'+tjw]=function(json){var data=json.data;if(!data||!data.length||$('#guessBd').attr('hasdata')==1)return;var tpl='<li><div jumpURL="{#link#}" repURL="{#clk#}" source="{#source#}" exposalurl="{#client_exposal_url#}" exposalflag="0" id="tjwguess_{#no#}" class="row_item guess_click {#adClass#}" onclick="return !window.holdAction;" eventparam="{#eventParam#}"><div class="img_wrap"><img '+(obj.guessGary.isGuessBottom?'init_src':'back_src')+'="{#image#}">{#banner#}</div><div class="name">{#name#}</div><div class="buy_wrap"><span class="tip">{#tuanNumTip#}</span><span class="price" id="guessPrice_{#sku#}">{#price#}</span></div></div></li>',flow=json.flow,html=[],dataItem={},priceSkus=[],linkPtag='7001.1.45',len=data.length,isNeedMore=false,impr=json.impr,expid=getVParam('expid',impr),reqsig=getVParam('reqsig',impr);if(urlParam.getUrlParam('t',impr)){var tjwTemp=urlParam.getUrlParam('t',impr).replace('rec.','');tjwTemp?tjw=tjwTemp:'';}
linkPtag=(newPtag?newPtag:(obj.guessGary.isDress?(obj.guessGary.isGuessBottom?obj.guessGary.newPtag:obj.guessGary.oldPtag):'37287.1.1'));if(obj.isJDChoice){tpl=['<div class="detail_recommend_good guess_click {#adClass#}" jumpURL="{#link#}" repURL="{#clk#}" source="{#source#}" exposalurl="{#client_exposal_url#}" exposalflag="0" eventparam="{#eventParam#}">','<div class="detail_recommend_good_img"><img '+(obj.guessGary.isGuessBottom?'init_src':'back_src')+'="{#image#}">{#banner#}</div>'+'<p class="detail_recommend_good_name">{#name#}</p>'+'<p class="detail_recommend_good_price" id="guessPrice_{#sku#}">&yen;{#price#}</p>'+'</div>'].join('');}
var expVal1=expid||expVal;for(var i=0;i<len;i++){dataItem=data[i];dataItem.link=obj.getNewSkuUrl(dataItem.sku,'',linkPtag)+'&exp='+expVal1+'&rec='+tjw;dataItem.image=JD.img.getImgUrl('//img14.360buyimg.com/mobilecms/s270x270_'+dataItem.img);dataItem.name=dataItem.t;dataItem.no=i;dataItem.clk=dataItem.clk?dataItem.clk:dataItem.clk_url;dataItem.link+='&flow='+flow+'&sid='+dataItem.sid+'&source='+dataItem.source;if(dataItem.source=='1'){dataItem.adClass='ad_item';}
if(dataItem.pps){dataItem.link+='&pps='+dataItem.pps;}
dataItem.eventParam='1_'+i+'_'+dataItem.sku+'_'+expid+'_'+flow+'_'+cookie.get('sid')+'_'+dataItem.source+'_'+'-100'+'_'+reqsig+'_-100';priceSkus.push(dataItem.sku);if(dataItem.reserve==='1'){if(!showNewGuess){dataItem.banner='<span class="banner"></span>';}}
var isPingou=dataItem.paicon==6;var jp=isPingou&&dataItem.dpicon&&dataItem.dpicon.p||dataItem.jp;if(dataItem.jpnonshow==='1'){dataItem.price=(obj.isJDChoice?'':'&yen;')+'<span class="tip"></span>';}else if(dataItem.jp>0){jp=(jp*1/100);dataItem.price=(obj.isJDChoice?(jp*1).toFixed(2):obj.itemPrice.setSpecPrice({p:jp,flag:obj.guessGary.isGuessBottom?2:1}));}else{dataItem.price='';}
if(isPingou&&dataItem.dpicon&&dataItem.dpicon.count){dataItem.tuanNumTip=dataItem.dpicon.count+'';}
html.push(itemComm.jsonToTpl(dataItem,tpl));}
if(isNeedMore&&!obj.guessGary.isGuessBottom&&!obj.isJDChoice){html.push('<li><a href="//wqs.jd.com/item/recommend_more.shtml?sku='+obj.skuId+'&ptag='+(newPtag?newPtag:'37287.1.1')+'&category='+obj.jdCategory.slice(0,3).join('_')+'&price='+obj.jdPrice+'&adids='+expVal+'" class="J_ping row_item more" report-eventid="MProductdetail_MoreYouLike" report-eventlevel="3"><div class="more_box"><i class="icon_more"></i><div class="desc"></div><div class="icon_go"></div></div></a></li>');}
if(window.wa&&(impr.indexOf('mercury')>-1||impr.indexOf('knicks')>-1)){wa('guessyouLike',{src:'rec',action:0,impr:impr,t:'rec.'+tjw});}
if(obj.isJDChoice){var htmlArr=[],tabArr=[],$guessChoice=$('#guessChoice');for(var i=0,leni=html.length;i<leni;i+=3){htmlArr.push('<li class="detail_recommend_slider_page"><div class="detail_recommend_goods">'+html.slice(i,i+3).join('')+'</div></li>');tabArr.push('<div class="detail_recommend_ctrl_item"></div>');}
if(htmlArr.length>0){var $domItem=$guessChoice.find('ul.detail_recommend_slider').html(htmlArr.join(''));var $tab=$guessChoice.find('div.detail_recommend_ctrl');if(tabArr.length>1){$tab.html(tabArr.join(''));}else{$tab.hide();}
obj.setLoopScroll({$dom:$domItem,$tab:$tab,loopScroll:tabArr.length>1,scrollCB:function(index){index=index||1;var $slider=$domItem.find('.slider_page');$slider.length&&$slider.removeClass('cur').eq(index-1).addClass('cur');obj.guessExposal();}});}else{$guessChoice.hide();}}else{$('#guessBd').html(itemComm.jsonToTpl({accessoryTab:'',tag:'guess'},$('#guessTpl').html()));obj.setGuessAreaHtml({recommendName:'',html:html,tag:'guess',loopScroll:true,divClassName:'slider_page'+(showNewGuess?' gird':''),ulClassName:'row',num:(showNewGuess?9:6)});if(obj.guessGary.isGuessBottom){if(isNeedMore){$('#guessBd').append('<div class="hot_more"><a href="//wqs.jd.com/item/recommend_more.shtml?sku='+obj.skuId+'&ptag='+(newPtag?newPtag:'37287.1.1')+'&category='+obj.jdCategory.slice(0,3).join('_')+'&price='+obj.jdPrice+'&adids='+expVal+'" class="hot_more_lnk"><i class="icon_arrow"></i></a></div><div class="detail_gap"></div>');}}}
$('#guessChoice,#guessItem,#newGuessList').on('click','div.guess_click',function(e){var $em=$(this),repurl=$em.attr('repURL'),toLink=$em.attr('jumpURL'),itemSource=$em.attr('source'),eventparam=$em.attr('eventparam'),scene=0;reporter.pingClick('MProductdetail_TestBRecProduct',eventparam,'4',obj.skuId);if($('#dapeiBd').attr('hasdata')==1)scene=1;if($('#accessoryBd').attr('hasdata')==1)scene=2;if(obj.guessGary.isDress)scene=4;if(obj.guessGary.isGuessBottom)scene=5;if(repurl){if(itemSource=='1'){JD.store.set('reportTJW',JSON.stringify({value:repurl}),null,'wqs.jd.com',true);}
var val=urlParam.getUrlParam('flow',toLink)+'_'+urlParam.getUrlParam('source',toLink)+'_'+urlParam.getUrlParam('sid',toLink);cookie.set('adinfo',val,30,'/',obj.domainStr);if(window.wa&&itemSource=='0'&&(impr.indexOf('mercury')>-1||impr.indexOf('knicks')>-1)){var indx=($em.attr('id')&&$em.attr('id').match(/\d+/)&&$em.attr('id').match(/\d+/)[0])||0;wa('guessyouLike',{src:'rec',action:1,index:indx,clk:repurl,t:'rec.'+tjw});}}
setTimeout(function(){location.href=toLink+'&scene='+scene;},200);});function getVParam(name,url){var u=arguments[1]||window.location.search,reg=new RegExp(name+"=([^\$|&]*)"),r=u.substr(u.indexOf("\?")+1).match(reg);return r!=null?r[1]:"";}};}
var url=function(){var c=obj.item().category;if(usePinlike){return['//wq.jd.com/mcoss/pinlike/show?offset=0','recpos='+obj.pinlikeRecpos,'count='+itemNum,'sku='+obj.skuId,'callback=getPinlikeCB','t='+Math.random()].join('&');}else{return['//wq.jd.com/mcoss/reclike/getrecinfo?recpos='+wqtjw,'pc='+itemNum,'sku='+obj.skuId,'c1='+c[0],'c2='+c[1],'c3='+c[2],'callback=cb'+tjw,'t='+Math.random()].join('&');}};ls.loadScript(url());JD.store.get("reportTJW",function(a,b){try{if(typeof b=='string'){b=JSON.parse(b);}
if(b&&b.value){(new Image).src=b.value.replace('http://','//');if(b.operation){JD.report.umpBiz({bizid:'739',operation:b.operation,result:'0',source:'0',message:'guess_click'});}
JD.store.set("reportTJW",'',function(key,value){},"wqs.jd.com",true);}}catch(e){}},"wqs.jd.com",true);if(window.sessionStorage&&sessionStorage.getItem('reportTJW')){try{var reportTJW=JSON.parse(sessionStorage.getItem('reportTJW')).value;if(reportTJW)(new Image).src=reportTJW.replace('http://','//');if(operation){JD.report.umpBiz({bizid:'739',operation:operation,result:'0',source:'0',message:'guess_click'});}
sessionStorage.removeItem('reportTJW');}catch(e){}}};ItemDet.prototype.guessExposal=function(){var obj=this;if(!obj.isPinlike&&obj.guessExposalHold){return;}
obj.guessExposalHold=true;setTimeout(function(){obj.guessExposalHold=false;},200);var scrollTop=$(window).scrollTop(),windowHeight=$(window).height()-($('#btnTools:visible').height()||0);var $adItems=obj.isPinlike?$('#guessWrap .row_item,#recommendList .recommend_item'):$('#guessWrap .ad_item,#recommendList .ad_item');var repeatReport=!obj.isPinlike;if(obj.cpart=='main'){$adItems=obj.isPinlike?$('#guessWrap:visible').find('.slider_page.cur .row_item'):$('#guessWrap:visible').find('.slider_page.cur .ad_item');repeatReport&&$('#guessWrap .slider_page').not('.cur').find('.ad_item').attr('exposalflag','0');repeatReport&&$('#recommendList .ad_item').attr('exposalflag','0');}else if(obj.cpart=='recommend'){$adItems=obj.isPinlike?$('#recommendList .recommend_item'):$('#recommendList .ad_item');repeatReport&&$('#guessWrap .ad_item').attr('exposalflag','0');}else{repeatReport&&$adItems.attr('exposalflag','0');return;}
if(!$adItems.length)return;var exposalUrlArr=[];$adItems.each(function(){var $el=$(this),elHeight=$el.height(),source=$el.attr('source'),exposalUrl=$el.attr('exposalurl').replace('http://','//'),exposalflag=$el.attr('exposalflag');if(!obj.isPinlike&&!(source==1&&exposalUrl))return;var dirtaY=$el.offset().top-scrollTop-($('#detailAnchor:visible').height()||0);if(dirtaY>-elHeight/2&&dirtaY<windowHeight-elHeight/2){if(exposalflag!=1){$el.attr('exposalflag','1');if(!obj.isPinlike){var shortid=(exposalUrl.match(/^(https*:){0,1}\/\/sh\.jd\.com\/(g|j)\/([\/\w \.-]{1,})/)||[])[3];if(shortid){exposalUrlArr.push(shortid);}else{new Image().src=exposalUrl;}}else{var dataIndex=$el.attr('dataIndex');var item=obj.pinlikeList[dataIndex];ReportManager.pinLikeExposure&&ReportManager.pinLikeExposure([{report_url:item.expose_url,source:item.source,sid:item.sid,reqsig:item.reqsig,ad_type:3,id:'',skuid:item.sku,page:(Math.floor(dataIndex/(obj.showNewGuess?9:6))+1),index:dataIndex%(obj.showNewGuess?9:6)+1,broker_info:item.broker_info,pps:item.pps,ptag:'7418.16.37',recpos:obj.pinlikeRecpos}]);}}}else{if(repeatReport)$el.attr('exposalflag','0');}});if(exposalUrlArr.length){new Image().src='//sh.jd.com/b/'+exposalUrlArr.join(',');}};ItemDet.prototype.queryIsNewUser=function(cb){var obj=this;if(obj.jdSkuInfo.newer&&obj.jdSkuInfo.newer.overTime&&!loginHandler.getLoginStatus()){cb&&cb(0);return;}
if(obj.jdSkuInfo.newer&&obj.jdSkuInfo.newer.hold){window.setTimeout(function(){obj.queryIsNewUser(cb);},100);return;}
(function(cb){window.newerGiftCB=function(json){if(obj.jdSkuInfo.newer&&obj.jdSkuInfo.newer.overTime){return;}
obj.jdSkuInfo.newer=json;if(json.retcode=='0'&&json.isNewUser){cb&&cb(json.isNewUser);}else{cb&&cb(0);}};if(obj.jdSkuInfo.newer){window.newerGiftCB(obj.jdSkuInfo.newer);}else{ls.loadScript('//wq.jd.com/userattribute/QueryIsNewUser?callback=newerGiftCB&sceneid=2&t='+Math.random());obj.jdSkuInfo.newer={'hold':true};window.setTimeout(function(){if(!obj.jdSkuInfo.newer||obj.jdSkuInfo.newer.hold){cb&&cb(0);obj.jdSkuInfo.newer={'overTime':true};}},3000);}})(cb);};ItemDet.prototype.getBaiTiao=function(){var obj=this;if(obj.isNewJdGame||obj.isfqy||(!(obj.jdPrice>0))||(obj.soldOversea>0&&obj.isOverseaAddr)||window.isSpecWxapp)return;if($('#baitiaoDiv').attr('sku')==obj.skuId){$('#baitiaoDiv').show();$('#discountGap').show();return;}
var $baitiaoDiv=$('#baitiaoDiv');window.baitiaoCB=function(json){if(!obj.jdSkuInfo['baitiao'+obj.skuId]){JD.report.umpBiz({bizid:'25',operation:'9',result:'16',source:'0',message:'baitiao back'});obj.jdSkuInfo['baitiao'+obj.skuId]=json;}
var data=json.data,flag=0;if(json.errcode==='0'&&data&&data.isAva&&data.marketingText&&data.planInfos&&data.planInfos.length){var serviceHtml=[],jsonItem={},jsonStr='',tpl='<div class="section"><dl><dt>{#title#}<span class="tips">{#tip#}</span></dt>{#str#}</dl></div>';for(var i=0,len=data.planInfos.length;i<len;i++){jsonItem=data.planInfos[i];jsonItem.text=jsonItem.text||'';jsonStr='<dd>'+(jsonItem.plan===1&&!(jsonItem.rate>0)?'<span class="detail">':jsonItem.plan+' x '+jsonItem.curTotal.toFixed(2)+''+jsonItem.text+'<span class="detail">'+(jsonItem.rate>0?''+jsonItem.planFee.toFixed(2)+''+jsonItem.text+''+jsonItem.rate+'%'+jsonItem.text:''))+'</span></dd>';serviceHtml.push(jsonStr);}
if(serviceHtml.length>0){popUp.setPopupBody('baitiao',itemComm.jsonToTpl({title:'',tip:'',str:serviceHtml.join('')},tpl));$baitiaoDiv.attr('sku',obj.skuId).removeClass('spec_no_point').html('<span class="title"></span><div class="desc_list"><div id="baitiaoItem" class="desc_item point_right">'+data.marketingText+'</div></div>').show();$('#discountGap').show();$('#promoteChoice').next('div.detail_gap').show();reporter.reports({ptag:'7001.1.72',pin:encodeURIComponent(cookie.get('jdpin'))});flag=1;}}
obj.loadJdPayYouHui(function(jdpayInfo){if(!jdpayInfo||!jdpayInfo.discountText)return;var $baitiaoDiv=$('#baitiaoDiv'),category=obj.jdCategory,text=jdpayInfo.discountText,link=jdpayInfo.jumpLink?itemComm.jsonToTpl({'skuId':obj.skuId,'cid1':category[0],'cid2':category[1],'cid3':category[2]},jdpayInfo.jumpLink):'';var itemHtml='<div class="desc_item '+(link?'arrow_right':'')+'">'+text+'</div>';if(link){itemHtml='<div class="desc_item arrow_right" toul="'+link+'">'+text+'</div>';$baitiaoDiv.on('click','.desc_item.arrow_right',function(){var tar=$(this);var toul=tar.attr('toul');if(toul){location.href=toul;}});}else{itemHtml='<div class="desc_item">'+text+'</div>';}
if(flag==1){$baitiaoDiv.find('.desc_list').append(itemHtml);$baitiaoDiv.find('.title').html('');}else{$baitiaoDiv.addClass('spec_no_point').html('<span class="title"></span><div class="desc_list">'+itemHtml+'</div>').show();$('#discountGap').show();}
reporter.reportExposure({ptag:'7001.1.261'});});};if(obj.jdSkuInfo['baitiao'+obj.skuId]){window.baitiaoCB(obj.jdSkuInfo['baitiao'+obj.skuId]);}else{ls.loadScript(['//wq.jd.com/commodity/btinfo/get?callback=baitiaoCB&sceneval=2','num='+obj.buyNumController.buyNum,'skuid='+obj.skuId,'cat='+obj.jdCategory.slice(0,3).join(','),'ven='+obj.venderId,'price='+Math.ceil(obj.jdPrice*100),'suit='+(obj.item().spAttr&&obj.item().spAttr.isXnzt=='1'?'1':'0'),'jd='+(obj.isZiying?'1':'0'),'oversea='+(obj.isOverseaPurchase>0?'1':'0'),'t='+Math.random()].join('&'));JD.report.umpBiz({bizid:bizid,operation:'9',result:'15',source:'0',message:'m baitiao'});}};ItemDet.prototype.renderAccessory=function(json){if($('#accessoryBd').attr('hasdata')==1||!json.data||!json.data.list||!json.data.list.length)return;var obj=this,list=json.data.list,iitem={},jitem={},skuArr=[],nameArr=[],ihtmlArr=[],jhtmlArr=[],jhtmlstr='',tplName='<li class="fitting {#cur#}" typeid="{#typeId#}" id="accessory_{#typeId#}" ptag="'+(obj.guessGary.isGuessBottom?'7001.1.153':'7001.1.18')+'">{#typeName#}</li>',tpl='<li class="grid_item"><a href="{#url#}" onclick="return !window.holdAction;"><div class="img_wrap"><img '+(obj.guessGary.isGuessBottom?'init_src':'back_src')+'="{#image#}"></div></a><h1 class="name">{#wName#}</h1><div class="buy_wrap"><span class="price" id="price_{#wid#}"></span><span class="buy" sku="{#wid#}" ppptag="'+(obj.guessGary.isGuessBottom?'7001.1.154':'7001.1.19')+'" id="accessoryCart_{#no#}"></span></div></li>';nameArr.push(itemComm.jsonToTpl({cur:'cur',typeId:'all',typeName:''},tplName));if(!this.jdSkuInfo.accessory)this.jdSkuInfo.accessory={};for(var i=0,leni=list.length;i<leni;i++){jhtmlArr=[];iitem=list[i];iitem.cur='';iitem.accessoryShows=iitem.accessoryShows||[];if(!iitem.accessoryShows.length)continue;nameArr.push(itemComm.jsonToTpl(iitem,tplName));for(var j=0,lenj=iitem.accessoryShows.length;j<lenj;j++){jitem=iitem.accessoryShows[j];jitem.image=JD.img.getImgUrl('//img13.360buyimg.com/n6/'+jitem.imageUrl);jitem.url=obj.getNewSkuUrl(jitem.wid,'',(obj.guessGary.isGuessBottom?'37287.4.10':'37287.4.2'));jitem.no=i+''+j;jhtmlstr=itemComm.jsonToTpl(jitem,tpl);if(j<2)ihtmlArr.push(jhtmlstr);jhtmlArr.push(jhtmlstr);skuArr.push(jitem.wid);}
this.jdSkuInfo.accessory[iitem.typeId]=jhtmlArr;}
ihtmlArr=ihtmlArr.slice(0,24);if(ihtmlArr.length>0){this.jdSkuInfo.accessory.typeId='all';this.jdSkuInfo.accessory.all=ihtmlArr;$('#accessoryBd').html(itemComm.jsonToTpl({accessoryTab:'<ul class="fitting_tabs">'+nameArr.join('')+'</ul>',tag:'accessory'},$('#guessTpl').html()));this.setGuessAreaHtml({recommendName:'',html:ihtmlArr,tag:'accessory',loopScroll:true,divClassName:'slider_page cols_3',ulClassName:'grid',num:6});$('#accessoryBd').append('<div class="hot_more" style="'+(obj.accessoryNeedMore?'':'display:none;')+'"><a href="//3c-peijian.jd.com/index?banner=null&ABTestFlag=0&eventId=6&sku='+obj.skuId+'&cid='+obj.jdCategory[2]+'" class="hot_more_lnk"><i class="icon_arrow"></i></a></div><div class="detail_gap"></div>');skuImgPrice.getPriceBySkus({skus:skuArr.join(','),callback:function(json){obj.jdSkuInfo.accessory.price=json;obj.setAccessoryPrice();}});}};ItemDet.prototype.setAccessoryPrice=function(){if(this.jdSkuInfo.accessory&&this.jdSkuInfo.accessory.price){var json=this.jdSkuInfo.accessory.price,item={},priceStr='';for(var i=0,len=json.length;i<len;i++){item=json[i];priceStr='';if(item.price>0){priceStr=this.itemPrice.setSpecPrice({p:item.price,flag:1});}
$('#price_'+item.sku).html(priceStr);}}};ItemDet.prototype.getPostPrice=function(){if(this.is9669order){return;}
var obj=this,stock=obj.skuJson[obj.skuId].stock||{},category1=obj.jdCategory[0],postArea=$('#postArea'),postPrice=$('#postPrice'),weightArea=$('#weightArea'),weightVal=$('#weightVal');if(obj.isXnzt)return;if(obj.isSamGoods||obj.isSamGoods2){postPrice.html((stock&&stock.samProductFreight)||'1999');postArea.show();}else if(obj.isWoma){if(obj.womaPostStr){postPrice.html(obj.womaPostStr);postArea.show();}else{postArea.hide();}
if(category1!='6144'&&stock.weightValue&&stock.weightValue!=='0'){obj.weightValue=stock.weightValue;weightVal.text(stock.weightValue);weightArea.show();}else{weightArea.hide();}}else{if(obj.isZiying||(stock.weightValue&&stock.weightValue!=='0')){if(category1!='6144'&&stock.weightValue&&stock.weightValue!=='0'){obj.weightValue=stock.weightValue;weightVal.text(stock.weightValue);weightArea.show();}else{weightArea.hide();}}else{var dcashDesc=(stock.dcashDesc&&stock.dcashDesc.replace(/<a.*\/a>[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|,|\?|\.|!|:]*/ig,''));if(dcashDesc){postPrice.html(dcashDesc);postArea.show();}else{postArea.hide();}}}};ItemDet.prototype.getSkuStock=function(data){var obj=this;if(!obj.jdStatus)return;window.stockCallback=function(json){var stock=json.stock||json;obj.venderType=stock&&stock.D&&stock.D.type;obj.isFCS=(obj.venderType==100);if(obj.jdAddrUpgrade){stock.StockState=33;stock.rn='';obj.skuJson[obj.skuId].stock=stock;}
$('#postNotice').html('');var rn=stock.rn||'200',stockState=stock.StockState,stockName='';if(rn<6&&rn>0){JD.events.trigger('item.main.stockNumChange',rn*1);if(obj.buyNumController.minBuyNum&&obj.buyNumController.minBuyNum>rn*1){stockState=34;}}
if(stockState===33)stockName='';switch(stockState){case 33:case 39:case 40:obj.stockState[obj.skuId]=1;if((/||/).test($('#statusNote').text()))$('#statusNotice,#popupNotice').hide();if(obj.koStatus==3){$('#statusNotice,#popupNotice').hide();}
obj.setBtnStatus({buyBtnConfig:{showType:obj.oBtnStatus&&obj.oBtnStatus.buyBtnConfig&&obj.oBtnStatus.buyBtnConfig.showType,disable:false,txt:(obj.koStatus==3)?'':(obj.oBtnStatus&&obj.oBtnStatus.buyBtnConfig&&obj.oBtnStatus.buyBtnConfig.txt)},addBtnConfig:{showType:(obj.koStatus==3)?0:(obj.oBtnStatus&&obj.oBtnStatus.addBtnConfig&&obj.oBtnStatus.addBtnConfig.showType),disable:false},popupBuyAreaConfig:{btnShowType:2,disablePopupConfirm:false},showViewGuess:false,showArrivalNotice:false},true,true);break;case 36:stockName='';obj.stockState[obj.skuId]=2;obj.setBtnStatus({buyBtnConfig:{showType:obj.oBtnStatus&&obj.oBtnStatus.buyBtnConfig&&obj.oBtnStatus.buyBtnConfig.showType,disable:false},addBtnConfig:{showType:obj.oBtnStatus&&obj.oBtnStatus.buyBtnConfig&&obj.oBtnStatus.addBtnConfig.showType,disable:false},popupBuyAreaConfig:{btnShowType:2,disablePopupConfirm:false}},true,true);break;case 0:case 34:default:obj.stockState[obj.skuId]=3;stockName='';obj.setCheaperEvalVisible(3);if(!obj.noSale){if(obj.koStatus==2||obj.yushouStatus==4){window.wa&&window.wa('ptagExposure',{ptag:obj.isWX?'7489.1.1':'7489.2.1'});obj.setBtnStatus({msgConfig:{msg:'<br/>'},buyBtnConfig:{disable:true},addBtnConfig:{disable:true},popupBuyAreaConfig:{btnShowType:2,disablePopupConfirm:true},dontSetBtnStatusAnyMore:0},true,true);}else{obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{showType:!obj.isHideCheaper?-1:(obj.oBtnStatus&&obj.oBtnStatus.buyBtnConfig&&obj.oBtnStatus.buyBtnConfig.showType),disable:true},addBtnConfig:{showType:!obj.isHideCheaper?-1:(obj.oBtnStatus&&obj.oBtnStatus.addBtnConfig&&obj.oBtnStatus.addBtnConfig.showType),disable:true},popupBuyAreaConfig:{btnShowType:!obj.isHideCheaper?2:0,disablePopupConfirm:obj.isHideCheaper},showViewGuess:!obj.isHideCheaper,showArrivalNotice:!obj.isHideCheaper&&!obj.isfqy,dontSetBtnStatusAnyMore:0},true,true);}}
break;}
JD.events.trigger('item.main.stockStateChange',obj.stockState[obj.skuId]);itemSpec.setConservationArea(obj);var backStockCode=stock.StockState,frontStockCode=({33:1,39:2,36:3,34:4,40:8}[backStockCode]||-1),deliveryCode=({33:5,39:5,36:5,34:5,40:6}[backStockCode]||-1);reporter.setJdPvLogobj('sku',[obj.skuId,obj.jdPrice,frontStockCode,deliveryCode,backStockCode].join('|'));var dcashDesc=(stock.dcashDesc&&stock.dcashDesc.replace(/<a.*\/a>[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|,|\?|\.|!|:]*/ig,''));reporter.setJdPvLogobj('shipping',dcashDesc);itemSpec.landingMatch(obj);obj.isExpByjd=obj.isZiying||(stock.D&&stock.D.type==1)||(stock.isJDexpress==1);if(stock.code==3||stock.code==4){obj.setFullAddr();}
obj.getPromiseData({stockName:stockName,stockState:stockState});if(obj.isWoma){obj.womaPostStr=stock.walMarProductFreight||'';}
if(!obj.skuJson[obj.skuId].stock){obj.skuJson[obj.skuId].stock=stock;obj.setServiceArea();obj.getPostPrice();}
obj.handleCarInstallServiceBtn();};if(data){window.stockCallback(data);}
else{var pduid=cookie.get('__jda')||'';if(pduid)pduid=pduid.split('.')[1];ls.loadScript({url:['//cd.jd.com/stock?callback=stockCallback&buyNum=1&ch=2','skuId='+obj.skuId+(pduid?'&pduid='+pduid:''),'venderId='+obj.venderId,'cat='+obj.jdCategory.slice(0,3).join(','),'area='+obj.jdAddrId.slice(0,4).join('_'),'extraParam='+encodeURIComponent('{"originid":"3"}'),'t='+Math.random()].join('&'),charset:'GBK'});}};ItemDet.prototype.getPromiseData=function(opt){opt=opt||{};var obj=this,stock=obj.skuJson[obj.skuId].stock||{},pr=stock.promiseResult,spAttr=obj.item().spAttr||{},stockName=opt.stockName,stockState=opt.stockState,stockNamePV='';if(obj.jdAddrUpgrade){stockName='';stockState=33;pr='';}
if(stockName){if(stockName===''||obj.isPresale){stockNamePV='';}else if(pr){stockNamePV=(typeof pr=='object')?pr.promiseResult:pr;}else if(stock.wDispatch){stockNamePV=''+stock.wDispatch+'';var sidDely=stock.sidDely*1||0;if(sidDely>601&&sidDely<649){stockNamePV+='3-7';}else{switch(sidDely){case 671:case 667:stockNamePV+='2-7';break;case 668:stockNamePV+='3-12';break;default:stockNamePV+='5-20';break;}}}else if(obj.isOverseaPurchase=='2'||spAttr.isEbay=='1'||spAttr.isEbay=='2'){stockNamePV='35-20';}else if(obj.isOverseaPurchase=='1'||obj.isOverseaPurchase=='3'){stockNamePV='5-105-20';}else{var isBook=(obj.skuType==2||obj.skuType==3);switch(stockState){case 34:stockNamePV='';break;case 39:stockNamePV='2-6';break;case 40:if(!isBook)stockNamePV='2-6';break;case 36:if(stock.Drd){stockNamePV=''+stock.Drd;}else if(stock.ArrivalDate){stockNamePV=''+stock.ArrivalDate+'';}else if(!isBook){stockNamePV='';}
break;}}
if(obj.dreamBuy&&(obj.dreamBuy.status===0||obj.dreamBuy.status===1)&&stockState!=34){stockName='';stockNamePV=obj.dreamBuy.shipStr||'';}
if(obj.ysNoWayInfo&&obj.ysNoWayInfo.shipStr&&stockState!=34){stockNamePV=obj.ysNoWayInfo.shipStr||'';}
$('#postNotice').html(['<small><span>',stockName,'</span><b id="postTip">',stockNamePV,'</b></small>'].join(''));}};ItemDet.prototype.setLoopDom=function(opt){opt=opt||{};if(!opt.loopScroll)return;var obj=this,html=opt.html,tag=opt.tag,tab=[],$dom=$('#'+tag+'Item'),$tabDom=$('#'+tag+'ItemTab'),divClassName=opt.divClassName,num=opt.num,ulClassName=opt.ulClassName,html1=[].concat(html);$dom.html('').attr('style','');while(html1.length){var div='',ul=document.createElement('ul');ul.className=ulClassName;ul.innerHTML=html1.splice(0,num).join('');if(divClassName){div=document.createElement('div');div.className=divClassName;div.appendChild(ul);$dom.append(div);}else{$dom.append(ul);}
tab.push('<li></li>');}
if(tab.length>1){$tabDom.parent().show();$tabDom.html(tab.join(''));}else{$tabDom.html('');$tabDom.parent().hide();}
if(obj.guessGary.isGuessBottom){$dom.siblings('.bar_wrap').hide();lazyLoad.autoLoadImage();}else{(function($dom,$tabDom){obj.setLoopScroll({$dom:$dom,$tab:$tabDom,loopScroll:tab.length>1,scrollCB:function(index){index=index||1;var $slider=$dom.find('.slider_page');$slider.length&&$slider.removeClass('cur').eq(index-1).addClass('cur');obj.guessExposal();}});})($dom,$tabDom);}};ItemDet.prototype.setLoopScroll=function(opt){var showImg=function(dom){dom.find('img').each(function(){if($(this).attr('back_src')){this.src=$(this).attr('back_src');$(this).removeAttr('back_src');}});};var $dom=opt.$dom;$dom.attr('style','');if(opt.loopScroll){loopScroll.init({tp:'text',min:10,moveDom:$dom,moveChild:$dom.children(),tab:opt.$tab.children(),lockScrY:true,enableTransX:true,index:1,fun:function(index){showImg($(this.moveChild[index-1]));opt.scrollCB&&opt.scrollCB(index);}});}else{showImg($dom);}};ItemDet.prototype.addCart=function(param,addCb){var obj=this,isAccessory=(param&&param.isAccessory);obj.skuId=obj.changeSkuId;if(!isAccessory&&!this.jdStatus){if(!this.jdStatus&&!($('#addCart2').hasClass('btn_disable')))JD.report.umpBiz({bizid:bizid,operation:'8',result:'4',source:'0',message:'item addcart can not add'});return false;}
if(!isAccessory&&!this.jdSkuStatus){obj.skuSwitch.showSkuArea();JD.report.umpBiz({bizid:bizid,operation:'8',result:'2',source:'0',message:'item addcart sku not ready'});return false;}
var type=0,commlist=[this.skuId,this.itemId,this.buyNumController.buyNum,this.skuId,'1,0,0'],isRelated=false,skuIds=[],buyNum=0;type=(this.item().spAttr&&obj.isXnzt?'3':'0');if(param&&typeof(param)=='object'){if(param.type)type=param.type;if(param.commlist){commlist=param.commlist;buyNum=commlist[2];}
isRelated=param.isRelated;}else{param={type:type,commlist:commlist};}
if(!isAccessory&&this.promotion&&this.promotion.isGiftPool){skuIds=this.promotion.getGiftPoolList();if(skuIds.length>0)commlist.push(skuIds.join('_'));}
if(!isAccessory&&obj.yanbao&&obj.yanbao.ybInfo&&obj.yanbao.ybInfo.isGift){skuIds=obj.yanbao.getNewYanBaoList(1);if(skuIds.length>0){if(!this.promotion||!this.promotion.isGiftPool)commlist.push('');commlist.push(obj.yanbao.ybInfo.giftSku);}}
if(obj.locShopInfo['isLOC']){commlist[1]=obj.locShopInfo['shopId'];}
var paramStr=['//wq.jd.com/deal/'+(obj.isPrescribeDrug?'drugcart':'mshopcart')+'/addcmdy?callback=addCartCB&sceneval=2&reg=1'+(obj.isCrossDomain?'&vk='+(cookie.get('visitkey')||window._syncVk||''):''),'scene='+(obj.isPrescribeDrug?'99':'2'),'type='+type,'commlist='+commlist.join(','),'locationid='+[this.jdAddrId.slice(0,3).join('-')],'t='+Math.random()];if(!obj.isPrescribeDrug&&obj.svcid){paramStr.push('svcid='+obj.svcid);}
if(obj.scanOrig){paramStr.push('scan_orig='+obj.scanOrig);}
if(!isAccessory&&obj.yanbao&&obj.yanbao.ybInfo&&obj.yanbao.ybInfo.isYanBao){var pids=obj.yanbao.getNewYanBaoList();if(pids.length>0){paramStr.push('isnewyb=1&ybcommlist='+pids.join('$'));}}
umpMonitor.createTimeout('8','item addcart api timeout');umpMonitor.createTimeout('30','item addcart api timeout');if(!isAccessory&&obj.yanbao&&obj.yanbao.ybInfo&&obj.yanbao.ybInfo.isJdService){var pids=obj.yanbao.getNewYanBaoList(2);if(pids.length>0){paramStr.push('jdhscommlist='+pids.join('$'));}}
window.addCartCB=function(json){umpMonitor.delTimeout('itil8');umpMonitor.delTimeout('itil30');var errIdNum=parseInt(json.errId);if((errIdNum>=4096&&errIdNum<=4102)||(errIdNum>=8448&&errIdNum<=8585)){JD.report.umpBiz({bizid:bizid,operation:'30',result:'2',source:'0',message:'item'+obj.skuId+' addcart return system error code '+json.errId});}else{JD.report.umpBiz({bizid:bizid,operation:'30',result:'0',source:'0',message:'item addcart api loaded right'});}
if(json.errId=='13'){JD.report.umpBiz({bizid:bizid,operation:'15',result:'4',source:'0',message:'item addcart not login'+obj.skuId});if(obj.isLoginAct){obj.isLoginAct=false;JD.report.umpBiz({bizid:bizid,operation:'6',result:'0',source:'0',message:'item collection api loaded'});return;}
var cookieStr=(param&&typeof(param)=='object')?JSON.stringify(param):'ok';cookie.set('doAddCart',cookieStr,1);obj.leavePage(json.nextUrl+encodeURIComponent(obj.locationUrl.replace(obj.baseSkuId,obj.skuId)));}
else if(json.errId=='8968'){showNotice({str:'200',iconFlag:2});JD.report.umpBiz({bizid:bizid,operation:'8',result:'5',source:'0',message:'item addcart over 200'});}
else if(json.errId=='8969'){if(obj.isPrescribeDrug){showNotice({str:'',iconFlag:2});}else{popUp.createPopup({flag:4,msg:'<br/>',icon:'fail',okText:'',cancelText:'',onConfirm:function(){jdshopQuickClean.show();window.wa&&window.wa('jdClick',{ptag:'7001.1.304'});},onCancel:function(){window.wa&&window.wa('jdClick',{ptag:'7001.1.305'});}});window.wa&&window.wa('ptagExposure',{ptag:'7001.1.306'});}
JD.report.umpBiz({bizid:bizid,operation:'8',result:'5',source:'0',message:'item addcart over capacity'});}
else if(json.errId=='0'){JD.report.umpBiz({bizid:bizid,operation:'8',result:'0',source:'0',message:'item addcart api loaded'});if(isRelated){for(var i=1;i<commlist[0].split("_").length;i++){reporter.pingClick('MProductdetail_PackageAddToCartVirtual',commlist[0].split("_")[i],'',obj.skuId);}
if(obj.isPrescribeDrug){popUp.createPopup({flag:4,msg:"",icon:"success",okText:"",cancelText:"",onConfirm:function(){reporter.pingClick("MProductdetail_MedicineList","","3");window.location.href='//yao.jkcsjd.com/cart/index.html ';},onCancel:null});}else{popUp.createPopup({flag:4,msg:"",icon:"success",okText:"",cancelText:"",onConfirm:function(){window.location.href='//p.m.jd.com/cart/cart.action?sid='+cookie.get("sid")||'';},onCancel:null});}}else{showNotice({str:obj.isPrescribeDrug?'':'',iconFlag:1});}
var $popDom='';if(obj.isPrescribeDrug){itemSpec.setDrugNum(json.cart.mainSkuNum*1);$popDom=$('#poponeDrug');}else{$popDom=$('#popone');obj.setCartNum(json.cart.mainSkuNum*1);}
$popDom.html('+'+(buyNum||obj.buyNumController.buyNum)).addClass('show');setTimeout(function(){$popDom.removeClass('show');},2000);addCb&&addCb();}
else{showNotice({str:obj.isPrescribeDrug?'':'',iconFlag:2});JD.report.umpBiz({bizid:bizid,operation:'8',result:'6',source:'0',message:'item addcart fail'+obj.skuId+'_'+json.errId});}};ls.loadScript(paramStr.join('&'),{onError:function(){umpMonitor.delTimeout('itil8');umpMonitor.delTimeout('itil30');showNotice({str:obj.isPrescribeDrug?'':'',iconFlag:2});JD.report.umpBiz({bizid:bizid,operation:'30',result:'2',source:'0',message:'item'+obj.skuId+' addcart cgi error!'});JD.report.umpBiz({bizid:bizid,operation:'8',result:'6',source:'0',message:'item addcart error'+obj.skuId+'_cgiError'});}});};ItemDet.prototype.setCartNum=function(num){var n=cookie.get('cartNum')*1||0;if(num){n=num;cookie.set('cartNum',n,999999,"/",this.domainStr);}
if(n&&!this.isEcard){$('#cartNum').html(n>99?'99+':n).show();reporter.reportExposure({ptag:'138442.1.1'});}else{$('#cartNum').hide();reporter.reportExposure({ptag:'138442.1.2'});}};ItemDet.prototype.getBuyLink=function(){var obj=this;obj.skuId=obj.changeSkuId;if(!obj.jdStatus){if($('#buyBtn2').hasClass('btn_disable')){JD.report.umpBiz({bizid:bizid,operation:'15',result:'2',source:'0',message:'item buy other'+obj.skuId});}else{JD.report.umpBiz({bizid:bizid,operation:'27',result:'1',source:'0',message:'item buy can not buy'+obj.skuId});}
return false;}
if(!obj.jdSkuStatus){obj.skuSwitch.showSkuArea();JD.report.umpBiz({bizid:bizid,operation:'27',result:'2',source:'0',message:'item buy sku not ready'});return false;}
if(obj.skuJson[obj.skuId]&&obj.skuJson[obj.skuId].feetype&&!obj.cfeeType){obj.skuSwitch.showSkuArea('');JD.report.umpBiz({bizid:bizid,operation:'27',result:'3',source:'0',message:'item buy sku not ready'});return false;}
var weixinadkey='';if(cookie.get('weixinadkey')){weixinadkey='&weixinadkey='+cookie.get('weixinadkey');}
if(window.morderCookie&&window.morderCookie.zzz)cookie.set('_modc',window.morderCookie.zzz,180,"/",obj.domainStr);var category3=(obj.jdCategory&&obj.jdCategory[2])||'',skuName=obj.item().skuName||'';if(obj.isDidiCard){return'//xmlya.m.jd.com/?skuId='+obj.skuId;}
if(obj.isSxdzq){return'//m-xnzy.jd.com/#/order/settlement/'+obj.skuId;}
if(obj.isXnkq||obj.isCzGoods){return'//gamerecg.m.jd.com/?skuId='+obj.skuId+'&chargeType='+category3+'&skuName='+skuName+'&skuPrice='+obj.jdPrice;}
if(obj.jdfwj=='2'){return'//m-weixiu.jd.com/settle?sku='+obj.skuId;}
if(obj.zyTravel){return'//c-tripziying.jd.com/submitOrder/mobile?source=m&pid='+obj.skuId+'&pcount='+obj.buyNumController.buyNum;}
if(obj.isOilCard){return'//oilcard.m.jd.com/?skuId='+obj.skuId+'&skuName='+skuName+'&skuPrice='+obj.jdPrice+'&chargeType='+category3;}
if(obj.is9669order){return'//baozhang.jd.com/phone/orderSettlement?cartId='+obj.skuId+'&num='+obj.buyNumController.buyNum+'&source=wx';}
if(obj.yushouStatus==2&&!obj.sellWhilePresellBuy){return'//wqs.jd.com/item/yuyue_item.shtml?sceneval=2&sku='+obj.skuId;}
if(obj.isDzItem){return'//mdz.jd.com/customMade/toCustomize.action?sku='+obj.skuId+'&num='+obj.buyNumController.buyNum;}
if(obj.isHYKHSP||(obj.cfeeType&&obj.cfeeType.ft!=100)){var feetypeUrl=['//m-eve.jd.com/business?sku='+(obj.isHYKHSP?obj.skuId:obj.cfeeType.sku),'btype='+(obj.isHYKHSP?'0':obj.cfeeType.ft),'provinceId='+obj.jdAddrId[0],'provinceName='+encodeURIComponent(obj.jdAddrName[0]),'cityId='+obj.jdAddrId[1],'cityName='+encodeURIComponent(obj.jdAddrName[1])].join('&');return feetypeUrl;}
if(obj.koStatus==1||obj.koStatus==2){if(obj.miaoErr.errId=='16385'){popUp.createPopup({flag:3,msg:obj.miaoErr.errMsg,onConfirm:function(){location.reload();},onClose:function(){location.reload();}});JD.report.umpBiz({bizid:bizid,operation:'27',result:'4',source:'0',message:'item buy can not buy'});return false;}
var venderType=obj.isZiying?'-1':obj.venderType,riskCheck=obj.skuJson[obj.skuId].yuyue&&obj.skuJson[obj.skuId].yuyue.riskCheck;if(obj.isVoiceCheck){var handleVoiceCheckErr=function(){popUp.createPopup({flag:3,msg:'',okText:'',onConfirm:function(){location.reload();}});};window.voiceCheckCB=function(json){if(json&&json.errcode==0&&json.vsurl){obj.leavePage(json.vsurl);}else{handleVoiceCheckErr();}};ls.loadScript(['//wqmitem.jd.com/mitem/vsurl?callback=voiceCheckCB','sku='+obj.skuId,'weight='+(obj.weightValue||''),'rcheck='+(riskCheck=='1'?'1':''),'venderType='+((venderType||venderType===0)?venderType:''),'scan_orig='+(obj.scanOrig||'')].join('&'),{onError:function(){handleVoiceCheckErr();}});return false;}
return'//wqs.jd.com/order/s_confirm_miao.shtml?sceneval=2&bid='+(obj.bid||'')
+'&scene=jd&isCanEdit=1&EncryptInfo=&Token=&commlist=,,1,'+obj.skuId
+'&weight='+(obj.weightValue||'')+weixinadkey
+(obj.scanOrig?'&scan_orig='+obj.scanOrig:'')
+((venderType||venderType===0)?'&venderType='+venderType:'')
+(riskCheck=='1'?'&rcheck=1':'');}
var bf='',pg='',wdref='&wdref='+encodeURIComponent(obj.protocol+obj.getNewSkuUrl(obj.skuId)),spAttr=obj.item().spAttr||{};if(urlParam.getUrlParam('bf'))bf+='bf='+urlParam.getUrlParam('bf');var buyLink='';if(obj.ysNoWayInfo.yuShouNoWayStatus==1){buyLink='//wqs.jd.com/order/s_confirm_booking.shtml?sceneval=2';}else if(obj.isOTC==1||obj.isOTC==2||obj.isPrescribeDrug){buyLink='//wqs.jd.com/order/s_confirm_otc.shtml?sceneval=2';}else{buyLink='//wqs.jd.com/order/wq.confirm.shtml';if(obj.isOverseaPurchase>0){buyLink=window.global_confirm_url||buyLink;}else{buyLink=window.main_confirm_url||buyLink;}
buyLink+='?sceneval=2';}
var commlist=[obj.skuId,obj.itemId,obj.buyNumController.buyNum,obj.skuId,'1,0,0'],skuIds=[];if(obj.promotion&&obj.promotion.isGiftPool){skuIds=obj.promotion.getGiftPoolList();}
$carGift=$('#carGift');if($carGift.length&&$carGift.css('display')!='none'&&$carGift.attr('sku')){skuIds.push($carGift.attr('sku'));}
if(skuIds.length>0)commlist.push(skuIds.join('_'));if(obj.yanbao&&obj.yanbao.ybInfo&&obj.yanbao.ybInfo.isGift){skuIds=obj.yanbao.getNewYanBaoList(1);if(skuIds.length>0){if(!obj.promotion||!obj.promotion.isGiftPool)commlist.push('');commlist.push(obj.yanbao.ybInfo.giftSku);}}
if(obj.isDist){commlist[7]='1';}
if(obj.locShopInfo['isLOC']&&obj.locShopInfo['shopId']){commlist[1]=obj.locShopInfo['shopId'];}
var url=[buyLink+'&bid='+(obj.bid||'')+(obj.isPrescribeDrug?'&rxdrug=1&ptag=7435.1.4':'')+weixinadkey+wdref,'scene=jd&isCanEdit=1&EncryptInfo=&Token=&commlist='+commlist.join(','),'locationid='+obj.jdAddrId.slice(0,3).join('-'),'type='+(spAttr.isXnzt=='1'?'3':'0'),spAttr.LuxuryGoods=='1'?'lg=1':'lg=0',spAttr.isSupermarket=='1'?'supm=1':'supm=0'];var bgStr=pg+(pg&&bf?'&':'')+bf;if(bgStr)url.push(bgStr);if(location.pathname.indexOf('mitem')>0)url.push('ismitem=1');if(obj.yanbao&&obj.yanbao.ybInfo&&obj.yanbao.ybInfo.isYanBao){var pids=obj.yanbao.getNewYanBaoList();if(pids.length>0){url.push('isnewyb=1&ybcommlist='+pids.join('$'));}}
if(obj.yanbao&&obj.yanbao.ybInfo&&obj.yanbao.ybInfo.isJdService){pids=obj.yanbao.getNewYanBaoList(2);if(pids.length>0){url.push('jdhscommlist='+pids.join('$'));}}
if(obj.isOverseaPurchase>0){url.push('globalbuy='+obj.isOverseaPurchase);}
if(obj.isEcard)url.push('eCard=1');if(urlParam.getUrlParam('roomId'))url.push('roomId='+urlParam.getUrlParam('roomId'));if(obj.scanOrig){url.push('scan_orig='+obj.scanOrig);}
if(obj.svcid){url.push('svcid='+obj.svcid);}
if(window.isSpecWxapp){url.push('sourceEnd=wxapp_booking');}
if(obj.sellWhilePresellBuy)url.push('sourcefrom=presalefixup');return url.join('&')+'#wechat_redirect';};ItemDet.prototype.jumpHkBuyLink=function(url){var obj=this,spuId=this.descriptionId.replace(/^d/,'');window.hkFeetypeData=function(json){if(!json||!json.datas||json.datas.length==0||!json.datas[0].feetypes||json.datas[0].feetypes.length==0){location.href=url;return;}
var ft=json.datas[0].feetypes[0].ft,tempUrl='//m-eve.jd.com/business?',tempParams=['sku='+obj.skuId,'btype='+ft,'provinceId='+obj.jdAddrId[0],'provinceName='+encodeURIComponent(obj.jdAddrName[0]),'cityId='+obj.jdAddrId[1],'cityName='+encodeURIComponent(obj.jdAddrName[1])];if(!obj.isZiying){tempParams.push('venderId='+obj.venderId);tempParams.push('productId='+spuId);}
obj.leavePage(tempUrl+tempParams.join('&'));};var params=['skuId='+this.skuId,'provinceId='+this.jdAddrId[0],'cityId='+this.jdAddrId[1],'productId='+(this.isZiying?'':spuId),'source=wxsqitemsou'];ls.loadScript({url:"//feetype.jd.com/services/queryFeeTypes.action?callback=hkFeetypeData&"+params.join('&'),onError:function(){location.href=url;}});};ItemDet.prototype.setBtnStatus=function(config,isModify,isStockStateChange){if(!config)return;var obj=this;if(config.dontSetBtnStatusAnyMore=='0'){obj.dontSetBtnStatusAnyMore=false;}
if(obj.dontSetBtnStatusAnyMore)return;if(config.dontSetBtnStatusAnyMore=='1'){obj.dontSetBtnStatusAnyMore=true;}
if(!config.msgConfig)config.msgConfig={};if(!config.buyBtnConfig)config.buyBtnConfig={};if(!config.addBtnConfig)config.addBtnConfig={};if(!config.popupBuyAreaConfig)config.popupBuyAreaConfig={};if(!isStockStateChange)obj.oBtnStatus=config;if(config.msgConfig.hideMsg){$('#statusNotice').hide();$('#statusNoticeLink').hide();$('#popupNotice').hide();}else if(config.msgConfig.msg&&config.msgConfig.amsg){if(!$('#statusNoticeLink').length){$('#statusNotice').before('<div class="detail_bottom_blackBar" id="statusNoticeLink"></div>');}
$('#statusNoticeLink').html(config.msgConfig.msg+'<a href="'+(config.msgConfig.amsgUrl||'javascript:void(0);')+'">'+config.msgConfig.amsg+'</a>').show();$('#superReturnNotice').hide();$('#keplerNotice').hide();}else if(config.msgConfig.msg){$('#statusNotice').show();$('#statusNote').html(config.msgConfig.msg);$('#popupNotice').html(config.msgConfig.msg).show();$('#superReturnNotice').hide();$('#keplerNotice').hide();}
if(config.buyBtnConfig.disable){$('#buyBtn1').addClass('disabled_1');$('#buyBtn2').addClass('btn_disable');$('#specBuyBtn').addClass('btn_disable');$('#specBuyBtn1').addClass('disabled_1');obj.jdStatus=false;}else if(config.buyBtnConfig.disable===false||(!isModify&&config.buyBtnConfig.disable===undefined)){$('#buyBtn1').removeClass('disabled_1');$('#buyBtn2').removeClass('btn_disable');$('#specBuyBtn').removeClass('disabled_1');$('#specBuyBtn1').removeClass('btn_disable');obj.jdStatus=true;}
if(config.buyBtnConfig.showType==1){$('#buyBtn2,#buyBtn1').hide();$('#specBuyBtn,#specBuyBtn1').show();}else if(config.buyBtnConfig.showType==-1){$('#buyBtn2,#buyBtn1').hide();$('#specBuyBtn,#specBuyBtn1').hide();}else if(config.buyBtnConfig.showType===0||(!isModify&&config.buyBtnConfig.showType===undefined)){$('#buyBtn2,#buyBtn1').show();$('#specBuyBtn,#specBuyBtn1').hide();}
if(config.buyBtnConfig.txt){$('#buyBtn1,#buyBtn2 span.txt').text(config.buyBtnConfig.txt);$('#specBuyBtn span.txt,#specBuyBtn1').text(config.buyBtnConfig.txt);}
if(config.addBtnConfig.disable){$('#addCart2').addClass('btn_disable');$('#addCart1').addClass('disabled_1');$('#specAddBtn').addClass('btn_disable');$('#specAddBtn1').addClass('disabled_1');$('#shareBtn2').addClass('btn_disable');$('#shareBtn1').addClass('disabled_1');}else if(config.addBtnConfig.disable===false||(!isModify&&config.addBtnConfig.disable===undefined)){$('#addCart2').removeClass('btn_disable');$('#addCart1').removeClass('disabled_1');$('#specAddBtn').removeClass('btn_disable');$('#specAddBtn1').removeClass('disabled_1');$('#shareBtn2').removeClass('btn_disable');$('#shareBtn1').removeClass('disabled_1');}
if(config.addBtnConfig.showType==1){$('#addCart1,#addCart2').hide();$('#specAddBtn,#specAddBtn1').show();}else if(config.addBtnConfig.showType==-1){$('#addCart1,#addCart2').hide();$('#specAddBtn,#specAddBtn1').hide();}else if(config.addBtnConfig.showType===0||(!isModify&&config.addBtnConfig.showType===undefined)){$('#addCart1,#addCart2').show();$('#specAddBtn,#specAddBtn1').hide();}
if(config.addBtnConfig.txt){$('#specAddBtn span.txt,#specAddBtn1').text(config.addBtnConfig.txt);}
if(config.showViewGuess){$('#viewGuess,#viewGuess1').show();}else if(config.showViewGuess===false||(!isModify&&config.showViewGuess===undefined)){$('#viewGuess,#viewGuess1').hide();}
if(config.showArrivalNotice){$('#arrivalNotice,#arrivalNotice1').show();}else if(config.showArrivalNotice===false||(!isModify&&config.showArrivalNotice===undefined)){$('#arrivalNotice,#arrivalNotice1').hide();}
if(!config.popupBuyAreaConfig.keep){if(config.popupBuyAreaConfig.btnShowType==1){$('#popupConfirm').parent().addClass('show').show();$('#buyBtn1').parent().removeClass('show').hide();}else if(config.popupBuyAreaConfig.btnShowType==2){$('#popupConfirm').parent().removeClass('show').hide();$('#buyBtn1').parent().addClass('show').show();}else if(config.popupBuyAreaConfig.btnShowType===0||(!isModify&&config.popupBuyAreaConfig.btnShowType===undefined)){$('#popupConfirm').parent().removeClass('show').hide();$('#buyBtn1').parent().removeClass('show').hide();}
if(config.popupBuyAreaConfig.disablePopupConfirm){$('#popupConfirm').addClass('disabled_1');}else if(config.popupBuyAreaConfig.disablePopupConfirm===false||(!isModify&&config.popupBuyAreaConfig.disablePopupConfirm===undefined)){$('#popupConfirm').removeClass('disabled_1');}}
if(obj.bigPromoteInfo&&(obj.bigPromoteInfo.buyBtnClass||obj.bigPromoteInfo.cartBtnClass)){var buyBtnClass=obj.bigPromoteInfo.buyBtnClass,cartBtnClass=obj.bigPromoteInfo.cartBtnClass;if($('#addCart1').hasClass('disabled_1')||$('#addCart1').hasClass('btn_disable')){$('#addCart1').removeClass(cartBtnClass);}
if($('#addCart2').hasClass('btn_disable')||$('#addCart2').hasClass('disabled_1')){$('#addCart2').removeClass(cartBtnClass);}
if($('#buyBtn1').hasClass('disabled_1')||$('#buyBtn1').hasClass('btn_disable')){$('#buyBtn1').removeClass(buyBtnClass);}
if($('#buyBtn2').hasClass('btn_disable')||$('#buyBtn2').hasClass('disabled_1')){$('#buyBtn2').removeClass(buyBtnClass);}
$('#addCart1,#addCart2').not('.btn_disable').not('.disabled_1').addClass(cartBtnClass);$('#buyBtn1,#buyBtn2').not('.btn_disable').not('.disabled_1').addClass(buyBtnClass);}};ItemDet.prototype.initCartBuy=function(spAttr,callback){var obj=this;obj.setBtnStatus({buyBtnConfig:{txt:''},addBtnConfig:{txt:''},popupBuyAreaConfig:{keep:!obj.isInit,btnShowType:1}});if(obj.isPingouShop&&!obj.isPingou){$('#addCart2, #addCart1').hide();}
if(obj.canNotBuyHere){obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{disable:true},addBtnConfig:{disable:true},popupBuyAreaConfig:{btnShowType:2,disablePopupConfirm:true}});}else if(obj.isWareOff){obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{showType:-1,},addBtnConfig:{showType:-1,},popupBuyAreaConfig:{btnShowType:2},showViewGuess:true,showArrivalNotice:false});}else if(obj.canNotBuyAlone){obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{disable:true},addBtnConfig:{disable:true},popupBuyAreaConfig:{btnShowType:2,disablePopupConfirm:true}});}else{if(obj.isCrossDomain&&(obj.isOverseaPurchase>0||obj.isOTC>0)){obj.setBtnStatus({buyBtnConfig:{showType:-1}});}
if(obj.is9669order||obj.isDidiCard){obj.setBtnStatus({addBtnConfig:{showType:-1}});}
if(obj.isPrescribeDrug){if(obj.newDrugGray){obj.setBtnStatus({msgConfig:{msg:''},buyBtnConfig:{showType:1,txt:''},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2}});}else{obj.setBtnStatus({buyBtnConfig:{showType:-1},addBtnConfig:{showType:1,txt:''},popupBuyAreaConfig:{btnShowType:2}});}}
if(obj.isfqy){obj.setBtnStatus({buyBtnConfig:{showType:1,txt:''},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2}});}
if(obj.isYsp&&!obj.isJDChoice){$('#addCart1,#addCart2').removeClass().addClass('btn btn_art');}
if(obj.isEcard){obj.setBtnStatus({buyBtnConfig:{showType:1,txt:''},addBtnConfig:{showType:spAttr.yysfhf==1?-1:1,txt:''},popupBuyAreaConfig:{btnShowType:2}});$('#specBuyBtn').removeClass('btn_blue').addClass('btn_buy');}
if(obj.isJMa){if(obj.hasBigouma){obj.setBtnStatus({buyBtnConfig:{txt:''},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2}});}else{obj.setBtnStatus({msgConfig:{msg:'',amsg:'',amsgUrl:'//wqs.jd.com/my/cdkey.shtml?ptag=7464.1.2'},buyBtnConfig:{disable:true,txt:''},addBtnConfig:{showType:-1,disable:true,},popupBuyAreaConfig:{btnShowType:2,disablePopupConfirm:true}});}}
if(obj.isDzItem){obj.setBtnStatus({buyBtnConfig:{txt:''},addBtnConfig:{showType:spAttr.Customize=='2'?0:-1},popupBuyAreaConfig:{btnShowType:2}});}
if(obj.isHYKHSP){obj.setBtnStatus({addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2}});}
if(obj.isLocStore){obj.setBtnStatus({buyBtnConfig:{showType:obj.locAddCartDirect?0:1,txt:obj.locAddCartDirect?'':(obj.isWholeVehicle?'':'')},addBtnConfig:{showType:obj.isWholeVehicle||obj.locAddCartDirect?0:-1},popupBuyAreaConfig:{btnShowType:2}});}
if(obj.isJdGame){obj.setBtnStatus({buyBtnConfig:{showType:1,txt:''},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2}});}
if(obj.isNewJdGame){obj.setBtnStatus({buyBtnConfig:{showType:1,txt:''},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2}});}
if(obj.isFlimPrint>0){switch(obj.isFlimPrint){case'1':obj.setBtnStatus({buyBtnConfig:{showType:1,txt:''},addBtnConfig:{showType:-1},popupBuyAreaConfig:{btnShowType:2},dontSetBtnStatusAnyMore:1});break;case'2':obj.setBtnStatus({buyBtnConfig:{showType:-1},addBtnConfig:{showType:0},dontSetBtnStatusAnyMore:1});break;case'3':obj.setBtnStatus({buyBtnConfig:{showType:1,txt:''},addBtnConfig:{showType:0},dontSetBtnStatusAnyMore:1});break;default:break;}}
if(obj.isXnkq||obj.isCzGoods||(obj.jdfwj=='1'||obj.jdfwj=='2'||obj.jdfwj=='3')||obj.zyTravel||obj.isSxdzq||obj.isOilCard){obj.setBtnStatus({addBtnConfig:{showType:-1}});}
$('#superReturnNotice').hide();$('#keplerNotice').hide();if($('#statusNotice')[0].style.display=='none'){var superReturnRatio=kepler.getsuperReturnRatio(obj.superrebate);if(superReturnRatio>0){kepler.superReturn(superReturnRatio);}else if(window._keplerConfig&&window._keplerConfig.isCustom){kepler.setKeplerTip();}}
return callback(true);}
callback(false);};ItemDet.prototype.setArrivalNotice=function(){var obj=this;if(!loginHandler.getLoginStatus()){loginHandler.login();return;}
popUp.createPopup({flag:9,onConfirm:function(){var mdiv=$('#modAlertDiv'),phoneNumObj=mdiv.find('input[mark="phoneNum"]'),phoneNum=phoneNumObj.val().trim();var $errtips=$('#modAlertDiv p[mark="errtips"]');$errtips.hide();if(!phoneNum||!/^\d{11}$/.test(phoneNum)){$errtips.text('').show();}else{window.subscribeCB=function(json){if(json.errcode=='13'){loginHandler.login();return;}
if(json.result&&json.result.resultCode==1){$('#modAlertDiv,#modAlertMask').hide().removeClass(' mod_alert_info show fixed');showNotice({str:"",iconFlag:1});}else{$('#modAlertDiv,#modAlertMask').hide().removeClass(' mod_alert_info show fixed');showNotice({str:"",iconFlag:2});}};ls.loadScript({url:'//wq.jd.com/commodity/notify/SubscribeStock?callback=subscribeCB&sceneval=2&sku='+obj.skuId+'&addr='+obj.jdAddrId.join('_')+'&phone='+encodeURIComponent(phoneNum)+'&t='+Math.random(),onError:function(){$('#modAlertDiv,#modAlertMask').hide().removeClass(' mod_alert_info show fixed');showNotice({str:"",iconFlag:2});}});}
return true;},onCancel:null});};ItemDet.prototype.setCheaperNotice=function(){var obj=this;if(!loginHandler.getLoginStatus()){loginHandler.login();return;}
popUp.createPopup({flag:10,onConfirm:function(){var mdiv=$('#modAlertDiv'),priceObj=mdiv.find('input[mark="price"]'),priceNum=priceObj.val().trim();phoneNumObj=mdiv.find('input[mark="phoneNum"]'),phoneNum=phoneNumObj.val().trim();var $errtips1=$('#modAlertDiv p[mark="errtips1"]');var $errtips2=$('#modAlertDiv p[mark="errtips2"]');$errtips1.hide();$errtips2.hide();var pass=true;if(!priceNum||priceNum-0<0){$errtips1.text('').show();pass=false;}else if(priceNum-0>obj.jdPrice-0){$errtips1.text('').show();pass=false;}
if(!phoneNum||!/^\d{11}$/.test(phoneNum)){$errtips2.text('').show();pass=false;}
if(pass){window.subscribePriceCB=function(json){if(json.errcode===0&&json.result&&json.result.resultCode===1){$('#modAlertDiv,#modAlertMask').hide().removeClass(' mod_alert_info show fixed');showNotice({str:"",iconFlag:1});obj.itemFavour.fav(true,true);}else if(json.errcode=='13'){loginHandler.login();}else{$('#modAlertDiv,#modAlertMask').hide().removeClass(' mod_alert_info show fixed');showNotice({str:"",iconFlag:2});}}
ls.loadScript({url:'//wq.jd.com/commodity/notify/SubscribePrice?callback=subscribePriceCB&sceneval=2&src=item&sku='+obj.skuId+'&addr='+obj.jdAddrId.join('_')+'&price='+Math.ceil(priceNum*100)+'&phone='+encodeURIComponent(phoneNum)+'&t='+Math.random(),onError:function(){$('#modAlertDiv,#modAlertMask').hide().removeClass(' mod_alert_info show fixed');showNotice({str:"",iconFlag:2});}});}
return true;},onCancel:null});};ItemDet.prototype.liBaoCoupon=function(){if(!this.venderId||!this.isLoadCoupon)return;var obj=this,activeObj={'0':'Mxinrenquanduo'},active='';window.clearTimeout(obj.newerCouponObj.timer);var overTime=false;obj.newerCouponObj.timer=window.setTimeout(function(){overTime=true;obj.getCouponList();},4000);var loadCoupon=function(newerCoupons){if(!overTime){window.clearTimeout(obj.newerCouponObj.timer);if(newerCoupons&&newerCoupons.length){obj.getCouponList(newerCoupons);}else{obj.newerCouponObj.activeId='none';obj.getCouponList();}}};var loadJiangChi=function(activeId){obj.newerCouponObj.activeId=activeId;ls.loadScript('//wq.jd.com/activepersistent/couponrecommend/queryuseractiveinfo?callback=activeCB&sceneval=2&active='+activeId+'&t='+Math.random());};window.activeCB=function(json){if(json.ret==0&&json.prizes){var hadLevelArr=[];if(json.bingos&&json.bingos.length>0){json.bingos.forEach(function(val,idx,arr){val.Level&&hadLevelArr.push(parseInt(val.Level));});}
var prizeArr=json.prizes.filter(function(s){var prizeTimeArr=s.PrizeTime?s.PrizeTime.split(','):[],constraintTimeArr=s.ConstraintTime?s.ConstraintTime.split(','):[],couponTimeArr=s.ValidType==1&&s.CouponTime?s.CouponTime.split(','):[],discountQuotaArr=s.DiscountQuota?s.DiscountQuota.split(','):[],nowTime=new Date().getTime();return s&&s.Status==0&&s.Level&&discountQuotaArr&&discountQuotaArr.length>1&&prizeTimeArr.length>1&&(parseFloat(prizeTimeArr[0])*1000)<=nowTime&&(parseFloat(prizeTimeArr[1])*1000)>=nowTime&&(s.ValidType==2||(couponTimeArr.length>1&&(parseFloat(couponTimeArr[1])*1000)>=nowTime))&&constraintTimeArr.length>1&&(parseFloat(constraintTimeArr[0])*1000)<=nowTime&&(parseFloat(constraintTimeArr[1])*1000)>=nowTime&&!~hadLevelArr.indexOf(parseInt(s.Level));});if(prizeArr.length>0){prizeArr=prizeArr.slice(0,3);prizeArr.sort(function(a,b){return parseInt(a.Level)-parseInt(b.Level);});}
if(!prizeArr.length){loadCoupon();}else{prizeArr.forEach(function(val,idx,arr){var discountQuotaArr=val.DiscountQuota?val.DiscountQuota.split(','):[];prizeArr[idx].BizType=obj.newerCouponObj.activeId;prizeArr[idx].roleId=obj.newerCouponObj.activeId+'-'+val.Level;prizeArr[idx].key='newer';prizeArr[idx].quota=discountQuotaArr[1];prizeArr[idx].discount=discountQuotaArr[0];prizeArr[idx].Name='()';});loadCoupon(prizeArr);}}else{loadCoupon();}};obj.newerCouponObj.needPopup=cookie.get('needPopup')||false;cookie.del('needPopup');if(obj.newerCouponObj.activeId){obj.newerCouponObj.activeId=='none'?loadCoupon():loadJiangChi(obj.newerCouponObj.activeId);}else{if(loginHandler.getLoginStatus()){obj.queryIsNewUser(function(isNewUser){if(isNewUser=='2'){active=activeObj[0];}
if(active){loadJiangChi(active);}else{loadCoupon();}});}else{active=activeObj[0];loadJiangChi(active);}}};ItemDet.prototype.getCouponList=function(newerCoupons){if(!newerCoupons&&(!this.venderId||!this.isLoadCoupon))return;var obj=this;var $discountFloor=$('#discountFloor'),$discountPopup=$('#discountPopup');window.getCouponListCB=function(json){umpMonitor.delTimeout('itil11');if(json.ret==0){var skuInfo=json.sku_info||{},limitCouponType=skuInfo.limitCouponType||[],limitTitle=skuInfo.limitCouponDesc||'',$jqdqIcon=$('#serviceArea [tag="jqdqTitle"]'),detailTpl='<div class="section" tag="jqdqSection"><div class="detail_serve_main_tit {#disabled#}">{#title#}</div><p class="detail_serve_main_content">{#detail#}</p></div>';if(limitTitle){$jqdqIcon.html(limitTitle).show();var str=(popUp.popupBody.service&&popUp.popupBody.service.replace(popUp.popupBody.jqdqService,itemComm.jsonToTpl({disabled:'disabled',title:limitTitle,detail:limitTitle},detailTpl)))||'';popUp.setPopupBody('service',str);}
var showNewerCoupons=(newerCoupons&&newerCoupons.length>0&&(skuInfo.useJing!='0'&&skuInfo.useDong!='0'&&!~limitCouponType.indexOf('limit_1')&&!~limitCouponType.indexOf('limit_2')));var numControl=function(num){if(!num){return 0;}
return parseFloat(parseFloat(num).toFixed(2).toString().replace('.00',''));};var coupons=json.coupons||[],couponHtml=[],htmlArr=[],couponTpl=$('#couponTpl').html(),couponNum=0,reportUseCoupon=true,renderCoupon=function(opt){opt=opt||{};var arr=opt.arr||[],iitem={},couponHtml1=[],isNewerCoupons=opt.isNewerCoupons;if(isNewerCoupons){for(var i=0,leni=arr.length;i<leni;i++){iitem=arr[i];iitem.discount='<i>&yen;</i><strong>'+iitem.discount+'</strong>';iitem.key='newer';iitem.roleId=iitem.BizType+'-'+iitem.Level;iitem.typeClass='coupon_voucher3_spec_tag';iitem.typeName='';iitem.type='3';if(iitem.Vender){if(iitem.Vender==1){iitem.typeClass+=' type_red';iitem.typeName='';}else if(iitem.Vender==2){iitem.typeClass+=' type_blue';iitem.typeName='';}else if(iitem.Vender==3){iitem.typeClass+=' type_gold';iitem.type='4';iitem.typeName='';}else if(iitem.Vender==4){iitem.typeClass+=' type_gold';iitem.type='5';iitem.typeName='';}}
iitem.limitList=iitem.quota>0?'<p class="coupon_voucher3_view_des">'+iitem.quota+'</p>':'';iitem.buttonText='';var fuliTip={'1':'','2':'','3':''};if(fuliTip[obj.newerCouponObj.libaoType]){iitem.newerCouponTag='<span class="coupon_voucher3_tag"><i>'+fuliTip[obj.newerCouponObj.libaoType]+'</i></span>';}
iitem.name=iitem.Name;if(iitem.ValidType==1){var couponTimeArr=iitem.CouponTime.split(','),dateObj;if(couponTimeArr.length>1){dateObj=formatTime(new Date(parseFloat(couponTimeArr[0])*1000));iitem.timeDesc=dateObj.year+'.'+parseInt(dateObj.month)+'.'+parseInt(dateObj.day)+' '+dateObj.hour+':'+dateObj.min;dateObj=formatTime(new Date(parseFloat(couponTimeArr[1])*1000));iitem.timeDesc+=' - '+dateObj.year+'.'+parseInt(dateObj.month)+'.'+parseInt(dateObj.day)+' '+dateObj.hour+':'+dateObj.min;}}else{iitem.timeDesc=''+iitem.CouponTime+'';}
iitem.couponClass='coupon_voucher_amount type_large';couponHtml1.push(itemComm.jsonToTpl(iitem,couponTpl));}}else{for(var i=0,leni=arr.length;i<leni;i++){iitem=arr[i];iitem.discount='<i>&yen;</i><strong attr-discount="'+iitem.discount+'">'+iitem.discount+'</strong>';iitem.typeClass='';iitem.typeName='';iitem.name=(iitem.userLabel=='104'?'<i class="coupon_voucher3_info_extro"></i>':'')+iitem.name;iitem.type='1';if(iitem.couponType==0){iitem.typeClass='type_red';iitem.typeName='';iitem.type='2';}
if(iitem.businessLabel==211||iitem.businessLabel==212){iitem.typeName='';}
iitem.limitList=iitem.quota>0?'<p class="coupon_voucher3_view_des">'+iitem.quota+'</p>':'';iitem.buttonClass='bg_2';iitem.buttonText='';if(iitem.didget=='1'){if(reportUseCoupon){reporter.reports({ptag:'7001.1.71',pin:encodeURIComponent(cookie.get('jdpin'))});reportUseCoupon=false;}
iitem.buttonClass='disabled';iitem.buttonText='';iitem.id='';}
iitem.couponClass='coupon_voucher_amount type_large';if(iitem.discountArr&&iitem.discountArr.length>0){var discountInfo=iitem.discountdesc.info,high=numControl(iitem.discountdesc.high)||0;iitem.buttonClass=(iitem.buttonClass||'')+' bottom_6';iitem.timeDescClass=(iitem.timeDescClass||'')+' bottom_6';if(discountInfo.length==1){iitem.discount='<strong>'+iitem.discountArr[0]+'</strong><small></small>';iitem.limitList=['<p class="coupon_voucher3_view_des">'+discountInfo[0].quota+'</p>',(high?'<p class="coupon_voucher3_view_tips">'+high+'</p>':'')].join('');}else{iitem.discount='';iitem.discountdesc.info.forEach(function(val,index,arr){iitem.discount+=(index==0?'':'<p class="coupon_voucher3_view_price">')+'<span>'+val.quota+'/</span>'+'<strong attr-discount="'+numControl(parseFloat(val.discount)*10)+'">'+numControl(parseFloat(val.discount)*10)+'</strong><small></small>'+(index==(arr.length-1)?'</p>':'');});iitem.limitList=high?'<p class="coupon_voucher3_view_tips">'+high+'':'';}}
couponHtml1.push(itemComm.jsonToTpl(iitem,couponTpl));}}
if(couponHtml1.length>0){return couponHtml1;}
return'';};JD.report.umpBiz({bizid:bizid,operation:'11',result:'0',source:'0',message:'item queryusegetcoupon api success'});if(!coupons.length&&(!newerCoupons||!newerCoupons.length)){obj.getWeiKuanCoupon();return;}
try{var itemCoupon=JSON.parse(cache.getItem('itemCoupon')||'{}');if(itemCoupon.sku==obj.baseSkuId&&itemCoupon.key&&itemCoupon.roleid){if(coupons.filter(function(a){return a&&a.key==itemCoupon.key&&a.roleId==itemCoupon.roleid})[0]){itemCoupon.noPinTip=true;obj.getCoupon(null,itemCoupon);cache.setItem('itemCoupon','',3600);}}}catch(e){}
var unimap={},toastTip='';obj.fansCouponRoleIdObj={};coupons.forEach(function(val,idx){if(val.userLabel=='104')obj.fansCouponRoleIdObj[val.roleId]=true;if(val.couponstyle==3&&val.discountdesc&&val.discountdesc.info&&val.discountdesc.info.length>0){coupons[idx].discountArr=[];val.discountdesc.info=val.discountdesc.info.sort(function(a,b){return parseFloat(a.discount)-parseFloat(b.discount);});val.discountdesc.info.forEach(function(item){coupons[idx].discountArr.push(numControl(parseFloat(item.discount)*10));});if(val.discountdesc.info.length>1){var arrTemp=[];val.discountdesc.info.forEach(function(item){arrTemp.push(''+numControl(item.quota)+''+numControl(parseFloat(item.discount)*10)+'');});coupons[idx].discountDesc=arrTemp.join(', ');}}});coupons=coupons.sort(function(a,b){return(b.didget-a.didget);}).filter(function(a){if(a.couponKind==0||(unimap[a.quota+'-'+a.discount]&&a.couponstyle!=3)){return false;}
if(a.couponstyle!=3){unimap[a.quota+'-'+a.discount]=true;}
return true;});if(coupons.length<=0){if(showNewerCoupons){couponHtml=newerCoupons.slice(0,2);couponNum=newerCoupons.length;}else{obj.getWeiKuanCoupon();return;}}else{coupons=coupons.sort(function(a,b){return(a.discountArr?1/(1-(a.discountArr[0]/10)):a.quota/a.discount)-(b.discountArr?1/(1-(b.discountArr[0]/10)):b.quota/b.discount);});var fansCoupon=[];var couponsWithOneFansCoupon=coupons.filter(function(a,index){if(a.userLabel=='104'){fansCoupon.push(index);if(fansCoupon.length==1)return true;return false;}
return true;});if(showNewerCoupons){couponNum=coupons.length+newerCoupons.length;couponHtml=couponsWithOneFansCoupon.slice(0,2);}else{couponNum=coupons.length;couponHtml=couponsWithOneFansCoupon.slice(0,3);}}
for(var i=0,descTemp='',leni=couponHtml.length;i<leni;i++){if(couponHtml[i].userLabel=='104'){reporter.reportExposure({ptag:'7001.8.3',venderid:obj.venderId,roleId:couponHtml[i].roleId});couponHtml[i]='<span class="coupon bg_red"></span>';}else if(couponHtml[i].discountArr){descTemp=couponHtml[i].discountArr.length>1?couponHtml[i].discountArr.join('/')+'':''+couponHtml[i].discountdesc.info[0].quota+''+couponHtml[i].discountArr[0]+'';couponHtml[i]='<span class="coupon">'+descTemp+'</span>';}else{descTemp=couponHtml[i].quota==0?couponHtml[i].discount+"":''+couponHtml[i].quota+''+couponHtml[i].discount;if(couponHtml[i].Vender&&couponHtml[i].Vender==2){descTemp='';}
couponHtml[i]='<span class="coupon">'+descTemp+'</span>';}}
var tpl='{#couponStr#}';htmlArr=htmlArr.concat(renderCoupon({arr:coupons}));if(showNewerCoupons){var fuliItem={'1':{'tip':'','exposurePtag':'7001.1.179','clickPtag':'7001.1.180'},'2':{'tip':'','exposurePtag':'7001.1.177','clickPtag':'7001.1.180'},'3':{'tip':'','exposurePtag':'7001.1.262','clickPtag':'7001.1.263'}}[obj.newerCouponObj.libaoType];if(fuliItem){window.wa&&window.wa('ptagExposure',{ptag:fuliItem.exposurePtag});$discountFloor.attr('ptag',fuliItem.clickPtag);toastTip=false;couponHtml.push('<span class="coupon bg_red">'+fuliItem.tip+'</span>');}
htmlArr=htmlArr.concat(renderCoupon({arr:newerCoupons,isNewerCoupons:true}));}
if($discountFloor.css('display')=='none')reporter.reportExposure({ptag:'7001.1.350'});$discountFloor.show().find('.dicount_coupon').html(couponHtml.join('')).show();$('#discountGap').show();reporter.reportExposure({ptag:'7001.4.24'});$discountPopup.find('.floor_coupon').show();$('#couponList').html(itemComm.jsonToTpl({couponStr:htmlArr.join('')},tpl));if(obj.newerCouponObj.needPopup){$discountFloor.trigger('click');if(toastTip){showNotice({str:toastTip});}}
obj.getWeiKuanCoupon(true,couponNum);}else{obj.getWeiKuanCoupon();JD.report.umpBiz({bizid:bizid,operation:'11',result:'2',source:'0',message:'item queryusegetcoupon api error'});}};umpMonitor.createTimeout('11','item CommCouponQuery api timeout');ls.loadScript(['//wq.jd.com/bases/couponsoa/avlCoupon?callback=getCouponListCB','cid='+obj.jdCategory[2],'popId='+(obj.isOverseaPurchase==3?'8889':(obj.isZiying?'8888':obj.venderId)),'sku='+obj.skuId,'price='+obj.jdPrice,'platform='+(obj.isWX?'5':'4'),'t='+Math.random()].join('&'));};ItemDet.prototype.getCoupon=function($em,opt){var obj=this;var key='',roleid='';opt=opt||{};if($em&&$em.length){key=$em.attr('key');roleid=$em.attr('roleid');}else{key=opt.key;roleid=opt.roleid;}
try{if(!key&&!roleid){var discountNum=$em.find('strong').attr('attr-discount')||'';reporter.pingClick('MProductdetail_NewCouponUse',discountNum,'4',obj.skuId);}}catch(e){}
if(!key||!roleid)return;if(!loginHandler.getLoginStatus()){if(key=='newer'){cookie.set('needPopup','ok',1);}
loginHandler.login(null,function(){obj.getCoupon($em,opt);});return;}
if(obj.fansCouponRoleIdObj&&obj.fansCouponRoleIdObj[roleid])reporter.reports({ptag:'7001.8.4',venderid:obj.venderId,roleId:roleid});if(key=='newer'&&roleid){
var tempArr=roleid.split('-');if(tempArr.length>1){var draw=function(){activeDraw.draw(tempArr[0],tempArr[1],function(retcode,data){var fuliPtag={'1':{'success':'7001.1.183','fail':'7001.1.182'},'2':{'success':'7001.1.185','fail':'7001.1.184'},'3':{'success':'7001.8.1','fail':'7001.8.2'}}[obj.newerCouponObj.libaoType],tipObj={' 26 147 ':'',' 19 ':'','default':''};if(retcode==0){fuliPtag&&window.wa&&wa('jdClick',{ptag:fuliPtag.success});showNotice({str:'<br/>1,<br/>~',t:3000});if(!$em||!$em.length){$em=$('.coupon_voucher3[key="'+key+'"][roleid="'+roleid+'"]');}
if($em&&$em.length){$em.find('.coupon_voucher3_info_btn').addClass('disabled').text('');$em.attr('key','').attr('roleid','');}else{obj.autoGetCoupon={key:key,roleid:roleid};}}else{fuliPtag&&window.wa&&wa('jdClick',{ptag:fuliPtag.fail});var isShowTip=false;for(retcodes in tipObj){if(~retcodes.indexOf(' '+retcode+' ')){showNotice({str:tipObj[retcodes],t:3000});isShowTip=true;return false;}}
if(!isShowTip){showNotice({str:tipObj.default,t:3000});}}},{'sceneid':'521292666'});};if(!obj.newerCouponObj.hasJsToken){activeDraw.antiBrush(function(json){if(json&&json.errorCode&&json.errorCode!=0){showNotice({str:'',t:3000});return;}
draw();});obj.newerCouponObj.hasJsToken=true;}else{draw();}}}else{userInfo.getPinStatus({sceneid:'5290180',cb:function(pinObj){pinObj=pinObj||{};var smallStr='',btnTxt='';if(pinObj.isPerfect){smallStr='';btnTxt='';}else if(pinObj.isBind){smallStr='';btnTxt='';}else if(pinObj.isSwitch){smallStr=''+((pinObj.json.pinList&&pinObj.json.pinList[0]&&pinObj.json.pinList[0].pin)||'')+'';btnTxt='';}
if(smallStr&&pinObj.url){if(!opt.noPinTip){popUp.createPopup({flag:4,msg:smallStr,icon:'info',okText:btnTxt,cancelText:'',onConfirm:function(){if(key=='yuShowWeiKuan'&&roleid){loginHandler.loginAuth({biz:'car',forceLogin:true,redirect:roleid,cb:function(){window.location.href=roleid;}});}else{try{cache.setItem('itemCoupon',JSON.stringify({sku:obj.baseSkuId,key:key,roleid:roleid}),3600);}catch(e){}
window.location.href=pinObj.url;}},onCancel:null});}}else{if(key=='yuShowWeiKuan'&&roleid){loginHandler.loginAuth({biz:'car',forceLogin:true,redirect:roleid,cb:function(){window.location.href=roleid;}});}else{window.ObtainJdShopFreeCouponCallBack=function(json){if(window.wa){wa('shDeviceId',{type:1,activeInfo:{key:key,roleid:roleid}});}
var drawTips={999:'<br/>1,<br/>~',14:'',15:'',16:'~',17:'~',12:'~',22:'',18:'30','default':''};if(json.code==999){window.wa&&wa('jdClick',{ptag:'7001.1.181'});reporter.pingClick('MProductdetail_NewCouponGet',(json.batchid||'')+'_1_'+(json.couponid||''),'',obj.skuId);}else{window.wa&&wa('jdClick',{ptag:'7001.1.176'});reporter.pingClick('MProductdetail_NewCouponGet',(json.batchid||'')+'_0_'+(json.couponid||''),'',obj.skuId);}
if(json.code===1000){loginHandler.login();}else if(json.code===34){obj.realNameAuth({msg:'',title:'',flag:1,noCgi:true,key:key,roleid:roleid});}else if(json.code===54){obj.realNameAuth({msg:'',title:'~',noCgi:true,tourl:'//msc.jd.com/auth/loginpage/wcoo/toAuthPage?source=15&businessType=726&directReturnUrl='+encodeURIComponent(location.href)});}else{showNotice({str:drawTips[json.code]||json.message||drawTips['default'],t:3000});if($em&&$em.length&&(json.code==999||json.code==14)){$em.find('.coupon_voucher3_info_btn').addClass('disabled').text('');$em.attr('key','').attr('roleid','');}}};ls.loadScript(['//wq.jd.com/activeapi/obtainjdshopfreecouponv2?sceneval=2&callback=ObtainJdShopFreeCouponCallBack&scene=2','key='+key,'roleid='+roleid,'t='+Math.random()].join('&'),{onError:function(){showNotice({str:'',t:3000});}});}}}});}};ItemDet.prototype.getWeiKuanCoupon=function(showed,couponNum){var obj=this;if(!obj.venderId)return;var needShow=false;if((obj.cidConfigs.weiKuanCid1s||obj.cidConfigs.weiKuanCid2s||obj.cidConfigs.weiKuanCid3s)){if(((~obj.cidConfigs.weiKuanCid1s.indexOf('|'+obj.jdCategory[0]+'|'))||(~obj.cidConfigs.weiKuanCid2s.indexOf('|'+obj.jdCategory[1]+'|'))||(~obj.cidConfigs.weiKuanCid3s.indexOf('|'+obj.jdCategory[2]+'|')))){needShow=true;}}
if(needShow&&obj.ysNoWayInfo&&obj.ysNoWayInfo.isYuShouNoWay&&window._itemGlobal&&window._itemGlobal.ysCouponGray){var couponTpl=$('#couponTpl').html();window.weiKuanCB=function(json){var item={buttonClass:'bg_1',name:'',typeName:'',typeClass:'bg_fuli',key:'yuShowWeiKuan',buttonClass:'type_2',buttonText:'',couponClass:'coupon_voucher_amount type_large'};if(json.errcode==0&&json.jumpUrl&&json.couponDesc){item.roleId=json.jumpUrl;var textArr=json.couponDesc.match(/(\d+)(\d+)/)||json.couponDesc.match(/(\d+)/)||[];if(textArr&&textArr.length>0){if(textArr.length>2){item.discount=textArr[2];item.limitList='<p class="coupon_voucher_limit">'+textArr[1]+'</p>';}else if(textArr.length>1){item.discount=textArr[1];item.limitList='<p class="coupon_voucher_limit">0</p>';}}else{return;}
var $dom=$('#discountFloor').find('.dicount_coupon');if(showed&&couponNum){if($dom.find('.coupon').eq(2).hasClass('bg_red')){$dom.find('.coupon').eq(1).remove();}else{$dom.find('.coupon').eq(2).remove();}
$dom.find('.coupon').eq(0).before('<span class="coupon bg_yellow"></span>');$dom.find('.num').html(''+(parseInt(couponNum)+1)+'');$('#couponList').prepend(itemComm.jsonToTpl(item,couponTpl));}else{$dom.html('<span class="num">1</span><span class="title"></span><span class="coupon bg_yellow"></span>').show();$('#couponList').html(itemComm.jsonToTpl(item,couponTpl));}}};ls.loadScript('//wq.jd.com/bases/cdppromotionqueryservice/querypromotioninfo?callback=weiKuanCB&source=wq&skuid='+obj.skuId+'&venderid='+obj.venderId+'&t='+Math.random());}};ItemDet.prototype.realNameAuth=function(opt){opt=opt||{};var obj=this,rurl=opt.rurl||obj.locationUrl,tourl=opt.tourl||['//wq.jd.com/vipplus/LoginBrigdeAuthNameAll?scene='+(obj.isWX?'weixin':'qq'),'&bussinessType=515&rurl='+encodeURIComponent(rurl)].join('&');if(opt.noCgi){userInfo.getPinStatus({url:rurl,cb:function(pinObj){pinObj=pinObj||{};var msg=opt.msg,smallStr='',btnTxt='';if(pinObj.isPerfect){smallStr='';btnTxt='';}else if(pinObj.isBind){smallStr='';btnTxt='';}else if(pinObj.isSwitch){smallStr='';btnTxt='';}else{smallStr='';btnTxt='';}
smallStr=opt.title+''+smallStr;popUp.createPopup({flag:4,msg:msg+'</p><p class="alignLeft small">'+smallStr,icon:'info',okText:btnTxt,cancelText:'',onConfirm:function(){if(opt.flag===1){try{cache.setItem('itemCoupon',JSON.stringify({sku:obj.baseSkuId,key:opt.key,roleid:opt.roleid}),3600);}catch(e){}}
window.location.href=tourl;},onCancel:null});}});}else{window.verifyUserCB=function(json){var isVerify=true;if((json.retcode==0&&json.status==2)||json.retcode==2||json.retcode==4){isVerify=false;}
opt.cb&&opt.cb(isVerify);};ls.loadScript('//wq.jd.com/vipplus/VerifyAuthUser?sceneval=2&callback=verifyUserCB&t='+Math.random());}};ItemDet.prototype.setInstallService=function(spAttr){var obj=this;if(spAttr.YuShou=='1')return;var $carInstallPop=$('#carInstallPop'),$currentCarServiceTip=$carInstallPop.find('.car_service_tip');$carInstallPop.hide();obj.isCarInstall=false;if(obj.isInit)obj.carInstallChoose='1';var showCarInstallEnter=function(jumpUrlType,info){obj.isCarInstall=true;$carInstallPop.show();if(obj.jdCategory[0]=='9987'){$carInstallPop.find('.tit').text('');$carInstallPop.find('[btype="1"]').text('');$carInstallPop.find('[btype="0"]').text('');}else{$carInstallPop.find('.tit').text('');$carInstallPop.find('[btype="1"]').text('');$carInstallPop.find('[btype="0"]').text('');}
var priceTip=info;if(/$/.test(priceTip)){priceTip=info+' <span id="carInstallServiceUnit">'+obj.buyNumController.buyNum+'</span>';}
$currentCarServiceTip.html(priceTip);if(obj.carInstallChoose==1)$currentCarServiceTip.show();$('#chooseCarInstallService').off('click').on('click',function(){var jumpUrl='';if(jumpUrlType==1){jumpUrl='//fcar.jd.com/carService/m/index.html#index/skuId:'+obj.skuId
+'/num:'+obj.buyNumController.buyNum
+'/area:'+obj.jdAddrId.slice(0,4).join('_');}else{jumpUrl='//bundlingsale.jd.com/html/index.html#index/sku:'+obj.skuId
+'/categoryId:'+obj.jdCategory[2]
+'/area:'+obj.jdAddrId.slice(0,4).join('_');}
obj.leavePage(jumpUrl);}).attr('ptag','7001.1.165');if(obj.hasBindCarInstallEvent)return;obj.hasBindCarInstallEvent=true;JD.events.listen('item.buyNumController.buyNumChange',function(num){if(!num)return;$('#carInstallServiceUnit').html(num);});JD.events.listen('item.util.showPopupArea',function(){obj.handleCarInstallServiceBtn();});$carInstallPop.on('click','.btn,.btn_choose',function(){var tar=$(this),bType=tar.attr('btype');tar.addClass('cur').siblings().removeClass('cur');if(bType==='1'){obj.carInstallChoose='1';$currentCarServiceTip.show();}else{obj.carInstallChoose='0';reporter.reports({ptag:'7001.1.310'});$currentCarServiceTip.hide();}
obj.handleCarInstallServiceBtn();});};var kunbangService=function(){if(spAttr.isActualServ!=1||spAttr.isXnzt==1)return;window.carInstallService=function(res){obj.jdSkuInfo['installService'+obj.skuId]=res||{};if(res.retCode==0&&res.isLoc==1){showCarInstallEnter(2);}};if(obj.jdSkuInfo['installService'+obj.skuId]){window.carInstallService(obj.jdSkuInfo['installService'+obj.skuId]);}else{ls.loadScript(['//wq.jd.com/bases/shopservice/CheckShopService?callback=carInstallService','skuId='+obj.skuId,'categoryId='+obj.jdCategory[2]].join('&'));}};if(spAttr.isFreeload==2){window.haveLocShop=function(json){obj.jdSkuInfo['haveLocShop'+obj.skuId]=json;if(json&&json.isValueAddedLoc==1){showCarInstallEnter(1,json.info);}else{kunbangService();}};if(obj.jdSkuInfo['haveLocShop'+obj.skuId]){window.haveLocShop(obj.jdSkuInfo['haveLocShop'+obj.skuId]);}else{ls.loadScript(['//wq.jd.com/bases/valueaddedlocshop/hasvalueaddedlocshops?callback=haveLocShop','skuId='+obj.skuId,'t='+Math.random()].join('&'));}}else{kunbangService();}};ItemDet.prototype.handleCarInstallServiceBtn=function(){var obj=this;if(!obj.isCarInstall)return;if(obj.stockState[obj.skuId]==3)return;if(obj.isWareOff||obj.canNotBuyHere||obj.canOnlyBuyInApp||obj.canNotBuyAlone)return;var $chooseCarInstallService=$('#chooseCarInstallService');if(obj.carInstallChoose=='1'){$('#buyBtn1').parent().removeClass('show').hide();$('#popupConfirm').parent().removeClass('show').hide();if(obj.ysNoWayInfo&&obj.ysNoWayInfo.isYuShouNoWay){$chooseCarInstallService.text(''+$('#buyBtn2').text());}else{$chooseCarInstallService.text('');}
$chooseCarInstallService.parent().addClass('show').show();}else{var tag=$('#popupConfirm').attr('tag');if(tag==1||tag==2){$('#buyBtn1').parent().removeClass('show').hide();$('#popupConfirm').parent().addClass('show').show();}else{$('#buyBtn1').parent().addClass('show').show();$('#popupConfirm').parent().removeClass('show').hide();}
$chooseCarInstallService.parent().removeClass('show').hide();}};ItemDet.prototype.setShareConfig=function(){var obj=this;window.shareConfig.img_url=(obj.focusSlide&&obj.focusSlide.shareImg)||'';window.shareConfig.title=obj.item().skuName;window.shareConfig.desc=''+(this.jdPrice>0?''+this.jdPrice:'')+(this.isWX?'':'');window.shareConfig.link=location.href;if(window.shareConfig.link.indexOf('&logid=')==-1){if(window.__logid)window.shareConfig.link+='&logid='+window.__logid;}
if(window.wa){window.shareConfig.shareCallback=function(obj1,result,res){if(result==="ok"){wa('userShare',{share_type:1,sku_id:obj.skuId});}};}};ItemDet.prototype.item=function(){if(!this.skuJson[this.skuId]||!this.skuJson[this.skuId].item){JD.report.umpBiz({bizid:bizid,operation:'15',result:'9',source:'0',message:'itemerror'+this.skuId});return{};}
return this.skuJson[this.skuId].item;};ItemDet.prototype.isSpecSku=function(){if(window._itemSpecSkus&&window._itemSpecSkus.length>0){var specskus=window._itemSpecSkus[0].skuList||'';return!!~('|'+specskus+'|').indexOf('|'+this.skuId+'|');}
return false;};ItemDet.prototype.getNewSkuUrl=function(skuId,jxgeneralParam,ptag){var retUrl='//item.m.jd.com/product/'+skuId+'.html';if(jxgeneralParam)retUrl+='?jxgeneral='+jxgeneralParam;if(ptag){if(jxgeneralParam){retUrl+='&ptag='+ptag;}else{retUrl+='?ptag='+ptag;}}
return retUrl;};ItemDet.prototype.getPingouurl=function(url,ptag){var obj=this,sku=JD.url.getUrlParam("sku",url),pps=JD.url.getUrlParam("pps",url);if(!sku&&~url.indexOf('m.jd.com')){var matchResult=url.match(/(\d+).html/);sku=matchResult&&matchResult[1]||'';}
var _url=obj.isM?getMItemLink(sku,ptag):getItemLink(sku,ptag);if(pps){_url=JD.url.addUrlParam(_url,{'pps':pps});}
if(obj.isJDAPP){_url=JD.url.addUrlParam(_url,{'has_native':0});}
return _url;}
ItemDet.prototype.loadScriptJs=function(opt){opt=opt||{};var tag=opt.tag,url=opt.url;if(!this.loadJsObj)this.loadJsObj={};if(this.loadJsObj[tag])return;this.loadJsObj[tag]=true;var scriptJs=document.createElement('script');scriptJs.src=url;document.body.appendChild(scriptJs);};ItemDet.prototype.scrollTo=function(options){var defaults={toTop:0,delay:500,frameTime:30,callback:null,$dom:$(window)};var opts=$.extend(defaults,options),timer=null,_this=opts.$dom,curTop=_this.scrollTop(),subTop=opts.toTop-curTop,index=0,dur=Math.round(opts.delay/opts.frameTime),smoothScroll=function(top){index++;var per=(subTop/dur);if(index>=dur){_this.scrollTop(top);window.clearInterval(timer);if(opts.callback&&typeof opts.callback=='function'){opts.callback();}
return;}else{_this.scrollTop(curTop+index*per);}};timer=window.setInterval(function(){smoothScroll(opts.toTop);},opts.frameTime);};ItemDet.prototype.scrollToBlock=function(domid,offset){var obj=this,se=$('#'+domid),offset=offset||0;if(se&&se.length>0){var top=se.position().top+offset;top=top<0?0:top+0.5;if(top!=0&&$('.banner').length){top+=2;offset+=2;}
if($(window).scrollTop()==0&&$('#content').length>0&&$('#content')[0].style.display!='none'){top-=$('#content').height();}
obj.scrollTo({toTop:top,delay:270});}};ItemDet.prototype.slide=function(options){var $dom=options.$dom,type=options.type||'out',height=options.height||0,delay=options.delay||1;if($dom&&$dom.length){if(type=='out'){$dom.attr('style','-webkit-transform: translateY(-'+height+'px);transform:translateY(-'+height+'px);-webkit-transition: transform '+delay+'s ease-in;transition: transform '+delay+'s ease-in;');}else{$dom.attr('style','-webkit-transform: translateY('+height+'px);transform:translateY('+height+'px);-webkit-transition: transform '+delay+'s ease-in;transition: transform '+delay+'s ease-in;');}}};ItemDet.prototype.setInputValue=function(opt){if(!opt)return;var inputReg=/\ud83c[\udc00-\udfff]|\ud83d[\udc00-\udfff]|[\u2000-\u2fff]/g;opt.val=(opt.val||'').replace(inputReg,'');if(opt.maxNum>0&&opt.val.length>opt.maxNum)return;if(opt.$dom){opt.$dom.val(opt.val);}};ItemDet.prototype.xss=function(str,type){if(!str){return str===0?"0":"";}
switch(type){case"none":return str+"";case"html":return str.replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"}).replace(/ /g,"&nbsp;").replace(/\r\n/g,"<br />").replace(/\n/g,"<br />").replace(/\r/g,"<br />");case"htmlEp":return str.replace(/[&'"<>\/\\\-\x00-\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"});case"url":return escape(str).replace(/\+/g,"%2B");case"miniUrl":return str.replace(/%/g,"%25");case"script":return str.replace(/[\\"']/g,function(r){return"\\"+r;}).replace(/%/g,"\\x25").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\x01/g,"\\x01");case"reg":return str.replace(/[\\\^\$\*\+\?\{\}\.\(\)\[\]]/g,function(a){return"\\"+a;});default:return escape(str).replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"}).replace(/ /g,"&nbsp;").replace(/\r\n/g,"<br />").replace(/\n/g,"<br />").replace(/\r/g,"<br />");}};ItemDet.prototype.throttle=function(method,context,delay,opt){opt=opt||{};var firstDo=opt.firstDo,param=opt.param;if(firstDo){if(method.tId){clearTimeout(method.tId);method.tId=setTimeout(function(){method.tId=0;method.apply(context,param);},delay);}else{method.tId=1;method.apply(context,param);}}else{clearTimeout(method.tId);method.tId=setTimeout(function(){method.apply(context,param);},delay);}};exports.init=function(){var item=new ItemDet();item.init();};});
modulejs("m.itemV2",function(mItemEnter){
    mItemEnter.init();
});