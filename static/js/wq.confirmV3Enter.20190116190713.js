define("zepto",function(require,exports,t){var _cacheThisModule_;var e=function(){var t,e,n,i,r=[],o=r.concat,a=r.filter,s=r.slice,u=window.document,f={},c={},l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},h=/^\s*<(\w+|!)[^>]*>/,p=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,d=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,m=/^(?:body|html)$/i,v=/([A-Z])/g,g=["val","css","html","text","data","width","height","offset"],y=["after","prepend","before","append"],b=u.createElement("table"),w=u.createElement("tr"),x={tr:u.createElement("tbody"),tbody:b,thead:b,tfoot:b,td:w,th:w,"*":u.createElement("div")},E=/complete|loaded|interactive/,T=/^[\w-]*$/,S={},j=S.toString,C={},O,N,A=u.createElement("div"),P={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},M=Array.isArray||function(t){return t instanceof Array};C.matches=function(t,e){if(!e||!t||t.nodeType!==1)return false;var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(n)return n.call(t,e);var i,r=t.parentNode,o=!r;if(o)(r=A).appendChild(t);i=~C.qsa(r,e).indexOf(t);o&&A.removeChild(t);return i};function D(t){return t==null?String(t):S[j.call(t)]||"object"}function k(t){return D(t)=="function"}function F(t){return t!=null&&t==t.window}function L(t){return t!=null&&t.nodeType==t.DOCUMENT_NODE}function $(t){return D(t)=="object"}function R(t){return $(t)&&!F(t)&&Object.getPrototypeOf(t)==Object.prototype}function _(t){var e=!!t&&"length"in t&&t.length,i=n.type(t);return"function"!=i&&!F(t)&&("array"==i||e===0||typeof e=="number"&&e>0&&e-1 in t)}function q(t){return a.call(t,function(t){return t!=null})}function z(t){return t.length>0?n.fn.concat.apply([],t):t}O=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})};function I(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}N=function(t){return a.call(t,function(e,n){return t.indexOf(e)==n})};function W(t){return t in c?c[t]:c[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function Z(t,e){return typeof e=="number"&&!l[I(t)]?e+"px":e}function B(t){var e,n;if(!f[t]){e=u.createElement(t);u.body.appendChild(e);n=getComputedStyle(e,"").getPropertyValue("display");e.parentNode.removeChild(e);n=="none"&&(n="block");f[t]=n}return f[t]}function V(t){return"children"in t?s.call(t.children):n.map(t.childNodes,function(t){if(t.nodeType==1)return t})}function H(t,e){var n,i=t?t.length:0;for(n=0;n<i;n++)this[n]=t[n];this.length=i;this.selector=e||""}C.fragment=function(e,i,r){var o,a,f;if(p.test(e))o=n(u.createElement(RegExp.$1));if(!o){if(e.replace)e=e.replace(d,"<$1></$2>");if(i===t)i=h.test(e)&&RegExp.$1;if(!(i in x))i="*";f=x[i];f.innerHTML=""+e;o=n.each(s.call(f.childNodes),function(){f.removeChild(this)})}if(R(r)){a=n(o);n.each(r,function(t,e){if(g.indexOf(t)>-1)a[t](e);else a.attr(t,e)})}return o};C.Z=function(t,e){return new H(t,e)};C.isZ=function(t){return t instanceof C.Z};C.init=function(e,i){var r;if(!e)return C.Z();else if(typeof e=="string"){e=e.trim();if(e[0]=="<"&&h.test(e))r=C.fragment(e,RegExp.$1,i),e=null;else if(i!==t)return n(i).find(e);else r=C.qsa(u,e)}else if(k(e))return n(u).ready(e);else if(C.isZ(e))return e;else{if(M(e))r=q(e);else if($(e))r=[e],e=null;else if(h.test(e))r=C.fragment(e.trim(),RegExp.$1,i),e=null;else if(i!==t)return n(i).find(e);else r=C.qsa(u,e)}return C.Z(r,e)};n=function(t,e){return C.init(t,e)};function U(n,i,r){for(e in i)if(r&&(R(i[e])||M(i[e]))){if(R(i[e])&&!R(n[e]))n[e]={};if(M(i[e])&&!M(n[e]))n[e]=[];U(n[e],i[e],r)}else if(i[e]!==t)n[e]=i[e]}n.extend=function(t){var e,n=s.call(arguments,1);if(typeof t=="boolean"){e=t;t=n.shift()}n.forEach(function(n){U(t,n,e)});return t};C.qsa=function(t,e){var n,i=e[0]=="#",r=!i&&e[0]==".",o=i||r?e.slice(1):e,a=T.test(o);return t.getElementById&&a&&i?(n=t.getElementById(o))?[n]:[]:t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11?[]:s.call(a&&!i&&t.getElementsByClassName?r?t.getElementsByClassName(o):t.getElementsByTagName(e):t.querySelectorAll(e))};function X(t,e){return e==null?n(t):n(t).filter(e)}n.contains=u.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){while(e&&(e=e.parentNode))if(e===t)return true;return false};function Y(t,e,n,i){return k(e)?e.call(t,n,i):e}function G(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function J(e,n){var i=e.className||"",r=i&&i.baseVal!==t;if(n===t)return r?i.baseVal:i;r?i.baseVal=n:e.className=n}function K(t){try{return t?t=="true"||(t=="false"?false:t=="null"?null:+t+""==t?+t:/^[\[\{]/.test(t)?n.parseJSON(t):t):t}catch(e){return t}}n.type=D;n.isFunction=k;n.isWindow=F;n.isArray=M;n.isPlainObject=R;n.isEmptyObject=function(t){var e;for(e in t)return false;return true};n.isNumeric=function(t){var e=Number(t),n=typeof t;return t!=null&&n!="boolean"&&(n!="string"||t.length)&&!isNaN(e)&&isFinite(e)||false};n.inArray=function(t,e,n){return r.indexOf.call(e,t,n)};n.camelCase=O;n.trim=function(t){return t==null?"":String.prototype.trim.call(t)};n.uuid=0;n.support={};n.expr={};n.noop=function(){};n.map=function(t,e){var n,i=[],r,o;if(_(t))for(r=0;r<t.length;r++){n=e(t[r],r);if(n!=null)i.push(n)}else for(o in t){n=e(t[o],o);if(n!=null)i.push(n)}return z(i)};n.each=function(t,e){var n,i;if(_(t)){for(n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===false)return t}else{for(i in t)if(e.call(t[i],i,t[i])===false)return t}return t};n.grep=function(t,e){return a.call(t,e)};if(window.JSON)n.parseJSON=JSON.parse;n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){S["[object "+e+"]"]=e.toLowerCase()});n.fn={constructor:C.Z,length:0,forEach:r.forEach,reduce:r.reduce,push:r.push,sort:r.sort,splice:r.splice,indexOf:r.indexOf,concat:function(){var t,e,n=[];for(t=0;t<arguments.length;t++){e=arguments[t];n[t]=C.isZ(e)?e.toArray():e}return o.apply(C.isZ(this)?this.toArray():this,n)},map:function(t){return n(n.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(t){if(E.test(u.readyState)&&u.body)t(n);else u.addEventListener("DOMContentLoaded",function(){t(n)},false);return this},get:function(e){return e===t?s.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){if(this.parentNode!=null)this.parentNode.removeChild(this)})},each:function(t){r.every.call(this,function(e,n){return t.call(e,n,e)!==false});return this},filter:function(t){if(k(t))return this.not(this.not(t));return n(a.call(this,function(e){return C.matches(e,t)}))},add:function(t,e){return n(N(this.concat(n(t,e))))},is:function(t){return this.length>0&&C.matches(this[0],t)},not:function(e){var i=[];if(k(e)&&e.call!==t)this.each(function(t){if(!e.call(this,t))i.push(this)});else{var r=typeof e=="string"?this.filter(e):_(e)&&k(e.item)?s.call(e):n(e);this.forEach(function(t){if(r.indexOf(t)<0)i.push(t)})}return n(i)},has:function(t){return this.filter(function(){return $(t)?n.contains(this,t):n(this).find(t).size()})},eq:function(t){return t===-1?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!$(t)?t:n(t)},last:function(){var t=this[this.length-1];return t&&!$(t)?t:n(t)},find:function(t){var e,i=this;if(!t)e=n();else if(typeof t=="object")e=n(t).filter(function(){var t=this;return r.some.call(i,function(e){return n.contains(e,t)})});else if(this.length==1)e=n(C.qsa(this[0],t));else e=this.map(function(){return C.qsa(this,t)});return e},closest:function(t,e){var i=[],r=typeof t=="object"&&n(t);this.each(function(n,o){while(o&&!(r?r.indexOf(o)>=0:C.matches(o,t)))o=o!==e&&!L(o)&&o.parentNode;if(o&&i.indexOf(o)<0)i.push(o)});return n(i)},parents:function(t){var e=[],i=this;while(i.length>0)i=n.map(i,function(t){if((t=t.parentNode)&&!L(t)&&e.indexOf(t)<0){e.push(t);return t}});return X(e,t)},parent:function(t){return X(N(this.pluck("parentNode")),t)},children:function(t){return X(this.map(function(){return V(this)}),t)},contents:function(){return this.map(function(){return this.contentDocument||s.call(this.childNodes)})},siblings:function(t){return X(this.map(function(t,e){return a.call(V(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return n.map(this,function(e){return e[t]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display="");if(getComputedStyle(this,"").getPropertyValue("display")=="none")this.style.display=B(this.nodeName)})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var e=k(t);if(this[0]&&!e)var i=n(t).get(0),r=i.parentNode||this.length>1;return this.each(function(o){n(this).wrapAll(e?t.call(this,o):r?i.cloneNode(true):i)})},wrapAll:function(t){if(this[0]){n(this[0]).before(t=n(t));var e;while((e=t.children()).length)t=e.first();n(t).append(this)}return this},wrapInner:function(t){var e=k(t);return this.each(function(i){var r=n(this),o=r.contents(),a=e?t.call(this,i):t;o.length?o.wrapAll(a):r.append(a)})},unwrap:function(){this.parent().each(function(){n(this).replaceWith(n(this).children())});return this},clone:function(){return this.map(function(){return this.cloneNode(true)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var i=n(this);(e===t?i.css("display")=="none":e)?i.show():i.hide()})},prev:function(t){return n(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return n(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var i=this.innerHTML;n(this).empty().append(Y(this,t,e,i))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var n=Y(this,t,e,this.textContent);this.textContent=n==null?"":""+n}):0 in this?this.pluck("textContent").join(""):null},attr:function(n,i){var r;return typeof n=="string"&&!(1 in arguments)?0 in this&&this[0].nodeType==1&&(r=this[0].getAttribute(n))!=null?r:t:this.each(function(t){if(this.nodeType!==1)return;if($(n))for(e in n)G(this,e,n[e]);else G(this,n,Y(this,i,t,this.getAttribute(n)))})},removeAttr:function(t){return this.each(function(){this.nodeType===1&&t.split(" ").forEach(function(t){G(this,t)},this)})},prop:function(t,e){t=P[t]||t;return 1 in arguments?this.each(function(n){this[t]=Y(this,e,n,this[t])}):this[0]&&this[0][t]},removeProp:function(t){t=P[t]||t;return this.each(function(){delete this[t]})},data:function(e,n){var i="data-"+e.replace(v,"-$1").toLowerCase();var r=1 in arguments?this.attr(i,n):this.attr(i);return r!==null?K(r):t},val:function(t){if(0 in arguments){if(t==null)t="";return this.each(function(e){this.value=Y(this,t,e,this.value)})}else{return this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)}},offset:function(t){if(t)return this.each(function(e){var i=n(this),r=Y(this,t,e,i.offset()),o=i.offsetParent().offset(),a={top:r.top-o.top,left:r.left-o.left};if(i.css("position")=="static")a["position"]="relative";i.css(a)});if(!this.length)return null;if(u.documentElement!==this[0]&&!n.contains(u.documentElement,this[0]))return{top:0,left:0};var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(t,i){if(arguments.length<2){var r=this[0];if(typeof t=="string"){if(!r)return;return r.style[O(t)]||getComputedStyle(r,"").getPropertyValue(t)}else if(M(t)){if(!r)return;var o={};var a=getComputedStyle(r,"");n.each(t,function(t,e){o[e]=r.style[O(e)]||a.getPropertyValue(e)});return o}}var s="";if(D(t)=="string"){if(!i&&i!==0)this.each(function(){this.style.removeProperty(I(t))});else s=I(t)+":"+Z(t,i)}else{for(e in t)if(!t[e]&&t[e]!==0)this.each(function(){this.style.removeProperty(I(e))});else s+=I(e)+":"+Z(e,t[e])+";"}return this.each(function(){this.style.cssText+=";"+s})},index:function(t){return t?this.indexOf(n(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){if(!t)return false;return r.some.call(this,function(t){return this.test(J(t))},W(t))},addClass:function(t){if(!t)return this;return this.each(function(e){if(!("className"in this))return;i=[];var r=J(this),o=Y(this,t,e,r);o.split(/\s+/g).forEach(function(t){if(!n(this).hasClass(t))i.push(t)},this);i.length&&J(this,r+(r?" ":"")+i.join(" "))})},removeClass:function(e){return this.each(function(n){if(!("className"in this))return;if(e===t)return J(this,"");i=J(this);Y(this,e,n,i).split(/\s+/g).forEach(function(t){i=i.replace(W(t)," ")});J(this,i.trim())})},toggleClass:function(e,i){if(!e)return this;return this.each(function(r){var o=n(this),a=Y(this,e,r,J(this));a.split(/\s+/g).forEach(function(e){(i===t?!o.hasClass(e):i)?o.addClass(e):o.removeClass(e)})})},scrollTop:function(e){if(!this.length)return;var n="scrollTop"in this[0];if(e===t)return n?this[0].scrollTop:this[0].pageYOffset;return this.each(n?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})},scrollLeft:function(e){if(!this.length)return;var n="scrollLeft"in this[0];if(e===t)return n?this[0].scrollLeft:this[0].pageXOffset;return this.each(n?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})},position:function(){if(!this.length)return;var t=this[0],e=this.offsetParent(),i=this.offset(),r=m.test(e[0].nodeName)?{top:0,left:0}:e.offset();i.top-=parseFloat(n(t).css("margin-top"))||0;i.left-=parseFloat(n(t).css("margin-left"))||0;r.top+=parseFloat(n(e[0]).css("border-top-width"))||0;r.left+=parseFloat(n(e[0]).css("border-left-width"))||0;return{top:i.top-r.top,left:i.left-r.left}},offsetParent:function(){return this.map(function(){var t=this.offsetParent||u.body;while(t&&!m.test(t.nodeName)&&n(t).css("position")=="static")t=t.offsetParent;return t})}};n.fn.detach=n.fn.remove;["width","height"].forEach(function(e){var i=e.replace(/./,function(t){return t[0].toUpperCase()});n.fn[e]=function(r){var o,a=this[0];if(r===t)return F(a)?a["inner"+i]:L(a)?a.documentElement["scroll"+i]:(o=this.offset())&&o[e];else return this.each(function(t){a=n(this);a.css(e,Y(this,r,t,a[e]()))})}});function Q(t,e){e(t);for(var n=0,i=t.childNodes.length;n<i;n++)Q(t.childNodes[n],e)}y.forEach(function(e,i){var r=i%2;n.fn[e]=function(){var e,o=n.map(arguments,function(i){var r=[];e=D(i);if(e=="array"){i.forEach(function(e){if(e.nodeType!==t)return r.push(e);else if(n.zepto.isZ(e))return r=r.concat(e.get());r=r.concat(C.fragment(e))});return r}return e=="object"||i==null?i:C.fragment(i)}),a,s=this.length>1;if(o.length<1)return this;return this.each(function(t,e){a=r?e:e.parentNode;e=i==0?e.nextSibling:i==1?e.firstChild:i==2?e:null;var f=n.contains(u.documentElement,a);o.forEach(function(t){if(s)t=t.cloneNode(true);else if(!a)return n(t).remove();a.insertBefore(t,e);if(f)Q(t,function(t){if(t.nodeName!=null&&t.nodeName.toUpperCase()==="SCRIPT"&&(!t.type||t.type==="text/javascript")&&!t.src){var e=t.ownerDocument?t.ownerDocument.defaultView:window;e["eval"].call(e,t.innerHTML)}})})})};n.fn[r?e+"To":"insert"+(i?"Before":"After")]=function(t){n(t)[e](this);return this}});C.Z.prototype=H.prototype=n.fn;C.uniq=N;C.deserializeValue=K;n.zepto=C;return n}();window.Zepto=e;window.$===undefined&&(window.$=e);(function(t){var e=1,n,i=Array.prototype.slice,r=t.isFunction,o=function(t){return typeof t=="string"},a={},s={},u="onfocusin"in window,f={focus:"focusin",blur:"focusout"},c={mouseenter:"mouseover",mouseleave:"mouseout"};s.click=s.mousedown=s.mouseup=s.mousemove="MouseEvents";function l(t){return t._zid||(t._zid=e++)}function h(t,e,n,i){e=p(e);if(e.ns)var r=d(e.ns);return(a[l(t)]||[]).filter(function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||r.test(t.ns))&&(!n||l(t.fn)===l(n))&&(!i||t.sel==i)})}function p(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function d(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function m(t,e){return t.del&&(!u&&t.e in f)||!!e}function v(t){return c[t]||u&&f[t]||t}function g(e,i,r,o,s,u,f){var h=l(e),d=a[h]||(a[h]=[]);i.split(/\s/).forEach(function(i){if(i=="ready")return t(document).ready(r);var a=p(i);a.fn=r;a.sel=s;if(a.e in c)r=function(e){var n=e.relatedTarget;if(!n||n!==this&&!t.contains(this,n))return a.fn.apply(this,arguments)};a.del=u;var l=u||r;a.proxy=function(t){t=T(t);if(t.isImmediatePropagationStopped())return;t.data=o;var i=l.apply(e,t._args==n?[t]:[t].concat(t._args));if(i===false)t.preventDefault(),t.stopPropagation();return i};a.i=d.length;d.push(a);if("addEventListener"in e)e.addEventListener(v(a.e),a.proxy,m(a,f))})}function y(t,e,n,i,r){var o=l(t);(e||"").split(/\s/).forEach(function(e){h(t,e,n,i).forEach(function(e){delete a[o][e.i];if("removeEventListener"in t)t.removeEventListener(v(e.e),e.proxy,m(e,r))})})}t.event={add:g,remove:y};t.proxy=function(e,n){var a=2 in arguments&&i.call(arguments,2);if(r(e)){var s=function(){return e.apply(n,a?a.concat(i.call(arguments)):arguments)};s._zid=l(e);return s}else if(o(n)){if(a){a.unshift(e[n],e);return t.proxy.apply(null,a)}else{return t.proxy(e[n],e)}}else{throw new TypeError("expected function")}};t.fn.bind=function(t,e,n){return this.on(t,e,n)};t.fn.unbind=function(t,e){return this.off(t,e)};t.fn.one=function(t,e,n,i){return this.on(t,e,n,i,1)};var b=function(){return true},w=function(){return false},x=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,E={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function T(e,i){if(i||!e.isDefaultPrevented){i||(i=e);t.each(E,function(t,n){var r=i[t];e[t]=function(){this[n]=b;return r&&r.apply(i,arguments)};e[n]=w});e.timeStamp||(e.timeStamp=Date.now());if(i.defaultPrevented!==n?i.defaultPrevented:"returnValue"in i?i.returnValue===false:i.getPreventDefault&&i.getPreventDefault())e.isDefaultPrevented=b}return e}function S(t){var e,i={originalEvent:t};for(e in t)if(!x.test(e)&&t[e]!==n)i[e]=t[e];return T(i,t)}t.fn.delegate=function(t,e,n){return this.on(e,t,n)};t.fn.undelegate=function(t,e,n){return this.off(e,t,n)};t.fn.live=function(e,n){t(document.body).delegate(this.selector,e,n);return this};t.fn.die=function(e,n){t(document.body).undelegate(this.selector,e,n);return this};t.fn.on=function(e,a,s,u,f){var c,l,h=this;if(e&&!o(e)){t.each(e,function(t,e){h.on(t,a,s,e,f)});return h}if(!o(a)&&!r(u)&&u!==false)u=s,s=a,a=n;if(u===n||s===false)u=s,s=n;if(u===false)u=w;return h.each(function(n,r){if(f)c=function(t){y(r,t.type,u);return u.apply(this,arguments)};if(a)l=function(e){var n,o=t(e.target).closest(a,r).get(0);if(o&&o!==r){n=t.extend(S(e),{currentTarget:o,liveFired:r});return(c||u).apply(o,[n].concat(i.call(arguments,1)))}};g(r,e,u,s,a,l||c)})};t.fn.off=function(e,i,a){var s=this;if(e&&!o(e)){t.each(e,function(t,e){s.off(t,i,e)});return s}if(!o(i)&&!r(a)&&a!==false)a=i,i=n;if(a===false)a=w;return s.each(function(){y(this,e,a,i)})};t.fn.trigger=function(e,n){e=o(e)||t.isPlainObject(e)?t.Event(e):T(e);e._args=n;return this.each(function(){if(e.type in f&&typeof this[e.type]=="function")this[e.type]();else if("dispatchEvent"in this)this.dispatchEvent(e);else t(this).triggerHandler(e,n)})};t.fn.triggerHandler=function(e,n){var i,r;this.each(function(a,s){i=S(o(e)?t.Event(e):e);i._args=n;i.target=s;t.each(h(s,e.type||e),function(t,e){r=e.proxy(i);if(i.isImmediatePropagationStopped())return false})});return r};("focusin focusout focus blur load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select keydown keypress keyup error").split(" ").forEach(function(e){t.fn[e]=function(t){return 0 in arguments?this.bind(e,t):this.trigger(e)}});t.Event=function(t,e){if(!o(t))e=t,t=e.type;var n=document.createEvent(s[t]||"Events"),i=true;if(e)for(var r in e)r=="bubbles"?i=!!e[r]:n[r]=e[r];n.initEvent(t,i,true);return T(n)}})(e);(function(t){var e=+new Date,n=window.document,i,r,o=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,a=/^(?:text|application)\/javascript/i,s=/^(?:text|application)\/xml/i,u="application/json",f="text/html",c=/^\s*$/,l=n.createElement("a");l.href=window.location.href;function h(e,n,i){var r=t.Event(n);t(e).trigger(r,i);return!r.isDefaultPrevented()}function p(t,e,i,r){if(t.global)return h(e||n,i,r)}t.active=0;function d(e){if(e.global&&t.active++===0)p(e,null,"ajaxStart")}function m(e){if(e.global&&!--t.active)p(e,null,"ajaxStop")}function v(t,e){var n=e.context;if(e.beforeSend.call(n,t,e)===false||p(e,n,"ajaxBeforeSend",[t,e])===false)return false;p(e,n,"ajaxSend",[t,e])}function g(t,e,n,i){var r=n.context,o="success";n.success.call(r,t,o,e);if(i)i.resolveWith(r,[t,o,e]);p(n,r,"ajaxSuccess",[e,n,t]);b(o,e,n)}function y(t,e,n,i,r){var o=i.context;i.error.call(o,n,e,t);if(r)r.rejectWith(o,[n,e,t]);p(i,o,"ajaxError",[n,i,t||e]);b(e,n,i)}function b(t,e,n){var i=n.context;n.complete.call(i,e,t);p(n,i,"ajaxComplete",[e,n]);m(n)}function w(t,e,n){if(n.dataFilter==x)return t;var i=n.context;return n.dataFilter.call(i,t,e)}function x(){}t.ajaxJSONP=function(i,r){if(!("type"in i))return t.ajax(i);var o=i.jsonpCallback,a=(t.isFunction(o)?o():o)||"Zepto"+e++,s=n.createElement("script"),u=window[a],f,c=function(e){t(s).triggerHandler("error",e||"abort")},l={abort:c},h;if(r)r.promise(l);t(s).on("load error",function(e,n){clearTimeout(h);t(s).off().remove();if(e.type=="error"||!f){y(null,n||"error",l,i,r)}else{g(f[0],l,i,r)}window[a]=u;if(f&&t.isFunction(u))u(f[0]);u=f=undefined});if(v(l,i)===false){c("abort");return l}window[a]=function(){f=arguments};s.src=i.url.replace(/\?(.+)=\?/,"?$1="+a);n.head.appendChild(s);if(i.timeout>0)h=setTimeout(function(){c("timeout")},i.timeout);return l};t.ajaxSettings={type:"GET",beforeSend:x,success:x,error:x,complete:x,context:null,global:true,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:u,xml:"application/xml, text/xml",html:f,text:"text/plain"},crossDomain:false,timeout:0,processData:true,cache:true,dataFilter:x};function E(t){if(t)t=t.split(";",2)[0];return t&&(t==f?"html":t==u?"json":a.test(t)?"script":s.test(t)&&"xml")||"text"}function T(t,e){if(e=="")return t;return(t+"&"+e).replace(/[&?]{1,2}/,"?")}function S(e){if(e.processData&&e.data&&t.type(e.data)!="string")e.data=t.param(e.data,e.traditional);if(e.data&&(!e.type||e.type.toUpperCase()=="GET"||"jsonp"==e.dataType))e.url=T(e.url,e.data),e.data=undefined}t.ajax=function(e){var o=t.extend({},e||{}),a=t.Deferred&&t.Deferred(),s,u;for(i in t.ajaxSettings)if(o[i]===undefined)o[i]=t.ajaxSettings[i];d(o);if(!o.crossDomain){s=n.createElement("a");s.href=o.url;s.href=s.href;o.crossDomain=l.protocol+"//"+l.host!==s.protocol+"//"+s.host}if(!o.url)o.url=window.location.toString();if((u=o.url.indexOf("#"))>-1)o.url=o.url.slice(0,u);S(o);var f=o.dataType,h=/\?.+=\?/.test(o.url);if(h)f="jsonp";if(o.cache===false||(!e||e.cache!==true)&&("script"==f||"jsonp"==f))o.url=T(o.url,"_="+Date.now());if("jsonp"==f){if(!h)o.url=T(o.url,o.jsonp?o.jsonp+"=?":o.jsonp===false?"":"callback=?");return t.ajaxJSONP(o,a)}var p=o.accepts[f],m={},b=function(t,e){m[t.toLowerCase()]=[t,e]},j=/^([\w-]+:)\/\//.test(o.url)?RegExp.$1:window.location.protocol,C=o.xhr(),O=C.setRequestHeader,N;if(a)a.promise(C);if(!o.crossDomain)b("X-Requested-With","XMLHttpRequest");b("Accept",p||"*/*");if(p=o.mimeType||p){if(p.indexOf(",")>-1)p=p.split(",",2)[0];C.overrideMimeType&&C.overrideMimeType(p)}if(o.contentType||o.contentType!==false&&o.data&&o.type.toUpperCase()!="GET")b("Content-Type",o.contentType||"application/x-www-form-urlencoded");if(o.headers)for(r in o.headers)b(r,o.headers[r]);C.setRequestHeader=b;C.onreadystatechange=function(){if(C.readyState==4){C.onreadystatechange=x;clearTimeout(N);var e,n=false;if(C.status>=200&&C.status<300||C.status==304||C.status==0&&j=="file:"){f=f||E(o.mimeType||C.getResponseHeader("content-type"));if(C.responseType=="arraybuffer"||C.responseType=="blob")e=C.response;else{e=C.responseText;try{e=w(e,f,o);if(f=="script")(1,eval)(e);else if(f=="xml")e=C.responseXML;else if(f=="json")e=c.test(e)?null:t.parseJSON(e)}catch(i){n=i}if(n)return y(n,"parsererror",C,o,a)}g(e,C,o,a)}else{y(C.statusText||null,C.status?"error":"abort",C,o,a)}}};if(v(C,o)===false){C.abort();y(null,"abort",C,o,a);return C}var A="async"in o?o.async:true;C.open(o.type,o.url,A,o.username,o.password);if(o.xhrFields)for(r in o.xhrFields)C[r]=o.xhrFields[r];for(r in m)O.apply(C,m[r]);if(o.timeout>0)N=setTimeout(function(){C.onreadystatechange=x;C.abort();y(null,"timeout",C,o,a)},o.timeout);C.send(o.data?o.data:null);return C};function j(e,n,i,r){if(t.isFunction(n))r=i,i=n,n=undefined;if(!t.isFunction(i))r=i,i=undefined;return{url:e,data:n,success:i,dataType:r}}t.get=function(){return t.ajax(j.apply(null,arguments))};t.post=function(){var e=j.apply(null,arguments);e.type="POST";return t.ajax(e)};t.getJSON=function(){var e=j.apply(null,arguments);e.dataType="json";return t.ajax(e)};t.fn.load=function(e,n,i){if(!this.length)return this;var r=this,a=e.split(/\s/),s,u=j(e,n,i),f=u.success;if(a.length>1)u.url=a[0],s=a[1];u.success=function(e){r.html(s?t("<div>").html(e.replace(o,"")).find(s):e);f&&f.apply(r,arguments)};t.ajax(u);return this};var C=encodeURIComponent;function O(e,n,i,r){var o,a=t.isArray(n),s=t.isPlainObject(n);t.each(n,function(n,u){o=t.type(u);if(r)n=i?r:r+"["+(s||o=="object"||o=="array"?n:"")+"]";if(!r&&a)e.add(u.name,u.value);else if(o=="array"||!i&&o=="object")O(e,u,i,n);else e.add(n,u)})}t.param=function(e,n){var i=[];i.add=function(e,n){if(t.isFunction(n))n=n();if(n==null)n="";this.push(C(e)+"="+C(n))};O(i,e,n);return i.join("&").replace(/%20/g,"+")}})(e);(function(t){t.fn.serializeArray=function(){var e,n,i=[],r=function(t){if(t.forEach)return t.forEach(r);i.push({name:e,value:t})};if(this[0])t.each(this[0].elements,function(i,o){n=o.type,e=o.name;if(e&&o.nodeName.toLowerCase()!="fieldset"&&!o.disabled&&n!="submit"&&n!="reset"&&n!="button"&&n!="file"&&(n!="radio"&&n!="checkbox"||o.checked))r(t(o).val())});return i};t.fn.serialize=function(){var t=[];this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))});return t.join("&")};t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n);if(!n.isDefaultPrevented())this.get(0).submit()}return this}})(e);(function(){try{getComputedStyle(undefined)}catch(t){var e=getComputedStyle;window.getComputedStyle=function(t,n){try{return e(t,n)}catch(i){return null}}}})();(function(t){function e(t,e){var n=this.os={},i=this.browser={},r=t.match(/Web[kK]it[\/]{0,1}([\d.]+)/),o=t.match(/(Android);?[\s\/]+([\d.]+)?/),a=!!t.match(/\(Macintosh\; Intel /),s=t.match(/(iPad).*OS\s([\d_]+)/),u=t.match(/(iPod)(.*OS\s([\d_]+))?/),f=!s&&t.match(/(iPhone\sOS)\s([\d_]+)/),c=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),l=/Win\d{2}|Windows/.test(e),h=t.match(/Windows Phone ([\d.]+)/),p=c&&t.match(/TouchPad/),d=t.match(/Kindle\/([\d.]+)/),m=t.match(/Silk\/([\d._]+)/),v=t.match(/(BlackBerry).*Version\/([\d.]+)/),g=t.match(/(BB10).*Version\/([\d.]+)/),y=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),b=t.match(/PlayBook/),w=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),x=t.match(/Firefox\/([\d.]+)/),E=t.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),T=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),S=!w&&t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),j=S||t.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);if(i.webkit=!!r)i.version=r[1];if(o)n.android=true,n.version=o[2];if(f&&!u)n.ios=n.iphone=true,n.version=f[2].replace(/_/g,".");if(s)n.ios=n.ipad=true,n.version=s[2].replace(/_/g,".");if(u)n.ios=n.ipod=true,n.version=u[3]?u[3].replace(/_/g,"."):null;if(h)n.wp=true,n.version=h[1];if(c)n.webos=true,n.version=c[2];if(p)n.touchpad=true;if(v)n.blackberry=true,n.version=v[2];if(g)n.bb10=true,n.version=g[2];if(y)n.rimtabletos=true,n.version=y[2];if(b)i.playbook=true;if(d)n.kindle=true,n.version=d[1];if(m)i.silk=true,i.version=m[1];if(!m&&n.android&&t.match(/Kindle Fire/))i.silk=true;if(w)i.chrome=true,i.version=w[1];if(x)i.firefox=true,i.version=x[1];if(E)n.firefoxos=true,n.version=E[1];if(T)i.ie=true,i.version=T[1];if(j&&(a||n.ios||l)){i.safari=true;if(!n.ios)i.version=j[1]}if(S)i.webview=true;n.tablet=!!(s||b||o&&!t.match(/Mobile/)||x&&t.match(/Tablet/)||T&&!t.match(/Phone/)&&t.match(/Touch/));n.phone=!!(!n.tablet&&!n.ipod&&(o||f||c||v||g||w&&t.match(/Android/)||w&&t.match(/CriOS\/([\d.]+)/)||x&&t.match(/Mobile/)||T&&t.match(/Touch/)))}e.call(t,navigator.userAgent,navigator.platform);t.__detect=e})(e);(function(t){var e=[],n;t.fn.remove=function(){return this.each(function(){if(this.parentNode){if(this.tagName==="IMG"){e.push(this);this.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";if(n)clearTimeout(n);n=setTimeout(function(){e=[]},6e4)}this.parentNode.removeChild(this)}})}})(e);(function(t){var e={},n=t.fn.data,i=t.camelCase,r=t.expando="Zepto"+ +new Date,o=[];function a(o,a){var u=o[r],f=u&&e[u];if(a===undefined)return f||s(o);else{if(f){if(a in f)return f[a];var c=i(a);if(c in f)return f[c]}return n.call(t(o),a)}}function s(n,o,a){var s=n[r]||(n[r]=++t.uuid),f=e[s]||(e[s]=u(n));if(o!==undefined)f[i(o)]=a;return f}function u(e){var n={};t.each(e.attributes||o,function(e,r){if(r.name.indexOf("data-")==0)n[i(r.name.replace("data-",""))]=t.zepto.deserializeValue(r.value)});return n}t.fn.data=function(e,n){return n===undefined?t.isPlainObject(e)?this.each(function(n,i){t.each(e,function(t,e){s(i,t,e)})}):0 in this?a(this[0],e):undefined:this.each(function(){s(this,e,n)})};t.data=function(e,n,i){return t(e).data(n,i)};t.hasData=function(n){var i=n[r],o=i&&e[i];return o?!t.isEmptyObject(o):false};t.fn.removeData=function(n){if(typeof n=="string")n=n.split(/\s+/);return this.each(function(){var o=this[r],a=o&&e[o];if(a)t.each(n||a,function(t){delete a[n?i(this):t]})})};["remove","empty"].forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=this.find("*");if(e==="remove")t=t.add(this);t.removeData();return n.call(this)}})})(e);(function(t){var e=Array.prototype.slice;function n(e){var i=[["resolve","done",t.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",t.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",t.Callbacks({memory:1})]],r="pending",o={state:function(){return r},always:function(){a.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return n(function(n){t.each(i,function(i,r){var s=t.isFunction(e[i])&&e[i];a[r[1]](function(){var e=s&&s.apply(this,arguments);if(e&&t.isFunction(e.promise)){e.promise().done(n.resolve).fail(n.reject).progress(n.notify)}else{var i=this===o?n.promise():this,a=s?[e]:arguments;n[r[0]+"With"](i,a)}})});e=null}).promise()},promise:function(e){return e!=null?t.extend(e,o):o}},a={};t.each(i,function(t,e){var n=e[2],s=e[3];o[e[1]]=n.add;if(s){n.add(function(){r=s},i[t^1][2].disable,i[2][2].lock)}a[e[0]]=function(){a[e[0]+"With"](this===a?o:this,arguments);return this};a[e[0]+"With"]=n.fireWith});o.promise(a);if(e)e.call(a,a);return a}t.when=function(i){var r=e.call(arguments),o=r.length,a=0,s=o!==1||i&&t.isFunction(i.promise)?o:0,u=s===1?i:n(),f,c,l,h=function(t,n,i){return function(r){n[t]=this;i[t]=arguments.length>1?e.call(arguments):r;if(i===f){u.notifyWith(n,i)}else if(!--s){u.resolveWith(n,i)}}};if(o>1){f=new Array(o);c=new Array(o);l=new Array(o);for(;a<o;++a){if(r[a]&&t.isFunction(r[a].promise)){r[a].promise().done(h(a,l,r)).fail(u.reject).progress(h(a,c,f))}else{
--s}}}if(!s)u.resolveWith(l,r);return u.promise()};t.Deferred=n})(e);(function(t){t.Callbacks=function(e){e=t.extend({},e);var n,i,r,o,a,s,u=[],f=!e.once&&[],c=function(t){n=e.memory&&t;i=true;s=o||0;o=0;a=u.length;r=true;for(;u&&s<a;++s){if(u[s].apply(t[0],t[1])===false&&e.stopOnFalse){n=false;break}}r=false;if(u){if(f)f.length&&c(f.shift());else if(n)u.length=0;else l.disable()}},l={add:function(){if(u){var i=u.length,s=function(n){t.each(n,function(t,n){if(typeof n==="function"){if(!e.unique||!l.has(n))u.push(n)}else if(n&&n.length&&typeof n!=="string")s(n)})};s(arguments);if(r)a=u.length;else if(n){o=i;c(n)}}return this},remove:function(){if(u){t.each(arguments,function(e,n){var i;while((i=t.inArray(n,u,i))>-1){u.splice(i,1);if(r){if(i<=a)--a;if(i<=s)--s}}})}return this},has:function(e){return!!(u&&(e?t.inArray(e,u)>-1:u.length))},empty:function(){a=u.length=0;return this},disable:function(){u=f=n=undefined;return this},disabled:function(){return!u},lock:function(){f=undefined;if(!n)l.disable();return this},locked:function(){return!f},fireWith:function(t,e){if(u&&(!i||f)){e=e||[];e=[t,e.slice?e.slice():e];if(r)f.push(e);else c(e)}return this},fire:function(){return l.fireWith(this,arguments)},fired:function(){return!!i}};return l}})(e);(function(t){var e=t.zepto,n=e.qsa,i=e.matches;function r(e){e=t(e);return!!(e.width()||e.height())&&e.css("display")!=="none"}var o=t.expr[":"]={visible:function(){if(r(this))return this},hidden:function(){if(!r(this))return this},selected:function(){if(this.selected)return this},checked:function(){if(this.checked)return this},parent:function(){return this.parentNode},first:function(t){if(t===0)return this},last:function(t,e){if(t===e.length-1)return this},eq:function(t,e,n){if(t===n)return this},contains:function(e,n,i){if(t(this).text().indexOf(i)>-1)return this},has:function(t,n,i){if(e.qsa(this,i).length)return this}};var a=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),s=/^\s*>/,u="Zepto"+ +new Date;function f(t,e){t=t.replace(/=#\]/g,'="#"]');var n,i,r=a.exec(t);if(r&&r[2]in o){n=o[r[2]],i=r[3];t=r[1];if(i){var s=Number(i);if(isNaN(s))i=i.replace(/^["']|["']$/g,"");else i=s}}return e(t,n,i)}e.qsa=function(i,r){return f(r,function(o,a,f){try{var c;if(!o&&a)o="*";else if(s.test(o))c=t(i).addClass(u),o="."+u+" "+o;var l=n(i,o)}catch(h){console.error("error performing selector: %o",r);throw h}finally{if(c)c.removeClass(u)}return!a?l:e.uniq(t.map(l,function(t,e){return a.call(t,e,l,f)}))})};e.matches=function(t,e){return f(e,function(e,n,r){return(!e||i(t,e))&&(!n||n.call(t,null,r)===t)})}})(e);(function(t){var e={},n,i,r,o,a=750,s;function u(t,e,n,i){return Math.abs(t-e)>=Math.abs(n-i)?t-e>0?"Left":"Right":n-i>0?"Up":"Down"}function f(){o=null;if(e.last){e.el.trigger("longTap");e={}}}function c(){if(o)clearTimeout(o);o=null}function l(){if(n)clearTimeout(n);if(i)clearTimeout(i);if(r)clearTimeout(r);if(o)clearTimeout(o);n=i=r=o=null;e={}}function h(t){return(t.pointerType=="touch"||t.pointerType==t.MSPOINTER_TYPE_TOUCH)&&t.isPrimary}function p(t,e){return t.type=="pointer"+e||t.type.toLowerCase()=="mspointer"+e}t(document).ready(function(){var d,m,v=0,g=0,y,b;if("MSGesture"in window){s=new MSGesture;s.target=document.body}t(document).bind("MSGestureEnd",function(t){var n=t.velocityX>1?"Right":t.velocityX<-1?"Left":t.velocityY>1?"Down":t.velocityY<-1?"Up":null;if(n){e.el.trigger("swipe");e.el.trigger("swipe"+n)}}).on("touchstart MSPointerDown pointerdown",function(i){if((b=p(i,"down"))&&!h(i))return;y=b?i:i.touches[0];if(i.touches&&i.touches.length===1&&e.x2){e.x2=undefined;e.y2=undefined}d=Date.now();m=d-(e.last||d);e.el=t("tagName"in y.target?y.target:y.target.parentNode);n&&clearTimeout(n);e.x1=y.pageX;e.y1=y.pageY;if(m>0&&m<=250)e.isDoubleTap=true;e.last=d;o=setTimeout(f,a);if(s&&b)s.addPointer(i.pointerId)}).on("touchmove MSPointerMove pointermove",function(t){if((b=p(t,"move"))&&!h(t))return;y=b?t:t.touches[0];c();e.x2=y.pageX;e.y2=y.pageY;v+=Math.abs(e.x1-e.x2);g+=Math.abs(e.y1-e.y2)}).on("touchend MSPointerUp pointerup",function(o){if((b=p(o,"up"))&&!h(o))return;c();if(e.x2&&Math.abs(e.x1-e.x2)>30||e.y2&&Math.abs(e.y1-e.y2)>30)r=setTimeout(function(){if(e.el){e.el.trigger("swipe");e.el.trigger("swipe"+u(e.x1,e.x2,e.y1,e.y2))}e={}},0);else if("last"in e)if(v<30&&g<30){i=setTimeout(function(){var i=t.Event("tap");i.pageX=e.x2||e.x1||0;i.pageY=e.y2||e.y1||0;i.cancelTouch=l;if(e.el)e.el.trigger(i);if(e.isDoubleTap){if(e.el)e.el.trigger("doubleTap");e={}}else{n=setTimeout(function(){n=null;if(e.el)e.el.trigger("singleTap");e={}},250)}},0)}else{e={}}v=g=0}).on("touchcancel MSPointerCancel pointercancel",l);t(window).on("scroll",l)});["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(e){t.fn[e]=function(t){return this.on(e,t)}})})(e);(function(t){if(t.os.ios){var e={},n;function i(t){return"tagName"in t?t:t.parentNode}t(document).bind("gesturestart",function(t){var r=Date.now(),o=r-(e.last||r);e.target=i(t.target);n&&clearTimeout(n);e.e1=t.scale;e.last=r}).bind("gesturechange",function(t){e.e2=t.scale}).bind("gestureend",function(n){if(e.e2>0){Math.abs(e.e1-e.e2)!=0&&t(e.target).trigger("pinch")&&t(e.target).trigger("pinch"+(e.e1-e.e2>0?"In":"Out"));e.e1=e.e2=e.last=0}else if("last"in e){e={}}});["pinch","pinchIn","pinchOut"].forEach(function(e){t.fn[e]=function(t){return this.bind(e,t)}})}})(e);(function(t){t.fn.end=function(){return this.prevObject||t()};t.fn.andSelf=function(){return this.add(this.prevObject||t())};"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings".split(",").forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=n.apply(this,arguments);t.prevObject=this;return t}})})(e);(function(t){if(String.prototype.trim===t)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};if(Array.prototype.reduce===t)Array.prototype.reduce=function(e){if(this===void 0||this===null)throw new TypeError;var n=Object(this),i=n.length>>>0,r=0,o;if(typeof e!="function")throw new TypeError;if(i==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)o=arguments[1];else do{if(r in n){o=n[r++];break}if(++r>=i)throw new TypeError}while(true);while(r<i){if(r in n)o=e.call(t,o,n[r],r,n);r++}return o}})();return t.exports=exports=e});define("cookie",function(require,exports,module){var _cacheThisModule_;exports.get=getCookie;exports.set=setCookie;exports.del=delCookie;function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);if(!val||!val[2]){return"";}
var res=val[2];try{if(/(%[0-9A-F]{2}){2,}/.test(res)){return decodeURIComponent(res);}else{return unescape(res);}}catch(e){return unescape(res);}}
function setCookie(name,value,expires,path,domain,secure){var exp=new Date(),expires=arguments[2]||null,path=arguments[3]||"/",domain=arguments[4]||null,secure=arguments[5]||false;expires?exp.setMinutes(exp.getMinutes()+parseInt(expires)):"";document.cookie=name+'='+escape(value)+(expires?';expires='+exp.toGMTString():'')+(path?';path='+path:'')+(domain?';domain='+domain:'')+(secure?';secure':'');}
function delCookie(name,path,domain,secure){var value=getCookie(name);if(value!=null){var exp=new Date();exp.setMinutes(exp.getMinutes()-1000);path=path||"/";document.cookie=name+'=;expires='+exp.toGMTString()+(path?';path='+path:'')+(domain?';domain='+domain:'')+(secure?';secure':'');}}});
define('loadJs',function(require,exports,module){var _cacheThisModule_;var ck=require('cookie');var callbackNameCount={},letterMap=['Z','A','B','C','D','E','F','G','H','I'];function transToLetter(num){var arr=(num+'').split(''),v=[];for(var i=0;i<arr.length;i++){v.push(letterMap[arr[i]])}
return v.join('');}
function callbackNameUnique(str){if(!callbackNameCount[str]){callbackNameCount[str]=1;}else{callbackNameCount[str]+=1;}
return str+transToLetter(callbackNameCount[str]);}
function ignoreUrl(url){return url.indexOf('wq.360buyimg.com')>-1||url.indexOf('wqs.jd.com')>-1||url.indexOf("wqcoss.jd.com/mcoss/")>-1||url.indexOf("btshow.jd.com/queryBtPlanInfo.do")>-1||url.indexOf('storage.360buyimg.com')>-1;}
function sendJs(url,opt){var option={onLoad:null,onError:null,onTimeout:null,timeout:8000,isToken:true,keepProtocol:false,charset:"utf-8",setReportUrl:""};var code=0;var timer;var clear=function(){if(!el){return;}
timer&&clearTimeout(timer);el.onload=el.onreadystatechange=el.onerror=null;el.parentNode&&(el.parentNode.removeChild(el));el=null;}
if(arguments.length==1){if(typeof arguments[0]=="object"){opt=arguments[0];url=opt.url;}else{opt={};}}
if(typeof(opt.data)=='object'){var param=[];for(var k in opt.data){param.push(k+'='+opt.data[k])}
if(param.length>0){param=param.join('&');url+=(url.indexOf('?')>0?'&':'?')+param;}}
if(window.traceid){var lh=url.split('#');url+=(lh[0].indexOf('?')>0?'&':'?')+'traceid='+window.traceid+(lh[1]?'#'+lh[1]:'');}
for(var i in opt){if(opt.hasOwnProperty(i)){option[i]=opt[i];}}
var el=document.createElement("script");el.charset=option.charset||"utf-8";var needCheck=false;var cgiLoadOK=false;var reportUrl="";if(opt.setReportUrl&&typeof opt.setReportUrl=="function"){reportUrl=opt.setReportUrl();!reportUrl&&(reportUrl=url);}else{reportUrl=window.CGI302ReportKeepUrl?url:url.replace(/\?.*/,'');}
el.onload=el.onreadystatechange=function(){if(/loaded|complete/i.test(this.readyState)||navigator.userAgent.toLowerCase().indexOf("msie")==-1){option.onLoad&&option.onLoad();if(needCheck&&!cgiLoadOK){if(window.JD){JD.report.umpBiz({bizid:24,operation:3,result:"1",source:0,message:reportUrl});}
option.onError&&option.onError();window.onerror('','','','',{stack:'servererror:'+reportUrl});console.log('loadJs Failed:'+url);}
clear();}};el.onerror=function(){window.__reloadResource&&__reloadResource(el);option.onError&&option.onError();clear();};var targetUrl=option.isToken?addToken(url,"ls"):url;if(!ignoreUrl(targetUrl)){var originFunctionName;var newFunctionName;var originFunction;var newUrl=targetUrl.replace(/callback=([^&]+)/,function(a,b){originFunctionName=b;newFunctionName=callbackNameUnique(originFunctionName);return'callback='+newFunctionName;});if(originFunctionName&&window[originFunctionName]){needCheck=true;targetUrl=newUrl;originFunction=window[originFunctionName];window[newFunctionName]=function(d){cgiLoadOK=true;originFunction(d,code);};}}
if(window.JD){targetUrl=JD.url.getCgiUrl(targetUrl);}
el.src=option.keepProtocol?targetUrl:targetUrl.replace(/^http(s?):/,"");!opt.cancleLog&&console.log('loadJs request:'+el.src);document.getElementsByTagName('head')[0].appendChild(el);if(typeof option.onTimeout=="function"){timer=setTimeout(function(){code=1;option.onTimeout();},option.timeout);}};function addToken(url,type){if(url==""||(url.indexOf("://")<0?location.href:url).indexOf("http")!=0){return url;}
var wq_token=getToken("wq_skey");var pt_token=getToken("pt_key");var parts=url.split("#");var parts2=parts[0].split("?");var path=parts2[0];var param=(parts2.length==2?parts2[1]:"").split("&");var hash=parts.length==2?parts[1]:"";var hasSceneval=false;param=param.filter(function(m){if(m.match(/^sceneval=/))hasSceneval=true
return!(/g_tk=\d+/.test(m)||/g_pt_tk=\d+/.test(m)||/g_ty=\w+/.test(m));});wq_token&&param.push("g_tk="+wq_token);pt_token&&param.push("g_pt_tk="+pt_token);(wq_token||pt_token)&&param.push("g_ty="+type);if(!hasSceneval&&window.location&&location.href.match(/(\?|&)sceneval=2/)){param.push("sceneval=2");}
var paramStr=param.join("&");return path+(paramStr?("?"+paramStr):"")+(hash?("#"+hash):"");};function getToken(key){key=key||"wq_skey";var skey=ck.get(key);return skey?time33(skey):"";};function time33(str){for(var i=0,len=str.length,hash=5381;i<len;++i){hash+=(hash<<5)+str.charAt(i).charCodeAt();}
return hash&0x7fffffff;}
exports.loadScript=function(url,opt){var args=[].slice.call(arguments);setTimeout(function(){sendJs.apply(null,args);},0);};exports.addToken=addToken;});
define("tpl_wq.confirmV3",function(require,exports,module){var _cacheThisModule_,ins={};exports.template=function(it){return com(it);}
function com(it){var out='';return out;}
exports.child_pingouInfo=function(it){var out=' <div class="pingou_info"> <div class="pingou_info_header"> ';if(it.from==99999){out+=' <span>[正在参团]</span>             <div class="pingou_info_tip">为你推荐仅差'+(it.left)+'人的团，完成支付即可拼购成功</div> ';}else if(it.from==0){out+=' <span>[正在开团]</span> 立即支付，即可开团成功 ';}else{out+=' <span>[正在参团]</span> 立即支付，即可参团成功 ';}
out+=' </div> <div class="pingou_info_memberlist"> ';var i,l;out+=' <ul class=""> ';for(i=0,l=it.memberList.length;i<l;i++){out+=' ';member=it.memberList[i];out+=' ';if(member.isMore){out+=' <li class="more"> ··· </li> ';}else if(member.isEnd){out+=' <li class="end"> '+(member.text)+' </li> ';}else{out+=' <li class="'+(member.type)+'"> <div> <img src="'+(member.headPortraitUrl)+'" alt=""> </div> </li> ';}
out+=' ';}
out+=' </ul> </div> </div>';return out;;}
exports.child_buyDiscountAreaTpl=function(it){var out=' <ul> ';if(it.totalPromo2>0||(!window.locker.ContractMachineConfirm&&(it.mzsuits.length>0&&(it.mzsuitsgifts.length>0||it.mzsuitsgifts_isAchieved)))){out+=' <li id="tabPromotionList"> <a href="javascript:void(0);" class="content"> <strong>促销优惠</strong> <em> ';if(!window.locker.ContractMachineConfirm&&(it.mzsuits.length>0&&(it.mzsuitsgifts.length>0||it.mzsuitsgifts_isAchieved))){out+=' 赠品 ';}
out+=' ';if(it.totalPromo2>0){out+=' &nbsp;已优惠 &yen;'+((it.totalPromo2/100).toFixed(2))+'  ';}
out+=' </em> </a> </li> ';}else if(!window.locker.ContractMachineConfirm&&it.orderPromotion&&it.orderPromotion.canSelectPromotion&&it.orderPromotion.canSelectPromotion.length>0&&!(it.orderPromotion.canSelectPromotion.length==1&&it.orderPromotion.canSelectPromotion[0].pid=='-300')){out+=' <li id="tabPromotionList"> <a href="javascript:void(0);" class="content"> <strong>促销优惠</strong> <em> 查看更多优惠 </em> </a> </li> ';}
out+=' <li id="tabInvoices" style="display: none;"><a href="javascript:void(0);" class="content"><strong>发票信息</strong><span></span><br><em id="taxidTip" style="display:none">请填写纳税人识别号，以免影响发票报销</em></a></li> <li id="conponListTab" style="display: none;"></li> <li id="jdCartTab" style="display:none;"></li> <li id="codeTab" style="display:none;"></li> <li id="jdBalanceTab" style="display: none;"></li> <li id="jdRedPacketTab" asset_tag="redPacket" style="display: none;"></li> <li id="jdBeanTab" asset_tag="bean" style="display: none;"></li> </ul> <div class="mod_blockTips" id="douYellowBar" style="display:none;">使用京豆支付需完成实名认证，<em id="dShiming">点此认证</em></div> <div id="payPass" style="display: none;"> <div class="input_password" id="longPass" style="display: none;"> <label class="input_password_label">支付密码</label> <input type="password" placeholder="请输入京东支付密码"> </div> <div class="input_password_num" id="shortPass" style="display: none;"> <label class="input_password_num_label">支付密码</label> <div class="input_password_num_input" id="copyInput"></div> <input type="tel" class="i-text" id="shortPassInput" maxlength="6" autocomplete="off"> </div> <p class="tips">1. 使用部分虚拟资产（包括京豆、京券、余额、礼品卡、领货码）或参加京豆优惠购时，为保障资产安全，请输入支付密码。<br>2. 参加京豆优惠购扣除的京豆，提交订单后，不支持退还。<br>忘记密码？<a href="javascript:void(0);" id="resetPassword">重置京东支付密码</a></p> </div>';return out;;}
exports.child_guaranteeTpl=function(it){var out=' <h5 class="order_info_guarantee_title">退换无忧</h5> <p class="order_info_guarantee_content"> ';if(it.venderId=="0"){out+=' 自签收后7天内退货，15天内换货，可免费享1次上门取件服务 ';}else{out+=' 7天内退货，15天内换货，可享一次运费赔付到小金库 ';}
out+=' <i class="info"></i></p> <div class="order_info_guarantee_price ';if(it.checkedFlag=='1'||it.type=='1'){out+='selected';}
out+='" venderid="'+(it.venderId)+'" rType="'+(it.type)+'"> ';if(it.type=="1"){out+=' 商家赠送 ';}else{out+=' '+(it.insuranceFee>0?"&yen;"+(it.insuranceFee/100).toFixed(2):"免费")+' ';}
out+=' </div>';return out;;}
exports.child_promTabTpl=function(it){var out='';if(it.totalPromo2>0||(!window.locker.ContractMachineConfirm&&it.mzsuitsgifts_isAchieved)){out+=' <a href="javascript:void(0);" class="content"> <strong>促销优惠</strong> <em> ';if(!window.locker.ContractMachineConfirm&&(it.mzsuits.length>0&&(it.mzsuitsgifts.length>0||it.mzsuitsgifts_isAchieved))){out+=' 赠品 ';}
out+=' ';if(it.totalPromo2>0){out+=' &nbsp;已优惠 &yen;'+((it.totalPromo2/100).toFixed(2))+'  ';}
out+=' </em> </a>';}else if(!window.locker.ContractMachineConfirm&&it.orderPromotion&&it.orderPromotion.canSelectPromotion&&it.orderPromotion.canSelectPromotion.length>0&&!(it.orderPromotion.canSelectPromotion.length==1&&it.orderPromotion.canSelectPromotion[0].pid=='-300')){out+=' <a href="javascript:void(0);" class="content"> <strong>促销优惠</strong> <em> 查看更多优惠 </em> </a>';}
out+='';return out;;}
exports.child_conponListTabTpl=function(it){var out=' ';if(it.couponListCount>0||it.cannotUseCouponListCount>0){out+=' <a href="javascript:void(0);" id="jdQuanTab" class="content"> <strong>京东券</strong> ';if(it.couponDiscount<=0&&it.couponListCount>0){out+=' <span class="coupon">有'+(it.couponListCount)+'张可用</span><em> 去使用</em> ';}else if(it.couponDiscount>0){out+=' <span class="coupon" id="max_coupon_tip" style="display:none;">已选推荐组合</span> <em>已使用'+((it.selectedCoupon.length))+'张 共抵扣&yen;'+((it.couponDiscount/100).toFixed(2))+'</em> ';}else if(it.couponListCount==0&&it.couponShort<=0){out+=' <em class="disabled">无可用</em> ';}
out+=' ';if(it.couponShort>0&&!(it.couponDiscount<=0&&it.couponListCount>0)&&!(it.couponDiscount>0||it.couponListCount>0)){out+=' <span class="coupon">还差&yen;'+((it.couponShort/100).toFixed(2))+'</i>可'+(((it.couponDiscount>0||it.couponListCount>0)?'再':''))+'用1张</span>';if(!window.isPingou&&!window.mConfirm){out+='去凑单';}
out+=' ';}
out+=' </a> ';}
out+='';return out;;}
exports.child_tplItemDetail=function(it){var out='';var i,l,item;out+='';if(it.c_zengPin){out+=' <dl class="on"> <dt>'+(it.c_plusGift?'PLUS'+it.c_giftTitle:it.c_giftTitle)+'</dt> <dd> <ul class="jd promo"> ';for(i=0,l=it.gifts.skus.length;i<l;i++){out+=' ';item=it.gifts.skus[i];out+=' ';if(item.isAccessory!='1'){out+=' <li> <img src="//img10.360buyimg.com/n4/'+(item.image)+'" width="40" height="40"> <p class="fn">'+(item.name)+'</p> <span class="desc"><em>'+(item.num)+'</em>件</span> </li> ';}
out+=' ';}
out+=' </ul> </dd> </dl>';}
out+='';if(it.c_score){out+=' <p class="promo_list_one">返京豆<span>'+(it.c_score)+'</span></p>';}
out+='';if(it.c_couponList){out+=' <p class="promo_list_one">返京券<span>&yen;'+(it.c_couponList)+'</span></p>';}
out+='<br/><br/><br/><br/><br/>';return out;;}
exports.child_newPromoPageTpl=function(it){var out=' ';var cashBackProduct=it.cashBackProduct;out+='  ';if(cashBackProduct>0){out+=' <dl class="on"> <dt>返现<em style="display:none;">（不参加优惠）</em></dt> <dd> <ul class="cash"> <li class="selected"><span class="price">&yen;'+((cashBackProduct/100).toFixed(2))+'</span></li> </ul> </dd> </dl> ';}
out+=' ';var mfsuits=it.mfsuits;out+=' ';if(mfsuits.length>0&&it.products.length>1&&!window.locker.ContractMachineConfirm){out+=' ';for(var i=0,l=mfsuits.length;i<l;i++){var _product=[];if(mfsuits[i].products){_product=_product.concat(mfsuits[i].products);}if(mfsuits[i].suits){for(var j=0;j<mfsuits[i].suits.length;j++){_product=_product.concat(mfsuits[i].suits[j].products);}}
out+=' <dl class="on" pid="'+(mfsuits[i].promotion.pid)+'" ';if(mfsuits[i].multiPromo=='1'){out+='style="display: none;" type="multi"';}
out+='> <dt>';if(mfsuits[i].mli){out+=' '+(mfsuits[i].mli)+' ';}else if(mfsuits[i].multiPromo=='1'){out+='多店铺联合满免';}else if(mfsuits[i].multiPromo=='7'){out+=' 跨店铺满免 ';}else if(mfsuits[i].multiPromo=='20'){out+='跨自营/店铺满减';}else if(mfsuits[i].multiPromo=='21'){out+='跨自营/店铺满免';}else if(mfsuits[i].multiPromo=='22'){out+='跨自营/店铺满折';}else{out+='店铺满减';}
out+='<em style="display: none;">（不参加优惠）</em></dt> <dd class="manjian"> <div class="promo_images"> <span class="more" style="display: none;">...</span> ';for(var j=0,k=_product.length;j<k;j++){out+=' <img src="//img10.360buyimg.com/n5/'+(_product[j].mainSku.image)+'" width="50" height="50"> ';}
out+=' </div> <ul class="man"> ';if(mfsuits[i].promotion.needNum=='0'){out+=' <li class="selected">满<span class="price">&yen;'+((mfsuits[i].promotion.needMoney/100).toFixed(2))+'</span>减<span class="price">&yen;'+((mfsuits[i].promotion.manfan/100).toFixed(2))+'</span> ';if(mfsuits[i].freeShipping=='1'){out+=' （中国内地包邮） ';}
out+=' </li> ';}else{out+=' <li  class="selected">满<span class="price">'+(mfsuits[i].promotion.needNum)+'</span>件 减<span class="price">&yen;'+((mfsuits[i].promotion.manfan/100).toFixed(2))+'</span> ';if(mfsuits[i].freeShipping=='1'){out+=' （中国内地包邮） ';}
out+=' </li> ';}
out+=' </ul> </dd> </dl> ';}
out+=' ';}else if(!window.locker.ContractMachineConfirm){if(it.orderPromotion&&it.orderPromotion.canSelectPromotion&&it.orderPromotion.canSelectPromotion.length>0&&!(it.orderPromotion.canSelectPromotion.length==1&&it.orderPromotion.canSelectPromotion[0].pid=='-300')){it.orderPromotion.canSelectPromotion=it.orderPromotion.canSelectPromotion.sort(function(item1,item2){return item2.pid-item1.pid;});out+=' <div class="order_promo_choosing" id="promo_choose" style="margin-bottom: 15px;"> <div class="shipping_type_list"> <div class="order_promo_choosing_title">该商品满足以下促销优惠</div> ';for(var i=0;i<it.orderPromotion.canSelectPromotion.length;i++){var proItem=it.orderPromotion.canSelectPromotion[i],pnote=proItem.pnote.replace(/(\d+\.\d+)/g,'<span class="price">$1</span>');out+=' <ul ';if(proItem.sstate=='1'){out+=' class="selected" ';}
out+=' pid=\''+(proItem.pid)+'\'> <li class="type">'+(pnote)+'</li> </ul> ';}
out+=' </div> </div> ';}
out+='     ';}
out+=' <div id="mzGiftGroup"></div> <br/><br/><br/><br/><br/> <div id="promoConfirm" class="mod_btns fixed"> <a href="javascript:void(0);" class="mod_btn bg_1">确认</a> </div>';return out;;}
exports.child_tplMzPromo=function(it){var out='';var mzGiftGroup=it.mzGiftGroup;out+=' ';for(var i=0,l=mzGiftGroup.length;i<l;i++){out+=' <dl class="on"> <dt>';if(mzGiftGroup[i].needMoney>0||mzGiftGroup[i].needNum){out+='可领赠品如下，';}
out+=' 最高可选'+(Math.min(mzGiftGroup[i].canSelectedGiftNum,mzGiftGroup[i].manGiftSkus.length))+'款：</dt> <dd> <ul class="cash promo"> ';for(var j=0,k=mzGiftGroup[i].manGiftSkus.length;j<k;j++){out+=' ';var sku=mzGiftGroup[i].manGiftSkus[j];out+=' ';if(!sku){continue;}
out+=' <li skuid="'+(sku.id)+'" promoid="'+(mzGiftGroup[i].promoId)+'" ';if(sku.giftSelectState=='2'){out+=' class="selected" ';}else if(sku.giftSelectState=='3'){out+=' class="disabled" ';}
out+='> <img src="//img10.360buyimg.com/n4/'+(sku.image)+'" width="40" height="40"> <p>'+(sku.name)+'</p> <span><em>'+(sku.num)+'</em>件</span> <span class="price">&yen;'+((sku.promoPrice/100).toFixed(2))+'</span> </li> ';}
out+=' </ul> </dd> </dl> ';}
out+='';return out;;}
exports.child_noStockTpl=function(it){var out=' ';var noStockGroups=it.noStockGroups,type=it.type,rmTitle="",rmDesc="",cancelText='暂不购买',okText="",typeArr=["stock","pingou","samsVip","commonStock","limitedBuy","limitedBuy1"];if(type=="stock"){rmTitle="以下商品无货";rmDesc="";okText="移除无货商品";}else if(type=="pingou"){rmTitle="拼购商品";rmDesc="拼购商品不支持购物车购买，请移除拼购商品再购买。";okText="移除并继续支付";}else if(type=="sale"){rmTitle="限购商品";rmDesc="以下促销商品已限制售卖数量，现需按以下原价购买";okText="继续购买";cancelText="暂不购买";}else if(type=="samsVip"){rmTitle="山姆会员专享商品";rmDesc="您不是山姆会员，以下商品暂时无法购买";okText="移除会员专享商品";}else if(type=="limitedBuy"){rmTitle="限购商品";rmDesc="抱歉以下商品超过限购数量，请返回购物车修改";okText="返回购物车";}else if(type=="limitedBuy1"){rmTitle="以下商品超过限购数量";rmDesc="";cancelText="返回购物车";okText="去修改数量";}else if(type=="commonStock"){rmTitle="以下商品库存不足";cancelText="";okText="返回购物车";}
out+=' <div class="mod_alert mod_alert_goods mod_alert_info fixed" id="noStockTplModel" style="display: block;"> <span class="close"></span> <h3>'+(rmTitle)+'</h3> <p class="alignLeft">'+(rmDesc)+'</p> <div class="scrollbox"> <ul class="goods"> ';noStockGroups.forEach(function(group){out+=' <div class="group"> ';if(type=='commonStock'&&group.type=='commonStock'){out+=' <div class="common_title"> <span class="common_title_icon">共享库存</span>以下商品由同一个供应商供货 </div>                     ';}
out+=' ';group.arr.forEach(function(item){out+=' <li> <img src="//img10.360buyimg.com/n4/';if(typeArr.indexOf(type)>-1){out+=''+(item.image)+'';}else if(type=='sale'){out+=''+(item.skuImage)+'';}
out+='"> <p>';if(type!="samsVip"&&item.nostockType=='gift'&&!item.isJiaJiaGou){out+='<span class="mod_sign_tip "><b>'+(item.giftName||'赠品')+'</b></span>';}
out+=' ';if(typeArr.indexOf(type)>-1){out+=' '+(item.name)+'';}else if(type=="sale"){out+=''+(item.skuName)+' ';}
out+=' </p> ';if(type.indexOf('limitedBuy')>-1){out+=' <p style="font-size:10px;color:#e4393c;">'+(item.errorMsg)+'</p> ';}
out+=' <p class="color_gray">';if(type=="stock"||type=='pingou'||type=='samsVip'||type=='commonStock'){out+=' '+(item.num)+'件 ';}else if(type=="sale"){out+='&yen;'+((item.price/100).toFixed(2))+'（商品原价）';}else if(type.indexOf('limitedBuy')>-1){out+='                         ';if(item.gift=='1'){out+=' <span class="mod_sign_tip "><b>'+(item.giftName||'赠品')+'</b></span> ';}else{out+=' &yen;'+((item.price/100).toFixed(2))+'<span style="margin-left:10px;"> ';}
out+=' x'+(item.curBuyNum)+'</span>';}
out+='</p> </li> ';});out+=' </div> ';});out+=' </ul> </div> <div class="btns"> <a href="javascript:void(0);" tag="cancel" class="btn btn_2">'+(cancelText)+'</a> <a href="javascript:void(0);" tag="confirm" class="btn btn_1">'+(okText)+'</a> </div> </div>';return out;;}
exports.child_discodTpl=function(it){var out=' <div class="mod_alert mod_alert_goods show fixed" id="noCodModel"> <h3>以下商品不支持货到付款</h3> <ul class="goods"> ';for(var i=0;i<it.discodArr.length;i++){out+=' <li> <img src="//img10.360buyimg.com/n4/'+(it.discodArr[i].image)+'"> <p>'+(it.discodArr[i].name)+'</p> <p>'+(it.discodArr[i].num)+' 件</p> </li> ';}
out+=' </ul> <a href="javascript:void(0);" class="btn btn_1" id="noCodModelBtn1">移除不支持的商品并继续</a> <a href="javascript:void(0);" class="btn" id="noCodModelBtn2">暂不使用货到付款购买</a> </div>';return out;;}
exports.child_samsTpl=function(it){var out=' <div id="samsTipAlert" class="mod_alert goods_msg_update fixed" style="display:none;"> <p>为保证尽快送达，以下商品<br>已切换为该地区售卖的同款<br>商品，请确认商品价格信息</p> <ul class="goods_list"> ';for(var i=0;i<it.length;i++){var item=it[i];out+=' <li class="goods_list_item"><img src="//img10.360buyimg.com/n4/'+(item.mainSku.image)+'"></li> ';}
out+='  </ul> <p class="btns"> <a href="javascript:void(0);" class="btn btn_1" id="samsBtn">知道了</a> </p> </div>';return out;;}
exports.child_modifyNum=function(it){var out='<div id="modifyModel"> <div class="mod_alert fixed" style="z-index: 120; display: block;top:30%"> <p>修改购买数量</p> <div class="hproduct"><div class="sku"> <div class="num_wrap" style="margin: 0 auto;"> <span class="minus" num_model_tag="minus"></span> <input class="num" type="tel" value="1"/> <span class="plus" num_model_tag="plus"></span> </div> </div></div> <p class="btns"> <a href="javascript:void(0);" class="btn btn_1">确定</a> <a href="javascript:void(0);" class="btn btn_2">取消</a> </p> </div> <div class="mod_alert_mask"></div></div>';return out;;}
exports.child_taxFeeTpl=function(it){var out='<div class="tax_main"> <div class="tax_head">税费详情<i class="close" id="taxClose"></i></div> <div class="tax_scroll"> <ul class="tax_list"> ';var taxNum=0;products=it.products;for(var i=0,j=products.length;i<j;i++){var item=products[i];if(item.mainSku.taxAmount>0||item.mainSku.isSeptax=='2'||((item.mainSku.isSeptax==''||item.mainSku.isSeptax=='0')&&item.mainSku.overseaPurchaseCode=='2')){taxNum+=parseInt(item.mainSku.num);out+=' <li class="tax_list_item"> <div class="tax_img_wrap"> <img src="//img10.360buyimg.com/n4/'+(item.mainSku.image)+'"> <p class="tax_text">x'+(item.mainSku.num)+'</p> </div> ';if(item.mainSku.isSeptax=='2'){out+=' <p class="tax_price">商品价格已包税</p> ';}else if((item.mainSku.isSeptax==''||item.mainSku.isSeptax=='0')&&item.mainSku.overseaPurchaseCode=='2'){out+=' <p class="tax_price">商家承担税费</p> ';}else{out+=' <p class="tax_price">税费 <span>&yen; '+((item.mainSku.taxAmount/100*item.mainSku.num).toFixed(2))+'</span></p> ';}
out+=' </li> ';}
out+=' ';}
out+='          </ul> <p class="tax_tips">根据国家政策规定需缴纳跨境电商综合税，税费计算公式如下：</p> <p class="tax_tips">跨境电商综合税率 =（消费税率+增值税率）/（1-消费税率）×0.7</p> <p class="tax_tips">税费=购买单价 * 件数 *跨境电商综合税率</p> <p class="tax_tips">注：优惠券仅可抵扣商品金额</p> </div> <div class="tax_confirm"> <a href="javascript:void(0);" class="tax_submit" id="taxConfirm">确认</a> <p class="tax_price">总税费 <span>&yen; '+((it.orderTaxAmount/100).toFixed(2))+'</span></p> <p class="tax_num">共'+(taxNum)+'笔</p> </div></div>';return out;;}
exports.child_shipFeeDetailTpl=function(it){var out=' ';var jdFeeObj=it.jdDetail,popFeeArr=it.popDetail,popShipFee=it.popShipFee,orderObj=it.orderObj,popItem,selectGsd=it.selectGsd,oFreight=orderObj.overseaOriginalFreight/1||0,boFreight=orderObj.overseaOriginalBookFreight/1||0;out+=' <h3 class="ship_info_title">运费详情</h3> <div class="ship_info_inner"> ';if(jdFeeObj&&(jdFeeObj.freight>0||jdFeeObj.freeFreight>0)){out+=' ';if(!selectGsd){out+=' <div class="ship_info_chart"> <p class="ship_info_chart_title">'+(jdFeeObj.vName)+'</p> ';if(orderObj.freshBaseShipFreight/100+orderObj.freshPickShipFee/100>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">生鲜商品基础运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.freshBaseShipFreight/100+orderObj.freshPickShipFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.freshMisJzdShipFreight/1+orderObj.freshBigJzdShipFreight/1>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">生鲜商品京准达运费</p> <p class="ship_info_chart_right">&yen;'+(((orderObj.freshMisJzdShipFreight/100+orderObj.freshBigJzdShipFreight/100)).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.freshJsdShipFreight/100>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">生鲜商品极速达运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.freshJsdShipFreight/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.freshAddWeightFee>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">生鲜商品续重运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.freshAddWeightFee/100).toFixed(2))+'</p> <p class="ship_info_chart_small">（生鲜商品总重'+((orderObj.jdVenderFreshWeight/1000).toFixed(3))+'kg，超出重量'+(orderObj.jdVenderFreshAddWeight)+'，超重部分1元/kg）</p> </div> ';}
out+=' ';if(orderObj.freshGsdFee/100>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">生鲜商品同城配送运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.freshGsdFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(oFreight>0||boFreight>0){out+=' ';if(oFreight>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">非图书基础运费</p> <p class="ship_info_chart_right">&yen;'+(oFreight.toFixed(2))+'</p> </div> ';}
out+=' ';if(boFreight>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">图书基础运费</p> <p class="ship_info_chart_right">&yen;'+(boFreight.toFixed(2))+'</p> </div> ';}
out+=' ';}else if(orderObj.overseaBookFreight/1>0||orderObj.overseaNoBookFreight/1>0){out+=' ';if(orderObj.overseaBookFreight>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">京东全球售图书基础运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.overseaBookFreight/1).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.overseaNoBookFreight/1>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">京东全球售非图书基础运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.overseaNoBookFreight/1).toFixed(2))+'</p> </div> ';}
out+=' ';}else if(orderObj.baseShipFee/100+orderObj.pickShipFee/100+orderObj.aboardShipFee/100>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">';if(orderObj.containFresh&&orderObj.aboardShipFee/100<=0){out+='非生鲜商品';}
out+='基础运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.baseShipFee/100+orderObj.pickShipFee/100+orderObj.aboardShipFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.addWeightFee/100+orderObj.aboardOverWeightFee/100>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">';if(orderObj.containFresh&&orderObj.aboardOverWeightFee/100<=0){out+='非生鲜商品';}
out+='续重运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.addWeightFee/100+orderObj.aboardOverWeightFee/100).toFixed(2))+'</p> <p class="ship_info_chart_small">（';if(orderObj.containFresh&&orderObj.aboardOverWeightFee/100<=0){out+='非生鲜商品';}
out+='商品总重'+((orderObj.jdVenderWeight/1000).toFixed(3))+'kg，超出重量'+(orderObj.jdVenderAddWeight)+'';if(orderObj.aboardOverWeightFee/100<=0){out+='，超重部分1元/kg';}
out+='）</p> </div> ';}
out+='  ';if(orderObj.overLimitFee>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">超重超大运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.overLimitFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.zxjJzdFee/1+orderObj.djdJzdFee/1>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">京准达运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.zxjJzdFee/100+orderObj.djdJzdFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.jsdShipFee>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">极速达运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.jsdShipFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.djdJsdFee>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">非生鲜极速达运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.djdJsdFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.zxjGsdFee/100>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">普通商品同城配送运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.zxjGsdFee/100).toFixed(2))+'</p> </div> ';}
out+=' <p class="ship_info_chart_total">自营运费总计：&yen;'+(((jdFeeObj.freight/1+Math.abs(orderObj.overseaPromotionTotalFreight*100))/100).toFixed(2))+'</p> </div> ';}else{out+=' <div class="ship_info_chart"> <p class="ship_info_chart_title">'+(jdFeeObj.vName)+'</p> ';if(orderObj.qzcBaseShipFee/100){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">基础运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.qzcBaseShipFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(orderObj.qzcOverWeightFee/100){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">续重运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.qzcOverWeightFee/100).toFixed(2))+'</p> <p class="ship_info_chart_small">（商品总重'+((orderObj.jdVenderWeight/1000).toFixed(3))+'kg，超出重量'+(orderObj.jdVenderAddWeight)+'，超重部分1元/kg）</p> </div> ';}
out+=' ';if(orderObj.qzcZxjSdsShipFee>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">闪电送运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.qzcZxjSdsShipFee/100).toFixed(2))+'</p> </div> ';}
out+=' <p class="ship_info_chart_total">自营运费总计：&yen;'+((jdFeeObj.freight/100).toFixed(2))+'</p> </div> ';}
out+=' ';}
out+=' ';if(popFeeArr.length>0&&popShipFee>0){out+=' <div class="ship_info_chart"> ';for(var i=0;i<popFeeArr.length;i++){popItem=popFeeArr[i];out+=' ';if(popItem.freight>0){out+=' <p class="ship_info_chart_title">'+(popFeeArr[i].vName)+'</p> <div class="ship_info_chart_item"> <p class="ship_info_chart_left">基础运费</p> <span class="ship_info_chart_right">&yen;'+((popItem.freight/100).toFixed(2))+'</span> </div> ';}
out+=' ';if(popItem.isSams=='1'&&orderObj.samZxjGsdShipFee/100>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">山姆商品同城配送运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.samZxjGsdShipFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';if(popItem.isWalmart=='1'&&orderObj.walmartGsdFee/100>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">沃尔玛商品同城配送运费</p> <p class="ship_info_chart_right">&yen;'+((orderObj.walmartGsdFee/100).toFixed(2))+'</p> </div> ';}
out+=' ';}
out+=' <p class="ship_info_chart_total">商家运费总计：&yen;'+((popShipFee/100).toFixed(2))+'</p> </div> ';}
out+=' <p class="ship_info_tip">注：如有疑问，请查看<a href="javascript:void(0)" class="ship_info_lnk detailRule">详细运费规则</a></p> </div> <div class="btns"> <a href="javascript:void(0);" class="btn btn_1" id="shipFeeClose">知道了</a> </div>';return out;;}
exports.child_shipFeeDiscountTpl=function(it){var out=' ';var pFreight=Math.abs(it.overseaPromotionFreight/1)||0,bFreight=Math.abs(it.overseaPromotionBookFreight/1)||0;out+=' <h3 class="ship_info_title">运费优惠详情</h3> <div class="ship_info_inner"> <div class="ship_info_chart"> <p class="ship_info_chart_title">京东自营</p> ';if(pFreight>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">非图书运费优惠</p> <p class="ship_info_chart_right">-&yen;'+(pFreight.toFixed(2))+'</p> </div> ';}
out+=' ';if(bFreight>0){out+=' <div class="ship_info_chart_item"> <p class="ship_info_chart_left">图书运费优惠</p> <p class="ship_info_chart_right">-&yen;'+(bFreight.toFixed(2))+'</p> </div> ';}
out+=' <p class="ship_info_chart_total">运费优惠总计：&yen;'+(Math.abs(it.overseaPromotionTotalFreight/1).toFixed(2))+'</p> </div>  <p class="ship_info_tip">注：如有疑问，请查看<a href="javascript:void(0)" class="ship_info_lnk detailRule">详细运费规则</a></p> </div> <div class="btns"> <a href="javascript:void(0);" class="btn btn_1" id="shipDisKnown">知道了</a> </div>';return out;;}
exports.child_loopPackageTpl=function(it){var out=' ';var i;out+=' <div class="invoice_popup fixed"> <div class="invoice_popup_inner"> <div class="invoice_popup_tit">循环包装商品</div> <div class="invoice_popup_list"> ';if(it.supArr.length>0){out+=' <div class="invoice_popup_subtit">以下商品使用循环包装</div> <div class="invoice_popup_goods"> ';for(i=0;i<it.supArr.length;i++){out+=' <div class="invoice_popup_cover"> <img src="//img10.360buyimg.com/n4/'+(it.supArr[i].imgUrl)+'"> </div> ';}
out+=' </div> ';}
out+=' ';if(it.notSupArr.length>0){out+=' <div class="invoice_popup_subtit">以下商品使用普通包装</div> <div class="invoice_popup_goods"> ';for(i=0;i<it.notSupArr.length;i++){out+=' <div class="invoice_popup_cover"> <img src="//img10.360buyimg.com/n4/'+(it.notSupArr[i].imgUrl)+'"> </div> ';}
out+=' </div> ';}
out+=' </div> <div class="invoice_popup_btn" id="packageKnown">知道了</div> </div> </div>';return out;;}
exports.child_tipTpl=function(it){var out='<div id="shipFeeContent" class="mod_alert ship_info fixed" style="display:none;"></div><div id="priceTip" class="mod_alert mod_alert_info fixed" style="display:none;"> <h3 class="title">价格说明</h3> <div class="inner"> <p><small>因可能存在系统缓存、页面更新导致价格变动异常等不确定性情况出现，商品售价以本结算页商品价格为准；<br>如有疑问，请您立即联系销售商咨询。</small></p> </div> <div class="btns" id="closePriceTip"> <a href="javascript:void(0)" class="btn btn_1">知道了</a> </div></div><div id="shipFeeTip" class="mod_alert mod_alert_info fixed" style="display:none;"> <h3 class="title">运费说明</h3> <div class="inner"> <p><small>2016年4月1日起，京东配送的自营商品订单：钻石会员自营订单满79元（含）免运费，其他会员自营订单满99元（含）免运费，不足金额订单收取6元/单运费。<br>上门自提订单：不区分会员等级自营订单满99元免运费，不足金额订单收取3元/单运费。</small></p> </div> <div class="btns" id="closeShipFeeTip"> <a href="javascript:void(0)" class="btn btn_1">知道了</a> </div></div><div id="codFloat" style="display:none;"> <div class="mod_alert fixed" style="display: block;"> <i class="icon"></i> <p id="codFloatTip">是否确认使用货到付款提交订单？</p> <p class="alignLeft small">货到付款订单总价：&yen;<span id="cod_total"></span><br><strong>含货到付款运费：<span id="cod_yun_nouse"></span></strong></p> <hr style="display: none"> <p style="display: none" class="alignLeft small">风险提示：<br>选择货到付款后，如一个月内有过1次以上或一年内有过3次以上，无理由不接收京东配送的商品，京东将在相应的帐户里按每单扣除500个京豆作为运费。</p> <p class="btns"> <a href="javascript:void(0);" class="btn btn_2" id="codGoPayCancel">取消</a> <a href="javascript:void(0);" class="btn btn_1" id="codGoPay">确定</a> </p> </div> <div class="mod_alert_mask"></div></div><div id="daifuDesc" class="mod_alert mod_alert_info fixed" style="display:none;"> <span class="close"></span> <h3 class="title">找人代付</h3> <div class="inner"> <dl> <dt>找人代付</dt> <dd>用户可将此笔订单发送给指定的一位好友，让好友帮忙支付此笔订单。</dd> </dl> <dl> <dt>如何找人代付</dt> <dd>点击找人代付-&gt;分享给指定的一位好友->好友支付-&gt;购买成功</dd> </dl> <dl> <dt>代付规则</dt> <dd>1. 代付发起后24小时内无人付款，订单将自动取消；<br>2. 如果订单申请退款，已支付金额将原路退还给代付人；<br> 3. 付款前请您务必和好友再次确认，避免遇到诈骗行为。 </dd> </dl> </div></div><div class="mod_alert mod_alert_address fixed" id="samsFeeDesc" style="display:none"> <p class="title">山姆会员店商品配送说明</p> <div class="content"> <p>山姆会员店商品由京东发货，并提供售后服务。店铺单笔订单不满199元，收运费9元。自提订单满199元免运费，不足金额订单收取3元/单运费。</p> </div> <div class="btns"> <a href="javascript:void(0);" class="btn btn_1" id="samsFeeKnown">知道了</a> </div></div><div id="agreeDesc" class="mod_alert fixed" style="display:none;"> <i class="icon"></i> <p class="alignLeft">为了给您提供更优质的服务，在您授权之后京东海囤全球可以：读取您的用户信息（京东用户名：<span id="agreePin"></span>），为您创建新的交易订单。</p> <p class="alignLeft small"><input type="checkbox" id="agreeCheck" checked="checked">我已阅读并同意<em> <span id="globalAgreeLink" style="color: #e4393c;">《京东海囤全球授权须知》</span>及<span id="ebayagreeLink" style="color: #e4393c;">《购买eBay商品特殊条款》</span>及<span id="enterAgreeLink" style="color: #e4393c;">《进口个人委托申报委托函》</span></em></p> <p class="btns"> <a href="javascript:void(0);" class="btn btn_2" id="agreeCancel">取消</a> <a href="javascript:void(0);" class="btn btn_1" id="agreeSure">授权</a> </p> <p class="small" id="agreeTip" style="color: #e4393c;display:none;">请确认您已阅读并同意相关条款内容！</p></div><div class="mod_alert mod_alert_offline_pay fixed" id="offlinConfirm" style="display:none;"> <i class="icon"></i> <p>是否确认使用银行转账提交订单？</p> <ul class="tips_list"> <li class="tips_list_item">配送时间将更改为工作日、双休日与节假日均可送货</li> <li class="tips_list_item">提交订单后请根据购买完成页或订单详情页提供的汇款指引尽快汇款</li> </ul> <p class="btns"> <a href="javascript:void(0);" class="btn btn_1" id="offSure">确认</a> <a href="javascript:void(0);" class="btn btn_2" id="offCancel">取消</a> </p></div><div class="mod_alert mod_alert_addressChoosing fixed" id="plusPriceChange" style="display:none;"> <span class="close"></span> <h1 class="title">切换价格</h1> <p class="alignLeft" style="margin-top: 10px;font-size:14px;">可进行价格切换，以便达到优惠券或促销的使用门槛</p> <ul class="addressChoosing_list"> <li class="item" id="plusPrice">使用会员价 <span class="price">&yen;</span><span class="mod_plus_price"></span></li> <li class="item" id="jdPrice">使用非会员价 <span class="price color_red">&yen;</span></li> </ul></div><div class="mod_alert mod_alert_info fixed" id="wxMianmiLayer" style="display:none;"> <h3 class="title">邀请您开通微信免密支付</h3> <div class="inner"> <dl> <dt>功能说明</dt> <dd>开通后，您在支付小于等于<span id="mianmiAmt"></span>元的订单时，将不再用输入支付密码，每天最多可使用<span id="mianmiTime">5</span>次，达到限制后，将自动切换到普通微信支付(需验证密码)。</dd> </dl> <dl> <dt>使用规则</dt> <dd> 1.功能开通后，仅限在微信-发现-京东购物、京东购物小程序、京东拼购小程序渠道使用；<br>2.开通后如想关闭，可前往[个人中心-账号管理-微信免密支付管理]操作关闭免密支付功能。<br>3.功能开通后，默认扣款顺序为：零钱->信用卡->借记卡，如需调整，可先关闭功能，然后重新走开通流程，在开通过程中，可自由选择优先扣款方式。 </dd> </dl> <dl> <dd>以下京东账号将开通微信免密支付功能：</dd> <dd id="mimiAccount"></dd> </dl>  </div> <p class="btns"> <a href="javascript:void(0);" class="btn btn_2" id="notOpenMianmi">暂不开通</a> <a href="javascript:void(0);" class="btn btn_1" id="openMianmi">去开通并支付</a> </p></div><div id="shipfeeDiscount" class="mod_alert ship_info fixed" style="display:none;"></div><div class="mod_alert_mask" style="display: none"></div><div class="buy_tax" id="taxFee"><div id="samsTip"></div><div id="addrTip"></div><div id="beanSel"></div><div id="loopPackage"></div>';return out;;}});
define("tpl_s_confirm_payAndAddr",function(require,exports,module){var _cacheThisModule_,ins={};exports.template=function(it){return com(it);}
function com(it){var out='';return out;}
exports.child_tplFeeDetail=function(it){var out='<ul class="buy_chart"> ';if(it.isDreamPay){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">商品金额</p> <p class="buy_chart_item_price">';if(it.presale.isHidePrice=='1'&&it.payStepType!='3'&&it.payStepType!='4'){out+=' &nbsp;待发布 ';}else{out+=' &nbsp;&yen;'+(((it.presale.balancePay-0)/100).toFixed(2))+' ';}
out+='</p> </li> ';}else if(it.branch=='kanjia'){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">成交价格</p> <p class="buy_chart_item_price">&yen;&nbsp;'+(((it.primiPrice-it.promDiscount)/100).toFixed(2))+'</p> </li>    ';}else{out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">商品金额</p> <p class="buy_chart_item_price">&yen;&nbsp;'+(((it.primiPrice-it.promDiscount)/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.orderTaxAmount>0||it.isSeptax){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">税费 <small class="buy_chart_item_tip">税费详情</small><i class="icon_info" id="taxFeeDetail"></i> </p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.orderTaxAmount/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.gstTaxAmount>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">税费 <i class="icon_info" id="gstFeeDetail"></i> </p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.gstTaxAmount/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.crossRegionFee>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">调货服务费 <i class="icon_info layer_photo" tag="crossRegionNeedPay"></i> </p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.crossRegionFee/100).toFixed(2))+'</p> </li> ';}
out+=' ';var weight=0;if(it.weightType=='1'&&(it.jdVenderWeight/1000+it.jdVenderFreshWeight/1000)>0){weight=(it.jdVenderWeight/1000+it.jdVenderFreshWeight/1000).toFixed(3);}
out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">运费 <small class="buy_chart_item_tip"> ';if(weight>0){out+=' （总重：'+(weight)+'kg） ';}
out+=' </small> ';if(it.shippingFee/1>0&&!it.isDreamPay&&!it.isBranch){out+=' <i class="icon_info" id="shipFeeDetail"></i> ';}
out+=' </p> <p class="buy_chart_item_price">+&nbsp;&yen;'+(((it.shippingFee/1+it.freeFreight/1+Math.abs((it.overseaPromotionTotalFreight||0)*100))/100).toFixed(2))+'</p> </li> ';if(it.shipSvcFee>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">配送服务费</p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.shipSvcFee/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.shiphonor&&it.honorFreight>=0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">京尊达服务费</p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.honorFreight/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.packagingServicesFee>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">循环包装费</p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.packagingServicesFee/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.cartAddedServiceTotalFee>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">服务费</p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.cartAddedServiceTotalFee/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.globalSaleFuelFee>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">燃油附加费</p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.globalSaleFuelFee/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.buyerFreightInsure>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">退换无忧</p> <p class="buy_chart_item_price">+&nbsp;&yen;'+((it.buyerFreightInsure/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.cachBack/1>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">促销立减</p> <p class="buy_chart_item_price">-&nbsp;&yen;'+((it.cachBack/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.couponDiscount>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">优惠券</p> <p class="buy_chart_item_price">-&nbsp;&yen;'+((it.couponDiscount/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(Math.abs(it.overseaPromotionTotalFreight*1)>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">运费优惠 <i class="icon_info" id="shipFeeDiscount"></i> </p> <p class="buy_chart_item_price">-&nbsp;&yen;'+(Math.abs((it.overseaPromotionTotalFreight*100)/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.orderRedPacketUsedBalance>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">红包</p> <p class="buy_chart_item_price">-&nbsp;&yen;'+((it.orderRedPacketUsedBalance/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.giftDiscount>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">礼品卡优惠</p> <p class="buy_chart_item_price">-&nbsp;&yen;'+((it.giftDiscount/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.consignCardDiscount>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">领货码</p> <p class="buy_chart_item_price">-&nbsp;&yen;'+((it.consignCardDiscount/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.usedBalance>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">京东余额优惠</p> <p class="buy_chart_item_price">-&nbsp;&yen;'+((it.usedBalance/100).toFixed(2))+'</p> </li> ';}
out+=' ';if(it.usedJdBean>0){out+=' <li class="buy_chart_item"> <p class="buy_chart_item_text">京豆优惠</p> <p class="buy_chart_item_price">-&nbsp;&yen;'+((it.usedJdBean/100).toFixed(2))+'</p> </li> ';}
out+='</ul>';return out;;}
exports.child_tplPayArea=function(it){var out=' ';if(it.booking&&!it.isDreamPay){if(!it.shippingFee){it.shippingFee=0;}var depositWorth=(it.presale.depositWorth/100).toFixed(2),nextPrice=it.presale.balancePay==0?0:it.presale.balancePay-it.presale.earnest-(it.couponDiscount-it.freeFreight),prePrice=nextPrice>0?it.presale.earnest:(it.presale.earnest-0)+nextPrice;prePrice=prePrice>0?prePrice:0;nextPrice=nextPrice>0?nextPrice:0;out+=' <div class="preSale"> <ul class="preSale_item"> <li id="checkBoxBookingMoney" payTypeForPresale="2" style="display: none;"> <p>确认支付定金</p> <p><small>请在30分钟内支付定金</small></p> ';if(it.presale.refundDeposit!='1'){out+=' <p><small>若未支付尾款，定金不可单独退还</small></p> ';}
out+=' </li> <li id="checkBoxAllMoney" payTypeForPresale="1" style="display: none;"> <p>确认支付全款</p> <p><small>将享受优先发货特权</small></p> </li> </ul> </div> <p class="price" id="priceBooking" style="display:none;"> 定金合计：<strong id="pageTotalPrice1">&yen;'+((prePrice/100).toFixed(2))+'</strong><br> ';if(depositWorth!=0){out+=' <small id="depositDeac">定金可抵&yen;'+(depositWorth)+'，</small> ';}
out+=' <small id="tailMoney">后续只需支付尾款：';if(it.presale.isHidePrice=='1'&&it.payStepType!='3'&&it.payStepType!='4'){out+=' 待发布 ';}else{out+='&yen;'+((nextPrice/100).toFixed(2))+'';}if(it.shippingFee>0){out+=' + 运费：&yen;'+((it.shippingFee/100).toFixed(2))+' ';}if(it.venderShipSvcFee>0){out+=' + 配送服务费：&yen;'+((it.venderShipSvcFee/100).toFixed(2))+' ';}
out+=' </small> </p> <p class="price" id="priceAll" style="display:none;"> 全款合计：<strong id="pageTotalPrice2">';if(it.presale.isHidePrice=='1'&&it.payStepType!='3'&&it.payStepType!='4'){out+=' 待发布 ';}else{out+=' &yen;'+((((it.presale.balancePay-0)+(it.shippingFee-0)+(it.venderShipSvcFee-0)-(it.couponDiscount-it.freeFreight))/100).toFixed(2))+' ';}
out+='</strong> <br> <small ';if(!(it.shippingFee>0||it.venderShipSvcFee>0)){out+=' style="display:none;" ';}
out+='>全款已包含：';if(it.shippingFee>0){out+=' 运费：&yen;'+((it.shippingFee/100).toFixed(2))+'';}if(it.venderShipSvcFee>0){out+=' ';if(it.shippingFee>0){out+='+';}
out+=' 配送服务费：&yen;'+((it.venderShipSvcFee/100).toFixed(2))+' ';}
out+='</small> </p> ';if(it.presale.stepOnePricePay>0){out+=' <p class="price" id="priceAll3L" style="display:none;"> 全款合计：<strong id="pageTotalPrice3">&yen;'+((((it.presale.stepOnePricePay-0)+(it.shippingFee-0)-(it.couponDiscount-it.freeFreight))/100).toFixed(2))+'</strong> <br> <small style="display: none;">定金合计：&yen;'+((it.presale.earnest/100).toFixed(2))+' + 尾款合计：&yen;'+(((it.presale.stepOnePricePay-it.presale.earnest)/100).toFixed(2))+'';if(it.shippingFee>0){out+=' + 运费：&yen;'+((it.shippingFee/100).toFixed(2))+'';}if(it.venderShipSvcFee>0){out+=' + 配送服务费：&yen;'+((it.venderShipSvcFee/100).toFixed(2))+' ';}
out+='</small> </p> ';}
out+=' <div class="preSale" id="bookingPhoneNumDom" style="display: none;"> <p class="preSale_item preSale_input"> <span>尾款支付通知手机号：</span> <input id="bookingPhoneNum" type="text" placeholder="请输入手机号码"> </p> </div> <div class="mod_blockTips" style="display:none; margin: 0 -10px;text-align: left;" id="erqingTip">注意：预售订单定金及尾款支付方式须保持一致</div> ';}else{out+=' <p class="price" ';if(it.isDreamPay){out+='style="text-align:right!important;margin:0 0 20px 0;"';}
out+=' >总价：<strong id="pageTotalPrice" price="'+((it.totalPrice/100).toFixed(2))+'">&yen;'+((it.totalPrice/100).toFixed(2))+'</strong> ';if(!it.nomal){out+=' <span style="font-size:12px; display: none;" id="totalPriceShipFee"></span> ';}
out+=' </p> ';}
out+=' <a class="order_additional_tips type_lnk" id="couBar" style="display:none"> <p class="order_additional_tips_text"> <span id="freeShipFeeTip"> 购物满99元（10kg内）可免运费 </span> <span class="order_additional_tips_right" id="shipFeeChou">去凑单</span> </p> </a> <div class="buy_qrcode" id="buy_qrcode" style="display: none"> <h3>支付失败？试试微信扫码支付</h3> <div class="img" id="buy_qrcode_img"></div> <p>长按图片[识别二维码]付款</p> </div> <div id="payBtnList" style="display: none;"> <div class="mod_btns" id="btnQQPay" style="display: none;"> <a href="javascript:void(0);"  class="mod_btn bg_qq" >QQ钱包支付</a> </div> <p class="mod_btns_tips" id="qqPayPro" style="display: none;">使用QQ钱包支付，即可获得全场满59减6优惠券1张~<br><a href="//wqs.jd.com/my/chou/qqproillustrate.shtml">查看活动规则</a></p> <div class="mod_btns" id="btnWxPay" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_wx">微信支付</a> <span id="wxpayTip" class="mod_btn bg_wx" style="display: none;"></span> </div> <div class="mod_btns" id="btnWxH5Pay" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_wx">微信支付</a> </div> <div class="mod_btns" id="btnTenpay" style="display: none;"> <a href="javascript:void(0);"  class="mod_btn bg_tenPay">财付通支付</a> </div> <div class="mod_btns" id="btnKuangPay" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_jd">京东支付<small style="display:none;">(京东旗下支付平台)</small></a> </div> <div class="mod_btns" id="btnCodPay" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_pay">货到付款</a> <span class="mod_btn bg_pay" style="display: none;">促</span> </div> <div class="mod_btns" id="btnCodPay3LAddr" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_pay">货到付款</a> <span class="mod_btn bg_pay" style="display: none;">促</span> </div> <div class="mod_btns" id="btnBaitiao" style="display:none;"> <a href="javascript:void(0);" class="mod_btn mod_btn bg_bt"><span>京东白条<small id="btnBaitiaoTitle">分期还款，超低利息</small></span></a> </div>  <div class="mod_btns mod_btns_wrap" id="btnDaiPay" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_help"><span>找人代付<small>指定一位好友帮您支付</small></span></a> <span id="daifuTip" class="mod_btn bg_help"></span> </div> <div class="mod_btns mod_btns_wrap" id="btnZhongChou" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_chou"><span id="chouDesc">好友筹款<small>邀请多位好友帮您支付</small></span></a> <span id="zhongChouTip" class="mod_btn bg_chou"></span> </div> <div class="mod_btns mod_btns_wrap" id="btnOffline" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_offline"><span>银行转账<small>通过银行汇款完成支付</small></span></a> <span id="offlineTip" class="mod_btn bg_offline"></span> </div>  <div class="mod_btns" id="btnConfirmOrder" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_2">提交订单</a> </div> <div class="mod_btns" id="personalPay" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_2">个人结算</a> </div> <div class="mod_btns" id="subApproval" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_2">提交审批</a> </div> <div class="mod_btns" id="btnPayOnLine" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_2">在线支付</a> </div> <p class="mod_btns_tips" id="zeroOrderTips" style="display: none">支付金额为零，无需支付</p> <div class="buy_notsupport" id="notSup" style="display: none"> <h3 class="buy_notsupport_title">此订单不支持以下支付方式</h3> <div class="buy_notsupport_list"> <div id="noSupWx" style="display: none"> <i class="icon_wechat"></i> <h3>微信支付</h3> <p>到店服务商品和普通商品混合购买时，不支持使用微信支付。欲使用微信支付，请拆分两单购买。</p> </div> <div id="noSupQQPay" style="display: none"> <i class="icon"> <img src="//img11.360buyimg.com/jdphoto/s80x80_jfs/t5206/299/2576345449/6298/782e45a6/591bf008N0f5f3e19.png"> </i> <h3>QQ钱包支付</h3> <p>到店服务商品和普通商品同时购买时，不支持使用QQ钱包支付</p> </div> <a href="javascript:void(0);" id="openBaitiao" style="display: none"> <i class="icon_baitiao"></i> <h3>京东白条</h3> <p>您尚未开通京东白条,立即激活</p> </a> <div id="noSupBaitiao" style="display: none"> <i class="icon_baitiao"></i> <h3>京东白条</h3> <p id="baitiaoTip">白条额度不够</p> </div> <a href="javascript:void(0);" id="delForDiscod" style="display: none"> <i class="icon_delivery"></i> <h3>货到付款</h3> <p id="clickCodTip">部分商品不支持货到付款，立即查看</p> </a> <div href="javascript:void(0);" id="noSupCodTip" style="display: none"> <i class="icon_delivery"></i> <h3>货到付款</h3> <p id="codNoSupTip">订单商品不支持以货到付款方式配送至您的地址</p> </div> </div> </div> </div> <div id="noAllSupCodTip" style="display: none"></div> <p class="delivery_tips" style="display: none;" id="WxpayNorightTip">此订单在本订阅号内无法使用微信支付，如需使用微信支付，请在“发现-购物-个人中心-待付款”订单内完成支付。 </p>';return out;;}
exports.child_tplPayLayer=function(it){var out=' <dl class="inner"> <dt>请选择支付方式<span class="close"></span></dt> <dd class="buy_qrcode" style="display:none;"> <h3>支付失败？试试微信扫码支付</h3> <div class="img"></div> <p>长按图片[识别二维码]付款</p> </dd> <dd class="mod_btns" id="btnLQQpay" style="display:none;"> <a href="javascript:void(0);" class="mod_btn bg_qq">QQ钱包支付</a> </dd> <dd class="mod_btns" id="btnLWxpay" style="display:none;"> <a href="javascript:void(0);" class="mod_btn bg_wx">微信支付</a> </dd> <dd class="mod_btns" id="btnLDaipay" style="display:none;"> <a href="javascript:void(0);" class="mod_btn bg_help"><span>找人代付<small>指定一位好友帮您支付</small></span></a> </dd> <dd class="mod_btns" id="btnLJDpay" style="display:none;"> <a href="javascript:void(0);" class="mod_btn bg_jd">京东支付</a> </dd> <dd class="mod_btns" id="btnLCodpay" style="display:none;"> <a href="javascript:void(0);" class="mod_btn bg_pay">货到付款</a> </dd> <dd class="mod_btns" id="btnLBTpay" style="display:none;"> <a href="javascript:void(0);" class="mod_btn bg_bt"><span>京东白条<small>分期付款，限时利息</small></span></a> </dd> <dd class="mod_btns" id="btnLConfirm" style="display:none;"> <a href="javascript:void(0);" class="mod_btn bg_2"><span>提交订单<small>支付金额为0，无需支付</small></span></a> </dd> </dl> <div class="mask"></div>';return out;;}
exports.child_tplAddressDefault=function(it){var out=' ';var add=window.addressObj,tipName=add.name,screenWidth=window.screen&&window.screen.width;if(screenWidth&&screenWidth<320){tipName=tipName.replace(/(.).*/,'$1...');}else if(screenWidth&&screenWidth<375&&tipName.length>3){tipName=tipName.replace(/(.{3}).*/,'$1...');}else if(screenWidth){tipName=tipName.replace(/(.{5}).*/,'$1...');}
out+=' ';if(add.addrToTitle){out+=' <h3>'+(add.addrToTitle)+'</h3> ';}
out+=' <ul> <li><strong>'+(add.name+' '+add.mobile)+'</strong></li> <li> ';if(add.default_address=='1'){out+='<span class="tag tag_red">默认</span>';}
out+=' ';if(add.label&&add.label!=add.name&&add.label!='undefined'){out+='<span class="tag" id="addrLabel">'+(add.label)+'</span>';}
out+=' '+(add.addrfull||add.jdaddrname.replace(/_/g,'')+add.addrdetail)+' </li> <li class="error" style="display: none;">请选择乡镇/街道</li> </ul> ';if(window.__g.isGlobalPay&&window.locker.globalPayIdCard){out+=' ';if(add.idCard){out+=' <p class="tips tips_lager">身份证号 '+(add.idCard)+'<span class="card_edit" id="editIdcard"><i class="edit_v2"></i></span></p> ';}
out+=' <div class="idcard" id="idcardEditArea" ';if(add.idCard){out+=' style="display:none;" ';}
out+='> <input type="text" id="idcardInfo" placeholder="请填写收货人('+(tipName)+')的身份证号"> <p> <span class="close" id="clearIdcard"><i class="close_v2"></i></span> <span class="button ';if(!add.idCard){out+=' disable ';}
out+='" id="saveUserIdcard">保存</span>             </p> </div> <p class="tips color_gray ';if(!add.idCard){out+=' color_red ';}
out+='" id="idCardErrTip">因海关政策要求，购买海囤全球商品需填写收货人<span ';if(!add.idCard){out+=' style="display:none;" ';}
out+='>('+(add.name)+')</span>的身份证号</p> ';}
out+='  <p class="tips color_red" id="globalSalTip" style="display:none;">目的国/地区如产生关税费用，需客户自行承担，请知悉</p>';return out;;}
exports.child_tplAddressNeedUpdate=function(it){var out=' ';if(it.addrToTitle){out+=' <h3>'+(it.addrToTitle)+'</h3> ';}
out+=' <ul> <li><strong>'+(it.name+' '+it.mobile)+'</strong></li> <li class="address">'+(it.provinceName+it.cityName+it.countyName+it.townName)+'</li> <!--S 区域选择框--> ';if(it.level=='3'){out+=' <div class="mod_select"> <select id="townSelect" adid="'+((it.adid||''))+'"> <option value="0">请选择乡镇/街道</option>'+(it.optionHtml)+' </select> <p>为方便您更快收货，请选择乡镇/街道</p> </div> ';}else if(it.level=='2'){out+=' <!-- 出错状态 --> <div class="mod_select"> <select id="countySelect" adid="'+((it.adid||''))+'"> <option value="0">请选择区县</option>'+(it.optionHtml)+' </select> <p>为方便您更快收货，请选择区县</p> </div> ';}
out+=' <!--E 区域选择框--> <li class="address">'+(it.addrdetail)+'</li> </ul>';return out;;}
exports.child_tplAddressList=function(it){var out=' ';for(var i=0,l=it.list.length;i<l;i++){var e=it.list[i];out+=' <div class="address"> <ul adid="'+(e.adid)+'" type="'+(e.type)+'" upgrade="'+(e.need_upgrade)+'" ';if(e.need_upgrade=="1"){out+=' class="disabled" ';}
out+=' addrid="'+([e.provinceId,e.cityId,e.countyId,e.townId].join('_'))+'" addrname="'+([e.provinceName,e.cityName,e.countyName,e.townName].join('_'))+'" addrdetail="'+(e.addrfull||e.provinceName+e.cityName+e.countyName+e.townName+e.addrdetail)+'"> <li> ';if(e.default_address=='1'){out+='<span class="tag tag_red">默认</span>';}
out+=''+(e.addrfull||e.provinceName+e.cityName+e.countyName+e.townName+e.addrdetail)+' ';if(e.label&&e.label!=e.name&&e.label!="undefined"){out+='<span class="tag">'+(e.label)+'</span>';}
out+=' </li> <li><strong>'+(e.name)+'</strong> '+(e.mobile)+'</li> ';if(e.need_upgrade=='1'){out+=' <li><em>京东地址库已升级，请修改地址</em></li> ';}
out+=' ';if(window.__g.isGlobalPay&&window.locker.globalPayIdCard){out+=' ';if(e.idCard){out+=' <li><strong>身份证号</strong> '+(e.idCard)+'</li> ';}else{out+=' <li><em>需填写收货人的身份证号</em></li> ';}
out+=' ';}
out+=' <li class="edit" adid="'+(e.adid)+'" type="'+(e.type)+'">编辑</li> </ul> <p class="act" adid="'+(e.adid)+'" type="'+(e.type)+'"><span class="del">删除</span></p> </div> ';}
out+=' ';if(!it.wgAddr){out+=' <div class="address_list_link" id="addressLink"> <a id="addAddress" href="javascript:void(0);" class="item item_new" style="display: none;">新增收货地址</a> <a id="addAddressFromWx" href="javascript:void(0);" class="item item_wx" style="display: none;">从微信选择地址</a> <a id="qqAddrBtn" href="javascript:void(0);" class="item item_wx" style="display: none;">从QQ选择地址</a> </div> ';}
out+='';return out;;}
exports.child_shipAddrListV2=function(it){var out=' <div class="address_list"> ';for(var i=0,l=it.list.length;i<l;i++){var e=it.list[i];out+=' <div class="address"> <ul adid="'+(e.adid)+'" type="'+(e.type)+'" upgrade="'+(e.need_upgrade)+'" ';if(e.need_upgrade=="1"){out+=' class="disabled" ';}
out+=' addrid="'+([e.provinceId,e.cityId,e.countyId,e.townId].join('_'))+'" addrname="'+([e.provinceName,e.cityName,e.countyName,e.townName].join('_'))+'" addrdetail="'+(e.addrfull)+'" > <li><strong>'+(e.name)+'</strong>&nbsp;<strong>'+(e.mobile)+'</strong></li> <li> ';if(e.default_address=='1'){out+=' <span class="tag tag_red">默认</span> ';}
out+=' ';if(e.label&&e.label!=e.name&&e.label!="undefined"){out+=' <span class="tag">'+(e.label)+'</span> ';}
out+=' '+(e.addrfull||e.provinceName+e.cityName+e.countyName+e.townName+e.addrdetail)+' </li> ';if(e.need_upgrade=='1'){out+=' <li><em>京东地址库已升级，请修改地址</em></li> ';}
out+=' ';if(window.__g.isGlobalPay&&window.locker.globalPayIdCard){out+=' ';if(e.idCard){out+=' <li><strong>身份证号</strong> '+(e.idCard)+'</li> ';}else{out+=' <li><em>需填写收货人的身份证号</em></li> ';}
out+=' ';}
out+=' <li class="edit" adid="'+(e.adid)+'" type="'+(e.type)+'">编辑</li> </ul> <p class="act" adid="'+(e.adid)+'" type="'+(e.type)+'"><span class="del">删除</span></p> </div> ';}
out+=' </div> <div> <div class="address_list_link" style="margin-bottom: 66px;"> <div class="address_list" tag="wx" style="display: none;"> <div class="address_list_link"> <a href="javascript:void(0);" class="item item_self no_top_line"><span>微信地址</span><span class="item_wx_select_tip">点击选择</span></a> </div> </div> <div class="address_list" tag="sq" style="display: none;"> <div class="address_list_link"> <a href="javascript:void(0);" class="item item_self no_top_line"><span>QQ地址</span><span class="item_wx_select_tip">点击选择</span></a> </div> </div> </div> </div> <div class="mod_btns fixed" tag="jd" style="display: none;"> <a href="javascript:void(0);" class="mod_btn bg_1">新增收货地址</a> </div>';return out;;}
exports.child_tplAddressSlide=function(it){var out=' <div class="mod_address_slide_main type_flex"> <div class="mod_address_slide_head">选择详细地址<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_list_1"> ';for(var i=0,l=it.list.length;i<l;i++){var e=it.list[i];out+=' <li ';if(e.need_upgrade=="1"){out+=' class="disabled" ';}
out+=' adid="'+(e.adid)+'">  ';if(e.default_address=='1'){out+='<span class="mod_address_slide_list_1_tag_default">默认</span>';}
out+=' ';if(e.label&&e.label!=e.name){out+='<span class="mod_address_slide_list_1_tag">'+(e.label)+'</span>';}
out+=' '+(e.addrfull||e.provinceName+e.cityName+e.countyName+e.townName+e.addrdetail)+' ';if(e.need_upgrade=='1'){out+=' <p class="mod_address_slide_list_1_warn">京东地址库已升级，请修改地址</p> ';}
out+=' ';if(window.__g.isGlobalPay&&window.locker.globalPayIdCard&&!e.idCard){out+=' <p class="mod_address_slide_list_1_warn">需完善身份信息</p> ';}
out+='  <i class="mod_address_slide_list_1_edit"></i> </li> ';}
out+='  ';if(it.showAddButton===true){out+=' <li class="mod_address_slide_list_1_more" id="add_slide"> <span class="mod_address_slide_list_1_moretext">新增收货地址<i class="type_add"></i></span> </li> ';}
out+=' </ul> </div> </div>';return out;;}
exports.child_tplPageAddAddress=function(it){var out=' <p><label for=""><span class="tit">收货人</span><input id="name" type="text" value="'+(it.name)+'" placeholder="姓名"></label></p> <p class="label_flex"> <label for=""><span class="tit">联系方式</span> <span class="foreign_prefix" id="areaCode" style="display:none;"></span> <input id="mobile" value="'+(it.mobile)+'" type="tel" placeholder="手机号码" maxlength="17"></label> </p> ';if(window.__g.isGlobalPay&&window.locker.globalPayIdCard){out+=' <p> <label for="idCard"><span class="tit">身份证号</span><input id="idCard" type="text" placeholder="请填写18位中国大陆身份证号" value="'+(it.idCard)+'"></label> <span id="idCardTips" class="tips">因海关政策要求，购买海囤全球商品需填写收货人的身份证号</span> </p> ';}
out+='  <p class="street_detail selAddr" id="selAddr"> <label for=""><span class="tit">所在地区</span> <input type="text" placeholder="选择所在地区" readonly="readonly"></label> <i class="arrow"></i> </p> <p class="street_detail" id="adinfoP"> <label for=""><span class="tit">详细地址</span> <textarea placeholder="详细地址需填写楼栋楼层或房间号信息" id="adinfo" value="'+(it.adinfo||'')+'" rows="2">'+(it.adinfo||'')+'</textarea> <i class="close" id="info_clear"></i> </label><span class="btn_complete" id="info_sure">完成</span> </p> <p id="g_emailP" style="display:none;"><label for=""><span class="tit">邮箱</span><input id="g_email" value="'+(it.email||'')+'" type="text" placeholder="必填"></label></p> <p id="g_postcodeP" style="display:none;"><label for=""><span class="tit">邮编</span><input id="g_postcode" value="'+(it.postcode||'')+'" type="text" placeholder="必填"></label></p> <p id="g_phoneP" style="display:none;"><label for=""><span class="tit">固定电话</span><input id="g_phone" value="'+(it.phone||'')+'" type="text" placeholder="选填"></label></p> <p class="address_tags" id="adlabelP" value="'+(it.label||'')+'"> <span class="tit">地址标签</span> <span class="address_tags_tag" value="公司">公司</span> <span class="address_tags_tag" value="家">家</span> <span class="address_tags_tag" value="学校">学校</span> <span class="address_tags_tag user_tag" value="" ';if(it.label&&['公司','家','学校'].indexOf(it.label)==-1){out+='style="display:none;"';}
out+='> 自定义<i class="address_tags_close"></i> </span>  <span class="address_tags_tag_wrap" ';if(!it.label||(it.label&&['公司','家','学校'].indexOf(it.label)>-1)){out+='style="display:none;"';}
out+='> <span class="address_tags_tag cur" id="userLabelVal" value="'+(it.label||'')+'">'+(it.label||'')+'</span> <span class="address_tags_edit"></span> </span> </p> <div class="checkbox_select" style="display:none;" id="editAddrSetDef">设为默认地址</div> <div class="fuzzy_search" id="fuzzySearch"> <ul class="result_list" id="tenSuggest"></ul> </div> <div class="mod_btns"> <a href="javascript:void(0);" class="mod_btn bg_1" id="submitAddress">确认</a> </div> ';if(it.type){out+=' <div class="mod_btns"> <a href="javascript:void(0);" class="mod_btn bg_" id="delAddress">删除收货地址</a> </div> ';}
out+='';return out;;}
exports.child_tplNullAddress=function(it){var out=' <p><label><span class="tit">收货人</span><input id="name" type="text" placeholder="姓名"></label></p> <p><label for=""><span class="tit">联系方式</span><input id="mobile" type="tel" placeholder="手机号码 "></label></p> ';if(window.__g.isGlobalPay&&window.locker.globalPayIdCard){out+=' <p> <label for="idCard"><span class="tit">身份证号</span><input id="idCard" type="text" placeholder="请填写18位中国大陆身份证号"></label> <span id="nullIdCardTips" class="tips">因海囤全球商品涉及入境清关，根据海关规定，需要您完善收货人身份证信息；目前仅支持18位中国大陆身份证件</span> </p> ';}
out+='  <p class="street_detail selAddr" id="selAddr"> <label for=""><span class="tit">省市区县</span> <input type="text" placeholder="选择省市区县" readonly="readonly"></label> <i class="arrow"></i> </p> <p class="street_detail" id="adinfoP"> <label for=""><span class="tit">详细地址</span> <textarea placeholder="街道地址" id="adinfo" value="" rows="2"></textarea> <i class="close" id="info_clear"></i> </label><span class="btn_complete" id="info_sure">完成</span> <span class="tips">详细地址需填写楼栋楼层或房间号信息</span> </p> <p class="address_tags" id="adlabelP" value=""> <span class="tit">地址标签</span> <span class="address_tags_tag" value="公司">公司</span> <span class="address_tags_tag" value="家">家</span> <span class="address_tags_tag" value="学校">学校</span> <span class="address_tags_tag user_tag" value=""> 自定义<i class="address_tags_close"></i> </span>  <span class="address_tags_tag_wrap" style="display:none;"> <span class="address_tags_tag cur" id="userLabelVal" value=""></span> <span class="address_tags_edit"></span> </span> </p> <div class="fuzzy_search" id="fuzzySearch"> <ul class="result_list" id="tenSuggest"></ul> </div> <div class="mod_btns"> <a href="javascript:void(0);" class="mod_btn bg_1" id="submitAddress">确认</a> </div>';return out;;}
exports.child_userLabelTpl=function(it){var out=' <div class="mod_alert_mask show" style="display:none;"></div> <div class="mod_alert mod_alert_info fixed show" id="userLabelDiv"> <h3 class="title">自定义标签名称</h3> <div class="input_wrap"><input type="text" id="labelInput" maxlength="8" placeholder="标签最多填写八个字"></div> <p class="btns"> <a href="javascript:void(0)" id="labelCancel" class="btn btn_2">取消</a> <a href="javascript:void(0)" id="labelSure" class="btn btn_1">确认</a> </p> </div>';return out;;}
exports.child_addrselTpl=function(it){var out=' <div class="mod_address_slide show" id="addrSelDiv" style="display:none;"> <div class="mod_address_slide_main type_flex"> <div class="mod_address_slide_head">所在地区<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_tabs_1" id="addrNav"></ul> <ul class="mod_address_slide_list_2" id="addrList"></ul> </div> </div> </div>';return out;;}
exports.child_addrTipTpl=function(it){var out=' <div id="addrTipAlert" class="mod_alert mod_alert_addressChoosing fixed"> <span class="close" id="tip_close"></span> <h1 class="title">更换地址</h1> <p class="alignLeft" style="margin-top: 10px;">您在浏览商品时切换了地址，是否匹配更换</p> <ul class="addressChoosing_list"> ';for(var i=0;i<it.length;i++){var item=it[i];out+=' <li class="item ';if(i==0){out+=' selected ';}
out+='" adid="'+(item.adid)+'" addrid="'+([item.provinceId,item.cityId,item.countyId,item.townId].join('_'))+'" addrname="'+([item.provinceName,item.cityName,item.countyName,item.townName].join('_'))+'" addrdetail="'+(item.addrfull)+'">'+(item.addrfull)+'</li> ';}
out+=' </ul> <p class="btns"> <a href="javascript:void(0);" id="tip_newAddr" class="btn btn_1">新建地址</a> <a href="javascript:void(0);" id="tip_confirm" class="btn btn_2">确认</a> </p> </div>';return out;;}});
define('formatJson',function(require,exports,module){var _cacheThisModule_;var _formatJson_cache={};$formatJson=function(str,data){var fn=!/\W/.test(str)?_formatJson_cache[str]=_formatJson_cache[str]||$formatJson(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join(String.fromCharCode(9)).replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split(String.fromCharCode(9)).join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return data?fn(data):fn;}
exports.formatJson=$formatJson;});
define("ajax",function(require,exports,module){var _cacheThisModule_;var loading=false;var dataCache={};var ajaxSettings={type:'GET',success:empty,error:empty,complete:empty,load:empty,context:null,global:true,retryCount:0,globalLock:0,lockCallback:null,cgiKey:false,setCache:function(data){if(!this.cgiKey){throw Error("cgiKey不能为空");}
dataCache[this.cgiKey]=data;},degrade:false,xhr:function(){return new window.XMLHttpRequest()},ump:{bizId:'',opId:'',ret:'errCode,errcode,retCode,retcode,ret,errId,iRet,ret_code',errBizId:'',errOpId:'',errRetId:1,reportHook:null},dataType:'json',accepts:{script:'text/javascript, application/javascript, application/x-javascript',json:'application/json',xml:'application/xml, text/xml',html:'text/html',text:'text/plain'},crossDomain:false,timeout:8,processData:true,cache:false,wqunit:/[?&]_wqunit_=1/.test(location.search),setReportUrl:""}
var globallKey="";if(window.JD){if(!JD.ajax)JD.ajax={};globallKey=JD.ajax;}else{globallKey=window;}
if(!globallKey.callbackName){var callbackSuffix=['A','B','C','D','E','F','G','H','I','J','K',"L",'M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(var i=0;i<3;i++){for(var j=0;j<26;j++){callbackSuffix.push(callbackSuffix[i*26+j]+callbackSuffix[j]);}}
globallKey.callbackName=callbackSuffix;}
globallKey.ajaxCount=globallKey.ajaxCount||0;var reportUrl="";var sceneval=window.JD&&JD.url&&JD.url.getUrlParam("sceneval")||(/(\.|^)m\.jd\.com/.test(window.location.hostname)?2:0);var isRequestNum=0;exports.load=ajax;var g_login_type=(function detectPTK(){var ua=navigator.userAgent.toLowerCase();var type=0;if(window.JD&&JD.wxapp&&JD.wxapp.wxappType==3){type=1;}else if(sceneval){type=1;}else if(/jdapp;/.test(ua)){type=1;}
return type;})();exports.addToken=addToken;function assign(config){config=config||{};var arg=arguments;for(var i=1,len=arg.length;i<len;i++){for(var key in arg[i]){if(typeof arg[i][key]=="object"){config[key]=assign(config[key],arg[i][key]);}else if(typeof config[key]=="undefined"){config[key]=arg[i][key];}}}
return config;}
function ajax(options){if(!options)return false;var settings=assign(options,ajaxSettings);if(settings.globalLock){if(loading){console.log("ajax loading ...");typeof settings.lockCallback=='function'&&settings.lockCallback();return false;}
loading=true;}
if(settings.cgiKey){window.cgiData=dataCache;}
if(settings.cgiKey&&dataCache[settings.cgiKey]){console.log("ajax命中临时缓存");settings.isCache=1;ajaxSuccess(dataCache[settings.cgiKey],"",settings);return false;}
if(location.hostname=="ppms.jd.com"){settings.dataType='jsonp';}
settings.url=settings.url.replace(/^http:/,"");if(settings.setReportUrl&&typeof settings.setReportUrl=="function"){reportUrl=settings.setReportUrl();!reportUrl&&(reportUrl=settings.url);}else{reportUrl=window.CGI302ReportKeepUrl?settings.url:settings.url.replace(/\?.*/,'');}
if(!settings.crossDomain)settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host;if(settings.crossDomain)settings.xhrFields={withCredentials:true};if(!settings.url)settings.url=window.location.toString();serializeData(settings);var dataType=settings.dataType,hasPlaceholder=/\?.+=\?/.test(settings.url);if(hasPlaceholder)dataType='jsonp';if(settings.cache===false||((!options||options.cache!==true)&&('script'==dataType||'jsonp'==dataType)))
settings.url=appendQuery(settings.url,'_='+Date.now());if(!options.noSceneVal&&sceneval){settings.url=appendQuery(settings.url,'sceneval='+sceneval);}
settings.url=appendQuery(settings.url,'g_login_type='+g_login_type);if('jsonp'==dataType||settings.wqunit){if(!hasPlaceholder){settings.urlbak=settings.url;settings.url=appendQuery(settings.url,settings.jsonp?(settings.jsonp+'=?'):settings.jsonp===false?'':'callback=?')}
settings.url=addToken(settings.url,"ls");return ajaxJSONP(settings)}
if(settings.type.toLowerCase()=='post'&&settings.jsonpCallback){settings.url=addToken(settings.url,"fr");return ajaxPost(settings);}
if(/[?&]ajaxtest=1/.test(location.search)&&dataType=='json')settings.url=settings.url.replace("http://wq.jd.com","http://wqs.jd.com");settings.url=addToken(settings.url,"ajax");if(window.JD){settings.url=JD.url.getCgiUrl(settings.url);}
var mime=settings.accepts[dataType],headers={},setHeader=function(name,value){headers[name.toLowerCase()]=[name,value]},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=settings.xhr(),nativeSetHeader=xhr.setRequestHeader,abortTimeout;if(!settings.crossDomain)setHeader('X-Requested-With','XMLHttpRequest')
setHeader('Accept',mime||'*/*');if(mime=settings.mimeType||mime){if(mime.indexOf(',')>-1)mime=mime.split(',',2)[0];xhr.overrideMimeType&&xhr.overrideMimeType(mime)}
if(settings.contentType||(settings.contentType!==false&&settings.data&&settings.type.toUpperCase()!='GET'))
setHeader('Content-Type',settings.contentType||'application/x-www-form-urlencoded')
if(settings.headers)for(name in settings.headers)setHeader(name,settings.headers[name]);xhr.setRequestHeader=setHeader;xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;clearTimeout(abortTimeout);var result,error=false;if((xhr.status>=200&&xhr.status<300)||xhr.status==304||(xhr.status==0&&protocol=='file:')){dataType=dataType||mimeToDataType(settings.mimeType||xhr.getResponseHeader('content-type'));result=xhr.responseText;try{if(dataType=='script')(1,eval)(result)
else if(dataType=='xml')result=xhr.responseXML
else if(dataType=='json')result=/^\s*$/.test(result)?null:parseJSON(result)}catch(e){error=e}
if(error)ajaxError(error,'parsererror',xhr,settings)
else ajaxSuccess(result,xhr,settings)}else{console.log("ajax error",xhr);ajaxError(xhr.statusText||null,"load",xhr,settings)}}}
var async='async'in settings?settings.async:true;xhr.open(settings.type,settings.url,async,settings.username,settings.password);if(settings.xhrFields)for(name in settings.xhrFields)xhr[name]=settings.xhrFields[name];for(name in headers)nativeSetHeader.apply(xhr,headers[name]);if(settings.timeout>0)abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty;xhr.abort();ajaxError(null,'timeout',xhr,settings);},settings.timeout*1000);xhr.send(settings.data?settings.data:null);return xhr}
function parseJSON(data){if(!data||typeof(data)!="string"){return data;}
data=data.replace(/^\s+|\s+$/g,"");if(!data)return data;return JSON.parse(data);};function sendUB(data,type){window.JD&&JD.sendJs("//wq.jd.com/ubanalysis?t=t_ajax&d="+isRequestNum+"&tp="+type);}
function ajaxJSONP(options){var callbackName;if(/(http(s)?:)?\/\/wq(coss)?\.jd\.com\/mcoss\//.test(options.url)&&window.JD&&JD.cgi.getCallback){callbackName=JD.cgi.getCallback(options.url);}
if(!callbackName){var _callbackName=options.jsonpCallback;callbackName=(typeof _callbackName=='function'?_callbackName():_callbackName)||('jsonpCBK'+(globallKey.callbackName[(globallKey.ajaxCount++)%globallKey.callbackName.length]));}
var script=document.createElement('script'),responseData,xhr={abort:abort},abortTimeout,abort=function(errorType){isTimeout=1;isRequestNum--;console.log(options.url,"timeout");sendUB(isRequestNum,"timeout");ajaxError(null,"timeout",xhr,options);},isTimeout=0;options.callbackName=callbackName;script.charset=options.charset||"utf-8";isRequestNum++;script.onload=script.onerror=function(e,errorType){clearTimeout(abortTimeout);if(isTimeout){console.log("timeout");return false;}
isRequestNum--;if(e.type=='error'){console.log(options.url,errorType||e.type||'error');sendUB(isRequestNum,"error");ajaxError(null,'error',xhr,options);}else if(!responseData){sendUB(isRequestNum,"load");ajaxError(null,e.type,xhr,options);window.onerror('','','','',{stack:'servererror:'+reportUrl});}else{if(responseData[0]&&responseData[0].retcode==-1&&responseData[0].message=="没有找到"&&responseData[0].unitReload==1){options.wqunit=false;options.url=options.urlbak;ajax(options);}else{ajaxSuccess(responseData[0],xhr,options);}}
responseData=undefined;script.parentNode.removeChild(script);}
window[callbackName]=function(){responseData=arguments;}
options.url=options.url.replace(/\?(.+)=\?/,'?$1='+callbackName);script.src=options.url;if(options.wqunit){script.src="http://ppms.jd.com/wqunit/unittest?pageUrl="+encodeURIComponent(location.href)+"&cgiUrl="+encodeURIComponent(script.src)+"&callback="+callbackName;}
document.head.appendChild(script);if(options.timeout>0)abortTimeout=setTimeout(function(){abort('timeout');},options.timeout*1000);return xhr;}
function ajaxPost(options){var _callbackName=options.jsonpCallback,callbackName=(typeof _callbackName=='function'?_callbackName():_callbackName)||('jsonpCBK'+(callbackSuffix[(jsonpID++)%callbackSuffix.length])),abortTimeout,xhr={abort:abort},abort=function(errorType){isTimeout=1;console.log(options.url,"timeout");ajaxError(null,"timeout",xhr,options);},isTimeout=0;window[callbackName]=function(){clearTimeout(abortTimeout);responseData=arguments;var form=document.getElementById("ajaxPostForm");form&&form.remove();var iframe=document.getElementById("ajaxPostIframe");iframe&&iframe.remove();ajaxSuccess(responseData[0],xhr,options);}
options.data.callback=callbackName;options.data.g_tk=getToken();formPost(options,options.isFile);if(options.timeout>0)abortTimeout=setTimeout(function(){window[callbackName]=empty;abort('timeout');},options.timeout*1000);}
function formPost(options,isFile){var form=document.getElementById("ajaxPostForm");var iframe=document.getElementById("ajaxPostIframe");if(!form){form=document.createElement("form");form.id="ajaxPostForm";iframe=document.createElement("iframe");iframe.height=0;iframe.width=0;iframe.id=iframe.name="ajaxPostIframe";iframe.style.display="none";form.style.display="none";document.body.appendChild(iframe);document.body.appendChild(form);}
$("input",form).remove();for(var i in options.data){var tempInput=document.createElement("input");$(form).append($(tempInput).attr("type","hidden").attr("name",i).attr("value",options.data[i]));}
form.target="ajaxPostIframe";form.action=options.url;form.method="POST";form.enctype=isFile?"multipart/form-data":"application/x-www-form-urlencoded";form.submit();}
function bizUmp(settings,data){var ump=settings.ump;if(!data||!ump||!ump.bizId||!ump.opId)return;var code={code:"2000",message:"default"};if(typeof ump.reportHook=="function"){code=ump.reportHook.call(null,data);}else if(ump.ret){var ret=ump.ret.split(",");for(var k in ret){if(ret[k]&&typeof data[ret[k]]!="undefined"){code={code:data[ret[k]]};break;}}}else{code={code:1000,message:"not find report code"};}
umpReport(ump.bizId,ump.opId,code.code,code.message);}
function bizUmpE(settings,code){var ump=settings.ump;if(!ump)return;if(!ump.errBizId||!ump.errOpId){if(!ump.ret)return;var ret=ump.ret.split(",")[0];bizUmp(settings,{ret:code});return;}
umpReport(ump.errBizId,ump.errOpId,ump.errRetId,code);}
function umpReport(biz,op,result,msg){JD.report.umpBiz({bizid:biz,operation:op,result:result,source:'0',message:msg||''});}
function ajaxSuccess(data,xhr,settings){settings.globalLock&&(loading=false);var context=settings.context,status='success';bizUmp(settings,data);settings.success.call(context,data,settings,status,xhr);ajaxComplete(status,xhr,settings);}
function ajaxError(error,type,xhr,settings,deferred){if(settings.retryCount<=0||settings.type.toLowerCase()=='post'){ajaxErrorCallback(error,type,xhr,settings);return;}
if(["error","parsererror"].indexOf(type)>=0){ajaxErrorCallback(error,type,xhr,settings);return;}
setTimeout(function(){settings.url=settings.url.replace(/(&)?(_|g_tk|g_ty|callback)=\w+/g,"");console.log("start retry,"+settings);settings.retryCount--;settings.globalLock&&(loading=false);ajax(settings);},0);}
function ajaxErrorCallback(error,type,xhr,settings){settings.globalLock&&(loading=false);var context=settings.context;console.log(settings.url,type,error);if(settings.degrade){console.log("降级",settings.degrade);settings.isDegrade=1;settings.success.call(context,settings.degrade,settings);}
var code={timeout:8000,error:5000,load:3020,abort:5001,parsererror:3021};bizUmpE(settings,code[type]);settings.error.call(context,type,code[type]||9000,settings,error,xhr);ajaxComplete(type,xhr,settings);}
function ajaxComplete(status,xhr,settings){var context=settings.context;settings.complete.call(context,status,xhr);}
function empty(){}
function serializeData(options){if(options.processData&&options.data&&typeof options.data!="string"){if(options.type.toLowerCase()=='post'&&options.jsonpCallback){return;}
options.data=param(options.data);}
if(options.data&&(!options.type||options.type.toUpperCase()=='GET'))
options.url=appendQuery(options.url,options.data),options.data=undefined}
function mimeToDataType(mime){if(mime)mime=mime.split(';',2)[0]
return mime&&(mime==htmlType?'html':mime==jsonType?'json':scriptTypeRE.test(mime)?'script':xmlTypeRE.test(mime)&&'xml')||'text'}
function appendQuery(url,query){if(query=='')return url
return(url+'&'+query).replace(/[&?]{1,2}/,'?')}
function addToken(url,type){var token=getToken();if(url==""||(url.indexOf("://")<0?location.href:url).indexOf("http")!=0){return url;}
if(url.indexOf("#")!=-1){var f1=url.match(/\?.+\#/);if(f1){var t=f1[0].split("#"),newPara=[t[0],"&g_tk=",token,"&g_ty=",type,"#",t[1]].join("");return url.replace(f1[0],newPara);}else{var t=url.split("#");return[t[0],"?g_tk=",token,"&g_ty=",type,"#",t[1]].join("");}}
return token==""?(url+(url.indexOf("?")!=-1?"&":"?")+"g_ty="+type):(url+(url.indexOf("?")!=-1?"&":"?")+"g_tk="+token+"&g_ty="+type);};function getToken(){var skey=getCookie("wq_skey"),token=skey==null?"":time33(skey);return token;};function time33(str){for(var i=0,len=str.length,hash=5381;i<len;++i){hash+=(hash<<5)+str.charAt(i).charCodeAt();};return hash&0x7fffffff;}
function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]):""):null;}
var escape=encodeURIComponent;function serialize(params,obj){for(var key in obj){params.add(key,obj[key]);}}
function param(obj){var params=[];params.add=function(k,v){this.push(escape(k)+'='+escape(v));};serialize(params,obj);return params.join('&').replace(/%20/g,'+');}
window.addEventListener('message',function(e){if(!e||!e.data)return false;var callback=e.data.callback;if(callback&&window[callback]){window[callback](e.data.data);}});});
define('md5',function(require,exports,module){var _cacheThisModule_;exports.getHash=getHash;var rotateLeft=function(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}
var addUnsigned=function(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4)return(lResult^0x80000000^lX8^lY8);if(lX4|lY4){if(lResult&0x40000000)return(lResult^0xC0000000^lX8^lY8);else return(lResult^0x40000000^lX8^lY8);}else{return(lResult^lX8^lY8);}}
var F=function(x,y,z){return(x&y)|((~x)&z);}
var G=function(x,y,z){return(x&z)|(y&(~z));}
var H=function(x,y,z){return(x^y^z);}
var I=function(x,y,z){return(y^(x|(~z)));}
var FF=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(F(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var GG=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(G(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var HH=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(H(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var II=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(I(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var convertToWordArray=function(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWordsTempOne=lMessageLength+8;var lNumberOfWordsTempTwo=(lNumberOfWordsTempOne-(lNumberOfWordsTempOne%64))/64;var lNumberOfWords=(lNumberOfWordsTempTwo+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}
lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;};var wordToHex=function(lValue){var WordToHexValue="",WordToHexValueTemp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValueTemp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValueTemp.substr(WordToHexValueTemp.length-2,2);}
return WordToHexValue;};var uTF8Encode=function(string){string=string.replace(/\x0d\x0a/g,"\x0a");var output="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){output+=String.fromCharCode(c);}else if((c>127)&&(c<2048)){output+=String.fromCharCode((c>>6)|192);output+=String.fromCharCode((c&63)|128);}else{output+=String.fromCharCode((c>>12)|224);output+=String.fromCharCode(((c>>6)&63)|128);output+=String.fromCharCode((c&63)|128);}}
return output;};function getHash(string){var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=uTF8Encode(string);x=convertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD);}
var tempValue=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return tempValue.toLowerCase();}});
define('ui',function(require,exports,module){var _cacheThisModule_,container=document.body,removeAlertCoverDiv=0;var bInit1111Tips=false;var goLink="//wqs.jd.com/my/mywx1111.shtml?p=my1111Record";var alertCoverDiv=document.createElement('div');alertCoverDiv.className='mod_alert_mask show';function notNeedLoadCss(){var uiCSSUrl2='base/gb/css/gb.min_',uiCSSUrl3='wx/gb/css/gb.min_',uiCSSUrl4='sq/gb/css/gb.min_',uiCSSUrl6='wxsq_dev/gb/css/gb.min_',uiCSSUrl7='wxsq_dev/gb/css/failover_gb.min_',uiCSSUrl5='mod_alert.min',uiCSSUrl8='page_hdcp/gb/css/gb.min_',uiCSSUrl9='nb1807/gb/css/gb.min_',links=document.getElementsByTagName('link'),isHave=false;var homeUrl=window.JD?JD.url.homeUrl:'//wq.jd.com/mcoss/wxportal/mainentry?tpl=index_v5';if(location.href.indexOf(homeUrl)>-1){isHave=true;}
for(var i=0,l=links.length;i<l;i++){if(links[i].rel=='stylesheet'&&(links[i].href.indexOf(uiCSSUrl2)>=0||links[i].href.indexOf(uiCSSUrl3)>=0||links[i].href.indexOf(uiCSSUrl4)>=0||links[i].href.indexOf(uiCSSUrl5)>=0||links[i].href.indexOf(uiCSSUrl8)>=0||links[i].href.indexOf(uiCSSUrl9)>=0||links[i].href.indexOf(uiCSSUrl6)>=0)||links[i].href.indexOf(uiCSSUrl7)>=0){isHave=true;break;}}
return isHave;}
function loadCss(url){if(notNeedLoadCss()){return;}
var l=document.createElement('link');l.setAttribute('type','text/css');l.setAttribute('rel','stylesheet');l.setAttribute('href',url);document.getElementsByTagName("head")[0].appendChild(l);}
function showTip(obj){if(!obj)return;var className=obj.className||'g_small_tips',tips=document.querySelector("."+className),t=obj.t||2000,title=obj.title||'操作成功!';if(!tips){tips=document.createElement('div');tips.className=className;document.body.appendChild(tips);}
tips.innerText=title;tips.style.display='block';setTimeout(function(){tips.style.display='none';},t);}
function extend(a,b){for(var i in b){if(b.hasOwnProperty(i)){a[i]=b[i];}}
return a;}
function info(opts){var option={msg:"",icon:"none",delay:2000,showcoverdiv:false};opts=opts||{};extend(option,opts);var el=document.createElement('div');el.className="mod_alert show fixed";el.innerHTML=(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p>';container.appendChild(el);if(option.showcoverdiv){document.body.appendChild(alertCoverDiv);removeAlertCoverDiv++;}
setTimeout(function(){clear();},option.delay);function clear(){if(option.showcoverdiv){removeAlertCoverDiv--;removeAlertCoverDiv<1&&document.body.contains(alertCoverDiv)&&document.body.removeChild(alertCoverDiv);}
el.style.display='none';container.contains(el)&&container.removeChild(el);}}
function alert(opts){var option={showClose:false,msg:"",confirmText:'确认',icon:"none",onConfirm:null,stopMove:false,btnClass:'btn_1',confirmColor:""},stopMove=function(e){e.preventDefault();},el=document.createElement('div');opts=opts||{};extend(option,opts);option.delay=parseInt(option.delay||0);container=opts.container||container;el.className="mod_alert show fixed";el.innerHTML=(option.showClose?'<span class="close"></span>':'')+(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p>'+(option.subMsg?'<p class="small">'+option.subMsg+'</p>':'')+'<p class="btns"><a href="javascript:;" '+(option.confirmColor?('style="color:'+option.confirmColor+'"'):'')+' class="btn '+option.btnClass+'">'+option.confirmText+'</a></p>';container.appendChild(el);option.showClose&&(el.querySelector(".close").onclick=function(e){option.onCancel&&option.onCancel();this.onclick=null;clear();});el.querySelector(".btn").onclick=function(e){option.onConfirm&&option.onConfirm();this.onclick=null;clear();};option.delay&&setTimeout(function(){clear();},option.delay);document.body.appendChild(alertCoverDiv);option.stopMove&&document.addEventListener("touchmove",stopMove,false);removeAlertCoverDiv++;function clear(){removeAlertCoverDiv--;removeAlertCoverDiv<1&&document.body.contains(alertCoverDiv)&&document.body.removeChild(alertCoverDiv);el.style.display='none';container.contains(el)&&container.removeChild(el);option.stopMove&&document.removeEventListener("touchmove",stopMove,false);}}
function confirm(opts){var option={msg:"",icon:"none",okText:"确定",cancelText:"取消",onConfirm:null,onCancel:null,onClearCb:null,okClass:'btn_1',cancelClass:'btn_1',cancelColor:"",confirmColor:""};opts=opts||{};extend(option,opts);container=opts.container||container;var el=document.createElement('div');el.className="mod_alert show fixed";el.innerHTML=(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p>'+(option.subMsg?'<p class="small">'+option.subMsg+'</p>':'')+'<p class="btns"><a href="javascript:;" id="ui_btn_confirm" '+(option.confirmColor?('style="color:'+option.confirmColor+'"'):'')+' class="btn '+option.okClass+'">'+option.okText+'</a><a href="javascript:;" id="ui_btn_cancel" '+(option.cancelColor?('style="color:'+option.cancelColor+'"'):'')+' class="btn '+option.cancelClass+'">'+option.cancelText+'</a></p>';container.appendChild(el);document.body.appendChild(alertCoverDiv);el.querySelector("#ui_btn_cancel").onclick=function(e){option.onCancel&&option.onCancel();clear();};el.querySelector("#ui_btn_confirm").onclick=function(e){option.onConfirm&&option.onConfirm();clear();};removeAlertCoverDiv++;function clear(){removeAlertCoverDiv--;el.style.display='none';container.contains(el)&&container.removeChild(el);removeAlertCoverDiv<1&&document.body.contains(alertCoverDiv)&&document.body.removeChild(alertCoverDiv);option.onClearCb&&option.onClearCb();}}
var toast=function(){var wrap=document.createElement('div');wrap.style.cssText='text-align: center; position: fixed; z-index: 310; top: 40%; width: 100%;';var main=document.createElement('p');var mainCssText='display: inline-block; padding: 10px 15px; background-color: rgba(0,0,0,.7); border-radius: 4px; color: #fff; font-size: 14px; text-align: left; word-break: break-all; max-width: 70%; transition: opacity .7s;';wrap.appendChild(main);var timeout;return function(opts){var _opts={msg:'',style:'',delay:2000};opts=typeof opts==='object'?opts:{msg:opts};_opts=extend(_opts,opts);main.innerText=_opts.msg;main.style.cssText=mainCssText+_opts.style;main.style.opacity='1';document.body.appendChild(wrap);clearTimeout(timeout);timeout=setTimeout(function(){main.style.opacity='0';timeout=setTimeout(function(){document.body.removeChild(wrap);},700);},_opts.delay);}}();loadCss(JD.url.getStaticDisRec("//wq.360buyimg.com/fd/h5/base/gb/css/mod_alert.min_79c590c3.css"));module.exports={showTip:showTip,toast:toast,info:info,alert:alert,confirm:confirm};});
define('payutil',function(require,exports,module){var $=require("zepto"),md5=require('md5'),ls=require('loadJs'),ajax=require('ajax'),ui=require('ui'),co=JD.cookie,ua=navigator.userAgent,REGEXP_IOS_QQ=/(iPad|iPhone|iPod).*? QQ\/([\d\.]+)/,REGEXP_QQ=/(QQ)\/([\d\.]+)/,isJdapp=/jdapp/i.test(ua),iswk=(-1!=ua.indexOf("supportJDSHWK/1"))||(window._is_jdsh_wkwebview==1),g={timeouter:'',bindJdCount:co.get('bindJdCount')||0,weixinadkey:getPPRD_PValue('ADKEY')||''},cgi={QueryPinStatus:'//wq.jd.com/pinbind/QueryPinStatus',getprovince:'//wqdeal.jd.com/deal/recvaddr/getprovince',checkRepeatOrder:'//wqdeal.jd.com/deal/massit/chkrepeatorder',reportTimeUrl:'//wq.jd.com/webreport/speed?page=',bindUrl:'//wqs.jd.com/my/bindpopupv2/index.shtml',},scene=JD.device.scene,wqapi=window.WQAPI,lh=location.href,fileName=lh.match(/[^\/\?]*(?=\?)/),euc=encodeURIComponent,loading=$('#wxloading'),loadCgiIndex=1,umpMap={},provMap={1:"北京市",2:"上海市",3:"天津市",4:"重庆市",5:"河北省",6:"山西省",7:"河南省",8:"辽宁省",9:"吉林省",10:"黑龙江省",11:"内蒙古",12:"江苏省",13:"山东省",14:"安徽省",15:"浙江省",16:"福建省",17:"湖北省",18:"湖南省",19:"广东省",20:"广西自治区",21:"江西省",22:"四川省",23:"海南省",24:"贵州省",25:"云南省",26:"西藏自治区",27:"陕西省",28:"甘肃省",29:"青海省",30:"宁夏省",31:"新疆自治区",32:"台湾",42:"香港",43:"澳门"};umpMap={'setgiftcard':19,'setbean':21,'getcouponlist':22,'setcouponlist':23,'rmvcmdy':27,'setpayship':28,'getveninfos':29,'QueryUserInfo':33};function getADKEY(){return getPPRD_PValue('ADKEY')||'';}
function getPPRD_PValue(prefix){var regs={QZGDT:/QZGDT\.([^\.\-]+)/gim,QZZTC:/QZZTC\.([^\.\-]+)/gim,ADKEY:/ADKEY\.([^\.\-]+)/gim,WQVERSION:/WQVERSION\.([^\.\-]+)/gim},pprd_p=JD.cookie.get('PPRD_P')||'',paramIsArr=Array.isArray(prefix),str='',rs={};prefix=paramIsArr?prefix:[prefix];pprd_p&&prefix.forEach(function(elem){if(regs[elem]&&regs[elem].test(pprd_p)){rs[elem]=RegExp.$1||'';}});return paramIsArr?rs:rs[prefix[0]];}
function isAndroid(){if(/android/i.test(ua)){return true;}
return false;}
function isMQQUserAgent(){if(/qq\/([\d\.]+)*/.test(navigator.userAgent.toLowerCase())){return true;}
return false;}
function getMQQUserVersion(){var a=navigator.userAgent.match(/qq\/(\d+\.\d+)/i),_r=0;if(a&&a.length>=2){_r=parseFloat(a[1])||0;}
return _r;}
function isWxUserAgent(){if(navigator.userAgent.indexOf('MicroMessenger')>0){return true;}
return false;}
function getScene(){var _r;if(isWxUserAgent()){_r='1';}else if(isMQQUserAgent()){_r='2';}
return _r;}
function getOs(){var u=navigator.userAgent,browser={versions:{trident:u.indexOf('Trident')>-1,presto:u.indexOf('Presto')>-1,webKit:u.indexOf('AppleWebKit')>-1,gecko:u.indexOf('Gecko')>-1&&u.indexOf('KHTML')==-1,mobile:!!u.match(/AppleWebKit.*Mobile.*/),ios:!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:u.indexOf('Android')>-1||u.indexOf('Linux')>-1,iPhone:u.indexOf('iPhone')>-1,iPad:u.indexOf('iPad')>-1,webApp:u.indexOf('Safari')==-1},language:(navigator.browserLanguage||navigator.language).toLowerCase()};return browser;}
function alertTipShow(opt){ui.info(opt);}
function imgReq(src){window.mylog=new Image();window.mylog.src=src+'&t='+Math.random();}
function dealReport(obj){var reportUrl='//wq.jd.com/payexcp/payexcpreport',param='?';param+='dealId='+obj.dealId;param+='&excpCode='+obj.excpCode;param+='&excpMsg='+obj.excpMsg;if(obj.extInfo){param+='&extInfo='+obj.extInfo;}
if(window.traceid){param+='&traceid='+window.traceid;}
new Image().src=reportUrl+param+'&t='+Math.random();}
function reportFun(str,async){}
function hasCookie(key){var v=co.get(key),_r=false;if(v){_r=true;}
return _r;}
function getPinStatus(obj,callback){var _source=1,_wid=obj.wid,locationhref,_rurl,_checkSrc,_url,data,_check,commlist='';locationhref=JD.url.addUrlParam(location.href,{bind:1});if(locationhref.indexOf('commlist')<0&&obj.skuList){commlist=obj.skuList.split(',').map(function(item){return[item,'',1,item,1,'0','0'].join(',');}).join('$');locationhref=locationhref.replace('?','?commlist='+commlist+'&');}
_rurl=locationhref;_checkSrc=_wid+locationhref+'pinstatus@20140917';_check=md5.getHash(_checkSrc);if(isWxUserAgent()){_source=2;}
data={callback:'cbQueryPinStatus',wid:_wid,rurl:_rurl,source:_source,sceneid:obj.sceneid,check:_check,sceneval:window.mConfirm?'2':'',r:Math.random()};_url=cgi.QueryPinStatus+'?'+$.param(data);ls.loadScript(_url,{isToken:true});window.cbQueryPinStatus=function(d){if(d.state=='3'){d.url=isWxUserAgent()?'//wqs.jd.com/my/accountv2.shtml?sceneid=18305':'//wqs.jd.com/my/accountv2.shtml?sceneid=48305';}
callback&&callback(d);obj.callback&&obj.callback(d);var couponData;if(d.defaultFlag=='1'){if(d.state=='1'){wa('ptagExposure',{ptag:'7039.1.12'});}else if(d.state=='2'){if(window.locker.choujiang){waReport('jdClick',{ptag:'38582.1.1'});umpReport({bizid:1,operation:48,result:'0',source:'0',message:'ok'});}
waReport('jdClick',{ptag:'7039.1.9'});}
if(!window.mConfirm&&[1,2].indexOf(d.state)>-1){if($('#un7day').hasClass('show')){$('#'+obj.tipId).css('margin-bottom','15px');}
ls.loadScript({url:'//wq.360buyimg.com/data/ppms/js/ppms.pagev34978.jsonp?t='+Math.random()});window.showPageData34978=function(d){var i;try{for(i=0;i<d.data.length;i++){if(d.data[i].mark=='confirm'){couponData=d.data[i];break;}}
if(!couponData){return;}
waReport('ptagExposure',{ptag:'138268.5.4'});$('#'+obj.tipId+' img').attr('src',couponData.img);$('#'+obj.tipId).show();}catch(e){}}
$('#'+obj.tipId).off('click').on('click',function(e){waReport('jdClick',{ptag:'138268.4.3'});location.href=cgi.bindUrl+'?returnText='+encodeURIComponent('结算页')+'&returnUrl='+encodeURIComponent(locationhref)+'&sceneid='+couponData.sceneid+'&ptag='+couponData.ptag+'&activeid='+couponData.activeid+'&activeLevel='+couponData.activeLevel;});}
if(obj.callback){obj.callback(d);}}};}
function myBadJsReport(opt){}
function errorReport(option){var opt={'bizid':'1','operation':'0','result1':'0','result2':'0','keyInfo':'','message':''},i,arr=[],_result2=0;$.extend(opt,option);if(g.weixinadkey){_result2=1;}
opt.result2=_result2;if(!opt.bizid||!opt.operation||!opt.result1){return;}
opt.message=opt.keyInfo+'-'+opt.message;delete opt.keyInfo;for(i in opt){arr.push(encodeURIComponent(opt[i]));}
imgReq('//wq.jd.com/webmonitor/collect/biz.json?contents='+arr.join('|'));}
function TimeOutObj(obj){this.timer=null;this.time=obj.time;this.name=obj.name;this.errmsgId=obj.errmsgId;this.countTime=0;}
TimeOutObj.prototype={start:function(){var _this=this;_this.clear();this.timer=setTimeout(function(){_this.report();},this.time);},report:function(){var _result2=0;if(g.weixinadkey){_result2=1;}
errorReport({'bizid':'1','operation':this.errmsgId,'result1':'0','result2':_result2,'keyInfo':'','message':this.name});},clear:function(){clearTimeout(this.timer);},init:function(){}};function getTimeOutObj(name){return new TimeOutObj(name);}
function QQVersion(m){return m&&m[2]||0;}
function compareVersion(a,b){var i,len,l,_r;a=String(a).split('.');b=String(b).split('.');try{for(i=0,len=Math.max(a.length,b.length);i<len;i++){l=isFinite(a[i])&&Number(a[i])||0;r=isFinite(b[i])&&Number(b[i])||0;if(l<_r){return-1;}
if(l>_r){return 1;}}}catch(e){return-1;}
return 0;}
function compareIOSQQVersion(ver){return compareVersion(QQVersion(ua.match(REGEXP_IOS_QQ)),ver);}
function compareQQVersion(ver){return compareVersion(QQVersion(ua.match(REGEXP_QQ)),ver);}
function checklogin(url,callback){var cb=callback||function(){},_lh=location.href,hash;if(scene=='jzyc'){if(!window._inAppLoginApi){window._inAppLoginApi=true;wqapi.user.login(function(){cb();});}}else{if(url){_lh=_lh.split('#')[0];hash='';if(fileName&&fileName.length>=1){fileName=fileName[0];}
if(["wq.confirm.shtml","s_confirm_miao.shtml","s_confirm_booking.shtml","wq.confirm.loc.shtml"].indexOf(fileName)>=0){hash='#wechat_redirect';}
lh=lh.replace(/\.shtml\??/,'.shtml?login=1&r='+Math.random()+'&');location.href=url+euc(lh+hash);}}}
function obj2str2(obj){var r='';if(typeof obj=='object'){r=JSON.stringify(obj).replace(/\,/g,'.');}else if(typeof obj=='string'){r=obj.replace(/\,/g,'.');}
r=r.replace(/\s/g,'_');r=r.replace(/http/g,'');return r;}
function umpReport(opt){try{if(window.JD){if(g.weixinadkey){opt.source=1;}
if(opt.message==''||opt.result=='0'){opt.message='no error';}
window.JD.report.umpBiz({bizid:opt.bizid,operation:opt.operation,result:opt.result,source:opt.source,message:opt.message,notCombo:opt.notCombo||false},10);}}catch(ignore){}}
function waReport(type,opt){try{wa(type,opt);}catch(ignore){}}
function loadCgi(option){var opt={cgi:'',data:{r:Math.random()},cbName:'',requestType:'jsonp',success:function(){},error:function(){},preFun:function(){},loginCallback:function(){},showLoading:true,reportCallback:false,doEverything:false},i=0,html='',data,_cgiName;for(i in option.data){opt.data[i]=option.data[i];}
loadCgiIndex++;opt.data.callback='cb_'+loadCgiIndex;delete option.data;for(i in option){opt[i]=option[i];}
if((_cgiName=opt.cgi.match(/.*\/([^\/]+)$/)).length==2){opt.data.callback='cb_'+_cgiName[1];}
if(opt.cbName){opt.data.callback=opt.cbName;}
if(opt.showLoading){loading.show();}
window.setTimeout(function(){loading.hide();},3e3);opt.preFun();opt.ajaxCallback=opt.data.callback;window[opt.ajaxCallback]=function(d){loading.hide();var errId=-1,errMsg=d.errMsg||d.msg||d.retmsg,nextUrl=d.nextUrl;if(d.errCode!==undefined){errId=d.errCode;}else if(d.errId!==undefined){errId=d.errId;}else if(d.retcode!==undefined){errId=d.retcode;}else if(d.errno!==undefined){errId=d.errno;}else if(d.ret!==undefined){errId=d.ret;}
if(opt.reportCallback){opt.reportCallback(errId,errMsg,d);}
if(opt.doEverything){try{opt.doEverything(d);}catch(e){}}
try{if(umpMap[_cgiName[1]]){umpReport({bizid:1,operation:umpMap[_cgiName[1]],result:errId,source:'0',message:obj2str2(d)+'_addr_'+co.get('jdAddrId')});}}catch(ignore){}
if(!opt.nochecklogin&&errId=='13'){checklogin(nextUrl,function(){opt.loginCallback();});}else if(errId=='0'){opt.success(d);}else{opt.error(errId,errMsg,d);}};if(opt.requestType=='ajax'){delete opt.data.callback;if(window.traceid){opt.data.traceid=window.traceid;}
ajax.load({url:opt.cgi,timeout:5,data:$.param(opt.data),type:'GET',dataType:'text',success:function(d){var _d=eval('('+d+')');window[opt.ajaxCallback](_d);}});}else{ls.loadScript(opt.cgi+'?'+$.param(opt.data));}}
function myAlert(msg,callback,confirmText,icon,showClose){myAlertV2({msg:msg,icon:icon,confirmText:confirmText,showClose:showClose,onConfirm:callback});}
function myAlertV2(opts){if(g.uiAlert){return;}
var option={msg:'',icon:'none',showClose:false,confirmText:'确定',onConfirm:null};opts=opts||{};extend(option,opts);g.uiAlert=true;ui.alert({msg:option.msg,icon:option.icon||'none',confirmText:option.confirmText||'确认',showClose:option.showClose||false,onConfirm:function(){g.uiAlert=false;option.onConfirm&&option.onConfirm();},onCancel:function(){g.uiAlert=false;}});$('#bottomConfirmBar').css({zIndex:100});}
function extend(a,b){var i;for(i in b){if(b.hasOwnProperty(i)){a[i]=b[i];}}
return a;}
function myConfirm(opts){var option={msg:"",icon:"info",closeIcon:false,modWidth:false,okText:"确定",cancelText:"取消",changeBtn:false,noCancel:false,extclass:'',onConfirm:null,onCancel:null,onClose:null},el,container=document.querySelector(".wx_wrap")||document.body,alertCoverDiv=document.createElement('div'),btnclass1='',btnclass2='btn_1';opts=opts||{};extend(option,opts);if(option.changeBtn){btnclass1='btn_1';btnclass2='';}
el=document.createElement('div');el.className="mod_alert show fixed "+option.extclass;if(option.modWidth){el.style.width=option.modWidth+'px';}
el.innerHTML=(option.closeIcon?'<span class="close"></span>':'')+(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p><p class="btns"><a href="javascript:;" id="ui_btn_confirm" class="btn '+btnclass1+'">'+option.okText+'</a><a href="javascript:;" id="ui_btn_cancel" class="btn '+btnclass2+'">'+option.cancelText+'</a></p>';container.appendChild(el);alertCoverDiv.className='mod_alert_mask show';document.body.appendChild(alertCoverDiv);function clear(){el.style.display='none';container.removeChild(el);document.body.removeChild(alertCoverDiv);}
function mycancel(){option.onCancel&&option.onCancel();if(!option.noCancel){clear();}}
el.querySelector("#ui_btn_cancel").onclick=mycancel;if(option.closeIcon){el.querySelector(".close").onclick=function(){option.onClose&&option.onClose();clear();$('#wxloading').hide();};}
el.querySelector("#ui_btn_confirm").onclick=function(e){option.onConfirm&&option.onConfirm();clear();};option.clear=clear;return option;}
function oneLineTip(opts){var option={msg:'',time:2000},el,container=document.querySelector('.wx_wrap')||document.body,opts=opts||{};extend(option,opts);el=document.createElement('div');el.className='mod_alert one_line fixed show';el.innerHTML='<p>'+option.msg+'</p>';container.appendChild(el);function clear(){el.style.display='none';container.removeChild(el);opts.callback&&opts.callback();}
window.setTimeout(function(){clear()},option.time);}
function showDesc(opts){var option={title:'',showClose:false,desc:'',confirmText:'确定',showBtn:true},el,container=document.querySelector('.wx_wrap')||document.body,alertCoverDiv=document.createElement('div');opts=opts||{};extend(option,opts);el=document.createElement('div');el.className='mod_alert mod_alert_info show fixed';el.innerHTML='<span class="close" id="ui_desc_close"'+(!option.showClose?' style="display: none"></span>':'></span>')+'<h3 class="title">'+option.title+'</h3><div class="inner">'+option.desc+'</div><p class="btns"'
+(option.showBtn?'':' style="display: none"')+'><a href="javascript:void(0);" class="btn btn_1" id="ui_desc_sure">'+
option.confirmText+'</a></p>';container.appendChild(el);alertCoverDiv.className='mod_alert_mask show';document.body.appendChild(alertCoverDiv);function clear(){el.style.display='none';container.removeChild(el);document.body.removeChild(alertCoverDiv);}
el.querySelector("#ui_desc_sure").onclick=function(e){option.onConfirm&&option.onConfirm();clear();};el.querySelector("#ui_desc_close").onclick=function(e){option.onClose&&option.onClose();clear();};}
function myBind(obj){var o={'type':'click','src':'.','fun':function(){},'isStop':true},i;for(i in obj){o[i]=obj[i];}
if(typeof o.src==="string"){o.$src=$(o.src);}
$(o.src).off(o.type).on(o.type,function(e){try{o.fun.apply(o,[e,$(this)]);}catch(ea){umpReport({bizid:1,operation:10,result:1,source:'0',message:ea.message+';'+obj2str2(ea.stack)});}
if(o.isStop){return false;}});}
function getRegionZhName(opt,callback){var pid,cid,coid,tid,arr=[];pid=opt.idArray[0]||0;cid=opt.idArray[1]||0;coid=opt.idArray[2]||0;tid=opt.idArray[3]||0;if(pid<=0){if(callback){callback(arr);}}
function h(d){arr.push(provMap[pid]);arr.push(d[cid][0]);if(typeof d[cid][1][coid]=='string'){arr.push(d[cid][1][coid]);}else if(typeof d[cid][1][coid]=='object'){arr.push(d[cid][1][coid][0]);if(typeof d[cid][1][coid][1][tid]=='string'){arr.push(d[cid][1][coid][1][tid]);}}
if(callback){callback(arr);}}
if(window['district_data_'+pid]){h(window['district_data_'+pid]);}else{loadCgi({'cgi':cgi.getprovince,'data':{'provinceid':pid},'doEverything':function(d){window['district_data_'+pid]=d;h(d);}});}}
function getMyLocation(callback){var cookiecoores,res,_coords='';function mysave(coords){if(coords&&coords.longitude){var val=JSON.stringify(coords);co.set('coords',val,60,'/','jd.com');}}
function myget(){var coords;coords=co.get('coords');if(coords){coords=JSON.parse(coords);}
if(!coords||!coords.longitude||!coords.latitude){coords=false;co.del('coords','/','jd.com');}
return coords;}
cookiecoores=myget();if(typeof callback==='string'&&callback=='fromCookie'){if(cookiecoores){_coords=[cookiecoores.longitude,cookiecoores.latitude].join(',');}
return _coords;}
if(cookiecoores){callback&&callback(cookiecoores);}else{if(isWxUserAgent()){JD.wxapi.ready(function(config){config.beta=true;wx.getLocation({type:'gcj02',success:function(position){res={'latitude':position.latitude,'longitude':position.longitude};mysave(res);callback&&callback(res);}});});}else if(isMQQUserAgent()){mqq.sensor.getLocation(function(retCode,latitude,longitude){res={'latitude':latitude,'longitude':longitude};mysave(res);callback&&callback(res);});}else if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){res={'latitude':position.coords.latitude,'longitude':position.coords.longitude}
mysave(res);callback&&callback(res);});}}}
function notNeedLoadCss(){var uiCSSUrl='base.s.min',i,l,links=document.getElementsByTagName('link'),isHave=false;for(i=0,l=links.length;i<l;i++){if(links[i].rel=='stylesheet'&&links[i].href.indexOf(uiCSSUrl)>=0){isHave=true;break;}}
return isHave;}
function loadCss(url,id){var l=document.createElement('link');l.setAttribute('type','text/css');l.setAttribute('rel','stylesheet');l.setAttribute('href',url);l.setAttribute('id',id);document.getElementsByTagName("head")[0].appendChild(l);}
function repeatDealV3(repeatObj,callback){var repeatTimer,isTimeout=false,_data;window.checkRepeatCb=function(d){if(isTimeout){return;}else{clearTimeout(repeatTimer);}
umpReport({bizid:1,operation:56,result:d.errId,source:'0',message:'ok'});callback&&callback(d);}
_data={action:repeatObj.action,paytype:repeatObj.paytype,platprice:repeatObj.platprice,callback:'checkRepeatCb'};wrapData(_data);ls.loadScript({url:cgi.checkRepeatOrder,data:_data});repeatTimer=window.setTimeout(function(){isTimeout=true;callback&&callback({errId:'-1'});},3000);}
function setAddrCookie(addrid,wq_addr,defaultAddr){var addrArr,areaId,detailName,catchTime=10*365*24*60;co.set('addrId_1',addrid,catchTime,"/",'jd.com');co.set('addrType_1',1,catchTime,"/",'jd.com');co.del('addrId_1',"/",'wqs.jd.com');co.del('addrType_1',"/",'wqs.jd.com');if(wq_addr){co.set('wq_addr',wq_addr,catchTime,"/",'jd.com');addrArr=wq_addr.split('|');areaId=addrArr[1];detailName=addrArr[3]||'';co.set('mitemAddrId',areaId,catchTime,'/','jd.com');co.set('mitemAddrName',detailName,catchTime,'/','jd.com');}}
function delAddrCookie(){co.del('addrId_1',"/",'jd.com');co.del('addrType_1',"/",'jd.com');co.del('addrId_1',"/",'wqs.jd.com');co.del('addrType_1',"/",'wqs.jd.com');}
function resetAddrCookie(){var wq_addr=co.get('wq_addr'),wq_addrArr=wq_addr.split('|');wq_addrArr[0]='0';wq_addr=wq_addrArr.join('|');co.set('wq_addr',wq_addr,10*365*24*60,"/",'jd.com');}
function setCookieForWanggou(opt){var addrId=opt.jdaddrid,addrName=opt.jdaddrname,cartNum=opt.buynum,num;if(addrId&&addrName){addrName=decodeURIComponent(addrName);co.set('jdAddrId',addrId,999999,"/",'jd.com');JD.store.setItem('jdAddrId',addrId);co.set('jdAddrName',addrName,999999,"/",'jd.com');JD.store.setItem('jdAddrName',addrName);}
if(cartNum){num=JD.store.getItem('cartNum')*1||0;num=num-cartNum;num=Math.max(0,num);co.set('cartNum',num,999999,"/",'jd.com');JD.store.setItem('cartNum',num);}}
function getDefAddrFromWqAddr(){var wq_addr=JD.cookie.get('wq_addr'),wq_addrArr,adid,addrId,addrName,addrDetail;wq_addrArr=wq_addr?wq_addr.split('|'):[];adid=wq_addrArr[0]||'0';addrId=wq_addrArr[1]||'___';addrName=wq_addrArr[2]||'___';addrDetail=wq_addrArr[3]||'';return[adid,addrId,addrName,addrDetail];}
function weinre(){var uin=co.get('wq_uin'),debug=co.get('_debug_switch');if(debug=='1'&&uin){ls.loadScript('//wq.jd.com/weinre/target/target-script-min.js#uin='+uin);}}
function checkUserId(IDStr){var errorInfo,Ai,strYear,strMonth,strDay,ValCodeArr,Wi,i,TotalmulAiWi,modValue,strVerifyCode,areaCode={"11":"北京","12":"天津","13":"河北","14":"山西","15":"内蒙古","21":"辽宁","22":"吉林","23":"黑龙江","31":"上海","32":"江苏","33":"浙江","34":"安徽","35":"福建","36":"江西","37":"山东","41":"河南","42":"湖北","43":"湖南","44":"广东","45":"广西","46":"海南","50":"重庆","51":"四川","52":"贵州","53":"云南","54":"西藏","61":"陕西","62":"甘肃","63":"青海","64":"宁夏","65":"新疆","71":"台湾","81":"香港","82":"澳门","91":"国外"};errorInfo="";ValCodeArr=["1","0","x","9","8","7","6","5","4","3","2"];Wi=["7","9","10","5","8","4","2","1","6","3","7","9","10","5","8","4","2"];Ai="";if(!IDStr){errorInfo="身份证号码不能为空";return errorInfo;}
if(IDStr.length!=18){errorInfo="身份证号码长度应该为18位";return errorInfo;}
if(IDStr.length==18){Ai=IDStr.substring(0,17);}else if(IDStr.length==15){Ai=IDStr.substring(0,6)+"19"+IDStr.substring(6,15);}
if(!/^\d+$/.test(Ai)){errorInfo="身份证格式错误";return errorInfo;}
strYear=Ai.substring(6,10);strMonth=Ai.substring(10,12);strDay=Ai.substring(12,14);if(/[1-9]\d{3}\-(0[1-9]|1[0-2])\-([0-2]\d|3[0-1])/.test(strYear+"-"+strMonth+"-"+strDay)==false){errorInfo="身份证生日无效。";return errorInfo;}
if((new Date().getFullYear()-strYear)>150||(new Date().getTime()-new Date(strYear,strMonth-1,strDay).getTime())<0){errorInfo="身份证生日不在有效范围";return errorInfo;}
if(strMonth>12||strMonth==0){errorInfo="身份证月份无效";return errorInfo;}
if(strDay>31||strDay==0){errorInfo="身份证日期无效";return errorInfo;}
if(!areaCode[Ai.substring(0,2)]){errorInfo="身份证地区编码错误";return errorInfo;}
TotalmulAiWi=0;for(i=0;i<17;i++){TotalmulAiWi=TotalmulAiWi
+Ai.charAt(i)*Wi[i];}
modValue=TotalmulAiWi%11;strVerifyCode=ValCodeArr[modValue];Ai=Ai+strVerifyCode;if(IDStr.length==18){if(Ai!=IDStr.toLowerCase()){errorInfo="不是合法的身份证号码";return errorInfo;}}else{return"";}
return"";}
function checkCompany(company){var reg=/[\*\/\+\\\$\^\.;<>"={}@]/g;if(!company){oneLineTip({msg:'请填写单位名称'});return false;}else if(company.length<2){oneLineTip({msg:'请填写完整的单位名称'});return false;}else if(company.length>50){oneLineTip({msg:'单位名称过长，请重新输入'});return false;}else if(company=="个人"){oneLineTip({msg:'公司名称不能为个人'});return false;}
return true;}
function checkTaxId(taxId){var regArr=[/^[\da-z]{10,15}$/i,/^\d{6}[\da-z]{10,12}$/i,/^[a-z]\d{6}[\da-z]{9,11}$/i,/^[a-z]{2}\d{6}[\da-z]{8,10}$/i,/^\d{14}[\dx][\da-z]{4,5}$/i,/^\d{17}[\dx][\da-z]{1,2}$/i,/^[a-z]\d{14}[\dx][\da-z]{3,4}$/i,/^[a-z]\d{17}[\dx][\da-z]{0,1}$/i,/^[\d]{6}[\da-z]{13,14}$/i],i,j=regArr.length;for(var i=0;i<j;i++){if(regArr[i].test(taxId)){return true;}}
oneLineTip({msg:'纳税人识别号格式错误'});return false;}
function isMobile(val,userModifyMobile){var cm="134,135,136,137,138,139,150,151,152,157,158,159,187,188,147,182,183,184,178",cu="130,131,132,155,156,185,186,145,176",ct="133,153,180,181,189,177,173,170",v=val||"",h1=v.substring(0,3),h2=v.substring(0,4),r=(/^1\d{10}$/).test(v)?(cu.indexOf(h1)>=0?"联通":(ct.indexOf(h1)>=0?"电信":(h2=="1349"?"电信":(cm.indexOf(h1)>=0?"移动":"未知")))):false;if(!userModifyMobile&&!r&&(/^1\d{2}\*{4}\d{4}$/).test(v)){r=true;}
return r;}
function checkForm(obj){var tempName,tempMobile,adinfo,testTempName,idCard,adlabel=$('#adlabelP').attr('value'),userModifyMobile=obj.userModifyMobile||'',obj=obj||{},reg=/[\*\/\+\\\$\^\.;<>"={}@]/g,allReg=/[^\w+\u4E00-\u9FA5，。《》、？；：‘”“·！￥……（）——~`!#\$%\^&\*\(\)_\-\+=\.,\?<>:;\/\\\{\}\[\]\"\' ]/g,gnReg=/^[a-zA-Z·_\.\/ (),\-]{1,50}$/,gdLimitReg=/[\\\:\?\+\*\^\$\[\]<>'"`={}@~%!]/g,gdReg=/^[0-9a-zA-Z· _&\.\/;#(),\-]{1,100}$/,labelReg=/[^\w\u4E00-\u9FA5\uF900-\uFA2D]/,phoneReg=/^(\d{1,4}\-?)?(\d{5,8})(-\d{1,4})?$/,emailReg=/^[0-9a-zA-Z_\-\.]+\**@\w+([-.]\w+)*\.\w+([-.]\w+)*(\s*$)/,postcodReg=/^[0-9a-zA-Z·]{1,20}$/;if(!obj.provinceId){$('#name').val(($('#name').val()||'').replace(/[\?&~\^\*%\$\"\']/g,'').replace(reg,''));}
if(obj.provinceId!='53283'){$('#name').val(($('#name').val()||'').replace(allReg,''));}
tempName=(obj.name||obj.name==='')?obj.name:$('#name').val();testTempName=tempName.replace(/[\u4E00-\u9FA5\uF900-\uFA2D]/g,'aaa');if(testTempName.length==0){oneLineTip({msg:'请填写收货人姓名'});return false;}else if(obj.provinceId=='53283'){if(testTempName.length>50){oneLineTip({msg:'姓名必须少于等于50个字符'});return false;}
if(!gnReg.test(tempName)){oneLineTip({msg:'姓名仅支持英文'});return false;}}else if(obj.provinceId!='53283'&&testTempName.length>60){oneLineTip({msg:'姓名必须少于等于20个汉字'});return false;}else if(testTempName.length<3){oneLineTip({msg:'姓名过短'});return false;}else if(obj.provinceId!='53283'&&testTempName.length>0&&testTempName.length<=60&&!(/^[A-Za-z· ]{3,60}$/).test(testTempName)){oneLineTip({msg:'收货人姓名只能输入中文和字母'});return false;}
$('#mobile').val(($('#mobile').val()||'').replace(/[ \?\&\~\^\%\$\"\'\u202d\u202c]/g,''));tempMobile=(obj.mobile||obj.mobile==='')?obj.mobile:$('#mobile').val();if(tempMobile==''){oneLineTip({msg:'请填写手机号码'});return false;}else if(obj.provinceId=='52993'&&tempMobile.length!=8){oneLineTip({msg:'港澳只支持8位手机号'});return false;}else if(obj.provinceId=='32'&&!(tempMobile.length==9||tempMobile.length==10)){oneLineTip({msg:'台湾只支持9~10位手机号'});return false;}else if((['53283','52993','32'].indexOf(obj.provinceId)>-1&&userModifyMobile&&!(/^\d+$/.test(tempMobile)))||(obj.provinceId=='32'&&userModifyMobile&&!/^\d{9,10}$/.test(tempMobile))||(obj.provinceId=='52993'&&userModifyMobile&&!/^\d{8}$/.test(tempMobile))){oneLineTip({msg:'手机号码格式不正确'});return false;}else if(obj.provinceId=='53283'&&userModifyMobile&&(!(tempMobile.length<=(17-obj.areacode.length))||!(/^\d+$/.test(tempMobile)))){if(tempMobile.length>17-obj.areacode.length){oneLineTip({msg:'手机号码不能超过17位'});}else{oneLineTip({msg:'手机号码格式不正确'});}
return false;}else if(!obj.provinceId&&!isMobile(tempMobile,userModifyMobile)){oneLineTip({msg:'手机号码格式不正确'});return false;}
idCard=$.trim($("#idCard").val())||'';if(window.__g.isGlobalPay&&window.locker.globalPayIdCard){if(/^\d{4}\*+\d{3}[0-9xX]/.test(idCard)||(idCard==''&&!(obj.checkIdcard))){}else if(checkUserId(idCard)!=''){oneLineTip({msg:checkUserId(idCard)});return false;}}
if(!window.newAddrData){oneLineTip({msg:'请选择地市/区县信息'});return false;}
if(obj.provinceId!='53283'){adinfo=obj.adinfo?obj.adinfo.replace(reg,''):($('#adinfo').val()||'').replace(reg,'');adinfo=adinfo.replace(allReg,'');adinfo=adinfo.replace(/\?/g,"？").replace(/&/g,"﹠").replace(/~\^/g,"").replace(/\$/g,"﹩").replace(/"/g,"〞").replace(/'/g,"＇").replace(/#/g,"﹟");}else{adinfo=obj.adinfo?obj.adinfo.replace(gdLimitReg,''):($('#adinfo').val()||'').replace(gdLimitReg,'');}
if(adinfo.length<1){oneLineTip({msg:'请填写详细地址'});return false;}else if(adinfo.length<2){oneLineTip({msg:'详细地址过短'});return false;}else if(obj.provinceId!='53283'&&adinfo.length>50){oneLineTip({msg:'详细地址过长'});return false;}else if(obj.provinceId=='53283'&&adinfo.length>100){oneLineTip({msg:'详细地址过长'});return false;}else if(obj.provinceId=='53283'&&!gdReg.test(adinfo)){oneLineTip({msg:'详细地址仅支持英文'});return false;}
if(obj.provinceId&&['53283','52993','32'].indexOf(obj.provinceId)>-1){obj.email=obj.email.trim();obj.postcode=obj.postcode.trim();obj.phone=obj.phone.trim();if(!obj.email){oneLineTip({msg:'请填写邮箱'});return false;}
if(!emailReg.test(obj.email)){oneLineTip({msg:'邮箱格式有误'});return false;}
if(obj.email.length>50){oneLineTip({msg:'邮箱太长'});return false;}
if(!obj.postcode){oneLineTip({msg:'请填写邮编'});return false;}
if(!postcodReg.test(obj.postcode)){oneLineTip({msg:'邮编格式有误'});return false;}
if(obj.phone&&!phoneReg.test(obj.phone)){oneLineTip({msg:'固定电话格式有误'});return false;}}
if(obj.provinceId&&['53283','52993','32'].indexOf(obj.provinceId)>-1){adlabel='';}
if(adlabel&&labelReg.test(adlabel)){oneLineTip({msg:'地址标签只能为汉字、字母、数字'});return false;}
window.newAddrData.name=tempName;window.newAddrData.mobile=tempMobile;window.newAddrData.adinfo=adinfo;window.newAddrData.idcard=idCard;window.newAddrData.label=adlabel||'';window.newAddrData.email=obj.email;window.newAddrData.postcode=obj.postcode;window.newAddrData.phone=obj.phone||'';return true;}
function map(coords,name,addr){if(!coords){return;}
var latitude,longitude,_coords,mapurl,tmp;_coords=coords.split(',');latitude=_coords[0]-0;longitude=_coords[1]-0;if(latitude>longitude){tmp=latitude;latitude=longitude;longitude=tmp;}
if(isWxUserAgent()){JD.wxapi.ready(function(config){config.beta=true;wx.openLocation({latitude:latitude,longitude:longitude,name:name,address:addr,scale:15,infoUrl:''});});}else if(isMQQUserAgent()){mapurl='//apis.map.qq.com/tools/poimarker?marker=coord:'+latitude+','+longitude+';title:'+name+';addr:'+addr+'&referer=myapp&key=AEXBZ-2MUKJ-YSVF6-KIYLB-44AA3-3QFEK';mqq.ui.openUrl({'url':mapurl,'target':1,'style':1,'animation':0})}}
function ptagReport(obj){if(isWxUserAgent()){obj.wx&&waReport('jdClick',{ptag:obj.wx});}else if(isMQQUserAgent()){obj.qq&&waReport('jdClick',{ptag:obj.qq});}}
function xss(str,type){if(!str){return str===0?"0":"";}
switch(type){case"none":return str+"";break;case"html":return str.replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"}).replace(/ /g,"&nbsp;").replace(/\r\n/g,"<br />").replace(/\n/g,"<br />").replace(/\r/g,"<br />");break;case"htmlEp":return str.replace(/[&'"<>\/\\\-\x00-\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"});break;case"url":return escape(str).replace(/\+/g,"%2B");break;case"miniUrl":return str.replace(/%/g,"%25");break;case"script":return str.replace(/[\\"']/g,function(r){return"\\"+r;}).replace(/%/g,"\\x25").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\x01/g,"\\x01");break;case"reg":return str.replace(/[\\\^\$\*\+\?\{\}\.\(\)\[\]]/g,function(a){return"\\"+a;});break;case'input':return str.replace(/[&'"<>\/]/g,' ');break;default:return escape(str).replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"}).replace(/ /g,"&nbsp;").replace(/\r\n/g,"<br />").replace(/\n/g,"<br />").replace(/\r/g,"<br />");break;}}
function isDuringDate(beginDateStr,endDateStr){var curDate=new Date(),beginDate=new Date(beginDateStr),endDate=new Date(endDateStr);if(curDate>=beginDate&&curDate<=endDate){return true;}
return false;}
function transJson2str(o){if(o==undefined){return"";}
var r=[],i;if(typeof o==="string"){return"\""+o.replace(/([\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+"\"";}
if(typeof o==="object"){if(!o.sort){for(i in o){r.push("\""+i+"\":"+transJson2str(o[i]));}
if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(o.toString)){r.push("toString:"+o.toString.toString());}
r="{"+r.join()+"}";}else{for(i=0;i<o.length;i++){r.push(transJson2str(o[i]));}
r="["+r.join()+"]";}
return r;}
return o.toString().replace(/\"\:/g,'":""');}
function clone(oldObj){if(typeof(oldObj)!='object')return oldObj;if(oldObj==null)return oldObj;var newObj=new Object();for(var i in oldObj){newObj[i]=oldObj[i];}
return newObj;}
function reportTX(products){try{var order_skuArr=[],order_amountArr=[],order_priceArr=[],order_cidArr=[],reportObj={scn_type:'5'},i,j,item,pprdReg=/EA\.((\d+)\.(\d+)\.(\d+))/gi,pprdpVal=co.get('PPRD_P')||'',regArr=pprdReg.exec(pprdpVal),whitePageId={'17007.17.1':true,'17007.17.2':true,'17007.17.3':true,'17007.17.4':true,'17007.17.5':true,'17007.18.1':true,'17007.18.2':true,'17007.18.3':true,'17007.18.4':true,'17007.18.5':true};if(whitePageId[regArr[1]]){for(i=0,j=products.length;i<j;i++){item=products[i].mainSku;order_skuArr.push(item.id);order_amountArr.push(item.num);order_priceArr.push(((item.promotion.price-item.promotion.discount)/100).toFixed(2));order_cidArr.push(item.cid.replace(/_/g,'-'));}
reportObj=$.extend(reportObj,{order_sku:order_skuArr.join('_'),order_amount:order_amountArr.join('_'),order_price:order_priceArr.join('_'),order_cid:order_cidArr.join('_')});window.wa&&window.wa('tencent.send','click',reportObj);}}catch(e){}}
function isToshowWxPay(){var jdvVal=JD.cookie.get('__jdv')||'',utmMedium=jdvVal.split('|')[3],adTime=jdvVal.split('|')[5],intervalTime=3*60*1000,nowTime=1*new Date(),flag=false,pprdReg=/EA\.((\d+)\.(\d+)\.(\d+))/gi,pprdpVal=JD.cookie.get('PPRD_P')||'',regArr=pprdReg.exec(pprdpVal),whitePageId={'17051':true,'17061':true,'17062':true};if(utmMedium&&adTime&&regArr){if(utmMedium=='weixin_shouq'&&(nowTime-adTime<intervalTime)&&whitePageId[regArr[2]]){flag=true;}}
return flag;}
function pingClick(cartUse,report_eventid,report_eventparam,page_param,event_level){if(cartUse){try{var click=new MPing.inputs.Click(report_eventid);click.event_param=report_eventparam;if(page_param){click.page_param=page_param;}
if(event_level){click.event_level=event_level;}
var mping=new MPing();mping.send(click);}catch(e){}}}
function pingOrderClick(orderId,totalPrice,skuIds,ord_type){var mping,ord,i;try{if(orderId==null||orderId==''){orderId='00000';}
if(skuIds.length==0){skuIds=['000'];}
mping=new MPing();for(i=0;i<skuIds.length;i++){ord=new MPing.inputs.Order(skuIds[i]);ord.sale_ord_id=orderId;ord.order_total_fee=totalPrice;ord.ord_type=ord_type;ord.lv5_page_name=location.origin+location.pathname;ord.lv5_page_param=location.search;mping.send(ord);}}catch(e){}}
function getUnpl(callback){if(!isJdapp){return;}
var param={businessType:'unpl',callBackName:'getUnplCb'};var obj={'method':'notifyMessageToNative','params':JSON.stringify(param)};try{if(iswk){window.webkit.messageHandlers.JDAppUnite.postMessage(obj);}else{window.JDAppUnite&&window.JDAppUnite.notifyMessageToNative(JSON.stringify(param));}}catch(e){}
window.getUnplCb=function(d){try{var json=JSON.parse(d);if(json.status!='0'){return;}
if(json.data&&json.data.unpl){callback&&callback(json.data.unpl)}}catch(e){}}}
function loadPPMSData(callback){if(g.descData){callback&&callback(g.descData);}else{ls.loadScript({url:'//wq.360buyimg.com/data/ppms/js/ppms.pagev32614.jsonp?t='+Math.random()});}
window.showPageData32614=function(d){g.descData=d.data;callback&&callback(d.data);}}
function loadonJS(url,callback,charset){if(typeof callback=='string'){charset=callback;callback=function(){};}
var sc=document.createElement('script'),head=document.getElementsByTagName('head')[0];sc.setAttribute('charset',charset||'utf-8');sc.src=url;sc.onload=function(){callback&&callback();head.removeChild(sc);};head.appendChild(sc);}
function getDayType(time,needNoon){var timeArr=time.split('-'),startArr=timeArr[0].split(':'),endArr=timeArr[1].split(':'),start=parseInt(startArr[0]),end=parseInt(endArr[0]),dayType='';if(start>=0&&end<=12){dayType='上午';}
if(start>=12&&end<=18){dayType='下午';}
if(start>=18&&end<=24){dayType='晚间';}
if(needNoon&&start>=11&&end<=13){dayType='中午';}
return dayType;}
function wrapData(data){var source=JD.url.getUrlParam('source');data.r=Math.random();if(source&&window.locker.source){data.kplsrc=source;}
if(window.mConfirm){data.sceneval='2';}
return data;}
function myAjax(opt){try{var xhr=new XMLHttpRequest();xhr.onload=function(e){opt.success&&opt.success(e);};xhr.onerror=function(e){opt.error&&opt.error(e);};xhr.open(opt.type,opt.url);if(opt.type=='json'){xhr.setRequestHeader('content-type','application/json');}
xhr.send(opt.data);}catch(e){}}
module.exports={isWxUserAgent:isWxUserAgent,getScene:getScene,getOs:getOs,compareIOSQQVersion:compareIOSQQVersion,compareQQVersion:compareQQVersion,tipShow:alertTipShow,imgReq:imgReq,itilReport:reportFun,errorReport:errorReport,hasCookie:hasCookie,getMQQUserVersion:getMQQUserVersion,isMQQUserAgent:isMQQUserAgent,myBadJsReport:myBadJsReport,getPinStatus:getPinStatus,getTimeOutObj:getTimeOutObj,checklogin:checklogin,myAlert:myAlert,myAlertV2:myAlertV2,oneLineTip:oneLineTip,showDesc:showDesc,loadCgi:loadCgi,myBind:myBind,getRegionZhName:getRegionZhName,getMyLocation:getMyLocation,loadCss:loadCss,repeatDealV3:repeatDealV3,setAddrCookie:setAddrCookie,delAddrCookie:delAddrCookie,resetAddrCookie:resetAddrCookie,setCookieForWanggou:setCookieForWanggou,getDefAddrFromWqAddr:getDefAddrFromWqAddr,weinre:weinre,myConfirm:myConfirm,checkUserId:checkUserId,checkCompany:checkCompany,checkTaxId:checkTaxId,isMobile:isMobile,checkForm:checkForm,jumpMap:map,umpReport:umpReport,waReport:waReport,dealReport:dealReport,ptagReport:ptagReport,xss:xss,isDuringDate:isDuringDate,obj2str2:obj2str2,transJson2str:transJson2str,clone:clone,reportTX:reportTX,getADKEY:getADKEY,isToshowWxPay:isToshowWxPay,pingClick:pingClick,pingOrderClick:pingOrderClick,getUnpl:getUnpl,loadPPMSData:loadPPMSData,loadonJS:loadonJS,getDayType:getDayType,wrapData:wrapData,myAjax:myAjax};});
define('wq.confirm.promote',function(require,exports,module){var $=require('zepto'),loadJs=require('loadJs'),pu=require('payutil'),confirmTplV3=require('tpl_wq.confirmV3'),loading=$('#wxloading'),wa=pu.waReport,jdDomain3=function(){var jdDomain=(window.userRouter&&window.userRouter.getHost&&window.userRouter.getHost())||'//wqdeal.jd.com/';return(jdDomain.indexOf('/deal/')<0?jdDomain+'deal/':jdDomain);},domain=jdDomain3(),cgi={modifycmdypromo:domain+'mshopcart/modifycmdypromo',orderpromo:domain+'massit/orderpromo',globalPay_orderpromo:domain+'globalpurchase/orderpromo',addcmdy:domain+'mshopcart/addcmdy',rmvGift:domain+'mshopcart/rmvcmdy',},g={couponSelAll:false,totalPrice:0,global:JD.url.getUrlParam('global')||'',globalbuy:JD.url.getUrlParam('globalbuy')||'',isContractMachine:JD.url.getUrlParam('feetype')!=''||JD.url.getUrlParam('flowType')!='',isGlobalPay:false,iType:'',};if(g.global=='1'||g.globalbuy>0){g.isGlobalPay=true;}
function initNewPromoPage(opt){var html='',newCommlist,selPid;g.iType=opt.iType;selPid=opt.orderPromotion.selectPromotion[0]?opt.orderPromotion.selectPromotion[0].pid:'';html=confirmTplV3.child_newPromoPageTpl(opt);$('#newPromoPage').html(html);if(!(opt.mfsuits&&opt.mfsuits.length>0&&opt.products.length>1)){wa('ptagExposure',{ptag:'7039.1.97'});if(opt.orderPromotion.canSelectPromotion.length>0){wa('jdClick',{ptag:'7039.1.98'});}}
g.curSelArr=[];$('[type="multi"]').each(function(i,item){item=$(item),pid=item.attr('pid'),pLi=$('[pmultiid="'+pid+'"]');if(pLi.length==0){item.attr('pmultiid',pid);}else{pLi.find('.promo_images').append(item.find('img'));}});$('[pmultiid]').show();pu.myBind({'src':'#promoConfirm','fun':function(e,$this){if(g.selMZ){g.changePromote=false;opt.callback&&opt.callback();}else if(g.changePromote){g.changePromote=false;opt.callback&&opt.callback();}
history.back();}});$('#promo_choose').off('click').on('click','ul',function(e){var lastPid=$('#promo_choose ul.selected').attr('pid')?$('#promo_choose ul.selected').attr('pid'):selPid,curPid=$(this).attr('pid'),commlist,_data,lastSel;if($(this).hasClass('selected'))return;lastSel=$('#promo_choose ul.selected');$(this).addClass('selected').siblings().removeClass('selected');wa('jdClick',{ptag:'7039.1.99'});commlist=opt.commlist;newCommlist=commlist.split(',');newCommlist[4]=g.iType;newCommlist[5]=lastPid;newCommlist[6]=curPid;window.cbModifycmdypromo=function(d){loading.hide();if(d.errId=='0'){g.changePromote=true;if(!g.isGlobalPay&&(d.itemType=='13'||g.iType=='13')){opt.orderPromotion=d.orderPromotion;loadPromot(opt);}else if(d.itemType=='13'||g.iType=='13'){loadPromot(opt);}
g.iType=d.itemType||g.iType;}else{pu.oneLineTip({msg:'抱歉，切换促销失败！'});$('#promo_choose ul').removeClass('selected');lastSel.addClass('selected');}}
_data={commlist:newCommlist.join(','),type:'0',checked:'0',scene:'1',callback:'cbModifycmdypromo'}
pu.wrapData(_data);loading.show();loadJs.loadScript({url:cgi.modifycmdypromo,data:_data});});if($('#promo_choose ul.selected').length==0&&selPid){$('#promo_choose ul[pid="'+selPid+'"]').click();}
if(!g.isContractMachine){loadPromot(opt);}
barSlider('newPromoPage');}
function loadPromot(opt){var _data;window.cbOrderpromo=function(d){loading.hide();if(d.errId=='0'){if(d.orderPromotion.mzGiftGroup.length>0){opt.mzGiftGroup=d.orderPromotion.mzGiftGroup;handleMzGift(opt);}else{$('#mzGiftGroup').html('');}}};if(!g.isGlobalPay){opt.mzGiftGroup=opt.orderPromotion.mzGiftGroup;if(opt.orderPromotion.mzGiftGroup.length>0){handleMzGift(opt);}else{$('#mzGiftGroup').html('');}}else{_data={callback:'cbOrderpromo'}
pu.wrapData(_data);loading.show();loadJs.loadScript({url:g.isGlobalPay?cgi.globalPay_orderpromo:cgi.orderpromo,data:_data});}}
function handleMzGift(opt){var i,l,j,k,html='',m,n;function getSelectItems(domElement){var lists=$(domElement).find('li.selected'),arr=[],obj;lists.each(function(i,n){obj={};obj[$(n).attr('skuid')]=$(n).attr('promoid');arr.push(obj);});return arr;}
for(i=0,l=opt.mzsuits.length;i<l;i++){for(j=0,k=opt.mzGiftGroup.length;j<k;j++){if(opt.mzsuits[i].promotion.pid==opt.mzGiftGroup[j].promoId){opt.mzGiftGroup[j].manfan=opt.mzsuits[i].promotion.manfan;opt.mzGiftGroup[j].needNum=opt.mzsuits[i].promotion.needNum;opt.mzGiftGroup[j].needMoney=opt.mzsuits[i].promotion.needMoney;}}}
html=confirmTplV3.child_tplMzPromo(opt);g.selMZ=false;$('#mzGiftGroup').html(html);$('#mzGiftGroup li').off('click').on('click',function(){var i,l,promoId=$(this).attr('promoid'),skuId=$(this).attr('skuid'),promoObj,lastSelArr=getSelectItems($(this).parent()),curSelArr,curDom=$(this);if($(this).hasClass('disabled'))return;for(i=0,l=opt.mzGiftGroup.length;i<l;i++){if(opt.mzGiftGroup[i].promoId==promoId){promoObj=opt.mzGiftGroup[i];}}
if($(this).hasClass('selected')){$(this).removeClass('selected');}else{if(lastSelArr.length>=promoObj.canSelectedGiftNum){pu.oneLineTip({msg:'最多可选'+promoObj.canSelectedGiftNum+'件'});return;}else{$(this).addClass('selected');}}
g.selMZ=true;curSelArr=getSelectItems($(this).parent());setMzGift({lastSelArr:lastSelArr,curSelArr:curSelArr,callback:function(d){if(d.errId!='0'){curDom.toggleClass('selected');pu.oneLineTip({msg:d.errMsg});}else{}}});});barSlider('mzGiftGroup .cash.promo');}
function setMzGift(opt){var setArr,_commlistArr=[],_commlist,i,j,skuid,item,type,_data,operationId;if(opt.curSelArr.length>0){type=1;setArr=opt.curSelArr;}else{type=0;setArr=opt.lastSelArr;}
for(i=0,j=setArr.length;i<j;i++){item=setArr[i];for(skuid in item){_commlist=skuid+',,1,'+skuid+',16,'+item[skuid]+',0';_commlistArr.push(_commlist);}}
window.cbSetMzGift=function(d){loading.hide();pu.umpReport({bizid:1,operation:operationId,result:d.errId,source:'0',message:pu.obj2str2(d)});opt.callback&&opt.callback(d);};if(type=='1'){url=cgi.addcmdy;operationId='26';}else if(type=='0'){url=cgi.rmvGift;operationId='27';}
_data={callback:'cbSetMzGift',commlist:_commlistArr.join('$'),type:'1',scene:'1',action:'0',reg:'1'}
pu.wrapData(_data);loading.show();loadJs.loadScript({url:url,data:_data});}
function changePromo(opt){var commlist,newCommlist,_data;commlist=opt.commlist;newCommlist=commlist.split(',');newCommlist[4]=opt.iType;newCommlist[5]=opt.lastPid;newCommlist[6]=0;newCommlist[7]='';newCommlist[8]='';newCommlist[9]='';newCommlist[10]='';newCommlist[11]=opt.chgId;window.modifycmdyproCb=function(d){loading.hide();if(d.errId=='0'){opt.callback&&opt.callback(d);}}
_data={commlist:newCommlist.join(','),type:'0',checked:'0',scene:'1',callback:'modifycmdyproCb'};pu.wrapData(_data);loading.show();loadJs.loadScript({url:cgi.modifycmdypromo,data:_data});}
function barSlider(cl){$('#'+cl+' dt, .item_head').unbind('click').on('click',function(){var p=$(this).parent();if(p.hasClass('on')){p.removeClass('on');}else{p.addClass('on');}});}
function setGByName(obj){g[obj.name]=obj.value;}
function getGByName(name){return g[name];}
module.exports={initNewPromoPage:initNewPromoPage,changePromo:changePromo,setGByName:setGByName,getGByName:getGByName,}});
define('wq.assist',function(require,exports,module){var $=require('zepto'),loadJs=require('loadJs'),pu=require('payutil'),confirmTplV3=require('tpl_wq.confirmV3'),ua=navigator.userAgent,jdDomain3=function(){var jdDomain=(window.userRouter&&window.userRouter.getHost&&window.userRouter.getHost())||'//wqdeal.jd.com/';return(jdDomain.indexOf('/deal/')<0?jdDomain+'deal/':jdDomain);},wa=pu.waReport,domain=jdDomain3(),cgi={modifycmdypromo:domain+'mshopcart/modifycmdypromo',orderpromo:domain+'massit/orderpromo',globalPay_orderpromo:domain+'globalpurchase/orderpromo',addcmdy:domain+'mshopcart/addcmdy',rmvGift:domain+'mshopcart/rmvcmdy',uncheckcmdy:domain+'mshopcart/uncheckcmdy',queryIsNewUser:'//wq.jd.com/userattribute/QueryIsNewUser',getCpOpenid:'//jsapi.qq.com/get?api=login.getCpOpenid',rpCgi:'//fd.3.cn/cesu/r',item:'//wqitem.jd.com/item/view',jdshopcart:'//wqdeal.jd.com/deal/mshopcart/mycart',tuanIdInfo:'//wq.jd.com/pingou_core/GetBizValueInfo',getValidateCode:domain+'massit/sendnumber',};function NoStock(opt){var self=this,_noStockGroups=[],giftNoStock=[],productsNoStock=[],commonNoStock=[],mzGiftNoStock=[],homeServiceNoStock=[],rmArr,_productsNoStock=[],num=0,i,pItem,noStockFlag={},handledSkus=[],i,_item,_commonGroup,isSuitGift=false,_hasNoStock,containCommonStock=false;this.action=opt.action;this.commlist=opt.commlist;this.zengGift=opt.zengGift;this.fzengGift=opt.fzengGift;this.homeserviceArr=opt.homeserviceArr;this.productsList=opt.productsList;this.samsVipGoods=opt.samsVipGoods;this.json=opt.json;this.commonstocksku=opt.json.commonstocksku;this.callback=opt.callback;if(opt.json.errId=='9046'){type='pingou';rmArr=opt.json.rmInvalidSku;}else if(opt.json.errId=='9216'||opt.json.errId=='9047'){type='samsVip';rmArr=opt.samsVipGoods;}else{type='stock';rmArr=opt.json.outOfStock;}
this.productsList=this.productsList.filter(function(item){return!item.isJiaJiaGou;});if(opt.json.commonstocksku&&opt.json.commonstocksku.length>0){opt.json.commonstocksku.forEach(function(father){if(father&&father.skulist&&father.fatherType!='0'){containCommonStock=true;_commonGroup=[];_hasNoStock=false;father.skulist.forEach(function(sku){if(rmArr.indexOf(sku)>-1)_hasNoStock=true;for(i=0;i<self.productsList.length;i++){_item=self.productsList[i];if(_item.mainSku.id==sku){_commonGroup.push(_item.mainSku);handledSkus.push(_item.mainSku.id);break;}}});if(_commonGroup.length>0&&_hasNoStock){commonNoStock.push(_commonGroup);}}})}
if(containCommonStock){type='commonStock';}
rmArr.forEach(function(el){if(handledSkus.indexOf(el+'')>-1)return;var _done=false;for(i=0;i<self.zengGift.length;i++){_item=self.zengGift[i];if(_item.id==el){_item.nostockType='gift';giftNoStock.push(_item);_done=true;if(_item.hasStock=='2'){isSuitGift=true;}
break;}}
if(!_done){for(i=0;i<self.fzengGift.length;i++){_item=self.fzengGift[i];if(_item.id==el){_item.nostockType='gift';mzGiftNoStock.push(_item);_done=true;break;}}}
if(!_done){for(i=0;i<self.homeserviceArr.length;i++){_item=self.homeserviceArr[i];if(_item.id==el){homeServiceNoStock.push(_item);_done=true;}}}
if(!_done){for(i=0;i<self.productsList.length;i++){_item=self.productsList[i];if(_item.mainSku.id==el){productsNoStock.push(_item.mainSku);break;}}}});if(productsNoStock.length>0){for(i=0;i<productsNoStock.length;i++){pItem=productsNoStock[i];if(pItem._suitId&&!noStockFlag['no'+pItem._suitId]){noStockFlag['no'+pItem._suitId]=true;self.productsList.forEach(function(item){if(item.mainSku._suitId==pItem._suitId){item.mainSku.nostockType='product';_productsNoStock.push(item.mainSku);num++;}});}else if(!pItem._suitId){pItem.nostockType='product';_productsNoStock.push(pItem);num++;}}}
if(productsNoStock.length>0||mzGiftNoStock.length>0||giftNoStock.length>0||homeServiceNoStock.length>0){_noStockGroups.push({type:'normal',arr:[].concat(_productsNoStock,mzGiftNoStock,giftNoStock,homeServiceNoStock)});}
commonNoStock.forEach(function(commonGroup){_noStockGroups.push({type:'commonStock',arr:commonGroup});})
this.type=type;this.isSuitGift=isSuitGift;this._noStockGroups=_noStockGroups;this.giftNoStock=giftNoStock;this.mzGiftNoStock=mzGiftNoStock;this.productsNoStock=productsNoStock;this.homeServiceNoStock=homeServiceNoStock;this._productsNoStock=_productsNoStock;this.noSockProductNum=num;}
NoStock.prototype={showNoStock:function(){var that=this;if(this._noStockGroups.length>0){html=confirmTplV3.child_noStockTpl({noStockGroups:this._noStockGroups,type:this.type});$('#wrapBody').append(html);if(this.noSockProductNum==this.productsList.length){if(this.type=='samsVip'){$('[tag="confirm"]').attr('sams','1').html('开通山姆会员');}else{$('[tag="confirm"]').hide();$('[tag="cancel"]').removeClass('btn_2').addClass('btn_1');wa('ptagExposure',{ptag:'7039.21.2'});}}else{if(this.type=='samsVip'){$('[tag="confirm"]').html('移除会员专享商品');$('[tag="cancel"]').attr('sams','1').html('开通山姆会员');}else{wa('ptagExposure',{ptag:'7039.21.1'});}
if(this.isSuitGift){$('[tag="confirm"]').hide();$('[tag="cancel"]').removeClass('btn_2').addClass('btn_1');}}
if(this.type=='commonStock'){$('[tag="confirm"]').attr('commonStock','1');$('[tag="cancel"]').hide();}
$('.mod_alert_mask').show();pu.myBind({'src':'#noStockTplModel [tag="confirm"]','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();if($this.attr('commonStock')){location.href=cgi.jdshopcart;return;}
if($this.attr('sams')){location.href=cgi.item+'?sku=200100420635&price=260.00&fs=1&pos=1& csid='+'15d2c35a22b_a3cbe0a_8e8bc&ss_symbol=8&ss_mtest=qp_v1&key=%E5%B1%B1%E5%A7%86%E4%BC%9A%E5%91%98%E5%8D%A1';return;}
wa('jdClick',{ptag:'7039.21.3'});that.removeProductOrGift({'productsNoStock':that.productsNoStock,'mzGiftNoStock':that.mzGiftNoStock,'giftNoStock':that.giftNoStock,'d':that.json});}});pu.myBind({'src':'#noStockTplModel [tag="cancel"]','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();if($this.attr('sams')){location.href=cgi.item+'?sku=200100420635&price=260.00&fs=1&pos=1& csid='+'15d2c35a22b_a3cbe0a_8e8bc&ss_symbol=8&ss_mtest=qp_v1&key=%E5%B1%B1%E5%A7%86%E4%BC%9A%E5%91%98%E5%8D%A1';}}});pu.myBind({'src':'#noStockTplModel .close','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();}});}else{pu.myAlert(this.json.errMsg);}},removeProductOrGift:function(){var _rmArr,_commonlist,self=this;if(this.json.errId=='9046'){_rmArr=this.json.rmInvalidSku;}else{_rmArr=this.json.outOfStock;}
function removeproductsNoStock(callback){var data,_skuid=[],cItem,cStr;if(self.productsNoStock.length>0){self.productsNoStock.forEach(function(item){cItem={};cItem.itemid=item.iType=='4'?item._promo_pid:item.id;cItem.num=item.num||'1';cItem.iType=item.iType;cItem.targetid=item.iType=='1'?'':item._promo_pid;if(item.iType=='4'){cItem.skuId=item._promo_pid;}else if(item.iType=='24'||item.iType=='29'){cItem.itemid=item.vskuId;cItem.skuId=item.vskuId;}else{cItem.skuId=item.id;}
cStr=[cItem.itemid,'',cItem.num,cItem.skuId,cItem.iType,cItem.targetid,'0'].join(',');if(_skuid.indexOf(cStr)==-1){_skuid.push(cStr);}});data={commlist:_skuid.join('$'),type:'0','scene':1,reg:'1'};pu.wrapData(data);pu.loadCgi({'cgi':cgi.uncheckcmdy,'data':data,'nochecklogin':true,'success':function(d){if(self.action=='1'){self.commlist=self.commlist.split('$').filter(function(item,i){var r=true,id=item.split(',')[0];_rmArr.forEach(function(skuid,i){if(skuid==id)
{r=false;}});return r;}).join('$');}
callback();},'error':function(id,msg,d){callback();}});}else{callback();}}
function removemzGiftNoStock(callback){var data,_skuid=[];if(self.mzGiftNoStock.length>0){self.mzGiftNoStock.forEach(function(item){_skuid.push(item.id+',0,1,'+item.id+',16,'+item.nostockPid+',0');});data={commlist:_skuid.join('$'),type:'1',checked:'0',reg:'1'};pu.wrapData(data);pu.loadCgi({'cgi':cgi.rmvGift,'data':data,'nochecklogin':true,'success':function(d){callback();},'error':function(id,msg,d){callback();}});}else{callback();}}
function removegiftNoStock(callback){var data,_skuid=[];if(self.giftNoStock.length>0){self.giftNoStock.forEach(function(item){if(item.isMfVSuit){_skuid.push(item.vskuId+',0,1,0,24,'+item.id+','+item.pid);}else if(item.isMzVSuit){_skuid.push(item.vskuId+',0,1,0,29,'+item.id+','+item.pid);}else if(item._suitId!='0'){_skuid.push(item.productID+',0,1,0,4,'+item.id+','+item._suitId);}else{_skuid.push(item.productID+',0,1,0,1,'+item.id+','+item._suitId);}});data={commlist:_skuid.join('$'),type:'5',checked:'0',reg:'1'};pu.wrapData(data);pu.loadCgi({'cgi':cgi.rmvGift,'data':data,'nochecklogin':true,'success':function(d){callback();},'error':function(id,msg,d){callback();}});}else{callback();}}
function removeHomeServiceNoStock(callback){var data,_skuid=[];if(self.homeServiceNoStock.length>0){self.homeServiceNoStock.forEach(function(item){if(item.isMfVSuit||item.isMzVSuit){_skuid.push(item.id+',,,,,'+item.productID+','+item.vskuId+',suitType:1');}else{_skuid.push(item.id+',,,,,'+item.productID+','+item._suitId+',');}});data={commlist:_skuid.join('$'),type:'11',checked:'0',reg:'1'};pu.wrapData(data);pu.loadCgi({'cgi':cgi.rmvGift,'data':data,'nochecklogin':true,'success':function(d){callback();},'error':function(id,msg,d){callback();}});}else{callback();}}
removegiftNoStock(function(){removemzGiftNoStock(function(){removeHomeServiceNoStock(function(){removeproductsNoStock(function(){wa('jdClick',{ptag:'7039.1.20'});pu.oneLineTip({msg:'移除成功，您可以继续支付了'});self.callback&&self.callback(self.commlist);});});});});}}
function showLimitedBuy(opt){var limitedSkus=opt.json.limitedbuyskus,_item,type='limitedBuy',limitNum,_done,html;limitedSkus.forEach(function(el){_done=false;for(i=0;i<opt.products.length;i++){_item=opt.products[i];if(_item.mainSku.id==el.skuId){el.id=el.skuId;el.name=_item.mainSku.name;el.image=_item.mainSku.image;el.price=_item.mainSku.promotion.price-_item.mainSku.promotion.discount;_done=true;break;}}
if(!_done){for(i=0;i<opt.gifts.length;i++){_item=opt.gifts[i];if(_item.id==el.skuId){el.id=el.skuId;el.name=_item.name;el.image=_item.image;el.price=0;el.gift='1';_done=true;break;}}}
if(!_done){for(i=0;i<opt.mzGifts.length;i++){_item=opt.mzGifts[i];if(_item.id==el.skuId){el.id=el.skuId;el.name=_item.name;el.image=_item.image;el.price=0;el.gift='1';break;}}}});if(opt.supModifyNum){type='limitedBuy1';limitNum=limitedSkus[0].limitTotal;}
html=confirmTplV3.child_noStockTpl({noStockGroups:[{type:'normal',arr:limitedSkus}],type:type});$('#wrapBody').append($(html));$('.mod_alert_mask').show();!opt.supModifyNum&&$('#noStockTplModel [tag="cancel"]').hide();pu.myBind({'src':'#noStockTplModel [tag="confirm"]','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();if(type=='limitedBuy'){location.href=cgi.jdshopcart;}}});pu.myBind({'src':'#noStockTplModel [tag="cancel"]','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();location.href=cgi.jdshopcart;}});pu.myBind({'src':'#noStockTplModel .close','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();}});}
function showValueAddedServiceExpTip(opt){if(opt.disabledValueAddedServieList.length>0){var serviceList=opt.disabledValueAddedServieList;pu.myConfirm({msg:serviceList.reduce(function(acc,item,index){return item.serviceName+(index>0?'、':'')+acc;},'服务无货'),okText:'暂不购买',onConfirm:function(){history.back();},cancelText:'移除无货服务',onCancel:function(){var cgiURL=cgi.rmvGift;var cgiOption={callback:'rmValueAddedSrvcCb',templete:1,checked:0,type:8,reg:1,commlist:getCommlist(serviceList),};pu.wrapData(cgiOption);window.rmValueAddedSrvcCb=function(rsp){opt.callback&&opt.callback(rsp);}
loadJs.loadScript({url:cgiURL,data:cgiOption});},});}else if(opt.disabledValueAddedServieShopList.length>0){pu.myAlert('到店服务店铺已失效，请返回重新选择到店服务店铺',function(){history.back();});}}
function getCommlist(serviceList){return serviceList.reduce(function(acc,item,index){var commlist=[item.mainSkuId,'',item.mainSkuNum,item.mainSkuId,'1','','0'].join(',');return acc+(index>0?'$':'')+commlist;},'');}
function handleDiscod(opt){var i,j,pItem,yItem,_discodArr=[],discodArr=[],containYb=false,discodFlag={},pNum=0;for(i=0;i<opt.productsList.length;i++){pItem=opt.productsList[i];if(opt.discodList.indexOf(pItem.mainSku.id)>-1){_discodArr.push(pItem.mainSku);}
if(pItem.ybList){for(j=0;j<pItem.ybList.length;j++){yItem=pItem.ybList[j];if(opt.discodList.indexOf(yItem.ybsku.id)>-1){yItem.ybsku.isyb=true;_discodArr.push(yItem.ybsku);containYb=true;}}}}
for(i=0;i<_discodArr.length;i++){if(_discodArr[i]._suitId&&!discodFlag['p'+_discodArr[i]._suitId]){discodFlag['p'+_discodArr[i]._suitId]=true;for(j=0;j<opt.productsList.length;j++){pItem=opt.productsList[j];if(pItem.mainSku._suitId==_discodArr[i]._suitId){discodArr.push(pItem.mainSku);pNum++;}}}else if(!_discodArr[i]._suitId){if(!_discodArr[i].isyb){pNum++;}
discodArr.push(_discodArr[i])}}
pu.myBind({'src':'#delForDiscod','fun':function(e,$this){var html;wa('jdClick',{ptag:'7039.1.78'});html=confirmTplV3.child_discodTpl({discodArr:discodArr});$('body').append(html);$('.mod_alert_mask').show();if(containYb||pNum==opt.productsList.length){$('#noCodModelBtn1').hide();}
pu.myBind({'src':'#noCodModelBtn1','fun':function(){var commlist=[],_d,cItem,cStr,_commonlist=[];discodArr.forEach(function(item){cItem={};cItem.itemid=item.iType=='4'?item._promo_pid:item.id;cItem.num=item.num||'1';cItem.iType=item.iType;cItem.targetid=item.iType=='1'?'':item._promo_pid;if(item.iType=='4'){cItem.skuId=item._promo_pid;}else if(item.iType=='24'||item.iType=='29'){cItem.itemid=item.vskuId;cItem.skuId=item.vskuId;}else{cItem.skuId=item.id;}
cStr=[cItem.itemid,'',cItem.num,cItem.skuId,cItem.iType,cItem.targetid,'0'].join(',');if(_commonlist.indexOf(cStr)==-1){_commonlist.push(cStr);}});_d={commlist:_commonlist.join('$'),type:0,all:0,reg:1};pu.wrapData(_d);pu.loadCgi({'cgi':cgi.uncheckcmdy,'data':_d,'doEverything':function(d){$('#noCodModel').remove();$('.mod_alert_mask').hide();},'success':function(d){opt.callback&&opt.callback(d);},'error':function(id,msg){pu.myAlertV2({msg:msg});}});}});pu.myBind({'src':'#noCodModelBtn2','fun':function(){$('#noCodModel').remove();$('.mod_alert_mask').hide();}});}})}
function reportCartData(cidArr){try{JD.store.getItem('_cartRd',function(key,value,errObj){if(value){wa('ptagExposure',{ptag:value});try{JD.store.delItem('_cartRd');}catch(e){}}});}catch(e){}
var cidLeve1=[],i,_data;if(cidArr){try{for(i=0;i<cidArr.length;i++){cidLeve1.push(cidArr[i].split('|')[1].split('_')[0]);}
wa('ptagExposure',{ptag:'7014.29.5',cid:cidLeve1.join(',')});}catch(e){}}
window.queryIsNewUserCb=function(d){if(d.retcode!='0'){return;}
if(d.isNewUser=='2'){wa('ptagExposure',{ptag:'7014.29.6'});}else{wa('ptagExposure',{ptag:'7014.29.7'});}}
_data={callback:'queryIsNewUserCb',t:Math.random()}
if(window.mConfirm){_data.sceneid='2';}
loadJs.loadScript({url:cgi.queryIsNewUser,data:_data});}
function reportDelayData(){var reportArr=[],_item,mylog,timeout_resource,entries,domainReg,_name;try{timeout_resource=localStorage.getItem('deal_timeout_store');timeout_resource=timeout_resource?timeout_resource.split('|'):[];localStorage.removeItem('deal_timeout_store');for(var i=0;i<timeout_resource.length;i++){_item=timeout_resource[i];if(_item.indexOf('confirm')>-1){reportArr.push('1|71|1|0|'+_item.replace('confirm_',''));}else if(_item.indexOf('cart')>-1){reportArr.push('15|71|1|0|'+_item.replace('cart,',''));}}
if(reportArr.length>0){mylog=new Image();mylog.src='https://wq.jd.com/webmonitor/collect/biz.json?contents='+reportArr.join(',')+'&t='+Math.random();}
if(window.performance&&window.performance.getEntries){window.setTimeout(function(){reportArr=[];entries=window.performance.getEntries();domainReg=/https?:\/\/.+com\//g;for(var i=0;i<entries.length;i++){_item=entries[i];_name=_item.name?_item.name.split('?')[0].replace(domainReg,''):'no url';_name=_name.substr(0,30).replace(/,/g,'');if(_item.entryType=='navigation'&&_item.duration>5000){reportArr.push(_name+'_'+parseInt(_item.duration));}else if(_item.entryType=='resource'&&_item.duration>2000){reportArr.push(_name+'_'+parseInt(_item.duration));}}
if(reportArr.length>0){mylog=new Image();mylog.src='https://wq.jd.com/webmonitor/collect/biz.json?contents=1|72|1|0|'+reportArr.join('$')+'&t='+Math.random();}},100);}}catch(e){}}
function setUserInfo(){pu.loadonJS(cgi.getCpOpenid,function(){if(window.browser&&window.browser.login&&window.browser.login.getCpOpenid){window.browser.login.getCpOpenid({'appkey':'jd','wx_type':2,},function(res){try{var _url;if(/android/i.test(navigator.userAgent)){res=JSON.parse(res);}
if(res.code==0){_url='//wqdeal.jd.com/deal/massit/getwquserinfo?ticketId='+res.ticket+'&sceneval=2&callback=wquserinfoCb&r='+Math.random();window.wquserinfoCb=function(d){}
JD.sendJs(_url);}}catch(e){}});}});}
function reportPerformance(){try{var pgid=17,os,myLog,wq_area=JD.cookie.get('wq_area'),rpArr=[],cartT=JD.url.getUrlParam('t'),screenInfo=window.screen.width+","+window.screen.height+"\t"+(window.devicePixelRatio||0)+"\t",performanceTime=(window.performance||window.webkitPerformance||{}).timing,fetchTime=performanceTime.navigationStart||performanceTime.fetchStart,imgTime,whiteTime,cgiTime;if(!fetchTime){return;}
if(/android/i.test(ua)){os='android';}else if(/iPhone/i.test(ua)){os='ios';}else{os='unknow';}
if(/MicroMessenger/i.test(ua)){pgid=16;}
whiteTime=performanceTime.domLoading-fetchTime;cgiTime=performanceTime.responseStart-performanceTime.requestStart;rpArr.push('pid='+pgid);rpArr.push('os='+os);rpArr.push('wq_area='+encodeURIComponent(wq_area));rpArr.push('ext='+screenInfo);if(window._FIRST_IMG_LOAD){imgTime=window._FIRST_IMG_LOAD-fetchTime;rpArr.push('s14='+imgTime);}
rpArr.push('s15='+whiteTime);rpArr.push('s16='+cgiTime);if(window._FIRST_RENDER_TIME){rpArr.push('s17='+(window._FIRST_RENDER_TIME-fetchTime));}
if(cartT&&/^\d+$/.test(cartT)&&!JD.url.getUrlParam('commonlist')){rpArr.push('s18='+(window._FIRST_IMG_LOAD-cartT-100));}
JD.device.getNetwork(function(network){rpArr.push('apn='+network);rpArr.push('r='+Math.random());myLog=new Image();myLog.src=cgi.rpCgi+'?'+rpArr.join('&');});}catch(e){}}
function loadPingouInfo(data,cb){var getTuanIdParams={biz_value:data.biz_value,platform:data.platform};getTuanIdParams.callback='cbTuanId';window.cbTuanId=function(d){handlePingouInfo(d,cb);}
loadJs.loadScript({url:cgi.tuanIdInfo,data:getTuanIdParams})}
function handlePingouInfo(pingouInfo,cb){var CAN_PINGOU=1;if(!pingouInfo||pingouInfo.iRet!=0||pingouInfo.tuan_member_size<1||pingouInfo.active_status!=1){cb(CAN_PINGOU);return;}
var tuanMemberCount=pingouInfo.tuan_member_size,tuanMemberList=pingouInfo.tuan_member_list,currentCount=(tuanMemberList&&tuanMemberList.length)||0,leftCount=tuanMemberCount-currentCount-1,userHeadPortraitUrl=pingouInfo.self_head_url,defaultHeadUrl='//img11.360buyimg.com/jdphoto/s160x160_jfs/t1951/176/1222496278/15607/bbb3b2eb/568cdbf0N4d33c2a4.png',memberList=[],data,i,l,member,withMore=false,withEnd=false,needShow,html;if(pingouInfo.left_tuan_member!=undefined&&pingouInfo.left_tuan_member!=''&&+pingouInfo.left_tuan_member>-1){leftCount=Math.max(pingouInfo.left_tuan_member-1,0);}
withMore=(tuanMemberCount>5&&currentCount>2)?1:0;withEnd=(leftCount>=1)?1:0;needShow=Math.min(4-withMore-withEnd,tuanMemberCount-1);if(tuanMemberList&&tuanMemberList.length>0){tuanMemberList.forEach(function(member,i){if(i<needShow){if(member.ismaster){memberList.unshift({type:'master',headPortraitUrl:member.head_portrait_url||defaultHeadUrl})}else{memberList.push({type:'',headPortraitUrl:member.head_portrait_url||defaultHeadUrl})}}});}
if(withMore){memberList.push({isMore:true,});}
memberList.push({type:'me',headPortraitUrl:userHeadPortraitUrl||defaultHeadUrl});if((pingouInfo.tuan_id==0&&leftCount>1)||leftCount>(5-memberList.length)){memberList.push({isEnd:true,text:"x"+leftCount})}else if(leftCount>0){for(i=0;i<leftCount;++i){memberList.push({isEnd:true,text:"?"})}}
data={memberList:memberList,from:pingouInfo.tuan_id,left:Math.max(leftCount+1,1)};html=confirmTplV3.child_pingouInfo(data);$('#pingouInfoArea').html(html);cb(pingouInfo.active_status);}
function setEid(){if(JD.cookie.get('cd_eid')||!window.pin){return;}
if(window.JD){JD.sendJs('//gia.jd.com/m.html',{onLoad:function(){JD.sendJs('//gias.jd.com/js/m.js',{onLoad:function(){try{var riskJd=getJdEid(),eid;eid=riskJd.eid||'';eid&&JD.cookie.set('cd_eid',eid,10*365*24*60,'/','jd.com');}catch(e){}}});}});}}
function showPhoneValidateToast(d,payCb,cancelCb){if(d.errId=='9086'){if(document.querySelector('p[tag="error_tip"]')){setTip(d.errMsg);return;}}else if(!d.uuid){pu.umpReport({bizid:1,operation:101,result:9085,source:'0',message:'confirm接口 无uuid'});cancelCb();pu.myAlert('支付失败，请稍后重试');return;}
var lastSendCodeTime=null;try{lastSendCodeTime=localStorage.getItem('confirm_send_validate_code_time')}catch(e){}
var interval=null;var nextValidateCodeTime=0;var domWrap=document.querySelector(".wx_wrap")||document.body;var domMain=document.createElement('div');domMain.className='mod_alert mod_alert_info show fixed mod_alert_validate_phone';domMain.innerHTML='<h3 class="title">请输入手机验证码</h3><p class="tip">本次收货地址不是您的常用地址，为了账号安全，我们将发送短信验证码到您账号所绑定的手机号'+((d.phoneNumber&&d.phoneNumber.replace(/(\d{3})\d*(\d{4})/,'$1****$2'))||'')+'</p><div class="input_wrap_v2 btn_right" id="modAlertValidateCode"><span class="close" id="clearIcon"><i class="close_v2"></i></span><a class="text color_red" id="getValidateCode">发送验证码</a><input type="number" maxlength="30" placeholder="请输入验证码" tag="inputValidateCode"></div><p class="tip color_red" tag="error_tip"></p><p class="btns"><a href="javascript:void(0)" class="btn btn_2" tag="cancel_btn">取消</a><a href="javascript:void(0)" class="btn btn_1" tag="confirm_btn">确认</a></p>';domWrap.appendChild(domMain);var domMask=document.createElement('div');domMask.className='mod_alert_mask show mod_alert_validate_phone_mask';domWrap.appendChild(domMask);if(lastSendCodeTime){nextValidateCodeTime=60-((new Date().getTime()-lastSendCodeTime)/1000).toFixed(0);if(nextValidateCodeTime>0){setWaitTime(nextValidateCodeTime);interval=setInterval(function(){--nextValidateCodeTime;if(nextValidateCodeTime<1){clearWaitTime();clearInterval(interval);interval=null;}else{$('#getValidateCode').html(nextValidateCodeTime+'S后重发');}},1000);}}
$('input[type=number]').keypress(function(e){　　if(!String.fromCharCode(e.keyCode).match(/[0-9\.]/)){　　　　return false;　　}});$('#clearIcon').unbind('click').on('click',function(){$('[tag="inputValidateCode"]').val('');})
$('#getValidateCode').unbind('click').on('click',function(){if(nextValidateCodeTime>0)return;var cgiURL=cgi.getValidateCode;var cgiData={callback:'cbGetValidateCode'};window.cbGetValidateCode=function(d){if(d.success==='1'){setTip('');try{localStorage.setItem('confirm_send_validate_code_time',new Date().getTime())}catch(e){}
var $validateCodeBtn=$('#getValidateCode');nextValidateCodeTime=60;setWaitTime(nextValidateCodeTime);interval=setInterval(function(){--nextValidateCodeTime;if(nextValidateCodeTime<1){clearWaitTime();clearInterval(interval);interval=null;}else{$validateCodeBtn.html(nextValidateCodeTime+'S后重发');}},1000);}else{if(d.resultCode=='510'){setTip("已超过当日验证码发送上限，请明天再试")}else{setTip(d.errMsg);}}}
loadJs.loadScript({url:cgiURL,data:cgiData});});$('[tag="cancel_btn"]').unbind('click').on('click',function(){clear();cancelCb&&cancelCb();});$('[tag="confirm_btn"]').unbind('click').on('click',function(){var result=checkInput();if(result.msg.length>0){setTip(result.msg);return;}
setTip('');payCb&&payCb(result.validateCode);});function clear(){clearInterval(interval);domWrap.removeChild(domMain);domWrap.removeChild(domMask);domWrap=null;domMain=null;domMask=null;}
function setWaitTime(time){$('#getValidateCode').removeClass('color_red').addClass('color_light_red')
$('#getValidateCode').html(time+'S后重发');}
function clearWaitTime(){$('#getValidateCode').removeClass('color_light_red').addClass('color_red')
$('#getValidateCode').html('获取验证码');}
function setTip(msg){if(msg&&msg!==''){$('#modAlertValidateCode').addClass('error');$('p[tag="error_tip"]').html('<i class="warn"></i>'+msg);$('[tag="inputValidateCode"]').focus();}else{$('#modAlertValidateCode').removeClass('error');$('p[tag="error_tip"]').html('');}}
function checkInput(){var msg='';var domInputValidateCode=$(domMain.querySelector('[tag="inputValidateCode"]'));var inputValidateCode=domInputValidateCode.val()||'';if(!inputValidateCode||inputValidateCode===''){msg='请输入手机验证码';}
return{msg:msg,validateCode:inputValidateCode,};}}
function closePhoneValidateToast(cb){$('.mod_alert_validate_phone').remove();$('.mod_alert_validate_phone_mask').remove();cb&&cb();}
module.exports={NoStock:NoStock,showValueAddedServiceExpTip:showValueAddedServiceExpTip,showLimitedBuy:showLimitedBuy,handleDiscod:handleDiscod,reportCartData:reportCartData,reportDelayData:reportDelayData,setUserInfo:setUserInfo,reportPerformance:reportPerformance,loadPingouInfo:loadPingouInfo,setEid:setEid,showPhoneValidateToast:showPhoneValidateToast,closePhoneValidateToast:closePhoneValidateToast,}});
define('wq.qrcode',function(require,exports,module){var _cacheThisModule_,QRCode;!function(){function a(a){this.mode=c.MODE_8BIT_BYTE,this.data=a,this.parsedData=[];for(var b=[],d=0,e=this.data.length;e>d;d++){var f=this.data.charCodeAt(d);f>65536?(b[0]=240|(1835008&f)>>>18,b[1]=128|(258048&f)>>>12,b[2]=128|(4032&f)>>>6,b[3]=128|63&f):f>2048?(b[0]=224|(61440&f)>>>12,b[1]=128|(4032&f)>>>6,b[2]=128|63&f):f>128?(b[0]=192|(1984&f)>>>6,b[1]=128|63&f):b[0]=f,this.parsedData=this.parsedData.concat(b)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function b(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(a,b){if(void 0==a.length)throw new Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=new Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function j(a,b){this.totalCount=a,this.dataCount=b}function k(){this.buffer=[],this.length=0}function m(){return"undefined"!=typeof CanvasRenderingContext2D}function n(){var a=!1,b=navigator.userAgent;return/android/i.test(b)&&(a=!0,aMat=b.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(a=parseFloat(aMat[1]))),a}function r(a,b){for(var c=1,e=s(a),f=0,g=l.length;g>=f;f++){var h=0;switch(b){case d.L:h=l[f][0];break;case d.M:h=l[f][1];break;case d.Q:h=l[f][2];break;case d.H:h=l[f][3]}if(h>=e)break;c++}if(c>l.length)throw new Error("Too long data");return c}function s(a){var b=encodeURI(a).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return b.length+(b.length!=a?3:0)}a.prototype={getLength:function(){return this.parsedData.length},write:function(a){for(var b=0,c=this.parsedData.length;c>b;b++)a.put(this.parsedData[b],8)}},b.prototype={addData:function(b){var c=new a(b);this.dataList.push(c),this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw new Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[d][e]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,c),this.typeNumber>=7&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=c>=0&&6>=c&&(0==d||6==d)||d>=0&&6>=d&&(0==c||6==c)||c>=2&&4>=c&&d>=2&&4>=d?!0:!1)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=f.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){var d=a.createEmptyMovieClip(b,c),e=1;this.make();for(var f=0;f<this.modules.length;f++)for(var g=f*e,h=0;h<this.modules[f].length;h++){var i=h*e,j=this.modules[f][h];j&&(d.beginFill(0,100),d.moveTo(i,g),d.lineTo(i+e,g),d.lineTo(i+e,g+e),d.lineTo(i,g+e),d.endFill())}return d},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(var b=8;b<this.moduleCount-8;b++)null==this.modules[6][b]&&(this.modules[6][b]=0==b%2)},setupPositionAdjustPattern:function(){for(var a=f.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var g=-2;2>=g;g++)for(var h=-2;2>=h;h++)this.modules[d+g][e+h]=-2==g||2==g||-2==h||2==h||0==g&&0==h?!0:!1}},setupTypeNumber:function(a){for(var b=f.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(var c=0;18>c;c++){var d=!a&&1==(1&b>>c);this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d}},setupTypeInfo:function(a,b){for(var c=this.errorCorrectLevel<<3|b,d=f.getBCHTypeInfo(c),e=0;15>e;e++){var g=!a&&1==(1&d>>e);6>e?this.modules[e][8]=g:8>e?this.modules[e+1][8]=g:this.modules[this.moduleCount-15+e][8]=g}for(var e=0;15>e;e++){var g=!a&&1==(1&d>>e);8>e?this.modules[8][this.moduleCount-e-1]=g:9>e?this.modules[8][15-e-1+1]=g:this.modules[8][15-e-1]=g}this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,g=0,h=this.moduleCount-1;h>0;h-=2)for(6==h&&h--;;){for(var i=0;2>i;i++)if(null==this.modules[d][h-i]){var j=!1;g<a.length&&(j=1==(1&a[g]>>>e));var k=f.getMask(b,d,h-i);k&&(j=!j),this.modules[d][h-i]=j,e--,-1==e&&(g++,e=7)}if(d+=c,0>d||this.moduleCount<=d){d-=c,c=-c;break}}}},b.PAD0=236,b.PAD1=17,b.createData=function(a,c,d){for(var e=j.getRSBlocks(a,c),g=new k,h=0;h<d.length;h++){var i=d[h];g.put(i.mode,4),g.put(i.getLength(),f.getLengthInBits(i.mode,a)),i.write(g)}for(var l=0,h=0;h<e.length;h++)l+=e[h].dataCount;if(g.getLengthInBits()>8*l)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+8*l+")");for(g.getLengthInBits()+4<=8*l&&g.put(0,4);0!=g.getLengthInBits()%8;)g.putBit(!1);for(;;){if(g.getLengthInBits()>=8*l)break;if(g.put(b.PAD0,8),g.getLengthInBits()>=8*l)break;g.put(b.PAD1,8)}return b.createBytes(g,e)},b.createBytes=function(a,b){for(var c=0,d=0,e=0,g=new Array(b.length),h=new Array(b.length),j=0;j<b.length;j++){var k=b[j].dataCount,l=b[j].totalCount-k;d=Math.max(d,k),e=Math.max(e,l),g[j]=new Array(k);for(var m=0;m<g[j].length;m++)g[j][m]=255&a.buffer[m+c];c+=k;var n=f.getErrorCorrectPolynomial(l),o=new i(g[j],n.getLength()-1),p=o.mod(n);h[j]=new Array(n.getLength()-1);for(var m=0;m<h[j].length;m++){var q=m+p.getLength()-h[j].length;h[j][m]=q>=0?p.get(q):0}}for(var r=0,m=0;m<b.length;m++)r+=b[m].totalCount;for(var s=new Array(r),t=0,m=0;d>m;m++)for(var j=0;j<b.length;j++)m<g[j].length&&(s[t++]=g[j][m]);for(var m=0;e>m;m++)for(var j=0;j<b.length;j++)m<h[j].length&&(s[t++]=h[j][m]);return s};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;f.getBCHDigit(b)-f.getBCHDigit(f.G15)>=0;)b^=f.G15<<f.getBCHDigit(b)-f.getBCHDigit(f.G15);return(a<<10|b)^f.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;f.getBCHDigit(b)-f.getBCHDigit(f.G18)>=0;)b^=f.G18<<f.getBCHDigit(b)-f.getBCHDigit(f.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return f.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case e.PATTERN000:return 0==(b+c)%2;case e.PATTERN001:return 0==b%2;case e.PATTERN010:return 0==c%3;case e.PATTERN011:return 0==(b+c)%3;case e.PATTERN100:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case e.PATTERN101:return 0==b*c%2+b*c%3;case e.PATTERN110:return 0==(b*c%2+b*c%3)%2;case e.PATTERN111:return 0==(b*c%3+(b+c)%2)%2;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new i([1],0),c=0;a>c;c++)b=b.multiply(new i([1,g.gexp(c)],0));return b},getLengthInBits:function(a,b){if(b>=1&&10>b)switch(a){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(27>b)switch(a){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else{if(!(41>b))throw new Error("type:"+b);switch(a){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;b>d;d++)for(var e=0;b>e;e++){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h++)if(!(0>d+h||d+h>=b))for(var i=-1;1>=i;i++)0>e+i||e+i>=b||(0!=h||0!=i)&&g==a.isDark(d+h,e+i)&&f++;f>5&&(c+=3+f-5)}for(var d=0;b-1>d;d++)for(var e=0;b-1>e;e++){var j=0;a.isDark(d,e)&&j++,a.isDark(d+1,e)&&j++,a.isDark(d,e+1)&&j++,a.isDark(d+1,e+1)&&j++,(0==j||4==j)&&(c+=3)}for(var d=0;b>d;d++)for(var e=0;b-6>e;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;b>e;e++)for(var d=0;b-6>d;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(var k=0,e=0;b>e;e++)for(var d=0;b>d;d++)a.isDark(d,e)&&k++;var l=Math.abs(100*k/b/b-50)/5;return c+=10*l}},g={glog:function(a){if(1>a)throw new Error("glog("+a+")");return g.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;a>=256;)a-=255;return g.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;8>h;h++)g.EXP_TABLE[h]=1<<h;for(var h=8;256>h;h++)g.EXP_TABLE[h]=g.EXP_TABLE[h-4]^g.EXP_TABLE[h-5]^g.EXP_TABLE[h-6]^g.EXP_TABLE[h-8];for(var h=0;255>h;h++)g.LOG_TABLE[g.EXP_TABLE[h]]=h;i.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=new Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=g.gexp(g.glog(this.get(c))+g.glog(a.get(d)));return new i(b,0)},mod:function(a){if(this.getLength()-a.getLength()<0)return this;for(var b=g.glog(this.get(0))-g.glog(a.get(0)),c=new Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(var d=0;d<a.getLength();d++)c[d]^=g.gexp(g.glog(a.get(d))+b);return new i(c,0).mod(a)}},j.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],j.getRSBlocks=function(a,b){var c=j.getRsBlockTable(a,b);if(void 0==c)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;d>f;f++)for(var g=c[3*f+0],h=c[3*f+1],i=c[3*f+2],k=0;g>k;k++)e.push(new j(h,i));return e},j.getRsBlockTable=function(a,b){switch(b){case d.L:return j.RS_BLOCK_TABLE[4*(a-1)+0];case d.M:return j.RS_BLOCK_TABLE[4*(a-1)+1];case d.Q:return j.RS_BLOCK_TABLE[4*(a-1)+2];case d.H:return j.RS_BLOCK_TABLE[4*(a-1)+3];default:return void 0}},k.prototype={get:function(a){var b=Math.floor(a/8);return 1==(1&this.buffer[b]>>>7-a%8)},put:function(a,b){for(var c=0;b>c;c++)this.putBit(1==(1&a>>>b-c-1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}};var l=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],o=function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){function g(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}var b=this._htOption,c=this._el,d=a.getModuleCount();Math.floor(b.width/d),Math.floor(b.height/d),this.clear();var h=g("svg",{viewBox:"0 0 "+String(d)+" "+String(d),width:"100%",height:"100%",fill:b.colorLight});h.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),c.appendChild(h),h.appendChild(g("rect",{fill:b.colorDark,width:"1",height:"1",id:"template"}));for(var i=0;d>i;i++)for(var j=0;d>j;j++)if(a.isDark(i,j)){var k=g("use",{x:String(i),y:String(j)});k.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),h.appendChild(k)}},a.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},a}(),p="svg"===document.documentElement.tagName.toLowerCase(),q=p?o:m()?function(){function a(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function d(a,b){var c=this;if(c._fFail=b,c._fSuccess=a,null===c._bSupportDataURI){var d=document.createElement("img"),e=function(){c._bSupportDataURI=!1,c._fFail&&_fFail.call(c)},f=function(){c._bSupportDataURI=!0,c._fSuccess&&c._fSuccess.call(c)};return d.onabort=e,d.onerror=e,d.onload=f,d.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}c._bSupportDataURI===!0&&c._fSuccess?c._fSuccess.call(c):c._bSupportDataURI===!1&&c._fFail&&c._fFail.call(c)}if(this._android&&this._android<=2.1){var b=1/window.devicePixelRatio,c=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(a,d,e,f,g,h,i,j){if("nodeName"in a&&/img/i.test(a.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*b;else"undefined"==typeof j&&(arguments[1]*=b,arguments[2]*=b,arguments[3]*=b,arguments[4]*=b);c.apply(this,arguments)}}var e=function(a,b){this._bIsPainted=!1,this._android=n(),this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,a.appendChild(this._elCanvas),this._el=a,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return e.prototype.draw=function(a){var b=this._elImage,c=this._oContext,d=this._htOption,e=a.getModuleCount(),f=d.width/e,g=d.height/e,h=Math.round(f),i=Math.round(g);b.style.display="none",this.clear();for(var j=0;e>j;j++)for(var k=0;e>k;k++){var l=a.isDark(j,k),m=k*f,n=j*g;c.strokeStyle=l?d.colorDark:d.colorLight,c.lineWidth=1,c.fillStyle=l?d.colorDark:d.colorLight,c.fillRect(m,n,f,g),c.strokeRect(Math.floor(m)+.5,Math.floor(n)+.5,h,i),c.strokeRect(Math.ceil(m)-.5,Math.ceil(n)-.5,h,i)}this._bIsPainted=!0},e.prototype.makeImage=function(){this._bIsPainted&&d.call(this,a)},e.prototype.isPainted=function(){return this._bIsPainted},e.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},e.prototype.round=function(a){return a?Math.floor(1e3*a)/1e3:a},e}():function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){for(var b=this._htOption,c=this._el,d=a.getModuleCount(),e=Math.floor(b.width/d),f=Math.floor(b.height/d),g=['<table style="border:0;border-collapse:collapse;">'],h=0;d>h;h++){g.push("<tr>");for(var i=0;d>i;i++)g.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+e+"px;height:"+f+"px;background-color:"+(a.isDark(h,i)?b.colorDark:b.colorLight)+';"></td>');g.push("</tr>")}g.push("</table>"),c.innerHTML=g.join("");var j=c.childNodes[0],k=(b.width-j.offsetWidth)/2,l=(b.height-j.offsetHeight)/2;k>0&&l>0&&(j.style.margin=l+"px "+k+"px")},a.prototype.clear=function(){this._el.innerHTML=""},a}();QRCode=function(a,b){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:d.H},"string"==typeof b&&(b={text:b}),b)for(var c in b)this._htOption[c]=b[c];"string"==typeof a&&(a=document.getElementById(a)),this._android=n(),this._el=a,this._oQRCode=null,this._oDrawing=new q(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(a){this._oQRCode=new b(r(a,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(a),this._oQRCode.make(),this._el.title=a,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=d}();exports.getQRCode=function(el,op){return new QRCode(el,op);};exports.clear=function(){this.clear();}});
define('payV2',function(require,exports,module){var loadJs=require('loadJs'),ui=require('ui'),qrcode=require('wq.qrcode'),REGEXP_IOS_QQ=/(iPad|iPhone|iPod).*? QQ\/([\d\.]+)/,ua=navigator.userAgent,g={wxPayTimes:0,wxNoreadyTimes:0,mptype:JD.cookie.get('wxmall_ptype')||0},cgi={wxPay:'//wq.jd.com/jdpaygw/wxpay',wxpappay:'//wq.jd.com/jdpaygw/wxpappay',wxqrPay:'//wq.jd.com/jdpaygw/wxqrpay',unionPay:'//wq.jd.com/jdpaygw/wyzxpay',cftPay:'//wq.jd.com/jdpaygw/cftpay',sqPay:'//wq.jd.com/jdpaygw/sqpay',wxapppay:'//wq.jd.com/jdpaygw/wxapppay',wxmwebpay:'//wq.jd.com/jdpaygw/wxmwebpay',jdappmpay:'//wq.jd.com/jdpaygw/jdappmpay',baitiao:'//wq.jd.com/pinbind/gettoken',jdbtpay:'//wq.jd.com/jdpaygw/jdbtpay',daiCgi:'//wq.jd.com/bases/daifu/find',supportpappay:'//wq.jd.com/wxcontractgw/supportpappay',giveuppappay:'//wq.jd.com/wxcontractgw/operatepappayguide',showbtentrace:'//wq.jd.com/payentracegw/showbtentrace',payOnLine:'//p.m.jd.com/norder/payOnLine.action',dealDetail:'//wqs.jd.com/order/n_detail_v2.shtml',daiDetail:'//wqs.jd.com/order/order_daifu.shtml'};function umpReport(opt){try{if(window.JD){if(opt.message==''||opt.result=='0'){opt.message='no error';}
window.JD.report.umpBiz({bizid:opt.bizid,operation:opt.operation,result:opt.result,source:opt.source,message:opt.message,notCombo:opt.notCombo||false});}}catch(ignore){}}
function isAndroid(){if(/android/i.test(ua)){return true;}
return false;}
function isMQQUserAgent(){if(/qq\/([\d\.]+)*/.test(ua.toLowerCase())){return true;}
return false;}
function QQVersion(m){return m&&m[2]||0;}
function compareVersion(a,b){var i,len;a=String(a).split('.');b=String(b).split('.');try{for(i=0,len=Math.max(a.length,b.length);i<len;i++){var l=isFinite(a[i])&&Number(a[i])||0,r=isFinite(b[i])&&Number(b[i])||0;if(l<r){return-1;}else if(l>r){return 1;}}}catch(e){return-1;}
return 0;}
function compare(ver){return compareVersion(QQVersion(ua.match(REGEXP_IOS_QQ)),ver);}
function loadScript(url,callback,charset){if(typeof callback=='string'){charset=callback;callback=function(){};}
var sc=document.createElement('script'),head=document.getElementsByTagName('head')[0];sc.setAttribute('charset',charset||'utf-8');sc.src=url;sc.onload=function(){callback&&callback();head.removeChild(sc);};head.appendChild(sc);}
function getFinger(callback){loadScript('//wq.360buyimg.com/js/version/201707/fingerprint2.201707211617.js',function(){var fp=new Fingerprint2();fp.get(function(result){callback&&callback(result);});});}
function __wxPay(json){var ip,pachage=json.data.package;if(json.spbill_create_ip){ip=json.spbill_create_ip.replace(/\_/g,'.');ip='&spbill_create_ip='+ip+'&';if(pachage.indexOf(ip)==-1){json.data.package=pachage.replace(/\&spbill\_create\_ip\=[^\&]+\&/,ip);}}
if(typeof window.WeixinJSBridge=='object'&&typeof window.WeixinJSBridge.invoke=='function'){try{window.WeixinJSBridge.invoke('getBrandWCPayRequest',json.data,function(t){if(t.err_msg==='get_brand_wcpay_request:ok'){json.callbackSuc&&json.callbackSuc(t);window.setTimeout(function(){if(json.iswxapp){return;}
if(json.replaceHistory){location.replace(json.callbackUrl);}else{location.href=json.callbackUrl;}},300);}else if(t.err_msg==='get_brand_wcpay_request:cancel'){json.callbackCancel&&json.callbackCancel(t);}else if(t.err_msg==='get_brand_wcpay_request:fail'){json.callbackFail&&json.callbackFail(t);if(t.err_code!='3'){ui.alert({msg:'支付失败,请稍候再试'});}}else if(t.err_msg==='system:function_not_exist'){json.callbackNosup&&json.callbackNosup(t);ui.alert({msg:'系统不支持微信支付'});}else if(t.err_msg==='system:access_denied'||t.err_msg==='access_control:not_allow'){g.wxPayTimes++;if(g.wxPayTimes>=10){ui.alert({msg:'此笔订单暂不支持微信支付，请选择其他支付方式'});json.callbackNoright&&json.callbackNoright(t);return;}
setTimeout(function(){__wxPay(json,true);},400);}else{json.callbackElse&&json.callbackElse(t);ui.alert({msg:'发生未知错误。'+t.err_msg});}
json.loadingId&&$('#'+json.loadingId).hide();});}catch(e){umpReport({bizid:1,operation:5,result:'555',source:'0',message:'wx jsapi error'});}}else{json.loadingId&&$('#'+json.loadingId).show();g.wxNoreadyTimes++;if(g.wxNoreadyTimes>=10){json.callbackNoready&&json.callbackNoready();return;}
setTimeout(function(){__wxPay(json);},400);}}
function __qqPay(json){var channel,appid='2712384158';if(window.mqq&&window.mqq.compare('4.6.1')>=0){if(g.mptype=='4'){channel='dongtai';}else if(g.mptype=='2'){channel='wallet';}else{channel='other';}
if(json.appid){appid=json.appid;}
if(window.mqq&&window.mqq.tenpay&&window.mqq.tenpay.pay){window.mqq.tenpay.pay({tokenId:json.tokenid,pubAcc:'2712384158',pubAccHint:'欢迎收听京东服务号',appInfo:'appid#'+appid+'|bargainor_id#1219098701|channel#'+channel},function(result){if(result.resultCode=='0'){if(json.callbackSuc){json.callbackSuc(result);}
window.setTimeout(function(){if(json.replaceHistory){location.replace(json.callbackUrl);}else{location.href=json.callbackUrl;}},100);}else{if(json.callbackFail){json.callbackFail(result);}}});}else{ui.alert({msg:'支付接口错误，请刷新页面重试'});}}else{__qqPay2(json);}}
function __qqPay2(json){var cgi={'qqCftPayAndroid':'mqqapi://tenpay/pay','qqCftPayIos':'mqqapiwallet://wallet/pay','qqPayIos462':'mqqapi://wallet/pay'},url='',iosCgi='',appInfo='',channel='other';if(g.mptype=='4'){channel='dongtai';}else if(g.mptype=='2'){channel='wallet';}else{channel='other';}
appInfo='&app_info=appid#2712384158|bargainor_id#1219098701|channel#'+channel+'&pubAcc=2778247926&pubAccHint='+encodeURIComponent('欢迎收听京东服务号');if(isAndroid()){url=cgi.qqCftPayAndroid+'?src_type=web&token_id='+json.tokenid+'&version=1&callback_name=onQQCftPay&callback_type=javascript'+appInfo;}else{if(compare('4.6.2')>=0){iosCgi=cgi.qqPayIos462;}else{iosCgi=cgi.qqCftPayIos;}
url=iosCgi+'?src_type=web&order_no='+json.tokenid+'&version=1&callback_name=onQQCftPay&callback_type=javascript'+appInfo;}
window.onQQCftPay=function(errId,errMsg){if(errId=='0'){if(json.callbackSuc){json.callbackSuc();}
window.setTimeout(function(){location.href=json.callbackUrl;},100);}else{if(json.callbackFail){json.callbackFail(errId,errMsg);}}};window.open(url,'_self');}
function __unionPay(json){if(json.replaceHistory){location.replace(json.data.jumpurl);}else{location.href=json.data.jumpurl;}};function __daiPay(opt){var _dPageUrl,_dUrl,_data={did:opt.dealId,callback:'cbGetDfid',};window.cbGetDfid=function(json){if(json&&json.errCode==0){if(isMQQUserAgent()){JD.sqapi.ready(function(){mqq.ui.shareMessage({title:'请帮我付款',desc:'体现你我真感情的时刻到了！我看中了京东好货，求付款!',share_type:0,share_url:cgi.daiDetail+'?dfid='+json.dfid,image_url:location.protocol+opt.img,back:false,puin:2712384158,sourceName:'京东购物'},function(result){var msg;if(result.retCode=='0'){}else{msg=result=='1'?'取消代付':'代付失败';msg+='，请到订单详情页完成支付~'
ui.alert({msg:msg,onConfirm:function(){_dUrl=cgi.dealDetail+'?deal_id='+opt.dealId;if(opt.replaceHistory){location.replace(_dUrl);}else{location.href=_dUrl;}}});}});});}else{_dPageUrl=cgi.daiDetail+'?dfid='+json.dfid;if(opt.replaceHistory){location.replace(_dPageUrl);}else{location.href=_dPageUrl;}}}else if(json.errCode==13){location.href=json.rurl+encodeURIComponent(location.href);}else{ui.alert({msg:json.msg,onConfirm:function(){_dUrl=cgi.dealDetail+'?deal_id='+opt.dealId;if(opt.replaceHistory){location.replace(_dUrl);}else{location.href=_dUrl;}}});}}
loadJs.loadScript({url:cgi.daiCgi,data:_data,});};exports.cashier=function(opt){var data={dealId:opt.dealId,ufc:opt.ufc||JD.cookie.get('USER_FLAG_CHECK')||'',callback:'jdappmpayCb',r:Math.random()}
if(opt.isM){data.sceneval='2';}
if(opt.backUrl){data.backUrl=encodeURIComponent(opt.backUrl);}
if(opt.pscene=='confirmapp'){data.backName=opt.backName;}
loadJs.loadScript({url:cgi.jdappmpay,data:data});window.jdappmpayCb=function(d){opt.wgCallback&&opt.wgCallback(d);if(d.errno=='0'){window.setTimeout(function(){if(opt.replaceHistory){location.replace(d.data.jumpurl);}else{location.href=d.data.jumpurl;}},200)}}};exports.wxH5Pay=function(opt){var wxmwebpay=cgi.wxmwebpay,mweb_url,data,wxH5Timer,isTimeout=false;data={dealId:opt.dealId,appid:opt.appid,callback:'goH5PayWxCb',r:Math.random()}
if(opt.approvalid){data.approvalid=opt.approvalid;wxmwebpay=opt.wgUrl;}
if(opt.isM){data.sceneval='2';}
window.goH5PayWxCb=function(json){opt.wgCallback&&opt.wgCallback(json);if(json.errno!='0'){return;}
mweb_url=decodeURIComponent(json.data.mweb_url);if(mweb_url.indexOf('?')>-1){mweb_url=mweb_url+'&redirect_url='+
encodeURIComponent(location.protocol+opt.backUrl);}else{mweb_url=mweb_url+'?redirect_url='+
encodeURIComponent(location.protocol+opt.backUrl);}
window.setTimeout(function(){if(opt.replaceHistory){location.replace(mweb_url);}else{location.href=mweb_url;}},100);};getFinger(function(result){if(isTimeout){return;}
isTimeout=false;clearTimeout(wxH5Timer);data.fingerprint=result;loadJs.loadScript({url:wxmwebpay,data:data});});wxH5Timer=window.setTimeout(function(){if(!isTimeout){return;}
isTimeout=true;loadJs.loadScript({url:wxmwebpay,data:data});},3000);};exports.wxPay=function(opt){var _data={dealId:opt.dealId,appid:opt.appid,callback:'cbGoPayWx',r:Math.random()}
if(opt.isM){_data.sceneval='2';}
if(opt.wxpap=='1'){_data.wxpap='1';}
window.cbGoPayWx=function(json){opt.wgCallback&&opt.wgCallback(json);if(json.errno=='0'){__wxPay({data:json.data,loadingId:opt.loadingId||'',replaceHistory:opt.replaceHistory,iswxapp:opt.iswxapp,callbackUrl:opt.backUrl,callbackCancel:function(t){opt.jsapiCallCancel&&opt.jsapiCallCancel(t);},callbackSuc:function(t){opt.jsapiCallSuc&&opt.jsapiCallSuc(t);},callbackFail:function(t){opt.jsapiCallFail&&opt.jsapiCallFail(t);},callbackNosup:function(t){opt.jsapiCallNosup&&opt.jsapiCallNosup(t);},callbackNoright:function(t){opt.jsapiCallNoright&&opt.jsapiCallNoright(t);},callbackElse:function(t){opt.jsapiCallElse&&opt.jsapiCallElse(t);},callbackNoready:function(){opt.callbackNoready&&opt.callbackNoready();}});}};loadJs.loadScript({url:cgi.wxPay,data:_data});};exports.saomaPay=function(opt){var _data={'appid':opt.appid,'dealId':opt.dealId,'callback':'qrPayCb'};if(opt.isM){_data.sceneval='2';}
window.qrPayCb=function(json){if(json.errno=='0'){qrcode.getQRCode(opt.imgid,{text:json.data.code_url,width:160,height:160});}
opt.wgCallback&&opt.wgCallback(json);}
loadJs.loadScript({url:cgi.wxqrPay,data:_data});};exports.qqPay=function(opt){var _data={dealId:opt.dealId,appid:opt.appid,callback:'sqpayCb',r:Math.random()}
if(opt.isM){_data.sceneval='2';}
window.sqpayCb=function(json){opt.wgCallback&&opt.wgCallback(json);if(json.errno=='0'){__qqPay({tokenid:json.tokenid,callbackUrl:opt.backUrl,replaceHistory:opt.replaceHistory,callbackFail:function(result){opt.jsapiCallFail&&opt.jsapiCallFail(result);},callbackSuc:function(result){opt.jsapiCallSuc&&opt.jsapiCallSuc(result);}});}};loadJs.loadScript({url:cgi.sqPay,data:_data});};exports.unionPay=function(opt){var _data={dealId:opt.dealId,appid:opt.appid,custom:encodeURIComponent(opt.backUrl),callback:'cbUnionPay',r:Math.random()}
if(opt.isM){_data.sceneval='2';}
window.cbUnionPay=function(json){opt.wgCallback&&opt.wgCallback(json);if(json.errno=='0'){if(opt.replaceHistory){json.replaceHistory=opt.replaceHistory;}
__unionPay(json);}};loadJs.loadScript({url:cgi.unionPay,data:_data});};exports.baitiaoPay=function(opt){var baitiaoUrl=cgi.baitiao+'?orderid='+opt.dealId+(opt.isM?'&sceneval=2':'')+'&rurl='+encodeURIComponent(opt.backUrl)+'&r='+Math.random();if(opt.replaceHistory){location.replace(baitiaoUrl);}else{location.href=baitiaoUrl;}};exports.baitiaoPayV2=function(opt){var _data={dealId:opt.dealId,planId:opt.fenqi,custom:encodeURIComponent(opt.backUrl),callback:'cbJdbtpay',r:Math.random()}
if(opt.isM){_data.sceneval='2';}
window.cbJdbtpay=function(json){opt.wgCallback&&opt.wgCallback(json);if(json.errno=='0'){if(opt.replaceHistory){location.replace(json.data.jumpurl);}else{location.href=json.data.jumpurl;}}};loadJs.loadScript({url:cgi.jdbtpay,data:_data});};exports.daiPay=function(opt){__daiPay(opt);}
exports.paymCashier=function(opt){location.href=cgi.payOnLine+'?orderId='+opt.dealId+'&factPrice='+
(opt.totalPrice/100).toFixed(2)+'&skuIdsList=['+opt.skulist+']&orderType=0';};exports.wxMianmiPay=function(opt){var _data={dealId:opt.dealId,appid:opt.appid,callback:'wxpappayCb',r:Math.random()}
if(opt.isM){_data.sceneval='2';}
window.wxpappayCb=function(json){window.setTimeout(function(){opt.wgCallback&&opt.wgCallback(json);},1000);};loadJs.loadScript({url:cgi.wxpappay,data:_data});};exports.getMianmi=function(opt){window.supportpappayCb=function(d){opt.callback&&opt.callback(d);}
loadJs.loadScript({url:cgi.supportpappay,data:{appid:opt.appid,itemType:opt.itemType,sceneval:opt.isM?'2':'',callback:'supportpappayCb',},});};exports.giveupMianmi=function(opt){window.giveuppappayCb=function(d){opt.callback&&opt.callback(d);}
loadJs.loadScript({url:cgi.giveuppappay,data:{appid:opt.appid,sceneval:opt.isM?'2':'',callback:'giveuppappayCb'},});};exports.loadBTInfo=function(opt){window.showbtentraceCB=function(d){opt.callback&&opt.callback(d);}
var _data={action:opt.action,callback:'showbtentraceCB',r:Math.random()};if(opt.isM){_data.sceneval='2';}
loadJs.loadScript({url:cgi.showbtentrace,data:_data});};});
define("tpl_wq.assetNew",function(require,exports,module){var _cacheThisModule_,ins={};exports.template=function(it){return com(it);}
function com(it){var out=' ';var i,l,_usable=parseInt((it.jdbean.usable||0)/1000)*1000;out+=' <div class="content"> <strong>京豆</strong> ';if(it.jdbean.total<1000){out+=' 共'+(it.jdbean.total)+'个，可用0个<br> 未满1000个，暂不可使用</em> ';}else if(it.jdbean.usable<1000){out+=' 共'+(it.jdbean.total)+'个，可用0个<br> 订单金额低于&yen;20,暂不可使用 ';}else{out+=' 共有'+(it.jdbean.total)+'个，最多可用'+(_usable)+'个，可抵&yen;'+((_usable/100).toFixed(0))+'<br>使用 <div class="buy_select selected" id="selectBean"> <div class="select">0</div> <i></i> </div>&nbsp;个, <em asset_tag="beanOffset">抵&yen;0.00</em> ';}
out+=' </div> <span class="tips_dou"></span>';return out;}
exports.child_beanSelTpl=function(it){var out=' <div class="mod_alert mod_alert_addressChoosing show fixed"> <h1 class="title">选择京豆数量<i></i></h1> <ul class="addressChoosing_list bigger ';if(it.jdbean.usable>=4000){out+='linear';}
out+='"> ';for(var i=0,l=it.jdbean.total;i<=l;i+=1000){out+=' ';if(i<=it.jdbean.usable){out+=' <li class="item ';if(it.jdbean.used==i){out+='selected';}
out+='" value="'+(i)+'">'+(i==0?"暂不使用":i)+'</li> ';}
out+=' ';}
out+=' </ul> </div> <div class="mod_alert mod_alert_info show fixed" id="dou_tip_mask" style="display:none;"> <h3 class="title"></h3> <div class="inner"></div> <p class="btns"><a href="javascript:void(0);" class="btn btn_1" id="ui_desc_sure">确定</a></p> </div>';return out;;}
exports.child_balance=function(it){var out=' ';var d=it;out+=' <div class="content"> <strong>余额</strong> <div class="avaliable ';if(it.isChecked!='1'){out+='disabled ';}
out+='"> <span> ';if(d.usedBalance>0){out+=' 当前余额 <span id="balance">&yen;'+((d.balance/100).toFixed(2))+'</span> ，使用<span class="money">&yen;'+((d.usedBalance/100).toFixed(2))+'</span> ';}else{out+=' 当前余额 <span class="money" id="balance"><em>&yen;'+((d.balance/100).toFixed(2))+'</em></span> ';}
out+=' </span> <span class="slider_button"></span> </div> </div>';return out;;}
exports.child_coupon=function(it){var out=' ';var d=it;out+=' <a href="javascript:void(0);" id="jdQuanTab" class="content"> <strong>京东券：</strong> <!--// 无可用--> ';if(d.couponList.length==0){out+=' <em class="disabled">无可用</em> ';}else if(d.couponList.length>0&&d.order.orderprice.couponDiscount=='0'){out+=' <!--// 有可用未使用--> <span class="coupon">有'+(d.couponList.length)+'张可用</span><em> 去使用</em> ';}else if(d.order.orderprice.couponDiscount>'0'){out+=' <!--// 有可用已经使用--> 已优惠<em>&yen;'+((d.order.orderprice.couponDiscount/100).toFixed(0))+'</em> ';}
out+=' </a>';return out;;}
exports.child_jdQuanPageV3Tpl=function(it){var out=' ';var cpLocker,cpdesc;if(window.dealLocker){cpLocker=dealLocker.filter(function(e){return e.mark=='y_coupon';});if(cpLocker&&cpLocker[0]&&cpLocker[0].lockvalue=='1'){cpdesc=cpLocker[0].ext.split('|')[1];}}
out+=' <div class="order_tab fixed"> <ul class="order_tab_list" id="couponTab"> <li class="order_tab_item cur" id="couponLi"><span class="order_tab_item_text">可用优惠券（'+(it.couponListCount)+'）</span></li> <li class="order_tab_item" id="cannotcouponLi"><span class="order_tab_item_text">不可用优惠券（'+(it.cannotUseCouponListCount)+'）</span></li> </ul> </div> <div class="order_coupons"> ';if(it.couponListCount>1&&!(it.ismiao||it.booking||it.hideMaxCoupon)){out+=' <div class="order_coupons_auto" id="selMaxCoupon"> 推荐优惠组合 <span class="order_coupons_auto_right color_red couponRule">使用规则</span> </div> ';}
out+=' <div class="order_coupons_auto type_disabled" style="display:none;"> <span class="order_coupons_auto_right color_red couponRule">使用规则</span> </div> <ul class="order_coupons_list type_radio" id="couponlistPage"> ';if(it.couponList&&it.couponList.length==0){out+=' <div class="mod_empty_page" id="noCard">                 <div class="mod_empty_page_icon"> <img src="//img11.360buyimg.com/jdphoto/s180x181_jfs/t6079/285/9594037354/6455/df21c583/59954236N3510a92a.png"> </div>                 <p class="mod_empty_page_main">您暂时还没有可用的优惠券</p>             </div> ';}
out+=' ';if(it.couponList){out+=' ';for(var i=0;i<it.couponList.length;i++){var item=it.couponList[i],couponBg,couponName;if(item.type=="0"){couponBg="type_jing";couponName="京券";if(item.limitType=='2'||item.limitType=='3'){couponName="店铺京券";}}else if(item.type=='1'){couponBg="";couponName="东券";if(item.limitType=='2'||item.limitType=='3'){couponName="店铺东券";}}else if(item.type=='2'){couponBg="type_yun";couponName="运费券";}
out+=' <li class="order_coupons_item ';if(item.selected=='1'){out+='selected';}
out+='" couponid="'+(item.id)+'" key="'+(item.key)+'" batchid="'+(item.batchId)+'" discount="'+(item.discount)+'" ctype="'+(item.type)+'" ';if(item.discountItem&&item.discountItem.length>0){out+=' dcoupon="1" ';}
out+=' limittype="'+(item.limitType)+'"> <div class="coupon_voucher2 '+(couponBg)+' ';if(item.readOnly=='1'){out+='type_disabled';}
out+='"> <span class="coupon_voucher2_tag color_red" style="display:none;"><i>标签名</i></span> <a href="javascript:;" class="coupon_voucher2_main"> <div class="coupon_voucher2_view"> ';if(item.discountItem&&item.discountItem.length==1){out+=' <p class="coupon_voucher2_view_price"><strong>'+(item.discountItem[0].discount*100/10)+'</strong> <small>折</small></p> <p class="coupon_voucher2_view_des"> '+((item.discountItem[0].quota/1)>0?'满'+item.discountItem[0].quota+'元可用':'无金额门槛')+' <p class="coupon_voucher2_view_tips">最高可减'+(item.highDiscount)+'元</p> ';}else if(item.discountItem&&item.discountItem.length>1){for(var j=0;j<item.discountItem.length;j++){var dItem=item.discountItem[j];out+=' <p class="coupon_voucher2_view_price"><span>满'+(dItem.quota)+'元/</span><strong>'+(dItem.discount*10)+'</strong><small>折</small></p> ';}
out+=' <p class="coupon_voucher2_view_tips">最高可减'+(item.highDiscount)+'元</p> ';}else{out+=' <p class="coupon_voucher2_view_price"><i>&yen;</i><strong>'+(item.discount%100>0?(item.discount/100).toFixed(2):(item.discount/100).toFixed(0))+'</strong></p> <p class="coupon_voucher2_view_des"> '+((item.quota/100)>0?'满'+(item.quota/100).toFixed(0)+'元可用':'无金额门槛')+' </p> ';}
out+=' </div> <div class="coupon_voucher2_info"> <p class="coupon_voucher2_info_text"><i class="coupon_voucher2_info_type">'+(couponName)+'</i> ';if(item.limitInfo.length>0){out+=''+(item.limitInfo)+'';}else{out+=' ';if(item.limitType=="0"&&item.type=="1"&&item.style=="3"){out+=' ';if(cpdesc){out+=' '+(cpdesc)+' ';}else{out+=' 折扣神券（限部分商品可用，特殊品类及特殊商品除外） ';}
out+=' ';}else if(item.type=="2"){out+=' 限京东自营商品（部分特殊商品运费除外） ';}else{out+=' 可购买京东全品类商品（特例商品除外） ';}
out+=' ';}
out+=' </p> ';if(item.dongOverlapDesc){out+=' <p class="coupon_voucher2_info_label"> <span>可叠加</span> <em>'+(item.dongOverlapDesc)+'</em> </p> ';}
out+=' <p class="coupon_voucher2_info_date"> '+(item.beginTime.substring(0,item.beginTime.indexOf(" ")))+' - '+(item.endTime.substring(0,item.endTime.indexOf(" ")))+' </p> </div> </a> <div class="coupon_voucher2_foot" ';if(!(item.readOnly=="1"||(item.selected=="1"&&item.discountItem&&item.discountItem.length>0))){out+=' style="display:none;" ';}
out+='> <div class="coupon_voucher2_hr"></div> <a href="javascript:void(0);" class="coupon_voucher2_description"> <p class="coupon_voucher2_description_title"> ';if(item.selected=="1"&&item.discountItem&&item.discountItem.length>0){out+=' 使用该券本单可减<strong>'+((item.discount/100).toFixed(2))+'元</strong> ';}else{out+=' '+(item.limitDesc||"不可与已勾选券叠加使用")+' ';}
out+=' </p> </a> </div> </div> </li> ';}
out+=' ';}
out+=' </ul> <div id="unUseCouponPage" style="display:none;"> ';if(it.cannotUseCouponList&&it.cannotUseCouponList.length==0){out+=' <div class="mod_empty_page" id="noCard">                 <div class="mod_empty_page_icon"> <img src="//img11.360buyimg.com/jdphoto/s180x181_jfs/t6079/285/9594037354/6455/df21c583/59954236N3510a92a.png"> </div>                 <p class="mod_empty_page_main">您暂时还没有不可用的优惠券</p>             </div> ';}
out+=' ';if(it.cannotUseCouponList){out+=' ';for(var i=0;i<it.cannotUseCouponList.length;i++){var item=it.cannotUseCouponList[i],couponBg,couponName;if(item.type=="0"){couponBg="type_jing";couponName="京券";if(item.limitType=='2'||item.limitType=='3'){couponName="店铺京券";}}else if(item.type=='1'){couponBg="";couponName="东券";if(item.limitType=='2'||item.limitType=='3'){couponName="店铺东券";}}else if(item.type=='2'){couponBg="type_yun";couponName="运费券";}
out+=' <div class="coupon_voucher2 '+(couponBg)+' ';if(!item.differAmount||item.differAmount<=0){out+=' type_disabled';}
out+='" qt="1" couponid="'+(item.id)+'" key="'+(item.key)+'" batchid="'+(item.batchId)+'" discount="'+(item.discount)+'" ctype="'+(item.type)+'"> <span class="coupon_voucher2_tag color_red" style="display:none;"><i>标签名</i></span> <a href="javascript:;" class="coupon_voucher2_main"> <div class="coupon_voucher2_view"> ';if(item.discountItem&&item.discountItem.length==1){out+=' <p class="coupon_voucher2_view_price"><strong>'+(item.discountItem[0].discount*100/10)+'</strong> <small>折</small></p> <p class="coupon_voucher2_view_des">满'+(item.discountItem[0].quota)+'元可用</p> <p class="coupon_voucher2_view_tips">最高可减'+(item.highDiscount)+'元</p> ';}else if(item.discountItem&&item.discountItem.length>1){for(var j=0;j<item.discountItem.length;j++){var dItem=item.discountItem[j];out+=' <p class="coupon_voucher2_view_price"><span>满'+(dItem.quota)+'元/</span><strong>'+(dItem.discount*10)+'</strong><small>折</small></p> ';}
out+=' <p class="coupon_voucher2_view_tips">最高可减'+(item.highDiscount)+'元</p> ';}else{out+=' <p class="coupon_voucher2_view_price"><i>&yen;</i><strong>'+(item.discount%100>0?(item.discount/100).toFixed(2):(item.discount/100).toFixed(0))+'</strong></p> <p class="coupon_voucher2_view_des">满'+((item.quota/100).toFixed(0))+'元可用</p> ';}
out+=' </div> <div class="coupon_voucher2_info"> <p class="coupon_voucher2_info_text"><i class="coupon_voucher2_info_type">'+(couponName)+'</i> ';if(item.limitInfo.length>0){out+=''+(item.limitInfo)+'';}else{out+=' ';if(item.limitType=="0"&&item.type=="1"&&item.style=="3"){out+=' ';if(cpdesc){out+=' '+(cpdesc)+' ';}else{out+=' 折扣神券（限部分商品可用，特殊品类及特殊商品除外） ';}
out+=' ';}else if(item.type=="2"){out+=' 限京东自营商品（部分特殊商品运费除外） ';}else{out+=' 可购买京东全品类商品（特例商品除外） ';}
out+=' ';}
out+=' </p> ';if(item.dongOverlapDesc){out+=' <p class="coupon_voucher2_info_label"> <span>可叠加</span> <em>'+(item.dongOverlapDesc)+'</em> </p> ';}
out+=' <p class="coupon_voucher2_info_date"> '+(item.beginTime.substring(0,item.beginTime.indexOf(" ")))+' - '+(item.endTime.substring(0,item.endTime.indexOf(" ")))+' </p> </div> </a> <div class="coupon_voucher2_foot"> <div class="coupon_voucher2_hr"></div> ';if(item.differAmount>0){out+=' <a href="javascript:void(0);" class="coupon_voucher2_description"> <p class="coupon_voucher2_description_title">还差<strong>&yen;'+((item.differAmount/100).toFixed(2))+'</strong>可使用</p> ';if(!window.isPingou&&!window.mConfirm){out+=' <span class="coupon_voucher2_description_link" myhref="'+(item.differAmountLink?item.differAmountLink:'javascript:void(0);')+'">去凑单</span> ';}
out+=' </a> ';}else{out+=' <a href="javascript:void(0);" class="coupon_voucher2_description"> <p class="coupon_voucher2_description_title">'+((window.branch_otc?(item.limitDesc||''):((item.limitDesc||'').replace(/.*差\d+.+/,'')))||"所结算商品中没有符合条件的商品")+'</p> </a> ';}
out+=' </div> </div> ';}
out+=' ';}
out+=' </div> <div class="order_coupons_fixbar"> <div class="order_coupons_fixbar_inner"> <div class="order_coupons_fixbar_content"> <p class="order_coupons_fixbar_content_text">已选<span id="selcouponNum">'+(it.selectedCoupon.length||0)+'</span>张，共抵扣<em id="couponDiscount">'+((it.couponDiscount/100).toFixed(2)||0)+'</em>元</p> </div> <div class="order_coupons_fixbar_btn bg_2" id="goBackBuyPage">确定</div> </div> </div> </div>';return out;;}
exports.child_payPass=function(it){var out=' <div class="mod_alert" id="payPassModel" style="display: none;"> <span id="cancel" class="close"></span> <i class="icon"></i> <p><small>为了保障您的资产安全，您需要开通<br>京东支付密码，才能使用京东券、<br>礼品卡、京豆等虚拟资产！</small></p> <p class="btns"> <a href="javascript:void(0);" id="confirm" class="btn btn_1">开启</a> </p> </div>';return out;;}
exports.child_tplCardV2=function(it){var out=' <div class="buy_ecards_tabs_wrap"> <div class="buy_ecards_tabs"> <div class="buy_ecards_tabs_item selected" id="cardNav"><span class="buy_ecards_tabs_text">可用('+(it.cardNumObj?it.cardNumObj.useNum:it.cardList.length)+')</span></div> <div class="buy_ecards_tabs_item" id="unuseCardNav"><span class="buy_ecards_tabs_text">不可用('+(it.cardNumObj?it.cardNumObj.unuseNum:it.cannotCardList.length)+')</span></div> </div> </div> <div class="buy_ecards_operating" id="cardHelp"> <div class="buy_ecards_operating_help">使用帮助</div> <a href="javascript:void(0);" class="buy_ecards_operating_banding bindNewCard">绑卡</a> </div> <ul class="buy_ecards_list" id="cardListUl"> ';if(it.cardList){out+=' '+(exports.child_tplCardli({cardList:it.cardList,cannotUseCard:false}))+' ';}
out+=' </ul> <ul class="buy_ecards_list" id="cannotCardUl" style="display:none;"> ';if(it.cannotCardList){out+=' '+(exports.child_tplCardli({cardList:it.cannotCardList,cannotUseCard:true}))+' ';}
out+=' </ul> <div class="no_more_card" id="noMoreCard" ';if(it.cardList&&it.cardList.length==0){out+='style="display:none;"';}
out+='>--已经到底了--</div> <div class="mod_empty_page" id="noCard" ';if(it.cardList&&it.cardList.length>0){out+='style="display:none;"';}
out+='> <div class="mod_empty_page_icon"><img src="//img11.360buyimg.com/jdphoto/s180x181_jfs/t6079/285/9594037354/6455/df21c583/59954236N3510a92a.png"></div> <p class="mod_empty_page_main">您暂时还没有可用的礼品卡</p> </div> <br><br><br> ';if(it.cardNumObj?it.cardNumObj.useNum>0:it.cardList.length>0){out+=' <div class="buy_fixed_confirm"> <div class="buy_fixed_confirm_price_wrap"> <p class="buy_fixed_confirm_price">已选<span id="useCardNum">0</span>张</p> <p class="buy_fixed_confirm_off">已优惠<em class="color_red">&yen;<span id="giftDiscount"></span></em></p> </div> <div class="buy_fixed_confirm_btn" id="jdcartpageBack">确认</div> </div> ';}
out+='';return out;;}
exports.child_tplCardli=function(it){var out=' ';for(var i=0;i<it.cardList.length;i++){var item=it.cardList[i],cardStyle,cardName,cardSrc;cardSrc='//img11.360buyimg.com/jdphoto/s70x70_jfs/t7123/343/2346928077/2225/ec4b9407/59951edfNb77c55f3.png';if(it.cannotUseCard){cardSrc='//img11.360buyimg.com/jdphoto/s70x70_jfs/t7495/291/601092678/2130/38dcee42/59951edaN19d79afb.png';}if(item.type=='2'){cardStyle='type_pink';cardName='京东卡';}else if(item.type=='3'&&['2','3'].indexOf(item.style)>-1){cardStyle='type_pink';cardName='领货码';}else if(item.type=='3'&&(item.cardBrand&&item.cardBrand>0)){cardStyle='type_cyan';cardName='京品卡';cardSrc='//img11.360buyimg.com/jdphoto/s70x70_jfs/t6022/55/9439655794/1969/62be29f7/59951edfN307f4914.png';if(it.cannotUseCard){cardSrc='//img11.360buyimg.com/jdphoto/s70x70_jfs/t7321/261/581383928/1803/cf5cc7e8/59951edfN4b816654.png';}}else{cardStyle='type_pink';cardName='京东E卡';}if(it.cannotUseCard){cardStyle='type_disabled';}cardSrc=JD.img.getImgUrl(cardSrc);out+=' <li class="buy_ecards_card '+(cardStyle)+' ';if(item.selected=='1'){out+=' selected ';}
out+='" type="'+(item.type)+'" couponid="'+(item.id)+'" key="'+(item.key)+'"> <div class="buy_ecards_card_head"> <div class="buy_ecards_card_head_avatar"><img src="'+(cardSrc)+'" onerror="__reloadResource(this)"></div> <div class="buy_ecards_card_head_main"> <h3 class="buy_ecards_card_head_title">'+(cardName)+'</h3> <div class="buy_ecards_card_head_messages"> 面值：<span class="buy_ecards_card_head_price">&yen;'+((item.amount/100).toFixed(2))+'</span> <div class="buy_ecards_card_head_deadline">'+(item.endTime.substr(0,10))+'到期</div> </div> </div> </div> <div class="buy_ecards_card_body"> <div class="buy_ecards_card_body_left"> 余额：<span class="buy_ecards_card_body_money">&yen;<em>'+(((item.amount-item.used)/100).toFixed(2))+'</em></span> </div> ';if(item.ableDesc){out+=' <div class="buy_ecards_card_body_text">'+(item.ableDesc)+'</div> ';}
out+=' </div> ';if(item.disableDesc){out+=' <div class="buy_ecards_card_foot">'+(item.disableDesc)+'</div> ';}
out+=' </li> ';}
out+='';return out;;}
exports.child_tplPageInvoices=function(it){var out=' <a href="javascript:void(0);" class="mod_blockTips pure_text" id="fapiaoTip" style="display:none"> <p>视频会员商品无法开具发票，故发票金额不包括该类商品金额</p> </a> <dl class="on"> <dt><strong>发票类型</strong><em id="fp_type_bar">普通发票</em></dt> <dd> <ul> <li class="type_addtips" style="display:none" id="fp_selectNone"> 不开发票 </li> <li class="type_addtips" style="display:none" id="fp_selectGeneral"> 普通发票 <div class="tips">京东部分试点地区仅提供电子普通发票，具体以实际出具为准。</div> </li> <li class="type_addtips" style="display:none" id="fp_selectInline"> 电子普通发票<span id="elecIos9Tip" style="display:none;">（iOS9可前往电脑端查看电子发票）</span> <div class="tips">';if(it.electronicTips){out+=''+(it.electronicTips)+'';}else{out+='电子普通发票与纸质普通发票具备同等法律效力，可支持报销入账。';}
out+='</div> </li> <li class="type_addtips" style="display:none" id="fp_selectVat"> 增值税专用发票 <div class="tips">我司依法开具发票，请您按照税法规定使用发票。</div> </li> </ul> </dd> </dl> ';if(it.normalInvoiceVO){out+=' <div id="fp_general"  style="display: none;"> <dl class="on"> <dt><strong>发票抬头</strong><em id="fpTypeBar"></em></dt> <dd> <ul id="fpType"> <li fp_type="4">个人<input style="display: none;" id="personName" maxlength="50" class="input_text" type="text" placeholder=""></li> <li fp_type="5">公司<input id="compName" maxlength="50" class="input_text" type="text" placeholder="公司全称"> ';if(it.usualInvoiceList&&it.usualInvoiceList.length>0){out+=' <div class="invoice_dropdown" id="companyList" style="display:none;"> ';for(var i=0;i<it.usualInvoiceList.length;i++){var _item=it.usualInvoiceList[i];if(_item.usualInvoiceName=="个人"){continue;}
out+=' <span id="'+(_item.id)+'" value="'+(_item.usualInvoiceName)+'" invoiceCode="'+(_item.invoiceCode)+'">'+(_item.usualInvoiceName)+'</span> ';}
out+=' </div> ';}
out+=' </li> <li class="type_noselected" id="taxLi">纳税人识别号<input class="input_text" type="text" id="taxerId" placeholder="请填写纳税人识别号"></li> </ul> </dd> </dl> ';if(it.normalInvoiceVO&&it.normalInvoiceVO.normalInvoiceContentVO&&it.normalInvoiceVO.normalInvoiceContentVO.supportContent&&it.normalInvoiceVO.normalInvoiceContentVO.supportContent.length>0){var fpContent=it.normalInvoiceVO.normalInvoiceContentVO.supportContent,fpMap=it.normalInvoiceVO.normalInvoiceContentVO.supContent,typeArr=[],errType=false,typeTip='发票内容将显示本单商品所属类别及价格信息',cList=it.normalInvoiceVO.invContentList;if(cList&&fpContent.indexOf(100)>-1&&cList.length>0){for(var i=0;i<cList.length;i++){typeArr.push(cList[i].ivcContentName);if(cList[i].ivcContentId=='9999'||!cList[i].ivcContentId){errType=true;}}}
out+=' <dl class="on" id="fpContent"> <dt><strong>发票内容</strong><em></em></dt> <dd> <div class="order_additional_tips type_invoice" style="display:none;"> <p class="order_additional_tips_text"> 根据国家相关规定，发票的开票内容需与购买的商品一致，暂不支持手动选择开票内容。 </p> <i class="order_additional_tips_close"></i> </div> </dd> <dd> <ul> ';for(var i=0;i<fpContent.length;i++){out+=' <li class="type_addtips" content_id="'+(fpContent[i])+'" content_name="'+(fpMap[fpContent[i]])+'"> '+(fpMap[fpContent[i]])+' ';if(fpContent[i]=='1'){out+=' <div class="tips">发票内容显示详细商品名称及价格信息。</div> ';}else if(fpContent[i]=='100'){if(typeArr.length>0&&!errType){typeTip='本单可开发票内容：'+typeArr.join('/')+'。<i class="rule_icon"></i>'}
out+=' <div class="tips">'+(typeTip)+'</div> ';}
out+=' </li> ';}
out+=' </ul> </dd> </dl> ';}
out+=' <dl><p class="delivery_tips" id="comTip" style="display:none;"> 1. 发票金额不包含礼品卡、优惠券与京豆支付部分；<br> 2. 第三方卖家销售的商品发票有商家开具、寄出，发票内容由商家决定；<br> 3. 抢购商品图书不支持开具发票。 </p></dl> </div> ';}
out+=' <div id="fp_vat" style="display: none;"> ';if(it.vat&&it.vat.companyName){out+=' <dl class="on"> <dt><strong>发票抬头</strong><em>单位</em></dt> <dd> <ul id="vatFpType"> <li fp_vat_type="5" class="selected">单位</li> </ul> </dd> </dl> <dl class="on"> <dt><strong>明细</strong></dt> <dd class="invoice_company"> <p><em>单位名称：</em>'+(it.vat.companyName)+'</p> <p><em>纳税人识别号：</em>'+(it.vat.code)+'</p> <p><em>注册地址：</em>'+(it.vat.regAddr)+'</p> <p><em>注册电话：</em>'+(it.vat.regPhone)+'</p> <p><em>开户银行：</em>'+(it.vat.regBank)+'</p> <p><em>银行账户：</em>'+(it.vat.regBankAccount)+'</p> </dd> </dl> ';var vatNorConSup=it.vat.normalInvoiceContentVO.supportContent,vatNorMap=it.vat.normalInvoiceContentVO.supContent;out+=' <dl class="on" id="vatfpContent"> <dt><strong>发票内容</strong><em></em></dt> <dd> <ul> ';for(var i=0;i<vatNorConSup.length;i++){out+=' <li content_id="'+(vatNorConSup[i])+'">'+(vatNorMap[vatNorConSup[i]])+'</li> ';}
out+=' </ul> </dd> </dl> <dl class="on"> <dt><strong>收票信息</strong></dt> <dd class="address_new"> <p><label for=""><span class="tit">收件人</span><input id="vatName" type="text" placeholder="姓名" value="'+((it.consignee.name||''))+'"></label></p> <p><label for=""><span class="tit">联系方式</span><input id="vatMobile" type="tel" placeholder="手机或电话号码" value="'+((it.consignee.phone||''))+'"></label></p> <p class="street_detail selAddr" id="selAddr"> <label for=""><span class="tit">省市区县</span> <input type="text" placeholder="选择省市区县" readonly="readonly"></label> <i class="arrow"></i> </p> <p><label for=""><span class="tit">详细地址</span><input type="text" id="vatAdinfo" placeholder="街道地址" value="'+((it.consignee.address||''))+'"></label></p> <p class="delivery_tips"> 温馨提示：<br/> 1、增值税发票将根据您填写的收票信息单独寄送，不随商品包裹寄出；<br/> ';if(window.mConfirm){out+=' 2、如果您需要修改增票资质信息，请登录京东JD.com电脑版“我的京东->账户中心->账户信息->增票资质”内修改。 ';}else{out+=' 2、如果您需要修改增票资质信息，请到“个人中心->账号管理->增值资质”中修改。 ';}
out+=' </p> </dd> </dl> ';}else{out+=' <dl><p class="delivery_tips">增值税发票的开据需开通增票资质。 ';if(window.mConfirm){out+=' 请在京东JD.com电脑版“我的京东-账户中心-账户信息-增票资质”内提交资料开通资质后，方可在移动端开据增值税发票。 ';}else{out+=' 请到“个人中心->账号管理->增值资质”中开通。 ';}
out+=' </p></dl> ';}
out+=' </div> ';if(it.electronic){out+=' <div id="fp_inline"  style="display: none;"> <dl class="on"> <dt><strong>发票抬头</strong><em id="elecFpTypeBar">个人</em></dt> <dd> <ul id="elecFpType"> <li elecfp_type="4">个人<input style="display: none;" id="elecPersonName" maxlength="50" class="input_text" type="text" placeholder=""></li> <li elecfp_type="5"> 公司<input id="elecCompName" maxlength="50" class="input_text" type="text" placeholder="公司全称"> ';if(it.usualInvoiceList&&it.usualInvoiceList.length>0){out+=' <div class="invoice_dropdown" id="elecCompanyList" style="display:none;"> ';for(var i=0;i<it.usualInvoiceList.length;i++){var _item=it.usualInvoiceList[i];if(_item.usualInvoiceName=="个人"){continue;}
out+=' <span id="'+(_item.id)+'" value="'+(_item.usualInvoiceName)+'" invoiceCode="'+(_item.invoiceCode)+'">'+(_item.usualInvoiceName)+'</span> ';}
out+=' </div> ';}
out+=' </li> <li class="type_noselected" id="elecTaxLi">纳税人识别号<input class="input_text" type="text" id="elecTaxId" placeholder="请填写纳税人识别号"></li> </ul> </dd> </dl> ';if(it.electronic&&it.electronic.invoiceExtVO){out+='  <dl class="on"> <dt><strong>收票人信息</strong></dt> <dd> <form class="buy_form"> <div class="buy_form_row"> <label><em>*</em>收票人手机</label> <input type="tel" id="lineVoiceMobile" value="'+(((it.electronic&&it.electronic.invoiceExtVO.invoiceConsigneePhone)||''))+'"> </div> <div class="buy_form_row"> <label>收票人邮箱</label> <input type="mail" id="lineVoiceEmial" placeholder="用来接收电子发票邮件，可选填" value="'+(((it.electronic&&it.electronic.invoiceExtVO.invoiceConsigneeEmail)||''))+'"> </div> </form> </dd> </dl> ';}
out+=' ';if(it.electronic.normalInvoiceContentVO){var eleNorConSup=it.electronic.normalInvoiceContentVO.supportContent,eleNorMap=it.electronic.normalInvoiceContentVO.supContent,eleTypeArr=[],errType=false,eleTypeTip='发票内容将显示本单商品所属类别及价格信息',eleCList=it.electronic.invContentList;if(eleCList&&eleNorConSup.indexOf(100)>-1&&eleCList.length>0){for(var i=0;i<eleCList.length;i++){eleTypeArr.push(eleCList[i].ivcContentName);if(eleCList[i].ivcContentId=='9999'||!eleCList[i].ivcContentId){errType=true;}}}
out+=' <dl class="on" id="line_fpContent"> <dt><strong>发票内容</strong><em></em></dt> <dd> <div class="order_additional_tips type_invoice" style="display:none;"> <p class="order_additional_tips_text"> 根据国家相关规定，发票的开票内容需与购买的商品一致，暂不支持手动选择开票内容。 </p> <i class="order_additional_tips_close"></i> </div> </dd> <dd> <ul> ';for(var i=0;i<eleNorConSup.length;i++){out+=' <li class="type_addtips" content_id="'+(eleNorConSup[i])+'" content_name="'+(eleNorMap[eleNorConSup[i]])+'"> '+(eleNorMap[eleNorConSup[i]])+' ';if(eleNorConSup[i]=='1'){out+=' <div class="tips">发票内容显示详细商品名称及价格信息。</div> ';}else if(eleNorConSup[i]=='100'){if(eleTypeArr.length>0&&!errType){eleTypeTip='本单可开发票内容：'+eleTypeArr.join('/')+'。<i class="rule_icon"></i>'}
out+=' <div class="tips">'+(eleTypeTip)+'</div> ';}
out+=' </li> ';}
out+=' </ul> </dd> </dl> ';}
out+=' </div> ';}
out+=' <div class="invoice_popup fixed" id="fpContentTip" style="display:none;"></div> <p class="delivery_tips" id="nosupTip" style="display:none;"> 注：部分商品暂不支持开票，请联系商家开票 </p> <br/> <br/> <br/> <br/> <br/>';return out;;}
exports.child_tplFpContentTip=function(it){var out=' <div class="invoice_popup_inner"> <div class="invoice_popup_tit">可开发票内容</div> <div class="invoice_popup_list"> ';for(var i=0;i<it.length;i++){out+=' <div class="invoice_popup_subtit">'+(it[i].ivcContentName)+'</div> <div class="invoice_popup_goods"> ';for(var j=0;j<it[i].skuList.length;j++){out+=' <div class="invoice_popup_cover"> <img src="//img10.360buyimg.com/n4/'+(it[i].skuList[j].imgUrl)+'" alt=""> </div> ';}
out+=' </div> ';}
out+=' </div> <div class="invoice_popup_btn">知道了</div> </div>';return out;;}
exports.child_redPacket=function(it){var out=' ';if(it.total&&it.total>0){out+=' <div class="content"> <strong>红包</strong> 共有&yen;'+((it.total/100).toFixed(2))+'，可用&yen;'+((it.canUse/100).toFixed(2))+'<br> ';if(it.canUse>0){out+=' <div class="buy_select selected"> <div class="buy_select selected"> <select> <option value="1" ';if(it.selVal=='1'){out+=' selected ';}
out+='>使用</option> <option value="0" ';if(it.selVal=='0'){out+=' selected ';}
out+='>不使用</option> </select><i></i> </div> </div> <em>抵&yen;'+((it.discount/100).toFixed(2))+'</em> ';}
out+=' </div> <span class="tips_dou"></span> ';}
out+='';return out;;}});
define('qqAddr',function(require,exports,module){var _cacheThisModule_;var mqaddr={version:'4.7.0',status:0,call:function(opt){var url='https://i.qianbao.qq.com/profile/address/choose.html';this.status=1;mqaddr.url.open(url,{_wv:1,aid:opt.aid||0,idx:opt.idx||2,appid:opt.appid||100273020});},url:{unserialParams:function(paramstr){paramstr=paramstr||location.search.substring(1);var params=paramstr.split("&"),paramMap={},param;$.each(params,function(index,param){param=param.split(/=/);paramMap[param[0]]=(param[1]||"");});return paramMap},get:function(name,url){if(!url&&!this.paramsMap){this.paramsMap=this.unserialParams()}else{if(url){var index=url.indexOf("?");return this.unserialParams(index!==-1?url.substr(index+1):url)[name]}}
return name?this.paramsMap[name]:this.paramsMap},appendParams:function(params,url){if(!params){return url}
url=url||location.href;params=$.param(params);if(url.indexOf("?")!=-1){if(url.lastIndexOf("&")!=url.length-1){url+="&"}
url+=params}else{url+="?"+params}
return url;},open:function(url,params,hash){var self=this;if(!!params){url=self.appendParams(params,url);}
if(!!hash){url+='#'+hash;}
mqq.ui.openUrl({url:url,target:1,style:1});}},data:{listen:function(callback){if(mqq.QQVersion<'5.0'){var self=this;document.addEventListener("qbrowserVisibilityChange",function(e){if(!e.hidden){var data={type:1,choose:self.status&&mqaddr.storage.getCookie('mqaddr')};self.status=0;callback&&callback(data);}});}else{mqq.addEventListener("mqqAddrSync",function(data,source){data.type=2;callback&&callback(data,source);});}},getDistrict:function(code){var p=code-code%10000,c=code-code%100,t=code;var muni=Math.floor(p/10000);if(muni==11||muni==12||muni==31||muni==50){c=t;t=-1;}
if(!p||p=='-1'||!c||c=='-1'){return'';}
var _rd=bbc_district_data;if(_rd[p]){if(typeof(_rd[p][1])=="object"){if(!t||t=='-1'){if(typeof(_rd[p][1][c])=="object"){return _rd[p][0]+_rd[p][1][c][0];}
return _rd[p][0]+_rd[p][1][c];}
if(typeof(_rd[p][1][c])!="object"){return _rd[p][0]+(_rd[p][1][c]||'');}
if(typeof(_rd[p][1][c][1][t])=="object"){return _rd[p][0]+_rd[p][1][c][0]+_rd[p][1][c][1][t][0];}else{return _rd[p][0]+_rd[p][1][c][0]+(_rd[p][1][c][1][t]||'');}}
return _rd[p][0];}
return'';},getDistrictArr:function(rgid){var _rd=bbc_district_data,r=[],i,j,k;if(!_rd){return;}
for(i in _rd){if(i==rgid){r.push(_rd[i][0]);return r;}
for(j in _rd[i][1]){if(j==rgid){r.push(_rd[i][0]);if(typeof _rd[i][1][j]=='string'){r.push(_rd[i][1][j]);}else{r.push(_rd[i][1][j][0]);}
return r;}
for(k in _rd[i][1][j][1]){if(k==rgid){r.push(_rd[i][0]);r.push(_rd[i][1][j][0]);r.push(_rd[i][1][j][1][k]);return r;}}}}}},storage:{getCookie:function(name){if(document.cookie&&document.cookie!=''){var cookieArr=document.cookie.split('; ');for(var i=0,cl=cookieArr.length,name=encodeURIComponent(name),tmpArr;i<cl;i++){tmpArr=cookieArr[i].split('=');if(name==tmpArr[0]){return decodeURIComponent(tmpArr[1]||'');}}}
return'';}},net:{loadAddrData:function(callback){if(!window['bbc.districtdata.js']){mqaddr.net.loadScript('//i.gtimg.cn/channel/profile/address/js/bbc.districtdata.js?v=1.0.4',function(){callback();},"utf-8");}else{callback();}},loadScript:function(url,callback,charset){if(typeof callback=="string"){charset=callback;callback=function(){};}
var sc=document.createElement("script"),head=document.getElementsByTagName("head")[0];sc.setAttribute("charset",charset||"utf-8");sc.src=url;sc.onload=function(){callback&&callback();head.removeChild(sc);};head.appendChild(sc);}}};exports.init=function(){return mqaddr;}});
define("date",function(require,exports,module){var _cacheThisModule_;exports.format=function(date,formatStr){var arrWeek=['日','一','二','三','四','五','六'],str=formatStr.replace(/yyyy|YYYY/,date.getFullYear()).replace(/yy|YY/,$addZero(date.getFullYear()%100,2)).replace(/mm|MM/,$addZero(date.getMonth()+1,2)).replace(/m|M/g,date.getMonth()+1).replace(/dd|DD/,$addZero(date.getDate(),2)).replace(/d|D/g,date.getDate()).replace(/hh|HH/,$addZero(date.getHours(),2)).replace(/h|H/g,date.getHours()).replace(/ii|II/,$addZero(date.getMinutes(),2)).replace(/i|I/g,date.getMinutes()).replace(/ss|SS/,$addZero(date.getSeconds(),2)).replace(/s|S/g,date.getSeconds()).replace(/w/g,date.getDay()).replace(/W/g,arrWeek[date.getDay()]);return str;}
exports.getTimeDistance=function(ts){var timeLeft=[0,0,0,0];timeLeft[0]=(ts>86400)?parseInt(ts/86400):0;ts=ts-timeLeft[0]*86400;timeLeft[1]=(ts>3600)?parseInt(ts/3600):0;ts=ts-timeLeft[1]*3600;timeLeft[2]=(ts>60)?parseInt(ts/60):0;timeLeft[3]=ts-timeLeft[2]*60;return timeLeft;}
exports.getTimeInterval=function(st,et){var dateLeft=0;var hourLeft=0;var minuteLeft=0;var secondLeft=0;var timeLeft=[0,0,0,0];var timeStr="";var ts=(et>st)?parseInt((et-st)/1000):0;timeLeft[0]=(ts>86400)?parseInt(ts/86400):0;ts=ts-timeLeft[0]*86400;timeLeft[1]=(ts>3600)?parseInt(ts/3600):0;ts=ts-timeLeft[1]*3600;timeLeft[2]=(ts>60)?parseInt(ts/60):0;timeLeft[3]=ts-timeLeft[2]*60;timeStr=(timeLeft[0]>0)?timeLeft[0]+"天":"";timeStr+=(timeLeft[0]<=0&&timeLeft[1]<=0)?"":(timeLeft[1]+"小时");timeStr+=(timeLeft[0]<=0&&timeLeft[1]<=0&&timeLeft[2]<=0)?"":(timeLeft[2]+"分钟");timeStr+=(timeLeft[0]<=0&&timeLeft[1]<=0&&timeLeft[2]<=0&&timeLeft[3]<=0)?"":timeLeft[3]+"秒";return timeStr;}
function $addZero(v,size){for(var i=0,len=size-(v+"").length;i<len;i++){v="0"+v;};return v+"";}
exports.getServerTime=function(url){var sysTime=document.getElementById('SYSTIME');if(sysTime){var ts=sysTime.value.substring(0,19).split('-'),dObj=new Date(ts[0],parseInt(ts[1],10)-1,ts[2],ts[3],ts[4],ts[5]);return dObj;}
var xhr=$xhrMaker(),url=url||"http://"+window.location.hostname+"/favicon.ico";try{xhr.open("HEAD",url,false);xhr.send();}catch(e){return new Date();}
return new Date(xhr.getResponseHeader("Date"));}
function $xhrMaker(){var xhr;try{xhr=new XMLHttpRequest();}catch(e){try{xhr=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{xhr=new ActiveXObject("Microsoft.XMLHTTP");}catch(e){xhr=null;}}};return xhr;}});
define("tpl_wq.ship",function(require,exports,module){var _cacheThisModule_,ins={};exports.template=function(it){return com(it);}
function com(it){var out='';return out;}
exports.child_selectShipV2Tpl=function(it){var out=' ';var weekMap=['今天','周一','周二','周三','周四','周五','周六','周日'],i,l,j,item,list,la,ship411,_pruoduts,supLaArr=[],supLaInArr=[],supSmArr=[],supSmInArr=[],supjzdjsd='',jdSeled,now=new Date(),supSmLa,smSupInSkus,products=it.products?it.products:it.vender.products,jdShipName;if(!it.vender.containZY&&it.vender.containFactory){jdShipName='厂商配送';}else{jdShipName='京东快递';}for(i=0,l=products.length;i<l;i++){_pruoduts=products[i];supSmLa=false;if(_pruoduts.mainSku.isLA=='1'){supLaArr.push(_pruoduts);if(_pruoduts.mainSku.supInstall=='1'){supLaInArr.push(_pruoduts);}}else{supSmArr.push(_pruoduts);if(it.vender.smInstall&&(it.vender.smIn311Obj||it.vender.smInjzdObj)){smSupInSkus=it.vender.smIn311Obj?it.vender.smIn311Obj.supportInstallSkus:it.vender.smInjzdObj.supportInstallSkus;if(smSupInSkus&&smSupInSkus.indexOf(_pruoduts.mainSku.id)>-1){supSmInArr.push(_pruoduts);supSmLa=true;}if(!supSmLa&&_pruoduts.gifts){for(j=0;j<_pruoduts.gifts.skus.length;j++){if(smSupInSkus&&smSupInSkus.indexOf(_pruoduts.gifts.skus[j].id)>-1){supSmInArr.push(_pruoduts);break;}}}if(!supSmLa&&_pruoduts.homeServices){for(j=0;j<_pruoduts.homeServices.length;j++){if(smSupInSkus&&smSupInSkus.indexOf(_pruoduts.homeServices[j].id)>-1){supSmInArr.push(_pruoduts);break;}}}}}}if(it.vender.shipjzd&&(!it.vender.transferFlag||it.vender.transferFlag=='0')){supjzdjsd='可选京准达';}if(it.vender.ship411&&it.vender._ship411Obj.isGray=="0"&&(!it.vender.transferFlag||it.vender.transferFlag=='0')){supjzdjsd=supjzdjsd?supjzdjsd+'和极速达':'可选极速达';}if(it.vender.shipjzd&&now>new Date('2017/02/27 15:00:00')&&supSmArr.length>0&&supLaInArr.length==0&&(!it.vender.transferFlag||it.vender.transferFlag=='0')){supjzdjsd='京准达运费大促';}if(it.vender.selectedShip=='shipjzd'){supjzdjsd='已选京准达';}if(it.vender.selectedShip=='ship411'){supjzdjsd='已选极速达';}supjzdjsd=supjzdjsd?'<span id="supTip">('+supjzdjsd+')</span>':'';var isShopSelected=false;out+=' <div class="order_additional_tips type_un7day" id="ship1111TipSel" style="display:none"> <p class="order_additional_tips_text"></p> <i class="order_additional_tips_close" id="ship1111SelClose"></i> </div> <div class="buy_shipping_v2"> <h3 class="buy_shipping_v2_title type_shipping">配送方式</h3> <ul class="buy_shipping_v2_ways" id="shipType"> ';if(it.vender.shipjd){jdSeled=!it.vender.shiphonor&&(it.vender.selectedShip=="ship311"||it.vender.selectedShip=="ship411"||it.vender.selectedShip=="shipjzd"||it.vender.selectedlaShip=="shipla"||it.vender.selectedlaShip=="shipla2"||it.vender.selectedlaShip=="shiplajzd"||it.vender.selectedShip=="shipjd");out+=' <li class="buy_shipping_v2_way ';if(jdSeled){out+='selected';}
out+='" type="shipjd" shipid="65" curShipType="0" id="shipJD"> '+(jdShipName)+' </li> ';}else if(it.vender.shipSopjd){out+=' <li class="buy_shipping_v2_way ';if(it.vender.selectedShip=='shipSopjd'&&!it.vender.shiphonor){out+='selected';}
out+='" type="shipSopjd" shipid="'+(it.vender.shipSopjd.id)+'" curShipType="'+(it.vender.shipSopjd.type)+'"> '+(jdShipName)+' </li> ';}else if(it.vender.shiplaSopjd){out+=' <li class="buy_shipping_v2_way ';if(it.vender.selectedlaShip=='shipla'){out+='selected';}
out+='" type="shiplaSopjd" shipid="'+(it.vender.shipid)+'" curShipType="'+(it.vender.shiptype)+'"> ';if(it.vender.shiptype=='5'){out+=' '+(jdShipName)+' ';}else{out+=' 快递运输 ';}
out+=' </li> ';}
out+=' ';if(it.vender.ship3&&!it.vender.shiplaSopjd){out+=' <li type="ship3" class="buy_shipping_v2_way ';if(it.vender.selectedShip=='ship3'){out+='selected';}
out+='" shipid="'+(it.vender.ship3.id)+'" curShipType="'+(it.vender.ship3.type)+'"> 快递运输 </li> ';}
out+=' ';if(it.vender.shipSop&&!it.vender.shiplaSopjd){out+=' <li type="shipSop" class="buy_shipping_v2_way ';if(it.vender.selectedShip=='shipSop'&&!it.vender.shiphonor){out+='selected';}
out+='" shipid="'+(it.vender.shipSop.id)+'" curShipType="'+(it.vender.shipSop.type)+'"> 快递运输 </li> ';}
out+=' ';if(it.vender.shipziti&&!it.vender.isla&&(!(it.vender.venderType=='0'||it.vender.venderType=='1')||!it.containLa)){out+=' <li class="buy_shipping_v2_way ';if(it.vender.selectedShip=='shipziti'){out+='selected';}
out+='" type="shipziti" shipid="'+(it.vender.shipziti.id)+'" curShipType="'+(it.vender.shipziti.type)+'"> 上门自提 </li> ';}
out+=' ';if(it.vender.shipShopPick){out+=' <li class="buy_shipping_v2_way ';if(it.vender.selectedShip=='shipShopPick'){out+='selected';}
out+='" type="shipShopPick" shipid="'+(it.vender.shipShopPick.id)+'" curShipType="'+(it.vender.shipShopPick.type)+'"> 门店自提 </li> ';}
out+=' ';if(it.vender.shipGsd){out+=' <li class="buy_shipping_v2_way ';if(it.vender.selectedShip=='shipGsd'){out+='selected';}
out+='" type="shipGsd" shipid="71" curShipType="8"> 同城速配 </li> ';}
out+=' ';if(it.vender.shipPopGsd){out+=' <li class="buy_shipping_v2_way ';if(it.vender.selectedShip=='shipPopGsd'){out+='selected';}
out+='" type="shipPopGsd" shipid="71" curShipType="9"> 同城速配 </li> ';}
out+=' ';if(it.vender.showHonor){out+=' ';if(it.vender.shipjd){out+=' <li type="shiphonor" class="buy_shipping_v2_way ';if(it.vender.shiphonor){out+='selected';}
out+='" shipid="65" curShipType="0" > <div class="jdhonor_btn_logo"></div> 京尊达 </li> ';}else if(it.vender.shipSopjd){out+=' <li type="shiphonor" class="buy_shipping_v2_way ';if(it.vender.shiphonor){out+='selected';}
out+='" shipid="'+(it.vender.shipSopjd.id)+'" curShipType="'+(it.vender.shipSopjd.type)+'" > <div class="jdhonor_btn_logo"></div> 京尊达 </li> ';}else if(it.vender.shipSop){out+=' <li type="shiphonor" class="buy_shipping_v2_way ';if(it.vender.shiphonor){out+='selected';}
out+='" shipid="'+(it.vender.shipSop.id)+'" curShipType="'+(it.vender.shipSop.type)+'"> <div class="jdhonor_btn_logo"></div> 京尊达 </li> ';}
out+=' ';}
out+=' </ul> ';if(supSmArr.length>0){out+=' <div class="buy_shipping_v2_detail" type_con="shipjd" style="display: none;"> <h3 class="buy_shipping_v2_title"> ';if(it.vender.shiphonor){out+=' 专人配送，专车送达，';if(it.vender._shiphonorObj&&it.vender._shiphonorObj.insuranceFee>0){out+='服务费<span style="color: red;">&yen;'+(((+it.vender._shiphonorObj.insuranceFee)/100))+'</span>';}else{out+='限时免服务费';}
out+=' ';}else{out+=' 中小件配送'+(supjzdjsd)+' ';}
out+=' </h3> <div class="buy_shipping_v2_images"> ';for(i=0,j=supSmArr.length;i<j;i++){out+=' <li class="buy_shipping_v2_li"> <img src="//img10.360buyimg.com/n4/'+(supSmArr[i].mainSku.image)+'" class="buy_shipping_v2_image"> ';if(it.vender.containZY&&it.vender.containFactory){out+=' <span class="tip"> ';if(supSmArr[i].mainSku.isnoZY==1&&supSmArr[i].mainSku.factoryShip==1){out+=' 厂商配送 ';}else{out+=' 京东快递 ';}
out+=' </span> ';}
out+=' ';}
out+=' </li> </div> ';if(it.vender.supCombine){out+=' <ul class="buy_shipping_v2_combine buy_shipping_v2_options"> <li class="buy_shipping_v2_option ';if(!it.vender.selectCombine){out+=' selected ';}
out+='" id="noCombine"> 尽快送货&nbsp;<span class="jd_support">(以上商品分属不同仓库，将多次上门配送)</span> </li> <li class="buy_shipping_v2_option ';if(it.vender.selectCombine){out+=' selected ';}
out+='" id="combine"> 合并送货&nbsp;<span class="jd_support">(配送员将一次完成配送)</span> </li> </ul> ';}
out+=' ';if(it.vender.selectedShip=="shipjd"){out+=' <div class="buy_shipping_v2_tips"> 送货时间：工作日、双休日与节假日均可送货 </div> ';}else if(it.vender.selectedShip=='ship311'){out+=' ';if(it.vender.transferFlag&&it.vender.transferFlag!='0'){out+=' <div class="buy_shipping_v2_tips"> 送货时间：预计'+(it.vender._ship311Obj.date.replace(/\d{4}-/,''))+' '+(weekMap[it.vender._ship311Obj.week])+' '+(it.vender._ship311Obj.time)+'送达 </div> ';}else{out+=' <div class="buy_shipping_v2_time" id="ship311Sel"> 送货时间：'+(it.vender._ship311Obj.date.replace(/\d{4}-/,''))+' '+(weekMap[it.vender._ship311Obj.week])+' '+(it.vender._ship311Obj.time)+' </div> ';}
out+=' ';}else if(it.vender.selectedShip=='ship411'){out+=' <div class="buy_shipping_v2_time" id="ship311Sel"> 送货时间：'+(it.vender._ship411Obj&&it.vender._ship411Obj.dataFlag=='1'?it.vender._ship411Obj.promiseTime.replace(/\d{4}-(\d+)-(\d+) (\d+:\d+):\d+/,'$1月$2日$3')+'前送达'+(it.vender._ship411Obj.fee/1>0?'(运费'+(it.vender._ship411Obj.fee/100).toFixed(0)+'元)':''):'极速达(2小时送达)')+' </div> ';}else if(it.vender.selectedShip=='shipjzd'){out+=' <div class="buy_shipping_v2_time" id="ship311Sel"> 送货时间：'+(it.vender._shipjzdObj.date.replace(/\d{4}-/,''))+' '+(weekMap[it.vender._shipjzdObj.week])+' '+(it.vender._shipjzdObj.time)+' </div> ';}else if(it.vender.selectedShip=="shipSopjd"){out+=' ';if(it.vender.sopjdCalendar){out+=' <div class="buy_shipping_v2_time" id="sopjdSel"> 送货时间：'+(it.vender._shipSopjdObj.date.replace(/\d{4}-/,''))+' '+(weekMap[it.vender._shipSopjdObj.week])+' '+(it.vender._shipSopjdObj.time)+' </div> ';}else{out+=' <div class="buy_shipping_v2_tips"> 送货时间：'+(it.vender.sopDefault.sendHtml||'工作日、双休日与节假日均可送货')+' </div> ';}
out+=' ';}else if(it.vender.selectedShip=="shipSop"){out+=' ';if(it.vender.sopCalendar){out+=' <div class="buy_shipping_v2_time" id="sopSel"> 送货时间：'+(it.vender._shipSopObj.date.replace(/\d{4}-/,''))+' '+(weekMap[it.vender._shipSopObj.week])+' '+(it.vender._shipSopObj.time)+' </div> ';}else{out+=' <div class="buy_shipping_v2_tips"> 送货时间：'+(it.vender.sopDefault.sendHtml||(['0','1'].indexOf(it.vender.venderType)>-1?'地址超出京东配送范围，将由其他快递配送':'工作日、双休日与节假日均可送货'))+' </div> ';}
out+=' ';}else if(it.vender.selectedShip=="ship3"){out+=' <div class="buy_shipping_v2_tips"> 送货时间：'+(['0','1'].indexOf(it.vender.venderType)>-1?'地址超出京东配送范围，将由其他快递配送':'工作日、双休日与节假日均可送货')+' </div> ';}else{out+=' <div class="buy_shipping_v2_tips"> 送货时间：'+(['0','1'].indexOf(it.vender.venderType)>-1?'地址超出京东配送范围，将由其他快递配送':'工作日、双休日与节假日均可送货')+' </div> ';}
out+=' ';if(it.vender.containZY&&it.vender.containFactory){out+=' <div class="buy_shipping_v2_tips">注：部分商品由厂商发货配送</div> ';}
out+=' ';if(it.vender.gsdPart){out+=' <div class="buy_shipping_v2_tips">注：部分商品由最近的仓库发货，下单后预计1小时内送达</div> ';}
out+=' </div> ';}
out+=' ';if(supSmArr.length>0&&it.vender.shipGsd){out+=' <div class="buy_shipping_v2_detail" type_con="shipGsd" style="display: none;"> <h3 class="buy_shipping_v2_title">中小件配送</h3> <div class="buy_shipping_v2_images"> ';for(i=0,j=supSmArr.length;i<j;i++){out+=' <img src="//img10.360buyimg.com/n4/'+(supSmArr[i].mainSku.image)+'" class="buy_shipping_v2_image"> ';}
out+=' </div> ';if(it.vender.shipGsdcalendar&&it.vender.shipGsdcalendar.length>0){out+=' <div class="buy_shipping_v2_time" id="shipGsdSel"> ';if(it.vender._shipGsdObj&&it.vender._shipGsdObj.date){out+=' 送货时间：'+([it.vender._shipGsdObj.date.replace(/\d{4}-/,''),weekMap[it.vender._shipGsdObj.week],it.vender._shipGsdObj.time].join(' ').replace(/.+立即送达/,'下单'+it.vender.speedHour+'小时内送达'))+' ';}
out+=' </div> ';}else{out+=' <div class="buy_shipping_v2_tips"> 送货时间：工作日、双休日与节假日均可送货 ';if(it.vender.isWalmart=='1'){if(it.walmartGsdFee>0){out+=' (加收'+((it.walmartGsdFee/100).toFixed(2))+'元) ';}
out+=' ';}else if(it.vender.isSams=='1'){if(it.samZxjGsdShipFee>0){out+=' (加收'+((it.samZxjGsdShipFee/100).toFixed(2))+'元) ';}
out+=' ';}else{if(it.zxjGsdFee/1+it.freshGsdFee/1>0){out+=' (加收'+((it.zxjGsdFee/100+it.freshGsdFee/100).toFixed(2))+'元) ';}
out+=' ';}
out+=' </div> ';}
out+=' </div> ';}
out+=' ';if((supSmArr.length>0||supLaArr.length>0)&&it.vender.shipPopGsd){out+=' <div class="buy_shipping_v2_detail" type_con="shipPopGsd" style="display: none;"> ';if(supSmArr.length>0&&supLaArr.length==0){out+=' <h3 class="buy_shipping_v2_title">中小件配送</h3> ';}else if(supSmArr.length==0&&supLaArr.length>0){out+=' <h3 class="buy_shipping_v2_title">大件配送</h3> ';}else if(supSmArr.length>0&&supLaArr.length>0){out+=' <h3 class="buy_shipping_v2_title">中小件和大件配送</h3> ';}
out+=' ';var supSmLaArr=supSmArr.concat(supLaArr);out+=' <div class="buy_shipping_v2_images"> ';for(i=0,j=supSmLaArr.length;i<j;i++){out+=' <img src="//img10.360buyimg.com/n4/'+(supSmLaArr[i].mainSku.image)+'" class="buy_shipping_v2_image"> ';}
out+=' </div> ';if(it.vender.shipPopGsdCalendar&&it.vender.shipPopGsdCalendar.length>0){out+=' <div class="buy_shipping_v2_time" id="shipPopGsdSel"> ';if(it.vender._shipPopGsdObj&&it.vender._shipPopGsdObj.date){out+=' 送货时间：'+([it.vender._shipPopGsdObj.date.replace(/\d{4}-/,''),weekMap[it.vender._shipPopGsdObj.week],it.vender._shipPopGsdObj.time].join(' ').replace(/.+立即送达/,'下单'+it.vender.speedHour+'小时内送达'))+' ';}
out+=' </div> ';}else{out+=' <div class="buy_shipping_v2_tips"> 送货时间：工作日、双休日与节假日均可送货 ';if(it.vender.isWalmart=='1'){if(it.walmartGsdFee>0){out+=' (加收'+((it.walmartGsdFee/100).toFixed(2))+'元) ';}
out+=' ';}else if(it.vender.isSams=='1'){if(it.samZxjGsdShipFee>0){out+=' (加收'+((it.samZxjGsdShipFee/100).toFixed(2))+'元) ';}
out+=' ';}else{if(it.zxjGsdFee/1+it.freshGsdFee/1>0){out+=' (加收'+((it.zxjGsdFee/100+it.freshGsdFee/100).toFixed(2))+'元) ';}
out+=' ';}
out+=' </div> ';}
out+=' </div> ';}
out+=' ';if(supLaArr.length>0){supjzdjsd='';if(it.vender.shiplajzd){supjzdjsd='可选京准达';}if(it.vender.shipla411&&it.vender._shipla411Obj.isSupport=='1'){supjzdjsd=supjzdjsd?supjzdjsd+'和极速达':'可选极速达';}if(it.vender.selectedlaShip=='shiplajzd'){supjzdjsd='已选京准达';}if(it.vender.selectedlaShip=='shipla411'){supjzdjsd='已选极速达';}supjzdjsd=supjzdjsd?'<span id="suplaTip">('+supjzdjsd+')</span>':'';out+=' <div class="buy_shipping_v2_detail" type_con="shipjd" style="display: none;"> <h3 class="buy_shipping_v2_title"> 大件配送 '+(supjzdjsd)+' </h3> <div class="buy_shipping_v2_images"> ';for(i=0,j=supLaArr.length;i<j;i++){out+=' <li class="buy_shipping_v2_li"> <img src="//img10.360buyimg.com/n4/'+(supLaArr[i].mainSku.image)+'" class="buy_shipping_v2_image"> ';if(it.vender.containZY&&it.vender.containFactory){out+=' <span class="tip"> ';if(supLaArr[i].mainSku.isnoZY==1&&supLaArr[i].mainSku.factoryShip==1){out+=' 厂商配送 ';}else{out+=' 京东快递 ';}
out+=' </span> ';}
out+=' </li> ';}
out+=' </div> ';if(it.vender.selectedlaShip){out+=' <div class="buy_shipping_v2_time" id="laDSel"> 送货时间： ';if(it.vender.selectedlaShip=='shipla'){la=it.vender.shiplacalendar;out+=' '+(it.formatDateFromOffset(la.defaultDDate,la.defaultDOffset,la.defaultDOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,''))+' ';}else if(it.vender.selectedlaShip=='shipla2'){la=it.vender.shipla2calendar;out+=' '+(it.vender._shipla2Obj.date.replace(/\d{4}-/,''))+' '+(weekMap[it.vender._shipla2Obj.week])+' '+(it.vender._shipla2Obj.time)+' ';}else if(it.vender.selectedlaShip=='shiplajzd'){la=it.vender.shiplajzdcalendar;out+=' '+(it.vender._shiplajzdObj.date.replace(/\d{4}-/,''))+' '+(weekMap[it.vender._shiplajzdObj.week])+' '+(it.vender._shiplajzdObj.time)+' ';}else if(it.vender.selectedlaShip=='shipla411'){la=it.vender._shipla411Obj;out+=' 预计'+(la.speedHour)+'小时内送达';if(la.fee>0){out+='(运费'+(la.fee)+'元)';}
out+=' ';}
out+='  </div> ';}else{out+=' <div class="buy_shipping_v2_tips"> 送货时间：工作日、双休日与节假日均可送货 </div> ';}
out+=' ';if(it.vender.containZY&&it.vender.containFactory){out+=' <div class="buy_shipping_v2_tips">注：部分商品由厂商发货配送</div> ';}
out+=' <div class="buy_shipping_v2_integration_tip" style="display:none;">送货时间在第11天及以后时，不支持货到付款。</div> </div> ';}
out+=' ';if(it.vender.shipziti&&!it.vender.isla&&(!(it.vender.venderType=='0'||it.vender.venderType=='1')||!it.containLa)){out+=' <div class="buy_shipping_v2_detail" type_con="shipziti" style="display: none;"> <h3 class="buy_shipping_v2_title">自提地点和时间</h3> <div class="buy_shipping_v2_images"> ';for(i=0,j=supSmArr.length;i<j;i++){out+=' <img src="//img10.360buyimg.com/n4/'+(supSmArr[i].mainSku.image)+'" class="buy_shipping_v2_image"> ';}
out+=' </div> <div class="buy_shipping_v2_location"> ';if(it.vender._shipzitiObj&&it.vender._shipzitiObj.addr){out+=' <p>'+(it.vender._shipzitiObj.addr.pickName)+'</p> <p>'+(it.vender._shipzitiObj.addr.address)+'</p> ';}
out+=' </div> ';if(it.vender._shipzitiObj.shipmentTimeType!=3&&it.vender._shipzitiObj.shipmentTimeType){out+=' <div class="buy_shipping_v2_time" id="zitiSel"> 自提时间： <span class="date" id="zitiSel">'+(it.vender._shipzitiObj.date.substr(0,10))+'</span> </div> ';}else{out+=' <div class="buy_shipping_v2_tips"> 自提时间：提货时间以短信通知为准 </div> ';}
out+=' </div> ';}
out+=' ';if(it.vender.shipShopPick){out+=' <div class="buy_shipping_v2_detail" type_con="shipShopPick" style="display: none;"> <h3 class="buy_shipping_v2_title">自提门店地址</h3> <div class="buy_shipping_v2_images"> ';for(i=0,j=supSmArr.length;i<j;i++){out+=' <img src="//img10.360buyimg.com/n4/'+(supSmArr[i].mainSku.image)+'" class="buy_shipping_v2_image"> ';}
out+=' </div> <div class="buy_shipping_v2_location"> ';if(it.vender.shipShopPick&&it.vender.shipShopPick.selected=='1'&&it.vender.shipShopPick.picked){isShopSelected=true;out+=' <p>'+(it.vender.shipShopPick.picked.name)+'</p> <p>地址：'+(it.vender.shipShopPick.picked.address)+'</p> ';}else{isShopSelected=false;out+=' <p class="buy_shipping_v2_location_title color_red">请选择自提门店</p> ';}
out+=' </div> <div class="buy_shipping_v2_tips"> 温馨提示：提货码将在支付完成后发送至您收货地址的手机号，请注意查收。 </div> </div> ';}
out+=' </div> ';if(supSmInArr.length>0&&it.vender.smInstall&&(!it.vender.transferFlag||it.vender.transferFlag=='0')){out+=' <div class="buy_shipping_v2" id="smshipin" type_con="shipjd" style="display:none;"> <div class="buy_shipping_v2_detail"> <h3 class="buy_shipping_v2_title type_install">中小件安装服务</h3> <div class="buy_shipping_v2_images"> ';for(i=0,j=supSmInArr.length;i<j;i++){out+=' <img src="//img10.360buyimg.com/n4/'+(supSmInArr[i].mainSku.image)+'" class="buy_shipping_v2_image"> ';}
out+=' </div> <div class="buy_shipping_v2_time" id="smInSel"> 中小件安装时间： ';if(it.vender.selectedShip=='ship311'&&it.vender.smIn311Obj){out+=' '+(it.formatDateFromOffset(it.vender.smIn311Obj.selectDate,it.vender.smIn311Obj.promiseDateOffset,it.vender.smIn311Obj.installOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,''))+' ';}else if(it.vender.selectedShip=='shipjzd'&&it.vender.smInjzdObj){out+=' '+(it.formatDateFromOffset(it.vender.smInjzdObj.selectDate,it.vender.smInjzdObj.promiseDateOffset,it.vender.smInjzdObj.installOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,''))+' ';}
out+=' </div> </div> </div> ';}
out+='  ';if(la&&(la.supInstall=='1'||la.isSupportInstall=='1')){out+=' <div class="buy_shipping_v2" type_con="shipjd" style="display:none;"> <div class="buy_shipping_v2_detail"> <h3 class="buy_shipping_v2_title type_install">安装服务</h3> <div class="buy_shipping_v2_images"> ';for(i=0,j=supLaInArr.length;i<j;i++){out+=' <img src="//img10.360buyimg.com/n4/'+(supLaInArr[i].mainSku.image)+'" class="buy_shipping_v2_image"> ';}
out+=' </div> <div class="buy_shipping_v2_time" id="laISel"> 大件安装时间： ';if(it.vender.selectedlaShip=='shipla'){la=it.vender.shiplacalendar;out+=' '+(it.formatDateFromOffset(la.defaultDDate,la.defaultDOffset,la.iOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,''))+' ';}else if(it.vender.selectedlaShip=='shipla2'){out+=' '+(it.formatDateFromOffset(it.vender._shipla2Obj.date,it.vender._shipla2Obj.reservingDate,it.vender._shipIns.iOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,''))+' ';}else if(it.vender.selectedlaShip=='shiplajzd'){out+=' '+(it.formatDateFromOffset(it.vender._shiplajzdObj.date,it.vender._shiplajzdObj.reservingDate,it.vender._shipIns.iOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,''))+' ';}else if(it.vender.selectedlaShip=='shipla411'){out+=' '+(it.formatDateFromOffset(it.vender._shipla411Obj.codDate,'0',it.vender._shipla411Obj.installDate,'YYYY-MM-DD 周W').replace(/\d{4}-/,''))+' ';}
out+=' </div> </div> <div class="buy_shipping_v2_detail" id="serviceArea" style="display:none;"></div> ';if(it.vender.supShipInstall=="1"){out+=' <div class="buy_shipping_v2_detail"> <div class="buy_shipping_v2_integration ';if(la.defaultDOffset&&la.defaultDOffset==la.iOffset){out+=' selected ';}
out+='" id="supShipInstall"> <div class="buy_shipping_v2_integration_title">送装一体化服务</div> <dic class="buy_shipping_v2_integration_text">您的订单由安装师傅带货上门，提供免费的送装一体服务</dic> </div> </div> ';}
out+=' </div> ';}else if(it.vender.shipsvc){out+=' <div class="deliver_way" id="svcArea" style="display:none;"></div> ';}else if(it.vender.supService){out+=' <div class="buy_shipping_v2" style="display:none;"> <div class="buy_shipping_v2_detail"> <h3 class="buy_shipping_v2_title type_install">安装服务</h3> <div id="serviceArea" style="display:none;"></div> </div> </div> ';}
out+='  <br/><br/><br/> <div id="shipSelDiv" style="display:none;"></div>  <div class="deliver_way"> <div class="confirm_btn"> <div class="price_wrap"> <p class="off" id="svcFeePromte" style="display:none;"> 服务费优惠 <em style="color: red;">-&yen;<span ></span></em> </p> <p class="off"> ';if(it.vender.selectedShip!=='shipShopPick'||isShopSelected===true){out+=' 配送费 <em style="color: red;">&yen;<span id="vshipFee">'+((it.vender.freight/100).toFixed(2))+'</span></em> ';}
out+=' ';if((it.vender.supService&&it.vender.isSupShipSvc=='1')||it.vender.shipsvc){out+=' ，安装服务费 <em style="color: red;">&yen;<span id="vsvcFee">'+((it.vender.venderShipSvcFee/100).toFixed(2))+'</span></em> ';}
out+=' </p> </div> <div class="btn" id="savePayShip">确认</div> </div> </div>';return out;;}
exports.child_selectSvcTpl=function(it){var out=' ';var i,j,venderSkuList=it.venderShipSvc.venderSkuList,skuItem,svcItem,selected="",skuTotalFee=0;out+=' <h3 class="type_install">安装服务</h3> ';for(i=0;i<venderSkuList.length;i++){skuItem=venderSkuList[i];out+=' <section class="good"> <div class="head"> <img src="//img10.360buyimg.com/n4/'+(skuItem.skuUrl)+'"> <p>'+(skuItem.skuName)+'</p> </div> <ul class="deliver_way_list" skuId="'+(skuItem.skuId)+'"> ';for(j=0;j<skuItem.shipServiceList.length;j++){svcItem=skuItem.shipServiceList[j];if(svcItem.isDefault=="1"){selected="selected";skuTotalFee+=parseInt(svcItem.amount);}selected=svcItem.isDefault=="1"?"selected":"";out+=' <li class="method '+(selected)+'" svcId='+(skuItem.skuId+"|"+svcItem.id)+' amount="'+(svcItem.amount)+'" svcName="'+(svcItem.name)+'"> <div class="name">'+(svcItem.name)+'<span class="cost">&yen;'+((svcItem.amount/100).toFixed(2))+'</span></div> <p class="detail">'+(svcItem.desc)+'</p> </li> ';}
out+=' </ul> </section> ';}
out+='';return out;;}
exports.child_serviceTpl=function(it){var out=' ';for(var i=0,j=0;i<it.length;i++){if(it[i].shipServiceList.length==0){continue;}
out+=' ';if(j==0){j++;out+=' <h3 class="buy_shipping_v2_title">家居建材安装服务类型</h3> ';}
out+=' <div class="buy_shipping_v2_images"> <img src="//img10.360buyimg.com/n4/'+(it[i].img)+'" class="buy_shipping_v2_image"> </div> <ul class="buy_shipping_v2_options buy_shipping_v2_service"> ';for(var j=0;j<it[i].shipServiceList.length;j++){var item=it[i].shipServiceList[j];out+=' <li class="buy_shipping_v2_option ';if(item.itemId==it[i].shipSvcItemId){out+='selected';}
out+='" skuid="'+(it[i].skuId)+'" itemid="'+(item.itemId)+'" price="'+(item.charge)+'">'+(item.itemName)+'<span class="buy_shipping_v2_option_price">&yen;'+((item.charge/100).toFixed(2))+'</span></li> ';}
out+=' </ul> ';}
out+=' ';return out;;}
exports.child_shipV2Tpl=function(it){var out=' ';var weekMap=['今天','周一','周二','周三','周四','周五','周六','周日'],i,l,item,list,la,ship411,shipType=it.shipType,laDesc,lastFlag,curFlag,dayType,isSel=false;out+=' ';if(it.vender.shipjd){out+=' <div class="mod_address_slide show" id="ship311SelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">送货时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_tabs_2 navBar"> ';if(it.vender.ship311){out+=' <li ';if(it.vender.selectedShip=='ship311'){out+='class="cur" ';}
out+=' id="bzd"><span>标准达</span></li> ';}
out+=' ';if(it.vender.shipjzd){out+=' <li ';if(it.vender.selectedShip=='shipjzd'){out+='class="cur" ';}
out+=' id="jzd"><span>京准达</span></li> ';}
out+=' ';if(it.vender.ship411&&it.vender._ship411Obj.isGray=="0"){out+=' <li ';if(it.vender.selectedShip=='ship411'){out+='class="cur" ';}
out+=' id="jsd"><span>极速达</span></li> ';}
out+=' </ul> ';if(it.vender.ship311&&it.vender.ship311calendar){out+=' <ul class="mod_address_slide_list_3 selShip" id="bzdLi" ';if(it.vender.selectedShip!='ship311'){out+='style="display:none;" ';}
out+='> ';for(i=0,l=it.vender.ship311calendar.length;i<l;i++){item=it.vender.ship311calendar[i];curFlag=item.date;isSel=(item.date+item.time)==(it.vender._ship311Obj.date+it.vender._ship311Obj.time)&&it.vender.selectedShip=='ship311';out+=' ';if(lastFlag!=curFlag){lastFlag=curFlag;if(i>0){out+=' </div> </li> ';}
out+=' <li class="mod_address_slide_select_time"> <h5 class="mod_address_slide_select_time_title">'+([item.date,weekMap[item.week]].join(' '))+'</h5> <div class="mod_address_slide_select_time_tabs"> ';}
out+=' <div class="mod_address_slide_select_time_tab ';if(isSel){out+='selected';}
out+='" value=\''+(encodeURIComponent(JSON.stringify(item)))+'\' desc="'+([item.date,weekMap[item.week],item.time].join(' '))+'" type="311ship"> <p>'+(item.time)+'</p> </div> ';}
out+=' </ul> ';}
out+=' ';if(it.vender.shipjzd&&it.vender.shipjzdcalendar){var t_item=it.vender.shipjzdcalendar[0],t_hour=t_item.time,t_hourArr,t_begin,t_end,rangeTime,curTag='2020',freshPre=it.vender.containFresh?'生鲜':'',jzdFee,tagArr=[],tagMap={'2005':'0.5小时','2010':'1小时','2020':'2小时'};t_hourArr=t_hour?t_hour.split('-'):'';t_begin=t_hourArr[0]?new Date((t_item.date+' '+t_hourArr[0]).replace(/-/g,"/")):'';t_end=t_hourArr[1]?new Date((t_item.date+' '+t_hourArr[1]).replace(/-/g,"/")):'';rangeTime=(t_end.getTime()-t_begin.getTime())/60000;if(rangeTime==30){curTag='2005';}else if(rangeTime==60){curTag='2010';}if(it.vender.calendarTag&&it.vender.calendarTag.length>0){for(i=0;i<it.vender.calendarTag.length;i++){item=it.vender.calendarTag[i];if(['2005','2010','2020'].indexOf(item.tagType)>-1){tagArr.push(item);}}tagArr.sort(function(a,b){a.tagType-b.tagType});}if(tagArr.length>0){out+=' <ul class="mod_address_slide_tabs_3" id="jzdNav" ';if(it.vender.selectedShip!='shipjzd'){out+='style="display:none;" ';}
out+='> <p class="mod_address_slide_tabs_3_text">送达时间精确至：</p> <li class="mod_address_slide_tabs_3_list"> ';for(i=0;i<tagArr.length;i++){item=tagArr[i];out+=' <div class="mod_address_slide_tabs_3_tab ';if(item.tagType==curTag){out+=' selected ';}
out+='" tagtype="'+(item.tagType)+'" type="zxj">'+(tagMap[item.tagType])+'</div> ';}
out+=' </li> </ul> ';}
out+=' <ul class="mod_address_slide_list_3 jzdul selShip" id="jzdLi" ';if(it.vender.selectedShip!='shipjzd'){out+='style="display:none;" ';}
out+='> ';for(i=0,l=it.vender.shipjzdcalendar.length;i<l;i++){item=it.vender.shipjzdcalendar[i];dayType=it.getDayType(item.time,true);curFlag=item.date+dayType;isSel=(item.date+item.time)==(it.vender._shipjzdObj.date+it.vender._shipjzdObj.time)&&it.vender.selectedShip=='shipjzd';if(item.freight){jzdFee=item.freight>0?'加收'+item.freight+'元运费':''+freshPre+'限时免费';}else{jzdFee=it.zxjJzdTipFee&&it.zxjJzdTipFee>0?'加收'+it.zxjJzdTipFee+'元运费':'';}
out+=' ';if(lastFlag!=curFlag){lastFlag=curFlag;if(i>0){out+=' </div> </li> ';}
out+=' <li class="mod_address_slide_select_time"> <h5 class="mod_address_slide_select_time_title">'+([item.date,weekMap[item.week],dayType].join(' '))+'</h5> <div class="mod_address_slide_select_time_tabs"> ';}
out+=' <div class="mod_address_slide_select_time_tab ';if(isSel){out+='selected';}
out+='" value="'+(encodeURIComponent(JSON.stringify(item)))+'" fee="'+(item.freight||0)+'" desc="'+([item.date,weekMap[item.week],item.time].join(' '))+'" type="jzdship"> <p>'+(item.time)+'</p> <p>'+(jzdFee)+'</p> </div> ';}
out+=' </ul> ';}
out+=' ';if(it.vender.ship411){out+=' <ul class="mod_address_slide_list_3 selShip" id="jsdLi"  ';if(it.vender.selectedShip!='ship411'){out+='style="display:none;" ';}
out+='> <li class="mod_address_slide_select_rush ';if(it.vender.selectedShip=='ship411'){out+='selected';}
out+='"> <div class="mod_address_slide_select_rush_text">'+(it.vender._ship411Obj&&it.vender._ship411Obj.dataFlag=='1'?it.vender._ship411Obj.promiseTime.replace(/\d{4}-(\d+)-(\d+) (\d+:\d+):\d+/,'$1月$2日$3')+'前送达':'下单或支付成功后2小时送达')+'</div> <div class="mod_address_slide_select_rush_subtext">加收运费'+((it.vender._ship411Obj.fee/100||it.obj.zxjJsdTipFee/1).toFixed(0)||99)+'元</div> </li> </ul> ';}
out+=' </div> </div> </div> ';}
out+=' ';if(it.vender.shipGsd&&it.vender.shipGsdcalendar&&it.vender.shipGsdcalendar.length>0){out+=' <div class="mod_address_slide show" id="shipGsdSelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">送货时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_list_3 selShip" id="gsdLi"> ';for(i=0,l=it.vender.shipGsdcalendar.length;i<l;i++){item=it.vender.shipGsdcalendar[i];curFlag=item.date;isSel=(item.date+item.time)==(it.vender._shipGsdObj.date+it.vender._shipGsdObj.time)&&it.vender.selectedShip=='shipGsd';out+=' ';if(lastFlag!=curFlag){lastFlag=curFlag;if(i>0){out+=' </div> </li> ';}
out+=' <li class="mod_address_slide_select_time"> <h5 class="mod_address_slide_select_time_title">'+([item.date,weekMap[item.week]].join(' '))+'</h5> <div class="mod_address_slide_select_time_tabs"> ';}
out+=' <div class="mod_address_slide_select_time_tab ';if(isSel){out+='selected';}
out+='" value=\''+(encodeURIComponent(JSON.stringify(item)))+'\' desc="'+([item.date,weekMap[item.week],item.time].join(' ').replace(/.+立即送达/,'下单'+it.vender.speedHour+'小时内送达'))+'" type="gsdship"> <p>'+(item.time.replace('立即送达','下单'+it.vender.speedHour+'小时内送达'))+'</p> </div> ';}
out+=' </ul> </div> </div> </div> ';}
out+=' ';if(it.vender.shipPopGsd&&it.vender.shipPopGsdCalendar){out+=' <div class="mod_address_slide show" id="shipPopGsdSelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">送货时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_list_3 selShip" id="popGsdLi"> ';for(i=0,l=it.vender.shipPopGsdCalendar.length;i<l;i++){item=it.vender.shipPopGsdCalendar[i];curFlag=item.date;isSel=(item.date+item.time)==(it.vender._shipPopGsdObj.date+it.vender._shipPopGsdObj.time)&&it.vender.selectedShip=='shipPopGsd';out+=' ';if(lastFlag!=curFlag){lastFlag=curFlag;if(i>0){out+=' </div> </li> ';}
out+=' <li class="mod_address_slide_select_time"> <h5 class="mod_address_slide_select_time_title">'+([item.date,weekMap[item.week]].join(' '))+'</h5> <div class="mod_address_slide_select_time_tabs"> ';}
out+=' <div class="mod_address_slide_select_time_tab ';if(isSel){out+='selected';}
out+='" value=\''+(encodeURIComponent(JSON.stringify(item)))+'\' desc="'+([item.date,weekMap[item.week],item.time].join(' ').replace(/.+立即送达/,'下单'+it.vender.speedHour+'小时内送达'))+'" type="popgsdship"> <p>'+(item.time.replace('立即送达','下单'+it.vender.speedHour+'小时内送达'))+'</p> </div> ';}
out+=' </ul> </div> </div> </div> ';}
out+=' ';if(it.vender.shiplajzd||it.vender.isla){out+=' <div class="mod_address_slide show" id="laDSelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">大件送货时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_tabs_2 navBar"> ';if((it.vender.shiplacalendar||it.vender.shipla2calendar)&&!it.vender.shiphonor){out+=' <li ';if(it.vender.selectedlaShip=='shipla'||it.vender.selectedlaShip=='shipla2'){out+='class="cur" ';}
out+=' id="bzdLa"><span>标准达</span></li> ';}
out+=' ';if(it.vender.shiplajzdcalendar){out+=' <li ';if(it.vender.selectedlaShip=='shiplajzd'){out+='class="cur" ';}
out+=' id="jzdLa"><span>京准达</span></li> ';}
out+=' ';if(it.vender.shipla411){out+=' <li ';if(it.vender.selectedlaShip=='shipla411'){out+='class="cur" ';}
out+=' id="jsdLa"><span>极速达</span></li> ';}
out+=' </ul> ';if(it.vender.isla){out+=' ';if(it.vender.shiplacalendar){la=it.vender.shiplacalendar;out+=' <ul class="mod_address_slide_list_3 selShip" id="bzdLaLi" ';if(!(it.vender.selectedlaShip=='shipla2'||it.vender.selectedlaShip=='shipla')){out+='style="display:none;" ';}
out+='> <li class="mod_address_slide_select_time"> <div class="mod_address_slide_select_time_tabs"> ';for(i=0,l=la.delvDates.split(',').length;i<l;i++){item=la.delvDates.split(',')[i];if(item<0){continue;out+=' <div class="mod_address_slide_select_time_tab selected"> <p>暂缓送货</p> </div> ';}else{laDesc=it.formatDateFromOffset(la.defaultDDate,la.defaultDOffset,item,'YYYY-MM-DD 周W');out+=' <div class="mod_address_slide_select_time_tab ';if(item==la.defaultDOffset&&it.vender.selectedlaShip=='shipla'){out+='selected';}
out+='" value=\''+(item)+'\' type="laship" desc="'+(laDesc)+'"> <p>'+(laDesc)+'</p> </div> ';}
out+=' ';}
out+=' </div> </li> ';}
out+=' ';if(it.vender.shipla2calendar){out+=' <ul class="mod_address_slide_list_3 selShip" id="bzdLaLi" ';if(!(it.vender.selectedlaShip=='shipla2'||it.vender.selectedlaShip=='shipla')){out+='style="display:none;" ';}
out+='> ';for(i=0,l=it.vender.shipla2calendar.calendar.length;i<l;i++){item=it.vender.shipla2calendar.calendar[i];curFlag=item.date;isSel=(item.date+item.time)==(it.vender._shipla2Obj.date+it.vender._shipla2Obj.time)&&it.vender.selectedlaShip=='shipla2';out+=' ';if(lastFlag!=curFlag){lastFlag=curFlag;if(i>0){out+=' </div> </li> ';}
out+=' <li class="mod_address_slide_select_time"> <h5 class="mod_address_slide_select_time_title">'+([item.date,weekMap[item.week]].join(' '))+'</h5> <div class="mod_address_slide_select_time_tabs"> ';}
out+=' <div class="mod_address_slide_select_time_tab ';if(isSel){out+='selected';}
out+='" value=\''+(encodeURIComponent(JSON.stringify(item)))+'\' type="la2ship" reservingDate="'+(item.reservingDate)+'" desc="'+([item.date,weekMap[item.week],item.time].join(' '))+'">'+([item.date,weekMap[item.week]].join(' '))+' <p>'+(item.time)+'</p> </div> ';}
out+=' ';}
out+=' </ul> ';}
out+=' ';if(it.vender.shiplajzdcalendar){var t_item=it.vender.shiplajzdcalendar.calendar[0],t_hour=t_item.time,t_hourArr,djdJzdFee,freshPre;freshPre=it.vender.containFresh?'生鲜':'';out+='  <ul class="mod_address_slide_list_3 selShip" id="jzdLaLi"  ';if(it.vender.selectedlaShip!='shiplajzd'){out+='style="display:none;" ';}
out+='> ';if(it.vender.shiplajzdcalendar.calendar){out+=' ';for(i=0,l=it.vender.shiplajzdcalendar.calendar.length;i<l;i++){item=it.vender.shiplajzdcalendar.calendar[i];dayType=it.getDayType(item.time,true);curFlag=item.date+dayType;isSel=(item.date+item.time)==(it.vender._shiplajzdObj.date+it.vender._shiplajzdObj.time)&&it.vender.selectedlaShip=='shiplajzd';if(item.freight){djdJzdFee=item.freight>0?'加收'+item.freight+'元运费':''+freshPre+'限时免费';}else{djdJzdFee=it.djdJzdTipFee&&it.djdJzdTipFee>0?'加收'+it.djdJzdTipFee+'元运费':'';}
out+=' ';if(lastFlag!=curFlag){lastFlag=curFlag;if(i>0){out+=' </div> </li> ';}
out+=' <li class="mod_address_slide_select_time"> <h5 class="mod_address_slide_select_time_title">'+([item.date,weekMap[item.week],dayType].join(' '))+'</h5> <div class="mod_address_slide_select_time_tabs"> ';}
out+=' <div class="mod_address_slide_select_time_tab ';if(isSel){out+='selected';}
out+='" value="'+(encodeURIComponent(JSON.stringify(item)))+'" type="lajzdship" fee="'+(item.freight||0)+'" desc="'+([item.date,weekMap[item.week],item.time].join(' '))+'"> <p>'+(item.time)+'</p> <p>'+(djdJzdFee)+'</p> </div> ';}
out+=' ';}
out+=' </ul> ';}
out+=' ';if(it.vender.shipla411){out+=' <ul class="mod_address_slide_list_3 selShip" id="jsdLaLi"  ';if(it.vender.selectedlaShip!='shipla411'){out+='style="display:none;" ';}
out+='> <li class="mod_address_slide_select_rush ';if(it.vender.selectedlaShip=='shipla411'){out+='selected';}
out+='"> <div class="mod_address_slide_select_rush_text">预计'+(it.vender._shipla411Obj.speedHour)+'小时内送达</div> <div class="mod_address_slide_select_rush_subtext">加收运费'+(it.vender._shipla411Obj.fee||99)+'元</div> </li> </ul> ';}
out+=' </div> </div> </div> ';}
out+=' ';if(it.vender.smInstall){var supSmObj,inMap,smInDesc;if(it.vender.selectedShip=='ship311'){supSmObj=it.vender.smIn311Obj;}if(it.vender.selectedShip=='shipjzd'){supSmObj=it.vender.smInjzdObj;}supSmObj=supSmObj?supSmObj:it.vender.smIn311Obj;if(supSmObj){inMap=supSmObj.instlDateMap[supSmObj.selectDate];}if(inMap){out+=' <div class="mod_address_slide show" id="smInSelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">中小件安装时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_list_3 selShip" id="smInstallLi"> <li class="mod_address_slide_select_time"> <div class="mod_address_slide_select_time_tabs"> ';for(i=0,l=inMap.length;i<l;i++){item=inMap[i];if(item<0){continue;out+=' <div class="mod_address_slide_select_time_tab"> <p>暂缓送货</p> </div> ';}else{smInDesc=it.formatDateFromOffset(supSmObj.selectDate,supSmObj.promiseDateOffset,item,"YYYY-MM-DD 周W");out+=' <div class="mod_address_slide_select_time_tab ';if(item==supSmObj.installOffset){out+='selected';}
out+='" value=\''+(item)+'\' type="smInstall" desc="'+(smInDesc)+'"> <p>'+(smInDesc)+'</p> </div> ';}
out+=' ';}
out+=' </div> </li> </ul> </div> </div> </div> ';}
out+=' ';}
out+=' ';if((it.vender.shiplacalendar&&it.vender.shiplacalendar.supInstall=='1')||(it.vender.shipla2calendar&&it.vender.shipla2calendar.supInstall=='1')||(it.vender.shiplajzdcalendar&&it.vender.shiplajzdcalendar.supInstall=='1')||(it.vender.shipla411&&it.vender._shipla411Obj.isSupportInstall=='1')){var supLaObj,dselDate,inSelDate,inMap,iOffset;if(it.vender.shiplacalendar&&it.vender.selectedlaShip=='shipla'){supLaObj=it.vender.shiplacalendar;inSelDate=it.vender.shiplacalendar.defaultDOffset;dselDate=it.vender.shiplacalendar.defaultDDate;inMap=supLaObj.instlDateMap[inSelDate];iOffset=supLaObj.iOffset;}if(it.vender.shipla2calendar&&it.vender.selectedlaShip=='shipla2'){supLaObj=it.vender.shipla2calendar;inSelDate=it.vender._shipla2Obj.reservingDate;dselDate=it.vender._shipla2Obj.date;inMap=supLaObj.instlDateMap[inSelDate];iOffset=supLaObj.iOffset;}if(it.vender.shiplajzdcalendar&&it.vender.selectedlaShip=='shiplajzd'){supLaObj=it.vender.shiplajzdcalendar;inSelDate=it.vender._shiplajzdObj.reservingDate;dselDate=it.vender._shiplajzdObj.date;inMap=supLaObj.instlDateMap[inSelDate];iOffset=supLaObj.iOffset;}if(it.vender._shipla411Obj&&it.vender.selectedlaShip=='shipla411'){dselDate=it.vender._shipla411Obj.codDate;inSelDate='0';inMap=it.vender._shipla411Obj.installDateList.split(',');iOffset=it.vender._shipla411Obj.installDate;}
out+=' <div class="mod_address_slide show" id="laISelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">安装时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_list_3 selShip" id="laInstallLi"> <li class="mod_address_slide_select_time"> <div class="mod_address_slide_select_time_tabs"> ';for(i=0,l=inMap.length;i<l;i++){item=inMap[i];if(item<0){continue;out+=' <div class="mod_address_slide_select_time_tab"> <p>暂缓送货</p> </div> ';}else{laDesc=it.formatDateFromOffset(dselDate,inSelDate,item,"YYYY-MM-DD 周W");out+=' <div class="mod_address_slide_select_time_tab ';if(item==iOffset){out+='selected';}
out+='" value=\''+(item)+'\' type="install" desc="'+(laDesc)+'"> <p>'+(laDesc)+'</p> </div> ';}
out+=' ';}
out+=' </div> </li> </ul> </div> </div> </div> ';}
out+='  ';if(it.vender.shipziti&&!it.vender.isla){out+=' <div class="mod_address_slide show" id="zitiSelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">自提时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_list_3 selShip" id="zitishipLi"> ';list=it.vender._shipzitiObj.item.dateList;out+=' <li class="mod_address_slide_select_time"> <div class="mod_address_slide_select_time_tabs"> ';for(i=0,l=list.length;i<l;i++){item=list[i];out+=' <div class="mod_address_slide_select_time_tab ';if(item.date==it.vender._shipzitiObj.date){out+='selected';}
out+='" value=\''+(encodeURIComponent(item.date))+'\' type="zitiship" desc="'+(item.date.substr(0,10))+'"> <p>'+(item.date.substr(0,10))+'</p> </div> ';}
out+=' </div> </li> </ul> </div> </div> </div> ';}
out+=' ';if(it.vender._shipSopjdObj){out+=' <div class="mod_address_slide show" id="sopjdSelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">送货时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_list_3 selShip" id="sopjdshipLi"> ';list=it.vender.sopjdCalendar;out+=' <li class="mod_address_slide_select_time"> <div class="mod_address_slide_select_time_tabs"> ';for(i=0,l=list.length;i<l;i++){item=list[i];out+=' <div class="mod_address_slide_select_time_tab ';if((item.date+item.time)==(it.vender._shipSopjdObj.date+it.vender._shipSopjdObj.time)&&it.vender.selectedShip=='shipSopjd'){out+='selected';}
out+='" value=\''+(encodeURIComponent(JSON.stringify(item)))+'\' type="sopjdship" desc="'+([item.date,weekMap[item.week],item.time].join(' '))+'"> <p>'+([item.date,weekMap[item.week],item.time].join(' '))+'</p> </div> ';}
out+=' </div> </li> </ul> </div> </div> </div> ';}
out+=' ';if(it.vender._shipSopObj){out+=' <div class="mod_address_slide show" id="sopSelArea" style="display:none;"> <div class="mod_address_slide_main"> <div class="mod_address_slide_head">送货时间<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_list_3 selShip" id="sopshipLi"> ';list=it.vender.sopCalendar;out+=' <li class="mod_address_slide_select_time"> <div class="mod_address_slide_select_time_tabs"> ';for(i=0,l=list.length;i<l;i++){item=list[i];out+=' <div class="mod_address_slide_select_time_tab ';if((item.date+item.time)==(it.vender._shipSopObj.date+it.vender._shipSopObj.time)&&it.vender.selectedShip=='shipSop'){out+='selected';}
out+='" value=\''+(encodeURIComponent(JSON.stringify(item)))+'\' type="sopjdship" desc="'+([item.date,weekMap[item.week],item.time].join(' '))+'"> <p>'+([item.date,weekMap[item.week],item.time].join(' '))+'</p> </div> ';}
out+=' </div> </li>  </ul> </div> </div> </div> ';}
out+='';return out;;}
exports.child_jzdshipTpl=function(it){var out=' ';for(i=0,l=it.calendar.length;i<l;i++){var item=it.calendar[i],dayType=it.getDayType(item.time,true),curFlag=item.date+dayType,jzdFee,lastFlag,curFlag,weekMap=['今天','周一','周二','周三','周四','周五','周六','周日'],isSel=false,freshPre=it.containFresh?'生鲜':'',typeStr=it.isla?'lajzdship':'jzdship';if(it.selStr){isSel=(item.date+item.time)==it.selStr;}if(item.freight){jzdFee=item.freight>0?'加收'+item.freight+'元运费':''+freshPre+'限时免费';}else{jzdFee=it.djdJzdTipFee&&it.defaultJzdFee>0?'加收'+it.defaultJzdFee+'元运费':'';}
out+=' ';if(lastFlag!=curFlag){lastFlag=curFlag;if(i>0){out+=' </div> </li> ';}
out+=' <li class="mod_address_slide_select_time"> <h5 class="mod_address_slide_select_time_title">'+([item.date,weekMap[item.week],dayType].join(' '))+'</h5> <div class="mod_address_slide_select_time_tabs"> ';}
out+=' <div class="mod_address_slide_select_time_tab ';if(isSel){out+='selected';}
out+='" value="'+(encodeURIComponent(JSON.stringify(item)))+'" type="'+(typeStr)+'" fee="'+(item.freight||0)+'" desc="'+([item.date,weekMap[item.week],item.time].join(' '))+'"> <p>'+(item.time)+'</p> <p>'+(jzdFee)+'</p> </div> ';}
out+='';return out;;}
exports.child_pickListTpl=function(it){var out=' ';var i=0,l=it.shipzitiPickList.length,item;out+=' <div class="mentioning_list"> <p class="title">自提地点 ';if(window.locker.zitiMap){out+=' <a href="javascript:void(0);" id="zitiMap" class="link">地图</a> ';}else{out+=' <span>共'+(l)+'个</span> ';}
out+=' </p> <ul id="addrList"> ';for(;i<l;i++){out+=' ';item=it.shipzitiPickList[i];out+=' <li pickid="'+(item.pickId)+'" class="';if(item.selected=='1'){out+=' selected ';}
out+='  ';if(item.available=='0'){out+=' disabled ';}
out+='"> <h3>'+(item.pickName)+'';if(item.available=='0'){out+='（已满）';}
out+='</h3> <p>'+(item.address)+'</p>  ';if(item.dist&&item.lat&&item.lng&&window.locker.zitiMap){out+=' ';if(i==0){out+=' <p class="distance">'+((item.dist<1000?item.dist+'m':(item.dist/1000)+'km'))+' <em>距离收货地址最近</em> </p> ';if(item.siteType=="46"||item.siteType=="48"){out+=' <p><em>京东合作方自提柜不支持货到付款</em></p> ';}
out+=' ';}else{out+=' <p class="distance">'+((item.dist<1000?item.dist+'m':(item.dist/1000)+'km'))+' ';if(item.siteType=="46"||item.siteType=="48"){out+=' <em>京东合作方自提柜不支持货到付款</em> ';}
out+=' </p> ';}
out+=' ';}else if(item.siteType=="46"||item.siteType=="48"){out+=' <p><em>京东合作方自提柜不支持货到付款</em></p> ';}
out+=' ';if(window.locker.zitiMap){out+=' <span class="btn" tag="zitiInfo" pickid="'+(item.pickId)+'"></span> ';}
out+=' </li> ';}
out+=' </ul> <span class="btn_more" id="getMore" style="display: none;">查看更多自提地点</span> </div> <div id="zitiModol" class="mod_alert mod_alert_address show fixed" style="display: none"> <p class="title" ctag="name"></p> <div class="content"> <h4>详细地址</h4> <p ctag="info"></p> <h4>电话号码</h4> <p ctag="tel"></p> <a ctag="telIcon" href="javascript:void(0);" class="tel"></a> </div> <div class="btns"> <a href="javascript:void(0);" ctag="iKnow" class="btn btn_1">知道了</a> </div> </div>';return out;;}
exports.child_shopPickAddrListTpl=function(it){var out=' ';var addrList=it||[];out+=' ';if(addrList.length>0){out+=' <div class="mentioning_list"> <p class="title">门店地址 <a href="javascript:void(0);" id="shopPickMap" class="link">地图</a> </p> <ul> ';addrList.forEach(function(item){out+=' <li addrId="'+(item.storeId)+'" class="';if(item.stockStatus==0){out+=' disabled ';}else if(item.selected==1){out+=' selected ';}
out+=' "> <h3>'+(item.name)+'</h3> <p>'+(item.address)+'</p> <p class="distance">'+(item.dist)+' ';if(item.Nearest==1){out+=' <em>距离收货地址最近</em> ';}
out+=' </p> ';if(item.stockStatus==0){out+=' <p><em>该门店商品无货</em></p> ';}
out+=' <span class="btn"></span> </li> ';});out+=' </ul> </div> ';}else{out+=' <div class="mentioning_list"> <p class="title">门店地址</p> </div> <div class="mod_empty_page"> <div class="mod_empty_page_icon"><img src="//img11.360buyimg.com/jdphoto/s200x200_jfs/t11623/249/2601967531/11770/e41f995d/5a9785b0Ndf756a12.png"></div> <p class="mod_empty_page_main" style="font-size: 14px; color: #999;">暂无匹配的门店</p> </div> ';}
out+=' <div id="shopPickAddrListTip" class="mod_alert mod_alert_address show fixed" style="display: none"> <p class="title" ctag="name"></p> <div class="content"> <h4>详细地址</h4> <p ctag="info"></p> <h4>营业时间</h4> <p ctag="time"></p> </div> <div class="btns"> <a href="javascript:void(0);" ctag="iKnow" class="btn btn_1">知道了</a> </div> </div>';return out;;}});
define("tpl_wq.addrSelectorV1",function(require,exports,module){var _cacheThisModule_,ins={};exports.template=function(it){return com(it);}
function com(it){var out='';return out;}
exports.child_addrSelectorV1=function(it){var out=' <div class="mod_address_slide show"> <div class="mod_address_slide_main type_flex"> <div class="mod_address_slide_head">所在地区<i class="close"></i></div> <div class="mod_address_slide_body"> <ul class="mod_address_slide_tabs_1"><!--addrSelectorTabsV1--></ul> <ul class="mod_address_slide_list_2"><!--addrSelectorListV1--></ul> </div> </div> </div> <div class="wx_loading" style="display: none;z-index: 150;"> <div class="wx_loading_inner"><i class="wx_loading_icon"></i>请求加载中...</div> </div>';return out;;}
exports.child_tabsV2=function(it){var out=' ';it.tabs.forEach(function(item){out+=' <li tag="'+(item.tag)+'" addrId="'+(item.id)+'" class="'+(item.selected?'cur':'')+'"><span>'+(item.name)+'</span></li> ';});out+='';return out;;}
exports.child_listV2=function(it){var out=' ';it.list.forEach(function(item){out+=' <li tag="'+(item.tag)+'" addrId="'+(item.id)+'" class="'+(item.selected?'on':'')+'" >'+(item.name)+'</li> ';});out+='';return out;;}});
define('wq.addrSelectorV1',function(require,exports,module){var $=require('zepto');var _loadScript=require('loadJs').loadScript;var _tempV1=require('tpl_wq.addrSelectorV1');var ID_DEF_VAL=0;var _store={sceneval:window.JD.url.getUrlParam('sceneval'),provinceData:{1:["北京",null],2:["上海",null],3:["天津",null],4:["重庆",null],5:["河北",null],6:["山西",null],7:["河南",null],8:["辽宁",null],9:["吉林",null],10:["黑龙江",null],11:["内蒙古",null],12:["江苏",null],13:["山东",null],14:["安徽",null],15:["浙江",null],16:["福建",null],17:["湖北",null],18:["湖南",null],19:["广东",null],20:["广西",null],21:["江西",null],22:["四川",null],23:["海南",null],24:["贵州",null],25:["云南",null],26:["西藏",null],27:["陕西",null],28:["甘肃",null],29:["青海",null],30:["宁夏",null],31:["新疆",null],84:["钓鱼岛",null],32:["台湾",null],52993:["港澳地区",null],53283:["海外",null],},selRegion:{provinceId:ID_DEF_VAL,cityId:ID_DEF_VAL,countyId:ID_DEF_VAL,townId:ID_DEF_VAL,},outputCb:function(){},};var pageWrap='';var domTabs=function(){return pageWrap+' ul.mod_address_slide_tabs_1';};var domList=function(){return pageWrap+' ul.mod_address_slide_list_2';};var domClose=function(){return pageWrap+' .mod_address_slide_head .close';};var domMask=function(){return pageWrap+' .mod_address_slide';};var domMain=function(){return pageWrap+' .mod_address_slide_main';};var domLoading=function(){return pageWrap+' .wx_loading';};var _api=(function(){var isM=function(){return parseInt(_store.sceneval)===2||document.domain.indexOf('m.jd.com')>-1;};var cgi={getprovince:'//wqdeal.jd.com/deal/recvaddr/getprovince',};function queryProvinceDataById(provinceId,callback){if(!_store.provinceData[provinceId]){throw new Error('[Error] Unexpected provinceId.');}
var cgiURL=cgi.getprovince;var cgiOption={callback:'getprovinceCb',provinceid:provinceId,sceneval:isM()?2:'',r:Math.random(),};window[cgiOption.callback]=function(rsp){if(callback){callback(rsp);}};_loadScript({url:cgiURL,data:cgiOption});}
return{queryProvinceDataById:queryProvinceDataById,};})();function loadCityData(provinceId,callback){if(!callback){return;}
if(provinceId&&_store.provinceData[provinceId]){if(_store.provinceData[provinceId][1]){callback();}else{$(domLoading()).show();_api.queryProvinceDataById(provinceId,function(rsp){$(domLoading()).hide();_store.provinceData[provinceId][1]=rsp;callback();});}}else{callback();}}
function bindListEvent(){$(domList()).off('click').on('click','li',function(){var tag=$(this).attr('tag');var addrId=$(this).attr('addrId');if(tag==='province'){_store.selRegion={provinceId:addrId,cityId:ID_DEF_VAL,countyId:ID_DEF_VAL,townId:ID_DEF_VAL};loadCityData(_store.selRegion.provinceId,function(){var viewData=calculateViewData(_store.provinceData,_store.selRegion);tabsComp.updateView(viewData);listComp.updateCityView(viewData);});}else if(tag==='city'){_store.selRegion.cityId=addrId;_store.selRegion.countyId=ID_DEF_VAL;_store.selRegion.townId=ID_DEF_VAL;var viewData=calculateViewData(_store.provinceData,_store.selRegion);if(viewData.countyData){tabsComp.updateView(viewData);listComp.updateCountyView(viewData);}else{_store.outputCb(formatViewData(viewData));$(pageWrap).empty();}}else if(tag==='county'){_store.selRegion.countyId=addrId;_store.selRegion.townId=ID_DEF_VAL;var viewData=calculateViewData(_store.provinceData,_store.selRegion);if(viewData.townData){tabsComp.updateView(viewData);listComp.updateTownView(viewData);}else{_store.outputCb(formatViewData(viewData));$(pageWrap).empty();}}else if(tag==='town'){_store.selRegion.townId=addrId;var viewData=calculateViewData(_store.provinceData,_store.selRegion);_store.outputCb(formatViewData(viewData));$(pageWrap).empty();}});}
function bindTabsEvent(){$(domTabs()).off('click').on('click','li',function(){if($(this).hasClass('cur')){return;}
var tag=$(this).attr('tag');var addrId=$(this).attr('addrId');var viewData=calculateViewData(_store.provinceData,_store.selRegion);if(tag==='province'){clsSelTabs();setSelTabs(addrId);listComp.updateProvinceView(viewData);}else if(tag==='plsSelProvince'){}else if(tag==='city'){clsSelTabs();setSelTabs(addrId);listComp.updateCityView(viewData);}else if(tag==='plsSelCity'){tabsComp.updateView(viewData);listComp.updateCityView(viewData);}else if(tag==='county'){clsSelTabs();setSelTabs(addrId);listComp.updateCountyView(viewData);}else if(tag==='plsSelCounty'){tabsComp.updateView(viewData);listComp.updateCountyView(viewData);}else if(tag==='town'){}else if(tag==='plsSelTown'){tabsComp.updateView(viewData);listComp.updateTownView(viewData);}});function clsSelTabs(){$(domTabs()+' li').removeClass('cur');}
function setSelTabs(addrId){$(domTabs()+' li[addrId="'+addrId+'"]').addClass('cur');}}
function bindCloseEvent(){$(domClose()).off('click').on('click',function(){$(pageWrap).empty();});$(domMain()).off('click').on('click',function(e){e.stopPropagation();});$(domMask()).off('click').on('click',function(){$(pageWrap).empty();});}
function calculateRegionData(regionData,regionId){if(!regionData||parseInt(regionId)===ID_DEF_VAL){return{regionName:'',nextLevelRegionData:null};}
if(typeof regionData[regionId]==='string'){return{regionName:regionData[regionId]||'',nextLevelRegionData:null,};}else if(regionData[regionId]instanceof Array){return{regionName:regionData[regionId][0]||'',nextLevelRegionData:regionData[regionId][1]||null,};}else{window.console.warn('[WARN] Unexpected regionData or regionId.');return{regionName:'',nextLevelRegionData:null};}}
function calculateViewData(provinceData,selRegion){var temp=calculateRegionData(provinceData,selRegion.provinceId);var provinceName=temp.regionName;var cityData=temp.nextLevelRegionData;temp=calculateRegionData(cityData,selRegion.cityId);var cityName=temp.regionName;var countyData=temp.nextLevelRegionData;temp=calculateRegionData(countyData,selRegion.countyId);var countyName=temp.regionName;var townData=temp.nextLevelRegionData;temp=calculateRegionData(townData,selRegion.townId);var townName=temp.regionName;return{provinceData:provinceData,provinceId:selRegion.provinceId,provinceName:provinceName,cityData:cityData,cityId:selRegion.cityId,cityName:cityName,countyData:countyData,countyId:selRegion.countyId,countyName:countyName,townData:townData,townId:selRegion.townId,townName:townName,};}
function formatViewData(viewData){if(viewData.provinceId+''==='53283'&&viewData.cityName){var temp=viewData.cityName.split('_');viewData.cityName=temp[0];viewData.areaCode=temp[1];viewData.nameCode=temp[2];}
return viewData;}
var tabsComp=(function(){function _calculateTabsData(viewData){var cityName=(viewData.provinceId+''==='53283'&&viewData.cityName)?viewData.cityName.split('_')[0]:viewData.cityName;if(viewData.provinceName&&cityName&&viewData.countyName&&viewData.townData){return[{tag:'province',id:viewData.provinceId,name:viewData.provinceName},{tag:'city',id:viewData.cityId,name:cityName},{tag:'county',id:viewData.countyId,name:viewData.countyName},{tag:'plsSelTown',id:viewData.townId,name:'请选择',selected:true},];}else if(viewData.provinceName&&cityName&&viewData.countyData){return[{tag:'province',id:viewData.provinceId,name:viewData.provinceName},{tag:'city',id:viewData.cityId,name:cityName},{tag:'plsSelCounty',id:viewData.countyId,name:'请选择',selected:true},];}else if(viewData.provinceName&&viewData.cityData){return[{tag:'province',id:viewData.provinceId,name:viewData.provinceName},{tag:'plsSelCity',id:viewData.cityId,name:'请选择',selected:true},];}else{return[{tag:'plsSelProvince',id:viewData.provinceId,name:'请选择',selected:true}];}}
return{updateView:function(viewData){$(domTabs()).html(_tempV1.child_tabsV2({tabs:_calculateTabsData(viewData)}));}};})();var listComp=(function(){function _calculateTownListData(viewData){return Object.keys(viewData.townData).map(function(townId){return{tag:'town',id:townId,name:calculateRegionData(viewData.townData,townId).regionName,selected:(townId+''===viewData.townId+'')};});}
function _calculateCountyListData(viewData){return Object.keys(viewData.countyData).map(function(countyId){return{tag:'county',id:countyId,name:calculateRegionData(viewData.countyData,countyId).regionName,selected:(countyId+''===viewData.countyId+'')};});}
function _calculateCityListData(viewData){return Object.keys(viewData.cityData).map(function(cityId){var name=calculateRegionData(viewData.cityData,cityId).regionName||'';return{tag:'city',id:cityId,name:viewData.provinceId+''==='53283'?name.split('_')[0]:name,selected:(cityId+''===viewData.cityId+'')};});}
function _calculateProvinceListData(viewData){return Object.keys(viewData.provinceData).map(function(provinceId){return{tag:'province',id:provinceId,name:calculateRegionData(viewData.provinceData,provinceId).regionName,selected:(provinceId+''===viewData.provinceId+'')};});}
function _calculateListData(viewData){if(viewData.provinceName&&viewData.cityName&&viewData.countyName&&viewData.townData){return _calculateTownListData(viewData);}else if(viewData.provinceName&&viewData.cityName&&viewData.countyData){return _calculateCountyListData(viewData);}else if(viewData.provinceName&&viewData.cityData){return _calculateCityListData(viewData);}else{return _calculateProvinceListData(viewData);}}
function scrollIntoView(){var list=$(domList()+' .on')[0];if(!list&&$(domList()+' li')[0]){list=$(domList()+' li')[0];}
if(list&&list.scrollIntoView){list.scrollIntoView();}}
return{updateView:function(viewData){$(domList()).html(_tempV1.child_listV2({list:_calculateListData(viewData)}));scrollIntoView();},updateProvinceView:function(viewData){$(domList()).html(_tempV1.child_listV2({list:_calculateProvinceListData(viewData)}));scrollIntoView();},updateCityView:function(viewData){$(domList()).html(_tempV1.child_listV2({list:_calculateCityListData(viewData)}));scrollIntoView();},updateCountyView:function(viewData){$(domList()).html(_tempV1.child_listV2({list:_calculateCountyListData(viewData)}));scrollIntoView();},updateTownView:function(viewData){$(domList()).html(_tempV1.child_listV2({list:_calculateTownListData(viewData)}));scrollIntoView();}};})();function showSelector(option){if(!option.outputCb){window.window.console.warn('[WARN] Option outputCb missing.');return;}
_store.outputCb=option.outputCb;if(!option.pageWrap){window.window.console.warn('[WARN] Option pageWrap missing.');return;}
pageWrap=option.pageWrap[0]==='#'?option.pageWrap:('#'+option.pageWrap);$(pageWrap).empty();if(option.maskProvinceIds instanceof Array&&option.maskProvinceIds.length>0){var map={};Object.keys(_store.provinceData).forEach(function(provinceId){if(option.maskProvinceIds.indexOf(parseInt(provinceId))===-1&&option.maskProvinceIds.indexOf(provinceId+'')===-1){map[provinceId]=_store.provinceData[provinceId];}});_store.provinceData=map;}
_store.selRegion={provinceId:option.provinceId||ID_DEF_VAL,cityId:option.cityId||ID_DEF_VAL,countyId:option.countyId||ID_DEF_VAL,townId:option.townId||ID_DEF_VAL};$(pageWrap).html(_tempV1.child_addrSelectorV1());try{loadCityData(_store.selRegion.provinceId,function(){var viewData=calculateViewData(_store.provinceData,_store.selRegion);tabsComp.updateView(viewData);listComp.updateView(viewData);});}catch(e){_store.selRegion={provinceId:ID_DEF_VAL,cityId:ID_DEF_VAL,countyId:ID_DEF_VAL,townId:ID_DEF_VAL};var viewData=calculateViewData(_store.provinceData,_store.selRegion);tabsComp.updateView(viewData);listComp.updateView(viewData);}
bindListEvent();bindTabsEvent();bindCloseEvent();}
function preloadCityData(option){if(!option.outputCb){window.window.console.warn('[WARN] Option outputCb missing.');return;}
_store.selRegion={provinceId:option.provinceId||ID_DEF_VAL,cityId:option.cityId||ID_DEF_VAL,countyId:option.countyId||ID_DEF_VAL,townId:option.townId||ID_DEF_VAL};loadCityData(_store.selRegion.provinceId,function(){var vd=calculateViewData(_store.provinceData,_store.selRegion);var isValidCompletedIds=false;if((vd.provinceId>0&&vd.provinceName&&vd.cityId>0&&vd.cityName&&vd.countyId>0&&vd.countyName&&vd.townId>0&&vd.townName)||(vd.provinceId>0&&vd.provinceName&&vd.cityId>0&&vd.cityName&&vd.countyId>0&&vd.countyName&&!vd.townData)||(vd.provinceId>0&&vd.provinceName&&vd.cityId>0&&vd.cityName&&!vd.countyData)||(vd.provinceId>0&&vd.provinceName&&!vd.cityData)){isValidCompletedIds=true;}else{isValidCompletedIds=false;}
option.outputCb(formatViewData(vd),isValidCompletedIds);});}
module.exports={provinceData:_store.provinceData,showSelector:showSelector,preloadCityData:preloadCityData,};});
define('wq.assetNew',function(require,exports,module){var $=require('zepto'),loadJs=require('loadJs'),pu=require('payutil'),md5=require('md5'),tpl=require('tpl_wq.assetNew'),addrSelectorV1=require('wq.addrSelectorV1'),loadCgi=pu.loadCgi,myAlert=pu.myAlertV2,myConfirm=pu.myConfirm,myBind=pu.myBind,PayPassObj,redPacket,bean,coupon,card,balance,invoice,loading=$('#wxloading'),isAndroid=navigator.userAgent.indexOf('Android')>-1,isIOS9=(navigator.userAgent.toLowerCase().indexOf('os 9')>-1)?1:0,jdDomain3=function(){var jdDomain=(window.userRouter&&window.userRouter.getHost&&window.userRouter.getHost())||'//wqdeal.jd.com/';return(jdDomain.indexOf('/deal/')<0?jdDomain+'deal/':jdDomain);},domain=jdDomain3(),wa=pu.waReport,cgi={PwdIsActive:'//wq.jd.com/user/info/PwdIsActive',SecurityPwd:'//wq.jd.com/user/info/SecurityPwd',setPassword:'//wqs.jd.com/my/password.shtml',passwordManage:'//wqs.jd.com/my/payPasswordManage.shtml',mSetPassword:'//msc.jd.com/account/loginpage/wcoo/toSecurityPwd?source=4&businessType=0&returnUrl=',ecard_bind:'//wqs.jd.com/my/ecard_bind.html',bindEcardPage:'//wqs.jd.com/my/ecard_bind.html',optimalcoupon:domain+'masset/optimalcoupon',setcouponlist:domain+'masset/setcouponlist',globalPay_setcouponlist:domain+'globalpurchase/setcouponlist',setbean:domain+'masset/setbean',setgiftcard:domain+'masset/setgiftcard',setbalance:domain+'masset/setbalance',getgiftcard:domain+'/masset/giftcardlist',getinvoicelist:domain+'massit/getinvoicelist',saveinvoice:domain+'massit/saveinvoice',delinvoice:domain+'massit/DeleteNormalInvoice',setredpacket:domain+'masset/setredpacket',},g={totalPrice:0,global:JD.url.getUrlParam('global')||'',globalbuy:JD.url.getUrlParam('globalbuy')||'',isGlobalPay:false,maxCoupon:true,isLoadingCard:false,cannotUseCard:false,curCardPage:1,curCardunUsePage:1,cardPageSize:50};if(g.global=='1'||g.globalbuy>0){g.isGlobalPay=true;}
PayPassObj={'need':false,'defaultPin':false,'loadCgi':loadCgi,'myBind':pu.myBind,'doNotOpen':false,'retryTime':0,'on':false,'shortOn':false,'loadCgied':false,'checkShow':function(obj){if(this.defaultPin){return;}
var o=obj;if(o.useJing||o.giftDiscount>0||o.usedJdBean>0||o.usedBalance>0||o.usedJBeanPromo||o.consignCardDiscount>0){this.show();}else{this.hide();}},'show':function(){if(!this.loadCgied){this.hasPayPass(function(){PayPassObj.show();});return;}
if(!this.on&&!this.shortOn){this.showModel();}
this.need=true;this.dom().show();this.inputDiv().show();this.bindEvent();},'dom':function(){return $('#payPass');},'showModel':function(){var that=this,setPasswordCgi=this.getPasswordCgi();if(this.modelShow){return;}
this.modelShow=true;myConfirm({'msg':'<small>为了保障您的资产安全，您需要开通<br>京东支付密码，才能使用京券、余额、<br>礼品卡、京豆等虚拟资产！</small>','icon':'info','okText':'开启','cancelText':'暂不开启','changeBtn':true,'onConfirm':function(){that.modelShow=false;location.href=setPasswordCgi;},'onCancel':function(){that.modelShow=false;}});},'input':function(){if((this.shortOn||(!this.shortOn&&!this.on))&&!this.doNotOpen){return $('#shortPass input');}
return $('#longPass input');},'inputDiv':function(){if((this.shortOn||(!this.shortOn&&!this.on))&&!this.doNotOpen){return $('#shortPass');}
return $('#longPass');},'hide':function(){this.need=false;this.dom().hide();this.input().val('');},'get':function(){return this.input().val();},'getmd5':function(){if(!this.on&&!this.shortOn){loading.hide();this.showModel();return false;}else{if(this.need&&this.checkInput()){return md5.getHash(this.get());}else{return false;}}},'checkInput':function(){if(!this.need){return false;}
var val=this.get(),that=this;if(!val){myAlert({msg:'使用京豆、京券、余额、礼品卡、领货码资产，需输入京东支付密码',onConfirm:function(){that.focus();}});loading.hide();return false;}
return true;},'errStyle':function(){this.dom().find('.input_password').css({borderColor:'#e4393c'});},'resetStyle':function(){this.dom().find('.input_password').css({borderColor:'#cbcbcb'});},'focus':function(){this.input()[0].focus();},'blur':function(){this.input()[0].blur();},'hasPayPass':function(callback){var that=this,_data={};if(pu.isWxUserAgent()){_data.source=5;}else{_data.source=6;}
pu.wrapData(_data);this.loadCgi({'cgi':cgi.PwdIsActive,'cbName':'cbPwdIsActive','data':_data,'showLoading':false,'loginCallback':function(){location.reload();},'success':function(d){that.loadCgied=true;if(d.definePin!=0){that.defaultPin=true;}else{if(d.isLongPwdActive=='1'||d.isShortPwdActive=='1'){if(d.isLongPwdActive=='1'){that.on=true;that.domInput='';}
if(d.isShortPwdActive=='1'){that.shortOn=true;}
if(callback){callback(d,that);}}}},'error':function(id,msg,d){if(that.retryTime<5){that.retryTime++;that.hasPayPass(callback);}else{that.doNotOpen=true;}}});},'getPasswordCgi':function(){var cgiUrl,setUrl,source,pwdflag,rurl=encodeURIComponent(location.href),callback='setPassWordCb';if(pu.isWxUserAgent()){source=5;}else if(pu.isMQQUserAgent()){source=6;}else if(window.mConfirm){return cgi.mSetPassword+rurl+'&sid='+JD.cookie.get('sid');}else{return cgi.setPassword;}
if(this.shortOn){pwdflag=4;cgiUrl=cgi.SecurityPwd;}else if(this.on){pwdflag=2;cgiUrl=cgi.passwordManage;}else if(!this.on&&!this.shortOn){pwdflag=1;cgiUrl=cgi.passwordManage;}
setUrl=cgiUrl+'?source='+source+'&pwdflag='+pwdflag+'&callback='+callback+'&rurl='+rurl+
(window.mConfirm?'&sceneval=2':'')+'&r='+Math.random();setUrl=loadJs.addToken(setUrl,'ls');return setUrl;},'bindEvent':function(){var setPasswordCgi=this.getPasswordCgi();this.myBind({'src':'#resetPassword','fun':function(){location.href=setPasswordCgi;}});$('#copyInput').off('click').on('click',function(){$('#shortPassInput').focus();if(!$('#shortPassInput').val()){$('#copyInput').html('<i class="on"></i>');}});$('#shortPass input').off('input propertychange').on('input propertychange',function(){var inputVal=$(this).val(),length=inputVal.length,dot='',curChar,numReg=/\d/,numsReg=/^[0-9]*$/;if(inputVal){curChar=inputVal[length-1];if(!numReg.test(curChar)){pu.oneLineTip({msg:'数字密码只能输入数字'});$(this).val(inputVal.substr(0,length-1));return;}}
if(inputVal&&!numsReg.test(inputVal)){$(this).val('');return;}
if(length==6){$(this).blur();}
for(var i=0;i<length;i++){dot+='<i></i>';}
if(length<6){dot+='<i class="on"></i>';}
$('#copyInput').html(dot);});},'initModel':function(){if(!this.loadCgied){this.hasPayPass();}}};function barSlider(cl){$('#'+cl+' dt, .item_head').unbind('click').on('click',function(){var p=$(this).parent();if(p.hasClass('on')){p.removeClass('on');}else{p.addClass('on');}});}
function Card(opt){var i,self=this;this.fromBCpage=false;this.userCenterLink='';this.userLevel='';this.action=0;this.platprice='0';this.dom='';this.cardData={};this.usedCallback=function(){};for(i in opt){this[i]=opt[i];}
init();function init(){self.renderHtml();g.curCardPage=1;g.curCardunUsePage=1;g.loadUnuseCard=false;g.cannotUseCard=false;var totalCardNum=self.cardData.cardList.length;if(self.fromBCpage&&totalCardNum===1&&self.cardType=='code'){if(!$("#jdCartPage .cash_coupon li").hasClass("selected")&&$("#jdCartPage .cash_coupon li").length==1){window.setTimeout(function(){$("#jdCartPage .cash_coupon li").click();},100);}}}}
Card.prototype={'renderHtml':function(){var html=tpl.child_tplCardV2(this.cardData),that=this,_type=1,selNum;$('#jdCartPage').html(html).show();selNum=$('#jdCartPage li.selected').length;if(window.mConfirm){$('.buy_ecards_tabs').css('position','static');}
if(this.paging){this.usedNum=this.cardData.cardNumObj.usedNum;}
this.usedNum=this.usedNum||selNum;$('#useCardNum').html(this.usedNum);if(this.cardType=='code'){$('#noCard .mod_empty_page_main').html('您暂时还没有可用的领货码');$('#giftDiscount').html((this.consignCardDiscount/100).toFixed(2));}else{$('#giftDiscount').html((this.giftDiscount/100).toFixed(2));}
if(this.userLevel==0){myConfirm({'msg':'您当前登录的京东账号尚未完善手机号码，请先完善，再绑定'+(this.cardType=='code'?'领货码':'礼品卡!'),'icon':'info','okText':'取消','cancelText':'确定','onCancel':function(){location.href=that.userCenterLink||window.userCenterLink;}});}
if(this.paging&&this.cardData.cardList.length<g.cardPageSize&&this.cardData.cardList.length<this.cardData.cardNumObj.useNum){if(this.cardType=='code'){_type=3;}
g.curCardPage=0;this.loadNextPageCard(_type,true);}
this.bindEvent();barSlider('jdCartPage');},'bindEvent':function(){var self=this;this.bindCardEvent();$('.bindNewCard').unbind('click').bind('click',function(){if(self.scene=='nomal'&&self.cardType=='card'){wa('jdClick',{ptag:'7503.2.5'});}
if(window.mConfirm&&self.cardType!='code'){location.href='//p.m.jd.com/card/optionGiftCard.action?sid='+(JD.cookie.get('sid')||'');return;}
var rUrl=location.href.split('#')[0]+(self.cardType=='code'?'':'&fromBCpage=true')+'#wechat_redirect',bindcardUrl=cgi.bindEcardPage+'?rUrl='+encodeURIComponent(rUrl);if(self.cardType=='code'){bindcardUrl=cgi.ecard_bind+'?type=collar&rUrl='+encodeURIComponent(rUrl);}
if(self.sceneval=='2'){bindcardUrl+='&sceneval=2';}
if(self.userLevel==0){myConfirm({'msg':'您当前登录的京东账号尚未完善手机号码，请先完善，再绑定'+(self.cardType=='code'?'领货码!':'礼品卡!'),'icon':'info','okText':'取消','cancelText':'确定','onCancel':function(){location.href=self.userCenterLink||window.userCenterLink;}});}else{location.href=bindcardUrl;}});$('.buy_ecards_operating_help').off('click').on('click',function(){var cardDesc,card_desc=self.cardType=='code'?'code_desc':'card_desc';if(self.scene=='nomal'&&self.cardType=='card'){wa('jdClick',{ptag:'7503.2.3'});}
pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title==card_desc){cardDesc=d[i];break;}}
pu.showDesc({title:cardDesc.descTitle,desc:cardDesc.extinfo});});});$('#cardNav').off('click').on('click',function(){if($(this).hasClass('selected')){return;}
$('#unuseCardNav').removeClass('selected');$(this).addClass('selected');if(self.paging?self.cardData.cardNumObj.useNum>0:self.cardData.cardList.length>0){$('#cardListUl, #noMoreCard').show();$('#cannotCardUl, #noCard').hide();}else{$('#cardListUl, #cannotCardUl, #noMoreCard').hide();$('#noCard p').html(self.cardType=='code'?'您暂时还没有可用的领货码':'您暂时还没有可用的礼品卡');$('#noCard').show();}
if(self.scene=='nomal'&&self.cardType=='card'){wa('jdClick',{ptag:'7503.2.1'});}
g.cannotUseCard=false;});$('#unuseCardNav').off('click').on('click',function(){var _type=2;if($(this).hasClass('selected')){return;}
$('#cardNav').removeClass('selected');$(this).addClass('selected');if(self.paging?self.cardData.cardNumObj.unuseNum>0:self.cardData.cannotCardList.length>0){$('#cannotCardUl, #noMoreCard').show();$('#cardListUl, #noCard').hide();}else{$('#cardListUl, #cannotCardUl, #noMoreCard').hide();$('#noCard p').html(self.cardType=='code'?'您暂时还没有不可用的领货码':'您暂时还没有不可用的礼品卡');$('#noCard').show();}
if(self.scene=='nomal'&&self.cardType=='card'){wa('jdClick',{ptag:'7503.2.2'});}
g.cannotUseCard=true;if(self.cardType=='code'){_type=4;}
if(self.paging&&self.cardData.cannotCardList.length<g.cardPageSize&&self.cardData.cannotCardList.length<self.cardData.cardNumObj.unuseNum&&!g.loadUnuseCard){g.curCardunUsePage=0;self.loadNextPageCard(_type,true);}});pu.myBind({'src':'#jdcartpageBack','fun':function(e,$this){if(self.scene=='nomal'&&self.cardType=='card'){wa('jdClick',{ptag:'7503.2.6'});}
if(self.callback){self.callback(self.usedNum);}}});},bindCardEvent:function(){var self=this;$('#jdCartPage li').off('click').on('click',function(){var type=$(this).attr('type'),selected=$(this).hasClass('selected'),disabled=$(this).hasClass('type_disabled'),cancelCard=[],useCard=[],data;if(disabled){return false;}
if(self.paging&&!selected&&self.usedNum-self.cardData.cardNumObj.maxNum>=0){pu.oneLineTip({msg:'已超出单笔订单'+(self.cardType=='card'?'E卡':'领货码')+'使用张数上限'});return;}
if(self.scene=='nomal'&&self.cardType=='card'){wa('jdClick',{ptag:'7503.2.4'});}
if(selected){cancelCard.push($(this).attr('couponid')+'|'+$(this).attr('key'));}else{useCard.push($(this).attr('couponid')+'|'+$(this).attr('key'));}
data={use:useCard.join(','),cancel:cancelCard.join(','),type:type||'',action:self.action,querytype:'1',pagesize:self.paging?self.cardData.cardNumObj.useNum:200,pageno:1,reg:'1',callback:'giftCardCb'};if(self.platprice=='1'){data.platprice=1;}
if(self.cardType=='code'){data.querytype='3';data.type='5';data.pagesize=self.paging?self.cardData.cardNumObj.useNum:200;}
pu.wrapData(data);loadJs.loadScript({url:cgi.setgiftcard,data:data});window.giftCardCb=function(d){var i,item,_card,cardLi,useNum=0;if(d.errId!='0'){pu.myAlertV2({msg:d.errMsg});return;}
for(i=0;i<d.giftcardList.length;i++){item=d.giftcardList[i];for(j=0;j<item.giftcard.length;j++){_card=item.giftcard[j];cardLi=$('#jdCartPage li[couponid="'+_card.id+'"]');if(_card.selected=='1'){cardLi.addClass('selected');useNum++;}else{cardLi.removeClass('selected');}}}
self.usedNum=useNum;d.useNum=useNum;self.showCardBottom(d);d.cardChange=true;if(self.usedCallback){self.usedCallback(d);}};});},showCardBottom:function(d){var giftDiscount=(d.order.orderprice.giftDiscount/100).toFixed(2);if(this.cardType=='code'){giftDiscount=(d.order.orderprice.consignCardDiscount/100).toFixed(2);}
$('#useCardNum').html(this.usedNum);$('#giftDiscount').html(giftDiscount);},loadNextPageCard:function(cardType,replaceCard){var self=this,pageno,cardStr='curCardPage',_data;g.isLoadingCard=true;if([1,3].indexOf(cardType)>-1){pageno=g.curCardPage;}else{cardStr='curCardunUsePage';pageno=g.curCardunUsePage;}
pageno++;window.getgiftcardCb=function(d){var html;g.isLoadingCard=false;if(d.errId!=0){g[cardStr]--;}
g[cardStr]++;html=tpl.child_tplCardli({cardList:d.giftcard,cannotUseCard:g.cannotUseCard});if([1,3].indexOf(cardType)>-1){if(replaceCard){$('#cardListUl').html(html);}else{$('#cardListUl').append(html);}}else{g.loadUnuseCard=true;if(replaceCard){$('#cannotCardUl').html(html);}else{$('#cannotCardUl').append(html);}}
self.bindCardEvent();}
_data={action:self.action,querytype:cardType,pagesize:g.cardPageSize,pageno:pageno,callback:'getgiftcardCb',r:Math.random()};pu.wrapData(_data);loadJs.loadScript({url:cgi.getgiftcard,data:_data});}};function cardOnScroll(cardNumObj){var sCArdHeight,totalNum=0,cardType=1,_curCardNum;if(g.isLoadingCard){return;}
sCArdHeight=$($('#cardListUl li')[0]).height();_curCardNum=$('#cardListUl li').length;totalNum=cardNumObj.usableCardNum;if(card.cardType=='code'){totalNum=cardNumObj.usableCollarGoodsNum;cardType=3;}
if(g.cannotUseCard){sCArdHeight=$($('#cannotCardUl li')[0]).height();_curCardNum=$('#cannotCardUl li').length;totalNum=cardNumObj.unableCardNum;cardType=2;if(card.cardType=='code'){totalNum=cardNumObj.unableCollarGoodsNum;cardType=4;}}
if(_curCardNum==totalNum){return;}
if($(window).scrollTop()-$(document).height()+$(window).height()+sCArdHeight*1>0||$(window).scrollTop()==$(document).height()-$(window).height()){card.loadNextPageCard(cardType);}}
function Bean(opt){var i,self=this;this.name='bean';this.dom='';this.type='tab';this.tabTpl='';this.tipTpl='';this.callback=function(){};this.action='';this.platprice='';this.newcoupon='';for(i in opt){this[i]=opt[i];}
if(this.beanData&&this.beanData.total>0){init(this.beanData);this.renderHtml(this.beanData);}else{$(this.dom).remove();}
function init(d){self.jdbean=d;}}
Bean.prototype={'renderHtml':function(d){var html;html=tpl.template(this);$(this.dom).html(html).show();if(this.jdbean.used>0){$('[asset_tag="bean"] .select').html(this.jdbean.used);$('[asset_tag="beanOffset"]').html('抵¥'+(this.jdbean.used/100).toFixed(2));}
if(this.jdbean.usable=='0'){$(this.dom).addClass('disabled');}
if(this.jdbean.usable-0>0&&this.jdbean.chkAuth=='1'){$('#newUserTip').hide();$('#douYellowBar').addClass('dShow').show();$(this.dom+' .buy_select').removeClass('selected');$(this.dom+',#selectBean').addClass('disabled');wa('ptagExposure',{ptag:'7039.1.100'});}
this.bindTabEvent();if(this.initCallback){this.initCallback();}},'bindTabEvent':function(){var self=this;myBind({'src':'#selectBean','fun':function(e,$this){var _optionHtml;if($this.hasClass('disabled')){return;}
_optionHtml=tpl.child_beanSelTpl(self);$('#beanSel').html(_optionHtml).show();$('.mod_alert_mask').show();$('.mod_alert_mask').off('click').on('click',function(){$('#beanSel, .mod_alert_mask').hide();});$('#beanSel i').off('click').on('click',function(){var beanDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='bean_desc'){beanDesc=d[i];break;}}
$('#dou_tip_mask h3').html(beanDesc.descTitle);$('#dou_tip_mask .inner').html(beanDesc.extinfo);$('#dou_tip_mask').show();$('#ui_desc_sure').off('click').on('click',function(){$('#dou_tip_mask').hide();});});});}});$('#beanSel').off('click').on('click','li',function(){var val=$(this).attr('value');$('#beanSel, .mod_alert_mask').hide();self.setBean(val);if(val>0){PayPassObj.show();if(PayPassObj.shortOn&&PayPassObj.get().length!=6){$('#copyInput').click();}else if(PayPassObj.on&&!PayPassObj.get()){PayPassObj.focus();}
window.scrollTo(0,$('#payPass').offset().top-$('#addressDefault').height()-125);}});myBind({'src':'[asset_tag="bean"] .tips_dou','fun':function(e,$this){var beanDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='bean_desc'){beanDesc=d[i];break;}}
pu.showDesc({title:beanDesc.descTitle,desc:beanDesc.extinfo});});}});},'setBean':function(val){var data,self=this;data={use:val,action:this.action,platprice:this.platprice,reg:'0',seq:''};pu.wrapData(data);loadCgi({'cgi':cgi.setbean,'data':data,'success':function(d){$('[asset_tag="beanOffset"]').html('抵¥'+(d.order.jdbean.used/100).toFixed(2));$('[asset_tag="bean"] .select').html(d.order.jdbean.used);self.jdbean=d.order.jdbean;self.callback(d);if(window.mConfirm){pu.pingClick(true,'MNeworder_JdBean','','');}},'error':function(id,errMsg,d){PayPassObj.blur();myAlert({msg:errMsg});}});}};function Balance(opt){var i,self=this;this.name='balance';this.dom='';this.type='tab';this.callback=function(){};this.action='';this.platprice='';for(i in opt){this[i]=opt[i];}
if(this.balanceData&&this.balanceData.balance>0){init(this.balanceData);}else{$(this.dom).remove();}
function init(d){self.balance=d;self.renderHtml();}}
Balance.prototype={'renderHtml':function(){var html=tpl.child_balance(this.balance);$(this.dom).html(html).show();if(this.balance.isChecked=='1'){$('#jdBalanceTab .avaliable').removeClass('disabled');}else{$('#jdBalanceTab .avaliable').addClass('disabled');}
this.bindEvent();},'bindEvent':function(){var self=this;myBind({'src':'#jdBalanceTab .slider_button','fun':function(e,$this){var checked=$('#jdBalanceTab .avaliable').hasClass('disabled');wa('jdClick',{ptag:'7039.1.85'});self.setBalance(checked);if(checked){window.scrollTo(0,480);PayPassObj.show();if(PayPassObj.shortOn&&PayPassObj.get().length!=6){$('#copyInput').click();}else if(PayPassObj.on&&!PayPassObj.get()){PayPassObj.focus();}
window.scrollTo(0,$('#payPass').offset().top-$('#addressDefault').height()-145);}}});},'setBalance':function(checked){var data,self=this,_checked=checked;data={action:this.action,platprice:this.platprice,reg:'0',seq:'',usetype:0};if(_checked){data.usetype=1;}
pu.wrapData(data);loadCgi({'cgi':cgi.setbalance,'data':data,'success':function(d){if(window.mConfirm){pu.pingClick(true,'MNeworder_RestAccount','','');}
self.callback(d);},'error':function(id,errMsg,d){PayPassObj.blur();myAlert({msg:errMsg});}});}};function Coupon(opt){var i,self=this;this.name='coupon';this.dom='';this.action='';this.couponData={};this.platprice=0;this.selected=[];this.selectedArr=[];this._selectedArr=[];this.useCallback=function(){};this.callback=function(){};for(i in opt){this[i]=opt[i];}
init();function init(){if(self.couponData&&self.couponData.unableCouponNum>0){wa('ptagExposure',{ptag:'7039.1.75'});}
if(g.totalPrice!=0&&g.totalPrice!=self.couponData.totalPrice/1+self.couponData.couponDiscount/1){self.priceChange=true;}else{self.priceChange=false;}
g.totalPrice=self.couponData.totalPrice/1+self.couponData.couponDiscount/1;self.renderHtml();}}
Coupon.prototype={'renderHtml':function(){var self=this,html;if(this.couponData.isShowOptimalCoupon=='0'){this.couponData.hideMaxCoupon=true;}
html=tpl.child_jdQuanPageV3Tpl(this.couponData);$(self.dom).html(html).show();if(window.mConfirm){$('#couponTab').parent().removeClass('fixed');}
if(this.unBindEvent){return;}
if(g.maxCoupon&&this.couponData.couponDiscount>0){$('#selMaxCoupon').addClass('selected');}
if(this.couponData.couponListCount<=1||this.couponData.ismiao||this.couponData.booking||this.couponData.hideMaxCoupon){$('.order_coupons_auto.type_disabled').show();}
self.selected=$('#couponlistPage li.selected');self.selected.forEach(function(item){self.selectedArr.push($(item).attr('couponid'));});self.selectedArr.sort();self.bindTabEvent();if(this.couponData.couponListCount==0&&this.couponData.cannotUseCouponListCount>0){$('#cannotcouponLi').click();}},'bindTabEvent':function(){var self=this;$('#unableCouponTip').off('click').on('click',function(){wa('jdClick',{ptag:'7039.1.76'});window.setTimeout(function(){window.scrollTo(0,0);},100);history.back();});if(self.couponData.unableCouponNum>0&&false){window.setTimeout(function(){$('#unableCouponTip').hide();},5000);}
pu.myBind({src:'#selMaxCoupon',fun:function(e,$this){if($this.hasClass('selected')){cancelAll();}else{wa('jdClick',{ptag:'7039.1.103'});selMax();}}});pu.myBind({src:'#couponTab li',fun:function(e,$this){var _id=$this.attr('id');if($this.hasClass('cur')){return;}
$this.addClass('cur').siblings().removeClass('cur');if(_id=='couponLi'){$('#couponlistPage, #selMaxCoupon').show();$('#unUseCouponPage').hide();if($('#selMaxCoupon').length>0){$('.order_coupons_auto.type_disabled').hide();}}else{$('#unUseCouponPage').show();$('.order_coupons_auto.type_disabled').show();$('#couponlistPage, #selMaxCoupon').hide();if(window.mConfirm){pu.pingClick(true,'MNeworder_UnavaliableCoupons','','');}}}});pu.myBind({src:'.couponRule',fun:function(e,$this){var couponDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='coupon_desc'){couponDesc=d[i];break;}}
pu.showDesc({title:couponDesc.descTitle,desc:couponDesc.extinfo});});}});pu.myBind({'src':'#couponlistPage li','isStop':false,'fun':function(e,$this){var tipStr,cancel=[],_data,use=[],key=$this.attr('key'),couponid=$this.attr('couponid'),couponChange=false,batchid=$this.attr('batchid');if($this.find('.coupon_voucher2 ').hasClass('type_disabled')){tipStr=$this.attr('ctype')=='2'?'所结算商品中无京东运费可抵扣':'请先取消已勾选优惠券再进行选择';pu.oneLineTip({msg:tipStr});return;}
$('#selMaxCoupon').removeClass('selected');_data={cancel:'',use:'',all:'',reg:'0',action:self.action,platprice:self.platprice};pu.wrapData(_data);if(self.bizval&&self.bizval!='0'){_data.bizval=self.bizval;_data.sku=self.couponData.skuidList||'';}
if(self.paytypeforpresale){_data.paytypeforpresale=self.paytypeforpresale;}
function useFun(){_data.cancel=cancel.join(',');_data.use=use.join(',');loadCgi({'requestType':'jsonp','cgi':g.isGlobalPay?cgi.globalPay_setcouponlist:cgi.setcouponlist,'data':_data,'success':function(d){if(d.couponList&&d.couponList.length>0){d.couponList.forEach(function(item){var itemLi=$('[couponid="'+item.id+'"]'),itemDiv=$('[couponid="'+item.id+'"] .coupon_voucher2');if(item.selected=='1'){itemLi.addClass('selected');if(itemLi.attr('dcoupon')=='1'){itemDiv.find('.coupon_voucher2_description_title').html('使用该券本单可减<strong>'+(item.discount/100).toFixed(2)+'元</strong>');itemDiv.find('.coupon_voucher2_foot').show();}}else{itemLi.removeClass('selected');}
if(item.readOnly=='1'){itemDiv.find('.coupon_voucher2_description_title').html(item.limitDesc||'不可与已勾选券叠加使用');itemDiv.addClass('type_disabled');itemDiv.find('.coupon_voucher2_info_label').html(item.dongOverlapDesc?('<span>可叠加</span><em>'+item.dongOverlapDesc+'<em>'):'');itemDiv.find('.coupon_voucher2_foot').show();}else{itemDiv.removeClass('type_disabled');if(!(item.selected=='1'&&itemLi.attr('dcoupon')=='1')){itemDiv.find('.coupon_voucher2_foot').hide();}}});}
self.selected=$('#couponlistPage li.selected');if(self.selected.length==0){_selectedArr=[];}
self.selected.forEach(function(item){self._selectedArr.push($(item).attr('couponid'));});self._selectedArr.sort();if(!self.selectedArr.equals(self._selectedArr)){d.couponChange=true;}else{d.couponChange=false;}
self.useCallback&&self.useCallback(d);self.showNewQuanTitle(d);},'error':function(errId,errMsg,d){if(d.useFailed){d.useFailed.split(',').forEach(function(item){if(item){$('[couponid="'+item.split('|')[0]+'"]').removeClass('selected');}});self.selected=$('#jdQuanPage li.selected');}
if(errId=='8782'){myConfirm({'msg':'您当前登录的账号不是京东正式账号，请先完善或绑定，再使用该券','icon':'info','okText':'取消','cancelText':'确定','onCancel':function(){location.href=self.userCenterLink||window.userCenterLink;}});}else{myAlert({msg:errMsg});}}});}
if($this.hasClass('selected')){cancel.push(couponid+'|'+key+'|'+batchid);}else{use.push(couponid+'|'+key+'|'+batchid);}
useFun();}});pu.myBind({src:'#unUseCouponPage',fun:function(e,$this){self.coudan(e,$this);}});pu.myBind({'type':'click','src':'#goBackBuyPage','fun':function(e,$this){if(self.callback){self.callback();}}});function cancelAll(){var _data={cancel:"all",use:"",all:"",reg:"1",action:self.action,platprice:self.platprice,seq:'',callback:'cancelAllCb'};pu.wrapData(_data);if(self.bizval&&self.bizval!='0'){_data.bizval=self.bizval;_data.sku=self.couponData.skuidList||'';}
loadJs.loadScript({url:g.isGlobalPay?cgi.globalPay_setcouponlist:cgi.setcouponlist,data:_data});window.cancelAllCb=function(d){var item,itemLi,itemDiv,i;if(d.errId!=0){$('#selMaxCoupon').addClass('selected');myAlert({msg:'设置失败，请重试'});return;}
$('#selMaxCoupon').removeClass('selected');for(i=0;i<self.couponData.couponList.length;i++){item=self.couponData.couponList[i];itemLi=$('[couponid="'+item.id+'"]');itemDiv=$('[couponid="'+item.id+'"] .coupon_voucher2');itemLi.removeClass('selected');itemDiv.removeClass('type_disabled');itemDiv.find('.coupon_voucher2_foot').hide();}
d.couponChange=true;if(self.useCallback){self.useCallback(d);}
self.showNewQuanTitle(d);};}
function selMax(){var _data;window.optimalcouponCb=function(d){if(d.errId!=0){$('#selMaxCoupon').removeClass('selected');myAlert({msg:'设置失败，请重试'});return;}
$('#selMaxCoupon').addClass('selected');if(d.couponList&&d.couponList.length>0){d.couponList.forEach(function(item){var itemLi=$('[couponid="'+item.id+'"]'),itemDiv=$('[couponid="'+item.id+'"] .coupon_voucher2');if(item.selected=='1'){itemLi.addClass('selected');if(itemLi.attr('dcoupon')=='1'){itemDiv.find('.coupon_voucher2_description_title').html('使用该券本单可减<strong>'+(item.discount/100).toFixed(2)+'元</strong>');itemDiv.find('.coupon_voucher2_foot').show();}}else{itemLi.removeClass('selected');}
if(item.readOnly=='1'){itemDiv.find('.coupon_voucher2_description_title').html(item.limitDesc||'不可与已勾选券叠加使用');itemDiv.addClass('type_disabled');itemDiv.find('.coupon_voucher2_info_label').html(item.dongOverlapDesc?('<span>可叠加</span><em>'+item.dongOverlapDesc+'<em>'):'');itemDiv.find('.coupon_voucher2_foot').show();}else{itemDiv.removeClass('type_disabled');if(!(item.selected=='1'&&itemLi.attr('dcoupon')=='1')){itemDiv.find('.coupon_voucher2_foot').hide();}}});}
d.couponChange=true;if(self.useCallback){self.useCallback(d);}
self.showNewQuanTitle(d,true);};_data={action:self.action,setdefcoupon:'0',reg:'1',seq:'',platprice:self.platprice,callback:'optimalcouponCb'};if(self.bizval){_data.sku=self.couponData.skuidList||'';}
pu.wrapData(_data);if(self.bizval&&self.bizval!='0'){_data.bizval=self.bizval;}
loadJs.loadScript({url:cgi.optimalcoupon,data:_data});}},'coudan':function(e,$this){var _href,t;t=e.target;t=$(t);if(!t.attr('myhref')){t=t.parent();}
if(t.attr('myhref')){_href=t.attr('myhref');wa('jdClick',{ptag:'7039.1.23'});window.setTimeout(function(){location.href=_href;},300);}},'showNewQuanTitle':function(d,selMax){var selected=$('#couponlistPage li.selected');$('#selcouponNum').html(selected.length);if(d.order&&d.order.orderprice){$('#couponDiscount').html((d.order.orderprice.couponDiscount/100).toFixed(2));}
if(selMax){g.maxCoupon=true;}else{g.maxCoupon=false;}}};function Invoice(opt){var i,self=this;this.name='invoice';this.dom='#invoices';this.callback=function(){};this.action='';this.platprice='';this.branch='';this.vatMobileCg=false;this.lineMobileCg=false;for(i in opt){this[i]=opt[i];}
function init(d){var html='',i,l,item,lItem,supArr=[],_mainSkuArr=[],_data,fpLocker,fpdesc,fpYellowDesc='',contentList;html=tpl.child_tplPageInvoices(d);$(self.dom).html(html).show();if(self.containDepot&&window.dealLocker){fpLocker=dealLocker.filter(function(e){return e.mark=='locker_fapiao';});if(fpLocker&&fpLocker[0]&&fpLocker[0].lockvalue=='1'){fpdesc=fpLocker[0].ext;}}
if(self.showfpTip){fpYellowDesc+=self.barDesc+'商品无法开具发票，故发票金额不包括该类商品金额';}
if(fpdesc){fpYellowDesc+=(fpYellowDesc?'<br>':'')+fpdesc;}
if(fpYellowDesc){$('#fapiaoTip p').html(fpYellowDesc);$('#fapiaoTip').show();}
if(self.containDepot&&self.containPop&&d.supportInvoiceType.indexOf(3)>-1){$('#fp_selectInline .tips').html('电子普通发票和纸质普通发票具备同等法律效力，可支持报销入账，非京东自营发票由第三方商家实际开具。');}
if(self.containPop){$('#fp_selectGeneral .tips').html('为响应环保，京东自营全面启用电子普通发票，非京东自营发票由第三方商家实际开具。');}
if(d.isHasKaPop=='1'&&d.supportInvoiceType.indexOf(3)>-1){$('#fp_selectInline .tips').html('为响应环保，京东自营与MUJI全面启用电子普通发票，非京东自营发票由第三方商家实际开具。');}
if(d.isHasKaPop=='1'&&d.supportInvoiceType.indexOf(3)==-1){$('#fp_selectGeneral .tips').html('为响应环保，京东自营与MUJI全面启用电子普通发票，非京东自营发票由第三方商家实际开具。');}
pu.myBind({src:'#fp_selectNone, #fp_selectVat, #fp_selectGeneral, #fp_selectInline',fun:function(e,$this){if($this.attr('class')=='selected'){return;}
$('#fp_general, #fp_vat, #fp_inline').hide();$('#fp_selectNone, #fp_selectGeneral, #fp_selectVat, #fp_selectInline').removeClass('selected');$this.addClass('selected');if($this.attr('id')==='fp_selectNone'){$('#fp_type_bar').html('不开发票');}else if($this.attr('id')==='fp_selectGeneral'){$('#fp_type_bar').html('普通发票');}else if($this.attr('id')==='fp_selectInline'){$('#fp_type_bar').html('电子普通发票');}else{$('#fp_type_bar').html('增值税专用发票');}
if($this.attr('id')=='fp_selectNone'){$('#fp_type_bar').html('不开发票');self.handleNoneFapiao(d);}else if($this.attr('id')=='fp_selectVat'){$('#fp_vat').show();if(d.vat&&d.vat.companyName){self.handleVatFapiao(d);}else{$('#btnBottomConfirmBar').addClass('disabled').off('click');}}else if($this.attr('id')=='fp_selectGeneral'){$('#fp_general').show();self.handleGeneralFapiao(d);}else if($this.attr('id')=='fp_selectInline'){$('#fp_inline').show();if(d.electronic&&d.electronic.electrocompanyName){$('#elecCompName').val(decodeURIComponent(d.electronic.electrocompanyName));}
self.handleInlineFapiao(d);}}});if(typeof d.supportInvoiceType==="object"){for(i=0,l=d.supportInvoiceType.length;i<l;i++){item=d.supportInvoiceType[i];if(item=='0'){$('#fp_selectNone').show();}else if(item=='1'){$('#fp_selectGeneral').show();}else if(window.locker.VATInvoice&&item=='2'){d.showVat='1';$('#fp_selectVat').show();}else if(window.locker.lineInvoice&&item=='3'&&d.electronic){$('#fp_selectInline').show();if(isIOS9){$('#elecIos9Tip').show();}}}}
if(isAndroid){$('#companyList').css('max-height','300px');$('#elecCompanyList').css('max-height','300px');}
$('#compName').focus(function(){$('#companyList').show();}).blur(function(){setTimeout(function(){$('#companyList').hide();},50);});$('#companyList span').unbind('click').bind('click',function(){var compnyName=$(this).attr("value"),invoiceCode=$(this).attr("invoiceCode");$('#compName').val(compnyName);$('#taxerId').val(invoiceCode);});$('#elecCompName').focus(function(){$('#elecCompanyList').show();}).blur(function(){setTimeout(function(){$('#elecCompanyList').hide();},50);});$('#elecCompanyList span').unbind('click').bind('click',function(){var compnyName=$(this).attr("value"),invoiceCode=$(this).attr("invoiceCode");$('#elecCompName').val(compnyName);$('#elecTaxId').val(invoiceCode);});if(window.locker.VATInvoice&&d.showVat=='1'&&d.selectedInvoiceType=='2'){$('#fp_selectVat').click();}else if(window.locker.lineInvoice&&d.selectedInvoiceType=='3'){$('#fp_selectInline').click();}else if(d.selectedInvoiceType=='0'){$('#fp_selectNone').click();}else{$('#fp_selectGeneral').click();}
contentList=d.normalInvoiceVO?d.normalInvoiceVO.invContentList:(d.electronic?d.electronic.invContentList:'');if(contentList){for(i=0;i<contentList.length;i++){lItem=contentList[i];for(l=0;l<lItem.skuList.length;l++){supArr.push(lItem.skuList[l].id);}}}
if(self.skulist&&supArr.length>0){_mainSkuArr=self.skulist.split(',');for(i=0;i<_mainSkuArr.length;i++){if(supArr.indexOf(_mainSkuArr[i])==-1){$('#nosupTip').show();break;}}}
$('#fpContentTip').off('click').on('click','.invoice_popup_btn',function(){$('#fpContentTip').hide();});$('#invoices .order_additional_tips_close').off('click').on('click',function(){$('#invoices .order_additional_tips').hide();JD.store.setItem('fp_additional_tips','1',60*24*365);});JD.store.getItem('fp_additional_tips',function(key,value,errObj){if(value!='1'){$('#invoices .order_additional_tips').css('z-index','0').show();}});$('#invoices input').on('focus',function(){$('#bottomConfirmBar').removeClass('fixed');}).on('blur',function(){$('#bottomConfirmBar').addClass('fixed');});barSlider('invoices');}
if(self.invoiceData){init(self.invoiceData);}else{loading.show();_data={action:self.action,isIOS9:isIOS9};pu.wrapData(_data);if(self.paytypeforpresale){_data.paytypeforpresale=self.paytypeforpresale;}
loadCgi({'cgi':cgi.getinvoicelist,'data':_data,reportCallback:function(id,meg,d){loading.hide();pu.umpReport({bizid:1,operation:30,result:d.errCode,source:'0',message:pu.obj2str2(d)});},'success':function(d){init(d);},'error':function(id,msg,d){myAlert({msg:msg});}});}}
Invoice.prototype={'handleNoneFapiao':function(d){var self=this;$('#btnBottomConfirmBar').removeClass('disabled').attr('href','javascript:void(0);').off('click').on('click',function(){var data={};if(self.noSave){self.noneCallback&&self.noneCallback(data);return;}});},'handleGeneralFapiao':function(d){var savedCompanyNum=d.usualInvoiceList.length,self=this;$('#fpType').off('click').on('click','li',function(e){var t=e.target,_this=$(this),fp_type;if(_this.hasClass('type_noselected')){return;}
if(/input/i.test(t.tagName)){e.preventDefault();}else if(/li/i.test(t.tagName)){fp_type=_this.attr('fp_type');if(fp_type=='4'){$('#compName, #companyList, #taxLi').hide();$('#fpTypeBar').html('个人');}else if(fp_type=='5'){$('#compName, #taxLi').show();$('#fpTypeBar').html('公司');}
_this.parent().find('li').removeClass('selected');_this.addClass('selected');}});$('#fpContent li').off('click').on('click',function(e){var _this=$(this),t=e.target;if(/^rule_icon$/i.test(t.className)){$('#fpContentTip').html(tpl.child_tplFpContentTip(d.normalInvoiceVO.invContentList)).show();return;}
if(_this.hasClass('disabled')){pu.myAlertV2({msg:'请联系对应商家开票',confirmText:'我知道了'});return;}
_this.addClass('selected').siblings().removeClass('selected');$('#fpContent em').html(_this.attr('content_name'));});$('#btnBottomConfirmBar').removeClass('disabled').attr('href','javascript:void(0);').off('click').on('click',function(){var url=cgi.saveinvoice,data,_title,_company,_invoiceCode,_content,_fpId=0,nFp,_contentName;_title=$('#fpType li.selected').attr('fp_type');_company=$('#compName').val().replace(/[\*\/\+\\\$\^\.;<>"={}@%]/g,'');_invoiceCode=$('#taxerId').val().trim()||'';$('#compName').val(_company);_content=$('#fpContent li.selected').attr('content_id');_contentName=$('#fpContent li.selected').attr('content_name');if(!_title){myAlert({msg:'请选择发票类型'});return;}
if(!_content){myAlert({msg:'请选择发票内容'});return;}
if(_title=='5'){if(!pu.checkCompany(_company.trim())){return;}
if(_invoiceCode&&!pu.checkTaxId(_invoiceCode)){return;}}
data={callback:'cbSaveinvoice',type:'1',title:_title,delFlag:0,company:_company,invoiceCode:_invoiceCode,r:Math.random(),isIOS9:isIOS9,action:self.action};if(self.paytypeforpresale){data.paytypeforpresale=self.paytypeforpresale;}
if(_company&&_title=='5'){_fpId=self.getFpId(_company,d.usualInvoiceList);if(_fpId==0&&savedCompanyNum>=10){data.delFlag=1;_fpId=d.usualInvoiceList[savedCompanyNum-1].invoiceTitle=='4'?d.usualInvoiceList[savedCompanyNum-2].id:d.usualInvoiceList[savedCompanyNum-1].id;}}else if(_title=='4'){_fpId=self.getFpId('个人',d.usualInvoiceList,_title);data.company='个人';data.invoiceCode='';if(_fpId==0&&savedCompanyNum>=10){data.delFlag=1;_fpId=d.usualInvoiceList[savedCompanyNum-1].invoiceTitle=='4'?d.usualInvoiceList[savedCompanyNum-2].id:d.usualInvoiceList[savedCompanyNum-1].id;}}
data.id=_fpId;if(_content){data.content=_content;}
pu.wrapData(data);g.fpObj=pu.clone(data);g.fpObj.hasBookSku=d.hasBookSku;g.fpObj.hasCommonSku=d.hasCommonSku;if(self.noSave){self.normalCallback&&self.normalCallback(data);return;}
url=url+'?'+$.param(data);loading.show();loadJs.loadScript(url);window.cbSaveinvoice=function(d){var _type,_content='';loading.hide();pu.umpReport({bizid:1,operation:31,result:d.errCode,source:'0',message:pu.obj2str2(d)});if(d.errCode=='0'){_type=g.fpObj.title=='4'?'个人&nbsp;':decodeURIComponent(g.fpObj.company)+'&nbsp;';if(g.fpObj.content){_content+=_contentName;}
$('#tabInvoices span').html(_type+_content);if(g.fpObj.title=='5'&&!g.fpObj.invoiceCode){$('#taxidTip').show();}else{$('#taxidTip').hide();}
if(self.normalCallback){self.normalCallback(d,g.fpObj);}}else{myAlert({msg:d.errMsg});}};});if(g.fpObj||self.nomalFp){nFp=g.fpObj||self.nomalFp;$('#fpType li[fp_type="'+nFp.title+'"]').trigger('click');if(nFp.content){$('#fpContent li[content_id="'+nFp.content+'"]').trigger('click');}
if(nFp.title=='5'){$('#compName').val(decodeURIComponent(nFp.company||''));$('#taxerId').val(nFp.invoiceCode||'');}}else{$('#fpType li[fp_type="4"]').trigger('click');$('#compName, #taxLi').hide();if(d.normalInvoiceVO.normalInvoiceContentVO.supportContent.length>0&&d.normalInvoiceVO.normalInvoiceContentVO.selectContent){$('#fpContent li[content_id="'+d.normalInvoiceVO.normalInvoiceContentVO.selectContent+'"]').click();}}},'handleVatFapiao':function(d){var _vat=d;var self=this;var curAddrData={};window.newAddrData={};if(d.consignee&&d.consignee.provid>0){curAddrData={provinceId:d.consignee.provid,cityId:d.consignee.cityid,countyId:d.consignee.countyid,townId:d.consignee.townid,};$('#fp_vat #selAddr input').val([d.consignee.province||'',d.consignee.city||'',d.consignee.county||'',d.consignee.town||''].join(''));}
pu.myBind({'type':'focus','src':'#vatMobile','fun':function(e,$this){$('#bottomConfirmBar').removeClass('fixed');if(!self.vatMobileCg&&($this.val()==''||/\d{3}\*{4}\d{4}/.test($this.val()))){$this.val('');}
self.vatMobileCg=true;}});$('#fp_vat #selAddr').off('click').on('click',function(){var containerId='addrSelectorV1';if($('#'+containerId).length===0){var containerDom='<div style="display: none;" id="'+containerId+'"></div>';if($('#wrapBody').length>0){$('#wrapBody').append(containerDom);}else{$('body').append(containerDom);}}
addrSelectorV1.showSelector({pageWrap:containerId,maskProvinceIds:[53283],outputCb:function(data){$('#fp_vat #selAddr input').val([data.provinceName||'',data.cityName||'',data.countyName||'',data.townName||''].join(''));curAddrData.provinceId=data.provinceId;curAddrData.cityId=data.cityId;curAddrData.countyId=data.countyId;curAddrData.townId=data.townId;}});$('#'+containerId).show();});$('#fp_vat #selAddr input').off('focus').on('focus',function(){$(this).blur();});$('#btnBottomConfirmBar').removeClass('disabled').attr('href','javascript:void(0);').off('click').on('click',function(){var url=cgi.saveinvoice;var _content=$('#vatfpContent li.selected').attr('content_id');var _contentName=$('#vatfpContent li.selected').html();var vatAdinfo=$('#vatAdinfo').val();$('#vatMobile').val($('#vatMobile').val().replace(/[ \?\&\~\^\%\$\"\'\u202d\u202c]/g,''));if(!pu.checkForm({name:$('#vatName').val(),mobile:$('#vatMobile').val(),adinfo:vatAdinfo,userModifyMobile:self.vatMobileCg})){return;}
addrSelectorV1.preloadCityData({provinceId:curAddrData.provinceId,cityId:curAddrData.cityId,countyId:curAddrData.countyId,townId:curAddrData.townId,outputCb:function(viewData,isValid){if(!isValid){myAlert({msg:'请选择地市/区县信息。',onConfirm:function(){$('#fp_vat #selAddr').click();}});}else{if(vatAdinfo.replace(/[^\x00-\xff]/g,"aaa").length>150){pu.oneLineTip({msg:'详细地址过长，不能超过50个汉字'});return false;}
var addrid=[]
if(curAddrData.provinceId>0){addrid.push(curAddrData.provinceId);}
if(curAddrData.cityId>0){addrid.push(curAddrData.cityId);}
if(curAddrData.countyId>0){addrid.push(curAddrData.countyId);}
if(curAddrData.townId>0){addrid.push(curAddrData.townId);}
var data={callback:'cbSaveVatinvoice',type:'2',title:'5',name:window.newAddrData.name,phone:window.newAddrData.mobile,addr:window.newAddrData.adinfo,prov:viewData.provinceName,city:viewData.cityName,county:viewData.countyName,town:viewData.townName,addrid:addrid.join('-'),isIOS9:isIOS9,action:self.action};pu.wrapData(data);if(_content){data.content=_content;}
g.vatFpObj=pu.clone(data);g.vatFpObj.hasBookSku=d.hasBookSku;g.vatFpObj.hasCommonSku=d.hasCommonSku;g.vatFpObj.company=d.vat.companyName;if(self.noSave){data.company=_vat.vat.companyName;if(self.vatCallback){self.vatCallback(data);}
return;}
url=url+'?'+$.param(data);loading.show();loadJs.loadScript(url);window.cbSaveVatinvoice=function(d){var _type='增值税发票&nbsp;'+_vat.vat.companyName+'&nbsp;';var _content='';loading.hide();if(d.errCode=='0'){if(data.content){_content+=_contentName;}
$('#tabInvoices span').html(_type+_content);$('#taxidTip').hide();if(self.vatCallback){self.vatCallback(d,g.vatFpObj);}
history.back();}else{myAlert({msg:d.errMsg});}};}}});});$('#vatfpContent').unbind('click').on('click',function(e){var _this=$(this),t=e.target;if(/li/i.test(t.tagName)){_this.find('li').removeClass('selected');$(t).addClass('selected');_this.find('em').html($(t).html());}});if(d.vat.normalInvoiceContentVO.supportContent.length>0&&d.vat.normalInvoiceContentVO.selectContent){d.vat.normalInvoiceContentVO.selectContent=1;$('#vatfpContent li[content_id="'+d.vat.normalInvoiceContentVO.selectContent+'"]').click();}},'handleInlineFapiao':function(d){var savedCompanyNum=d.usualInvoiceList.length,self=this,lFp;$('#elecFpType').unbind('click').on('click','li',function(e){var t=e.target,_this=$(this),elecfp_type;if(_this.hasClass('type_noselected')){return;}
if(/input/i.test(t.tagName)){e.preventDefault();}else if(/li/i.test(t.tagName)){elecfp_type=_this.attr('elecfp_type');if(elecfp_type=='4'){$('#elecCompName, #elecCompanyList, #elecTaxLi').hide();$('#elecFpTypeBar').html('个人');}else if(elecfp_type=='5'){$('#elecCompName, #elecTaxLi').show();$('#elecFpTypeBar').html('公司');}
_this.parent().find('li').removeClass('selected');_this.addClass('selected');}});pu.myBind({src:'#line_fpContent li',fun:function(e,$this){var t=e.target;if(/^rule_icon$/i.test(t.className)){$('#fpContentTip').html(tpl.child_tplFpContentTip(d.electronic.invContentList)).show();return;}
if($this.hasClass('disabled')){pu.myAlertV2({msg:'请联系对应商家开票',confirmText:'我知道了'});return;}
$this.addClass('selected').siblings().removeClass('selected');$('#line_fpContent em').html($(t).attr('content_name'));}});pu.myBind({'type':'focus','src':'#lineVoiceMobile','fun':function(e,$this){$('#bottomConfirmBar').removeClass('fixed');if(!self.lineMobileCg&&($this.val()==''||/\d{3}\*{4}\d{4}/.test($this.val()))){$this.val('');}
self.lineMobileCg=true;}});$('#btnBottomConfirmBar').removeClass('disabled').attr('href','javascript:void(0);').unbind('click').on('click',function(){var url=cgi.saveinvoice,data,_title,_invoiceCode,_content,_mobile,_email,_title,_company,_fpId=0,_contentName;$('#lineVoiceMobile').val(($('#lineVoiceMobile').val()||'').replace(/[ \?\&\~\^\%\$\"\'\u202d\u202c]/g,''));_mobile=$('#lineVoiceMobile');_email=$('#lineVoiceEmial');_title=$('#elecFpType li.selected').attr('elecfp_type');_company=$('#elecCompName').val().replace(/[\*\/\+\\\$\^\.;<>"={}@%]/g,'');_invoiceCode=$('#elecTaxId').val().trim()||'';$('#elecCompName').val(_company);_content=$('#line_fpContent li.selected').attr('content_id');_contentName=$('#line_fpContent li.selected').attr('content_name');if(_title=='5'&&!_company){myAlert({msg:'请填写公司名称'});return;}
if(_title=='5'){if(!pu.checkCompany(_company.trim())){return;}
if(_invoiceCode&&!pu.checkTaxId(_invoiceCode)){return;}}
if(!pu.isMobile($.trim(_mobile.val()),self.lineMobileCg)&&self.branch!='watson'){myAlert({msg:'请选填写正确的手机号'});return;}
if(!(/^[^@]+@[^@]+$/.test($.trim(_email.val()))||_email.val()=='')&&self.branch!='watson'){myAlert({msg:'请选填写正确的邮箱'});return;}
if(!_content&&self.branch!='watson'){myAlert({msg:'请选择发票内容'});return;}
if(_company&&self.branch!='watson'){_fpId=self.getFpId(_company,d.usualInvoiceList);}
data={type:'3',title:_title,id:_fpId,action:self.action,delFlag:0,company:_company,invoiceCode:_invoiceCode,phone:_mobile.val(),email:_email.val(),isIOS9:isIOS9};if(_company&&_title=='5'){_fpId=self.getFpId(_company,d.usualInvoiceList);if(_fpId==0&&savedCompanyNum>=10){data.delFlag=1;_fpId=d.usualInvoiceList[savedCompanyNum-1].invoiceTitle=='4'?d.usualInvoiceList[savedCompanyNum-2].id:d.usualInvoiceList[savedCompanyNum-1].id;}}else if(_title=='4'){_fpId=self.getFpId('个人',d.usualInvoiceList,_title);data.company='个人';data.invoiceCode='';if(_fpId==0&&savedCompanyNum>=10){data.delFlag=1;_fpId=d.usualInvoiceList[savedCompanyNum-1].invoiceTitle=='4'?d.usualInvoiceList[savedCompanyNum-2].id:d.usualInvoiceList[savedCompanyNum-1].id;}}
data.id=_fpId;if(_content){data.content=_content;}
if(_title!='5'){data.company='';data.invoiceCode='';}
pu.wrapData(data);g.lineFpObj=pu.clone(data);g.lineFpObj.hasBookSku=d.hasBookSku;g.lineFpObj.hasCommonSku=d.hasCommonSku;if(self.noSave){self.lineCallback&&self.lineCallback(data);return;}
loading.show();pu.loadCgi({cgi:cgi.saveinvoice,data:data,reportCallback:function(id,meg,d){pu.umpReport({bizid:1,operation:54,result:id,source:'0',message:pu.obj2str2(d)});},success:function(d){var _type='电子发票 个人 ',_content='';_type=g.lineFpObj.title=='4'?'电子发票 个人&nbsp;':'电子发票 &nbsp'+decodeURIComponent(g.lineFpObj.company)+'&nbsp;';if(data.content){_content+=_contentName;}
$('#tabInvoices span').html(_type+_content);if(g.lineFpObj.title=='5'&&!g.lineFpObj.invoiceCode){$('#taxidTip').show();}else{$('#taxidTip').hide();}
self.lineCallback&&self.lineCallback(d,g.lineFpObj);},error:function(id,msg,d){myAlert({msg:msg});}});});if(g.lineFpObj||self.lineFp){lFp=g.lineFpObj||self.lineFp;$('#elecFpType li[elecFp_type="'+lFp.title+'"]').trigger('click');if(lFp.content){$('#line_fpContent li[content_id="'+lFp.content+'"]').trigger('click');}
if(lFp.title=='5'){$('#elecCompName').val(decodeURIComponent(lFp.company));$('#elecTaxId').val(lFp.invoiceCode);}
if(g.lineFpObj){$('#lineVoiceMobile').val(lFp.phone);$('#lineVoiceEmial').val(lFp.email);}else{$('#lineVoiceMobile').val(d.electronic.invoiceExtVO.invoiceConsigneePhone);$('#lineVoiceEmial').val(d.electronic.invoiceExtVO.invoiceConsigneeEmail);}}else{$('#elecFpType li[elecFp_type="4"]').trigger('click');if(d.electronic.normalInvoiceContentVO.supportContent.length>0&&d.electronic.normalInvoiceContentVO.selectContent){$('#line_fpContent li[content_id="'+d.electronic.normalInvoiceContentVO.selectContent+'"]').click();}}},'getFpId':function(_company,usualInvoiceList,_title){if(usualInvoiceList&&usualInvoiceList.length==0){return 0;}
if(_title&&_title=='4'){for(var i=0;i<usualInvoiceList.length;i++){if(usualInvoiceList[i].invoiceTitle==_title&&_company==usualInvoiceList[i].usualInvoiceName){return usualInvoiceList[i].id;}}}else{for(var i=0;i<usualInvoiceList.length;i++){if(_company==usualInvoiceList[i].usualInvoiceName){return usualInvoiceList[i].id;}}}
return 0;}}
function RedPacket(opt){var domWrapId=opt.dom;var data=opt.data;var action=opt.action;var platprice=opt.platprice;var selRedPacketCb=opt.selRedPacketCb;if(!data){return;}
renderTab(domWrapId,data);$(domWrapId+'[asset_tag="redPacket"] .tips_dou').off('click').on('click',function(){pu.loadPPMSData(function(d){var ppms=d.filter(function(it){return it.title=='redPacket_desc';})[0];if(ppms){pu.showDesc({title:ppms.descTitle,desc:ppms.extinfo});}});});$(domWrapId+'[asset_tag="redPacket"] select').off('change').on('change',function(e){var val=$(e.currentTarget).val();var cgiURL=cgi.setredpacket;var cgiData={callback:'setredpacketCb',selected:val,action:action,platprice:platprice,};pu.wrapData(cgiData);window[cgiData.callback]=function(rsp){if(rsp.errId=='0'){var orderprice=(rsp&&rsp.order&&rsp.order.orderprice)||{};var redpacket=(rsp&&rsp.order&&rsp.order.redpacket)||{};var nData={orderRedPacketUsedBalance:orderprice.orderRedPacketUsedBalance};for(var key in redpacket){nData[key]=redpacket[key];}
renderTab(domWrapId,nData);selRedPacketCb(rsp);}};loadJs.loadScript({url:cgiURL,data:cgiData});});function renderTab(domWrapId,data){var total=data.redPacketTotalBalance||0;if(total>0){var temp=tpl.child_redPacket({discount:data.orderRedPacketUsedBalance||0,selVal:data.selectRedPacket||0,canUse:data.redPacketTotalUsableBalance||0,total:total,});$(domWrapId).html(temp).show();}else{$(domWrapId).hide();}}}
exports.init=function(obj){function handle(item){var o;switch(item.name){case'card':card=new Card(item);break;case'redPacket':redPacket=new RedPacket(item);break;case'bean':bean=new Bean(item);break;case'coupon':coupon=new Coupon(item);break;case'balance':balance=new Balance(item);break;case'invoice':invoice=new Invoice(item);break;default:break;}}
obj.forEach(function(item){handle(item);});};exports.initPayPass=function(){PayPassObj.initModel();return PayPassObj;};exports.cardOnScroll=cardOnScroll;exports.refreshCgi=function(obj){for(var name in obj){cgi[name]=obj[name];}}
exports.setGByName=function(obj){g[obj.name]=obj.value;}
exports.getGByName=function(name){return g[name];}});
define('wq.addr.commonV2',function(require,exports,module){var $=require("zepto");var loadJs=require('loadJs');var pu=require('payutil');var qqAddr=require('qqAddr');var payAddrTpl=require('tpl_s_confirm_payAndAddr');var cookies=window.JD.cookie;var wa=window.wa;var JD=window.JD;var addrSelectorV1=require('wq.addrSelectorV1');var g={uin:cookies.get('wq_uin')||cookies.get('p_uin')||cookies.get('uin'),wq_addr:cookies.get('wq_addr')||'',wxAddrScene:'',loadDefAddr:false,loading:$('#wxloading'),dfLabel:['家','公司','学校'],wxAddrLoadCount:0,bindedMqqEvent:false,userModifyMobile:false,haveshowAddrTip:false,lockSuggest:false,loadSuggestaddr:false,newLabel:false,defAddrLocker:false,};g.shipAddrData={shipAddrList:[],};var jdDomian3='//wqdeal.jd.com/deal/';var cgi={defaultAddrV3:jdDomian3+'recvaddr/getrecvaddrV3',modifyrecvaddr4jd:jdDomian3+'recvaddr/modifyrecvaddr4jd',getrecvaddrlistV3:jdDomian3+'recvaddr/getrecvaddrlistV3',getJd3LAddr:jdDomian3+'recvaddr/getjd3laddr',addRecvAddr4JDV2:jdDomian3+'recvaddr/addrecvaddr4jdv2',delrecvaddr4jd:jdDomian3+'recvaddr/delrecvaddr4jd',delrecvaddr:jdDomian3+'recvaddr/delrecvaddr',getprovince:jdDomian3+'recvaddr/getprovince',suggestion:'//apis.map.qq.com/ws/place/v1/suggestion',sugReport:'//apis.map.qq.com/data_report/upload'};var nextDom;var addrToTitle;var callback;var failCallback;var ump_showaddresslist;var addrCgiErrTimer;var myAlert=pu.myAlertV2;var myConfirm=pu.myConfirm;window.param={getDefaultAddr:false,needChangeAddr:false,changeAddrInList:false,addAddrFromPayPage:false,hasDefAddr:true,getReceveV3:false,updateAddrInPay:false,notContainDefAddr:false,idCardErrMsg:'',userAction:[],};if(window.dealLocker){var addrLocker=dealLocker.filter(function(e){return e.mark=='addr_gray_locker';});if(addrLocker&&addrLocker[0]&&addrLocker[0].lockvalue=='1'){g.defAddrLocker=addrLocker[0].scale-((g.uin||'').substr(-2)||100)>0;}}
function Address(addrOpt){var self=this,defData=pu.getDefAddrFromWqAddr(),_data;if(addrOpt.addrToTitle){addrToTitle=addrOpt.addrToTitle;}
if(addrOpt.nextDom){nextDom=addrOpt.nextDom;}
if(addrOpt.callback){callback=addrOpt.callback;}
if(addrOpt.failCallback){failCallback=addrOpt.failCallback;}
if(!addrOpt.addrObj){g.loading.show();g.lockSuggest=true;addrCgiErrTimer=window.setTimeout(function(){pu.delAddrCookie();},2.5e3);_data={callback:'cbLoadJdDefAddr',sid:g.sid||'',adid:defData[0]||'0',reg:'1',type:'1'};pu.wrapData(_data);loadJs.loadScript({url:cgi.defaultAddrV3,data:_data});window.cbLoadJdDefAddr=function(json){clearTimeout(addrCgiErrTimer);var addrObj={};g.loadDefAddr=true;g.loading.hide();window.param.needChangeAddr=false;if(json.errCode=='0'&&json.list.length>0){addrObj=json.list[0];addrObj.jdaddrid=json.jdaddrid;addrObj.jdaddrname=json.jdaddrname;window.param.hasDefAddr=true;window.param.getReceveV3=true;init(addrObj);self.showDefAddr();if(self.callback){self.callback();}}else if(json.errCode+''==='0'&&json.list.length===0){init(addrObj);window.addressObj.showNullAddr();if(self.callback){self.callback();}}else if(json.errCode=='13'){checklogin(json.nextUrl);}else{myAlert({msg:'获取收货地址失败，请稍后再试！'});if(failCallback){failCallback();}}
if(addrOpt.addrCB){addrOpt.addrCB(json);}};}else{init(addrOpt.addrObj);}
function init(opt){self.type=opt.type||'1';self.div=null;self.rgId=opt.rgid||'';self.idCard=opt.idCard||'';self.divId='sendTo';self.adid=opt.adid||'';self.provinceId=opt.provinceId||opt.jd_provinceId||"";self.cityId=opt.cityId||opt.jd_cityId||"";self.countyId=opt.countyId||opt.jd_countyId||"";self.townId=opt.townId||"";self.provinceName=opt.provinceName||'';self.cityName=opt.cityName||'';self.countyName=opt.countyName||'';self.townName=opt.townName||'';self.jdaddrid=opt.jdaddrid;self.jdaddrname=opt.jdaddrname;self.rginfo=opt.rginfo||'';self.longitude=opt.longitude;self.latitude=opt.latitude;self.addrdetail=opt.addrdetail||'';self.addrfull=opt.addrfull||'';self.mobile=opt.mobile||'';self.name=opt.name||'';self.level=opt.level||'';self.canCreateDeal=opt.canCreateDeal||true;self.need_upgrade=opt.need_upgrade||'0';self.default_address=opt.default_address||'0';self.label=opt.label||'';self.areacode=opt.areacode||'';self.namecode=opt.namecode||'';self.phone=opt.phone||'';self.email=opt.email||'';self.postcode=opt.postcode||'';self.callback=callback||function(){};self.nextDom=nextDom;self.addrToTitle=addrToTitle||'';if(self.level==''){if(self.cityId==''||self.cityId=='0'){self.level='1';}else if(self.countyId==''||self.countyId=='0'){self.level='2';}else if(self.townId==''||self.townId=='0'){self.level='3';}else{self.level='4';}}
var aArray;if(self.type=='1'&&self.provinceId){aArray=self.jdaddrname.split('_');self.provinceName=aArray[0];self.cityName=aArray[1];self.countyName=aArray[2];}else if(self.type=='2'){self.addrfull=self.provinceName+self.cityName+self.countyName+self.addrdetail;}
if(pu.isMQQUserAgent()&&window.locker.SupMQAddr&&!g.bindedMqqEvent){g.bindedMqqEvent=true;var fn=function(){qqAddr.init().data.listen(function(data,source){self.handleMQQAddr(data,source);});};JD.sqapi.ready(fn);}}}
Address.prototype={showDefAddr:function(obj){var html,wq_addr,self=this;if(window.addressObj.need_upgrade=='1'){if(g.loadDefAddr){myAlert({msg:'因京东地址库升级，您选择的地址现已失效，会导致商品库存信息不准确或商品无法配送，请及时修改。',onConfirm:function(){self.updateInpay.apply(self,[]);},confirmText:'修改地址'});}else{self.updateInpay();}}else if(obj&&(obj.fromt=='weixin'||obj.fromt=='qq')){this.wxToJdInPayUpdate(obj.fromt);}
html=payAddrTpl.child_tplAddressDefault();$('#addressNull, #addressNullV2').hide();$('#addressDefault').html(html).show().unbind('click');if(['32','52993','53283'].indexOf(window.addressObj.provinceId)>-1){if(window.addressObj.provinceId=='52993'&&window.addressObj.cityId=='52994'){$('#globalSalTip').html('收货地址为住宅时，需向配送员支付住宅附加费:20港币/单');}
$('#globalSalTip').show();}
if(this.nextDom){$(this.nextDom).css('margin-top',$('#addressDefault').height()+15);if($('#topFixedDiv').length>0){$('#topFixedDiv').addClass('fixed');}else{$('#addressDefault').addClass('fixed');}}else{$('#topFixedDiv').css('height',$('#addressDefault').height());}
if(this.type=='1'){wq_addr=this.adid+'|'+this.jdaddrid+'|'+this.jdaddrname+'|'+this.addrfull+'|'+
(this.longitude&&this.latitude?(this.longitude||'')+','+(this.latitude||''):'');pu.setAddrCookie(this.adid,wq_addr,!g.defAddrLocker||this.default_address=='1');}
if(window.locker.SupWxAddr&&this.type=='2'&&g.wxAddrScene=='pay'){$('#addressDefault').bind('click',function(){if(window.param.addrSlide){self.showAddressSlide();}else{g.wxAddrScene='pay';self.getDataForloadWxAddress();}});}else{this.bindDefAddr();}},bindDefAddr:function(){var self=this;$('#idcardEditArea').off('click').on('click',function(e){e.preventDefault();e.stopPropagation();});$('#editIdcard').off('click').on('click',function(e){e.preventDefault();e.stopPropagation();$(this).parent().hide();$('#idCardErrTip').removeClass('color_red');$('#idcardInfo').val(self.idCard);$('#saveUserIdcard').html('取消');$('#idcardEditArea').show();$('#topFixedDiv').css('height',$('#addressDefault').height());});$('#idcardInfo').off('focus').on('focus',function(e){$('#saveUserIdcard').html('保存');if(/\d{4}\*+\d{3}[0-9xX]/.test($(this).val())){$('#saveUserIdcard').addClass('disable');$(this).val('');}});$('#clearIdcard').off('click').on('click',function(e){$('#saveUserIdcard').html('保存');$('#idcardInfo').val('');});$('#idcardInfo').off('input propertychange').on('input propertychange',function(e){if(!$(this).val().trim()){$('#saveUserIdcard').addClass('disable');}else{$('#saveUserIdcard').removeClass('disable');$('#idcardEditArea').removeClass('warn');}});$('#saveUserIdcard').off('click').on('click',function(e){var checkMsg,idcardVal=$('#idcardInfo').val().trim();if($(this).hasClass('disable')){return;}
if(window.__g.isGlobalPay&&['53283'].indexOf(self.provinceId)>-1){pu.oneLineTip({msg:'海囤全球商品暂不支持当前地址下单~'});return;}
if((/\d{4}\*+\d{3}[0-9xX]/.test(idcardVal)&&self.idCard)||$('#saveUserIdcard').html()=='取消'){$('#editIdcard').parent().show();$('#idcardEditArea').hide();$('#topFixedDiv').css('height',$('#addressDefault').height());return;}
checkMsg=pu.checkUserId(idcardVal);if(checkMsg){pu.oneLineTip({msg:checkMsg});$('#idcardEditArea').addClass('warn');return;}
window.param.updateAddrInPay=true;self.idCard=idcardVal;self.saveToJd('',self.adid,'idcard');});$('#addressDefault').bind('click',function(){if(window.param.addrSlide){self.showAddressSlide();if(window.mConfirm){pu.pingClick(true,'MNeworder_Address','','FromNoReg');}}else{wa('jdClick',{ptag:'7387.2.1'});goPage('addressList');if(window.mConfirm){pu.pingClick(true,'MNeworder_Address','','');}}});},showNullAddr:function(){var self=this;pu.delAddrCookie();$('#addressDefault').hide();window.param.hasDefAddr=false;if(window.addrNullV2){this.showAddAddressPage('1');}else{$('#addressNull').off('click').on('click',function(){window.param.addAddrFromPayPage=true;window.param.userAction.push(this.id);goPage('pageAddAddress');}).show();if(this.nextDom){$(this.nextDom).css('margin-top','15px');}
if(g.haveshowAddrTip)return;g.haveshowAddrTip=true;myConfirm({msg:'您还没有可用配送地址，是否新建一个配送地址？',cancelText:'新建',okText:'取消',onConfirm:function(){},onCancel:function(){window.param.addAddrFromPayPage=true;self.addAddrByCk();}});}},handleWxAddress:function(){this.addrfull=this.provinceName+this.cityName+this.countyName+this.addrdetail;this.showDefAddr({'fromt':'weixin'});goPage('pagePay');},handleQQAddress:function(){this.addrfull=this.provinceName+this.cityName+this.countyName+this.addrdetail;this.showDefAddr({'fromt':'qq'});goPage('pagePay');},saveToJd:function(level,adid,from){var countyId,countyName,townId,townName,noGlobal='noGlobal';if(level==3){countyId=window.addressObj._countyId;countyName=window.addressObj._countyName;townId=this.townId;townName=this.townName;this.rgId='';}else if(level==4){countyId=this.countyId;countyName=this.countyName;townId=window.addressObj._townId;townName=window.addressObj._townName;}else{countyId=this.countyId;countyName=this.countyName;townId=this.townId;townName=this.townName;}
if(from='idcard'){noGlobal='';}
var provinceName=this.provinceName;if(this.provinceId&&addrSelectorV1.provinceData[this.provinceId]){provinceName=addrSelectorV1.provinceData[this.provinceId][0];}
window.newAddrData={rgid:this.rgId,provinceId:this.provinceId,provinceName:provinceName,cityId:this.cityId,cityName:this.cityName,countyId:countyId,countyName:countyName,townId:townId,townName:townName,name:this.name,mobile:this.mobile,adinfo:this.addrdetail,updateLevel:level,areacode:this.areacode,namecode:this.namecode,phone:this.phone,email:this.email,postcode:this.postcode,idcard:this.idCard||'',};this.handleActionAddr(adid,noGlobal,from);},wxToJdInPayUpdate:function(fromt){if(!this.rgId){return;}
var self=this,_data;window.cbGetJd3LAddr=function(d){g.loading.hide();var i;if(d.errCode=='0'){for(i in d.info){window.addressObj[i]=d.info[i];}
if(d.info.need_upgrade=='1'){window.addressObj.need_upgrade='1';window.addressObj.updateInpay(fromt);}else{var provinceName=window.addressObj.provinceName;if(window.addressObj.provinceId&&addrSelectorV1.provinceData[window.addressObj.provinceId]){provinceName=addrSelectorV1.provinceData[window.addressObj.provinceId][0];}
window.addressObj.addrfull=provinceName+window.addressObj.cityName+window.addressObj.countyName+window.addressObj.townName+window.addressObj.addrdetail;window.addressObj.saveToJd(undefined,undefined,fromt);}}else{myAlert({msg:'收货地址升级失败：'+d.msg,onConfirm:function(){self.callback();}});}};g.loading.show();_data={rgid:this.rgId,callback:'cbGetJd3LAddr'};pu.wrapData(_data);loadJs.loadScript({url:cgi.getJd3LAddr,data:_data});},updateInpay:function(fromt){this.canCreateDeal=false;if(this.level=='4'||this.provinceId==''||(this.level=='3'&&!this.countyName)||(fromt!='weixin'&&fromt!='qq')){window.param.addAddrFromPayPage=true;this.editAddr(this.adid,'1',this);return;}
var that=this;addrSelectorV1.preloadCityData({provinceId:this.provinceId,outputCb:function(data){var addrProData=data.cityData;if(!addrProData){window.param.addAddrFromPayPage=true;goPage('pageAddAddress');return;}
var html='',optionHtml='',optionObj=null,i;try{if(that.level=='3'){if(!addrProData[that.cityId]||!addrProData[that.cityId][1]||!addrProData[that.cityId][1][that.countyId]){window.param.addAddrFromPayPage=true;that.editAddr(that.adid,'1',that);return;}
optionObj=addrProData[that.cityId][1][that.countyId][1];}else if(that.level=='2'){if(!addrProData[that.cityId]){window.param.addAddrFromPayPage=true;that.editAddr(that.adid,'1',that);return;}
optionObj=addrProData[that.cityId][1];}
for(i in optionObj){if(typeof optionObj[i]==='object'){optionHtml+='<option value="'+i+'">'+optionObj[i][0]+'</option>';}else{optionHtml+='<option value="'+i+'">'+optionObj[i]+'</option>';}}
that.optionHtml=optionHtml;html=payAddrTpl.child_tplAddressNeedUpdate(that);$('#addressDefault').html(html);if(that.nextDom){$(that.nextDom).css('margin-top',$('#addressDefault').height()+15);if($('#topFixedDiv').length>0){$('#topFixedDiv').addClass('fixed');}else{$('#addressDefault').addClass('fixed');}}else{$('#topFixedDiv').css('height',$('#addressDefault').height());}
$('#addressDefault select, #addressDefault i').off('click').on('click',function(e){e.stopPropagation();});$('#townSelect').off('change').on('change',function(){if(this.value=='0'){return;}
var adid=$(this).attr('adid');window.param.updateAddrInPay=true;window.addressObj._townId=this.value;window.addressObj._townName=$(this).find('option[value="'+this.value+'"]').html();window.addressObj.saveToJd(4,adid);});$('#countySelect').off('change').on('change',function(){if(this.value=='0'){return;}
var adid=$(this).attr('adid');window.param.updateAddrInPay=true;window.addressObj._countyId=this.value;window.addressObj._countyName=$(this).find('option[value="'+this.value+'"]').html();window.addressObj.saveToJd(3,adid);});html=undefined;}catch(e){}}});},handleAdid:function(adid){return adid.replace(/u/g,'');},mQQCodGuide:function(addrObj){var self=this;$('#btnCodPay3LAddr').show();$('#btnCodPay3LAddr').unbind('click').on('click',function(){window.param.userAction.push(this.id);myAlert({msg:'请完善地址信息。',onConfirm:function(){window.param.addAddrFromPayPage=true;self.editAddr(addrObj.adid,addrObj.type,addrObj);}});});},handleActionAddr:function(adid,flag,from){var _cgi,data,self=this,wq_addrArr=[],newAddr=window.newAddrData,spaceWord='',addrfull;window.cbHandleRecvAddr=function(json){g.loading.hide();pu.umpReport({bizid:1,operation:37,result:json.errCode,source:'0',message:pu.obj2str2(json)});if(json.errCode=='0'){g.loading.hide();window.param.getDefaultAddr=false;$('#idCardTips').show();if(g.newLabel){wa('jdClick',{ptag:'7387.4.5'});if(g.dfLabel.indexOf(data.label)>-1){wa('jdClick',{ptag:'7387.4.6'});}else if(data.label){wa('jdClick',{ptag:'7387.4.7'});}}
if(adid&&!json.adid){json.adid=adid;}
if(json.adid){adid=json.adid;}else if(window.editAddrData&&window.editAddrData.adid){adid=window.editAddrData.adid;}
wq_addrArr[0]=adid||'0';wq_addrArr[1]=[newAddr.provinceId,newAddr.cityId,newAddr.countyId,newAddr.townId].join('_');wq_addrArr[2]=[newAddr.provinceName,newAddr.cityName,(newAddr.countyName||''),(newAddr.townName||'')].join('_');wq_addrArr[3]=(wq_addrArr[1]+wq_addrArr[2]).replace(/_/g,'')+newAddr.adinfo;pu.setAddrCookie(adid,wq_addrArr.join('|'));if(window.addressObj){window.addressObj.adid=json.adid;}
if(!window.param.updateAddrInPay&&!from){window.param.needChangeAddr=true;self.updateAddrToPay();window.param.updateAddrInPay=false;}else{if(window.newAddrData&&window.newAddrData.updateLevel=='3'){window.addressObj.countyId=window.addressObj._countyId;window.addressObj.countyName=window.addressObj._countyName;window.addressObj.level=window.newAddrData.updateLevel;$('#countySelect').attr('adid',json.adid);}else if(window.newAddrData&&window.newAddrData.updateLevel=='4'){window.addressObj.townId=window.addressObj._townId;window.addressObj.townName=window.addressObj._townName;window.addressObj.level=window.newAddrData.updateLevel;$('#townSelect').attr('adid',json.adid);}
if(window.addressObj&&window.addressObj.type!='1'){window.addressObj.adid=json.adid;window.addressObj.type='1';}
if(window.addressObj){window.addressObj.canCreateDeal=true;}
window.param.needChangeAddr=true;if(self.callback){self.callback();}}
window.editAddrData=undefined;window.newAddrData=undefined;}else if(json.errCode=='13'){checklogin(json.nextUrl);return;}else if(json.errCode=='4608 '){myAlert({msg:'地址请求有误，请重新刷新页面。'});return;}else if(json.errCode=='9034'){pu.oneLineTip({msg:json.errMsg||'您输入的身份证号码与姓名不匹配'});return;}else if(json.msg&&json.msg.indexOf('mobile is not right')>-1){myAlert({msg:'电话号码填写有误！'});return;}else{try{pu.umpReport({bizid:1,operation:91,result:json.errCode,source:'0',message:pu.obj2str2(data)});}catch(e){}
if(json.errCode=='4'){myAlert({msg:json.msg,onConfirm:function(){history.back();}});}
myAlert({msg:'系统忙，请稍后再试！'});}
if(from&&from=="weixin"){if(self.callback){self.callback();}}};if(newAddr.provinceId=='53283'){spaceWord=' ';}
addrfull=newAddr.provinceName+newAddr.cityName+spaceWord+(newAddr.countyName||'')+
(newAddr.townName||'')+(newAddr.adinfo||'');data={callback:'cbHandleRecvAddr',rgid:'',name:encodeURIComponent(newAddr.name),mobile:newAddr.mobile,addrdetail:encodeURIComponent(newAddr.adinfo),addrfull:encodeURIComponent(addrfull),addrname:encodeURIComponent(newAddr.townName+newAddr.name),provinceid:newAddr.provinceId,cityid:newAddr.cityId,countyid:newAddr.countyId,townid:newAddr.townId,label:newAddr.label||'',};if(window.__g.isGlobalPay&&window.locker.globalPayIdCard&&flag!='noGlobal'){data.isglobal='1';data.idcard=newAddr.idcard;}
if(['53283','52993','32'].indexOf(newAddr.provinceId)>-1){data.email=newAddr.email;data.postcode=newAddr.postcode;data.phone=newAddr.phone;}
if(newAddr.provinceId=='53283'){data.areacode=newAddr.areacode;data.namecode=newAddr.namecode;}
if(window.editAddrData&&window.editAddrData.action=='modify'){_cgi=cgi.modifyrecvaddr4jd;data.adid=window.editAddrData.adid;}else{_cgi=cgi.addRecvAddr4JDV2;}
if(window.addressObj&&window.addressObj.type=='0'&&window.addressObj.level=='2'){data.adid=window.addressObj.adid;data.rgid='';}
if(adid){_cgi=cgi.modifyrecvaddr4jd;data.adid=adid;}
if($('#editAddrSetDef').hasClass('selected')){data.default='1';if(newAddr.default_address!='1'){wa('jdClick',{ptag:'7039.38.2'});}}else{data.default='0';}
if(window.param.token){data.token=window.param.token;}
g.loading.show();pu.wrapData(data);loadJs.loadScript({url:_cgi,data:data});},getAreaArr:function(){if(!window.editAddrData){return['',''];}
var names=[window.editAddrData.provinceName||'',window.editAddrData.cityName||'',window.editAddrData.countyName||''];if(window.editAddrData.provinceId=='53283'&&window.editAddrData.townName){names.push(' '+window.editAddrData.townName||'');}else{names.push(window.editAddrData.townName||'');}
var ids=[window.editAddrData.provinceId||0,window.editAddrData.cityId||0,window.editAddrData.countyId||0,window.editAddrData.townId||0];return[names.join('_'),ids.join('_')];},addrPageBindEvent:function(){var self=this,transY,oldkeyinput;g.sugAddr=null;$('.address_new').css({'-webkit-transform':'translate(0px,0px)','padding-bottom':'10px'});if(g.defAddrLocker&&(!window.editAddrData||window.editAddrData.default_address!='1')){wa('ptagExposure',{ptag:'7039.38.3'});$('#editAddrSetDef').show();}
$('#editAddrSetDef').off('click').on('click',function(e){$(this).toggleClass('selected');});$('#submitAddress').off('click').on('click',function(){var that=this;addrSelectorV1.preloadCityData({provinceId:window.editAddrData.provinceId,cityId:window.editAddrData.cityId,countyId:window.editAddrData.countyId,townId:window.editAddrData.townId,outputCb:function(data,isValid){if(!isValid){myAlert({msg:'请选择地市/区县信息。',onConfirm:function(){self.showSelAddr(true);}});}else{if(g.sugAddr){if(window.editAddrData.cityId!=g.sugAddr.cityId){myAlert({msg:'详细地址信息和省市区县信息不匹配'});return;}}
g.loading.show();$('#mobile').val(($('#mobile').val()||'').replace(/[ \?\&\~\^\%\$\"\'\u202d\u202c]/g,''));if(window.editAddrData.provinceId!='53283'){$('#name').val(($('#name').val()||'').replace(/[\?&~\^\*%\$\"\']/g,'').replace(/[\*\/\+\\\$\^\.;<>"={}@]/g,''));}
var addrItem={'name':$('#name').val(),'mobile':$('#mobile').val(),'adinfo':$('#adinfo').val(),'userModifyMobile':g.userModifyMobile,'checkIdcard':true};if(['53283','52993','32'].indexOf(window.editAddrData.provinceId)>-1){addrItem.provinceId=window.editAddrData.provinceId;addrItem.email=$('#g_email').val();addrItem.postcode=$('#g_postcode').val();addrItem.phone=$('#g_phone').val();addrItem.areacode=window.newAddrData.areacode||'';}
if(!pu.checkForm(addrItem)){g.loading.hide();return;}
window.param.userAction.push(that.id);self.handleActionAddr();}}});});$('#delAddress').off('click').on('click',function(){var defAddr=getDefAddrFromCookie();if(window.editAddrData.adid==defAddr[0]){myAlert({msg:'选中的地址不允许删除！'});}else{myConfirm({'msg':'确认删除该地址吗?','okText':'取消','cancelText':'确定','onCancel':function(){self.delAddress(window.editAddrData.adid,'1',function(){history.back();});}});}});pu.myBind({'type':'focus','src':'#idCard','fun':function(e,$this){if(/\d{4}\*+\d{3}[0-9xX]/.test($this.val())){$this.val('');}
$('#idCardTips').addClass('tips_error');}});pu.myBind({'type':'focus','src':'#mobile','fun':function(e,$this){if(!g.userModifyMobile&&($this.val()==''||/\d{3}\*{4}\d+/.test($this.val()))){$this.val('');g.userModifyMobile=true;}}});pu.myBind({'src':'#selAddr','fun':function(){self.showSelAddr();}});$('#selAddr input').off('focus').on('focus',function(){$(this).blur();});$('#adlabelP .address_tags_tag').off('click').on('click',function(){if($(this).hasClass('user_tag')){wa('jdClick',{ptag:'7387.4.2'});userLabelEvent();return;}
if($(this).hasClass('cur')){$(this).removeClass('cur');$('#adlabelP').attr('value','');wa('jdClick',{ptag:'7387.4.4'});}else{$('#adlabelP .address_tags_tag').removeClass('cur');$(this).addClass('cur');$('#adlabelP').attr('value',$(this).attr('value'));if(g.dfLabel.indexOf($(this).attr('value'))>-1){wa('jdClick',{ptag:'7387.4.1'});}else{wa('jdClick',{ptag:'7387.4.2'});}}});$('#adlabelP .address_tags_edit').off('click').on('click',function(){wa('jdClick',{ptag:'7387.4.3'});userLabelEvent('edit');});$('#adinfo').off('focus').on('focus',function(){if($(this).hasClass('noSug')){return;}
var provinceName='',cityName='',keyword=$('#adinfo').val();if(oldkeyinput==keyword&&$('#fuzzySearch').hasClass('show')){return;}
if(window.editAddrData&&window.editAddrData.provinceName){provinceName=window.editAddrData.provinceName;}
if(window.editAddrData&&window.editAddrData.cityName){cityName=window.editAddrData.cityName;}
if(keyword){loadSuggetAddr(provinceName+cityName,keyword);}});$('#info_sure').off('click').on('click',function(){g.sugAddr=null;backAddrPage();});$('#info_clear').off('click').on('click',function(){$('#adinfo').val('');});$('#label_clear').off('click').on('click',function(){$('#adlabel').val('');});$('#adinfo').off('input propertychange').on('input propertychange',function(){if($(this).hasClass('noSug')){return;}
var provinceName='',cityName='',keyword='';if(g.loadSuggestaddr||!$('#adinfo').val()){return;}
g.sugAddr=null;if(window.editAddrData&&window.editAddrData.provinceName){provinceName=window.editAddrData.provinceName;}
if(window.editAddrData&&window.editAddrData.cityName){cityName=window.editAddrData.cityName;}
keyword=$('#adinfo').val();if(keyword){loadSuggetAddr(provinceName+cityName,keyword);}});function userLabelEvent(type){if($('#userLabelDiv').length===0&&$('.wrapBody').length>0){$('.wrapBody').append(payAddrTpl.child_userLabelTpl());}else if($('#userLabelDiv').length===0){$('body').append(payAddrTpl.child_userLabelTpl());}
$('#userLabelDiv, .mod_alert_mask').show();if(type){$('#labelInput').val($('#userLabelVal').attr('value'));}else{$('#labelInput').val('');}
$('#labelCancel').off('click').on('click',function(){$('#userLabelDiv, .mod_alert_mask').hide();});$('#labelSure').off('click').on('click',function(){var userLabel=$('#labelInput').val().trim();if((userLabel+'').length===0){pu.oneLineTip({msg:'请填写自定义标签'});return;}
$('.user_tag').hide();$('#userLabelVal').html(userLabel).parent().show();$('#adlabelP .address_tags_tag').removeClass('cur');$('#userLabelVal').addClass('cur');$('#adlabelP,#userLabelVal').attr('value',userLabel);$('#userLabelDiv, .mod_alert_mask').hide();});}
function loadSuggetAddr(region,keyword){var suggestHtml='',item,address,addrVal,i,j,suggestArea='';if(g.lockSuggest){return;}
if(window.editAddrData&&['53283','52993','32'].indexOf(window.editAddrData.provinceId)>-1){return;}
window.suggestionCb=function(d){pu.umpReport({bizid:1,operation:89,result:d.status,source:'0',message:d.message});g.loadSuggestaddr=false;if(d.status!='0'||d.data.length==0){return;}
$('#submitAddress, #delAddress').parent().hide();$('#adlabelP').hide();transY=$('#adinfoP').offset()?$('#adinfoP').offset().top:0;if(transY>0){$('.address_new').css({'-webkit-transform':'translate(0,-'+transY+'px)','padding-bottom':'0'});window.scrollTo(0,0);}
$('.street_detail').addClass('has_complete_btn');$('#fuzzySearch').addClass('show');for(i=0,j=d.data.length;i<j;i++){suggestArea='';item=d.data[i];addrVal=item.title;address=addrVal.replace(keyword,'<em>'+keyword+'</em>');if(item.province){suggestArea+=item.province;}
if(item.city){suggestArea+=item.city;}
if(item.district){suggestArea+=item.district;}
suggestHtml+='<li class="result_item" value ="'+addrVal+'" adcode="'+item.adcode+'" sugid="'+item.id+'" index="'+i+'">'+address+'<span class="gps_re">'+suggestArea+'</span></li>';}
$('#tenSuggest').html(suggestHtml);$('#tenSuggest li').off('click').on('click',function(){var adcode=$(this).attr('adcode'),sugid=$(this).attr('sugid'),index=$(this).attr('index'),rpData;$('#adinfo').val($(this).attr('value'));if(adcode&&adcode!='0'){getjd3laddr($(this).attr('adcode'));}else{backAddrPage();}
if(['wqs.jd.com','wq.jd.com','wqdeal.jd.com','p.m.jd.com'].indexOf(document.domain)>-1){try{rpData=[{api_id:'sug',request_id:d.request_id||'',time:(new Date()).getTime(),data_id:sugid,idx:index,ref:'30010',key:'KLCBZ-Q2SR5-4SOIV-QK4OO-YYY4Q-7UBAM',userid:g.uin||JD.cookie.get('visitkey')||''}];pu.myAjax({url:cgi.sugReport,timeout:3,data:JSON.stringify({data:rpData}),type:'POST',dataType:'json'});}catch(e){}}});};g.loadSuggestaddr=true;oldkeyinput=keyword;window.setTimeout(function(){loadJs.loadScript({url:cgi.suggestion,data:{region:region,keyword:keyword,policy:'1',key:'KLCBZ-Q2SR5-4SOIV-QK4OO-YYY4Q-7UBAM',output:'jsonp',callback:'suggestionCb',r:Math.random()}});},1000);}
function getjd3laddr(rgid){var _data;window.getjd3laddrCb=function(d){if(d.errCode!=0){backAddrPage();}
if(d.info){g.sugAddr={provinceId:d.info.provinceId,provinceName:d.info.provinceName,cityId:d.info.cityId,countyId:d.info.countyId,townId:0,townName:''};}
backAddrPage();};_data={rgid:rgid,reg:'1',callback:'getjd3laddrCb'};pu.wrapData(_data);loadJs.loadScript({url:cgi.getJd3LAddr,data:_data});}
function backAddrPage(){var defAddr=getDefAddrFromCookie();$('.street_detail').removeClass('has_complete_btn');$('#fuzzySearch').removeClass('show');$('.address_new').css({'-webkit-transform':'translate(0px,0px)','padding-bottom':'10px'});$('#submitAddress').parent().show();if(window.editAddrData&&['53283','52993','32'].indexOf(window.editAddrData.provinceId)>-1){$('#adlabelP').hide();}else{$('#adlabelP').show();}
if((!window.newAddrData||window.newAddrData.action!='add')&&window.newAddrData.adid!=defAddr[0]){$('#delAddress').parent().show();}
$('#tenSuggest').html('');}},showSelAddr:function(isPreSelect){var self=this;var containerId='addrSelectorV1';if($('#'+containerId).length===0){var containerDom='<div style="display: none;" id="'+containerId+'"></div>';if($('#wrapBody').length>0){$('#wrapBody').append(containerDom);}else{$('body').append(containerDom);}}
var curSelData=window.editAddrData||{};addrSelectorV1.showSelector({pageWrap:containerId,provinceId:isPreSelect?(curSelData.provinceId||0):0,cityId:isPreSelect?(curSelData.cityId||0):0,countyId:isPreSelect?(curSelData.countyId||0):0,townId:isPreSelect?(curSelData.townId||0):0,outputCb:function(data){if(!window.editAddrData){window.editAddrData={};}
window.editAddrData.provinceName=data.provinceName||'';window.editAddrData.provinceId=data.provinceId||0;window.editAddrData.cityName=data.cityName||'';window.editAddrData.cityId=data.cityId||0;window.editAddrData.countyName=data.countyName||'';window.editAddrData.countyId=data.countyId||0;window.editAddrData.townName=data.townName||'';window.editAddrData.townId=data.townId||0;window.editAddrData.areacode=data.areaCode;window.editAddrData.namecode=data.nameCode;finish();}});$('#'+containerId).show();function finish(){var gnReg=/^[a-zA-Z·_.\/\\ (),-]{1,50}$/,gdReg=/^[0-9a-zA-Z· _&.\/\\;#(),-]{1,100}$/,cReg=/[^a-z\u4E00-\u9FA5\uF900-\uFA2D]/i,adReg=/[^\da-z_&.\/\\;#\(\),\-\u4E00-\u9FA5\uF900-\uFA2D]/i,isClear=false,_provId=window.editAddrData.provinceId,_cityId=window.editAddrData.cityId,_nameVal=$('#name').val()?$('#name').val().trim():'',_adinfoVal=$('#adinfo').val()?$('#adinfo').val().trim():'',_mobileVal=$('#mobile').val()?$('#mobile').val().trim():'';self.initNewAddrData();$('#selAddr input').val(self.getAreaArr()[0].replace(/_/g,''));if(_provId=='53283'){$('#name, #adinfo').attr('placeholder','仅支持英文');if(_nameVal&&!gnReg.test(_nameVal)){$('#name').val('');isClear=true;}
if(_adinfoVal&&!gdReg.test(_adinfoVal)){$('#adinfo').val('');isClear=true;}}else{$('#name').attr('placeholder','姓名');$('#adinfo').attr('placeholder','详细地址需填写楼栋楼层或房间号信息');if(_nameVal&&cReg.test(_nameVal)){$('#name').val('');isClear=true;}
if(_nameVal&&_nameVal.length>30){$('#name').val('');isClear=true;}
if(_adinfoVal&&adReg.test(_adinfoVal)){$('#adinfo').val('');isClear=true;}
if(_mobileVal&&['52993','32'].indexOf(_provId)==-1&&!(/^1\d{2}\*{4}\d{4}$/.test(_mobileVal)||/^1\d{10}$/.test(_mobileVal))){$('#mobile').val('');isClear=true;}
if(_provId=='52993'&&_mobileVal&&_mobileVal.trim().length!=8){$('#mobile').val('');isClear=true;}else if(_provId=='32'&&_mobileVal&&!(_mobileVal.length==9||_mobileVal.length==10)){$('#mobile').val('');isClear=true;}}
if(['53283','52993','32'].indexOf(_provId)>-1){if(_provId=='53283'){$('#areaCode').html(window.editAddrData.areacode+' -').show();}else if(_provId=='52993'){if(_cityId=='52994'){$('#areaCode').html('852'+' -').show();}else{$('#areaCode').html('853'+' -').show();}}else if(_provId=='32'){$('#areaCode').html('886'+' -').show();}else{$('#areaCode').hide();}
$('#g_emailP, #g_postcodeP, #g_phoneP').show();$('#adlabelP').hide();}else{$('#g_emailP, #g_postcodeP, #g_phoneP, #areaCode').hide();$('#adlabelP').show();}
$('#addrSelDiv').hide();if(isClear){pu.oneLineTip({msg:'部分选项需要重新填写'});}}},showAddAddressPage:function(scene){var wq_addr=cookies.get('wq_addr')||'',wq_addrArr=wq_addr.split('|'),self=this;g.loading.show();if(wq_addrArr.length<3){window.editAddrData=false;if(scene&&scene=='1'){self.showNull();}else{self.showPageAddAddress();}}else{var addrIdArr=wq_addrArr[1].split('_');window.editAddrData={action:'add',provinceId:addrIdArr[0],cityId:addrIdArr[1],countyId:addrIdArr[2],townId:addrIdArr[3]};addrSelectorV1.preloadCityData({provinceId:window.editAddrData.provinceId,cityId:window.editAddrData.cityId,countyId:window.editAddrData.countyId,townId:window.editAddrData.townId,outputCb:function(data){window.editAddrData.provinceName=data.provinceName;window.editAddrData.cityName=data.cityName;window.editAddrData.countyName=data.countyName;window.editAddrData.townName=data.townName;window.editAddrData.areacode=data.areaCode;window.editAddrData.namecode=data.nameCode;if(scene&&scene=='1'){self.showNull();}else{self.showPageAddAddress();}}});}},showPageAddAddress:function(){var _editAddr=window.editAddrData;var html=payAddrTpl.child_tplPageAddAddress({name:'',mobile:'',adinfo:'',idCard:''});g.newLabel=true;wa('jdClick',{ptag:'7387.4.8'});$('#pageAddAddress').html(html);$('#selAddr input').val(this.getAreaArr()[0].replace(/_/g,''));if(_editAddr&&_editAddr.provinceId=='53283'){$('#name, #adinfo').attr('placeholder','仅支持英文');$('#areaCode').html(_editAddr.areacode+' -').show();}else{if(_editAddr&&_editAddr.provinceId=='52993'&&_editAddr.cityId=='52994'){$('#areaCode').html('852 -').show();}else if(_editAddr&&_editAddr.provinceId=='52993'&&_editAddr.cityId=='52995'){$('#areaCode').html('853 -').show();}else if(_editAddr&&_editAddr.provinceId=='32'){$('#areaCode').html('886 -').show();}
$('#name').attr('placeholder','姓名');$('#adinfo').attr('placeholder','详细地址需填写楼栋楼层或房间号信息');}
if(['53283','52993','32'].indexOf(_editAddr.provinceId)>-1){$('#g_emailP, #g_postcodeP, #g_phoneP').show();$('#adlabelP').hide();}
$('#idCardTips').addClass('tips_error');window.param.updateAddrInPay=false;window.newAddrData=false;this.initNewAddrData();g.userModifyMobile=false;this.addrPageBindEvent();g.loading.hide();},showNull:function(){var html,areaArr;html=payAddrTpl.child_tplPageAddAddress({name:'',mobile:'',adinfo:'',idCard:''});g.newLabel=true;$('#addressNullV2').html(html).show();$('#adinfo').addClass('noSug');areaArr=this.getAreaArr();if(areaArr.length>0){$('#selAddr input').val(areaArr[0].replace(/_/g,''));}
$('#idCardTips').addClass('tips_error');window.param.updateAddrInPay=true;window.newAddrData=false;this.initNewAddrData();g.userModifyMobile=false;window.addressObj.addrPageBindEvent();g.loading.hide();},initNewAddrData:function(){if(!window.editAddrData){return;}
window.newAddrData=window.editAddrData;},showEditAddressPage:function(){this.initNewAddrData();goPage('pageEditAddress');},showPageEditAddress:function(){var addr=getDefAddrFromCookie();var _editAddr=window.editAddrData;var adLabel=(_editAddr.label&&_editAddr.label==_editAddr.name)?'':(_editAddr.label||'');var html=payAddrTpl.child_tplPageAddAddress({name:_editAddr.name||'',mobile:_editAddr.mobile||'',adinfo:_editAddr.adinfo||'',idCard:_editAddr.idCard||'',label:adLabel=='undefined'?'':adLabel,email:_editAddr.email||'',postcode:_editAddr.postcode||'',phone:_editAddr.phone||'',type:'edit'});g.newLabel=adLabel?false:true;wa('jdClick',{ptag:'7387.4.8'});$('#pageEditAddress').empty().html(html);if(window.editAddrData.default_address=='1'){$('#editAddrSetDef').addClass('selected');}
if($('#pageEditAddress').hasClass('loc')){$('#topDiv, #locYellowBar').show();$('#pageEditAddress').removeClass('loc');}
if(['53283','52993','32'].indexOf(_editAddr.provinceId)>-1){$('#g_emailP, #g_postcodeP, #g_phoneP').show();$('#adlabelP').hide();}
if(_editAddr.provinceId=='53283'){$('#name, #adinfo').attr('placeholder','仅支持英文');}else{$('#name').attr('placeholder','姓名');$('#adinfo').attr('placeholder','详细地址需填写楼栋楼层或房间号信息');}
if(_editAddr.provinceId=='53283'){$('#areaCode').html(_editAddr.areacode+' -').show();}else if(_editAddr.provinceId=='52993'&&_editAddr.cityId=='52994'){$('#areaCode').html('852 -').show();}else if(_editAddr.provinceId=='52993'&&_editAddr.cityId=='52995'){$('#areaCode').html('853 -').show();}else if(_editAddr.provinceId=='32'){$('#areaCode').html('886 -').show();}
if(adLabel){$('#adlabelP .address_tags_tag[value="'+adLabel+'"]').addClass('cur');}
$('#selAddr input').val(this.getAreaArr()[0].replace(/_/g,''));if(!$('#idCard').val()){$('#idCardTips').addClass('tips_error');}
if(addr[0]==_editAddr.adid||_editAddr.action=='add'){$('#delAddress').hide();}
window.param.updateAddrInPay=false;g.userModifyMobile=false;html='';g.loading.hide();this.addrPageBindEvent();},editAddr:function(adid,type,addrObj){var address=null;var that=this;if(addrObj){address=addrObj;}else{address=g.shipAddrData.shipAddrList.filter(function(shipAddr){return shipAddr.adid==adid;})[0];if(!address){g.loading.hide();myAlert({msg:'数据错误！'});return;}}
window.editAddrData={action:'modify',adid:this.handleAdid(address.adid),provinceId:address.provinceId,cityId:address.cityId,countyId:address.countyId,townId:address.townId,name:address.name,mobile:address.mobile,adinfo:address.addrdetail,default_address:address.default_address,idCard:address.idCard,label:address.label||''};if(['53283','52993','32'].indexOf((address.provinceId+''))>-1){window.editAddrData.email=address.email;window.editAddrData.postcode=address.postcode;window.editAddrData.phone=address.phone;}
addrSelectorV1.preloadCityData({provinceId:window.editAddrData.provinceId,cityId:window.editAddrData.cityId,countyId:window.editAddrData.countyId,townId:window.editAddrData.townId,outputCb:function(data){window.editAddrData.provinceName=data.provinceName;window.editAddrData.cityName=data.cityName;window.editAddrData.countyName=data.countyName;window.editAddrData.townName=data.townName;window.editAddrData.areacode=data.areaCode;window.editAddrData.namecode=data.nameCode;that.showEditAddressPage();}});},bindAddJdAddr:function(show){$('#addressNull').off('click').on('click',function(){window.param.addAddrFromPayPage=true;goPage('pageAddAddress');window.param.userAction.push(this.id);});if(show){$('#addressNull').show();}},loadWxAddress:function(config){wx.invoke('editAddress',{},function(res){var addrLevel='3',addr,errMsg=false,wxErrMsg='微信地址错误，请重新选择。',moileErrMsg='微信地址手机格式错误，请填写正确手机号！',tplName,addrOpt={},reportResult;try{if(window.JD){if(res.err_msg=='edit_address:ok'||res.err_msg=='edit_address:cancel'){reportResult=0;if(g.uin%2000==12){reportResult=2;}}else{reportResult=1;}
if((reportResult===1&&g.wxAddrLoadCount>=3)||reportResult===0||reportResult==2){pu.umpReport({bizid:1,operation:17,result:reportResult,source:'0',message:pu.obj2str2(res)+'-'+pu.obj2str2(config)});}}}catch(ignore){}
if(res.err_msg=='edit_address:ok'){res.addressDetailInfo=res.addressDetailInfo.replace(/\s/g,'');tplName=res.userName.replace(/[^\x00-\xff]/g,"aaa");if(tplName.length>30){myAlert({msg:'收货人姓名格式错误，请正确填写收货人姓名！'});return;}
if(!(/^1\d{10}$/.test(res.telNumber))){myAlert({msg:moileErrMsg});return;}
if(res.nationalCode==''||res.nationalCode=='undefined'||res.nationalCode==undefined||res.addressDetailInfo==''||res.addressDetailInfo==undefined){myAlert({msg:wxErrMsg});return;}
if(res.proviceFirstStageName===res.addressCitySecondStageName||res.addressCitySecondStageName==='县'||res.addressCitySecondStageName===res.addressCountiesThirdStageName||res.addressCitySecondStageName==='省直辖县级行政区划'){addrLevel='2';}
if(res.proviceFirstStageName==res.addressCitySecondStageName){res.addressCitySecondStageName=res.addressCountiesThirdStageName;res.addressCountiesThirdStageName="";}
addr={type:'2',rginfo:res.proviceFirstStageName+res.addressCitySecondStageName+res.addressCountiesThirdStageName,addrdetail:res.addressDetailInfo,provinceName:res.proviceFirstStageName,cityName:res.addressCitySecondStageName,countyName:res.addressCountiesThirdStageName,mobile:res.telNumber,name:res.userName,postCode:res.addressPostalCode,rgid:res.nationalCode,level:addrLevel,divId:'sendTo'};addrOpt.addrObj=addr;window.addressObj=new Address(addrOpt);window.param.updateAddrInPay=true;if(g.wxAddrScene=='addressList'){window.addressObj.handleWxAddress();}else if(g.wxAddrScene=='pay'){window.addressObj.showDefAddr({'fromt':'weixin'});}}else if(res.err_msg=='edit_address:fail'){}else if(res.err_msg==="system:access_denied"){errMsg=true;}else if(res.err_msg==="get_brand_grant_info:fail"||res.err_desc==='no authorized bugger empty'){}else if(res.err_msg==='edit_address:cancel'||res.err_msg==='editAddress:cancel'){window.addressObj.bindAddJdAddr();}else{errMsg=true;}
if(errMsg){if(g.wxAddrLoadCount<3){g.wxAddrLoadCount+=1;window.addressObj.getDataForloadWxAddress();}else{myAlert({msg:'获取微信地址失败：'+res.err_msg});window.addressObj.bindAddJdAddr();}}});},getDataForloadWxAddress:function(){var self=this;if(JD&&JD.wxapi&&JD.wxapi.ready){JD.wxapi.ready(function(config){if(config){config.beta=true;}
self.loadWxAddress(config);},true,function(){myAlert({msg:'获取微信地址失败！'});});}else{$('#wxloading').hide();myAlert({msg:'获取微信地址失败。'});if(g.wxAddrScene=='pay'){$('#addressNull').off('click').on('click',function(){window.param.userAction.push(this.id);window.param.addAddrFromPayPage=true;goPage('pageAddAddress');}).show();}}},delAddress:function(adid,type,callback){var _cgi=cgi.delrecvaddr,_data;if(type=='1'){_cgi=cgi.delrecvaddr4jd;}
window.cbDelAdress_adid=adid;window.cbDelAddress=function(obj){g.loading.hide();pu.umpReport({bizid:1,operation:38,result:obj.errCode,source:'0',message:pu.obj2str2(obj)});if(obj.errCode==='0'){$('ul[adid="'+window.cbDelAdress_adid+'"]').parent().remove();var defAddr=getDefAddrFromCookie();if(window.cbDelAdress_adid.replace(/u/g,'')==defAddr[0]){window.param.needChangeAddr=true;window.param.getDefaultAddr=false;pu.delAddrCookie();}
if(callback){callback();}}else{myAlert({msg:'删除地址失败！'+obj.msg});}};g.loading.show();_data={callback:'cbDelAddress',adid:this.handleAdid(adid)};pu.wrapData(_data);loadJs.loadScript({url:_cgi,data:_data});},runClickEvent:function(t,o){var self=this;if(t.tagName.toLowerCase()==='li'&&t.className.toLowerCase()==='edit'){g.loading.show();window.param.userAction.push('addressListEditBtn');self.editAddr($(t).attr('adid'),$(t).attr('type'));}
else{var adid=$(o).attr('adid');var type=$(o).attr('type');var upgrade=$(o).attr('upgrade');var addrId=$(o).attr('addrid');var addrName=$(o).attr('addrname');var addrDetal=$(o).attr('addrdetail');var wq_addrArr=(JD.cookie.get('wq_addr')||'').split('|');wq_addrArr[0]=adid||'0';wq_addrArr[1]=addrId||wq_addrArr[1];wq_addrArr[2]=addrName||wq_addrArr[2];wq_addrArr[3]=addrDetal||wq_addrArr[3];if(upgrade=='1'){var msg='因京东地址库升级，您选择的地址现已失效，会导致商品库存信息不准确或商品无法配送，请及时修改。';myAlert({msg:msg,onConfirm:function(){g.loading.show();window.param.userAction.push('addressListEditBtn');self.editAddr(adid,type);},confirmText:'修改地址',showClose:true});g.addressListTouchendIn=false;return;}
wa('jdClick',{ptag:'7387.2.2'});if(g.defAddrLocker){wa('jdClick',{ptag:'7039.38.1'});}else{wa('jdClick',{ptag:'7039.38.4'});}
pu.setAddrCookie(adid,wq_addrArr.join('|'));window.param.changeAddrInList=true;window.param.needChangeAddr=true;window.param.getDefaultAddr=false;if(window.mConfirm){window.setTimeout(function(){self.callback&&self.callback();goPage('pagePay');},100);}else{self.callback&&self.callback();goPage('pagePay');}}
g.addressListTouchendIn=false;},createMqqAddrObj:function(data){var addr,addrLevel=3,addrInfoArr,addrOpt={};data.address=data.address.replace(/\s/g,'');addr={type:'3',rginfo:'',addrdetail:data.address,provinceName:'',cityName:'',countyName:'',mobile:data.contactmo,name:data.consignee,postCode:data.zipCode,rgid:data.cityCode,level:addrLevel,divId:'sendTo'};qqAddr.init().net.loadAddrData(function(){addrInfoArr=qqAddr.init().data.getDistrictArr(addr.rgid);window.param.updateAddrInPay=false;if(addrInfoArr&&addrInfoArr.length=='2'){addr.level='2';addr.provinceName=addrInfoArr[0];addr.cityName=addrInfoArr[1];addr.rginfo=addrInfoArr.join('');}else if(addrInfoArr&&addrInfoArr.length=='3'){addr.level='3';addr.provinceName=addrInfoArr[0];addr.cityName=addrInfoArr[1];addr.countyName=addrInfoArr[2];addr.rginfo=addrInfoArr.join('');}
addrOpt.addrObj=addr;window.addressObj=new Address(addrOpt);window.addressObj.handleQQAddress();});},handleMQQAddr:function(data,source){switch(data.type){case 1:break;case 2:this.createMqqAddrObj(data);break;}},bindShipAddrListEvent:function(domShipAddrList){var domDelete=domShipAddrList+' .address .act';var domShiftClick=domShipAddrList+' .address ul';var self=this;$(domDelete).off('click').on('click',function(e){var selAddrId=getDefAddrFromCookie()[0];var curAddrId=$(this).attr('adid');var curAddrType=$(this).attr('type');if(curAddrId==selAddrId){myAlert({msg:'选中地址不允许删除！'});}else{myConfirm({'msg':'确认删除该地址吗?','okText':'取消','cancelText':'确定','onCancel':function(){self.delAddress(curAddrId,curAddrType);}});}
e.stopPropagation();});if('ontouchstart'in window){$(domShiftClick).off('click').off('touchstart').off('touchmove').off('touchend').on({'touchmove':function(event){if(event.targetTouches.length!==1){return;}
this.isXYMoveFlag=true;var touchElem=event.targetTouches[0];var curPosition={x:touchElem.pageX,y:touchElem.pageY};var startPosition=this.startPosition;var xMove=curPosition.x-startPosition.x;var yMove=curPosition.y-startPosition.y;if((xMove<0&&xMove>-20)||Math.abs(yMove)>10||Math.abs(xMove)-Math.abs(yMove)<0||Math.atan2(Math.abs(yMove),Math.abs(xMove))>=15*Math.PI/180){return;}
var xMaxMove=70;var moveDir='';if(xMove<0){moveDir='l';xMove=xMove<(-xMaxMove)?(-xMaxMove):xMove;if(this.curPosition==='r'){this.style.webkitTransform='translateX('+xMove+'px)';}}else{moveDir='r';xMove=xMove>xMaxMove?xMaxMove:xMove;if(this.curPosition==='l'){this.style.webkitTransform='translateX('+(xMove-xMaxMove)+'px)';}}
this.xMaxMove=xMaxMove;this.xMove=xMove;this.moveDir=moveDir;},'touchstart':function(event){if(event.targetTouches.length!==1){return;}
if(!this.curPosition){this.curPosition='r';}
var touchElem=event.targetTouches[0];this.startPosition={x:touchElem.pageX,y:touchElem.pageY};this.isXYMoveFlag=false;},'touchend':function(event){if(!this.isXYMoveFlag){if(g.addressListTouchendIn){return;}
g.addressListTouchendIn=true;var that=this;setTimeout(function(){self.runClickEvent(event.target,that);},500);return;}
this.style.webkitTransition="-webkit-transform 0.5s ease";if(this.moveDir==='r'){this.style.webkitTransform='translateX(0px)';this.curPosition='r';}else if(this.moveDir==='l'){this.style.webkitTransform='translateX(-70px)';if(this.xMove>(-(this.xMaxMove/2))){this.style.webkitTransform='translateX(0px)';this.curPosition='r';}else{this.style.webkitTransform='translateX(-70px)';this.stats='l';}}}});}else{$(domShiftClick).off('click').on('click',function(e){self.runClickEvent(e.target,this);});}},setSelectedShipAddr:function(){var addr=getDefAddrFromCookie();$('ul[adid="'+addr[0]+'"]').addClass('selected');if(window.param.idCardErrMsg){$('ul[adid="'+addr[0]+'"]').append('<li><em>'+window.param.idCardErrMsg+'</em></li>');}},showShipAddrList:function(addrList){var pageWrap='#addressList';var domShipAddrList=$('#shipAddrList')[0]?'#shipAddrList':pageWrap;var domAddJDAddr=domShipAddrList+' .mod_btns[tag="jd"]';var domAddWXAddr=domShipAddrList+' .address_list[tag="wx"]';var domAddSQAddr=domShipAddrList+' .address_list[tag="sq"]';g.shipAddrData.shipAddrList=addrList;var template=payAddrTpl.child_shipAddrListV2({list:addrList});$(domShipAddrList).html(template).show();$(pageWrap).show();this.setSelectedShipAddr();(function addNewJDAddrEvent(){window.param.addAddrFromPayPage=false;$(domAddJDAddr).off('click').on('click',function(){wa('jdClick',{ptag:'7387.2.3'});var shipAddrSummary=$(domShipAddrList+' .address_list div.address').length;if(shipAddrSummary>=20){myAlert({msg:'抱歉，地址信息最多20条哦，删除一条再添加吧~'});return;}
window.param.addAddrFromPayPage=false;goPage('pageAddAddress');}).show();})();(function addNewWxAddrEvent(){if(pu.isWxUserAgent()&&window.locker.SupWxAddr&&!window.__g.isGlobalPay){var addWxAddrBtnEvent=function(){$(domAddWXAddr).off('click').on('click',function(){var shipAddrSummary=$(domShipAddrList+' .address_list div.address').length;if(shipAddrSummary>=20){myAlert({msg:'抱歉，地址信息最多20条哦，删除一条再添加吧~'});return;}
wa('jdClick',{ptag:'7387.2.4'});g.wxAddrScene='addressList';window.addressObj.getDataForloadWxAddress();}).show();};if(typeof window.WeixinJSBridge=="object"&&typeof window.WeixinJSBridge.invoke=="function"){addWxAddrBtnEvent();}else{document.addEventListener("WeixinJSBridgeReady",addWxAddrBtnEvent,false);}}})();(function addNewSqAddrEvent(){if(window.locker.SupMQAddr&&pu.isMQQUserAgent()&&pu.compareQQVersion('5.0')>=0&&!window.__g.isGlobalPay){$(domAddSQAddr).off('click').on('click',function(){var shipAddrSummary=$(domShipAddrList+' .address_list div.address').length;if(shipAddrSummary>=20){myAlert({msg:'抱歉，地址信息最多20条哦，删除一条再添加吧~'});return;}
qqAddr.init().call({aid:0,appid:100273020});}).show();}})();this.bindShipAddrListEvent(domShipAddrList);g.loading.hide();$('#delAddress').hide();ump_showaddresslist=true;},showAddressSlide:function(){var html,addr=getDefAddrFromCookie(),self=this,wq_addrArr=(JD.cookie.get('wq_addr')||'').split('|');this.loadAddressList({callback:function(list){wa('ptagExposure',{ptag:'7493.2.5'});var showAddButton=list.length>=20?false:true;ump_showaddresslist=true;g.shipAddrData.shipAddrList=list;html=payAddrTpl.child_tplAddressSlide({list:list,showAddButton:showAddButton,});$('#address_slide').html(html).show();$('li[adid="'+addr[0]+'"]').addClass('on');$('#address_slide .mod_address_slide_main').off('click').on('click',function(e){e.stopPropagation();});$('#address_slide.mod_address_slide').off('click').on('click',function(){$('#address_slide').hide();});$('#address_slide .close').off('click').on('click',function(){$('#address_slide').hide();});$('#address_slide li').off('click').on('click',function(){var adid;adid=$(this).attr('adid');if(!adid){return;}
wq_addrArr[0]=adid;pu.setAddrCookie(adid,wq_addrArr.join('|'));window.param.changeAddrInList=true;window.param.needChangeAddr=true;window.param.getDefaultAddr=false;$('#address_slide').hide();if(self.callback){self.callback();}});$('#address_slide .mod_address_slide_list_1_edit').off('click').on('click',function(e){e.stopPropagation();wa('jdClick',{ptag:'7493.2.6'});g.loading.show();window.param.userAction.push('addressListEditBtn');$('#address_slide').hide();window.param.addAddrFromPayPage=true;self.editAddr($(this).parent().attr('adid'),'1');});$('#add_slide').off('click').on('click',function(){window.param.addAddrFromPayPage=true;wa('jdClick',{ptag:'7493.2.7'});goPage('pageAddAddress');});}});},loadAddressList:function(obj){var _cgi=cgi.getrecvaddrlistV3,self=this,data,addr=getDefAddrFromCookie();ump_showaddresslist=false;window.cbLoadAddressList=function(json){var _item,i;g.loading.hide();window.setTimeout(function(){if(ump_showaddresslist){pu.umpReport({bizid:1,operation:36,result:'0',source:'0',message:'ok'});}else{pu.umpReport({bizid:1,operation:36,result:json.errCode=='0'?'9999':json.errCode,source:'0',message:pu.obj2str2(json)});}},1000);if(json.errCode=='0'){if(json.token){window.param.token=json.token;}
window.param.notContainDefAddr=true;for(i=0;i<json.list.length;i++){_item=json.list[i];if(_item.default_address=='1'){window.param.notContainDefAddr=false;break;}}
if(obj){obj.callback&&obj.callback(json.list);return;}
self.showShipAddrList(json.list);}else if(json.errCode=='13'){checklogin(json.nextUrl);}else if(json.errCode=='6148'){myAlert({msg:json.msg||'获取收货地址列表失败，请稍后再试！',onConfirm:function(){history.back();}});}else{myAlert({msg:'获取收货地址列表失败，请稍后再试！',onConfirm:function(){history.back();}});}};data={adid:addr[0]||'0',locationid:obj?obj.jdaddrid:(window.addressObj?window.addressObj.jdaddrid:'0_0_0_0'),callback:'cbLoadAddressList',reg:'1'};if(window.__g.isGlobalPay){data.isglobal='1';}
g.loading.show();pu.wrapData(data);loadJs.loadScript({url:_cgi,data:data});},addAddrByCk:function(){var wq_addrArr=g.wq_addr.split('|'),addrIdArr,self=this;if(wq_addrArr.length<3){goPage('pageAddAddress');}else{addrIdArr=wq_addrArr[1].split('_');window.editAddrData={action:'add',provinceId:addrIdArr[0],cityId:addrIdArr[1],countyId:addrIdArr[2],townId:addrIdArr[3],};addrSelectorV1.preloadCityData({provinceId:window.editAddrData.provinceId,cityId:window.editAddrData.cityId,countyId:window.editAddrData.countyId,townId:window.editAddrData.townId,outputCb:function(data){window.editAddrData.provinceName=data.provinceName;window.editAddrData.cityName=data.cityName;window.editAddrData.countyName=data.countyName;window.editAddrData.townName=data.townName;window.editAddrData.areacode=data.areaCode;window.editAddrData.namecode=data.nameCode;self.showEditAddressPage();}});}},handleTipAddr:function(obj){var wq_addrArr,addrIdArr,self=this,_addrId;if(!g.wq_addr){_showAddrTip();return;}
wq_addrArr=g.wq_addr.split('|');_addrId=wq_addrArr[0];if(wq_addrArr[1]&&window.addressObj){addrIdArr=wq_addrArr[1].split('_');if(window.addressObj.provinceId==addrIdArr[0]&&window.addressObj.cityId==addrIdArr[1]){_showAddrTip();return;}}
if((!_addrId||_addrId=='0')&&!g.haveshowTip){g.haveshowTip=true;this.loadAddressList({callback:showTipaddr,jdaddrid:wq_addrArr[1]||'0_0_0_0'});}else{_showAddrTip();}
function showTipaddr(addrList){if(addrList.length<=0){if(window.addressObj.adid=='0'){myAlert({msg:'您还没有可用配送地址，是否新建一个配送地址？',onConfirm:function(){window.param.addAddrFromPayPage=true;self.addAddrByCk();}});}
return;}
var html=payAddrTpl.child_addrTipTpl(addrList);$('#addrTip').html(html);$('.mod_alert_mask, #addrTipAlert').show();if(addrList.length==20){$('#tip_confirm').removeClass('btn_2').addClass('btn_1');$('#tip_newAddr').hide();}
wa('jdClick',{ptag:'7387.2.5'});$('#addrTipAlert ul li').off('click').on('click',function(){var adid=$(this).attr('adid'),addrid=$(this).attr('addrid'),addrname=$('#addrname'),addrdetail=$('#addrdetail');wa('jdClick',{ptag:'7387.2.6'});_confirmAddr(adid,[adid,addrid,addrname,addrdetail].join('|'));});$('#tip_newAddr').off('click').on('click',function(){$('.mod_alert_mask, #addrTipAlert').hide();window.param.addAddrFromPayPage=true;wa('jdClick',{ptag:'7387.2.7'});self.addAddrByCk();});$('#tip_close').off('click').on('click',function(){$('.mod_alert_mask, #addrTipAlert').hide();_showAddrTip();});$('#tip_confirm').off('click').on('click',function(){var selLi=$('#addrTipAlert li.selected'),adid=selLi.attr('adid'),addrid=selLi.attr('addrid'),addrname=selLi.attr('addrname'),addrdetail=selLi.attr('addrdetail'),addr=getDefAddrFromCookie();wa('jdClick',{ptag:'7387.2.8'});if(addr[0]==adid){$('.mod_alert_mask, #addrTipAlert').hide();_showAddrTip();return;}
_confirmAddr(adid,[adid,addrid,addrname,addrdetail].join('|'));});}
function _showAddrTip(){if(self.need_upgrade=='1'){wa('jdClick',{ptag:'7387.3.7'});myAlert({msg:'因京东地址库升级，您选择的地址现已失效，会导致商品库存信息不准确或商品无法配送，请及时修改。',onConfirm:function(){if(self.adid==''||self.adid=='0'){window.param.addAddrFromPayPage=true;goPage('pageAddAddress');}else{self.updateInpay();}},confirmText:'修改地址'});}else{if(obj.samsTipCb){obj.samsTipCb();}}}
function _confirmAddr(adid,wq_addr){$('.mod_alert_mask, #addrTipAlert').hide();pu.setAddrCookie(adid,wq_addr);window.param.changeAddrInList=true;window.param.needChangeAddr=true;window.param.getDefaultAddr=false;if(obj.addrTipCb){obj.addrTipCb();}}},updateAddrToPay:function(){if(this.callback){this.callback();}
goPage('pagePay');}};function goPage(tag){if(tag=='pagePay'){if((location.hash.indexOf('pageAddAddress')>0&&!window.param.addAddrFromPayPage)||(location.hash.indexOf('pageEditAddress')>0&&!window.param.addAddrFromPayPage)){history.go(-2);}else{history.back();}
document.title='确认订单';}else{location.hash=tag;}}
function getDefAddrFromCookie(){var adid,type,newArr=[];adid=cookies.get('addrId_1')||'';type=cookies.get('addrType_1')||'';if(adid){adid=handleAdid(adid);}
newArr.push(adid);newArr.push(type);return newArr;}
function getDefAddrFromWqAddr(){return pu.getDefAddrFromWqAddr();}
function handleAdid(adid){return adid.replace(/u/g,'');}
function checklogin(url){if(url){var lh=location.href.split('#')[0];lh=lh.replace(/\.shtml\??/,'.shtml?login=1&r='+Math.random()+'&');location.href=url+encodeURIComponent(lh+'#wechat_redirect');}}
exports.getDefAddrFromCookie=getDefAddrFromCookie;exports.getDefAddrFromWqAddr=getDefAddrFromWqAddr;exports.address=function(addrOpt){if(!$('#addressCss').length){window.setTimeout(function(){pu.loadCss(JD.url.getStaticDisRec('//wq.360buyimg.com/fd/h5/wxsq_dev/gb/css/mod_address_slide.min_c74dbaf7.css'),'addressCss');},500);}
window.addressObj=new Address(addrOpt);return window.addressObj;};});
define('wq.ship',function(require,exports,module){var $=require('zepto'),loadJs=require('loadJs'),pu=require('payutil'),d=require('date'),addressCom=require('wq.addr.commonV2'),shipTpl=require('tpl_wq.ship'),weekMap=['今天','周一','周二','周三','周四','周五','周六','周日'],lagerScreen=window.screen&&window.screen.width>320,waitshipTimer=null,jdDomain3=function(){var jdDomain=(window.userRouter&&window.userRouter.getHost&&window.userRouter.getHost())||'//wqdeal.jd.com/';return(jdDomain.indexOf('/deal/')<0?jdDomain+'deal/':jdDomain);},wa=pu.waReport,domain=jdDomain3(),g={setPayShipData:{},containLa:false,shipNeedRedeal:false,needSetShip:false,modifyShip:false,installChange:false,fpbarTipLoc:false,fpbarTipTen:false,selShipInstall:false,selectDD:false,selectGsd:false,selectPopGsd:false,selectCombine:false,supCombine:false,supPick:false,svcChange:false,isSupShipSvc:'0',jdshipInfo:'',global:JD.url.getUrlParam('global')||'',globalbuy:JD.url.getUrlParam('globalbuy')||'',isGlobalPay:false,bgFlag:{combship:false}},cgi={getShipeffect:domain+'mship/shipeffect',globalPay_getShipeffect:domain+'globalpurchase/shipeffect',chooseship:domain+'mship/chooseship',globalPay_chooseship:domain+'globalpurchase/chooseship',itemchargelist:domain+'mship/getitemchargelist',orderdelivery:domain+'mship/updateorderdelivery',getpicksitelist:domain+'mship/getpicksitelist',globalPay_getpicksitelist:domain+'globalpurchase/getpicksitelist',setpayship2:domain+'mship/setpayship',globalPay_setpayship2:domain+'globalpurchase/setpayship',vshipsvc:domain+'mship/vshipsvc',vshipfee:domain+'mship/vshipfee',};if(g.global=='1'||g.globalbuy>0){g.isGlobalPay=true;}
var shipObj={handleShipContent:function(option){if(!option){return;}
var self=option.that,vender=option.vender,venders2=option.venders2,onlineShip=option.onlineShip,from=option.from||'',ship=option.ship,payment=option.payment,i,l,j,k,supZT=true,containLa=false,containSm=false,selectShipId,shipType='',ztDefAddrForNoSel,item,supjzdjsd='',seljzdjsd='',shipItem,_shipItem,shipClickTag='',laCalendar,shipDataId,shiptime,html='',titlehtml='',defaultJDShipTitleHtml='',sopHtml,svchtml,zthtml,zxjhtml='',lainhtml='',lahtml='工作日、双休日与节假日均可送货',selWeek='',selLaWeek='',tipLock,selId,selzitiId,smSkuArr=[],jdhonorshipment='',zxjinhtml,curShipment;if(vender.venderType=='0'||vender.venderType=='1'){jdhonorshipment=onlineShip&&onlineShip.jdhonorshipment&&onlineShip.jdhonorshipment[0];}else{jdhonorshipment=onlineShip&&onlineShip.jdhonorshipment&&onlineShip.jdhonorshipment[vender.venderId];}
if(option.action||option.action=='0'){g.action=option.action;}
for(i=0,l=vender.products.length;i<l;i++){if(vender.products[i].mainSku.isLA!='1'){containSm=true;smSkuArr.push(vender.products[i].mainSku.id);if(vender.products[i].gifts){for(j=0,k=vender.products[i].gifts.skus.length;j<k;j++){smSkuArr.push(vender.products[i].gifts.skus[j].id);}}
if(vender.products[i].homeServices){for(j=0,k=vender.products[i].homeServices.length;j<k;j++){smSkuArr.push(vender.products[i].homeServices[j].id);}}}else{containLa=true;if(vender.venderId=='0'){g.containLa=true;}}
if(['1','2'].indexOf(vender.products[i].mainSku.locType)>-1){vender.isloc=true;}}
if(!ship){ship=payment;}
if(!onlineShip){for(i=0,l=ship.length;i<l;i++){if(ship[i].id=='4'){onlineShip=ship[i];}}}
if(!onlineShip){return;}
g.onlineShip=onlineShip;vender.shipjd=false;vender.ship311=false;vender.ship411=false;vender.shipjzd=false;vender.shiphonorObj=false;vender.isla=false;vender.shipla=false;vender.shiplajzd=false;vender.shipSopJd=false;vender.shipSop=false;vender.ship3=false;vender.shiplaSopjd=false;vender.shipGsd=false;vender.gsdPart=false;vender.selectedShip='';vender.selectedlaShip='';vender.selettedsopShip='';vender.ship311Obj=false;vender.shipziti=false;vender.shipzitiObj=false;vender.shipjzdObj=false;vender.shipla2Obj=false;vender.shiplajzdObj=false;vender.sopDefault=false;vender.shipSopObj=false;vender.shipSopjdObj=false;vender.shipGsdObj=false;vender.shipPopGsdObj=false;vender.smInstall=false;vender._ship311Obj=false;vender._shipzitiObj=false;vender._shipjzdObj=false;vender._shipla2Obj=false;vender._shiplajzdObj=false;vender._shipla=false;vender._shipSopObj=false;vender._shipSopjdObj=false;vender._shipGsdObj=false;vender._shipPopGsdObj=false;vender._shiphonorObj=false;vender.smIn311Obj=false;vender.smInjzdObj=false;vender.shipsvc=false;vender.shipSmIns={};vender.shipIns={};vender._shipIns={};vender.shipHtml='';vender.shipTitle='配送';vender.shipClickTag='';if(venders2){venders2.shipHtml='';venders2.shipClickTag='';venders2.isloc='';}
if(vender.containZY&&vender.containFactory){defaultJDShipTitleHtml='京东快递(部分商品由厂商配送)';}else if(vender.containFactory){defaultJDShipTitleHtml='厂商配送';}else{defaultJDShipTitleHtml='京东快递';}
g.selectPopGsd=false;if(vender.shipment.length==0){if(vender.jdShipment=='1'){titlehtml=defaultJDShipTitleHtml;}else if(vender.jdShipment=='0'){titlehtml='快递运输';}}
if(from&&['0','1'].indexOf(vender.venderType)>-1){$('#freshJzd').hide();}
for(i=0,l=vender.shipment.length;i<l;i++){item=vender.shipment[i];if(item.type=='0'&&vender.jdShipment=='1'){g.jdshipInfo={type:item.type,shipId:item.id};selId=item.id;vender.shipjd=true;shipType=item.type;if(item.selected=='1'){titlehtml=defaultJDShipTitleHtml;if(containSm&&containLa){zxjhtml='工作日、双休日与节假日均可送货';lajhtml=zxjhtml;}else if(containSm){zxjhtml='工作日、双休日与节假日均可送货';}else if(containLa){lajhtml='工作日、双休日与节假日均可送货';}
vender.selectedShip='shipjd';selectShipId=item.id;shipClickTag='shipjd';}
if(!from&&item.shipTimeType=='4'&&!item.laCalendar){vender.ship311=true;shipItem={date:item.promiseDate,time:item.promiseTimeRange,week:item.promiseWeekDay||1,sendpay:item.promiseSendPay}
if(item.selected=='1'){zxjhtml=item.promiseDate.replace(/\d{4}-/,'')+' '+
weekMap[item.promiseWeekDay]+' '+item.promiseTimeRange;shipClickTag='ship311';vender.selectedShip='ship311';vender.ship311Obj=vender._ship311Obj=shipItem;selWeek=(new Date(item.promiseDate.replace(/-/g,'/'))).getDay();}else{vender._ship311Obj=shipItem;}}else if(onlineShip.jd311shipment&&onlineShip.jd311shipment.isSupport=='1'&&!(g.supCombine&&!g.selectCombine)){curShipment=onlineShip.jd311shipment;shipItem=_shipItem=false;vender.ship311=true;if(g.supCombine&&g.selectCombine){curShipment.calendar=curShipment.combineCalendarDayList;}
vender.ship311calendar=curShipment.calendar;if(curShipment.selectDate&&curShipment.selectTime){for(j=0,k=curShipment.calendar.length;j<k;j++){_shipItem=curShipment.calendar[j];if(_shipItem.date==curShipment.selectDate&&_shipItem.time==curShipment.selectTime){shipItem=_shipItem;break;}}}
if(!shipItem){shipItem=curShipment.calendar[0];}
if(curShipment.selected=='1'&&shipItem){zxjhtml=shipItem.date.replace(/\d{4}-/,'')+' '+weekMap[shipItem.week]+' '+shipItem.time;shipClickTag='ship311';vender.selectedShip='ship311';vender.ship311Obj=vender._ship311Obj=shipItem;selWeek=shipItem?(new Date(shipItem.date.replace(/-/g,'/'))).getDay():'';}else if(!shipItem){zxjhtml='工作日、双休日与节假日均可送货';}else{vender._ship311Obj=shipItem;}
if(curShipment.supportInstall=='1'){for(j=0,k=curShipment.supportInstallSkus.length;j<k;j++){if(smSkuArr.indexOf(curShipment.supportInstallSkus[j])>-1){vender.smInstall=true;vender.shipSmIns.iOffset=curShipment.installOffset;vender.smIn311Obj={supportInstallSkus:curShipment.supportInstallSkus,installOffset:curShipment.installOffset,promiseDateOffset:curShipment.promiseDateOffset,selectDate:curShipment.selectDate,instlDateMap:curShipment.instlDateMap};break;}}}
if(curShipment.selected=='1'&&vender.smInstall){zxjinhtml=this.formatDateFromOffset(curShipment.selectDate,curShipment.promiseDateOffset,curShipment.installOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,'');}
if(curShipment.transferFlag=='1'){zxjinhtml='';supjzdjsd='';zxjhtml=curShipment.transferDays+"日内调货完成<br/>预计"+zxjhtml+"送达";vender.transferFlag=1;vender.transferDays=curShipment.transferDays;}}
if(!from&&item.shipTimeType=='6'){vender.shipjzd=true;shipItem={date:item.promiseDate,time:item.promiseTimeRange,week:item.promiseWeekDay||1,sendpay:item.promiseSendPay}
if(item.selected=='1'){zxjhtml=item.promiseDate.replace(/\d{4}-/,'')+' '+weekMap[item.promiseWeekDay]+' '+item.promiseTimeRange;shipClickTag='shipjzd';vender.selectedShip='shipjzd';vender.shipjzdObj=vender._shipjzdObj=shipItem;selWeek=(new Date(item.promiseDate.replace(/-/g,'/'))).getDay();}else{vender._shipjzdObj=shipItem;}}else if(onlineShip.zxjjzdshipment&&onlineShip.zxjjzdshipment.isSupport=='1'){curShipment=onlineShip.zxjjzdshipment;shipItem=_shipItem=false;vender.shipjzd=true;vender.jzdForceChoice=curShipment.forcedChoice;vender.shipjzdcalendar=curShipment.calendar;vender.calendarTag=curShipment.calendarTag;if(curShipment.selectDate&&curShipment.selectTime){for(j=0,k=curShipment.calendar.length;j<k;j++){_shipItem=curShipment.calendar[j];if(_shipItem.date==curShipment.selectDate&&_shipItem.time==curShipment.selectTime){shipItem=_shipItem;break;}}}
if(!shipItem){shipItem=curShipment.calendar[0];}
if(curShipment.selected=='1'){zxjhtml=shipItem.date.replace(/\d{4}-/,'')+' '+weekMap[shipItem.week]+' '+shipItem.time;shipClickTag='shipjzd';vender.selectedShip='shipjzd';vender.shipjzdObj=vender._shipjzdObj=shipItem;selWeek=shipItem?(new Date(shipItem.date.replace(/-/g,'/'))).getDay():'';if(curShipment.forcedChoice=='1'){g.needSetShip=true;wa('jdClick',{ptag:'7039.11.7'});}else{g.needSetShip=false;}}else{vender._shipjzdObj=shipItem;}
if(curShipment.supportInstall=='1'){for(j=0,k=curShipment.supportInstallSkus.length;j<k;j++){if(smSkuArr.indexOf(curShipment.supportInstallSkus[j])>-1){vender.smInstall=true;vender.shipSmIns.iOffset=curShipment.installOffset;vender.smInjzdObj={supportInstallSkus:curShipment.supportInstallSkus,installOffset:curShipment.installOffset,promiseDateOffset:curShipment.promiseDateOffset,selectDate:curShipment.selectDate,instlDateMap:curShipment.instlDateMap};break;}}}
if(curShipment.selected=='1'&&vender.smInstall){zxjinhtml=this.formatDateFromOffset(curShipment.selectDate,curShipment.promiseDateOffset,curShipment.installOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,'');}}
if(!from&&item.shipTimeType=='5'){vender.ship411=true;if(item.selected=='1'){shipClickTag='ship411';vender.selectedShip='ship411';zxjhtml='下单后或成功支付后2小时送达，运费&yen;'+(vender.freight/100).toFixed(0);vender._ship411Obj={sendpay:item.promiseSendPay};}}else if(onlineShip.jd411shipment&&onlineShip.jd411shipment.isSupport=='1'){curShipment=onlineShip.jd411shipment;vender.ship411=true;vender.ship411Obj=vender._ship411Obj=curShipment;if(curShipment.selected=='1'&&curShipment.isGray=='0'){shipClickTag='ship411';vender.selectedShip='ship411';zxjhtml='下单后或成功支付后2小时送达，运费&yen;'+(vender.ship411Obj.fee/100).toFixed(0);if(curShipment.dataFlag=='1'&&curShipment.promiseTime){zxjhtml=curShipment.promiseTime.replace(/\d{4}-(\d+)-(\d+) (\d+:\d+):\d+/,'$1月$2日$3')+'前送达';g.selectDD=true;}}else{g.selectDD=false;}}
laCalendar=item.laCalendar;if(laCalendar&&containLa){vender.isla=true;}
if(!from&&laCalendar&&laCalendar.delvDates&&containLa){vender.isla=true;vender.supShipInstall=laCalendar.supShipInstall;if(vender.supShipInstall=='1'&&laCalendar.instlDateMap){for(var inMap in laCalendar.instlDateMap){if(inMap==laCalendar.instlDateMap[inMap][0]){vender.supDfShipInstall=inMap;break;}}}
if(vender.supShipInstall=='1'&&laCalendar.defaultDOffset==laCalendar.iOffset){g.selShipInstall=true;}else{g.selShipInstall=false;}
if(laCalendar.promiseType=='4'){if(laCalendar.type=='1'){vender.shipla2=true;shipItem=_shipItem=false;vender.shipla2calendar=laCalendar;vender.selectedlaShip='shipla2';shipClickTag='shipla';if(laCalendar.promiseDate&&laCalendar.promiseTimeRange){for(j=0,k=laCalendar.calendar.length;j<k;j++){_shipItem=laCalendar.calendar[j];if(_shipItem.date==laCalendar.promiseDate&&_shipItem.time==laCalendar.promiseTimeRange){shipItem=_shipItem;break;}}}
if(!shipItem){shipItem=laCalendar.calendar.calendar[0];}
vender.shipla2Obj=vender._shipla2Obj=shipItem;lahtml=shipItem.date.replace(/\d{4}-/,'')+' '+weekMap[shipItem.week]+' '+shipItem.time;selLaWeek=shipItem?(new Date(shipItem.date.replace(/-/g,'/'))).getDay():'';}else{vender.shipla=vender._shipla=laCalendar;vender.shiplacalendar=laCalendar;shipClickTag='shipla';vender.selectedlaShip='shipla';if(laCalendar.supDelive=='1'&&laCalendar.defaultDDate){laCalendar.defaultDDate=laCalendar.defaultDDate.substr(0,10);try{lahtml=d.format(new Date(laCalendar.defaultDDate.replace(/-/g,'/')),'YYYY-MM-DD 周W').replace(/\d{4}-/,'');}catch(e){}}
selLaWeek=(new Date(laCalendar.defaultDDate.replace(/-/g,'/'))).getDay();}}else if(laCalendar.promiseType=='5'){vender.shiplajzd=true;vender.selectedlaShip='shiplajzd'
lahtml=laCalendar.promiseDate.replace(/\d{4}-/,'')+' '+weekMap[laCalendar.promiseWeekDay]+' '+laCalendar.promiseTimeRange;shipClickTag='shiplajzd';vender.selectedShip='shiplajzd';shipItem={date:item.promiseDate,time:item.promiseTimeRange,week:item.promiseWeekDay||1,sendpay:item.promiseSendPay}
vender.shiplajzdObj=vender._shiplajzdObj=shipItem;selLaWeek=(new Date(laCalendar.promiseDate.replace(/-/g,'/'))).getDay();}
vender._shipIns.iOffset=laCalendar.iOffset;vender.shipIns=vender._shipIns;if(laCalendar.supInstall=='1'&&laCalendar.instlDateMap[laCalendar.defaultDOffset]){lainhtml=this.formatDateFromOffset(laCalendar.defaultDDate,laCalendar.defaultDOffset,laCalendar.iOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,'');}
vender._selectedShip='shipla';if(vender.selectedShip!='ship311'&&vender.selectedShip!='ship411'){if(!containSm){vender.selectedShip='shipla';}
shipClickTag='shipla';}}
if(onlineShip.djdbzdshipment&&onlineShip.djdbzdshipment.delvDates&&containLa){curShipment=onlineShip.djdbzdshipment;vender.isla=true;if(curShipment.calendar.length>0){vender.shipla2=true;shipItem=_shipItem=false;vender.shipla2calendar=curShipment;if(curShipment.promiseDate&&curShipment.promiseTimeRange){for(j=0,k=curShipment.calendar.length;j<k;j++){_shipItem=curShipment.calendar[j];if(_shipItem.date==curShipment.promiseDate&&_shipItem.time==curShipment.promiseTimeRange){shipItem=_shipItem;break;}}}
if(!shipItem){shipItem=curShipment.calendar[0];}
if(curShipment.selected=='1'){vender.selectedlaShip='shipla2';lahtml=shipItem.date.replace(/\d{4}-/,'')+weekMap[shipItem.week]+' '+shipItem.time;shipClickTag='shipla2';vender.shipla2Obj=vender._shipla2Obj=shipItem;vender._shipIns.iOffset=curShipment.iOffset;vender.shipIns=vender._shipIns;selLaWeek=shipItem?(new Date(shipItem.date.replace(/-/g,'/'))).getDay():'';}else{vender._shipla2Obj=shipItem;}}else{vender.shiplacalendar=curShipment;if(curShipment.selected=='1'&&curShipment.supDelive=='1'&&curShipment.defaultDDate){vender.shipla=vender._shipla=curShipment;vender._shipIns.iOffset=curShipment.iOffset;vender.shipIns=vender._shipIns;vender.selectedlaShip='shipla';shipClickTag='shipla';curShipment.defaultDDate=curShipment.defaultDDate.substr(0,10);try{lahtml=d.format(new Date(curShipment.defaultDDate.replace(/-/g,'/')),'YYYY-MM-DD 周W').replace(/\d{4}-/,'');selLaWeek=(new Date(curShipment.defaultDDate.replace(/-/g,'/'))).getDay();}catch(e){}}else{vender._shipla=curShipment;}}
vender.supShipInstall=curShipment.supShipInstall;if(curShipment.selected=='1'){if((vender.selectedlaShip=='shipla'&&vender.shipla.defaultDOffset==vender._shipIns.iOffset)||(vender.selectedlaShip=='shipla2'&&vender.shipla2Obj.reservingDate==vender._shipIns.iOffset)){g.selShipInstall=true;$('#supshipDesc').html('安装师傅带货上门，同时提供送货和安装服务');$('#supshipinTip').show();}else{g.selShipInstall=false;$('#supshipDesc').html('配送和安装选择同一天，可同时提供送货和安装服务');g.modifyShip?$('#supshipinTip').hide():$('#supshipinTip').show();}
if(curShipment.supInstall=='1'&&curShipment.instlDateMap[curShipment.defaultDOffset]){lainhtml=this.formatDateFromOffset(curShipment.defaultDDate,curShipment.defaultDOffset,curShipment.iOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,'');}
vender._selectedShip='shipla';if(vender.selectedShip!='ship311'&&vender.selectedShip!='ship411'){if(!containSm){vender.selectedShip='shipla';}
shipClickTag='shipla';}}else{g.selShipInstall=false;if(curShipment.supShipInstall=='1'){$('#supshipDesc').html('配送和安装选择同一天，可同时提供送货和安装服务');g.modifyShip?$('#supshipinTip').hide():$('#supshipinTip').show();}}}
if(onlineShip.djdjzdshipment&&onlineShip.djdjzdshipment.delvDates&&containLa){curShipment=onlineShip.djdjzdshipment;vender.isla=true;vender.shiplajzd=true;shipItem=_shipItem=false;vender.shiplajzdcalendar=curShipment;if(curShipment.promiseDate&&curShipment.promiseTimeRange){for(j=0,k=curShipment.calendar.length;j<k;j++){_shipItem=curShipment.calendar[j];if(_shipItem.date==curShipment.promiseDate&&_shipItem.time==curShipment.promiseTimeRange){shipItem=_shipItem;break;}}}
if(!shipItem){shipItem=curShipment.calendar[0];}
if(curShipment.selected=='1'){lahtml=shipItem.date.replace(/\d{4}-/,'')+' '+weekMap[shipItem.week]+' '+shipItem.time;shipClickTag='shiplajzd';vender.selectedlaShip='shiplajzd';vender.shiplajzdObj=vender._shiplajzdObj=shipItem;vender._shipIns.iOffset=curShipment.iOffset;vender.shipIns=vender._shipIns;if(curShipment.supInstall=='1'&&curShipment.instlDateMap[shipItem.reservingDate]){lainhtml=this.formatDateFromOffset(curShipment.promiseDate,curShipment.defaultDOffset,curShipment.iOffset,'YYYY-MM-DD 周W').replace(/\d{4}-/,'');}
vender._selectedShip='shipla';selLaWeek=shipItem?(new Date(shipItem.date.replace(/-/g,'/'))).getDay():'';if(vender.selectedShip!='ship311'&&vender.selectedShip!='ship411'){if(!containSm){vender.selectedShip='shipla';}
shipClickTag='shipla';}}else{vender._shiplajzdObj=shipItem;}}
if(onlineShip.jdla411shipment&&onlineShip.jdla411shipment.isSupport=='1'&&containLa){curShipment=onlineShip.jdla411shipment;vender.shipla411=true;vender.shipla411Obj=vender._shipla411Obj=curShipment;if(curShipment.selected=='1'){shipClickTag='shipla411';vender.selectedlaShip='shipla411';vender._selectedShip='shipla';selLaWeek=(new Date(curShipment.codDate.replace(/-/g,'/'))).getDay();lahtml='预计'+curShipment.speedHour+'小时内送达';if(curShipment.isSupportInstall=='1'){vender._shipIns.iOffset=vender._shipla411Obj.installDate;lainhtml=this.formatDateFromOffset(curShipment.codDate,'0',curShipment.installDate,'YYYY-MM-DD 周W').replace(/\d{4}-/,'');}}}
if(vender.isSupShipSvc=='1'&&vender.selShipSvc){g.isSupShipSvc=vender.isSupShipSvc;svchtml=vender.selShipSvc;}
if(((containSm&&vender.shipjzd)||(containLa&&vender.shiplajzd))&&!vender.transferFlag){supjzdjsd='京准达';}
if(((vender.ship411&&vender._ship411Obj.isGray=='0'&&containSm)||(vender.shipla411&&vender._shipla411Obj.isSupport=='1'&&containLa))&&!vender.transferFlag){supjzdjsd=supjzdjsd?supjzdjsd+'和极速达':'极速达';}
if((containSm&&vender.selectedShip=='shipjzd')||(containLa&&vender.selectedlaShip=='shiplajzd')){seljzdjsd='京准达';}
if(vender.selectedShip=='ship411'||vender.selectedlaShip=='shipla411'){seljzdjsd=seljzdjsd?'京准达和极速达':'极速达';}
if(supjzdjsd){supjzdjsd='<span class="jd_support">(可选'+supjzdjsd+')</span>';}
if(seljzdjsd){supjzdjsd='<span class="jd_support">(已选'+seljzdjsd+')</span>';}
if(!shipClickTag){supjzdjsd='';}
if(g.needSetShip&&vender.jzdForceChoice=='1'){supjzdjsd='';}
if(svchtml){titlehtml+='和安装';vender.shipTitle='配送和安装';}
if(!(vender.containFactory&&vender.containZY)){titlehtml+=supjzdjsd;}
if(vender.selectedShip=='shipjzd'&&g.needSetShip&&vender.jzdForceChoice=='1'){if(g.modifyShip){$('#freshJzd span').html(vender.shipjzdObj.date.substr(vender.shipjzdObj.date.indexOf('-')+1)+' '+
weekMap[vender.shipjzdObj.week]+' '+vender.shipjzdObj.time+'</small>');}
$('#freshJzd img').attr('src','//img11.360buyimg.com/jdphoto/s92x30_jfs/t5560/306/470424583/670/c684bc0e/590065e4N52153346.png');$('#freshJzd').removeClass('noClick').show();$('#freshJzd').attr('data-shiptype','jzd');}}else if(item.type=='8'){if(['1','3'].indexOf(item.supportGSDInfo)>-1){vender.shipGsd=true;}
if(item.supportGSDInfo=='2'){vender.gsdPart=true;}
g.selectGsd=false;vender._shipGsdObj={};if(item.selected=='1'){titlehtml='同城速配';shipClickTag='shipGsd';shipType=item.type;vender.selectedShip='shipGsd';zxjhtml='工作日、双休日与节假日均可送货';vender._shipGsdObj=vender.shipGsdObj={};selectShipId=item.id;g.selectGsd=true;if(!g.gsdPtagExposure){g.gsdPtagExposure=true;wa('ptagExposure',{ptag:'7039.11.22'});}}
if(onlineShip.gsdshipment&&onlineShip.gsdshipment.isSupport=='1'){curShipment=onlineShip.gsdshipment;vender._shipGsdObj=vender.shipGsdObj=curShipment;shipItem=_shipItem=false;vender.gsdForceChoice=curShipment.forcedChoice;if(curShipment.calendar){vender.shipGsdcalendar=curShipment.calendar;vender.forcedChoice=curShipment.forcedChoice;vender.speedHour=(curShipment.speedHour||'1').replace('0.5','半');if(curShipment.promiseDate&&curShipment.promiseTimeRange){for(j=0,k=curShipment.calendar.length;j<k;j++){_shipItem=curShipment.calendar[j];if(_shipItem.date==curShipment.promiseDate&&_shipItem.time==curShipment.promiseTimeRange){shipItem=_shipItem;break;}}}
if(!shipItem){shipItem=curShipment.calendar[0];}}
if(curShipment.selected=='1'){titlehtml='同城速配';shipClickTag='shipGsd';shipType=item.type;vender.selectedShip='shipGsd';if(curShipment.calendar&&curShipment.calendar.length>0){vender.shipGsdObj=vender._shipGsdObj=shipItem;selWeek=shipItem?(new Date(shipItem.date.replace(/-/g,'/'))).getDay():'';zxjhtml=[shipItem.date.replace(/\d{4}-/,''),weekMap[shipItem.week],shipItem.time].join(' ').replace(/.+立即送达/,'下单后'+vender.speedHour+'小时内送达');if(curShipment.forcedChoice=='1'){g.needSetShip=true;}}else{zxjhtml='工作日、双休日与节假日均可送货';}
g.selectGsd=true;selectShipId=item.id;}else if(curShipment.calendar){vender._shipGsdObj=shipItem;}
if(vender.selectedShip=='shipGsd'&&g.needSetShip&&vender.gsdForceChoice=='1'){$('#freshJzd img').attr('src','//img11.360buyimg.com/jdphoto/s97x30_jfs/t25978/360/478035480/2530/d4998cc5/5b71279cN707cb891.png');$('#freshJzd span').html('请选择京瞬达配送时效');$('#freshJzd').attr('data-shiptype','gsd');if(g.modifyShip){$('#freshJzd span').html(zxjhtml+'</small>');}
$('#freshJzd').removeClass('noClick').show();}}
if(option.isPingou&&!g.selectGsd){vender.shipGsd=false;}}else if(item.type=='9'){vender.shipPopGsd=true;vender.shipPopGsdCalendar=undefined;vender._shipPopGsdObj={};vender.speedHour='';if(from){$('[type="deliveryTimePopGsd"][venderid="'+vender.venderId+'"]').hide();}
if(item.selected=='1'){titlehtml='同城速配';shipClickTag='shipPopGsd';shipType=item.type;vender.selectedShip='shipPopGsd';zxjhtml='工作日、双休日与节假日均可送货';vender._shipPopGsdObj=vender.shipPopGsdObj={};selectShipId=item.id;g.selectPopGsd=true;if(!g['popGsdPtagExposure'+vender.venderId]){g['popGsdPtagExposure'+vender.venderId]=true;wa('ptagExposure',{ptag:'7039.11.25'});}}
if(onlineShip.vendershiptime&&onlineShip.vendershiptime[vender.venderId]){shiptime=onlineShip.vendershiptime[vender.venderId];shipItem=_shipItem=false;if(shiptime.calendar instanceof Array&&shiptime.calendar.length>0){for(j=0,k=onlineShip.vendershiptime[vender.venderId].calendar.length;j<k;j++){_shipItem=shiptime.calendar[j];if(_shipItem.date==shiptime.promiseDate&&_shipItem.time==shiptime.promiseTimeRange){shipItem=_shipItem;break;}}
if(!shipItem){shipItem=shiptime.calendar[0];}
vender.shipPopGsdCalendar=shiptime.calendar;vender.shipPopGsdObj=vender._shipPopGsdObj=shipItem;}
vender.speedHour=(shiptime.speedHour||'').replace('0.5','半');if(shiptime.forcedChoice=='1'){vender.popGsdForceChoice='1';}else{vender.popGsdForceChoice='0';}
if(shiptime.selSopGsd=='1'){vender.selectedShip='shipPopGsd';shipClickTag='shipPopGsd';g.selectPopGsd=true;titlehtml='同城速配';if(shiptime.calendar&&shiptime.calendar.length>0){vender.shipPopGsdObj=vender._shipPopGsdObj=shipItem;selWeek=shipItem?(new Date(shipItem.date.replace(/-/g,'/'))).getDay():'';zxjhtml=[shipItem.date.replace(/\d{4}-/,''),weekMap[shipItem.week],shipItem.time].join(' ').replace(/.+立即送达/,'下单后'+vender.speedHour+'小时内送达');if(shiptime.forcedChoice=='1'){g.needSetShip=true;}}else{zxjhtml='工作日、双休日与节假日均可送货';}}
if(vender.selectedShip=='shipPopGsd'&&shiptime.forcedChoice=='1'&&shiptime.calendar&&shiptime.calendar.length>0){var domSelector='[type="deliveryTimePopGsd"][venderid="'+vender.venderId+'"]';$(domSelector+' img').attr('src','//img11.360buyimg.com/jdphoto/s97x30_jfs/t25978/360/478035480/2530/d4998cc5/5b71279cN707cb891.png');$(domSelector+' span').html('请选择京瞬达配送时效');$(domSelector).attr('data-shiptype','popgsd');if(g.modifyShip){$(domSelector+' span').html(zxjhtml+'</small>');}
$(domSelector).removeClass('noClick').show();}}}else if(item.type=='5'){vender.shipSopjd=item;if(item.selected=='1'){vender.selectedShip='shipSopjd';shipType=item.type;selectShipId=item.id;titlehtml=defaultJDShipTitleHtml;if(vender.isSupShipSvc=='1'&&vender.selShipSvc){g.isSupShipSvc=vender.isSupShipSvc;svchtml=vender.selShipSvc;if(vender.venderType!='0'&&vender.venderType!='1'){vender.shipsvc=true;}}}
if(vender.shipment.length>1){shipClickTag='shipSopjd';}
if(!g.sopjdBG){g.sopjdBG=true;wa('ptagExposure',{ptag:'7039.1.93'});}}else if((item.type=='1'||item.type=='2')&&vender.jdShipment=='0'){if(item.type=='1'){vender.ship3=item;}else if(item.type=='2'){vender.shipSop=item;}
shipType=item.type;selectShipId=item.id;if(item.selected=='1'){titlehtml='快递运输';vender.selectedShip=item.type=='1'?'ship3':'shipSop';}
if(vender.shipment.length>1){shipClickTag=item.type=='1'?'ship3':'shipSop';}
if(vender.isSupShipSvc=='1'){zxjhtml='工作日、双休日与节假日均可送货';}
if(vender.isSupShipSvc=='1'&&vender.selShipSvc){g.isSupShipSvc=vender.isSupShipSvc;svchtml=vender.selShipSvc;if(vender.venderType!='0'&&vender.venderType!='1'){vender.shipsvc=true;}}else if(!vender.svcAndShip){zxjhtml='工作日、双休日与节假日均可送货';}}else if((item.type=='1'||item.type=='2')&&vender.jdShipment=='1'){pu.umpReport({bizid:1,operation:88,result:1,source:'0',message:'shipErr'});if(item.type=='1'){vender.ship3=item;}else if(item.type=='2'){vender.shipSop=item;}
if(item.selected=='1'){vender.selectedShip=item.type=='1'?'ship3':'shipSop';}
shipType=item.type;selectShipId=item.id;titlehtml='快递运输';}else if(item.type=='4'&&item.selected=='1'&&vender.jdShipment=='0'){vender.isTenVideo=true;if(vender.isloc){g.fpbarTipLoc=true;}else{g.fpbarTipTen=true;}
shipType=item.type;selectShipId=item.id;}else if(item.type=='3'||item.type=='6'){if(onlineShip.pickshipment&&item.type=='3'){item=onlineShip.pickshipment;}else if(onlineShip.vendershiptime&&onlineShip.vendershiptime[vender.venderId]&&item.type=='6'){item=onlineShip.vendershiptime[vender.venderId].pickshipment;}
for(j=0,k=item.notSupSkuids.length;j<k;j++){if(vender.skuIds.indexOf(item.notSupSkuids[j]+'')>=0){supZT=false;}}
if(!supZT){continue;}
vender.shipziti=item;selzitiId=item.id;if(item.type=='3'&&!vender.containFresh){g.supPick=true;}
if(item.selected=='1'){titlehtml='自提';shipType=item.type;zxjhtml='';item.picked=this.getSelPickItem(item.pickList);zthtml=item.picked.pickName;if(item.shipmentTimeType!='3'&&item.shipmentTimeType){zthtml+='&nbsp;'+item.date.substr(0,10).replace(/\d{4}-/,'');}
vender._shipzitiObj=vender.shipzitiObj={'addr':item.picked,'date':item.date,'shipmentTimeType':item.shipmentTimeType,'item':item};vender.selectedShip='shipziti';shipClickTag='shipziti';}else{ztDefAddrForNoSel=item.pickList[0];item.pickList.forEach(function(item){if(item.selected=='1'&&item.available=='1'){ztDefAddrForNoSel=item;}});vender._shipzitiObj={'addr':ztDefAddrForNoSel,'date':item.dateList[0]?item.dateList[0].date:'','shipmentTimeType':item.shipmentTimeType,'item':item};}
vender.shipzitiPickList=item.pickList;}else if(item.type=='7'&&item.supported=='1'){if(onlineShip.vendershiptime&&onlineShip.vendershiptime[vender.venderId]){item=onlineShip.vendershiptime[vender.venderId].pickShop;}
vender.shipShopPick=item;if(item&&item.selected=='1'){selectShipId=item.id;vender.selectedShip='shipShopPick';}}
if(onlineShip.vendershiptime&&onlineShip.vendershiptime[vender.venderId]){shiptime=onlineShip.vendershiptime[vender.venderId];shipType=shiptime.shipType;shipClickTag='shipSop';shipItem=_shipItem=false;if((shipType=='2'||shipType=='5')&&shiptime.djdbzdshipment&&shiptime.djdbzdshipment.supDelive=='1'){vender.isla=true;vender.shiplaSopjd=true;if(!containSm){vender.ship3=false;vender.shipSop=false;}
vender.shipla=vender._shipla=shiptime.djdbzdshipment;vender.selectedlaShip='shipla';vender.shiplacalendar=shiptime.djdbzdshipment;vender.shipid=selectShipId;vender.shiptype=shiptime.shipType;lahtml=d.format(new Date(shiptime.djdbzdshipment.defaultDDate.replace(/-/g,'/')),'YYYY-MM-DD 周W').replace(/\d{4}-/,'');selLaWeek=shiptime?(new Date(shiptime.djdbzdshipment.defaultDDate.replace(/-/g,'/'))).getDay():'';}
if(shipType=='2'&&(containSm||!vender.shiplaSopjd)){titlehtml='快递运输';vender.selectedShip='shipSop';selectShipId='67';if(shiptime.calendar&&shiptime.calendar.length>0){for(j=0,k=shiptime.calendar.length;j<k;j++){_shipItem=shiptime.calendar[j];if(_shipItem.date==shiptime.promiseDate&&_shipItem.time==shiptime.promiseTimeRange){shipItem=_shipItem;}}
vender.sopCalendar=shiptime.calendar;vender.shipSopObj=vender._shipSopObj=shipItem;vender.sopDefault={sendHtml:[shipItem.date,weekMap[shipItem.week],shipItem.time].join(' ')||'工作日、双休日与节假日均可送货'};}else{vender.sopDefault={sendHtml:shiptime.promiseMsg||'工作日、双休日与节假日均可送货'};}}else if(shipType=='5'&&(containSm||!vender.shiplaSopjd)){titlehtml=defaultJDShipTitleHtml;vender.selectedShip='shipSopjd';selectShipId='68';if(shiptime.calendar&&shiptime.calendar.length>0){for(j=0,k=onlineShip.vendershiptime[vender.venderId].calendar.length;j<k;j++){_shipItem=shiptime.calendar[j];if(_shipItem.date==shiptime.promiseDate&&_shipItem.time==shiptime.promiseTimeRange){shipItem=_shipItem;}}
vender.sopjdCalendar=shiptime.calendar;vender.shipSopjdObj=vender._shipSopjdObj=shipItem;vender.sopDefault={sendHtml:[shipItem.date.replace(/\d{4}-/,''),weekMap[shipItem.week],shipItem.time].join(' ')||'工作日、双休日与节假日均可送货'};selWeek=shipItem?(new Date(shipItem.date.replace(/-/g,'/'))).getDay():'';}else{vender.sopDefault={sendHtml:shiptime.promiseMsg||'工作日、双休日与节假日均可送货'};}}else if(shipType=='1'&&(containSm||!vender.shiplaSopjd)){titlehtml='快递运输';vender.selectedShip='ship3';vender.sopDefault={sendHtml:shiptime.promiseMsg||'工作日、双休日与节假日均可送货'};}else if((shipType=='3'||shipType=='6')&&(containSm||!vender.shiplaSopjd)){zxjhtml='';titlehtml='自提';vender.selectedShip='shipziti';vender._shipzitiObj=vender.shipzitiObj={'addr':shiptime.pickshipment.selPick,'date':shiptime.pickshipment.date,'shipmentTimeType':shiptime.pickshipment.shipmentTimeType,'item':shiptime.pickshipment};zthtml=shiptime.pickshipment.selPick.pickName;if(shiptime.pickshipment.shipmentTimeType!=3&&shiptime.pickshipment.shipmentTimeType){zthtml+='&nbsp;'+shiptime.pickshipment.date.substr(0,10).replace(/\d{4}-/,'');}}else if(shipType=='7'){titlehtml='门店自提';var shipShopPickHtml=shiptime.pickShop&&shiptime.pickShop.picked&&shiptime.pickShop.picked.name;}else if(shipType=='9'){shipClickTag='shipPopGsd';}
if(shiptime.selPick!='1'){zxjhtml=vender.sopDefault?vender.sopDefault.sendHtml.replace('/\d{4}-/',''):zxjhtml;}}
if(jdhonorshipment&&jdhonorshipment.canCheckFlag=='1'){vender.showHonor=true;vender.shiphonorObj=jdhonorshipment;vender._shiphonorObj=jdhonorshipment;vender.shiphonor=(jdhonorshipment.checkedFlag=='1');if(vender.shiphonor){titlehtml='京尊达';}}}
if(!from&&['0','1'].indexOf(vender.venderType)>-1&&['shipjzd','shipGsd'].indexOf(vender.selectedShip)==0){$('#freshJzd').hide();}
if(!from&&vender.selectedShip!='shipPopGsd'){$('[type="deliveryTimePopGsd"][venderid="'+vender.venderId+'"]').hide();}
if(!titlehtml){titlehtml='快递运输';}
html='<p>'+titlehtml+'</p>';if(lahtml&&containLa&&!(vender.selectedShip=='shipPopGsd'&&containSm)){if(lahtml.indexOf('工作日')>-1&&titlehtml.indexOf('快递运输')>-1&&['0','1'].indexOf(vender.venderType)>-1){lahtml=lahtml.replace('工作日、双休日与节假日均可送货','地址超出京东配送范围，将由其他快递配送');}
html+='<div class="type_justify"><div class="left">大件送货时间</div>'+lahtml+'</div>';}
if(lainhtml&&containLa){html+='<div class="type_justify"><div class="left">大件安装时间</div>'+lainhtml+'</div>';}
if(zxjhtml&&containSm&&!(g.needSetShip&&((vender.selectedShip=='shipjzd'&&vender.jzdForceChoice=='1')||(vender.selectedShip=='shipGsd'&&vender.gsdForceChoice=='1')||(vender.selectedShip=='shipPopGsd'&&vender.popGsdForceChoice=='1')))){if(vender.isVenderCrossRegion=='needPay'){zxjhtml='&nbsp;&nbsp;为您外地跨区调货，需加收调货服务费'+
(zxjhtml.indexOf('工作日')>-1?'<br/>'+zxjhtml:'<br/>预计'+zxjhtml+'送达');}else if(vender.isVenderCrossRegion=='isFree'){zxjhtml='&nbsp;&nbsp;为您外地跨区调货，暂免调货服务费'+
(zxjhtml.indexOf('工作日')>-1?'<br/>'+zxjhtml:'<br/>预计'+zxjhtml+'送达');}
if(!lagerScreen){zxjhtml=zxjhtml.replace('<br/>','，');}
if(zxjhtml.indexOf('工作日')>-1&&titlehtml.indexOf('快递运输')>-1&&['0','1'].indexOf(vender.venderType)>-1){zxjhtml=zxjhtml.replace('工作日、双休日与节假日均可送货','地址超出京东配送范围，将由其他快递配送');}
if(g.supCombine&&(vender.selectedShip=='shipjd'||vender.selectedShip=='ship311'||vender.shiphonor)){if(!g.bgFlag.combship){wa('ptagExposure',{ptag:'7039.11.19'});g.bgFlag.combship=true;}
if(g.selectCombine){html+='<div class="type_justify"><div class="left">中小件合并送货时间</div>'+zxjhtml+'</div>';}else{zxjhtml+='<br/><p class="color_red" style="margin:0">'+(containLa?'中小件':'商品')+'将分批送达，可选合并送货</p>';html+='<div class="type_justify"><div class="left">中小件送货时间</div>'+zxjhtml+'</div>';}}else{html+='<div class="type_justify"><div class="left">中小件送货时间</div>'+zxjhtml+'</div>';}
if(vender.selectedShip=='shipPopGsd'){html=html.replace('中小件送货时间','送货时间')}}
if(zxjinhtml){html+='<div class="type_justify"><div class="left">中小件安装时间</div>'+zxjinhtml+'</div>';}
if(zthtml&&containSm){if(vender.isVenderCrossRegion=='needPay'){zthtml='&nbsp;&nbsp;为您外地跨区调货，需加收调货服务费<br/>'+zthtml;}else if(vender.isVenderCrossRegion=='isFree'){zthtml='&nbsp;&nbsp;为您外地跨区调货，暂免调货服务费<br/>'+zthtml;}
html+='<div class="type_justify"><div class="left"></div>'+zthtml+'</div>';}
if(svchtml){html+='<div class="type_justify"><div class="left">安装服务</div>'+svchtml+'</div>';}
if(shipShopPickHtml){html+='<div class="type_justify"><div class="left"></div>'+shipShopPickHtml+'</div>';}
if(containSm&&containLa){selWeek=['0','1','2','3','4','5','6'].indexOf(selWeek+'')>-1?selWeek+'':((selLaWeek+'')||'');}else if(containLa){selWeek=selLaWeek;}
selWeek+='';if(selWeek&&window.dealLocker){tipLock=dealLocker.filter(function(e){return e.lockvalue=='1'&&e.mark=='double11_tip1'&&pu.isDuringDate(e.begintime,e.endtime);});}
if(selWeek&&tipLock&&tipLock[0]&&!(vender.selectedShip=='shipjzd'&&g.needSetShip&&!g.modifyShip)){if(tipLock[0]){if(['1','2','3','4','5'].indexOf(selWeek+'')>-1){html+='<p class="color_red">'+tipLock[0].ext.split('|')[0]+'</p>'}else{html+='<p class="color_red">'+tipLock[0].ext.split('|')[1]+'</p>'}}}
vender.shipHtml=html;vender.shipClickTag=shipClickTag;if(venders2){venders2.shipHtml=html;venders2.shipClickTag=shipClickTag;venders2.shipTitle=vender.shipTitle+'服务';}
if(venders2&&vender.isTenVideo){venders2.isTenVideo=vender.isTenVideo;}
if(venders2&&vender.supShipInstall){venders2.supShipInstall=vender.supShipInstall;g.supShipInstall=vender.supShipInstall;}
if(g.supShipInstall=='1'){wa('jdClick',{ptag:'7039.11.12'});}
if(venders2&&vender.isloc){venders2.isloc=true;}
if(venders2&&vender.containFresh){venders2.containFresh=true;}
if(vender.ship311||vender.ship411||vender.shipjzd||vender.shipla2||vender.shipla||vender.shiplajzd){g.supSelShipTime=true;}
if(vender.selectedShip=='ship311'||vender.selectedShip=='ship411'||vender.selectedShip=='shipjzd'||vender._selectedShip=='shipla'){selectShipId=selId;}else if(vender.selectedShip=='shipziti'){selectShipId=selzitiId;}
shipDataId=(vender.venderType=='0'||vender.venderType=='1')?'0':vender.venderId;g.setPayShipData[shipDataId]=this.getSetPayShipParamData({'vender':vender,'shipType':shipType,'selectShipId':selectShipId});return html;},handleShipeffect:function(option){var _data,jdhonorshipment,vendershiptime,item,shipArr=new Array(20),i;_data={'reg':1,'action':option.action,'reset':0,'callback':'cb_shipeffect'};if(option.usePcPrice=='1'){_data.platprice=1;}
if(option.reset){_data.reset=1;}
pu.wrapData(_data);if(g.shiptag){_data.shiptag=g.shiptag;}
if(option.paytypeforpresale){_data.paytypeforpresale=option.paytypeforpresale;}
window.cb_shipeffect=function(d){waitshipTimer&&clearTimeout(waitshipTimer);if(option.isPingou&&g.selectGsd&&g.jdshipInfo&&!g.reChoosed){g.reChoosed=true;d.reChoose='1';d.selectShipId=g.jdshipInfo.shipId;option.callback&&option.callback(d);option.useshipData='0';shipObj.handleShipeffect(option);return;}
option.callback&&option.callback(d);if(d.errId=='0'){g.onlineShip.jd311shipment=d.jd311shipment||null;g.onlineShip.jd411shipment=d.jd411shipment||null;g.onlineShip.zxjjzdshipment=d.zxjjzdshipment||null;g.onlineShip.pickshipment=d.pickshipment||null;g.onlineShip.djdjzdshipment=d.djdjzdshipment||null;g.onlineShip.djdbzdshipment=d.djdbzdshipment||null;g.onlineShip.jdla411shipment=d.jdla411shipment||null;g.onlineShip.gsdshipment=d.gsdshipment||null;if(d.venderhonorfreightInsure&&d.venderhonorfreightInsure.length>0){jdhonorshipment={};for(i=0;i<d.venderhonorfreightInsure.length;i++){item=d.venderhonorfreightInsure[i];jdhonorshipment[item.venderId]=item;}}
g.onlineShip.jdhonorshipment=jdhonorshipment||null;g.supCombine=(d.jd311shipment&&d.jd311shipment.supportCombine>0)||false;g.selectCombine=(d.jd311shipment&&d.jd311shipment.isCombine>0)||false;if(g.supCombine&&g.selectCombine&&g.onlineShip.jd311shipment.combineCalendarDayList&&g.onlineShip.jd311shipment.combineCalendarDayList.length>0){g.onlineShip.jd311shipment.isSupport='1';g.onlineShip.jd311shipment.selected='1';}
if(d.vendershiptime&&d.vendershiptime.length>0){vendershiptime={};for(i=0;i<d.vendershiptime.length;i++){item=d.vendershiptime[i];vendershiptime[item.venderId]=item;}}
g.onlineShip.vendershiptime=vendershiptime||null;option.callbackSuc&&option.callbackSuc({json:d,onlineShip:g.onlineShip});}}
if(window.locker.preShipData&&option.useshipData==1){if(window.shipData){cb_shipeffect(window.shipData);}else{waitShipData(10);}}else{loadJs.loadScript({url:g.isGlobalPay?cgi.globalPay_getShipeffect:cgi.getShipeffect,data:_data});}
function waitShipData(time){waitshipTimer=window.setTimeout(function(){if(window.shipData){cb_shipeffect(window.shipData);}else{waitShipData(50);}},time);}},showSelectShip:function(option){var orderObj=option.orderObj,usePcPrice=option.usePcPrice,callback=option.callback,setSvcCallback=option.setSvcCallback,action=option.action,paytypeforpresale=option.paytypeforpresale,addr=addressCom.getDefAddrFromWqAddr(),html='',selHtml,venderId=orderObj.selectShip.venderId,vender=orderObj.vendersById[venderId],combind=orderObj.combind,that=this,temp_ship=vender.selectedShip,shipDataId,initItemArr=[],_shipItem,jdhonorshipment=null;if(vender.venderType=='0'||vender.venderType=='1'){jdhonorshipment=g.onlineShip&&g.onlineShip.jdhonorshipment&&g.onlineShip.jdhonorshipment[0];}else{jdhonorshipment=g.onlineShip&&g.onlineShip.jdhonorshipment&&g.onlineShip.jdhonorshipment[vender.venderId];}
if(option.action||option.action=='0'){g.action=option.action;}
g.installChange=false;g.svcChange=false;g._zxjJzdFee=0;g._djdJzdFee=0;if(!$('#addressCss').length){pu.loadCss(JD.url.getStaticDisRec('//wq.360buyimg.com/fd/h5/wxsq_dev/gb/css/mod_address_slide.min_c74dbaf7.css'),'addressCss');}
if(!vender._ship311Obj&&vender.ship311Obj){vender._ship311Obj=vender.ship311Obj;}
if(!vender._shipzitiObj&&vender.shipzitiObj){vender._shipzitiObj=vender.shipzitiObj;}
if(!vender._shipla&&vender.shipla){vender._shipla=vender.shipla;}
if(g.supCombine&&(vender.selectedShip=='shipjd'||vender.selectedShip=='ship311'||vender.shiphonor)){vender.supCombine=true;vender.selectCombine=g.selectCombine;if(g.selectCombine&&g.onlineShip.jd311shipment.combineCalendarDayList.length>0){_shipItem=g.onlineShip.jd311shipment;_shipItem.calendar=g.onlineShip.jd311shipment.combineCalendarDayList;shipItem={date:_shipItem.selectDate,time:_shipItem.selectTime,week:_shipItem.week||1,sendpay:_shipItem.selectSendpay,batchId:_shipItem.batchId}
vender.ship311=true;vender.selectedShip='ship311';vender.ship311calendar=g.onlineShip.jd311shipment.combineCalendarDayList;vender._ship311Obj=vender.ship311Obj=shipItem;}else{vender.ship311=false;vender.selectedShip='shipjd';}}
$('#pickList').empty();$('#shopList').empty();html=shipTpl.child_selectShipV2Tpl({'vender':vender,'products':combind?orderObj.venders[combind].products:'','containLa':g.containLa,'samZxjGsdShipFee':orderObj.samZxjGsdShipFee,'zxjGsdFee':orderObj.zxjGsdFee,'freshGsdFee':orderObj.freshGsdFee,'walmartGsdFee':orderObj.walmartGsdFee,'formatDateFromOffset':this.formatDateFromOffset});$('#selectShip').html(html);selHtml=shipTpl.child_shipV2Tpl({'vender':vender,'zxjJsdTipFee':orderObj.zxjJsdTipFee,'formatDateFromOffset':this.formatDateFromOffset,'getDayType':pu.getDayType});$('#shipSelDiv').html(selHtml);if(window.mConfirm){pu.pingClick(true,'MNeworder_PayType','','');}
if(vender.selectedShip==='shipShopPick'){$('[type_con="shipShopPick"]').show();}else if(vender.selectedShip==='shipGsd'){$('[type_con="shipGsd"]').show();}else if(vender.selectedShip=='shipziti'){$('[type_con="shipziti"]').show();}else if(vender.selectedShip==='shipPopGsd'){$('[type_con="shipPopGsd"]').show();}else{$('[type_con="shipjd"]').show();}
if(vender.smInstall&&vender.selectedShip=='ship311'&&vender.smIn311Obj){$('#smshipin').show();}else if(vender.smInstall&&vender.selectedShip=='shipjzd'&&vender.smInjzdObj){$('#smshipin').show();}else if(vender.smInstall){$('#smshipin').hide();}
if(vender.shipsvc){handleSvc();}else if(vender.supService){handleService();}
if(vender._selectedShip!='shipla'){pu.myBind({'src':'#shipType [type]','fun':function(e,$this){if($this.hasClass('selected')){return;}
var type=$this.attr('type'),data,selectShipId=$this.attr('shipid'),shipType=$this.attr('curShipType'),shipData=g.setPayShipData;if(type==='shipziti'){$('[type_con="shipjd"]').hide();$('[type_con="shipShopPick"]').hide();$('[type_con="shipGsd"]').hide();$('[type_con="shipPopGsd"]').hide();$('[type_con="shipziti"]').show();}else if(type==='shipShopPick'){$('[type_con="shipziti"]').hide();$('[type_con="shipjd"]').hide();$('[type_con="shipGsd"]').hide();$('[type_con="shipPopGsd"]').hide();$('[type_con="shipShopPick"]').show();}else if(type==='shipGsd'){$('[type_con="shipziti"]').hide();$('[type_con="shipjd"]').hide();$('[type_con="shipShopPick"]').hide();$('[type_con="shipPopGsd"]').hide();$('[type_con="shipGsd"]').show();}else if(type==='shipPopGsd'){$('[type_con="shipziti"]').hide();$('[type_con="shipjd"]').hide();$('[type_con="shipShopPick"]').hide();$('[type_con="shipGsd"]').hide();$('[type_con="shipPopGsd"]').show();}else{$('[type_con="shipziti"]').hide();$('[type_con="shipShopPick"]').hide();$('[type_con="shipGsd"]').hide();$('[type_con="shipPopGsd"]').hide();$('[type_con="shipjd"]').show();}
this.$src.removeClass('selected');$this.addClass('selected');g.shipChange=true;g.shipNeedRedeal=true;if(vender.selectedShip=='shipGsd'&&type!='shipGsd'&&!g.gsdJdClick){g.gsdJdClick=true;wa('jdClick',{ptag:'7039.11.23'});}
if(vender.selectedShip=='shipPopGsd'&&type!='shipPopGsd'&&!g.popGsdJdClick){g.popGsdJdClick=true;wa('jdClick',{ptag:'7039.11.26'});}
vender.selectedShip=type;vender.shiphonor=(type=='shiphonor');if(shipType=='1'||shipType=='2'){wa('jdClick',{ptag:'7039.1.95'});}else if(shipType=='5'){wa('jdClick',{ptag:'7039.1.94'});}
shipDataId=(vender.venderType=='0'||vender.venderType=='1')?'0':venderId;g.setPayShipData[shipDataId]=that.getSetPayShipParamData({'vender':vender,'shipType':shipType,'selectShipId':selectShipId,'choose':1});data=pu.clone(shipData[shipDataId]);data.ship=that.getShipData()[0];data.pick=that.getShipData()[1];if(usePcPrice=='1'){data.platprice=1;}
pu.wrapData(data);if(paytypeforpresale){data.paytypeforpresale=paytypeforpresale;}
pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_chooseship:cgi.chooseship,'data':data,'reportCallback':function(id,msg,d){pu.umpReport({bizid:1,operation:85,result:id,source:'0',message:msg});},'success':function(d){var shipItem,_shipItem,venderFeeArr=d.order.orderprice.venderFreight,i,j=venderFeeArr.length,k,curShipment,selPickItem;if(d.order&&d.order.orderprice){orderObj.updatePrice(d.order.orderprice,true);}
for(i=0;i<j;i++){if(venderFeeArr[i].venderId==vender.venderId||((vender.venderType=='0'||vender.venderType=='1')&&venderFeeArr[i].venderId=='0')){vender.freight=venderFeeArr[i].freight;break;}}
if(d.order.jdshipment&&d.order.jdshipment.selected=='1'&&(shipType=='0'||shipType=='3')){vender.selectedShip='shipjd';}
if(d.order.jdshipment&&d.order.jdshipment.jd311shipment&&d.order.jdshipment.selected=='1'&&(shipType=='0'||shipType=='3')){vender.ship311=true;_shipItem=d.order.jdshipment.jd311shipment;g.supCombine=(_shipItem.supportCombine>0)||false;g.selectCombine=(_shipItem.isCombine>0)||false;if(g.supCombine&&g.selectCombine){_shipItem.calendar=_shipItem.combineCalendarDayList;_shipItem.isSupport='1';_shipItem.selected='1';vender.selectedShip='ship311';}
vender.ship311calendar=_shipItem.calendar;g.onlineShip.jd311shipment=_shipItem;shipItem={date:_shipItem.selectDate,time:_shipItem.selectTime,week:_shipItem.week||1,sendpay:_shipItem.selectSendpay,batchId:_shipItem.batchId}
if(_shipItem.selected=='1'||d.order.jdshipment.shipmentTimeType=='4'){vender.selectedShip='ship311';vender.ship311Obj=vender._ship311Obj=shipItem;}else{vender._ship311Obj=shipItem;}
if(_shipItem.supportInstall=='1'){vender.smInstall=true;vender.shipSmIns.iOffset=_shipItem.installOffset;vender.smIn311Obj={supportInstallSkus:_shipItem.supportInstallSkus,installOffset:_shipItem.installOffset,promiseDateOffset:_shipItem.promiseDateOffset,selectDate:_shipItem.selectDate,instlDateMap:_shipItem.instlDateMap};}}
if(d.order.jdshipment&&d.order.jdshipment.jd411shipment&&(shipType=='0'||shipType=='3')){vender.ship411=true;if(d.order.jdshipment.jd411shipment.selected=='1'){vender.selectedShip='ship411';vender.ship311=true;}
vender.ship411Obj=vender._ship411Obj=d.order.jdshipment.jd411shipment;}
if(d.order.jdshipment&&d.order.jdshipment.zxjjzdshipment&&(shipType=='0'||shipType=='3')){vender.shipjzd=true;_shipItem=d.order.jdshipment.zxjjzdshipment;vender.shipjzdcalendar=_shipItem.calendar;vender.calendarTag=_shipItem.calendarTag;g.onlineShip.zxjjzdshipment=_shipItem;shipItem={date:_shipItem.selectDate,time:_shipItem.selectTime,week:_shipItem.week||1,sendpay:_shipItem.selectSendpay,batchId:_shipItem.batchId}
if(d.order.jdshipment.zxjjzdshipment.selected=='1'||d.order.jdshipment.shipmentTimeType=='6'){vender.selectedShip='shipjzd';vender.shipjzdObj=vender._shipjzdObj=shipItem;}else{vender._shipjzdObj=shipItem;}
if(_shipItem.supportInstall=='1'){vender.smInstall=true;vender.shipSmIns.iOffset=_shipItem.installOffset;vender.smInjzdObj={supportInstallSkus:_shipItem.supportInstallSkus,installOffset:_shipItem.installOffset,promiseDateOffset:_shipItem.promiseDateOffset,selectDate:_shipItem.selectDate,instlDateMap:_shipItem.instlDateMap};}}
if(d.order.jdshipment.gsdshipment&&d.order.jdshipment.gsdshipment&&vender.shipGsd){curShipment=d.order.jdshipment.gsdshipment;vender._shipGsdObj=vender.shipGsdObj=curShipment;shipItem=_shipItem=false;if(curShipment.calendar){vender.shipGsdcalendar=curShipment.calendar;vender.forcedChoice=curShipment.forcedChoice;if(curShipment.promiseDate&&curShipment.promiseTimeRange){for(i=0;i<curShipment.calendar.length;i++){_shipItem=curShipment.calendar[i];if(_shipItem.date==curShipment.promiseDate&&_shipItem.time==curShipment.promiseTimeRange){shipItem=_shipItem;break;}}}
if(!shipItem){shipItem=curShipment.calendar[0];}}
if(curShipment.selected=='1'){vender.selectedShip='shipGsd';if(curShipment.calendar&&curShipment.calendar.length>0){vender.shipGsdObj=vender._shipGsdObj=shipItem;vender.speedHour=(curShipment.speedHour||'1').replace('0.5','半');}}else if(curShipment.calendar){vender._shipGsdObj=shipItem;}}
if(d.order.jdshipment.pickshipment&&d.order.jdshipment.pickshipment.selected=='1'&&(shipType=='0'||shipType=='3')){curShipment=d.order.jdshipment.pickshipment;vender.selectedShip='shipziti';selPickItem=that.getSelPickItem(curShipment.pickList);vender._shipzitiObj=vender.shipzitiObj={'addr':selPickItem,'date':curShipment.date,'shipmentTimeType':curShipment.shipmentTimeType,'item':curShipment};}
if(shipType=='1'){vender.selectedShip='ship3';}
if(shipType=='2'){vender.selectedShip='shipSop';}
if(shipType=='5'){vender.selectedShip='shipSopjd';}
if(shipType=='9'){vender.selectedShip='shipPopGsd';}
if(d.vendershiptime){shipItem=_shipItem=false;vender.isla=false;vender.shiplaSopjd=false;vender.shipla=vender._shipla=false;vender.selectedlaShip=''
vender.shiplacalendar=[]
for(i=0;i<d.vendershiptime.length;i++){if(d.vendershiptime[i].venderId==vender.venderId){g.onlineShip.vendershiptime[vender.venderId]=d.vendershiptime[i];vender.shipid=selectShipId;vender.shiptype=d.vendershiptime[i].shipType;if(d.vendershiptime[i].shipType=='3'){vender.selectedShip='shipziti';}else if((shipType=='2'||shipType=='5')&&d.vendershiptime[i].djdbzdshipment&&d.vendershiptime[i].djdbzdshipment.supDelive=='1'){vender.isla=true;vender.shiplaSopjd=true;vender.shipla=vender._shipla=d.vendershiptime[i].djdbzdshipment;vender.selectedlaShip='shipla';vender.shiplacalendar=d.vendershiptime[i].djdbzdshipment;}else if(d.vendershiptime[i].calendar){if(shipType=='2'){vender.sopCalendar=d.vendershiptime[i].calendar;}else if(shipType=='5'){vender.sopjdCalendar=d.vendershiptime[i].calendar;}else if(shipType=='9'){vender.shipPopGsdCalendar=d.vendershiptime[i].calendar;}
for(k=0;k<d.vendershiptime[i].calendar.length;k++){_shipItem=d.vendershiptime[i].calendar[k];if(_shipItem.date==d.vendershiptime[i].promiseDate&&_shipItem.time==d.vendershiptime[i].promiseTimeRange){shipItem=_shipItem;break;}}
if(d.vendershiptime[i].shipType=='2'){vender._shipSopObj=vender.shipSopObj=shipItem;}else if(d.vendershiptime[i].shipType=='5'){vender._shipSopjdObj=vender.shipSopjdObj=shipItem;}else if(d.vendershiptime[i].shipType=='9'){vender._shipPopGsdObj=vender.shipPopGsdObj=shipItem;vender.speedHour=(d.vendershiptime[i].speedHour).replace('0.5','半');}}else{vender.sopDefault={sendHtml:d.vendershiptime[i].promiseMsg||'工作日、双休日与节假日均可送货'}}
break;}}
if(d.vendershiptime[0]&&d.vendershiptime[0].pickShop&&d.vendershiptime[0].pickShop.selected=='1'){vender.shipShopPick=d.vendershiptime[0].pickShop;}}
that.showSelectShip(option);try{for(i=0;i<vender.shipment.length;i++){if(selectShipId==vender.shipment[i].id){vender.shipment[i].selected='1';}else{vender.shipment[i].selected='0';}}
if(vender.venderType=='0'||vender.venderType=='1'){for(j=0;j<orderObj.cartData.length;j++){if(!(orderObj.cartData[j].venderType=='0'||orderObj.cartData[j].venderType=='1')){continue;}
for(k=0;k<orderObj.cartData[j].shipment.length;k++){if(orderObj.cartData[j].shipment[k].id==selectShipId){orderObj.cartData[j].shipment[k].selected='1';}else{orderObj.cartData[j].shipment[k].selected='0';}}}}}catch(e){}},'error':function(id,msg,d){pu.myAlertV2({msg:msg});}});}});}
pu.myBind({'src':'.mod_address_slide_main','fun':function(e,$this){e.stopPropagation();}});pu.myBind({'src':'#ship311Sel, #laDSel, #laISel, #zitiSel, #sopjdSel, #sopSel, #smInSel, #shipGsdSel, #shipPopGsdSel','fun':function(e,$this){var id=$this.attr('id');$('#shipSelDiv, #'+id+'Area').show();}});pu.myBind({'src':'#bzd, #jzd, #jsd, #bzdLa, #jzdLa, #jsdLa','fun':function(e,$this){var id=$this.attr('id');$this.addClass('cur').siblings().removeClass('cur');$('#'+id+'Li').show().siblings().hide();$('#'+id+'Nav').show();$('.navBar').show();}});pu.myBind({'src':'#shipSelDiv .close','fun':function(e,$this){g.shiptag=g.oldShiptag;$('#shipSelDiv, #shipSelDiv .mod_address_slide').hide();}});pu.myBind({'src':'#shipSelDiv .mod_address_slide','fun':function(e,$this){g.shiptag=g.oldShiptag;$('#shipSelDiv, #shipSelDiv .mod_address_slide').hide();}});pu.myBind({'src':'#samsFeeTip','fun':function(e,$this){$('#samsFeeDesc').show();$('.mod_alert_mask').show();$('#savePayShip').hide();pu.myBind({src:'#samsFeeKnown',fun:function(e,$this){$('#samsFeeDesc').hide();$('.mod_alert_mask').hide();$('#savePayShip').show();}});}});$('.selShip').off('click').on('click','.mod_address_slide_select_time_tab',function(e){var val=$(this).attr('value'),shipDesc=$(this).attr('desc'),type=$(this).attr('type'),laArr=[],i,l,item,isla=vender.isla,installStr,inDesc,instMap,_laSelObj,jzdjsdTip='',lajzdjsdTip='',_venderFee,_lashipData,smInObj,smInMap,smInDesc,smInArr=[],smInstallStr;if(type=='tips')return;if(vender.shipjzd){jzdjsdTip='(可选京准达';}
if(vender.ship411&&vender._ship411Obj.isGray=='0'){jzdjsdTip=jzdjsdTip?jzdjsdTip+'和极速达)':'(可选极速达)';}else if(jzdjsdTip){jzdjsdTip+=')';}
if(vender.shiplajzd){lajzdjsdTip='(可选京准达';}
if(vender.shipla411&&vender._shipla411Obj.isSupport=='1'){lajzdjsdTip=lajzdjsdTip?lajzdjsdTip+'和极速达)':'(可选极速达)';}else if(lajzdjsdTip){lajzdjsdTip+=')';}
if(vender.shipjzd&&pu.isDuringDate('2016/02/27 15:00:00','2018/12/25 23:59:59')&&!g.containLa){jzdjsdTip='(京准达运费大促)';}
g._zxjJzdFee=g._zxjJzdFee||orderObj.zxjJzdFee/100+orderObj.freshMisJzdShipFreight/100;g._djdJzdFee=g._djdJzdFee||orderObj.djdJzdFee/100;$(this).parents('.mod_address_slide_body').find('.selShip .mod_address_slide_select_time_tab').removeClass('selected');$(this).addClass('selected');switch(type){case'311ship':case'jzdship':if(type=='jzdship'){g.oldShiptag=g.shiptag;$('#supTip').html('(已选京准达)');vender.selectedShip!='shipjzd'?g.shipNeedRedeal=true:g.shipNeedRedeal=false;vender.shipjzdObj.selected='1';vender._shipjzdObj=JSON.parse(decodeURIComponent(val));vender.selectedShip='shipjzd';vender._shipjzdObj.shiptag=$('#jzdNav .selected').attr('tagtype');wa('jdClick',{ptag:'7039.11.2'});if(!g.shipNeedRedeal){_venderFee=($('#vshipFee').html()/1).toFixed(2)/1;_venderFee=_venderFee+$(this).attr('fee')/1-(g._zxjJzdFee/1).toFixed(2)/1;_venderFee=_venderFee>0?_venderFee:0;g._zxjJzdFee=$(this).attr('fee');$('#vshipFee').html(_venderFee.toFixed(2));}}else{if($('#supTip').length>0){$('#supTip').html(jzdjsdTip);}
vender.selectedShip!='ship311'?g.shipNeedRedeal=true:g.shipNeedRedeal=false;vender._ship311Obj=JSON.parse(decodeURIComponent(val));vender.selectedShip='ship311';wa('jdClick',{ptag:'7039.11.1'});}
$('#jsdLi li').removeClass('selected');$('#ship311Sel').html('送货时间：'+shipDesc.replace(/\d{4}-/,''));wa('jdClick',{ptag:'7039.1.84'});if(vender.smInstall){if(type=='jzdship'){smInObj=vender.smInjzdObj;smInMap=vender.smInjzdObj.instlDateMap[vender._shipjzdObj.date];}else{smInObj=vender.smIn311Obj;smInMap=vender.smIn311Obj.instlDateMap[vender._ship311Obj.date];}
instMap=vender._shipla.instlDateMap;for(i=0,l=smInMap.length;i<l;i++){item=smInMap[i];if(item<0){continue;}
smInDesc=that.formatDateFromOffset(smInObj.selectDate,smInObj.promiseDateOffset,item,"YYYY-MM-DD 周W");smInArr.push('<div class="mod_address_slide_select_time_tab" value="'+item+'" type="smInstall" desc="'+smInDesc+'"> <p>'+smInDesc+'</p> </div>');}
$('#smInstallLi .mod_address_slide_select_time_tabs').html(smInArr.join(''));smInstallStr=$('#smInstallLi .mod_address_slide_select_time_tabs').find('[value="'+smInMap[0]+'"]').addClass('selected').attr('desc');$('#smInSel').html('中小件安装时间：'+smInstallStr.replace(/\d{4}-/,''));vender.shipSmIns.iOffset=smInMap[0];}
if(vender.smInstall){$('#smshipin').show();}
break;case'gsdship':vender._shipGsdObj=JSON.parse(decodeURIComponent(val));vender.selectedShip='shipGsd';$('#shipGsdSel').html('送货时间：'+shipDesc.replace(/\d{4}-/,''));break;case'popgsdship':vender._shipPopGsdObj=JSON.parse(decodeURIComponent(val));vender.selectedShip='shipPopGsd';$('#shipPopGsdSel').html('送货时间：'+shipDesc.replace(/\d{4}-/,''));break;case'laship':case'la2ship':case'lajzdship':vender.isla=true;if($('#suplaTip').length>0){$('#suplaTip').html(lajzdjsdTip);}
if(type=='laship'){vender.selectedlaShip=='shipla'?g.shipNeedRedeal=false:g.shipNeedRedeal=true;vender._shipla.defaultDDate=that.formatDateFromOffset(vender._shipla.defaultDDate,vender._shipla.defaultDOffset,val,'YYYY-MM-DD');vender._shipla.defaultDOffset=val;vender.selectedlaShip='shipla';wa('jdClick',{ptag:'7039.11.1'});}else if(type=='la2ship'){vender.selectedlaShip=='shipla2'?g.shipNeedRedeal=false:g.shipNeedRedeal=true;vender._shipla2Obj=JSON.parse(decodeURIComponent(val));vender.selectedlaShip='shipla2';wa('jdClick',{ptag:'7039.11.1'});}else if(type=='lajzdship'){$('#suplaTip').html('(已选京准达)');vender.selectedlaShip!='shiplajzd'?g.shipNeedRedeal=true:g.shipNeedRedeal=false;vender._shiplajzdObj=JSON.parse(decodeURIComponent(val));vender.selectedlaShip='shiplajzd';vender._shiplajzdObj.shiptag=$('#jzdLaNav .selected').attr('tagtype');wa('jdClick',{ptag:'7039.11.2'});if(!g.shipNeedRedeal){_venderFee=($('#vshipFee').html()/1).toFixed(2)/1;_venderFee=_venderFee+$(this).attr('fee')/1-(g._djdJzdFee/1).toFixed(2)/1;g._djdJzdFee=$(this).attr('fee');$('#vshipFee').html(_venderFee.toFixed(2));}}
$('#jsdLaLi li').removeClass('selected');$('#laDSel').html('送货时间：'+shipDesc.replace(/\d{4}-/,''));if(type=='laship'&&vender._shipla.supInstall=='1'){instMap=vender._shipla.instlDateMap;for(i=0,l=instMap[val].length;i<l;i++){item=vender._shipla.instlDateMap[val][i];if(item<0){continue;}
inDesc=that.formatDateFromOffset(vender._shipla.defaultDDate,vender._shipla.defaultDOffset,item,"YYYY-MM-DD 周W");laArr.push('<div class="mod_address_slide_select_time_tab" value="'+item+'" type="install" desc="'+inDesc+'"> <p>'+inDesc+'</p> </div>');}
$('#laInstallLi .mod_address_slide_select_time_tabs').html(laArr.join(''));installStr=$('#laInstallLi .mod_address_slide_select_time_tabs').find('[value="'+instMap[val][0]+'"]').addClass('selected').attr('desc');$('#laISel').html('大件安装时间：'+installStr.replace(/\d{4}-/,''));vender._shipIns.iOffset=instMap[val][0];if(vender._shipIns.iOffset==vender._shipla.defaultDOffset){$('#supShipInstall').addClass('selected');}else{$('#supShipInstall').removeClass('selected');}}
if(type=='lajzdship'||type=='la2ship'){$('#supShipInstall').removeClass('selected');if(type=='lajzdship'&&vender.shiplajzdcalendar.supInstall=='1'){instMap=vender.shiplajzdcalendar.instlDateMap;_laSelObj=vender._shiplajzdObj;}else if(type=='la2ship'&&vender.shipla2calendar.supInstall=='1'){instMap=vender.shipla2calendar.instlDateMap;_laSelObj=vender._shipla2Obj;}
if(_laSelObj){for(i=0,l=instMap[_laSelObj.reservingDate].length;i<l;i++){item=instMap[_laSelObj.reservingDate][i];if(item<0){continue;}
inDesc=that.formatDateFromOffset(_laSelObj.date,_laSelObj.reservingDate,item,'YYYY-MM-DD 周W');laArr.push('<div class="mod_address_slide_select_time_tab" value="'+item+'" type="install" desc="'+inDesc+'"> <p>'+inDesc+'</p> </div>');}
$('#laInstallLi .mod_address_slide_select_time_tabs').html(laArr.join(''));installStr=$('#laInstallLi .mod_address_slide_select_time_tabs').find('[value="'+instMap[_laSelObj.reservingDate][0]+'"]').addClass('selected').attr('desc');$('#laISel').html('大件安装时间：'+installStr.replace(/\d{4}-/,''));vender._shipIns.iOffset=instMap[_laSelObj.reservingDate][0];if(vender._shipIns.iOffset==_laSelObj.reservingDate){$('#supShipInstall').addClass('selected');}else{$('#supShipInstall').removeClass('selected');}}}
wa('jdClick',{ptag:'7039.1.82'});break;case'smInstall':$('#smInSel').html('中小件安装时间：'+shipDesc.replace(/\d{4}-/,''));vender.shipSmIns.iOffset=val;break;case'install':$('#laISel').html('大件安装时间：'+shipDesc.replace(/\d{4}-/,''));vender._shipIns.iOffset=val;if(vender.selectedlaShip=='shipla'){_lashipData=vender._shipla.defaultDOffset;}else if(vender.selectedlaShip=='shipla2'){_lashipData=vender._shipla2Obj.reservingDate;}
if(vender.selectedlaShip=='shipla'||vender.selectedlaShip=='shipla2'){if(vender._shipIns.iOffset==_lashipData){$('#supShipInstall').addClass('selected');}else{$('#supShipInstall').removeClass('selected');}}
g.shipNeedRedeal=false;wa('jdClick',{ptag:'7039.1.83'});break;case'zitiship':$('#zitiSel').html('自提时间：'+shipDesc);vender._shipzitiObj.date=decodeURIComponent(val);break;case'sopjdship':$('#sopjdSel').html('送货时间：'+shipDesc);vender.selectedShip='shipSopjd';vender._shipSopjdObj=JSON.parse(decodeURIComponent(val));g.shipNeedRedeal=false;break;case'sopship':$('#sopSel').html('送货时间：'+shipDesc);vender.selectedShip='shipSop';vender._shipSopObj=JSON.parse(decodeURIComponent(val));g.shipNeedRedeal=false;break;}
if(g.shipNeedRedeal){g.shipChange=true;setCurrPayShip();}
$('#shipSelDiv, #shipSelDiv .mod_address_slide').hide();});$('#jsdLi li').off('click').on('click',function(e){$('#supTip').html('(已选极速达)');vender.selectedShip!='ship411'?g.shipNeedRedeal=true:g.shipNeedRedeal=false;vender.ship411Obj.selected='1';vender.selectedShip='ship411';wa('jdClick',{ptag:'7039.11.3'});$('#ship311Sel').html('送货时间：'+
(vender._ship411Obj&&vender._ship411Obj.dataFlag=='1'?vender._ship411Obj.promiseTime.replace(/\d{4}-(\d+)-(\d+) (\d+:\d+):\d+/,'$1月$2日$3')+'前送达'+
(vender._ship411Obj.fee/1>0?'(运费'+(vender._ship411Obj.fee/100).toFixed(0)+'元)':''):'极速达(2小时送达)'));$(this).addClass('selected');$(this).parents('.mod_address_slide_body').find('.selShip .mod_address_slide_select_time_tab').removeClass('selected');if(g.shipNeedRedeal){g.shipChange=true;setCurrPayShip();}
if(vender.smInstall){$('#smshipin').hide();}
$('#shipSelDiv, #shipSelDiv .mod_address_slide').hide();});$('#jsdLaLi li').off('click').on('click',function(e){var i,j,item,instMap,inDesc,laArr=[],installStr;$('#suplaTip').html('(已选极速达)');vender.selectedlaShip!='shipla411'?g.shipNeedRedeal=true:g.shipNeedRedeal=false;vender.shipla411Obj.selected='1';vender.selectedlaShip='shipla411';$('#laDSel').html('送货时间：预计'+vender._shipla411Obj.speedHour+'小时内送达'+
(vender._shipla411Obj.fee>0?'(运费'+vender._shipla411Obj.fee+'元)':''));$(this).addClass('selected');$(this).parents('.mod_address_slide_body').find('.selShip .mod_address_slide_select_time_tab').removeClass('selected');if(vender._shipla411Obj.isSupportInstall=='1'){instMap=vender._shipla411Obj.installDateList.split(',');for(i=0,j=instMap.length;i<j;i++){item=instMap[i];if(item<0){continue;}
inDesc=that.formatDateFromOffset(vender._shipla411Obj.codDate,'0',item,'YYYY-MM-DD 周W');laArr.push('<div class="mod_address_slide_select_time_tab" value="'+item+'" type="install" desc="'+inDesc+'"> <p>'+inDesc+'</p> </div>');}
$('#laInstallLi .mod_address_slide_select_time_tabs').html(laArr.join(''));installStr=$('#laInstallLi .mod_address_slide_select_time_tabs').find('[value="'+instMap[0]+'"]').addClass('selected').attr('desc');$('#laISel').html('大件安装时间：'+installStr.replace(/\d{4}-/,''));vender._shipIns.iOffset=instMap[0];}
if(instMap&&instMap[0]=='0'){$('#supShipInstall').addClass('selected');}else{$('#supShipInstall').removeClass('selected');}
if(g.shipNeedRedeal){g.shipChange=true;setCurrPayShip();}
$('#shipSelDiv, #shipSelDiv .mod_address_slide').hide();});$('.mod_address_slide_tabs_3_tab').off('click').on('click',function(e){var shiptag=$(this).attr('tagtype'),isla=$(this).attr('type')=='la';that.handleJzdTag({shiptag:shiptag,isla:isla,vender:vender,that:$(this),action:action,usePcPrice:usePcPrice,djdJzdTipFee:orderObj.djdJzdTipFee,zxjJzdTipFee:orderObj.zxjJzdTipFee});});$('.buy_shipping_v2_combine li').off('click').on('click',function(e){var lastSel,venderId;if($(this).hasClass('selected')){return;}
lastSel=$(this).siblings().find('.selected');$(this).addClass('selected').siblings().removeClass('selected');if($(this).attr('id')=='combine'){wa('jdClick',{ptag:'7039.11.20'});g.selectCombine=true;g.onlineShip.jd311shipment.calendar=g.onlineShip.jd311shipment.combineCalendarDayList;vender.ship311=true;vender.selectedShip='ship311';vender.ship311calendar=g.onlineShip.jd311shipment.combineCalendarDayList;vender._ship311Obj=vender.ship311Obj=vender.ship311calendar[0];that.showSelectShip(option);}else{g.selectCombine=false;g.onlineShip.jd311shipment.calendar=[];g.setPayShipData=[];vender.ship311=false;vender.selectedShip='shipjd';vender.ship311calendar=[];vender._ship311Obj=null;that.showSelectShip(option);}});if(vender.supShipInstall=='1'){$('#supShipInstall').off('click').on('click',function(e){var dfShipInstall;if($(this).hasClass('selected')){return;}else{$(this).addClass('selected');if(vender.selectedlaShip=='shipla'&&vender._shipla.instlDateMap[vender.shiplacalendar.defaultDOffset][0]==vender.shiplacalendar.defaultDOffset){dfShipInstall=vender.shiplacalendar.defaultDOffset;}else if(vender.selectedlaShip=='shipla2'&&vender._shipla2Obj.reservingDate==vender.shipla2calendar.instlDateMap[vender._shipla2Obj.reservingDate][0]){dfShipInstall=vender._shipla2Obj.reservingDate;}else{dfShipInstall=vender.supDfShipInstall;}
if(dfShipInstall&&(vender.selectedlaShip=='shipla2'||vender.shipla2)){$('#bzdLaLi [reservingDate="'+dfShipInstall+'"]')[0].click();}else if(dfShipInstall){$('#bzdLaLi [value="'+dfShipInstall+'"]').click();}else{$(this).removeClass('selected');pu.oneLineTip({msg:'请选择标准达后再选择送装一体'});}
$('#bzdLa').click();}});}
if(vender.shipziti){pu.myBind({'src':'[type_con="shipziti"] .buy_shipping_v2_location','fun':function(e,$this){showPiclist(200);}});}
if(vender.shipShopPick){pu.myBind({'src':'[type_con="shipShopPick"] .buy_shipping_v2_location','fun':function(e,$this){showShopPickAddrList(200);}});}
pu.myBind({'src':'#savePayShip','fun':function(e,$this){if(vender.selectedShip==='shipShopPick'&&!vender.shipShopPick.picked){pu.myAlertV2({msg:'请选择自提门店'});return;}
g.shipNeedRedeal=false;g.shipChange=false;setCurrPayShip();}});function handleSvc(){var _data,addr=pu.getDefAddrFromWqAddr();_data={action:action,venderid:vender.venderId,svcid:orderObj.svcIds,areaid:addr[1],callback:'vshipsvcCb'};pu.wrapData(_data);if(paytypeforpresale){_data.paytypeforpresale=paytypeforpresale;}
loadJs.loadScript({url:cgi.vshipsvc,data:_data});window.vshipsvcCb=function(d){var svcHtml,i,j,svcItem,skuTotalFee=0;if(d.errId!='0'){return;}
svcHtml=shipTpl.child_selectSvcTpl(d);$('#svcArea').html(svcHtml).show();for(i=0;i<d.venderShipSvc.venderSkuList.length;i++){for(j=0;j<d.venderShipSvc.venderSkuList[i].shipServiceList.length;j++){svcItem=d.venderShipSvc.venderSkuList[i].shipServiceList[j];if(svcItem.isDefault=="1"){skuTotalFee+=parseInt(svcItem.amount);}}}
if(skuTotalFee-vender.venderShipSvcFee>0){$('#svcFeePromte span').html(((skuTotalFee-vender.venderShipSvcFee)/100).toFixed(2));$('#svcFeePromte').show();}else{$('#svcFeePromte').hide();}
$('.good li').off('click').on('click',function(e){if($(this).hasClass('selected')){return;}
$(this).addClass('selected').siblings().removeClass('selected');setShipSvc();});}}
function setShipSvc(){var data,selArr=[],i,selSvc=$('#svcArea li.selected'),totalSelFee=0,shipSvcDesc=[];for(i=0;i<selSvc.length;i++){selArr.push($(selSvc[i]).attr('svcId'));shipSvcDesc.push($(selSvc[i]).attr('svcName'));totalSelFee+=parseInt($(selSvc[i]).attr('amount'));}
data={action:action,svrid:selArr.join(','),venderid:vender.venderId,callback:'vshipfeeCb',reg:'1'};if(usePcPrice=='1'){data.platprice='1';}
if(paytypeforpresale){data.paytypeforpresale=paytypeforpresale;}
pu.wrapData(data);loadJs.loadScript({url:cgi.vshipfee,data:data});window.vshipfeeCb=function(d){if(d.errId!='0'){pu.myAlertV2({msg:d.errMsg});return;}
g.svcChange=true;if(totalSelFee-vender.venderShipSvcFee>0){$('#svcFeePromte span').html(((totalSelFee-d.VenderShipSvc.VenderFee)/100).toFixed(2));$('#svcFeePromte').show();}else{$('#svcFeePromte').hide();}
setSvcCallback&&setSvcCallback();}}
function handleService(){var _data={areaid:addr[1],svcid:vender.serviceIds.join(','),callback:'chargelistCb'};pu.wrapData(_data);loadJs.loadScript({url:cgi.itemchargelist,data:_data});window.chargelistCb=function(d){var html,i,j,_item,_skuId;if(d.errId!='0'||!d.venderSkuList||d.venderSkuList.length==0){return;}
for(i=0;i<d.venderSkuList.length;i++){_item=d.venderSkuList[i];_skuId=_item.skuId;for(j=0;j<vender.products.length;j++){if(_skuId==vender.products[j].mainSku.id){_item.img=vender.products[j].mainSku.image;_item.shipSvcItemId=vender.products[j].mainSku.shipSvcItemId;initItemArr.push(_item.shipSvcItemId);break;}}}
html=shipTpl.child_serviceTpl(d.venderSkuList);$('#serviceArea').html(html).show();if(html.trim()){$('#serviceArea').parent().parent().show();}else{$('#serviceArea').parent().parent().hide();}
$('.buy_shipping_v2_service li').off('click').on('click',function(e){var curSel,lastSel,curSkuId,curItemId,selArr=[],svcFee=0;if($(this).hasClass('selected')){return;}
curSkuId=$(this).attr('skuId');curItemId=$(this).attr('itemId');curSel=$(this);lastSel=$(this).siblings().find('.selected');$(this).addClass('selected').siblings().removeClass('selected');loadJs.loadScript({url:cgi.orderdelivery,data:{areaid:orderObj.address.jdaddrid,svrid:curSkuId+'|'+curItemId,callback:'orderdeliveryCb',r:Math.random()}});window.orderdeliveryCb=function(d){if(d.errId!=0){pu.myAlertV2({msg:d.errMsg});curSel.removeClass('selected');lastSel.addClass('selected');}
$('#serviceArea li.selected').forEach(function(item){selArr.push($(item).attr('itemid'));svcFee+=$(item).attr('price')/1;});$('#vsvcFee').html((svcFee/100).toFixed(2));if(!selArr.sort().equals(initItemArr.sort())){g.installChange=true;}}});}}
function showShopPickAddrList(num){var curSelectedShopAddrId=vender.shipShopPick.selected=='1'?vender.shipShopPick.picked.storeId:false,_addrId=addr[0];var cgiOption={venderid:vender.venderId,type:'shop',pidx:0,psize:num||200,addrid:_addrId,action:action};pu.wrapData(cgiOption);if(paytypeforpresale){cgiOption.paytypeforpresale=paytypeforpresale;}
location.hash='shopList'+'|'+Math.random();pu.loadCgi({cgi:g.isGlobalPay?cgi.globalPay_getpicksitelist:cgi.getpicksitelist,data:cgiOption,success:function(d){if(d.PickShop&&d.PickShop.shopList.length>0){vender.shipShopPickAddrList=d.PickShop.shopList;vender.shipShopPickAddrList.forEach(function(item){if(parseInt(item.storeId)===parseInt(curSelectedShopAddrId)){item.selected='1';}else{item.selected='0';}});document.body.scrollTop=0;window.scrollTo(0,0);}
if(vender.shipShopPickAddrList instanceof Array){var html=shipTpl.child_shopPickAddrListTpl(vender.shipShopPickAddrList);$('#shopList').html(html);}else{$('#shopList').html(shipTpl.child_shopPickAddrListTpl([]));return;}
if(!pu.isMQQUserAgent()&&!pu.isWxUserAgent()){$('#shopPickMap').parent().hide();}
bindClickEvent();},error:function(err){if(vender.shipShopPickAddrList instanceof Array){var html=shipTpl.child_shopPickAddrListTpl(vender.shipShopPickAddrList);$('#shopList').html(html);}else{$('#shopList').html(shipTpl.child_shopPickAddrListTpl([]));return;}
if(!pu.isMQQUserAgent()&&!pu.isWxUserAgent()){$('#shopPickMap').parent().hide();}
bindClickEvent();}});function bindClickEvent(){pu.myBind({src:'#shopList',fun:function(e,$this){var target=$(e.target);var addrId=target.attr('addrId')||target.parent().attr('addrId');var isSelected=target.hasClass('selected')||target.parent().hasClass('selected');if(target[0].tagName.toLowerCase()==='span'){showTip(addrId);return;}
if(!isSelected){selectAddr(addrId);}else{history.back();}}});pu.myBind({'src':'#shopPickAddrListTip [ctag="iKnow"]','fun':function(){$('#shopPickAddrListTip, .mod_alert_mask').hide();}});pu.myBind({src:'#shopPickMap',fun:function(){var selectedAddrDom=$('li[addrId].selected');if(selectedAddrDom.length>0){var addrId=selectedAddrDom.attr('addrId');var addr=vender.shipShopPickAddrList.filter(function(item){return parseInt(item.storeId)===parseInt(addrId);})[0];if(addr.lat!=''&&addr.lng!=''){var coords=[addr.lat,addr.lng].join(',');var name=addr.name;var address=addr.address;pu.jumpMap(coords,name,address);}else{pu.myAlert('缺少坐标数据');}}else{pu.oneLineTip({msg:'请选择自提门店'});}}})
function showTip(addrId){var addr=vender.shipShopPickAddrList.filter(function(item){return parseInt(item.storeId)===parseInt(addrId);})[0];$('#shopPickAddrListTip [ctag="name"]').html(addr.name);$('#shopPickAddrListTip [ctag="info"]').html(addr.address);$('#shopPickAddrListTip [ctag="time"]').html(addr.BizHours);$('#shopPickAddrListTip, .mod_alert_mask').show();}
function selectAddr(addrId){var stockStatus=vender.shipShopPickAddrList.filter(function(item){return parseInt(item.storeId)===parseInt(addrId);})[0].stockStatus;if(parseInt(stockStatus)===0){return;}
vender.shipShopPickAddrList.forEach(function(item){if(parseInt(item.storeId)===parseInt(addrId)){item.selected='1';vender.shipShopPick.picked=item;vender.shipShopPick.selected='1';g.shipNeedRedeal=true;g.shipChange=true
setCurrPayShip();}else{item.selected='0';}});history.back();}}}
function showPiclist(num){var html,data,pickId,addr;if(vender._shipzitiObj&&vender._shipzitiObj.addr&&vender._shipzitiObj.addr.pickId){pickId=vender._shipzitiObj.addr.pickId;}
addr=addressCom.getDefAddrFromCookie();data={'reg':'1','paytype':'0','pickid':pickId?pickId:'0','regionid':'','num':num,'addrid':addr[0]||0,'action':action};pu.wrapData(data);if(paytypeforpresale){data.paytypeforpresale=paytypeforpresale;}
location.hash='pickList'+'|'+Math.random();pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_getpicksitelist:cgi.getpicksitelist,'data':data,'success':function(d){if(d.PickShipment&&d.PickShipment.pickList.length>0){html=shipTpl.child_pickListTpl({'shipzitiPickList':d.PickShipment.pickList});vender.shipzitiPickList=d.PickShipment.pickList;$('#pickList').html(html);document.body.scrollTop=0;window.scrollTo(0,0);}else{html=shipTpl.child_pickListTpl(vender);$('#pickList').html(html);}
if(pickId){$('#pickList li').removeClass('selected');$('#pickList li[pickid="'+pickId+'"]').addClass('selected');}
if(!(pu.isMQQUserAgent()||pu.isWxUserAgent())){$('#zitiMap').parent().hide();}
bindPickListEvent();},'error':function(id,msg,d){html=shipTpl.child_pickListTpl(vender);$('#pickList').html(html);if(!(pu.isMQQUserAgent()||pu.isWxUserAgent())){$('#zitiMap').parent().hide();}
bindPickListEvent();}});}
function bindPickListEvent(){pu.myBind({'src':'#getMore','fun':function(){showPiclist(200);}});pu.myBind({'src':'#pickList .mentioning_list','fun':function(e,$this){var i,l,item,pickId,tar=e.target,tagName=tar.tagName.toLowerCase();function sel(tar){pickId=tar.attr('pickid');if(!pickId)return;vender._shipzitiObj.addr=that.getItemFormArray({'array':vender.shipzitiPickList,'itemIdName':'pickId','itemId':pickId,'each':function(item){item.selected=0;},'callback':function(item){item.selected=1;}});if(vender._shipzitiObj.addr.available=='1'){history.back();}}
function showInfo(tar){var addr,pickId;pickId=$(tar).attr('pickid');addr=that.getItemFormArray({'array':vender.shipzitiPickList,'itemIdName':'pickId','itemId':pickId});if(addr.phone==''){addr.address=addr.address.split(/\s+/);addr.phone=addr.address[1]||'';addr.address=addr.address[0];}
$('#zitiModol [ctag="name"]').html(addr.pickName);$('#zitiModol [ctag="info"]').html(addr.address);$('#zitiModol [ctag="tel"]').html(addr.phone);$('#zitiModol [ctag="telIcon"]').attr('href','tel:'+addr.phone);$('#zitiModol, .mod_alert_mask').show();}
if(tagName=='span'&&$(tar).attr('tag')=='zitiInfo'){showInfo(tar);}else if(tar.parentElement.tagName.toLowerCase()=='span'&&$(tar.parentElement).attr('tag')=='zitiInfo'){tar=tar.parentElement;showInfo(tar);}else if(tagName!='li'){tar=$(tar).parents('li');sel(tar);}else{tar=$(tar);sel(tar);}}});pu.myBind({'src':'#zitiModol [ctag="iKnow"]','fun':function(){$('#zitiModol, .mod_alert_mask').hide();}});pu.myBind({src:'#zitiMap',fun:function(){var select,pickid,addr,coords,name,address;select=$('li[pickid].selected');if(select.length>0){pickid=select.attr('pickid');addr=that.getItemFormArray({'array':vender.shipzitiPickList,'itemIdName':'pickId','itemId':pickid});if(addr.lat!=''&&addr.lng!=''){coords=[addr.lat,addr.lng].join(',');name=addr.pickName;address=addr.address;pu.jumpMap(coords,name,address);}else{pu.myAlert('缺少坐标数据');}}}})}
function setCurrPayShip(){var selectShipId,data,venderFeeArr,shipDataId,i,j;selectShipId=$('#shipType li.selected').attr('shipid'),shipType=$('#shipType li.selected').attr('curShipType');shipDataId=(vender.venderType=='0'||vender.venderType=='1')?'0':venderId;g.setPayShipData[shipDataId]=that.getSetPayShipParamData({'vender':vender,'shipType':shipType,'selectShipId':selectShipId});shipData=g.setPayShipData;data=pu.clone(shipData[shipDataId]);data.ship=that.getShipData()[0];data.pick=that.getShipData()[1];if(usePcPrice=='1'){data.platprice='1';}
if(paytypeforpresale){data.paytypeforpresale=paytypeforpresale;}
pu.wrapData(data);pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':data,'success':function(d){vender.ship311Obj=vender._ship311Obj;vender.ship411Obj=vender._ship411Obj;vender.shipjzdObj=vender._shipjzdObj;vender.shipzitiObj=vender._shipzitiObj;vender.shipla2Obj=vender._shipla2Obj;vender.shiplajzdObj=vender._shiplajzdObj;vender.shipla=vender._shipla;if(['0','1'].indexOf(vender.venderType)>-1||vender.selectedShip==='shipPopGsd'){g.modifyShip=true;}
console.log(selectShipId);try{for(i=0;i<vender.shipment.length;i++){if(selectShipId==vender.shipment[i].id){vender.shipment[i].selected='1';}else{vender.shipment[i].selected='0';}}
if(vender.venderType=='0'||vender.venderType=='1'){for(j=0;j<orderObj.cartData.length;j++){if(!(orderObj.cartData[j].venderType=='0'||orderObj.cartData[j].venderType=='1')){continue;}
for(k=0;k<orderObj.cartData[j].shipment.length;k++){if(orderObj.cartData[j].shipment[k].id==selectShipId){orderObj.cartData[j].shipment[k].selected='1';}else{orderObj.cartData[j].shipment[k].selected='0';}}}}}catch(e){}
if(!g.shipNeedRedeal){if(!g.isGlobalPay&&!g.installChange&&!g.svcChange){orderObj.handleShipeffect();}else if(!g.svcChange){callback&&callback();}
g.installChange=false;history.back();}else{venderFeeArr=d.order.orderprice.venderFreight;j=venderFeeArr.length;for(i=0;i<j;i++){if(venderFeeArr[i].venderId==vender.venderId||((vender.venderType=='0'||vender.venderType=='1')&&venderFeeArr[i].venderId=='0')){vender.freight=venderFeeArr[i].freight;vender.overLimitFee=venderFeeArr[i].overLimitFee||0;break;}}
$('#vshipFee').html((vender.freight/100).toFixed(2));}
if(d.order&&d.order.orderprice){orderObj.updatePrice(d.order.orderprice,true);}
if(d.order){orderObj.updateBuyDiscountArea(d);}},'error':function(id,msg,d){pu.myAlertV2({msg:msg});}})}},handleForceJzd:function(option){var vender=option.vender,selHtml,that=this,orderObj=option.orderObj,shipType=option.shipType;if(!(vender.shipjzdcalendar||vender.shipGsdcalendar||vender.shipPopGsdCalendar)){pu.myAlert('点击太快了，休息一下吧~');return;}
selHtml=shipTpl.child_shipV2Tpl({'vender':vender,'zxjJsdTipFee':option.zxjJsdTipFee,'formatDateFromOffset':this.formatDateFromOffset,'getDayType':pu.getDayType});$('#xzdSelDiv').html(selHtml).show();if(shipType=='gsd'){$('#shipGsdSelArea').show();}else if(shipType=='popgsd'){$('#shipPopGsdSelArea').show();}else{$('#ship311SelArea').show();}
$('.mod_address_slide_head').html('请选择配送时效<i class="close"></i>');$('#xzdSelDiv .mod_address_slide').css('z-index',898);pu.myBind({'src':'#bzd, #jzd, #jsd','fun':function(e,$this){var html,id=$this.attr('id');$this.addClass('cur').siblings().removeClass('cur');$('#'+id+'Li').show().siblings().hide();$('#'+id+'Nav').show();$('.navBar').show();}});pu.myBind({'src':'#xzdSelDiv .mod_address_slide_main','fun':function(e,$this){e.stopPropagation();}});pu.myBind({'src':'#xzdSelDiv .close, #xzdSelDiv .mod_address_slide','fun':function(e,$this){var type='jzdship';if(shipType=='gsd'){type='gsdship'}else if(shipType=='popgsd'){type='popgsdship'}
g.shiptag=g.oldShiptag;$('#xzdSelDiv .selShip .mod_address_slide_select_time_tab.selected[type="'+type+'"]').click();$('#xzdSelDiv, #xzdSelDiv .mod_address_slide').hide();$('#xzdSelDiv').empty();}});$('.mod_address_slide_tabs_3_tab').off('click').on('click',function(e){var shiptag=$(this).attr('tagtype'),isla=$(this).attr('type')=='la';that.handleJzdTag({shiptag:shiptag,isla:isla,vender:vender,that:$(this),action:option.action,usePcPrice:option.usePcPrice,djdJzdTipFee:option.djdJzdTipFee,zxjJzdTipFee:option.zxjJzdTipFee});});$('#xzdSelDiv .selShip').off('click').on('click','.mod_address_slide_select_time_tab',function(e){var val=$(this).attr('value'),_shipid='65',_shipType='0',_venderId;if(shipType=='gsd'){vender.shipGsdObj.selected='1';vender.selectedShip='shipGsd';_shipType='8';_shipid='71';vender._shipGsdObj=JSON.parse(decodeURIComponent(val));}else if(shipType=='popgsd'){vender.selectedShip='shipPopGsd';_shipType='9';_shipid='71';vender._shipPopGsdObj=JSON.parse(decodeURIComponent(val));}else{vender.shipjzdObj.selected='1';vender._shipjzdObj=JSON.parse(decodeURIComponent(val));vender.selectedShip='shipjzd';var type=$(this).attr('type'),selectShipId,data,shipDataId;switch(type){case'311ship':case'jzdship':if(type=='jzdship'){g.oldShiptag=g.shiptag;vender.shipjzdObj.selected='1';vender._shipjzdObj=JSON.parse(decodeURIComponent(val));vender.selectedShip='shipjzd';g.setPayShipData['0']=that.getSetPayShipParamData({'vender':vender,'shipType':'0','selectShipId':'65'});}else{g.needSetShip=false;vender.selectedShip!='ship311'?g.shipNeedRedeal=true:g.shipNeedRedeal=false;vender._ship311Obj=JSON.parse(decodeURIComponent(val));vender.selectedShip='ship311';}
break;default:break;}}
if(vender.venderType=='0'||vender.venderType=='1'){_venderId='0';}else{_venderId=vender.venderId;}
g.setPayShipData[_venderId]=that.getSetPayShipParamData({'vender':vender,'shipType':_shipType,'selectShipId':_shipid});shipData=g.setPayShipData;data=pu.clone(shipData[_venderId]);data.ship=that.getShipData()[0];data.pick=that.getShipData()[1];if(option.usePcPrice=='1'){data.platprice=1;}
$('#xzdSelDiv, #xzdSelDiv .mod_address_slide').hide();$('#xzdSelDiv').empty();pu.wrapData(data);pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':data,'success':function(d){vender.shipjzdObj=vender._shipjzdObj;g.modifyShip=true;orderObj.handleShipeffect();if(d.order&&d.order.orderprice){option.updatePrice&&option.updatePrice(d.order.orderprice,true);}},'error':function(id,msg,d){$('#xzdSelDiv, #xzdSelDiv .mod_address_slide').hide();pu.myAlert('设置配送时间失败，请重试');}});});$('#jsdLi li').off('click').on('click',function(e){g.needSetShip=false;$('#supTip').html('(已选极速达)');vender.selectedShip!='ship411'?g.shipNeedRedeal=true:g.shipNeedRedeal=false;vender.ship411Obj.selected='1';vender.selectedShip='ship411';wa('jdClick',{ptag:'7039.11.3'});$('#ship311Sel').html('送货时间：'+
(vender._ship411Obj&&vender._ship411Obj.dataFlag=='1'?vender._ship411Obj.promiseTime.replace(/\d{4}-(\d+)-(\d+) (\d+:\d+):\d+/,'$1月$2日$3')+'前送达'+
(vender._ship411Obj.fee/1>0?'(运费'+(vender._ship411Obj.fee/100).toFixed(0)+'元)':''):'极速达(2小时送达)'));$(this).addClass('selected');$(this).parents('.mod_address_slide_body').find('.selShip .mod_address_slide_select_time_tab').removeClass('selected');shipDataId=(vender.venderType=='0'||vender.venderType=='1')?'0':venderId;var selectShipId=$('#shipType li.selected').attr('shipid'),shipType=$('#shipType li.selected').attr('curShipType');g.setPayShipData[shipDataId]=that.getSetPayShipParamData({'vender':vender,'shipType':shipType||0,'selectShipId':selectShipId||65});shipData=g.setPayShipData;data=pu.clone(shipData[shipDataId]);data.ship=that.getShipData()[0];data.pick=that.getShipData()[1];if(option.usePcPrice=='1'){data.platprice='1';}
$('#xzdSelDiv, #xzdSelDiv .mod_address_slide').hide();$('#xzdSelDiv').empty();if(window.mConfirm){data.sceneval='2';}
pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':data,'success':function(d){vender.shipjzdObj=vender._shipjzdObj;g.modifyShip=true;orderObj.handleShipeffect();if(d.order&&d.order.orderprice){option.updatePrice&&option.updatePrice(d.order.orderprice,true);}},'error':function(id,msg,d){$('#xzdSelDiv, #xzdSelDiv .mod_address_slide').hide();pu.myAlert('设置配送时间失败，请重试');}});if(vender.smInstall){$('#smshipin').hide();}
$('#shipSelDiv, #shipSelDiv .mod_address_slide').hide();});},handleJzdTag:function(obj){var _data,vender=obj.vender,isla=obj.isla,zxjjzdCalendar,i,l,dayType,curFlag,lastFlag,item,jzdFee,jzdHtml='',_self=obj.that;if(_self.hasClass('selected')){return;}
_data={'reg':1,'action':obj.action,'reset':0,'shiptag':obj.shiptag,'callback':'shipCb'};if(obj.usePcPrice=='1'){_data.platprice=1;}
pu.wrapData(_data);window.shipCb=function(d){if(d.errId!=0){pu.myAlertV2({msg:d.errMsg});}
g.oldShiptag=g.shiptag;g.shiptag=obj.shiptag;_self.addClass('selected').siblings().removeClass('selected');zxjjzdCalendar=d.zxjjzdshipment?d.zxjjzdshipment.calendar:[];jzdHtml=shipTpl.child_jzdshipTpl({calendar:zxjjzdCalendar,isla:isla,defaultJzdFee:isla?obj.djdJzdTipFee:obj.zxjJzdTipFee,selStr:isla?(vender.selectedlaShip=='shiplajzd'&&vender._shiplajzdObj.date+vender._shiplajzdObj.time):(vender.selectedShip=='shipjzd'&&vender._shipjzdObj.date+vender._shipjzdObj.time),containFresh:vender.containFresh,getDayType:pu.getDayType});if(isla){$('#jzdLaLi').html(jzdHtml);}else{$('.jzdul').html(jzdHtml);}}
loadJs.loadScript({url:g.isGlobalPay?cgi.globalPay_getShipeffect:cgi.getShipeffect,data:_data});},getSetPayShipParamData:function(obj){var i,l,item,data,_pick=new Array(7),_ship=new Array(22),pickArr,vender=obj.vender,selectShipId=obj.selectShipId,shipType=obj.shipType,choose=obj.choose,jdhonorshipment=null;if(vender.venderType=='0'||vender.venderType=='1'){jdhonorshipment=g.onlineShip&&g.onlineShip.jdhonorshipment&&g.onlineShip.jdhonorshipment[0];}else{jdhonorshipment=g.onlineShip&&g.onlineShip.jdhonorshipment&&g.onlineShip.jdhonorshipment[vender.venderId];}
if(shipType=='0'){if(g.setPayShipData[0]&&g.setPayShipData[0].ship&&g.setPayShipData[0].length==22&&!choose){_ship=g.setPayShipData[0].ship.split('|');}else{_ship=new Array(21);}}else if(shipType=='1'){_ship=new Array(7);}else if(shipType=='2'||shipType=='5'){if(g.setPayShipData[vender.venderId]&&g.setPayShipData[vender.venderId].ship){_ship=g.setPayShipData[vender.venderId].ship.split('|');}else{_ship=new Array(14);}}else if(shipType=='8'){_ship=new Array(8);}else if(shipType=='9'){_ship=new Array(15);}
for(i=0,l=_pick.length;i<l;i++){_pick[i]='';}
for(i=0,l=_ship.length;i<l;i++){_ship[i]=_ship[i]||'';}
_ship[0]=shipType;_ship[1]=selectShipId;if(shipType=='1'||shipType=='2'||shipType=='5'||shipType=='9'){_ship[2]=vender.venderId;}else if(shipType=='8'){_ship[2]='0';}else{_ship[17]='0';}
if(shipType=='0'){if(vender.selectedShip=='ship411'){_ship[2]=5;_ship[7]=2;_ship[11]=vender._ship411Obj.sendpay;}else if(vender.selectedShip=='ship311'){_ship[2]=4;_ship[7]=1;_ship[9]=vender._ship311Obj.date;_ship[10]=vender._ship311Obj.time;_ship[11]=vender._ship311Obj.sendpay;_ship[12]=vender._ship311Obj.batchId;if(vender.smInstall&&vender.smIn311Obj){_ship[20]=vender.shipSmIns.iOffset||'';}else{_ship[20]='';}}else if(vender.selectedShip=='shipjzd'){_ship[2]=6;_ship[7]=3;_ship[9]=vender._shipjzdObj.date;_ship[10]=vender._shipjzdObj.time;_ship[11]=vender._shipjzdObj.sendpay;_ship[12]=vender._shipjzdObj.batchId;_ship[18]=vender._shipjzdObj.shiptag||'';if(vender.smInstall&&vender.smInjzdObj){_ship[20]=vender.shipSmIns.iOffset||'';}else{_ship[20]='';}}
if(g.supCombine){_ship[21]=g.selectCombine?1:0;}else{_ship[21]=0;}
if(vender.shiphonor){_ship[19]=1;}else{_ship[19]=(jdhonorshipment&&jdhonorshipment.canCheckFlag=='1')?2:0;}
_ship[5]=0;}else if(shipType=='3'||shipType=='6'){_pick[0]=shipType;_pick[1]=selectShipId;_pick[2]=vender._shipzitiObj.addr.pickId;_pick[3]=0;_pick[5]=vender._shipzitiObj.date;_pick[6]=vender.venderId;for(item in g.setPayShipData){if(g.setPayShipData[item].pick){pickArr=g.setPayShipData[item].pick.split('|');pickArr[2]=_pick[2];g.setPayShipData[item].pick=pickArr.join('|');}}
_ship=[];}else if(shipType=='2'){_ship[3]=vender._shipSopObj.date||'';_ship[4]=vender._shipSopObj.time||'';_ship[5]=vender._shipSopObj.sendpay||'';_ship[6]=vender._shipSopObj.batchId||'';if(vender.shiphonor){_ship[13]=1;}else{_ship[13]=(jdhonorshipment&&jdhonorshipment.canCheckFlag=='1')?2:0;}}else if(shipType=='5'){_ship[3]=vender._shipSopjdObj.date||'';_ship[4]=vender._shipSopjdObj.time||'';_ship[5]=vender._shipSopjdObj.sendpay||'';_ship[6]=vender._shipSopjdObj.batchId||'';if(vender.shiphonor){_ship[13]=1;}else{_ship[13]=(jdhonorshipment&&jdhonorshipment.canCheckFlag=='1')?2:0;}}else if(shipType=='7'){_ship=[];_pick[0]=7;_pick[1]=70;_pick[2]=vender.shipShopPick&&vender.shipShopPick.picked&&vender.shipShopPick.picked.storeId;_pick[3]=200;_pick[4]=addressCom.getDefAddrFromWqAddr()[0];_pick[5]='';_pick[6]=vender.venderId;}else if(shipType=='8'){_ship[3]=vender._shipGsdObj.date||'';_ship[4]=vender._shipGsdObj.time||'';_ship[5]=vender._shipGsdObj.sendpay||'';_ship[6]=vender._shipGsdObj.batchId||'';_ship[7]=(vender._shipGsdObj.time||'').indexOf('立即送达')>-1?'1':'2';}else if(shipType=='9'){_ship[3]=vender._shipPopGsdObj.date||'';_ship[4]=vender._shipPopGsdObj.time||'';_ship[5]=vender._shipPopGsdObj.sendpay||'';_ship[6]=vender._shipPopGsdObj.batchId||'';_ship[14]=(vender._shipPopGsdObj.time||'').indexOf('立即送达')>-1?'1':'2';}
if(shipType!='3'&&shipType!='6'&&shipType!='7'){_pick=[];}
if(vender.shiplaSopjd){_ship[7]='1';_ship[8]=vender._shipla.defaultDOffset;_ship[9]=vender.shipla.promiseDate;_ship[10]=vender.shipla.promiseTimeRange;_ship[11]=vender.shipla.promiseSendPay;_ship[12]=vender.shipla.batchId;}else if(vender.isla){if(vender.selectedlaShip=='shipla'){_ship[3]=vender._shipla.defaultDOffset;_ship[4]=vender._shipIns.iOffset;_ship[8]=4;}else if(vender.selectedlaShip=='shipla2'){_ship[3]=vender._shipla2Obj.reservingDate;_ship[4]=vender._shipIns.iOffset;_ship[8]=4;_ship[13]=vender._shipla2Obj.date;_ship[14]=vender._shipla2Obj.time;_ship[15]=vender._shipla2Obj.sendpay;_ship[16]=vender._shipla2Obj.batchId;}else if(vender.selectedlaShip=='shiplajzd'){_ship[3]=vender._shiplajzdObj.reservingDate;_ship[4]=vender._shipIns.iOffset;_ship[8]=5;_ship[13]=vender._shiplajzdObj.date;_ship[14]=vender._shiplajzdObj.time;_ship[15]=vender._shiplajzdObj.sendpay;_ship[16]=vender._shiplajzdObj.batchId;_ship[18]=vender._shiplajzdObj.shiptag||'';}else if(vender.selectedlaShip=='shipla411'){_ship[3]='0';_ship[4]=vender._shipIns.iOffset;_ship[8]=6;_ship[13]=vender._shipla411Obj.codDate;_ship[14]=vender._shipla411Obj.speedHour;_ship[15]=vender._shipla411Obj.sendpay;_ship[16]=vender._shipla411Obj.speedMark;}
_pick=[];}
data={'paytype':'0','paychannel':'0','reg':1,'ship':_ship.join('|'),'pick':_pick.join('|'),'action':g.action};return data;},getShipData:function(){var ship=[],pick=[],shipItem,shipData=g.setPayShipData;for(shipItem in shipData){if(shipData[shipItem].ship){ship.push(shipData[shipItem].ship);}
if(shipData[shipItem].pick){pick.push(shipData[shipItem].pick)}}
return[ship.join('$'),pick.join('$')];},getLaOverDay:function(day){var shipData=g.setPayShipData,shipArr,shipItem,day=day||7;try{if(!shipData){return false;}
for(shipItem in shipData){if(shipData[shipItem].ship){shipArr=g.setPayShipData[shipItem].ship.split('|');if(shipItem=='0'&&shipArr[3]-0>day){return true;}else if(shipArr[8]&&shipArr[8]-0>day){return true;}}}
return false;}catch(e){}},formatDateFromOffset:function(formatDateStr,date,offset,formatStr){if(formatDateStr){g._formatDateFromOffset_formatDateStr=formatDateStr;g._formatDateFromOffset_date=date;}else if(g._formatDateFromOffset_formatDateStr){formatDateStr=g._formatDateFromOffset_formatDateStr;date=g._formatDateFromOffset_date;}
var arr=formatDateStr.split(' ')[0].split('-'),offsetDate=new Date(arr[0],parseInt(arr[1],10)-1,parseInt(arr[2],10)+(offset-date));if(!formatStr){formatStr='YYYY-MM-DD';}
return d.format(offsetDate,formatStr);},getItemFormArray:function(option){var opt={'array':option.array,'itemIdName':option.itemIdName,'itemId':option.itemId,'callback':option.callback,'each':option.each},i,l,item,r;if(!opt.array||!opt.itemIdName||!opt.itemId){return false;}
for(i=0,l=opt.array.length;i<l;i++){item=opt.array[i];if(opt.each){opt.each(item);}
if(item[opt.itemIdName]==opt.itemId){r=item;if(opt.callback){opt.callback(r);}}}
return r;},getSelPickItem:function(pickList){var i,j,shipItem,_picked_select,shipZiTiAvailable=null,selItem;for(i=0,j=pickList.length;i<j;i++){shipItem=pickList[i];if(shipItem.selected=='1'){_picked_select=shipItem;}
if(!shipZiTiAvailable&&shipItem.available=='1'){shipZiTiAvailable=shipItem;}}
if(_picked_select){selItem=_picked_select;}else{pickList[0].selected='1';selItem=pickList[0];}
if(selItem.available=='0'){selItem=shipZiTiAvailable?shipZiTiAvailable:selItem;}
return selItem;}}
function refreshCgi(obj){for(var name in obj){cgi[name]=obj[name];}}
function setGByName(obj){g[obj.name]=obj.value;}
function getGByName(name){return g[name];}
exports.shipObj=shipObj;exports.refreshCgi=refreshCgi;exports.setGByName=setGByName;exports.getGByName=getGByName;});
define('wq.confirmV3',function(require,exports,module){var $=require('zepto'),loadJs=require('loadJs'),pu=require('payutil'),payV2=require('payV2'),cookies=require('cookie'),confirmTplV3=require('tpl_wq.confirmV3'),payAddrTpl=require('tpl_s_confirm_payAndAddr'),asset=require('wq.assetNew'),addressCom=require('wq.addr.commonV2'),ship=require('wq.ship'),promote=require('wq.confirm.promote'),assist=require('wq.assist'),fj=require('formatJson'),ajax=require('ajax'),url=JD.url,wa=pu.waReport,g={action:0,userLevel:0,firstVisit:1,firstRender:true,renderPayArea:false,useHonorFreight:false,usePageData:1,useshipData:1,vid:[],lsid:[],bid:url.getUrlParam('bid'),referrer:document.referrer,weixinadkey:pu.getADKEY(),skufrom:url.getUrlParam('skufrom'),packs:url.getUrlParam('packs'),skus:url.getUrlParam('skus'),feetype:url.getUrlParam('feetype'),flowType:url.getUrlParam('flowType'),commlist:url.getUrlParam('commlist')||'',ybcommlist:url.getUrlParam('ybcommlist')||'',jdhscommlist:url.getUrlParam('jdhscommlist')||'',locationid:url.getUrlParam('locationid')||'',activeid:url.getUrlParam('activeid')||'',bizkey:url.getUrlParam('bizkey')||'',bizval:url.getUrlParam('bizval')||'',member:url.getUrlParam('member')||'',isPingou:false,pingouInfoLoaded:false,fixednum:url.getUrlParam('fixednum')||'',isZhongChou:url.getUrlParam('zhongchou')||'',isliangban:(url.getUrlParam('zhongchou')>999&&url.getUrlParam('zhongchou')<1005)?true:false,scan_orig:url.getUrlParam('scan_orig')||'',sceneval:url.getUrlParam('sceneVal')||url.getUrlParam('sceneval')||'',sid:url.getUrlParam('sid')||JD.cookie.get('sid')||'',dpid:url.getUrlParam('dpid')||'',global:url.getUrlParam('global')||0,globalbuy:url.getUrlParam('globalbuy')||0,eCard:url.getUrlParam('eCard')||'',fromBCpage:url.getUrlParam('fromBCpage')||'',songli:url.getUrlParam('songli')||'',jzycwt:url.getUrlParam('jzycwt')||'',roomId:url.getUrlParam('roomId')||'',src:url.getUrlParam('src')||'',type:url.getUrlParam('type')||'0',login:url.getUrlParam('login')||'0',dealId:'',isFreeRegister:url.getUrlParam('freeregister')||'',binded:url.getUrlParam('binded')||'',uin:(cookies.get('wq_uin')||'').replace(/o/g,''),wq_addr:cookies.get('wq_addr'),pin:cookies.get('jdpin')||cookies.get('pin')||'',uuid:'',validateCode:'',addressErr:false,mptype:cookies.get('wxmall_ptype')||0,wareId:url.getUrlParam('wareId')||'',wareNum:url.getUrlParam('wareNum')||'',cpsd:url.getUrlParam('cpsd')||'',fenqi:url.getUrlParam('fenqi')||'',rurl:decodeURIComponent(url.getUrlParam('rurl')||''),bizcode:url.getUrlParam('bizcode')||'',source:url.getUrlParam('source')||'',appSource:cookies.get('source')||'',appkey:cookies.get('appkey')||'',customerinfo:cookies.get('customerinfo')||'',isSupShipSvc:'0',curHeight:'0',rtk:'',miState:'',loading:$('#wxloading'),pages:['pagePay','addressList','pageAddAddress','pageEditAddress','invoices','itemPromoPage','newPromoPage','jdQuanPage','jdCartPage','selectShip','pickList','faPiaoPage','shopList'],weekMap:['今天','周一','周二','周三','周四','周五','周六','周日'],couponChange:false,setDefCoupon:true,gocouponPage:false,userAddrV3:false,fromCart:false,isGlobalPay:false,totalPrice:0,commlistSkuid:0,zcSkuFlag:false,baitiaoData:null,cuofengData:null,lastSelArr:[],curSelArr:[],qqSupWxPay:false,orderIng:false,canFixed:true,selLaTen:false,reset:window.asynConfirm?true:false,modifyShip:false,buyNow:url.getUrlParam('commlist')?true:false,freightSure:false,freightSurePop:false,needLoadAssist:true,reloadCFP:false,containVirtualSuit:false,containTenVideo:false,bgFlag:{virtual:false},disabledValueAddedServieList:[],disabledValueAddedServieShopList:[],globalFirstBuyFlag:0,isCombine:false,newBT:false,isWxapp:0,},PayPassObj,ua=navigator.userAgent,isAndroid=/android/i.test(ua),isBaiduApp=/light.+baiduboxapp/i.test(ua),isJdapp=/jdapp/i.test(ua),isJdjr=/jdjr/i.test(ua)||cookies.get('cid')=='10',isSkapp=/skapp/i.test(ua)||'',isMQQBrowser=/MQQBrowser/i.test(ua),isQuickApp=/com.jd.quickApp/i.test(ua),ump_showinfo=false,modifyNumObj,cmdyop=0,userCenterLink='',addrCgiErrTimer=-1,orderinfoCgiErrTimer=-1,wxConfirmTimer=null,confirmTimer3=null,confirmTimer5=null,waitDataTimer=-1;window.addressObj=null;if(window.locker.defaultAddress){window.param.getDefaultAddr=true;}
window.param.token='';if(window.locker.weinre){pu.weinre();}
var jdDomain3=function(){var jdDomain=(window.userRouter&&window.userRouter.getHost&&window.userRouter.getHost())||'//wqdeal.jd.com/';return(jdDomain.indexOf('/deal/')<0?jdDomain+'deal/':jdDomain);},domain=jdDomain3(),cgi={favorableinfo:'//wq.jd.com/paypromotion/getfavorableinfo',btinfo:'//wq.jd.com/commodity/btinfo/get',dealDetail:'//wqs.jd.com/order/n_detail_v2.shtml',orderlist:'//wqs.jd.com/order/orderlist_merge.shtml',PwdIsActive:'//wq.jd.com/user/info/PwdIsActive',QueryIOUsLimit:'//wq.jd.com/user/smsmsg/QueryIOUsLimit',openBaitiaoUrl:'//wq.jd.com/pinbind/tokenredirect',mOpenBaitiaoUrl:'//wq.jd.com/pinbind/pinTokenRedirect',authorCgi:'//wq.jd.com/vipplus/LoginBrigdeAuthNameAll',globalFirstBuyQuery:'//wqdeal.jd.com/deal/globalpurchase/firstbuyquery',globalFirstBuy:'//wqdeal.jd.com/deal/globalpurchase/firstbuy',paysuc:'//wqs.jd.com/order/paysuc.shtml',searchco:'//wq.jd.com/search/searchco',miaoUrl:'//wqs.jd.com/order/s_confirm_miao.shtml',yunfeimoreitem:'//wqs.jd.com/my/cart/yunfeimoreitem.shtml',jdshopcart:'//wqdeal.jd.com/deal/mshopcart/mycart',mShopcart:'//p.m.jd.com/cart/cart.action',extraYunfeiRule:'//wqs.jd.com/my/cart/extraYunfeiRule.shtml',item:'//wqitem.jd.com/item/view',overseaProtocal:'//ihelp.jd.com/n/help/tip/getTipsFacade.json?tipId=22',globalPayProtocal:'//ihelp.jd.com/n/help/tip/getTipsFacade.json?tipId=23',accountv2:'//wqs.jd.com/my/accountv2.shtml',fanliReport:'//ifanli.m.jd.com/rebate/interface/buildUnionClickBySkus',pinUrl:'//wqs.jd.com/portal/wx/tuan/pingouv3.shtml?ptag=138067.7.3',qqLogin:'//jsapi.qq.com/get?api=live.*',m_cart:'//p.m.jd.com/cart/cart.action',m_home:'//m.jd.com/',m_search:'//so.m.jd.com/category/all.html',m_user:'//home.m.jd.com/myJd/newhome.action',m_cashier:'//p.m.jd.com/norder/payOnLine.action',m_cashier_global:'//mp.jd.hk/norder/payOnLine.action',view:domain+'minfo/orderinfo',globalPay_view:domain+'globalpurchase/orderinfo',venderinfo:domain+'minfo/venderinfo',globalPay_venderinfo:domain+'globalpurchase/venderinfo',userasset:domain+'masset/userasset',globalPay_getcouponlist:domain+'globalpurchase/getcouponlist',setcouponlist:domain+'masset/setcouponlist',globalPay_setcouponlist:domain+'globalpurchase/setcouponlist',SetGbuyAut:domain+'globalpurchase/setgbuyaut',globalPay_confirm:domain+'globalpurchase/confirm',confirm:domain+'msubmit/confirm',assitInfo:domain+'massit/assitinfo',globalPay_assitInfo:domain+'globalpurchase/assitinfo',setpayship2:domain+'mship/setpayship',globalPay_setpayship2:domain+'globalpurchase/setpayship',checkRepeatOrder:domain+'repeat/CheckRepeatOrder',cfp:domain+'massit/getcoudanfreightandprice',freightinsure:domain+'mship/selectbuyerfreightinsure',selloopPackage:domain+'mship/selectpackagingservices',defaultAddrV3:domain+'recvaddr/getrecvaddrV3',appPay:'/pages/payment/payment',};window.sourceDelayTimer&&clearTimeout(window.sourceDelayTimer);if(g.global=='1'||g.globalbuy>0){window.__g.isGlobalPay=true;window.locker.zhongchou=false;checkGlobalFirstBuy();}
if(g.sceneval=='2'||document.domain.indexOf('m.jd.com')>-1){window.mConfirm=true;window.locker.SupMQAddr=false;window.locker.SupWxAddr=false;}
if(window.mConfirm){if(g.wareId){g.commlist=[g.wareId,,g.wareNum,g.wareId,'1,0,0'].join(',');g.buyNow=true;}}
if(window.branch_appconfirm){JD.wxapp.isWxapp(function(value){if(value){g.isWxapp=1;}else{g.isWxapp=2;}});}
if(g.fenqi&&!/^\d+_\d+_\d+\.*\d*_\d+\.*\d*$/.test(g.fenqi)){g.fenqi=false;}
JD.events.listen('pageshow',function(){if(/iphone os 10/i.test(navigator.userAgent)){location.reload();}else{loadDeal('7','0');goPage('pagePay');}});function jump(url){window.location.href=url;}
Array.prototype.unique=function(){var newArr=[],obj={},i,len;for(i=0,len=this.length;i<len;i++){if(!obj[this[i]]){newArr.push(this[i]);obj[this[i]]=true;}}
return newArr;};Array.prototype.equals=function(array){var i,l;if(!array){return false;}
if(this.length!=array.length){return false;}
for(i=0,l=this.length;i<l;i++){if(this[i]instanceof Array&&array[i]instanceof Array){if(!this[i].equals(array[i])){return false;}}else if(this[i]!=array[i]){return false;}}
return true;};(function(){if(window.branch_appconfirm){if((g.source&&g.source!=cookies.get('source'))||(cookies.get('source')&&!g.source)){pu.umpReport({bizid:145,operation:36,result:0,source:'0',message:'no'});}
pu.umpReport({bizid:145,operation:31,result:0,source:'0',message:'no'});}else if(window.mConfirm){pu.umpReport({bizid:488,operation:3,result:0,source:'0',message:'no'});}else{pu.umpReport({bizid:1,operation:12,result:0,source:'0',message:'no'});}
if(/EA\.(17047|17051|17061|17048|17074)/.test(JD.cookie.get('PPRD_P'))){g.sceneval=1;window.addrNullV2=true;}
wa('ptagExposure',{ptag:'7039.30.1'});try{if(window.dealData&&window.dealData.kaplerSource!='0'){wa('ptagExposure',{ptag:'7039.27.32'});}}catch(e){}})();if(g.sceneval=='1'){wa('ptagExposure',{ptag:'7493.2.1'});window.param.addrSlide=true;}
if(g.sceneval=='3'&&!pu.isMQQUserAgent()){g.sceneval='';}
function doReport(){if(!window.ECC_cloud_report_pv){setTimeout(doReport,150);return;}
window.jdPvLog({sale_old_id:g.dealId});}
function barSlider(cl){$('#'+cl+' dt, .item_head').unbind('click').on('click',function(){var p=$(this).parent();if(p.hasClass('on')){p.removeClass('on');}else{p.addClass('on');}});}
function checklogin(url){if(window.branch_appconfirm&&!cookies.get('source')&&g.source.indexOf('3_')>-1){JD.cookie.set('source',g.source,10*365*24*60,"/",'jd.com');pu.myAlertV2({msg:'提交订单失败，请重新选择商品下单~',onConfirm:function(){if(g.isWxapp===1){JD.wxapp.goto('/pages/ftproduct/ftproduct?ulSkuId='+(g.commlist?g.commlist.split(',')[0]:''),'redirectTo');}else{history.back();}}});return;}
if(url){var lh=location.href.split('#')[0];if(lh.indexOf('?')>-1){lh+='&login=1&r='+Math.random();}else{lh+='?login=1&r='+Math.random();}
jump(url+encodeURIComponent(lh+'#wechat_redirect'));}}
function goPage(tag){if(tag=='pagePay'){if((location.hash.indexOf('pageAddAddress')>0&&!window.param.addAddrFromPayPage)||(location.hash.indexOf('pageEditAddress')>0&&!window.param.addAddrFromPayPage)){history.go(-2);}else{history.back();}}else{location.hash=tag+'|'+Math.random();}}
function doHashChange(){var hash=location.hash.split('|')[0],tag=hash.replace(/#/g,''),_title='确认订单';if(g.pages.indexOf(tag)==-1){tag='pagePay';}
$('#jdQuanModel, #userLabelDiv, .mod_alert_mask').hide();$('#pageEditAddress, #pageAddAddress, #invoices').empty();$('#wrapBody').children('div').hide();if(typeof exports['show'+tag]=='function'){exports['show'+tag]();}
$('#'+tag).show();if(window.mConfirm&&!(pu.isWxUserAgent()||pu.isMQQUserAgent()||isJdapp||isJdjr||isSkapp||isQuickApp)&&g.orderObj&&g.orderObj.kaplerTitleShow!='0'){$('.m_header').show();if(isBaiduApp){$('.m_header_bar_back').hide();}
if(tag=='pagePay'&&$('#headnav').hasClass('show')&&!isBaiduApp){$('#headnav').show();}else{$('#headnav').hide();}}
if(tag!=='pagePay'){g.referrer=tag+'-'+g.referrer;}
$('.qq_footer, .wx_footer').hide();if(tag=='pagePay'){$('#titleBar').hide();_title='确认订单';$('.qq_footer, .wx_footer').show();document.body.scrollTop=g.curHeight;window.scrollTo(0,g.curHeight);}else{if(tag=='faPiaoPage'){_title='发票';$('#bottomConfirmBar').show();}else if(tag=='itemPromoPage'){_title='返赠';$('#btnBottomConfirmBar').attr('href','javascript:history.back();').off('click');$('#bottomConfirmBar').show();}else if(tag=='newPromoPage'){_title='优惠';}else if(tag=='addressList'){_title='收货地址';}else if(tag=='jdQuanPage'){_title='京东券';}else if(tag=='jdCartPage'){_title=g.cardType=='code'?'领货码':'礼品卡';}else if((tag=='pageAddAddress'||tag=='pageEditAddress')&&g.locPhone){_title='修改手机号码';g.locPhone=false;}else if(tag=='pageAddAddress'||tag=='pageEditAddress'){_title='收货地址';}else if(tag=='selectShip'){_title='配送安装';}else if(tag=='pickList'){_title='自提地点';}else if(tag==='shopList'){_title='门店地址';}else{_title='确认订单';}
document.body.scrollTop=0;window.scrollTo(0,0);}
document.title=_title;$('.m_header_bar_title').html(_title);if(window.mConfirm){window.scrollTo(1,0);window.scrollTo(0,0);}}
modifyNumObj={'dom':$('#modifyNumDom'),'max':199,'min':1,'orderviewData':null,'hasMfsuit':'','tipScene':1,'_isAchieved':'','_manfan':'','_needMoney':'','_needNum':'','isAchieved':'','manfan':'','needMoney':'','needNum':'',saveVar:function(d){var promo;if(this.isAchieved!==''){this._isAchieved=this.isAchieved;this._manfan=this.manfan;this._needMoney=this.needMoney;this._needNum=this.needNum;}
if(d.order&&d.order.venderCart[0]&&d.order.venderCart[0].mfsuits){promo=d.order.venderCart[0].mfsuits[0].promotion;this.manfan=promo.manfan;this.needMoney=promo.needMoney;this.needNum=promo.needNum;this.isAchieved=d.order.venderCart[0].mfsuits[0].isAchieved;this.multiPromo=d.order.venderCart[0].mfsuits[0].multiPromo;this.hasMfsuit=true;}else{this.hasMfsuit=false;}},compare:function(){var r;if(this._isAchieved=='1'&&this.isAchieved=='0'){r=1;}else if(this._isAchieved=='1'&&this.isAchieved=='1'&&this._manfan!=this.manfan){r=2;}else if(this._isAchieved=='0'&&this.isAchieved=='1'){r=3;}else{r=9;}
return r;},updatePromo:function(action){var html='',giftHtml='',_product;if(action==1){if(this.isAchieved=='1'){if(this.hasMfsuit&&this.multiPromo=='7'&&$('.fn .mmcls').length==0){$('.fn').prepend('<div class="mod_sign_tip mmcls"><b>跨店铺满免</b></div>');}}}else if(action==2){if(this.isAchieved=='0'){if($('.fn .mmcls').length>0){$('.fn .mmcls').remove();}}}
g.orderObj.handlePromTab();try{_product=g.orderObj.products[0];if(_product.c_zengPin||_product.c_score||_product.c_couponList||_product.c_fuJian||(_product.ybList&&_product.ybList.length>0)||_product.giftServiceSku||_product.jdBeanPromo||_product.servicePrjInfo||_product.homeServices){giftHtml=g.orderObj.productPro(_product,0,0);$('#proArea').show();}else{$('#proArea').hide();}
$('#proArea').html(giftHtml);}catch(e){}},loadOrderview:function(num,cb){var data=g.orderviewQuerData,mydata={},newCommlist,self=this,action,oldNum,i,j,_svcidTemp=[],_svcItem=[],_svc,skuPrice,cart,_product,_beanPro,beanPro;g.needLoadAssist=true;if(!data){return;}
for(i in data){mydata[i]=data[i];}
if(!g.commlist&&g._commlist){g.commlist=g._commlist;g.fromCart=true;if(g.isGlobalPay){g.global=0;}}
if(!g.ybcommlist&&g._ybcommlist){mydata.ybcommlist=g._ybcommlist;}
newCommlist=g.commlist.split(',');oldNum=newCommlist[2];if(newCommlist[2]<num){action=1;}else if(newCommlist[2]>num){action=2;}else{return;}
newCommlist[2]=num;newCommlist[5]='0';if(g.orderObj.products[0].mainSku.isChgArea=='1'){newCommlist[0]=newCommlist[3]=g.orderObj.products[0].mainSku.id;pu.umpReport({bizid:1,operation:93,result:1,source:'0',message:'chgarea'});}
if(oldNum<4&&num>3){wa('ptagExposure',{ptag:'7039.23.1'});}
newCommlist[4]=g.orderObj.products[0].mainSku.iType||'1';if(g.orderObj.cartData[0]&&g.orderObj.cartData[0].mfsuits&&g.orderObj.cartData[0].mfsuits[0]){newCommlist[5]=g.orderObj.cartData[0].mfsuits[0].promotion.pid||0;}
if(g.orderObj.cartData[0]&&g.orderObj.cartData[0].mzsuits&&g.orderObj.cartData[0].mzsuits[0]){newCommlist[5]=g.orderObj.cartData[0].mzsuits[0].promotion.pid||0;}
if(g._lipinSku){newCommlist[7]='';newCommlist[8]=g._lipinSku;}
mydata.commlist=newCommlist.join(',');mydata.clearbeancard=0;mydata.cmdyop=1;mydata.useaddr=1;if(mydata.action=='0'){mydata.action='1';g.action='1';}else if(mydata.action=='5'){mydata.action='6';g.action='6';}
pu.wrapData(mydata);if(g.orderObj.svcIds){for(j=0;j<g.orderObj.svcIds.length;j++){_svc=g.orderObj.svcIds[j].split('|');if(_svc[1]=='0')continue;_svcItem.push(_svc[0]);_svcItem.push(_svc[1]);_svcidTemp.push(_svcItem.join('|'));}
mydata.svcid=_svcidTemp.join(',');}
_beanPro=g.orderObj.products[0].jdBeanPromo?true:false;pu.umpReport({bizid:1,operation:94,result:1,source:'0',message:'modifynumPv'});pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_view:cgi.view,'data':mydata,'success':function(d){g.ismodifynum=true;g.reloadCFP=true;handleOrderData(d);var val,msg,skuPrice,itemProduct=g.orderObj.products[0],priceStr;if(g.fromCart&&d.token2){g.token2=d.token2;}
g.commlist=mydata.commlist;self.orderviewData=d;self.saveVar(d);val=g.orderObj.products[0].mainSku.num;self.colEle.input.val(val);skuPrice=((g.orderObj.products[0].mainSku.promotion.price-g.orderObj.products[0].mainSku.promotion.discount)/100).toFixed(2);priceStr='&yen;<span>'+skuPrice.split('.')[0]+'</span>.'+skuPrice.split('.')[1];if(g.buyNow&&itemProduct.jdPrice&&itemProduct.jdPrice/1>0&&itemProduct.showPlusPrice&&itemProduct.showPlusPrice/1>0&&itemProduct.jdPrice/1!=itemProduct.showPlusPrice/1){priceStr+=' <i class="arrow_btm" jdprice="'+itemProduct.jdPrice+'" plusprice="'+
itemProduct.showPlusPrice+'" curPrice="'+skuPrice+'"></i>'}
$($('.sku_price')[0]).html(priceStr);beanPro=g.orderObj.products[0].jdBeanPromo?true:false;if(self.hasMfsuit&&self.tipScene=='1'){if(self.compare()=='1'){msg='修改数量后，您选择的促销优惠“满'+(parseInt(self._needMoney,10)?(self._needMoney/100).toFixed(2):(self._needNum+'件'))+'，减'+(self._manfan/100).toFixed(2)+'”将会失效，是否确定修改？';}else if(self.compare()=='2'){msg='修改数量后，您选择的促销优惠“满'+(parseInt(self._needMoney,10)?(self._needMoney/100).toFixed(2):(self._needNum+'件'))+'，减'+(self._manfan/100).toFixed(2)+'”将会发生变化，是否确定修改？';}
if(msg){pu.myConfirm({'msg':msg,'cancelText':'确定','okText':'取消','onConfirm':function(){val=self.colEle.input.val()-0;self.tipScene=2;self.loadOrderview(oldNum,function(){self.tipScene=1;if(action=='1'){self.updatePromo(2);}else if(action=='2'){self.updatePromo(1);}});},'onCancel':function(){}});}else if(_beanPro&&!beanPro){pu.myAlert('商品购买超过'+oldNum+'件时，不再享受京豆优惠购优惠。');}}else if(_beanPro&&!beanPro){pu.myAlert('商品购买超过'+oldNum+'件时，不再享受京豆优惠购优惠。');}
self.updatePromo(action);self.handleDisabled(val);if(cb){cb();}
wa('jdClick',{ptag:'7039.1.8'});},'error':function(id,msg,d){if(/^(6147|6152|9007)$/.test(id)){loadDeal('7','0');}else{pu.myAlert(msg.replace('全球购','海囤全球'));}}});},handleDisabled:function(val){if(val<=this.min){this.colEle.minus.addClass('disabled');this.colEle.plus.removeClass('disabled');}else if(val>=this.max){this.colEle.minus.removeClass('disabled');this.colEle.plus.addClass('disabled');}else{this.colEle.minus.removeClass('disabled');this.colEle.plus.removeClass('disabled');}},bindEvent:function(){var minus=this.dom.find('[num_tag="minus"]'),plus=this.dom.find('[num_tag="plus"]'),input=this.dom.find('[num_tag="input"]'),self=this,val=input.val()-0;this.colEle={'minus':minus,'plus':plus,'input':input};pu.myBind({'src':this.dom,'fun':function(e,$this){var t=$(e.target),tag=t.attr('num_tag');val=input.val()-0;if(t.hasClass('disabled')){if(self.min>1){pu.oneLineTip({msg:'该商品'+self.min+'件起售'});}
return;}
if(tag=='minus'){self.loadOrderview(val-1);}
if(tag=='plus'){self.loadOrderview(val+1);}}});pu.myBind({'type':'blur','src':input,'fun':function(e,$this){var val=$this.val();if(pu.getOs().versions.ios){if(g.canFixed===false){$('#topFixedDiv').css('position','');$('#topFixedDiv').addClass('fixed');g.canFixed=true;}}
if(val<self.min){val=self.min;}
if(val==''){$this.val(1);val=1;}
$this.val(val);self.loadOrderview(val);}});pu.myBind({'type':'focus','src':input,'fun':function(e,$this){if(pu.getOs().versions.ios){if($('#topFixedDiv').hasClass('fixed')){g.canFixed=false;$('#topFixedDiv').removeClass('fixed');$('#topFixedDiv').css('position','relative');}}}});pu.myBind({'type':'input','src':input,'fun':function(e,$this){var val=$this.val();if(!/^\d+$|^\s*$/.test(val)){val=1;}
if(/0\d+/.test(val)){val=val-0;}
if(val<1&&val!==''){val=1;}
if(val>self.max){val=self.max;}
$this.val(val);self.handleDisabled(val);}});},init:function(){var val;this.min=g.orderObj.products.length>0&&g.orderObj.products[0].mainSku.lowestBuy>0?parseInt(g.orderObj.products[0].mainSku.lowestBuy):1;this.max=g.orderObj.products.length>0&&g.orderObj.products[0].mainSku.maxNum>0?parseInt(g.orderObj.products[0].mainSku.maxNum):199;this.dom=$('#modifyNumDom');this.dom.show();this.bindEvent();val=this.dom.find('input').val();this.handleDisabled(val);wa('jdClick',{ptag:'7039.1.7'});}};function Order(d){this.allSkuArr=[];this.cgiData=d;this.orderPromotion=d.orderPromotion;this.payPassObj=PayPassObj;this.skuidList=d.skulist;this.skuExtInfo=d.skuExtInfo;this.cidList=[];this.venderidList=[];this.cidArr=[];this.vendersById={};this.products=[];this.svcIds=[];this.skuArray=[];this.riskValue=d.riskValue;this.gifts=[];this.gifts['1']=[];this.gifts['2']=[];this.gifts['3']=[];this.mfsuits=[];this.mzsuits=[];this.mfjsuits=[];this.mzsuitsgifts=[];this.homeserviceArr=[];this.mzsuitsgifts_isAchieved=false;this.address=d.order.address;this.totalPrice=d.order.orderprice.totalPrice;this.primiPrice=d.order.orderprice.primiPrice;this.couponDiscount=parseInt(d.order.orderprice.couponDiscount,10)||0;this.giftDiscount=parseInt(d.order.orderprice.giftDiscount,10)||0;this.usedJdBean=parseInt(d.order.orderprice.usedJdBean,10)||0;this.usedBalance=parseInt(d.order.orderprice.usedBalance,10)||0;this.promDiscount=parseInt(d.order.orderprice.promDiscount,10)||0;this.cachBack=parseInt(d.order.orderprice.cachBack,10)||0;this.shippingFee=d.order.orderprice.shippingFee||0;this.notOverLimitFee=d.order.orderprice.notOverLimitFee||0;this.overLimitFee=d.order.orderprice.overLimitFee||0;this.zxjJzdFee=d.order.orderprice.zxjJzdFee||0;this.djdJzdFee=d.order.orderprice.djdJzdFee||0;this.baseShipFee=d.order.orderprice.baseShipFee||0;this.jsdShipFee=d.order.orderprice.jsdShipFee||0;this.pickShipFee=d.order.orderprice.pickShipFee||0;this.samShipFee=d.order.orderprice.samShipFee||0;this.walmartShipFee=d.order.orderprice.walmartShipFee||0;this.sopShipFee=d.order.orderprice.sopShipFee||0;this.freeFreight=d.order.orderprice.freeFreight;this.addWeightFee=d.order.orderprice.addWeightFee;this.freshBaseShipFreight=d.order.orderprice.freshBaseShipFreight;this.freshAddWeightFee=d.order.orderprice.freshAddWeightFee;this.freshPickShipFee=d.order.orderprice.freshPickShipFee;this.orderTaxAmount=d.order.orderprice.orderTaxAmount||0;this.shipSvcFee=d.order.orderprice.shipSvcFee||0;this.venderFreight=d.order.orderprice.venderFreight||0;this.globalSaleFuelFee=d.order.orderprice.globalSaleFuelFee||0;this.crossRegionFee=d.order.orderprice.crossRegionFee||0;this.consignCardDiscount=d.order.orderprice.consignCardDiscount||0;this.samZxjGsdShipFee=d.order.orderprice.samZxjGsdShipFee;this.zxjGsdFee=d.order.orderprice.zxjGsdFee;this.freshGsdFee=d.order.orderprice.freshGsdFee;this.walmartGsdFee=d.order.orderprice.walmartGsdFee;this.qzcBaseShipFee=d.order.orderprice.qzcBaseShipFee;this.qzcOverWeightFee=d.order.orderprice.qzcOverWeightFee;this.qzcZxjSdsShipFee=d.order.orderprice.qzcZxjSdsShipFee;this.gstTaxAmount=d.order.orderprice.gstTaxAmount;this.packagingServicesFee=d.order.orderprice.packagingServicesFee;this.usedGiftCardNum=d.order.orderprice.usedGiftCardNum;this.consignCardNum=d.order.orderprice.consignCardNum;this.weightType=d.order.weightType;this.jdVenderWeight=d.order.jdVenderWeight||0;this.jdVenderAddWeight=d.order.jdVenderAddWeight||0;this.jdVenderFreshWeight=d.order.jdVenderFreshWeight||0;this.jdVenderFreshAddWeight=d.order.jdVenderFreshAddWeight||0;this.freshMisJzdShipFreight=d.order.freshMisJzdShipFreight||0;this.freshBigJzdShipFreight=d.order.freshBigJzdShipFreight||0;this.freshJsdShipFreight=d.order.freshJsdShipFreight||0;this.djdJsdFee=d.order.djdJsdFee||0;this.shiphonor=g.useHonorFreight;this.honorFreight=d.order.orderprice.honorFreight;this.aboardShipFee=d.order.aboardShipFee||0;this.aboardOverWeightFee=d.order.aboardOverWeightFee||0;this.nomal=true;this.containLoc=false;this.containNomal=false;this.usedJBeanPromo=false;this.cartData=this.cgiData.order.venderCart;this.cashBackProduct=0;this.totalPromo2=this.cachBack;this.promoFixed=this.cachBack;this.couponShort=0;this.areaId=d.areaId;this.appid=d.appid;this.dealData=[];this.defaultPin=d.defaultPin;this.invoice=d.order.invoice;this.valuableskus=[];this.selectedCoupon=[];this.proInfo=[];this.limitBuy=d.order.limitBuy||'0';this.isChgArea=d.order.isChgArea;this.closeKaplerCodPay=d.closeKaplerCodPay||g.closeKaplerCodPay;this.kaplerSource=d.kaplerSource||g.kaplerSource;this.kaplerTitleShow=d.kaplerTitleShow||g.kaplerTitleShow;this.isForbidCompanyTransfer=d.isForbidCompanyTransfer||'';}
Order.prototype={updatePrice:function(priceObj,uncheck){var i,venderFeeArr,k,fItem,venderItem;if(priceObj){for(i in priceObj){this[i]=priceObj[i];}}
if(!uncheck){PayPassObj.checkShow(g.orderObj);}
for(k=0,venderFeeArr=priceObj.venderFreight;k<venderFeeArr.length;k++){fItem=venderFeeArr[k],venderItem=g.orderObj.vendersById[fItem.venderId];if(venderItem){venderItem.freight=fItem.freight;venderItem.overLimitFee=fItem.overLimitFee;}}},handleDefAddr:function(){var orderAddr,addrOpt;addrOpt={addrCgi:cgi.addrCgi,checkAddrInfo:true,callback:function(){loadDeal('7',0)}};if(this.address&&this.address.aid&&this.address.aid!='0'){window.param.hasDefAddr=true;g.userAddrV3=false;orderAddr={'type':'1','rgid':'','adid':this.address.aid,'addrdetail':this.address.detail,'addrfull':this.address.full,'name':this.address.name,'mobile':this.address.mobile,'idCard':this.address.idCard,'provinceId':this.address.provId,'cityId':this.address.cityId,'countyId':this.address.countyId,'townId':this.address.townId,'label':this.address.label||'','jd_provinceId':'','jd_cityId':'','jd_countyId':'','jd_townId':'','need_upgrade':this.address.upgrade,'default_address':this.address.default,'jdaddrid':this.address.jdaddrid,'jdaddrname':this.address.jdaddrname,'longitude':this.address.longitude/1000000,'latitude':this.address.latitude/1000000,'areacode':this.address.areaCode||'','namecode':this.address.nameCode||'','phone':this.address.phone||'','email':this.address.email||'','postcode':this.address.postcode||'',};addrOpt.addrObj=orderAddr;addressObj=addressCom.address(addrOpt);if(this.containNomal){addressObj.showDefAddr();}
if(['32','52993','53283'].indexOf(this.address.provId)>-1){this.isAbord=true;}
pu.setCookieForWanggou({jdaddrid:orderAddr.jdaddrid,jdaddrname:orderAddr.jdaddrname});}else{g.userAddrV3=true;addrOpt.addrObj={};addressObj=addressCom.address(addrOpt);addressObj.showNullAddr();}
if(!g.ismodifynum){g.orderObj.handleAddress();}},creatProducts:function(){var m,n,cart,that=this,unableCouponNum=0,mainNum=0,ybArr=[],packId='0',unSvc,ybItem,singleProduct,skuIds=[],svcIds=[],svcName={},chgGoods=[],isWalmart='0',typeid='7',curVid,serviceIds=[],supService=false,samsVipGoods=[],containFresh=false,suittype='',containDepot=false,containPop=false,containZY=false,venderType,containFactory=false,vItem,tVender,combVid=[],vcidArr;var isVenderCrossRegion='';if(!this.cgiData){return;}
cart=this.cartData;g.lsid=[];g.containVirtualSuit=false;g.containTenVideo=false;g.bgFlag.svczySub=false;g.bgFlag.svcpopSub=false;g.disabledValueAddedServieList=[];g.disabledValueAddedServieShopList=[];this.un7day=false;this.isSeptax=false;this.mzsuitsgifts_isAchieved=false;this.contianUnTen=false;this.onlySamsWalmart=true;this.cidArr=[];this.v_cid=[];function _get(cart,target){var i,l,j,k,ll,kk,ii,mm,item,productItem,selShipSvcArr=[];skuIds=[];svcIds=[];svcName={};containFresh=false;containZY=false;containFactory=false;venderType=cart.venderType;unSvc=false;supService=false;serviceIds=[];vcidArr=[];curVid=cart.venderId;suittype='';isVenderCrossRegion='';if(['0','1'].indexOf(cart.venderType)>-1){containDepot=true;}else{containPop=true;}
if(cart.products){for(i=0,l=cart.products.length;i<l;i++){cart.products[i].venderId=cart.venderId;cart.products[i].mainSku.iType='1';handleProduct(cart.products[i]);target.push(cart.products[i]);}}
if(cart.suits){for(i=0,l=cart.suits.length;i<l;i++){suittype=cart.suits[i].suitType||'';for(j=0,k=cart.suits[i].products.length;j<k;j++){productItem=cart.suits[i].products[j]
productItem.isTaozhuang=true;productItem.suitNum=cart.suits[i].num;productItem.venderId=cart.venderId;productItem.mainSku._suitId=cart.suits[i].promotion?cart.suits[i].promotion.pid:'0';productItem.mainSku._promo_pid=cart.suits[i].promotion?cart.suits[i].promotion.pid:'0';productItem.mainSku.iType='4';if(j==0){productItem.suitStart=true;productItem.suitName=cart.suits[i].name;}
if(j==k-1){productItem.suitEnd=true;productItem.suitPrice=cart.suits[i].promotion.discountPrice;}
handleProduct(productItem);target.push(productItem);}}}
if(cart.mfsuits){for(i=0,l=cart.mfsuits.length;i<l;i++){item=cart.mfsuits[i];if(item.isAchieved=='1'){that.mfsuits.push(item);}
for(j=0,k=cart.mfsuits[i].products.length;j<k;j++){productItem=cart.mfsuits[i].products[j];productItem.venderId=cart.venderId;productItem.mainSku.iType='11';productItem.mainSku._promo_pid=cart.mfsuits[i].promotion.pid;if(cart.mfsuits[i].multiPromo=='7'&&cart.mfsuits[i].isAchieved=='1'){productItem.isManmian=true;}
handleProduct(productItem);target.push(productItem);}
if(item.suits&&item.suits.length>0){g.containVirtualSuit=true;for(ll=0,kk=item.suits.length;ll<kk;ll++){for(ii=0,mm=item.suits[ll].products.length;ii<mm;ii++){productItem=item.suits[ll].products[ii];productItem.isTaozhuang=true;productItem.isMfVSuit=true;productItem.venderId=cart.venderId;productItem.suitNum=item.suits[ll].num;productItem.mainSku._suitId=item.suits[ll].promotion?item.suits[ll].promotion.pid:'0';productItem.mainSku.iType='24';productItem.mainSku.vskuId=item.suits[ll].vskuId;productItem.mainSku._promo_pid=item.promotion.pid;if(ii==0){productItem.suitStart=true;productItem.suitName=item.suits[ll].name;}
if(ii==mm-1){productItem.suitEnd=true;productItem.suitPrice=item.suits[ll].promotion.discountPrice;}
handleProduct(productItem);target.push(productItem);}}}}}
if(cart.mzsuits){for(i=0,l=cart.mzsuits.length;i<l;i++){item=cart.mzsuits[i];for(j=0,k=item.products.length;j<k;j++){productItem=item.products[j];productItem.venderId=cart.venderId;productItem.mainSku.iType='13';productItem.mainSku._promo_pid=item.promotion.pid;handleProduct(productItem);target.push(productItem);}
if(item.promotion.addMoney!='0'||(item.fullType&&item.fullType=='24')){for(j=0,k=item.selectedGiftSkus.length;j<k;j++){item.selectedGiftSkus[j].isJiaJiaGou=true;item.selectedGiftSkus[j].fullType=item.fullType;item.selectedGiftSkus[j].venderId=cart.venderId;item.selectedGiftSkus[j].mainSku.iType='13';item.selectedGiftSkus[j].mainSku._promo_pid=item.promotion.pid;item.selectedGiftSkus[j].mainSku.isJiaJiaGou=true;handleProduct(item.selectedGiftSkus[j]);target.push(item.selectedGiftSkus[j]);}}else{if(item.isAchieved=='1'){for(j=0,k=item.selectedGiftSkus.length;j<k;j++){that.mzsuitsgifts.push(item.selectedGiftSkus[j]);}
that.mzsuitsgifts_isAchieved=true;}}
if(item.isAchieved=='1'){if(item.promotion.addMoney=='0'){that.mzsuits.push(item);}else if(item.promotion.manfan>0){that.mfjsuits.push(item);}
if(item.selectedGiftSkus&&item.selectedGiftSkus.length>0){item.selectedGiftSkus.forEach(function(mzgift){mzgift.mainSku.nostockPid=item.promotion.pid;that.gifts['3'].push(mzgift.mainSku);});}}
if(item.suits&&item.suits.length>0){g.containVirtualSuit=true;for(ll=0,kk=item.suits.length;ll<kk;ll++){for(ii=0,mm=item.suits[ll].products.length;ii<mm;ii++){productItem=item.suits[ll].products[ii];productItem.isTaozhuang=true;productItem.isMzVSuit=true;productItem.venderId=cart.venderId;productItem.suitNum=item.suits[ll].num;productItem.mainSku._suitId=item.suits[ll].promotion?item.suits[ll].promotion.pid:'0';productItem.mainSku.iType='29';productItem.mainSku.vskuId=item.suits[ll].vskuId;productItem.mainSku._promo_pid=item.promotion.pid;if(ii==0){productItem.suitStart=true;productItem.suitName=item.suits[ll].name;}
if(ii==mm-1){productItem.suitEnd=true;productItem.suitPrice=item.suits[ll].promotion.discountPrice;}
handleProduct(productItem);target.push(productItem);}}}}}
for(var svcid in svcName){if(svcName[svcid]){selShipSvcArr.push(svcName[svcid]);}}
if(unSvc&&cart.isSupShipSvc=='1'){cart.svcAndShip=true;}
cart.selShipSvc=selShipSvcArr.join('+');cart.skuIds=skuIds;cart.svcIds=svcIds;cart.supService=supService;cart.serviceIds=serviceIds;cart.containFresh=containFresh;cart.containFactory=containFactory;cart.containZY=containZY;that.svcIds=that.svcIds.concat(svcIds);}
this.venders=[];ship.setGByName({name:'setPayShipData',value:{}});ship.setGByName({name:'supShipInstall',value:'0'});ship.setGByName({name:'needSetShip',value:false});for(m=0,n=cart.length;m<n;m++){isWalmart='0';this.vendersById[cart[m].venderId]=cart[m];that.venderidList.push(cart[m].venderId);this.venders[m]={products:[],venderId:cart[m].venderId,venderType:cart[m].venderType,venderName:cart[m].venderName,jdShipment:cart[m].jdShipment,freight:cart[m].freight,isSams:cart[m].isSams};_get(cart[m],this.venders[m].products);cart[m].products=this.venders[m].products;cart[m].isWalmart=isWalmart;this.venders[m].suittype=suittype;this.venders[m].isWalmart=isWalmart;if(m==1){cart[0].containFactory=cart[0].containFactory||cart[m].containFactory;cart[0].containZY=cart[0].containZY||cart[m].containZY;this.venders[0].containFactory=cart[0].containFactory||cart[m].containFactory;this.venders[0].containZY=cart[0].containZY||cart[m].containZY;}else{this.venders[m].containFactory=cart[m].containFactory;this.venders[m].containZY=cart[m].containZY;}
cart[m].isVenderCrossRegion=isVenderCrossRegion;if(cart[m].venderId>0){g.vid.push(cart[m].venderId);}else{if(cart[m].venderPrice>0){g.venderPrice=cart[m].venderPrice;}}
that.v_cid.push(cart[m].venderId+','+vcidArr.join(','));if(!g.bgFlag.svc&&cart[m].isSupShipSvc=='1'){g.bgFlag.svc=true;wa('ptagExposure',{ptag:'7039.23.1'});}
if(cart[m].venderId=='0'&&cart[m].isSupShipSvc=='1'){g.bgFlag.svczySub=true;if(!g.bgFlag.svczy){g.bgFlag.svczy=true;wa('ptagExposure',{ptag:'7039.23.5'});}}else if(cart[m].isSupShipSvc=='1'){g.bgFlag.svcpopSub=true;if(!g.bgFlag.svcpop){g.bgFlag.svcpop=true;wa('ptagExposure',{ptag:'7039.23.3'});}}
if(!g.bgFlag.virtual&&g.containVirtualSuit){wa('jdClick',{ptag:'7039.19.1'});g.bgFlag.virtual=true;}
if(!g.bgFlag.locAndNomal&&this.containLoc&&this.containNomal){g.bgFlag.locAndNomal=true;wa('ptagExposure',{ptag:'7039.1.111'});}
if(!g.bgFlag.loc&&this.containLoc){g.bgFlag.loc=true;wa('ptagExposure',{ptag:'7039.1.112'});}
ship.shipObj.handleShipContent({'action':g.action,'isPingou':g.isPingou,'vender':cart[m],'venders2':this.venders[m],'payment':this.cgiData.order.payment});}
function handleProduct(item){var skustrArr=[],mm,nn,gift,item_score,item_couponList,item_coupon_quota,sku_cid2,sku_cid3,cidArr,sItem;if(item.mainSku.isCanUseDQ=='0'||item.mainSku.isCanUseJQ=='0'){unableCouponNum++;}
if(!item.isJiaJiaGou){mainNum++;}
skuIds.push(item.mainSku.id);svcIds.push(item.mainSku.id+'|'+item.mainSku.shipSvcItemId+'|'+item.mainSku.shipSvcTemplateId);svcName[item.mainSku.shipSvcItemId]=item.mainSku.shipSvcItemName;if(item.mainSku.isFreeload=='1'){supService=true;serviceIds.push(item.mainSku.id+'|'+item.mainSku.shipSvcTemplateId+'|'+item.mainSku.num);}
if(g.isPingou){item.isPingou=true;}
item.c_fuJian=false;item.c_zengPin=false;if(item.gifts){for(mm=0,nn=item.gifts.skus.length;mm<nn;mm++){gift=item.gifts.skus[mm];if(gift.zxLx=='1'){samsVipGoods.push(gift.id);}
if(gift.isAccessory=='1'){that.gifts['1'].push(gift);item.c_fuJian=true;}else{gift.productID=item.mainSku.id;gift._suitId=item.mainSku._suitId||'0';gift.isMfVSuit=item.isMfVSuit||false;gift.isMzVSuit=item.isMzVSuit||false;gift.vskuId=item.mainSku.vskuId||'';gift.pid=item.mainSku._promo_pid||'';if(gift._suitId!=0){gift.num=gift.num*(item.suitNum||1);}
that.gifts['2'].push(gift);item.c_zengPin=true;}
if(gift.plusGiftPromo=='1'){item.c_plusGift=true;}
item.c_giftTitle=gift.giftName||'赠品';}}
if(item.homeServices){for(mm=0,nn=item.homeServices.length;mm<nn;mm++){sItem=item.homeServices[mm];sItem.productID=item.mainSku.id;sItem._suitId=item.mainSku._suitId||'';sItem.isMfVSuit=item.isMfVSuit||false;sItem.isMzVSuit=item.isMzVSuit||false;sItem.vskuId=item.mainSku.vskuId||'';sItem.isHomeService=true;that.homeserviceArr.push(sItem);}}
if(item.servicePrjInfo){if(item.servicePrjInfo.status=='0'){g.disabledValueAddedServieList.push({mainSkuId:item.mainSku.id,mainSkuNum:item.mainSku.num,serviceName:item.servicePrjInfo.serviceProjectName,});}else if(item.servicePrjInfo.status=='-1'){g.disabledValueAddedServieShopList.push({shopName:item.servicePrjInfo.locShopName,});}}
if(item.mainSku.locType=='1'&&item.mainSku.lsId){g.lsid.push(item.mainSku.lsId);}
if(item.mainSku.isWalmart=='1'){isWalmart=item.mainSku.isWalmart;}
if(item.mainSku.shipSvcItemId=='0'&&!item.isJiaJiaGou){unSvc=true;}
if(item.usedJBeanPromo=='1'){that.usedJBeanPromo=true;}
if(item.jdBeanPromo&&!g.bgFlag.beanPro){wa('jdClick',{ptag:'7014.24.3'});g.bgFlag.beanPro=true;}
if(item.mainSku.promotion){item_score=Number(item.mainSku.promotion.score)||0;item_couponList=item.mainSku.promotion.donatedCouponList||[];if(item_score>0){item.c_score=item_score;}
item_coupon_quota=0;for(mm=0,nn=item_couponList.length;mm<nn;mm++){item_coupon_quota+=Number(item_couponList[mm].quota)||0;}
if(item_coupon_quota>0){item.c_couponList=item_coupon_quota;}}
if(item.mainSku.promotion&&item.mainSku.promotion.cashback>0){that.cashBackProduct+=Number(item.mainSku.promotion.cashback)*(item.isTaozhuang?(item.suitNum*item.mainSku.num):item.mainSku.num||0);}
if(g.isGlobalPay){item.isGlobalPay=true;}
if(item.mainSku.isFresh=='1'){that.containFresh=true;containFresh=true;}
if(['1','2'].indexOf(item.mainSku.locType)>-1){that.containLoc=true;}else{that.containNomal=true;}
if(item.mainSku.locType!='4'){that.contianUnTen=true;}
if(item.mainSku.isNew7Day=='0'){that.un7day=true;}
if(item.mainSku.isCrossRegion=='1'){wa('ptagExposure',{ptag:'7039.32.1'});}
if(item.mainSku.isCrossRegion=='1'||item.mainSku.isCrossRegion=='4'){isVenderCrossRegion='needPay';}
if(item.mainSku.isCrossRegion=='2'||item.mainSku.isCrossRegion=='3'){isVenderCrossRegion=isVenderCrossRegion==='needPay'?'needPay':'isFree';}
if(item.mainSku.isSeptax=='2'){that.isSeptax=true;}
if((item.mainSku.isSeptax=='0'||item.mainSku.isSeptax=='')&&item.mainSku.overseaPurchaseCode=='2'){that.isSeptax=true;}
that.skuArray.push(item.mainSku.id);cidArr=item.mainSku.cid.indexOf('_')>-1?item.mainSku.cid.split('_'):[];sku_cid2=cidArr[1]||'';sku_cid3=cidArr[2]?cidArr[2]:item.mainSku.cid;that.cidList.push(sku_cid3);that.cidArr.push(item.mainSku.id+'|'+item.mainSku.cid);if(vcidArr.indexOf(item.mainSku.cid)==-1){vcidArr.push(item.mainSku.cid);}
that.valuableskus.push(item.mainSku.id+','+item.mainSku.num+','+(parseInt(item.mainSku.promotion.price,10)-parseInt(item.mainSku.promotion.discount,10))+','+sku_cid3);g.orderObj.allSkuArr.push(item.mainSku.id);skustrArr=[];if(item.mainSku.weightType=='2'){skustrArr.push((item.mainSku.weight/1000).toFixed(3)+'kg/件');}else if(item.mainSku.weightType=='1'){skustrArr.push('不计重量');}
if(item.mainSku.color){skustrArr.push(item.mainSku.color);}
if(item.mainSku.size){skustrArr.push((item.mainSku.cmmz?item.mainSku.cmmz+'：':'')+item.mainSku.size);}
if(item.mainSku.saleProps&&item.mainSku.saleProps.length>0){for(var ii=0;ii<item.mainSku.saleProps.length;ii++){skustrArr.push(item.mainSku.saleProps[ii].saleValue);}}
if(skustrArr.length>0){item.mainSku.skuString=skustrArr.join('，');}
that.proInfo.push([item.mainSku.id,item.mainSku.num,item.mainSku.promotion.price,item.mainSku.promotion.discount,sku_cid2,sku_cid3,curVid].join(','));if(item.mainSku.isChgArea=='1'){chgGoods.push(item);}
if(item.mainSku.zxLx=='1'){samsVipGoods.push(item.mainSku.id);}
if(item.mainSku.isnoZY==1&&item.mainSku.factoryShip==1){containFactory=true;}else if(item.venderId==0||venderType==1){containZY=true;}}
this.venders.forEach(function(item){that.products=that.products.concat(item.products);});this.venders.sort(function(a,b){return a.venderType-b.venderType;});for(m=0,n=this.venders.length;m<n;m++){vItem=this.venders[m];if(vItem.isTenVideo){g.containTenVideo=true;}
if(['0','1'].indexOf(vItem.venderType)>-1&&!vItem.isloc&&!vItem.isTenVideo){if(vItem.isWalmart!='1'&&vItem.isSams!='1'){this.onlySamsWalmart=false;}
if(!tVender){tVender=vItem;}else{tVender.products=tVender.products.concat(vItem.products);vItem.combed=true;}
combVid.push(vItem.venderId);}}
if(combVid.length>1){tVender.combVid=combVid.join('_');}
if(this.containLoc&&!g.bgFlag.loc){g.bgFlag.loc=true;wa('ptagExposure',{ptag:'7039.20.1'});}
if(mainNum==1){g.orderObj.cJiaJiaGou=false;for(m=0;m<that.products.length;m++){if(!that.products[m].isJiaJiaGou){singleProduct=that.products[m];}else{g.orderObj.cJiaJiaGou=true;}}
if(that.products.length==1&&!that.products[0].isTaozhuang){g.canModifyNum=true;}else{g.canModifyNum=false;}
if(!g.commlist){g._commlist=(singleProduct.mainSku.vskuId||singleProduct.mainSku.id)+','+
(singleProduct.mainSku.lsId||'')+','+
(singleProduct.mainSku.suitNum||singleProduct.mainSku.num)+','+(singleProduct.mainSku.vskuId||singleProduct.mainSku.id)+',1,0,0';if(singleProduct.ybList&&singleProduct.ybList.length>0){if(singleProduct.mainSku.iType=='1'){typeid='8';}else{packId=singleProduct.mainSku._promo_pid;}
for(m=0,n=singleProduct.ybList.length;m<n;m++){ybItem=singleProduct.ybList[m];ybArr.push(ybItem.ybsku.id+',0,0,'+singleProduct.mainSku.id+','+typeid+','+singleProduct.mainSku.id+','+packId+',0');}
g._ybcommlist=ybArr.join('$');}
if(singleProduct.giftServiceSku&&singleProduct.giftServiceSku.id){g._lipinSku=singleProduct.giftServiceSku.id;}}}
this.chgGoods=chgGoods;this.samsVipGoods=samsVipGoods;this.unableCouponNum=unableCouponNum;this.mainNum=mainNum;this.containDepot=containDepot;this.containPop=containPop;assist.showValueAddedServiceExpTip({disabledValueAddedServieList:g.disabledValueAddedServieList,disabledValueAddedServieShopList:g.disabledValueAddedServieShopList,callback:function(rsp){if(rsp.errId=='0'){loadDeal('7',0);}else{pu.myAlert(rsp.errMsg,function(){history.back();});}}});},handleTipAddr:function(){addressObj.handleTipAddr(function(){loadDeal('7',0)});},handleSamsGoods:function(){var html,i,item;if(g.isChgArea=='1'&&g.orderObj.chgGoods.length==0){for(i=0;i<g.orderObj.products.length;i++){item=g.orderObj.products[i];if(item.mainSku.isSams=='1'){g.orderObj.chgGoods.push(item);}}}
if(g.isChgArea!='1'||g.orderObj.chgGoods.length==0){return;}
g.isChgArea='0';try{html=confirmTplV3.child_samsTpl(g.orderObj.chgGoods);$('#samsTip').html(html);$('.mod_alert_mask, #samsTipAlert').show();$('#samsBtn').off('click').on('click',function(e){wa('jdClick',{ptag:'7039.14.2'});$('.mod_alert_mask, #samsTipAlert').hide();});wa('jdClick',{ptag:'7039.14.1'});}catch(e){}},handleRedPacket:function(d){if(!d){return;}
asset.init([{name:'redPacket',dom:'#jdRedPacketTab',data:d,action:g.action,platprice:g.usePcPrice=='1'?'1':'0',selRedPacketCb:function(d){if(d.order&&d.order.orderprice){g.orderObj.updatePrice(d.order.orderprice);}
g.orderObj.updateBuyDiscountArea(d);g.orderObj.handleUserasset();},}]);},handleBean:function(d){g.orderObj.rShowNewUserTip(d.total>0);asset.init([{'name':'bean','dom':'#jdBeanTab','action':g.action,'beanData':d,'platprice':g.usePcPrice=='1'?'1':'0','initCallback':function(){pu.myBind({'src':'#dShiming','fun':function(e,$this){var tipHtml='您可以通过输入身份证等信息进行实名认证~',okText='确定';if(g.userObj&&g.userObj.state=='1'){tipHtml='您当前登录的账号信息不完善，请先完善账号，转移资产，并完成实名认证。';okText='去完善';}else if(g.userObj&&g.userObj.state=='2'){tipHtml='您当前登录的账号信息不完善，请先绑定账号，转移资产，并完成实名认证。';okText='去绑定';}else if(g.userObj&&g.userObj.state=='3'){tipHtml='您当前登录的账号信息不完善，请先切换账号，转移资产，并完成实名认证。';okText='去切换';}
wa('jdClick',{ptag:'7039.1.101'});pu.myConfirm({msg:tipHtml,icon:'info',cancelText:okText,okText:'取消',onCancel:function(){shiming();},});}});},'callback':function(d){g.isassetCgi=true;if(d.order&&d.order.orderprice){g.orderObj.updatePrice(d.order.orderprice);}
g.orderObj.updateBuyDiscountArea(d);g.orderObj.rShowNewUserTip(d.order.jdbean.total>0);g.orderObj.handleUserasset();wa('jdClick',{ptag:' 7039.29.1'});}}]);function shiming(){var data={scene:pu.isWxUserAgent()?'weixin':'qq',bussinessType:'518',sceneid:'5290158',rurl:location.href};location.href=cgi.authorCgi+'?'+$.param(data);}},handleBalance:function(d){if(d.balance){d.usedBalance=this.usedBalance;}
asset.init([{'name':'balance','dom':'#jdBalanceTab','action':g.action,'balanceData':d,'platprice':g.usePcPrice=='1'?'1':'0','callback':function(d){if(d.order&&d.order.orderprice){g.orderObj.updatePrice(d.order.orderprice);}
g.orderObj.handleUserasset();}}]);},handleCard:function(d){var i,cItem,item,j,_html='',giftcardList=d,cardList=[],cannotCardList=[],_cHtml='',codeList=[],cannotCodeList=[],cardNumObj;if(!giftcardList){return;}
for(i=0;i<giftcardList.length;i++){cItem=giftcardList[i];cardNumObj=cardNumObj?cardNumObj:(cItem.giftcardnum||{});if(cItem.type=='2'){cardNumObj.canUsedCardMaxNum=cItem.giftcardnum?cItem.giftcardnum.canUsedCardMaxNum:200;}else if(cItem.type=='5'){cardNumObj.canUsedCollarMaxNum=cItem.giftcardnum?cItem.giftcardnum.canUsedCardMaxNum:200;}
if(cItem.giftcard.length>0){for(j=0;j<cItem.giftcard.length;j++){item=cItem.giftcard[j];if(this.defaultPin!='0'){item.enabled='0';}
if(item.enabled=='1'){if(item.type=='3'&&['2','3'].indexOf(item.style)>-1){codeList.push(item);}else{cardList.push(item);}}else{if(item.type=='3'&&['2','3'].indexOf(item.style)>-1){cannotCodeList.push(item);}else{cannotCardList.push(item);}}}}}
if(cardNumObj.usableCardNum=='0'&&cardNumObj.unableCardNum=='0'&&cardNumObj.usableCollarGoodsNum=='0'&&cardNumObj.unableCollarGoodsNum=='0'){cardNumObj.usableCardNum=cardList.length;cardNumObj.unableCardNum=cannotCardList.length;cardNumObj.usableCollarGoodsNum=codeList.length;cardNumObj.unableCollarGoodsNum=cannotCodeList.length;}
if(cardNumObj.usableCardNum==0&&cardNumObj.unableCardNum>0){_html='<em class="disabled">无可用</em>';}else if(cardNumObj.usableCardNum>0&&this.giftDiscount/1==0){_html='<span class="coupon">'+cardNumObj.usableCardNum+'张可用</span><em>去使用</em>';}else if(this.giftDiscount>0){_html='<em>已用'+(this.usedGiftCardNum||'*')+'张，'+'已抵用&yen;'+(this.giftDiscount/100).toFixed(2)+'</em>';}else if(!g.eCard){_html='<em class="disabled">无可用</em>';}
$('#jdCartTab').html('<a href="javascript:void(0)" class="content"><strong>礼品卡</strong>'+_html+'</a>').show();if(cardNumObj.usableCollarGoodsNum==0&&cardNumObj.unableCollarGoodsNum>0){_cHtml='<em class="disabled">无可用</em>';}else if(cardNumObj.usableCollarGoodsNum>0&&this.consignCardDiscount==0){_cHtml='<span class="coupon">'+cardNumObj.usableCollarGoodsNum+'张可用</span><em>去使用</em>';}else if(this.consignCardDiscount>0){_cHtml='<em>已用'+(this.consignCardNum||'*')+'张，'+'已抵用&yen;'+(this.consignCardDiscount/100).toFixed(2)+'</em>';}
if(_cHtml){$('#codeTab').html('<a href="javascript:void(0)" class="content"><strong>领货码</strong>'+_cHtml+'</a>').show();}
g.cardSelNum='';g.codeSelNum='';if(cardNumObj.usableCardNum>0||cardNumObj.unableCardNum>0||cardNumObj.usableCollarGoodsNum>0||cardNumObj.unableCollarGoodsNum>0){g.orderObj.rShowNewUserTip(true);}else{g.orderObj.rShowNewUserTip(false);}
g.orderObj.cardList=cardList.sort(function(a,b){return b.type-a.type||a.cardBrand-b.cardBrand;});g.orderObj.cannotCardList=cannotCardList.sort(function(a,b){return a.cardBrand-b.cardBrand;});g.orderObj.codeList=codeList;g.orderObj.cannotCodeList=cannotCodeList;g.orderObj.cardNumObj=cardNumObj;if(g.fromBCpage){window.setTimeout(function(){goPage('jdCartPage');g.fromBCpage=false;},500)}},showInPage:function(){var vHtml,cHtml,remarkItem,msgDiv,msgVal,remarkArr=[],markItem,i,xssReg=/[<>]/g;try{remarkItem=$('.buy_msg_v2');remarkItem.forEach(function(item){msgDiv=$(item);msgVal=msgDiv.find('input').val().trim().replace(xssReg,'');if(msgVal){remarkArr.push(msgDiv.attr('venderId')+'|'+msgVal);}});}catch(e){}
if(g.firstRender&&!window.asynConfirm){cHtml=confirmTplV3.child_buyDiscountAreaTpl(this);$('#buyDiscountArea').html(cHtml)}else{vHtml=fj.formatJson('tpl_venderOrderList',{it:this,productPro:this.productPro,buyNow:g.buyNow});$('#venderList').html(vHtml);if((window.asynConfirm&&g.firstRender)||g.initDiscoutArea){cHtml=confirmTplV3.child_buyDiscountAreaTpl(this);$('#buyDiscountArea').html(cHtml);g.initDiscoutArea=false;}
this.handlePromTab();}
if(remarkArr.length>0){for(i=0;i<remarkArr.length;i++){markItem=remarkArr[i].split('|');$('.buy_msg_v2[venderid="'+markItem[0]+'"] input').val(markItem[1]);$('.buy_msg_v2[venderid="'+markItem[0]+'"] .tip').html(markItem[1].length+'/45');}}
g.firstRender=false;if(!g.point5){window._PFM_TIMING[4]=new Date();g.point5=true;}
if(!this.containNomal){$('.order_info').css('margin-top',0);}
if(window.locker.modifyNum&&(g.commlist&&!g.orderObj.cJiaJiaGou||g.canModifyNum)&&g.type=='0'&&g.commlist.indexOf('$')<0&&g.skufrom!='ol'&&g.skufrom!='od1'&&g.skufrom!='od2'&&g.skufrom!='order'&&(g.action=='1'||g.action=='6'||g.action=='3'||g.action=='0'||g.action=='5'||g.action=='17')&&!g.isZhongChou&&g.fixednum!='1'){modifyNumObj.init();g.supModifyNum=true;}else{$('.sku_num').show();g.supModifyNum=false;}
ump_showinfo=true;if(this.un7day){$('#un7day').addClass('show').show();}else{$('#un7day').hide();}
if(this.products.length==1&&this.products[0].mainSku&&this.products[0].mainSku.isUsedKanjia=='1'){$('.sku_num').show();$('#modifyNumDom').hide();}
$('[shiptype]').each(function(i,item){if(!$(item).attr('shiptype')){$(item).addClass('noClick');}});if(!(this.mfsuits&&this.mfsuits.length>0&&this.products.length>1)&&$('#tabPromotionList').length>0){wa('ptagExposure',{ptag:'7039.1.96'});}
if(window.mConfirm&&!(pu.isWxUserAgent()||pu.isMQQUserAgent()||isJdapp||isJdjr||isSkapp||isQuickApp)&&this.kaplerTitleShow!='0'){$('.m_header').show();if(this.kaplerSource!='0'&&!isBaiduApp){$('.m_header_bar_menu').show();}
if(isBaiduApp){$('.m_header_bar_back').hide();}}
if(this.address&&['32','52993','53283'].indexOf(this.address.provId)>-1){$('#overseaDiv').show();}else{$('#overseaDiv').hide();}
if(g.isGlobalPay){$('#globalPayDiv').show();}else{$('#globalPayDiv').hide();}
this.showPayArea();},showCouponlist:function(d){function _handle(d){var j,k,_item,that=this,differAmount=99999999,_diffCouponList=[],_cannotUseCouponList=[];this.couponList=d.couponList||[];this.selectedCoupon=[];this.couponListCount=this.couponList.length;this.cannotUseCouponList=d.cannotUseCouponList||[];this.cannotUseCouponListCount=this.cannotUseCouponList.length;this.useJing=false;for(j=0,k=this.couponList.length;j<k;j++){this.couponList[j].cu='1';if(this.couponList[j].readOnly=='1'){this.couponList[j].cannotUse=true;}
if(this.couponList[j].selected=='1'){this.selectedCoupon.push(this.couponList[j]);}
if(this.couponList[j].type=='0'&&this.couponList[j].selected=='1'){this.useJing=true;}}
for(i=0,l=this.cannotUseCouponList.length;i<l;i++){_item=this.cannotUseCouponList[i];_item.cannotUse=true;_item.isCannotUse=true;if(_item.differAmount>0){differAmount=Math.min(_item.differAmount,differAmount);if(_item.limitType=='0'){_item.differAmountLink='//wqs.jd.com/portal/wx/category_m.shtml';}else{_item.differAmountLink=cgi.searchco+"?"+$.param({coupon_batch:_item.batchId,coupon_aggregation:'yes',icart:'1'});}
wa('ptagExposure',{ptag:'7039.1.22'});_diffCouponList.push(_item);}else{_cannotUseCouponList.push(_item);}}
this.couponShort=0;if(differAmount<99999999){that.couponShort=differAmount;}
this.couponList.sort(function(a,b){return a.type-b.type||b.discount-a.discount;});_diffCouponList.sort(function(a,b){return a.differAmount-b.differAmount;});_cannotUseCouponList.sort(function(a,b){return a.type-b.type||b.discount-a.discount;});this.cannotUseCouponList=_diffCouponList.concat(_cannotUseCouponList);if(this.couponList.length>0){g.orderObj.rShowNewUserTip(true);}else{g.orderObj.rShowNewUserTip(false);}
PayPassObj.checkShow(g.orderObj);}
function showConponListTag(obj){var html;html=confirmTplV3.child_conponListTabTpl(obj);$('#conponListTab').html(html).show();if(asset.getGByName('maxCoupon')&&obj.couponListCount>0&&obj.couponListCount>1&&obj.isShowOptimalCoupon!='0'){$('#max_coupon_tip').show();}else{$('#max_coupon_tip').hide();}}
_handle.apply(this,[d]);showConponListTag(this);if(g.gocouponPage){goPage('jdQuanPage');g.gocouponPage=false;}},handleShipeffect:function(){var that=this,cart=that.cartData,shipHtml,i,j=cart.length,refundHtml,rItem,useHonorFreight=false,combvid,_dom,unrecycleDesc,_vender,_vid,_partWrapSup=false;g.supJdPromise=false;ship.shipObj.handleShipeffect({action:g.action,usePcPrice:g.usePcPrice,reset:g.reset,isPingou:g.isPingou,useshipData:g.useshipData,callback:function(d){if(d.reChoose=='1'){try{for(i=0;i<cart[0].shipment.length;i++){if(d.selectShipId==cart[0].shipment[i].id){cart[0].shipment[i].selected='1';}else{cart[0].shipment[i].selected='0';}}}catch(e){}}else{that.handleUserasset();}
g.useshipData=0;g.reset=false;if(g.isGlobalPay){pu.umpReport({bizid:1,operation:62,result:d.errId,source:'0',message:d.errMsg});}else{pu.umpReport({bizid:1,operation:82,result:d.errId,source:'0',message:d.errMsg});}},callbackSuc:function(d){g.freightSure=false;g.freightSurePop=false;if(d.json.jd311shipment||d.json.zxjjzdshipment||d.json.djdjzdshipment||d.json.djdbzdshipment){g.supJdPromise=true;}
if(d.json.venderhonorfreightInsure){for(i=0;i<d.json.venderhonorfreightInsure.length;i++){rItem=d.json.venderhonorfreightInsure[i];if(rItem.checkedFlag=="1"){useHonorFreight=true;break;}}}
g.useHonorFreight=useHonorFreight;that.shiphonor=useHonorFreight;if(d.json.jd311shipment&&d.json.jd311shipment.isCombine>0){g.isCombine=true;}else{g.isCombine=false;}
if(d.json.order&&d.json.order.orderprice){that.updatePrice(d.json.order.orderprice);}
if(d.json.freightInsure){for(i=0;i<d.json.freightInsure.length;i++){rItem=d.json.freightInsure[i];_dom=$('.order_info_guarantee[type="refund"][venderId="'+rItem.venderId+'"]');combvid=_dom.attr('combvid');if(rItem.showFlag=='1'&&(window.mConfirm||rItem.venderId=='0')&&!combvid){refundHtml=confirmTplV3.child_guaranteeTpl(rItem);_dom.html(refundHtml).show();if(rItem.checkedFlag=='1'&&rItem.venderId=='0'){g.freightSure=true;}
if(rItem.checkedFlag=='1'&&rItem.venderId!='0'){g.freightSurePop=true;}
if(!g.bgFlag.gurantee&&rItem.venderId=='0'){wa('ptagExposure',{ptag:'7039.16.1'});g.bgFlag.gurantee=true;}
if(!g.bgFlag.guranteePop&&rItem.venderId!='0'){wa('ptagExposure',{ptag:'7039.27.10'});g.bgFlag.guranteePop=true;}}}}
for(i=0;i<j;i++){that.vendersById[cart[i].venderId]=cart[i];shipHtml=ship.shipObj.handleShipContent({'vender':cart[i],'onlineShip':d.onlineShip,'from':'shipeffect','action':g.action,'isPingou':g.isPingou});if(shipHtml){$('.shipping_content[ship_venderid="'+cart[i].venderId+'"]').html(shipHtml);}
if(cart[i].shipClickTag){$('.shipping_content[ship_venderid="'+cart[i].venderId+'"]').parent().attr('shiptype',cart[i].shipClickTag).removeClass('noClick');}else{$('.shipping_content[ship_venderid="'+cart[i].venderId+'"]').parent().addClass('noClick');}}
if(d.json.PackagingServices){g.recyclePackage=d.json.PackagingServices.venderPackagingServices;_dom=$('.order_info_guarantee[type="wrap"]');_vid=_dom.attr('venderid');_vender=g.orderObj.vendersById[_vid];_dom.find('.wrap span').hide();if(d.json.PackagingServices.isSupport=='1'){for(i=0;i<d.json.PackagingServices.venderPackagingServices.length;i++){if(d.json.PackagingServices.venderPackagingServices[i].listUnSupportPackingSKU.length>0){_partWrapSup=true;break;}}
_dom.find('.warn').hide();_dom.find('.order_info_guarantee_content.wrap').show();_dom.show();if(d.json.PackagingServices.isSelect=='1'){if(_partWrapSup){_dom.find('.wrap span').show();}
_dom.find('.order_info_guarantee_price').removeClass('disable').addClass('selected');}else{_dom.find('.order_info_guarantee_price').removeClass('selected disable');}
g.supWrap=true;}else if(g.supWrap){_dom.find('.order_info_guarantee_price').removeClass('selected').addClass('disable').end().show();_dom.find('.order_info_guarantee_content').hide();if(_vender.selectedShip=='shipGsd'){unrecycleDesc='同城速配不支持使用循环包装';}else if(_vender.selectedShip=='ship411'||_vender.selectedlaShip=='ship411'){unrecycleDesc='极速达不支持使用循环包装';}else if(g.useHonorFreight){unrecycleDesc='京尊达不支持使用循环包装';}else{unrecycleDesc='商品信息、收货地址或自提点发生变更，不再支持循环包装';}
_dom.find('.order_info_guarantee_content.warn').html('<i class="warn"></i>'+unrecycleDesc).show();}}
that.weightType=d.json.order.weightType;that.jdVenderWeight=d.json.order.jdVenderWeight;that.jdVenderAddWeight=d.json.order.jdVenderAddWeight||0;that.jdVenderFreshWeight=d.json.order.jdVenderFreshWeight||0;that.jdVenderFreshAddWeight=d.json.order.jdVenderFreshAddWeight||0;that.updateBuyDiscountArea(d.json);}});},handleUserasset:function(){var _cgiUrl=g.isGlobalPay?cgi.globalPay_getcouponlist:cgi.userasset,_data;_data={reg:1,action:g.action,giftcardtype:1};if(asset.getGByName('maxCoupon')){_data.setdefcoupon=0;}else{_data.setdefcoupon=1;}
if(g.usePcPrice=='1'){_data.platprice=1;}
if(g.bizkey=='pingou'&&g.bizval){_data.bizval=g.bizval;_data.sku=this.skuidList;}
pu.wrapData(_data);pu.loadCgi({'cgi':_cgiUrl,'data':_data,'showLoading':false,'reportCallback':function(id,msg,d){if(window.mConfirm&&g.needLoadAssist){g.orderObj.handleAssitInfo();}
g.needLoadAssist=false;if(g.isGlobalPay){pu.umpReport({bizid:1,operation:63,result:id,source:'0',message:msg});}else{pu.umpReport({bizid:1,operation:83,result:id,source:'0',message:msg});}},'success':function(d){g.setDefCoupon=false;g.orderprice=d.order.orderprice;g.orderObj.isShowOptimalCoupon=d.isShowOptimalCoupon||'1';if(d.order&&d.order.orderprice){g.orderObj.updatePrice(d.order.orderprice);}
if(!g.isGlobalPay){g.orderObj.handleRedPacket(d.redpacket);g.orderObj.handleBean(d.jdbean);g.orderObj.handleCard(d.giftcardList);g.orderObj.handleBalance(d.balance);g.orderObj.showCouponlist(d.coupon);}else{g.orderObj.showCouponlist(d);}
g.isassetCgi=true;g.orderObj.updateBuyDiscountArea(d);console.log(d);},'error':function(errId,errMsg,d){}});},handleAssitInfo:function(){function _handleRemark(d){var i,markShow=false;if(!d)return;for(i=0;i<d.length;i++){if(d[i].isShow=='1'){if(d[i].isRequired=='1'){$('.buy_msg_v2[venderid="'+d[i].venderId+'"]').attr('required','1');$('.buy_msg_v2[venderid="'+d[i].venderId+'"] input').attr('placeholder',d[i].remarkInfo.split('|')[0]);$('.buy_msg_v2[venderid="'+d[i].venderId+'"] input').attr('markdesc',d[i].remarkInfo.split('|')[1]);}
$('.buy_msg_v2[venderid="'+d[i].venderId+'"]').show();markShow=true;}}
if(markShow){wa('ptagExposure',{ptag:'7039.1.27'});}}
function _handlevenInfos(d){var i,l,item,isLocDisable;g.orderObj.vidObj={};for(i=0,l=d.venInfos.length;i<l;i++){item=d.venInfos[i];$('.order_shopBar[venderid="'+item.vid+'"] .pop_vname').html(item.shopname);$('.tag_shop_fbp[venderid="'+item.vid+'"]').html(item.shopname);g.orderObj.vidObj[item.vid]=item.shopname;}
if(d.locShops){for(i=0,l=d.locShops.length;i<l;i++){item=d.locShops[i];$('[lsId="'+item.id+'"]').html('门店：'+item.name);if(item.status!='1'){isLocDisable=true;}}
if(isLocDisable){pu.myAlert('到店服务店铺已失效，请返回重新选择到店服务店铺',function(){history.back()});}}}
function _handInvoice(d){if(!window.locker.faPiao){return;}
if(g.isGlobalPay){$('#tabInvoices').addClass('noclick').html('<div class="content">'+'<strong>发票信息</strong><em class="disabled">海囤全球商品暂不支持开发票</em></div>').show();return;}
if(g.orderObj.containLoc&&!g.orderObj.containNomal){$('#tabInvoices').addClass('noclick').html('<div class="content">'+'<strong>发票信息</strong><em class="disabled">本地服务商品不支持在线开票</em><br>'+'<em id="taxidTip" style="display:none">请填写纳税人识别号，以免影响发票报销</em></div>').show();return;}
if(!g.orderObj.contianUnTen){$('#tabInvoices').addClass('noclick').html('<div class="content">'+'<strong>发票信息</strong><em class="disabled">视频会员商品暂不支持开发票</em></div>').show();return;}
if(this.address&&['32','52993','53283'].indexOf(this.address.provId)>-1){$('#tabInvoices').addClass('noclick').html('<div class="content">'+'<strong>发票信息</strong><em class="disabled">京东全球售商品暂不支持开发票</em></div>').show();return;}else{$('#tabInvoices').removeClass('noclick').html('<a href="javascript:void(0);" class="content"><strong>'+'发票信息</strong><span></span><br><em id="taxidTip" style="display:none">请填写纳税人识别号，以免影响发票报销</em></a>');}
var html='',vatCon='',_data={},company='',taxId,vatCompany='',lineCompany='',lineTaxId;g.selInvoiceType=d.selectedType;switch(d.selectedType){case'1':_data.type='1';_data.title=d.selectedTitle;if(d.selectedTitle=='4'){html+='个人&nbsp;';}else if(d.selectedTitle=='5'){if(g.fpObj){company=g.fpObj.company;taxId=g.fpObj.invoiceCode;}else if(this.invoice&&this.invoice.normal){company=this.invoice.normal.companyName;taxId=d.invoiceCode||'';}
html+=company+'&nbsp;';_data.company=company;_data.invoiceCode=taxId;}
if(d.selectContent){html+=d.selectContentName;_data.content=d.selectContent;}
$('#tabInvoices a span').html(html);$('#tabInvoices').show();if(d.selectedTitle=='5'&&!_data.invoiceCode){$('#taxidTip').show();}
g.orderObj.fpObj=_data;break;case'2':vatCon=d.selectContent>0?d.selectContentName:(d.selectBookContent>0?d.selectBookContentName:'');if(g.vatFpObj){vatCompany=g.vatFpObj.company;}else if(this.invoice&&this.invoice.vat){vatCompany=this.invoice.vat.companyName;}
$('#tabInvoices a span').html('增值税发票&nbsp;'+vatCompany+' '+vatCon);$('#tabInvoices').show();break;case'3':_data.type=3;_data.title=d.selectedTitle;if(d.selectedTitle==5){if(g.lineFpObj){lineCompany=g.lineFpObj.company;lineTaxId=g.lineFpObj.invoiceCode;}else if(this.invoice&&this.invoice.electronic){lineCompany=this.invoice.electronic.electrocompanyName;lineTaxId=d.invoiceCode;}
html+='&nbsp;'+lineCompany+'&nbsp;';_data.company=lineCompany;_data.invoiceCode=lineTaxId;}else{html+='个人&nbsp;';}
if(d.selectContent){html+=d.selectContentName;_data.content=d.selectContent;}
$('#tabInvoices a span').html('电子发票&nbsp;'+html);$('#tabInvoices').show();if(d.selectedTitle=='5'&&!_data.invoiceCode){$('#taxidTip').show();}
if(g.orderObj.lineFpObj){_data.phone=g.orderObj.lineFpObj.phone;_data.email=g.orderObj.lineFpObj.email;}else if(this.invoice&&this.invoice.electronic){_data.phone=this.invoice.electronic.phone;_data.email=this.invoice.electronic.email;}
g.orderObj.lineFpObj=_data;break;default:$('#tabInvoices a span').html('不开发票');$('#tabInvoices').show();}}
var data={},invoiceName=['','normal','vat','electronic'],_selInvoice,that=this,assitcgiUrl,_fpObj;data={'reg':1,'action':g.action};if(g.fpObj||g.vatFpObj||g.lineFpObj){if(g.selInvoiceType=='1'&&g.fpObj){_fpObj=g.fpObj;}else if(g.selInvoiceType=='2'&&g.vatFpObj){_fpObj=g.vatFpObj;}else if(g.selInvoiceType=='3'&&g.lineFpObj){_fpObj=g.lineFpObj;}
if(_fpObj){data.selectedType=_fpObj.type;data.hasBookSku='0';data.hasCommonSku='1';data.selectedTitle=_fpObj.title||'';data.selectContent=_fpObj.content||'';data.selectBookContent=_fpObj.bookcontent||'';data.company=_fpObj.company||'';}}else if(this.invoice){data.selectedType=this.invoice.selectedType;data.hasBookSku='0';data.hasCommonSku='1';if(this.invoice[invoiceName[data.selectedType]]){_selInvoice=this.invoice[invoiceName[data.selectedType]];data.selectedTitle=_selInvoice.selectedTitle||'';data.selectContent=_selInvoice.selectContent;data.selectBookContent=_selInvoice.selectBookContent;data.company=_selInvoice.companyName||'';if(data.selectedType=='3'){data.company=_selInvoice.electrocompanyName||'';}}}
assitcgiUrl=cgi.assitInfo;if(g.isGlobalPay){assitcgiUrl=cgi.globalPay_assitInfo;}
data.vid=g.vid.join(',');data.scene=1;data.lsids=g.lsid.join(',');data.vidcid=this.v_cid.join('|');if(g.isPingou){data.pingou='1';}
pu.wrapData(data);pu.loadCgi({'cgi':assitcgiUrl,'data':data,'showLoading':false,'nochecklogin':true,'reportCallback':function(id,msg,d){pu.umpReport({bizid:1,operation:84,result:id,source:'0',message:msg});},'success':function(d){_handleRemark.apply(that,[d.VendorRemarkInfos]);_handlevenInfos.apply(that,[d]);_handInvoice.apply(that,[d.invoice]);},'error':function(errId,errMsg,d){}});},handleAddress:function(){var defData=addressCom.getDefAddrFromCookie(),_adid,addrssItem,data;window.cbLoadJdDefAddr=function(json){clearTimeout(addrCgiErrTimer);pu.umpReport({bizid:1,operation:1,result:json.errCode,source:'0',message:pu.obj2str2(json)});if(json.token){window.param.token=json.token;}
if(json.errCode=='0'&&json.list&&json.list.length>0&&addressObj.label!=json.list[0].label){$('#addrLabel').html(json.list[0].label);if(!json.list[0].label){$('#addrLabel').hide();}}
if(json.errCode=='0'&&json.list&&json.list.length>0&&json.list[0].need_upgrade=='1'){window.addressObj.need_upgrade='1';g.orderObj.handleShipment();}else if(json.errCode=='13'){}else if(json.errCode=='0'&&json.list&&json.list.length>0&&json.list[0]&&g.userAddrV3){window.param.hasDefAddr=true;addrssItem=json.list[0];g.orderObj.address={'aid':addrssItem.adid,'detail':addrssItem.addrdetail,'full':addrssItem.addrfull,'name':addrssItem.name,'mobile':addrssItem.mobile,'idCard':addrssItem.idCard,'provId':addrssItem.provinceId,'cityId':addrssItem.cityId,'countyId':addrssItem.countyId,'townId':addrssItem.townId,'default':addrssItem.default_address,'upgrade':addrssItem.need_upgrade,'label':addrssItem.label||'','jdaddrid':json.jdaddrid,'jdaddrname':json.jdaddrname,'longitude':addrssItem.longitude*1000000,'latitude':addrssItem.latitude*1000000}
g.orderObj.handleDefAddr();}else if(g.userAddrV3){g.nullAddr=true;if(!window.addrNullV2){wa('ptagExposure',{ptag:'7039.22.1'});}else{wa('ptagExposure',{ptag:'7039.22.3'});}
if(g.sceneval=='1'){wa('ptagExposure',{ptag:'7493.2.8'});}
addressObj.showNullAddr();}
addressObj.handleTipAddr({addrTipCb:function(){loadDeal('7',0)},samsTipCb:g.orderObj.handleSamsGoods});};_adid=defData[0]||'0';data={callback:'cbLoadJdDefAddr',adid:_adid,reg:'1',type:'1'};pu.wrapData(data);if(window.__g.isGlobalPay){data.isglobal='1';}
addrCgiErrTimer=window.setTimeout(function(){pu.umpReport({bizid:1,operation:46,result:'0',source:'0',message:'ok'});},2.5e3);loadJs.loadScript({url:cgi.defaultAddrV3,data:data});},checkAddr:function(){if(!addressObj||!addressObj.adid||!addressObj.addrdetail||!addressObj.canCreateDeal){g.loading.hide();pu.oneLineTip({msg:'请完善收货地址'});return false;}
if(g.addressErr){g.loading.hide();pu.oneLineTip({msg:'请完善地址信息'});return false;}
if(window.__g.isGlobalPay&&window.locker.globalPayIdCard){if(window.addressObj&&!window.addressObj.idCard){g.loading.hide();pu.oneLineTip({msg:'请完善身份信息'});$('#idcardEditArea').addClass('warn');return false;}}
return true;},handlelimitedBuy:function(d){assist.showLimitedBuy({products:g.orderObj.products,gifts:g.orderObj.gifts['2'],mzGifts:g.orderObj.gifts['3'],supModifyNum:g.supModifyNum,json:d});},handleNoStock:function(d,paytype,paychannel,scene){var noStockObj=new assist.NoStock({action:g.action,commlist:g.commlist,zengGift:this.gifts['2'],fzengGift:this.gifts['3'],homeserviceArr:this.homeserviceArr,productsList:this.products,samsVipGoods:this.samsVipGoods,json:d,callback:function(obj){if(obj&&obj.commlist){g.commlist=obj.commlist;}
loadDeal('7',0);}});noStockObj.showNoStock();},createOrder:function(paytype,paychannel,scene,flag){var remarkItem,remarkArr=[],msgDiv,msgVal,xssReg=/[<>]/g,msgTip,msgRequired,_vid,mvid;g.venderRemark='';if(g.isGlobalPay&&this.limitBuy=='1'){g.loading.hide();pu.myConfirm({'msg':'由于政策原因，订单包含同个保税区商品总价大于2000元，将导致清关失败，无法发货，建议分开下单','icon':'none','okText':'取消','cancelText':'返回购物车修改','changeBtn':true,'onCancel':function(){jump(cgi.jdshopcart);}});return;}
if(g.orderIng){g.loading.hide();pu.oneLineTip({msg:'点太快，休息下啦~'});return;}
if(this.address&&['32','52993','53283'].indexOf(this.address.provId)>-1&&!$('#overseaDiv').hasClass('selected')){g.loading.hide();pu.myConfirm({msg:'购买全球售卖商品需同意<a href="'+cgi.overseaProtocal+'" class="color_red">《京东全球售服务协议》</a>的相关条款，确认继续下单？',icon:'info',okText:'取消',cancelText:'同意并下单',onCancel:function(){$('#overseaDiv').addClass('selected');g.orderObj.createOrder(paytype,paychannel,scene,flag);}});return;}
if(g.isGlobalPay&&!$('#globalPayDiv').hasClass('selected')){g.loading.hide();pu.myConfirm({msg:'购买海囤全球商品需同意<a href="'+cgi.globalPayProtocal+'" class="color_red">《用户购买须知》</a>的相关条款，确认继续下单？',icon:'info',okText:'取消',cancelText:'同意并下单',onCancel:function(){$('#globalPayDiv').addClass('selected');g.orderObj.createOrder(paytype,paychannel,scene,flag);}});return;}
if(g.isGlobalPay&&g.globalFirstBuyFlag=='0'&&((paychannel=='2'&&scene=='9')||(paychannel=='4'&&scene=='10'))){showGlobalFirstBuyToast(function(){g.orderObj.createOrder(paytype,paychannel,scene,flag);});return;}
if(this.address&&['53283'].indexOf(this.address.provId)>-1&&g.isGlobalPay){g.loading.hide();pu.myAlertV2({msg:'海囤全球商品暂不支持当前地址下单~'});return;}
if(ship.getGByName('needSetShip')&&!ship.getGByName('modifyShip')){g.loading.hide();wa('jdClick',{ptag:'7039.11.10'});if($('#freshJzd').length>0&&$('#freshJzd').css('display')!='none'){$('#freshJzd').click();return;}else if($('[type="deliveryTimePopGsd"]').length>0){var devList=$('[type="deliveryTimePopGsd"]')
for(var i=0,len=devList.length;i<len;i++){if(devList[i]&&$(devList[i]).css('display')!='none'){$(devList[i]).click();return;}}}}
if(window.locker.remark){try{remarkItem=$('.buy_msg_v2');remarkItem.forEach(function(item){msgDiv=$(item);_vid=msgDiv.attr('venderId');msgRequired=msgDiv.attr('required');msgVal=msgDiv.find('input').val().trim().replace(xssReg,'');if(msgVal){remarkArr.push(_vid+'|'+encodeURIComponent(msgVal));}
if(msgRequired=='1'&&!msgVal){msgTip=msgDiv.find('input').attr('markdesc');mvid=_vid;}});if(remarkArr.length>0){g.venderRemark=remarkArr.join(',');}
if(msgTip){g.loading.hide();pu.myAlertV2({msg:msgTip,onConfirm:function(){$('.buy_msg_v2[venderId="'+mvid+'"] input').focus();}});return;}}catch(e){}}
if(window.mConfirm&&g.buyNow){if(g.isFreeRegister){pu.pingClick(true,'MNeworder_CSubmit','B','FromNoReg');}else{pu.pingClick(true,'MNeworder_CSubmit','A','');}
if(paytype=='0'){pu.pingClick(true,'MNeworder_COnlinePay','','');}else if(paytype=='1'){pu.pingClick(true,'MNeworderAddress_CCashOnDeliveryAble','','');}else{pu.pingClick(true,'MNeworder_COnlinePay','','');}}else if(window.mConfirm){if(paytype=='0'){pu.pingClick(true,'MNeworder_CartPayOnline','','');pu.pingClick(true,'MNeworder_Submit','A_1','');}else if(paytype=='1'){pu.pingClick(true,'MNeworder_CartCashOnDelivery','','');pu.pingClick(true,'MNeworder_Submit','A_2','');}else{pu.pingClick(true,'MNeworder_CartPayOnline','','');pu.pingClick(true,'MNeworder_Submit','A_1','');}}
g.orderIng=true;window.setTimeout(function(){g.orderIng=false;},2000);if(paychannel=='2'&&pu.isWxUserAgent()&&g.miData){if(g.miData.payOptions=='2'&&this.totalPrice<=g.miData.supportAmt){$('#wxloading span').html('免密支付中...');}else if(!g.miState&&g.miData.payOptions=='3'&&this.totalPrice<=g.miData.rule.perOrderMaxAmt){this.showMianmiLayer(paytype,paychannel,scene,flag);return;}}
wa('jdClick',{ptag:'7039.30.3'});if(window.locker.repeatDealV3&&!window.locker.ContractMachineConfirm&&!this.containLoc&&!g.venderRemark){pu.repeatDealV3({action:g.action,paytype:paytype,platprice:g.usePcPrice=='1'?'1':'0'},geRepeatInfo);function geRepeatInfo(d){var isReatDeal=false,isShowTip=false,reDealId,appid,assetDuplicate,zcMsg,secPtag;if(d.errId=='0'&&d.isDuplicate=='1'){isReatDeal=true;if(d.orderList[0]){reDealId=d.orderList[0].orderId;appid=d.orderList[0].appId;assetDuplicate=d.orderList[0].assetDuplicate;}
if(assetDuplicate==0){isShowTip=false;}else if(assetDuplicate==-1){isReatDeal=false;}else{isShowTip=true;}
if(isReatDeal){if(pu.isWxUserAgent()&&paychannel=='2'){secPtag='7039.1.107';}else if(paychannel=='4'){secPtag='7039.2.104';}else if(paychannel=='3'){secPtag='7039.1.108';}else if(paychannel=='5'){secPtag='7039.1.109';}
wa('jdClick',{ptag:secPtag,dealId:reDealId});}
if(isReatDeal&&isShowTip){wa('ptagExposure',{ptag:'7039.1.40'});pu.myConfirm({msg:'您有一笔待支付订单和此订单商品相同，是否确定提交此订单？',icon:'info',closeIcon:true,okText:'支付原订单',cancelText:'提交此订单',changeBtn:true,noCancel:false,extclass:'',onConfirm:function(){wa('jdClick',{ptag:'7039.1.41'});window.setTimeout(function(){jump(cgi.dealDetail+'?deal_id='+reDealId+(window.mConfirm?'&sceneval=2':'')+'#wechat_redirect');},400);},onCancel:function(){wa('jdClick',{ptag:'7039.1.42'});g.orderObj.createCurrOrder(paytype,paychannel,scene,flag);},onClose:function(){wa('jdClick',{ptag:'7039.1.43'});}});}else if(isReatDeal){g.orderObj.payType=paytype;g.orderObj.payChannel=paychannel;g.orderObj.scene=scene;g.dealId=reDealId;if(paytype=='2'){zcMsg='您已经发起过该商品的筹款，筹款正在进行中，暂不能重复发起~快去喊朋友们支持吧~';if(g.isliangban){zcMsg='您已经发起该商品的团购活动，活动正在进行中，暂不能重复发起，快去拉朋友一起参加吧';}
pu.myAlert('您已经发起过该商品的筹款，筹款正在进行中，暂不能重复发起~快去喊朋友们支持吧~',function(){jump('//wq.jd.com/bases/zcdetail/entry?dealid='+reDealId+'&ownerwid='+g.uin+'&zhongchou='+g.isZhongChou);return;},'知道了')}
if(paytype=='3'){g.orderObj.daiPay({dealId:reDealId});return;}
g.orderObj.pay({appid:appid,dealId:reDealId});}else{g.orderObj.createCurrOrder(paytype,paychannel,scene,flag);}}else{g.orderObj.createCurrOrder(paytype,paychannel,scene,flag);}}}else{g.orderObj.createCurrOrder(paytype,paychannel,scene,flag);}},createCurrOrder:function(paytype,paychannel,scene,flag){if(!g.orderObj.checkAddr()){return;}
var data,that=this,cgiUrl,pwd='',orderPtag='',shipParam=ship.shipObj.getShipData();function savePtagToCookie(rd){var pprd=JD.cookie.get('PPRD_P'),index;if(pprd){pprd=pprd.split('-');}else{pprd=[];}
pprd.forEach(function(item,i){if(item.indexOf('CT.')==0){index=i;}});if(index){pprd[index]='CT.'+rd;}else{pprd.push('CT.'+rd);}
pprd=pprd.join('-');JD.cookie.set('PPRD_P',pprd,3*24*60,'/','jd.com');}
this.payType=paytype;this.payChannel=paychannel;this.scene=scene;window.cbConfirm=function(d){var appName='',payPtag='',_ship,html,_skuArr=[],i,_zcUrl,_sucUrl,_bizid=1,_operid,_result,_msg;_result=(d.resultCode&&d.resultCode!='0')?d.resultCode:d.errId;_msg='paytype:'+g.orderObj.payType+'-paychannel:'+g.orderObj.payChannel+'-'+d.errMsg;try{if(window.branch_appconfirm){_bizid=145;_operid=33;}else if(window.mConfirm){_bizid=488;_operid=2;}else if(g.isGlobalPay){_operid=64;}else{_operid=3;}
pu.umpReport({bizid:_bizid,operation:_operid,result:_result,source:'0',message:_msg});wxConfirmTimer&&clearTimeout(wxConfirmTimer);confirmTimer3&&clearTimeout(confirmTimer3);confirmTimer5&&clearTimeout(confirmTimer5);}catch(e){}
if(d.errId=='0'){g.dealId=d.dealId;wa('jdClick',{ptag:'7039.30.2'});if(d.dealId=='0'||!d.dealId){pu.umpReport({bizid:1,operation:3,result:555,source:'1',message:'deaid Err'+d.dealId});pu.myAlertV2({msg:'抱歉，支付遇到问题，请到订单页完成支付~',onConfirm:function(){location.replace(cgi.orderlist+'?tab=2'+(window.mConfirm?'&sceneval=2':''));}});return;}
if(ship.getGByName('needSetShip')){wa('jdClick',{ptag:'7039.11.11'});}
if(ship.getGByName('selectCombine')){wa('jdClick',{ptag:'7039.11.21'});}
try{if(window.branch_appconfirm){var skuIds=g.skulist.split(',');var mping=new MPing();for(i=0;i<skuIds.length;i++){var ord=new MPing.inputs.Order(skuIds[i]);ord.sale_ord_id=d.dealId;ord.order_total_fee=g.orderObj.totalPrice;mping.send(ord);}}else if(window.mConfirm){skuArr=that.skuidList.split(',');pu.pingOrderClick(g.dealId,that.totalPrice/100,skuArr,'online');pu.pingClick(true,"MNeworder_SubmitProductSku",skuArr,'');}}catch(ignore){}
if(g.orderObj.isChgArea=='1'){wa('jdClick',{ptag:'7039.14.3'});}
if(ship.getGByName('supShipInstall')=='1'){_ship=ship.getGByName('setPayShipData')&&ship.getGByName('setPayShipData')['0']?ship.getGByName('setPayShipData')['0'].ship:'';_ship=_ship.split('|');if(_ship[3]&&_ship[3]==_ship[4]){wa('jdClick',{ptag:'7039.11.14'});}else{wa('jdClick',{ptag:'7039.11.13'});}}
if(g.orderObj.kaplerSource!='0'){wa('jdClick',{ptag:'7039.27.33',dealId:g.dealId});}
try{doReport();pu.reportTX(g.orderObj.products);if(g.qqSupWxPay){JD.store.setItem('qqwxpayDealid'+d.dealId,d.dealId,60*24);}}catch(ignore){}
if(paytype=='2'){wa('jdClick',{ptag:'7039.1.18',dealId:g.dealId});if(g.isliangban){wa('jdClick',{ptag:'7145.12.4',dealId:g.dealId});}
_zcUrl='//wq.jd.com/bases/zcdetail/entry?dealid='+g.dealId+'&ownerwid='+g.uin+'&zhongchou='+g.isZhongChou;if(!g.buyNow){location.replace(_zcUrl);}else{jump(_zcUrl);}
return;}
if(paytype=='3'){wa('jdClick',{ptag:'7039.1.33',dealId:g.dealId});g.orderObj.daiPay(d);return;}
if(paytype=='5'){_sucUrl=cgi.paysuc+'?dealId='+g.dealId+'&offline=1'+g.orderObj.getsucPagJsonStr();wa('jdClick',{ptag:'7039.1.102',dealId:g.dealId});if(!g.buyNow){location.replace(_sucUrl);}else{jump(_sucUrl);}}
if(g.orderObj.totalPrice/100==0){if(cgi.paysuc.indexOf('?')>0){_sucUrl=cgi.paysuc+'&dealId='+g.dealId+'&'+g.orderObj.getsucPagJsonStr();}else{_sucUrl=cgi.paysuc+'?dealId='+g.dealId+'&'+g.orderObj.getsucPagJsonStr();}
if(isSkapp||isQuickApp){_sucUrl=cgi.orderlist+'?tab=3&sid='+g.sid+'&sceneval=2';}
if(!g.buyNow){location.replace(_sucUrl);}else{jump(_sucUrl);}}
if(g.orderObj){pu.setCookieForWanggou({buynum:g.orderObj.products.length});if(g.orderObj.payType=='0'&&g.orderObj.payChannel=='1'){wa('jdClick',{ptag:'7039.1.70',dealId:g.dealId});}else if(g.orderObj.payType=='0'&&g.orderObj.payChannel==2){if(pu.isWxUserAgent()){payPtag='7039.1.1';}else{payPtag='7039.2.100';}}else if(g.orderObj.payType=='0'&&g.orderObj.payChannel==3){payPtag='7039.1.2';}else if(g.orderObj.payType=='0'&&g.orderObj.payChannel==4){payPtag='7039.2.1';if(g.isGlobalPay){payPtag='7039.2.107';}}else if(g.orderObj.payType=='0'&&g.orderObj.payChannel==5){payPtag='7039.1.4';}else if(g.orderObj.payType=='0'&&g.orderObj.payChannel==6){payPtag='7039.27.37';}else if(g.orderObj.payType=='1'){payPtag='7039.1.3';if(g.orderObj.kaplerSource!='0'){payPtag='7039.27.38';}}
if(payPtag){wa('jdClick',{ptag:payPtag,dealId:g.dealId});window.wa&&window.wa('tencent.send','click',{ptag:payPtag});}}
if(PayPassObj.need){wa('jdClick',{ptag:'7039.1.44'});}
if(g.orderObj.overLimitFee&&g.orderObj.overLimitFee/100>0){wa('jdClick',{ptag:'7039.1.49'});}
if(g.selInvoiceType){switch(g.selInvoiceType){case'1':wa('jdClick',{ptag:'7039.1.53'});break;case'2':wa('jdClick',{ptag:'7039.1.54'});break;case'3':wa('jdClick',{ptag:'7039.1.52'});}}
try{if(g.sceneval=='1'){wa('ptagExposure',{ptag:'7493.2.3'});g.nullAddr&&wa('ptagExposure',{ptag:'7493.2.9'});}
if(g.nullAddr){if(!window.addrNullV2){wa('ptagExposure',{ptag:'7039.22.2'});}else{wa('ptagExposure',{ptag:'7039.22.4'});}}
if(g.orderObj.usedJBeanPromo){wa('jdClick',{ptag:'7014.24.5'});}
if(g.freightSure){wa('jdClick',{ptag:'7039.16.2'});}
if(g.freightSurePop){wa('jdClick',{ptag:'7039.27.11'});}
if(g.containVirtualSuit){wa('jdClick',{ptag:'7039.19.2'});}
if(g.bgFlag.svczySub||g.bgFlag.svcpopSub){wa('jdClick',{ptag:'7039.23.2'});}
if(g.bgFlag.svczySub){wa('jdClick',{ptag:'7039.23.6'});}
if(g.bgFlag.svcpopSub){wa('jdClick',{ptag:'7039.23.4'});}}catch(e){}
g.orderObj.dealData[paychannel]=d;if(window.locker.SupBuyOne){cookies.del('buysku');}
g.orderObj.pay(d);}else if(d.errId=='13'){checklogin(d.nextUrl);}else if(d.errId=='9001'){assist.closePhoneValidateToast(function(){g.uuid='';g.validateCode='';});handleGlobalAgree();$('#wxloading span').html('请求加载中...');g.loading.hide();}else{$('#wxloading span').html('请求加载中...');g.loading.hide();if(d.errId!='9085'&&d.errId!='9086'){assist.closePhoneValidateToast(function(){g.uuid='';g.validateCode='';});}
if(d.errId=='8802'&&d.cancelscaleskus&&d.cancelscaleskus.length>0){html=confirmTplV3.child_noStockTpl({noStockGroups:[{type:'normal',arr:d.cancelscaleskus}],type:'sale'});$('#wrapBody').append($(html));$('.mod_alert_mask').show();for(i=0;i<d.cancelscaleskus.length;i++){_skuArr.push(d.cancelscaleskus[i].skuId);}
pu.myBind({'src':'#noStockTplModel [tag="confirm"]','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();g.loadVendinfo=true;loadDeal('7',paytype,_skuArr.join(','));}});pu.myBind({'src':'#noStockTplModel [tag="cancel"]','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();g.loadVendinfo=true;loadDeal('7','0',_skuArr.join(','));}});pu.myBind({'src':'#noStockTplModel .close','fun':function(e,$this){$('#noStockTplModel').remove();$('.mod_alert_mask').hide();}});return;}else if(d.errId=='9073'){var onepinDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='one_yuan_pin_desc'){onepinDesc=d[i];break;}}
onepinDesc=onepinDesc?onepinDesc:{descTitle:d.errMsg};pu.myAlertV2({msg:onepinDesc.extinfo,confirmText:onepinDesc.descTitle,onConfirm:function(){location.href=cgi.pinUrl;}});});return;}else if(d.errId=='9082'){pu.myAlertV2({msg:d.errMsg,onConfirm:function(){loadDeal('7','0');}});return;}
if(g.setCodDateParam&&d.errId!='9085'&&d.errId!='9086'){g.setCodDateParam.paytype=0;pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':g.setCodDateParam,'success':function(d){g.setCodDateParam=false;}});}
if(d.errMsg.indexOf('手机号码与地区不匹配')>=0){d.errMsg='抱歉，手机号码合约归属地与配送地区不匹配';}
if(d.errId=='8724'){$('#codFloat').hide();pu.myAlert(d.errMsg,function(){history.back();},'确定','info');}else if(d.errId=='9034'){window.param.idCardErrMsg=d.errMsg;pu.myAlertV2({msg:d.errMsg||'您输入的身份证号码与姓名不匹配',confirmText:'返回修改'});$('#editIdcard').parent().hide();$('#idcardInfo').val(that.address.idCard||'');$('#idcardEditArea').addClass('warn').show();$('#idCardErrTip').html(d.errMsg).addClass('color_red');$('#topFixedDiv').css('height',$('#addressDefault').height());}else if(d.errId=='9046'){$('#codFloat').hide();if(d.rmInvalidSku.length>0){g.orderObj.handleNoStock(d,paytype,paychannel,scene);}else{pu.myAlertV2({msg:d.errMsg});}}else if(d.errId=='9216'||d.errId=='9047'){$('#codFloat').hide();if(that.samsVipGoods.length>0){g.orderObj.handleNoStock(d,paytype,paychannel,scene);}else{pu.myAlertV2({msg:d.errMsg});}}else if(d.errId=='8814'){g.orderObj.handlelimitedBuy(d);}else if(d.errId=='9053'){pu.myConfirm({'msg':'为保证您的账号安全，请先完成账号绑定再下单哦','icon':'info','okText':'取消','cancelText':'确定','onCancel':function(){location.href=userCenterLink;}});}else if(d.errId=='9085'||d.errId=='9086'){assist.showPhoneValidateToast(d,function(validateCode){g.uuid=d.uuid;g.validateCode=validateCode;g.orderObj.createCurrOrder(paytype,paychannel,scene,flag);},function(){g.uuid='';g.validateCode='';if(g.setCodDateParam){g.setCodDateParam.paytype=0;pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':g.setCodDateParam,'success':function(d){g.setCodDateParam=false;}});}
g.loading.hide();})}else if(d.errId=='9075'){pu.myAlertV2({msg:d.errMsg.replace(/系统繁忙.*/,'商家货品调整中~')})}else{$('#codFloat').hide();if(d.outOfStock.length>0||(d.commonstocksku&&d.commonstocksku.length>0)){g.orderObj.handleNoStock(d,paytype,paychannel,scene);}else if(window.locker.sqCodAcount&&d.errId>=1513&&d.errId<=1517&&paytype=='1'&&pu.isMQQUserAgent()){pu.myConfirm({'msg':'使用货到付款要求您的账号信息完整，请您先补充手机号等信息。','icon':'info','okText':'取消','cancelText':'确定','onCancel':function(){location.href=userCenterLink;}});}else if(d.errId=='9009'){if(pu.isWxUserAgent()){appName='微信';}else if(pu.isMQQUserAgent()){appName='QQ';}
pu.myConfirm({'msg':'抱歉，使用'+appName+'登录的账号无法使用京东券和京豆，请到京东账号管理页完善手机号或切换账号。','icon':'info','okText':'取消','cancelText':'确定','onCancel':function(){location.href=cgi.accountv2;}})}else{pu.myAlert(d.errMsg.replace('全球购','海囤全球'),function(){if(d.errId=='8999'){PayPassObj.need=true;PayPassObj.on=true;PayPassObj.dom().show();PayPassObj.inputDiv().show();PayPassObj.bindEvent();$('#shortPass input').val('');$('#longPass input').val('');$('#copyInput').html('');PayPassObj.focus();wa('jdClick',{ptag:'7039.1.5'});}else if(/^(6147|6152|9007)$/.test(d.errId)){loadDeal('7','0');}});}}}};data={paytype:paytype,paychannel:paychannel,action:g.action,reg:1,type:g.type||'0',token2:g.token2,dpid:g.dpid,skulist:g.skulist,scan_orig:g.scan_orig,gpolicy:'',platprice:g.usePcPrice=='1'?'1':'0',ship:shipParam[0]||'',pick:shipParam[1]||'',savepayship:'0',callback:'cbConfirm',uuid:g.uuid||'',validatecode:g.validateCode||'',valuableskus:g.orderObj.valuableskus.join('|')};if(data&&data.ship&&/8\|71\|(0|1)\|/.test(data.ship)){wa('jdClick',{ptag:'7039.11.24'});}
if(window.locker.SupBuyOne&&g.commlist){data.commlist=g.commlist;}
if(window.locker.pingou&&(g.bizval||g.bizkey||g.activeid)){data.bizval=g.bizval;data.bizkey=g.bizkey;data.activeid=g.activeid;}
if(g.unpl){data.unpl=g.unpl;}
if(g.bizcode){data.bizcode=g.bizcode;}
if(g.jzycwt){data.jzycwt=g.jzycwt;}
if(PayPassObj.need){pwd=PayPassObj.getmd5();wa('ptagExposure',{ptag:'7039.1.110'});if(pwd){data.pwd=pwd;}else{wa('jdClick',{ptag:'7039.34.1'});g.loading.hide();$('#wxloading span').html('请求加载中...');return false;}}
if(window.locker.remark){if(g.venderRemark){data.venderremark=g.venderRemark;wa('jdClick',{ptag:'7039.1.28'});}}
pu.wrapData(data);if(g.rtk){data.rtk=g.rtk;}
if(this.dealData[paychannel]){window.cbConfirm(this.dealData[paychannel]);}else{if(g.skufrom=='ol'){orderPtag='7129.1.7';}else if(g.skufrom=='od1'){orderPtag='7130.1.16';}else if(g.skufrom=='od2'){orderPtag='7130.1.17';}
if(orderPtag){savePtagToCookie(orderPtag);}
g.loading.show();try{if(g.orderObj.payChannel==2){wxConfirmTimer=window.setTimeout(function(){g.wx3Out=true;pu.umpReport({bizid:1,operation:99,result:'1',source:'0',message:'wxpay3timeOut'});},3e3);}
confirmTimer3=window.setTimeout(function(){pu.umpReport({bizid:1,operation:97,result:'1',source:'0',message:'confirm3timeOut'});},3e3);confirmTimer5=window.setTimeout(function(){pu.umpReport({bizid:1,operation:98,result:'1',source:'0',message:'confirm5timeOut'});},5e3);}catch(ignore){}
cgiUrl=cgi.confirm;if(g.isGlobalPay){cgiUrl=cgi.globalPay_confirm;}
if(data.venderremark&&data.venderremark.length>4000){pu.umpReport({bizid:1,operation:87,result:2,source:'0',message:'vender mark 4000'});delete data.callback;ajax.load({url:cgiUrl,timeout:5,data:data,type:'POST',crossDomain:true,dataType:'json',success:function(d){window.cbConfirm(d);},error:function(d){pu.myAlertV2({msg:'提交订单失败，请稍后再试'});}});}else{loadJs.loadScript({url:cgiUrl,data:data});}}},pay:function(d){var _sucUrl;if(window.branch_appconfirm){this.appPay(d);}else if(this.payType=='0'&&this.totalPrice>0){if(this.payChannel=='2'){if(!pu.isWxUserAgent()){this.wxH5Pay(d);}else if(g.miData&&g.miData.payOptions=='2'&&this.totalPrice<=g.miData.supportAmt){this.wxMianmiPay(d);}else if(g.miData&&g.miData.payOptions=='3'&&this.totalPrice<=g.miData.rule.perOrderMaxAmt&&g.miState=='2'){this.wxPay(d,true);}else{this.wxPay(d);}}else if(window.mConfirm&&this.payChannel=='1'){this.payOnLine(d);}else if(this.payChannel=='4'||this.payChannel=='1'){this.cftPay(d);}else if(this.payChannel=='3'){this.unionPay(d);}else if(this.payChannel=='5'){this.baitiaoPay(d);}else if(this.payChannel=='6'){this.payOnLine(d);}}else if(this.payType=='1'){if(cgi.paysuc.indexOf('?')>0){_sucUrl=cgi.paysuc+'&dealId='+d.dealId+'&cod=1'+g.orderObj.getsucPagJsonStr();}else{_sucUrl=cgi.paysuc+'?dealId='+d.dealId+'&cod=1'+g.orderObj.getsucPagJsonStr();}
if(isSkapp||isQuickApp){_sucUrl=cgi.orderlist+'?tab=3&sid='+g.sid;}
if(window.mConfirm){_sucUrl+='&sceneval=2';}
if(!g.buyNow){location.replace(_sucUrl);}else{jump(_sucUrl);}}else if(this.totalPrice<=0){if(cgi.paysuc.indexOf('?')>0){_sucUrl=cgi.paysuc+'&dealId='+d.dealId+'&'+g.orderObj.getsucPagJsonStr();}else{_sucUrl=cgi.paysuc+'?dealId='+d.dealId+'&'+g.orderObj.getsucPagJsonStr();}
if(!g.buyNow){location.replace(_sucUrl);}else{jump(_sucUrl);}}
JD.store.setItem('payTypeChanel',Number(this.payType)+Number(this.payChannel),60*24*360);},wxPay:function(d,mianmi){var backUrl='',opt,wgData,_dUrl=cgi.dealDetail+'?deal_id='+d.dealId+(window.mConfirm?'&sceneval=2':'');g.loading.show();try{g.orderObj.timeout3sWxPaycgi.start();}catch(ignore){}
if(cgi.paysuc.indexOf('?')>-1){backUrl=cgi.paysuc+'&dealId='+g.dealId+'&'+g.orderObj.getsucPagJsonStr();}else{backUrl=cgi.paysuc+'?dealId='+g.dealId+'&'+g.orderObj.getsucPagJsonStr()}
function reportErrmsg(t){var reerrmsg={},_message,result1;g.loading.hide();try{if(t.err_msg==='get_brand_wcpay_request:ok'){result1=0;}else if(t.err_msg==='get_brand_wcpay_request:cancel'){result1=1;}else if(t.err_msg==='get_brand_wcpay_request:fail'){result1=2;}else if(t.err_msg==='system:function_not_exist'){result1=3;}else if(t.err_msg==='system:access_denied'||t.err_msg==='access_control:not_allow'){result1=4;}else{result1=5;}
reerrmsg.wxErrmsg=t;reerrmsg.login=g.login;reerrmsg.referrer=g.referrer.substr(0,50);reerrmsg.repeatdeal=g._log_jddeal||'';reerrmsg.cgidata=wgData;if(result1===0){_message='ok';}else if(result1==1){_message='cancel';}else{_message=pu.obj2str2(reerrmsg);}
pu.umpReport({bizid:1,operation:5,result:result1,source:'0',message:_message,notCombo:true});if(result1!=0&&result1!=1){pu.dealReport({dealId:g.dealId,excpCode:result1,excpMsg:t.err_msg});}}catch(ignore){}}
opt={dealId:d.dealId,appid:d.appid,isM:window.mConfirm,backUrl:backUrl,loadingId:'wxloading',replaceHistory:!g.buyNow,wgCallback:function(t){try{g.orderObj.timeout3sWxPaycgi.clear();pu.umpReport({bizid:1,operation:4,result:t.errno,source:'0',message:g.dealId+'-'+t.msg});if(g.wx3Out){pu.umpReport({bizid:1,operation:100,result:'1',source:'0',message:'wxpay3Ok'});}}catch(e){}
wgData=t;if(t.errno!='0'){g.loading.hide();pu.myAlert('抱歉，支付失败，请到订单页面重新支付',function(){jump(cgi.dealDetail+'?deal_id='+d.dealId+(window.mConfirm?'&sceneval=2':''));});}},jsapiCallCancel:function(t){reportErrmsg(t);setTimeout(function(){if(!g.buyNow){location.replace(_dUrl);}else{jump(_dUrl);}},200);},jsapiCallSuc:function(t){reportErrmsg(t);},jsapiCallFail:function(t){reportErrmsg(t);if(t.err_code=='3'){payV2.saomaPay({dealId:d.dealId,appid:d.appid,isM:window.mConfirm,imgid:'buy_qrcode_img',wgCallback:function(t){if(t.errno=='0'){$('#buy_qrcode').show();$('#btnWxPay').hide();wa('ptagExposure',{ptag:'7039.1.16'});$('#buy_qrcode_img').attr('ptag','7039.1.17');}else{pu.myAlertV2({msg:t.msg});}},});}else{$('#btnWxPay a').addClass('disabled').parent().off('click');$('#WxpayNorightTip').show();}
return;},jsapiCallNosup:function(t){reportErrmsg(t);pu.myAlertV2({msg:'抱歉，支付失败，请到订单页面重新支付',onConfirm:function(){if(!g.buyNow){location.replace(_dUrl);}else{jump(_dUrl);}}});},jsapiCallNoright:function(t){reportErrmsg(t);$('#btnWxPay a').addClass('disabled').parent().off('click');$('#WxpayNorightTip').show();},jsapiCallElse:function(t){reportErrmsg(t);pu.myAlertV2({msg:'抱歉，支付失败，请到订单页面重新支付',onConfirm:function(){if(!g.buyNow){location.replace(_dUrl);}else{jump(_dUrl);}}});},callbackNoready:function(){var _excpMsg='Jsapi no ready';_excpMsg+='|'+location.hash;if(g.windowLoaded){_excpMsg+='|window loaded';}
try{pu.umpReport({bizid:1,operation:92,result:'2',source:'0',message:_excpMsg});pu.dealReport({dealId:d.dealId,excpCode:'5',excpMsg:_excpMsg});}catch(e){}
pu.myAlertV2({msg:'抱歉，支付失败，请到订单页面重新支付',onConfirm:function(){if(!g.buyNow){location.replace(_dUrl);}else{jump(_dUrl);}}});}}
if(mianmi){opt.wxpap='1';}
payV2.wxPay(opt);},wxMianmiPay:function(d){var backUrl='';if(cgi.paysuc.indexOf('?')>-1){backUrl=cgi.paysuc+'&dealId='+g.dealId+'&'+g.orderObj.getsucPagJsonStr();}else{backUrl=cgi.paysuc+'?dealId='+g.dealId+'&'+g.orderObj.getsucPagJsonStr()}
payV2.wxMianmiPay({dealId:d.dealId,appid:d.appid,isM:window.mConfirm,wgCallback:function(json){pu.umpReport({bizid:1,operation:59,result:json.errno,source:'0',message:json.msg||''});$('#wxloading').hide().find('span').html('请求加载中...');if(json.errno!='0'){pu.oneLineTip({msg:'免密支付失败，即将切换到密码支付',callback:function(){g.orderObj.wxPay(d);}});}else{if(g.buyNow){location.href=backUrl;}else{location.replace(backUrl);}}}});},wxH5Pay:function(d){var backUrl,opt,_detailUrl=cgi.dealDetail+'?deal_id='+d.dealId+'&jddeal=1'+(window.mConfirm?'&sceneval=2':'');_detailUrl+='&qqwxpay=1';if(isJdapp&&isAndroid){_detailUrl='openApp.jdMobile://virtual?params={"category":"jump","des":"orderlist"}';}else if(isJdapp){_detailUrl='openApp.jdMobile://virtual?params={"category":"jump","des":"orderlist","listType":"1"}';}
backUrl=_detailUrl;if(isJdapp){backUrl='//wqs.jd.com/my/agreement/appJump.shtml';}
try{g.orderObj.timeout3sWxPaycgi.start();}catch(ignore){}
opt={dealId:d.dealId,appid:d.appid,isM:window.mConfirm,backUrl:backUrl,replaceHistory:!g.buyNow,wgCallback:function(t){if(t.errno!='0'){pu.myAlertV2({msg:'抱歉，支付失败，请到订单页面重新支付',onConfirm:function(){if(!g.buyNow){location.replace(_detailUrl);}else{jump(_detailUrl);}}});}}}
payV2.wxH5Pay(opt);},cftPay:function(d){var backUrl,_detail=cgi.dealDetail+'?deal_id='+d.dealId+(window.mConfirm?'&sceneval=2':'');if(cgi.paysuc.indexOf('?')>-1){backUrl=cgi.paysuc+'&dealId='+d.dealId+this.getsucPagJsonStr();}else{backUrl=cgi.paysuc+'?dealId='+g.dealId+this.getsucPagJsonStr()}
try{g.orderObj.timeout3sQQPaycgi.start();}catch(e){}
g.loading.show();payV2.qqPay({dealId:d.dealId,appid:d.appid,isM:window.mConfirm,backUrl:backUrl,replaceHistory:!g.buyNow,wgCallback:function(t){try{pu.umpReport({bizid:1,operation:6,result:t.errno,source:'0',message:d.dealId+'-'+t.msg});g.orderObj.timeout3sQQPaycgi.clear();}catch(e){}
g.loading.hide();if(t.errno=='0'){pu.umpReport({bizid:1,operation:7,result:'0',source:'0',message:'success',notCombo:true});}else if(t.errno=='13'){checklogin(t.rurl);}else{pu.myAlertV2({msg:'抱歉，支付失败，请到订单页面重新支付',onConfirm:function(){if(!g.buyNow){location.replace(_detail);}else{jump(_detail);}}});}},jsapiCallSuc:function(t){pu.umpReport({bizid:1,operation:7,result:'0',source:'0',message:'success',notCombo:true});},jsapiCallFail:function(t){pu.umpReport({bizid:1,operation:7,result:t.resultCode,source:'0',message:g.dealId+'-'+pu.obj2str2(t),notCombo:true});pu.dealReport({dealId:g.dealId,excpCode:t.resultCode,excpMsg:pu.obj2str2(t)});setTimeout(function(){if(!g.buyNow){location.replace(_detail);}else{jump(_detail);}},400);}});},unionPay:function(d){var backUrl;if(cgi.paysuc.indexOf('?')>-1){backUrl=cgi.paysuc+'&dealId='+d.dealId+this.getsucPagJsonStr();}else{backUrl=cgi.paysuc+'?dealId='+d.dealId+this.getsucPagJsonStr();}
try{g.orderObj.timeout3sUnPaycgi.start();}catch(e){}
payV2.unionPay({dealId:d.dealId,appid:d.appid,isM:window.mConfirm,backUrl:backUrl,replaceHistory:!g.buyNow,wgCallback:function(t){try{pu.umpReport({bizid:1,operation:8,result:t.errno,source:'0',message:d.dealId+'-'+t.msg,notCombo:true});g.orderObj.timeout3sUnPaycgi.clear();g.loading.hide();}catch(e){}
if(t.errno=='13'){checklogin(t.rurl);}else if(t.errno!='0'){pu.myAlert('支付失败,请稍候再试!');}}});},baitiaoPay:function(d){var _detail=cgi.dealDetail+'?deal_id='+d.dealId+(window.mConfirm?'&sceneval=2':'');if(g.fenqi||g.newBT){payV2.baitiaoPayV2({dealId:d.dealId,fenqi:g.fenqi?g.fenqi.split('_')[1]:'',isM:window.mConfirm,backUrl:cgi.paysuc+'?mfrom=baitiao&dealId='+d.dealId+this.getsucPagJsonStr(),replaceHistory:!g.buyNow,wgCallback:function(t){pu.umpReport({bizid:1,operation:58,result:t.errno,source:'0',message:d.dealId+'-'+t.msg,notCombo:true});if(t.errno!='0'){pu.myAlertV2({msg:'抱歉，支付失败，请到订单页面重新支付',onConfirm:function(){if(!g.buyNow){location.replace(_detail);}else{jump(_detail);}}});}}});}else{payV2.baitiaoPay({dealId:d.dealId,isM:window.mConfirm,backUrl:cgi.paysuc+'?mfrom=baitiao&dealId='+d.dealId+this.getsucPagJsonStr(),replaceHistory:!g.buyNow});}},daiPay:function(d){payV2.daiPay({dealId:d.dealId,img:'//img10.360buyimg.com/n4/'+g.orderObj.products[0].mainSku.image,replaceHistory:!g.buyNow});},payOnLine:function(d){var opt,_dUrl,backUrl;if(cgi.paysuc.indexOf('?')>-1){backUrl='https:'+cgi.paysuc+'&sku='+this.skuidList+'&dealId='+d.dealId+'&fromPay=1';}else{backUrl='https:'+cgi.paysuc+'?sku='+this.skuidList+'&dealId='+d.dealId+'&fromPay=1';}
if(g.isPingou){backUrl+=('&activeid='+g.activeid);}else if(isSkapp||isQuickApp){backUrl=location.protocol+cgi.orderlist+'?tab=3&sid='+g.sid;}
if(window.mConfirm){backUrl+='&sceneval=2';}
backUrl+='&normal=1';opt={dealId:d.dealId,isM:window.mConfirm,replaceHistory:!g.buyNow,wgCallback:function(t){g.loading.hide();if(t.errno!='0'){g.loading.hide();pu.myAlertV2({msg:t.msg||'抱歉，支付失败，请到订单页面重新支付',onConfirm:function(){_dUrl=cgi.dealDetail+'?deal_id='+d.dealId+(window.mConfirm?'&sceneval=2':'');if(!g.buyNow){location.replace(_dUrl);}else{jump(_dUrl);}}});}}}
if(!(this.kaplerSource&&this.kaplerSource!='0')||isSkapp||window.branch_appconfirm){opt.backUrl=backUrl;}
if(window.branch_appconfirm){opt.pscene='confirmapp';opt.backName='订单支付成功';}
payV2.cashier(opt);},appPay:function(d){var that=this,appPayUrl;appPayUrl=cgi.appPay+'?orderId='+d.dealId+'&factPrice='+(this.totalPrice/100).toFixed(2)+'&sku='+this.skuidList+'&activeid='+g.activeid+'&orderType='+d.ordeType+'&appkey='+g.appkey+'&source='+g.appSource+'&customerinfo='+g.customerinfo+(g.isGlobalPay?'&global=1':'');if(g.isWxapp===1&&(g.appSource.indexOf('3_')>-1||g.source.indexOf('3_')>-1)&&g.isPingou){JD.wxapp.goto(appPayUrl,'redirectTo');return;}
if(isJdapp){that.payOnLine(d);}else if((g.isWxapp===0||g.isWxapp===2)&&(g.appSource.indexOf('3_')>-1||g.source.indexOf('3_')>-1)&&g.isPingou){JD.wxapp.isWxapp(function(value){if(value){JD.wxapp.goto(appPayUrl,'redirectTo');}else{that.payOnLine(d);}});}else{that.payOnLine(d);}},showMianmiLayer:function(paytype,paychannel,scene,flag){var self=this,counterStr='',i,_item;$('#mianmiAmt').html(g.miData.rule.perOrderMaxAmt/100);$('#mianmiTime').html(g.miData.rule.perDayTimes);for(i=0;i<g.miData.jdPinList.length;i++){_item=g.miData.jdPinList[i];counterStr+='<dd>账号：'+_item+'</dd>';}
$('#mimiAccount').html(counterStr);$('#wxMianmiLayer, .mod_alert_mask').show();wa('ptagExposure',{ptag:'7039.37.1'});payV2.giveupMianmi({appid:g.appid,isM:window.mConfirm,callback:function(d){pu.umpReport({bizid:1,operation:66,result:d.errno,source:'0',message:d.msg});}});$('#openMianmi').off('click').on('click',function(e){g.miState='2';$('#wxMianmiLayer, .mod_alert_mask').hide();wa('ptagExposure',{ptag:'7039.37.2'});self.createOrder(paytype,paychannel,scene,flag);});$('#notOpenMianmi').off('click').on('click',function(e){g.miState='1';$('#wxMianmiLayer, .mod_alert_mask').hide();g.loading.hide();wa('ptagExposure',{ptag:'7039.37.3'});});},getsucPagJsonStr:function(){try{JD.store.delItem('paysuc_comm');}catch(e){}
var r='',gift='',giftdata='';if(this.products.length==1||g.songli){r=pu.transJson2str({img:'//img10.360buyimg.com/n4/'+this.products[0].mainSku.image,name:this.products[0].mainSku.name,id:this.products[0].mainSku.id});try{JD.store.setItem('paysuc_comm',r,60*24*7);}catch(e){}}else{try{JD.store.delItem('paysuc_comm');}catch(e){}}
if(this.cidList.length>0){this.cidList=this.cidList.unique();giftdata='gift_cid='+this.cidList.join(',')+'&';}
if(this.skuidList){giftdata+='gift_skuid='+this.skuidList+'&';}
if(this.venderidList.length>0){giftdata+='gift_venderid='+this.venderidList.join(',')+'&';}
gift='&'+giftdata;gift+='&payChannel='+this.payChannel;gift+='&cidarr='+this.cidArr.join(',');if(g.jzycwt){gift+='&jzycwt='+g.jzycwt;}
if(g.roomId){gift+='&roomId='+g.roomId;}
if(g.eCard){gift+='&eCard='+g.eCard;}
if($('#shipFeeChou').attr('isDiamond')){gift+='&isDiamond='+$('#shipFeeChou').attr('isDiamond');}
if(window.mConfirm){gift+='&sceneval=2';gift+=('&sid='+g.sid);}
if(this.payType!='5'){gift+='&normal=1';}
gift+='&ptag=7039.27.14';return gift;},showNewPromoPage:function(){promote.initNewPromoPage({cashBackProduct:this.cashBackProduct,mfsuits:this.mfsuits,mzsuits:this.mzsuits,products:this.products,orderPromotion:this.orderPromotion,commlist:g.commlist||g._commlist,iType:this.products[0].mainSku.iType,mzGiftGroup:this.mzGiftGroup,callback:function(){loadDeal('7',0);}});},showSelectShip:function(){ship.shipObj.showSelectShip({action:g.action,orderObj:this,usePcPrice:g.usePcPrice,callback:function(d){g.loadVendinfo=true;loadDeal('7','0');},setSvcCallback:function(){g.loadVendinfo=true;g.svcChange=true;}});},showPayArea:function(){var html='',mpayLocker,ismPayDown=false,_totalPrice,_data,onlyBt=g.fenqi&&!g.notSupBt&&!g.isGlobalPay;if(window.branch_appconfirm){_totalPrice=(this.totalPrice/100).toFixed(2).split('.');$('#appTotalprice').html(_totalPrice[0]);$('#appPriceDigit').html('.'+_totalPrice[1]);$('#appConfirmBar').show();return;}
if(!g.renderPayArea){html=payAddrTpl.child_tplPayArea(this);$('#payArea').html(html);g.renderPayArea=true;JD.store.getItem('payTypeChanel',function(key,value,errObj){switch(value){case 1:$('#btnCodPay').prependTo($('#payBtnList'));break;case 2:break;case 3:$('#btnKuangPay').prependTo($('#payBtnList'));break;case 5:$('#btnBaitiao').prependTo($('#payBtnList'));break;case 4:break;}});}
$('#payBtnList').children().hide();$('#notSup .buy_notsupport_list').children().hide();g.orderObj.showFreeShipTip();if(window.mConfirm&&window.dealLocker){mpayLocker=dealLocker.filter(function(e){return e.mark=='locker_m_pay';});if(mpayLocker&&mpayLocker[0]&&mpayLocker[0].lockvalue=='1'){ismPayDown=true;}}
if(this.totalPrice/100==0){$('#payBtnList, #btnConfirmOrder').show();$('#btnConfirmOrder').siblings().hide();$('#zeroOrderTips').show();return;}
if(isJdjr&&g.isPingou){$('#payBtnList, #btnKuangPay').show();return;}
if(ship.shipObj.getLaOverDay(7)&&!onlyBt){g.selLaTen=true;$('#btnCodPay').hide();$('#codNoSupTip').html('选择送货时间在第8天及以后时不支持货到付款');$('#notSup, #noSupCodTip').show();}else{g.selLaTen=false;}
if((ship.getGByName('selectDD')||ship.getGByName('selectGsd')||ship.getGByName('selectPopGsd'))&&!onlyBt){$('#btnCodPay').hide();$('#codNoSupTip').html((ship.getGByName('selectDD')?'极速达':'同城速配')+'不支持货到付款');$('#notSup, #noSupCodTip').show();}
if(g.useHonorFreight){$('#codNoSupTip').html('京尊达服务暂不支持货到付款');$('#notSup, #noSupCodTip').show();}
if(!ismPayDown&&this.kaplerSource&&this.kaplerSource!='0'&&window.mConfirm){$('#payBtnList, #btnPayOnLine').show();return;}
if(!ismPayDown&&window.mConfirm&&!pu.isWxUserAgent()&&!pu.isMQQUserAgent()&&!g.isGlobalPay){$('#payBtnList, #btnPayOnLine').show();return;}
if(!window.mConfirm&&(g.zcSkuFlag||g.isliangban)&&!onlyBt){$('#payBtnList, #btnZhongChou').show();if(g.isliangban){$('#chouDesc').html('发起量贩团<small>凑齐人数支付，卖家将发货至团长指定地址，由团长分货</small>');}
return;}
if(!window.mConfirm&&window.locker.zhongchou&&!onlyBt){g.orderObj.handleZhongchou();}
if(pu.isWxUserAgent()&&!onlyBt){if(g.miData&&g.miData.payOptions=='2'&&g.orderObj.totalPrice<=g.miData.supportAmt){$('#btnWxPay a').html('微信支付(免密)').css('text-indent','45px');$('#wxpayTip').show();if(!g.bgFlag.wxmianmi){g.bgFlag.wxmianmi=true;wa('ptagExposure',{ptag:'7039.37.4'});}}else{$('#btnWxPay a').html('微信支付').css('text-indent','0');;$('#wxpayTip').hide();}
$('#btnWxPay').show();}else if(!onlyBt){$('#btnWxPay').hide();if(pu.isMQQUserAgent()&&pu.getMQQUserVersion()>=4.5&&!(this.containLoc&&this.containNomal)){$('#btnQQPay').show();if(!g.isGlobalPay&&pu.isToshowWxPay()){$('#btnWxH5Pay').show();g.qqSupWxPay=true;}}else if(!g.isGlobalPay&&!this.containLoc){if(!pu.isMQQUserAgent()&&!isJdjr){$('#btnWxH5Pay').show();}}else if(pu.isMQQUserAgent()&&this.containLoc&&this.containNomal){$('#notSup, #noSupQQPay').show();}
if(pu.isMQQUserAgent()){g.scene='10';}else{g.scene='5';g.isH5=true;}}
if(!window.mConfirm&&!g.isGlobalPay&&!g.songli&&!this.containLoc&&!g.isPingou&&!onlyBt){if(pu.isWxUserAgent()||(pu.isMQQUserAgent()&&pu.getMQQUserVersion()>=4.5)){$('#btnDaiPay').show();}}
if(g.sceneval!='3'&&!onlyBt){_data={producttype:0,tradeamount:this.totalPrice,skuinfos:this.proInfo.join('|'),sourcetype:g.isPingou?'1':'',callback:'favorableinfoCb'}
pu.wrapData(_data);$('#btnKuangPay').show();if(!g.kuangDesData&&!g.loadKuangDesc){g.loadKuangDesc=true;loadJs.loadScript({url:cgi.favorableinfo,data:_data});window.favorableinfoCb=function(d){g.kuangDesData=d;showKuangDesc(d);}}else if(g.kuangDesData){showKuangDesc(g.kuangDesData);}}
if(window.locker.baitiao&&(g.action<='2'||g.action=='22'||g.fenqi)&&!this.containLoc){var btinfoLocker,btlocker=false;if(g.orderObj.totalPrice=='0'||g.isliangban){return;}
if(window.dealLocker){btinfoLocker=dealLocker.filter(function(e){return e.mark=='locker_baitiao';});if(btinfoLocker&&btinfoLocker[0]&&btinfoLocker[0].lockvalue=='1'){btlocker=btinfoLocker[0].scale-((g.uin||'').substr(-2)||100)>0;}}
if(btlocker){if(!g.baitiaoData&&!g.loadBaitiao){g.loadBaitiao=true;payV2.loadBTInfo({action:g.action,isM:window.mConfirm,callback:function(d){g.baitiaoData=d;showBaitiaoV2(d);}});}else if(g.baitiaoData){showBaitiaoV2(g.baitiaoData);}}else{if(!g.baitiaoData&&!g.loadBaitiao){g.loadBaitiao=true;_data={pin:g.pin,callback:'baitiaoDetailCB'};pu.wrapData(_data);loadJs.loadScript({url:cgi.QueryIOUsLimit,data:_data});}else if(g.baitiaoData){showBaitiao(g.baitiaoData);}
window.baitiaoDetailCB=function(json){g.baitiaoData=json;showBaitiao(json);}}}
JD.wxapp.isWxapp(function(value){if(value){$('#btnKuangPay, #btnZhongChou, #NotSup').hide();}});$('#payBtnList').show();function showKuangDesc(kuangData){if(kuangData.errCode=='0'&&kuangData.paypromotiondesc){$('#btnKuangPay a').html('<span>京东支付<small>'+kuangData.paypromotiondesc+'</small></span>');}}
function showBaitiao(baitiaoData){var fenqi=g.fenqi?g.fenqi.split('_'):'';if(baitiaoData.ret==0){if(baitiaoData.data&&baitiaoData.data.availableLimit&&baitiaoData.data.availableLimit-(g.orderObj.totalPrice/100).toFixed(2)>=0){if(fenqi[1]&&fenqi[2]&&fenqi[3]){$('#btnBaitiaoTitle').html(fenqi[2]+'元 x '+fenqi[1]+'期&nbsp;&nbsp;&nbsp;费率'+fenqi[3]+'%');}
$('#btnBaitiao').show();if(g.fenqi&&g.isassetCgi){$('#btnBaitiao').siblings().hide();g.notSupBt=false;g.btShowOtherPay=false;showBTSubTitle();}}else{$('#notSup, #noSupBaitiao').show();$('#baitiaoTip').html('您的京东白条可用额度小于此笔订单金额，无法使用。');$('#openBaitiao').hide().off('click');g.fenqi&&g.isassetCgi&&reRenderPayArea(1);}}else if(baitiaoData.ret==1){$('#notSup, #openBaitiao').show(2);$('#btnBaitiao').hide();g.fenqi&&reRenderPayArea();}else{$('#btnBaitiao').hide();g.fenqi&&g.isassetCgi&&reRenderPayArea(3);}
g.isassetCgi=false;JD.wxapp.isWxapp(function(value){if(value){$('#btnBaitiao, #notSup').hide();}});}
function showBaitiaoV2(baitiaoData){var fenqi=g.fenqi?g.fenqi.split('_'):'';if(baitiaoData.errno==0){if(baitiaoData.data.btstate=='5'){return;}else if(baitiaoData.data.btstate=='4'&&baitiaoData.data.btaccountbalance-g.orderObj.totalPrice>=0){if(fenqi[1]&&fenqi[2]&&fenqi[3]){$('#btnBaitiaoTitle').html(fenqi[2]+'元 x '+fenqi[1]+'期&nbsp;&nbsp;&nbsp;费率'+fenqi[3]+'%');}
$('#btnBaitiao').show();g.newBT=true;if(g.fenqi&&g.isassetCgi){$('#btnBaitiao').siblings().hide();g.notSupBt=false;g.btShowOtherPay=false;showBTSubTitle();}}else if(baitiaoData.data.btstate=='4'){$('#notSup, #noSupBaitiao').show();$('#baitiaoTip').html('您的京东白条可用额度小于此笔订单金额，无法使用。');$('#openBaitiao').hide().off('click');g.fenqi&&g.isassetCgi&&reRenderPayArea(1);}else if(['1','2'].indexOf(baitiaoData.data.btstate)>-1){$('#notSup, #openBaitiao').show(2);$('#btnBaitiao').hide();g.fenqi&&reRenderPayArea();}else if(baitiaoData.data.btstate=='3'){$('#notSup, #noSupBaitiao').show();$('#baitiaoTip').html('未开通支付密码，请您前往[个人中心-账号管理-支付密码管理]设置支付密码后再使用');}else{$('#btnBaitiao').hide();g.fenqi&&g.isassetCgi&&reRenderPayArea(3);}}else{$('#btnBaitiao').hide();g.fenqi&&g.isassetCgi&&reRenderPayArea(3);}
g.isassetCgi=false;JD.wxapp.isWxapp(function(value){if(value){$('#btnBaitiao, #notSup').hide();}});}
if(g.payDescData){showPayDesc(g.payDescData);}else if(!g.loadingPayDesc){loadJs.loadScript({url:'//wq.360buyimg.com/data/ppms/js/ppms.pagev30734.jsonp?t='+Math.random()});g.loadingPayDesc=true;}
window.showPageData30734=function(d){g.payDescData=d;showPayDesc(d);g.loadingPayDesc=false;}
function showPayDesc(d){var btDesc,qqpayDesc,qqpaypinDesc,i;for(i=0;i<d.data.length;i++){if(d.data[i].remark=='baitiao'){btDesc=d.data[i];}else if(d.data[i].remark=='qqpay'){qqpayDesc=d.data[i];}else if(d.data[i].remark=='qqpay_pingou'){qqpaypinDesc=d.data[i];}}
if(btDesc&&pu.isDuringDate(btDesc.startTime,btDesc.endTime)&&!g.fenqi){$('#btnBaitiaoTitle').html(btDesc.content);}
if(g.isPingou&&qqpaypinDesc&&pu.isDuringDate(qqpaypinDesc.startTime,qqpaypinDesc.endTime)){$('#btnQQPay a').html('<span>QQ钱包支付<small>'+qqpaypinDesc.content+'</small></span>');}else if(qqpayDesc&&pu.isDuringDate(qqpayDesc.startTime,qqpayDesc.endTime)){$('#btnQQPay a').html('<span>QQ钱包支付<small>'+qqpayDesc.content+'</small></span>');}}
function showBTSubTitle(){var product=g.orderObj.products[0].mainSku,fenqi=g.fenqi.split('_'),i,_item,_data;_data={num:product.num,skuid:product.id,cat:product.cid.replace(/_/g,','),ven:fenqi[0],price:g.orderObj.totalPrice,suit:g.orderObj.products[0].isTaozhuang?'1':'0',jd:g.vid[0]=='0'?'1':'0',oversea:'0',callback:'btinfoCb'};pu.wrapData(_data);window.btinfoCb=function(d){if(d.errcode!='0'||!d.data||!d.data.planInfos){return;}
for(i=0;i<d.data.planInfos.length;i++){_item=d.data.planInfos[i];if(_item.plan==fenqi[1]){$('#btnBaitiaoTitle').html(_item.curTotal+'元 x '+_item.plan+'期&nbsp;&nbsp;&nbsp;费率'+_item.rate+'%');break;}}}
loadJs.loadScript({url:cgi.btinfo,data:_data});}
function reRenderPayArea(type){var _msg;if(g.notSupBt){return;}
switch(type){case 1:_msg='白条额度不够，请使用其他支付方式支付';break;case 2:_msg='还未开通白条，请使用其他支付方式支付';break;case 3:_msg='获取白条信息失败，请使用其他支付方式支付';break;default:_msg='获取白条信息失败，请使用其他支付方式支付';break;}
if(!g.btShowOtherPay){pu.myAlertV2({msg:_msg});}
g.notSupBt=true;g.orderObj.showPayArea();g.orderObj.handleShipment();g.notSupBt=false;g.btShowOtherPay=true;}},showCuofeng:function(sec){if(g.cuofengData){show(g.cuofengData);}else{loadJs.loadScript({url:'//wq.360buyimg.com/data/ppms/js/ppms.pagev30112.jsonp?t='+Math.random()});}
window.showPageData30112=function(d){g.cuofengData=d;show(d);}
function show(d){var i,item,cfItem,yunfeiItem;$('#redTopBar').hide();for(i=0;i<d.data.length;i++){item=d.data[i];if(pu.isDuringDate(item.startTime,item.endTime)&&item.mark){if(item.mark.indexOf('cf_')>-1){cfItem=item;}else if(item.mark.indexOf('yf_')>-1){yunfeiItem=item;}}}
if(yunfeiItem){JD.store.getItem('yfNotice_close'+yunfeiItem.mark,function(key,value,errObj){if(value!='1'){$('#shipFeeDesc').html(yunfeiItem.content);if(g.supJdPromise&&yunfeiItem.cityList){$('#shipFeeNotice').show();$('#shipFeeNotice em').hide();}else if(!yunfeiItem.cityList){$('#shipFeeNotice').show();}else{$('#shipFeeNotice').hide();}}});$('#noticeClose').off('click').on('click',function(e){$('#shipFeeNotice').hide();JD.store.setItem('yfNotice_close'+yunfeiItem.mark,'1',10*60*24);});$('#shipFeeNotice p').off('click').on('click',function(e){if(yunfeiItem.cityList){var cuofengDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='cuofeng_desc'){cuofengDesc=d[i];break;}}
pu.showDesc({title:cuofengDesc.descTitle,desc:cuofengDesc.extinfo});});}else{var shipNoticeDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='shipfee_notice_desc'){shipNoticeDesc=d[i];break;}}
pu.showDesc({title:shipNoticeDesc.descTitle,desc:shipNoticeDesc.extinfo,confirmText:'知道了'});});}});return;}
if(cfItem&&(ship.getGByName('supSelShipTime')||ship.getGByName('supPick'))){var _addr=pu.getDefAddrFromWqAddr(),_addrId=_addr[1].split('_'),cityArr,closeMark;if(cfItem.mark.indexOf('pick')>0&&!ship.getGByName('supPick')){return;}
if(cfItem.mark.indexOf('pick')>0&&cfItem.cityList){cityArr=cfItem.cityList.split(',');if(!(cityArr.indexOf(_addrId[0])>-1||cityArr.indexOf([_addrId[0],_addrId[1]].join('_'))>-1||cityArr.indexOf([_addrId[0],_addrId[1],_addrId[2]].join('_'))>-1||cityArr.indexOf([_addrId[0],_addrId[1],_addrId[2],_addrId[3]].join('_'))>-1)){return;}}
JD.store.getItem('ship1111_close'+cfItem.mark,function(key,value,errObj){if(value!='1'&&!sec){if(cfItem.mark.indexOf('arrow')>0){$('#redTopBar').addClass('type_arrow');}
$('#redTopBar .order_additional_tips_text').html(cfItem.content);$('#redTopBar').show();}});JD.store.getItem('ship1111_sec_close'+cfItem.mark,function(key,value,errObj){if(value!='1'&&sec){$('#ship1111TipSel p').html(cfItem.content);$('#ship1111TipSel').show();}});$('#redTopBar .order_additional_tips_close').off('click').on('click',function(e){e.stopPropagation();$('#redTopBar').hide();if(cfItem.mark.indexOf('pick')>0){JD.store.setItem('ship1111_close'+cfItem.mark,'1',20);}else{JD.store.setItem('ship1111_close'+cfItem.mark,'1',10*60*24);}});$('#redTopBar').off('click').on('click',function(e){var cuofengDesc;if(!$(this).hasClass('type_arrow')){return;}
pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='doublecf_desc'){cuofengDesc=d[i];}}
pu.showDesc({title:cuofengDesc.descTitle,desc:cuofengDesc.extinfo,});});});$('#ship1111SelClose').off('click').on('click',function(e){e.stopPropagation();JD.store.setItem('ship1111_sec_close'+cfItem.mark,'1',10*60*24);$('#ship1111TipSel').hide();});return;}}},handleShipment:function(){var payment=this.cgiData.order.payment,i,l,j,k,onlineSupLen,codSupLen,offlineSup,that=this,discodesOn=[],discodesOff=[];if(!payment){return;}
if(g.zcSkuFlag||g.isliangban||this.totalPrice/100==0||g.sceneval=='3'||(isJdjr&&g.isPingou)){return;}
if(g.fenqi&&!g.notSupBt){return;}
for(i=0,l=payment.length;i<l;i++){if(payment[i].id=='4'){onlineSupLen=payment[i].supSkuids.length;for(j=0,k=payment[i].supSkuids.length;j<k;j++){discodesOn.push(payment[i].supSkuids[j]+'');}}else if(payment[i].id=='1'){codSupLen=payment[i].supSkuids.length;discodesOff=payment[i].supSkuids;}else if(payment[i].id=='5'){offlineSup=true;}}
if(!g.isGlobalPay){handleCodPay();handleOfflinePay();}
function handleCodPay(){var pingouCodLocker,pgLocker=false,pgSupCod=false;if(window.dealLocker){pingouCodLocker=dealLocker.filter(function(e){return e.mark=='locker_pingou_cod';});if(pingouCodLocker&&pingouCodLocker[0]&&pingouCodLocker[0].lockvalue=='1'){pgLocker=pingouCodLocker[0].scale-((g.uin||'').substr(-2)||100)>0;}}
if(g.isPingou&&pgLocker){pgSupCod=true;}
if(window.param.hasDefAddr){that.isSupCod=false;if(onlineSupLen&&(onlineSupLen==codSupLen)&&(!g.isPingou||pgSupCod)&&!g.selLaTen&&!g.songli&&!ship.getGByName('selShipInstall')&&!ship.getGByName('selectDD')&&!ship.getGByName('selectGsd')&&!ship.getGByName('selectPopGsd')&&!g.useHonorFreight){if(!((that.kaplerSource&&that.kaplerSource!='0')&&that.closeKaplerCodPay=='1')){that.isSupCod=true;$('#btnCodPay').show();wa('ptagExposure',{ptag:'7039.30.6'});}
if(that.kaplerSource&&that.kaplerSource!='0'&&that.closeKaplerCodPay=='0'){that.isSupCod=true;$('#btnCodPay').show();wa('ptagExposure',{ptag:'7039.30.6'});}}else{if((that.kaplerSource&&that.kaplerSource!='0')){$('#btnCodPay').hide();return;}
if(window.addressObj&&window.addressObj.level=='4'&&(window.param.userAction[window.param.userAction.length-1]=='submitAddress'&&(window.param.userAction[window.param.userAction.length-2]=='btnCodPay3LAddr'||window.param.userAction[window.param.userAction.length-2]=='codTipPerfectAddr'))){$('#notSup, noSupCodTip').show();$('#codNoSupTip').html('抱歉，您的乡镇/街道暂未支持货到付款，我们会尽快推进支持。');}else if(window.addressObj&&window.addressObj.level=='3'&&window.addressObj.need_upgrade=='1'){addressObj.mQQCodGuide(window.addressObj);$('#noSupCodTip').hide();}else if(onlineSupLen>=2){if(discodesOff.length>0){discodesOff.forEach(function(i){var index=discodesOn.indexOf(i+'');if(index>=0){discodesOn.splice(index,1);}});if(!g.selLaTen&&!ship.getGByName('selectDD')&&!ship.getGByName('selectGsd')&&!ship.getGByName('selectPopGsd')&&!g.useHonorFreight){$('#notSup, #delForDiscod').show();}
assist.handleDiscod({discodList:discodesOn,productsList:that.products,callback:function(){loadDeal('7','0');}});}else{if(!g.selLaTen&&!ship.getGByName('selectDD')&&!ship.getGByName('selectGsd')&&!ship.getGByName('selectPopGsd')){$('#notSup, #noSupCodTip').show();}}}else if(onlineSupLen==1&&!g.selLaTen&&!ship.getGByName('selectDD')&&!ship.getGByName('selectGsd')&&!ship.getGByName('selectPopGsd')&&!g.useHonorFreight){if(ship.getGByName('selShipInstall')){$('#codNoSupTip').html('送装一体服务不支持货到付款，如使用货到付款方式，请修改安装日期');}else{$('#codNoSupTip').html('订单商品不支持以货到付款方式配送至您的地址');}
$('#notSup, #noSupCodTip').show();}}}else{if((that.kaplerSource&&that.kaplerSource!='0')){$('#btnCodPay').hide();return;}
$('#btnCodPay').show();$('#notSup, #delForDiscod').show();$('#clickCodTip').html('需填写收货地址以判断是否支持货到付款,立即填写');$('#delForDiscod').off('click').on('click',function(e){wa('jdClick',{ptag:'7039.1.79'});window.param.addAddrFromPayPage=true;goPage('pageAddAddress');});}}
function handleOfflinePay(){if(offlineSup&&that.totalPrice>500000&&!that.containLoc&&g.sceneval!='3'&&!(window.mConfirm&&!pu.isWxUserAgent()&&!pu.isMQQUserAgent())&&!ship.getGByName('selectGsd')&&!ship.getGByName('selectPopGsd')&&!g.isCombine){if(that.isForbidCompanyTransfer!='1'){$('#btnOffline').show();if(!g.bgFlag.offline){g.bgFlag.offline=true;wa('ptagExposure',{ptag:'7039.6.11'});}}}else if(window.mConfirm&&that.kaplerSource!='0'&&that.isForbidCompanyTransfer!='1'&&!g.isCombine){$('#btnOffline').show();}else{$('#btnOffline').hide();}
JD.wxapp.isWxapp(function(value){if(value){$('#btnOffline').hide();}});}},handleSvcTip:function(){if(window.param.needChangeAddr&&(ship.getGByName('isSupShipSvc')=='1'||g.isSupShipSvc=='1')){if(ship.getGByName('isSupShipSvc')=='0'){$('#svcTip').html('由于地址变更，送装服务已失效');}else{$('#svcTip').html('由于地址变更，配送服务发生了变化，请核对~');}
g.isSupShipSvc=ship.getGByName('isSupShipSvc');wa('ptagExposure',{ptag:'7039.1.88'});$('#svcTip').show();window.setTimeout(function(){$('#svcTip').hide();},5000);}},productPro:function(product,i,j){var html=fj.formatJson('tpl_productPro',{product:product,buyNow:g.buyNow,ven_ind:i,pro_ind:j});return html;},handlePromTab:function(){var html;html=confirmTplV3.child_promTabTpl(g.orderObj);if(html){if($('#tabPromotionList').length==0){html='<li id="tabPromotionList">'+html+'</li>'
$('#buyDiscountArea li').eq(0).before($(html));}else{$('#tabPromotionList').html(html);}}else if($('#tabPromotionList').length>0){$('#tabPromotionList').remove();}
$('#tabPromotionList').off('click').on('click',function(){goPage('newPromoPage');}).show();},showFaPiaoPage:function(){var barDesc=[];if(ship.getGByName('fpbarTipLoc')){barDesc.push('本地服务');}
if(ship.getGByName('fpbarTipTen')){barDesc.push('视频会员');}
wa('ptagExposure',{ptag:' 7039.28.1'});if(window.mConfirm){if(g.buyNow){if(g.isFreeRegister=='1'){pu.pingClick(true,'MNeworder_CInvoice','B','FromNoReg');}else{pu.pingClick(true,'MNeworder_CInvoice','A','');}}else{pu.pingClick(true,'MNeworder_Invoice','A','');}}
asset.init([{'name':'invoice','dom':'#invoices','action':g.action,'showfpTip':ship.getGByName('fpbarTipLoc')||ship.getGByName('fpbarTipTen'),'barDesc':barDesc.join('、'),'containDepot':this.containDepot,'containPop':this.containPop,'nomalFp':g.orderObj.fpObj,'lineFp':g.orderObj.lineFpObj,'skulist':g.skulist,'normalCallback':function(d,data){wa('jdClick',{ptag:'7039.1.50'});g.selInvoiceType='1';g.fpObj=data;goPage('pagePay');},'vatCallback':function(d,data){wa('jdClick',{ptag:'7039.1.51'});g.vatFpObj=data;g.selInvoiceType='2';},'lineCallback':function(d,data){wa('jdClick',{ptag:'7039.1.32'});g.selInvoiceType='3';g.lineFpObj=data;goPage('pagePay');},}]);},showJdQuanPage:function(){if(window.mConfirm){if(g.buyNow){pu.pingClick(true,'MNeworder_CCoupons','','');}else{pu.pingClick(true,'MNeworder_Coupons','A','');}}
asset.init([{'name':'coupon','dom':'#jdQuanPage','setcouponlist':g.isGlobalPay?cgi.globalPay_setcouponlist:cgi.setcouponlist,'action':g.action,'userCenterLink':userCenterLink,'platprice':g.usePcPrice=='1'?'1':'0','bizval':g.bizval?g.bizval:'','couponData':g.orderObj,'useCallback':function(d){if(d.order&&d.order.orderprice){g.orderObj.updatePrice(d.order.orderprice,true);}
g.couponChange=d.couponChange;g.reloadCFP=true;},'callback':function(d){g.couponChange=false;g.reloadCFP=true;g.orderObj.handleUserasset();$('#jdQuanPage').empty();goPage('pagePay');}}]);},showJdCartPage:function(){var data;if(window.mConfirm&&g.cardType=='card'){if(g.isFreeRegister=='1'){pu.pingClick(true,'MNeworder_Jdcard','','FromNoReg');}else{pu.pingClick(true,'MNeworder_Jdcard','','');}}
data={'name':'card','cardType':'card','dom':'#jdCartPage','action':g.action,'fromBCpage':g.fromBCpage,'userCenterLink':userCenterLink,'userLevel':g.userLevel,'platprice':g.usePcPrice=='1'?'1':'0','cardData':{cardList:g.orderObj.cardList,cannotCardList:g.orderObj.cannotCardList,cardNumObj:{useNum:this.cardNumObj.usableCardNum,unuseNum:this.cardNumObj.unableCardNum,usedNum:this.usedGiftCardNum,maxNum:this.cardNumObj.canUsedCardMaxNum}},'giftDiscount':this.giftDiscount,'scene':'nomal','usedCallback':function(d){g.cardChange=true;if(d.order&&d.order.orderprice){g.orderObj.updatePrice(d.order.orderprice,true);}},'callback':function(){g.cardChange=false;g.orderObj.handleUserasset();$('#jdCartPage').empty();goPage('pagePay');}}
if(g.cardType=='code'){data.cardData={cardList:g.orderObj.codeList,cannotCardList:g.orderObj.cannotCodeList,cardNumObj:{useNum:this.cardNumObj.usableCollarGoodsNum,unuseNum:this.cardNumObj.unableCollarGoodsNum,usedNum:this.consignCardNum,maxNum:this.cardNumObj.canUsedCollarMaxNum}};data.cardType='code';data.consignCardDiscount=this.consignCardDiscount;}
data.paging=true;pu.wrapData(data);asset.init([data]);},handleZhongchou:function(){if((pu.isWxUserAgent()||pu.isMQQUserAgent())&&(g.action==1||(g.action==0&&g.skulist.indexOf(',')==-1))&&this.totalPrice<=1000000&&!g.songli&&!this.containLoc){$('#btnZhongChou').show();}},checkZiti:function(){var zitiObj=g.orderObj.vendersById,zitiSuportCon=true;for(var item in zitiObj){if(zitiObj[item]&&zitiObj[item]._shipzitiObj&&zitiObj[item]._shipzitiObj.addr&&zitiObj[item]._shipzitiObj.addr.siteType){var zitiSiteType=zitiObj[item]._shipzitiObj.addr.siteType;if(zitiObj[item].selectedShip=='shipziti'&&(zitiSiteType=='46'||zitiSiteType=='48')){zitiSuportCon=false;break;}}}
if(!zitiSuportCon){$('#btnCodPay, #btnCodPay3LAddr, #delForDiscod, noSupCodTip').hide();$('#codNoSupTip').html('订单商品不支持以货到付款方式配送至您的地址');$('#notSup, #noSupCodTip').show();}},updateBuyDiscountArea:function(d){var _totalPrice;if(d&&d.order){if(window.branch_appconfirm){_totalPrice=(d.order.orderprice.totalPrice/100).toFixed(2).split('.');$('#appTotalprice').html(_totalPrice[0]);$('#appPriceDigit').html('.'+_totalPrice[1]);}else if(d.order.orderprice){$('#pageTotalPrice').html('&yen;'+(d.order.orderprice.totalPrice/100).toFixed(2));}
g.orderObj.showPayArea();g.orderObj.showTotalShipFee();g.orderObj.bindEvent();g.orderObj.handleShipment();g.orderObj.checkZiti();}},bindEvent:function(){$('#tabPromotionList').off('click').on('click',function(){goPage('newPromoPage');});pu.myBind({src:'#locPhone',fun:function(e,$this){g.locPhone=true;window.param.addAddrFromPayPage=true;addressObj.editAddr(g.orderObj.address.adid,'1',addressObj);$('#pageEditAddress').addClass('loc');}});pu.myBind({src:'.pricetip',fun:function(e,$this){$('#priceTip, .mod_alert_mask').show();pu.myBind({src:'#closePriceTip',fun:function(e,$this){$('#priceTip, .mod_alert_mask').hide();}});}});pu.myBind({src:'#wxpayTip',fun:function(e,$this){var wxpayDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='mianmi_desc'){wxpayDesc=d[i];break;}}
pu.showDesc({title:wxpayDesc.descTitle,desc:wxpayDesc.extinfo,showClose:true,showBtn:false});wa('jdClick',{ptag:'7039.37.7'});});wa('jdClick',{ptag:'7039.37.6'});}});pu.myBind({src:'#zhongChouTip',fun:function(e,$this){var zcDesc,lbDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='liangban_desc'){lbDesc=d[i];}
if(d[i].title=='zhongchou_desc'){zcDesc=d[i];}}
if(g.isliangban){pu.showDesc({title:lbDesc.descTitle,desc:lbDesc.extinfo,showClose:true,showBtn:false});}else{pu.showDesc({title:zcDesc.descTitle,desc:zcDesc.extinfo,showClose:true,showBtn:false});}});wa('jdClick',{ptag:'7039.1.34'});}});pu.myBind({src:'#offlineTip',fun:function(e,$this){var offlineDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='offline_desc'){offlineDesc=d[i];break;}}
pu.showDesc({title:offlineDesc.descTitle,desc:offlineDesc.extinfo,showClose:true,showBtn:false});});}});pu.myBind({src:'#daifuTip',fun:function(e,$this){var daipayDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='daipay_desc'){daipayDesc=d[i];break;}}
pu.showDesc({title:daipayDesc.descTitle,desc:daipayDesc.extinfo,showClose:true,showBtn:false});});wa('jdClick',{ptag:'7039.1.80'});}});$('#openBaitiao').off('click').on('click',function(){var open_url=window.mConfirm?cgi.mOpenBaitiaoUrl:cgi.openBaitiaoUrl;wa('jdClick',{ptag:'7039.1.77'});if(g.userLevel==0){pu.myConfirm({'msg':'开通白条要求您的账号信息完整，请您先补充手机号等信息。','icon':'info','okText':'取消','cancelText':'确定','onCancel':function(){location.href=userCenterLink;}});}else if(PayPassObj.on||PayPassObj.shortOn){var _custom=encodeURIComponent(location.href),_url;if(pu.isWxUserAgent()){_url='//s.jr.jd.com/baitiaoTencent/index.action?source=weixin2';}else{_url='//s.jr.jd.com/baitiaoTencent/index.action?source=qq';}
_url=encodeURIComponent(_url+'&jumpToUrl='+_custom);jump(open_url+'?biz=jdbt&url='+_url+(window.mConfirm?'&sceneval=2':'')+'&r='+Math.random());}else{pu.myConfirm({msg:'开启京东白条需要设置京东支付密码',icon:'info',okText:'取消',cancelText:'立即设置',noCancel:false,extclass:'',onConfirm:null,onCancel:function(){jump(PayPassObj.getPasswordCgi());}});}});$('#tabInvoices').off('click').on('click',function(){if($(this).hasClass('noclick')){return;}
goPage('faPiaoPage');});if(pu.isWxUserAgent()){this.bindWxPayEvent();$('#btnWxPay a').off('click').on('click',function(e){try{if(!(typeof window.WeixinJSBridge=='object'&&typeof window.WeixinJSBridge.invoke=='function')){pu.umpReport({bizid:1,operation:92,result:'1',source:'0',message:'notReady'});}}catch(e){}});}
$('#btnZhongChou').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.12'});if(g.isliangban){g.orderObj.createOrder('2','','');return;}
pu.myConfirm({'msg':'向好友要礼物，若24小时内无人理会则礼物失效；48小时内未付清尾款，礼物同样失效。','okText':'取消','cancelText':'确定','onCancel':function(){g.orderObj.createOrder('2','','');}});});$('#zcRule').off('click').on('click',function(){wa('jdClick',{ptag:'7039.1.34'});setTimeout(function(){location.href='//wqs.jd.com/my/chou/illustrate.shtml';},200);});$('#btnDaiPay').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.11'});g.loading.show();g.orderObj.createOrder('3','','');});$('#btnConfirmOrder').off('click').on('click',function(){pu.myConfirm({'msg':'是否确认提交订单？','icon':'info','okText':'取消','cancelText':'确定','onCancel':function(){wa('jdClick',{ptag:'7039.1.35'});g.loading.show();g.orderObj.createOrder('0','2','');}});});$('#btnQQPay').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.8'});g.loading.show();g.orderObj.createOrder('0','4','10');});$('#btnWxH5Pay').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.17'});g.loading.show();g.orderObj.createOrder('0','2','9');});$('#btnTenpay').off('click').on('click',function(){g.orderObj.createOrder('0','1','5');});$('#btnKuangPay').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.9'});g.loading.show();g.orderObj.createOrder('0','3','');});$('#btnBaitiao').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.10'});g.loading.show();g.orderObj.createOrder('0','5','');});$('#btnCodPay').off('click').on('click',function(){var shipParam=ship.shipObj.getShipData()
if(window.mConfirm){wa('jdClick',{ptag:'7039.30.5'});}
if(ship.getGByName('needSetShip')&&!ship.getGByName('modifyShip')){g.loading.hide();wa('jdClick',{ptag:'7039.11.10'});if($('#freshJzd').length>0&&$('#freshJzd').css('display')!='none'){$('#freshJzd').click();return;}}
if(window.param.hasDefAddr){if(!g.orderObj.checkAddr()){return;}
if(PayPassObj.need){pwd=PayPassObj.getmd5();if(!pwd){return false;}}
_data={paytype:'1',ship:shipParam[0],pick:shipParam[1],paychannel:'0',reg:'1',action:g.action}
if(g.usePcPrice=='1'){_data.platprice=1;}
pu.wrapData(_data);pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':_data,'success':function(d){g.setCodDateParam=_data;_handle(d);},'error':function(id,msg,d){pu.myAlert('货到付款支付失败，请稍后再试或使用在线支付~');}});}else{pu.myAlert('需填写收货地址',function(){window.param.addAddrFromPayPage=true;goPage('pageAddAddress');},'立即填写');}
function _handle(d){var price,fee,showReaptMod=false;g.orderObj.payType='1';if(d.order.orderprice){price=d.order.orderprice.totalPrice;fee=d.order.orderprice.shippingFee;}else{price=d.order.totalPrice;fee=d.order.shippingFee;}
function calcelEvent(){$('#codGoPayCancel, #codGoPayCancel2').off('click').on('click',function(){$('#codFloat, .mod_alert_mask').hide();wa('jdClick',{ptag:'7039.1.6'});if(_data){_data.paytype=0;pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':_data,'success':function(d){g.setCodDateParam=false;}});}
return false;});}
calcelEvent();$('#codFloat, .mod_alert_mask').show();$('#cod_total').html((price/100).toFixed(2));$('#cod_yun_nouse').html(fee>0?'&yen;'+(fee/100).toFixed(2):'免运费');$('#codGoPay').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.13'});$('#codFloat, .mod_alert_mask').hide();g.orderObj.createOrder('1','0','','noRepeat');return false;});}});$('#btnOffline').off('click').on('click',function(){var shipParam=ship.shipObj.getShipData();if(window.param.hasDefAddr){if(!g.orderObj.checkAddr()){return;}
if(PayPassObj.need){pwd=PayPassObj.getmd5();if(!pwd){return false;}}
_data={paytype:'5',ship:shipParam[0],pick:shipParam[1],paychannel:'0',reg:'1',action:g.action}
if(g.usePcPrice=='1'){_data.platprice=1;}
pu.wrapData(_data);pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':_data,'success':function(d){g.setCodDateParam=_data;_handle(d);}});}else{pu.myAlert('需填写收货地址',function(){window.param.addAddrFromPayPage=true;goPage('pageAddAddress');},'立即填写');}
function _handle(d){g.orderObj.payType='5';$('#offCancel').off('click').on('click',function(){if(_data){_data.paytype=0;pu.loadCgi({'cgi':g.isGlobalPay?cgi.globalPay_setpayship2:cgi.setpayship2,'data':_data,'success':function(d){g.setCodDateParam=false;$('#offlinConfirm, .mod_alert_mask').hide();}});}
return false;});$('#offlinConfirm, .mod_alert_mask').show();$('#offSure').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.14'});$('#offlinConfirm, .mod_alert_mask').hide();g.orderObj.createOrder('5','0','','noRepeat');return false;});}});$('#btnPayOnLine').off('click').on('click',function(){wa('jdClick',{ptag:'7039.30.4'});if(g.orderObj.kaplerSource&&g.orderObj.kaplerSource!='0'&&window.mConfirm){g.orderObj.createOrder('0','6','');}else{g.orderObj.createOrder('0','1','');}});$('#appConfirm').off('click').on('click',function(e){g.orderObj.createOrder('0','2','');});pu.myBind({'src':'.c_zeng','fun':function(e,$this){var html='',pro_ind=$this.attr('pro_ind'),ven_ind=$this.attr('ven_ind');html=confirmTplV3.child_tplItemDetail(g.orderObj.venders[ven_ind].products[pro_ind]);$('#itemPromoPage').html(html);goPage('itemPromoPage');barSlider('itemPromoPage');}});pu.myBind({'src':'#conponListTab','fun':function(e,$this){if($(this).hasClass('disabled')){return;}
goPage('jdQuanPage');wa('jdClick',{ptag:'7039.1.21'});}});pu.myBind({'src':'#jdCartTab','fun':function(e,$this){wa('jdClick',{ptag:'7039.1.67'});if(!g.orderObj.cardNumObj){pu.oneLineTip({msg:'点太快啦~~'});return;}
g.cardType='card';goPage('jdCartPage');}});pu.myBind({'src':'#codeTab','fun':function(e,$this){if(!g.orderObj.cardNumObj){pu.oneLineTip({msg:'点太快啦~~'});return;}
g.cardType='code';goPage('jdCartPage');}});pu.myBind({'src':'[shipType]','fun':function(e,$this){if(!$this.attr('shipType')){return;}
if(ship.getGByName('needSetShip')){wa('jdClick',{ptag:'7039.11.8'});}
g.orderObj.selectShip={'venderId':$this.attr('venderid')};if($this.attr('combind')){g.orderObj.combind=$this.attr('combind');}else{g.orderObj.combind='';}
wa('ptagExposure',{ptag:'7039.11.15'});goPage('selectShip');}});pu.myBind({'src':'#freshJzd,[type="deliveryTimePopGsd"]','fun':function(e,$this){wa('jdClick',{ptag:'7039.11.9'});ship.shipObj.handleForceJzd({vender:g.orderObj.vendersById[$this.attr('venderid')],zxjJsdTipFee:g.orderObj.zxjJsdTipFee,action:g.action,orderObj:g.orderObj,updatePrice:g.orderObj.updatePrice,shipType:$this.attr('data-shiptype')})}});pu.myBind({'src':'.layer_photo','fun':function(e,$this){var tag=$this.attr('tag');if(tag==='crossRegionNeedPay'){wa('jdClick',{ptag:'7039.32.2'});pu.showDesc({title:'调货服务说明',desc:'为方便用户购买商品，当商品在本地无货时，支持从异地调货，需要加收调货服务费。',confirmText:'我知道了'});}else if(tag==='overWeightProduct'){wa('jdClick',{ptag:'7039.1.47'});g.orderObj.showShipFeeDetail();}}});pu.myBind({src:'.buy_msg_v2 input',type:'input',fun:function(e,$this){var num=$this.val().length,af=$this.next(),len=45;if(num>=len){num=len;af.addClass('warn');$this.val($this.val().substr(0,len));}else{af.removeClass('warn');}
af.html(num+'/'+len);}});pu.myBind({src:'#supshipinIcon',fun:function(e,$this){pu.myAlert('送装一体服务和您的配送地址、配送及安装时间有关，'+'如您修改了以上信息，导致订单可能无法支持送装一体服务，请您谅解')}});$('.order_info_guarantee[type="refund"] .order_info_guarantee_price').off('click').on('click',function(e){var rType=$(this).attr('rType'),venderId=$(this).attr('venderId'),_data;if(rType=='1'){return}
$(this).toggleClass('selected');_data={checkflag:$(this).hasClass('selected')?'1':'0',venderid:venderId,reg:'1',callback:'freightinsureCb'};pu.wrapData(_data);loadJs.loadScript({url:cgi.freightinsure,data:_data});window.freightinsureCb=function(d){if(d.errId=='0'){g.orderObj.handleShipeffect();}
console.log(d);}});$('.order_info_guarantee[type="refund"] .info').off('click').on('click',function(e){var refundDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='refund_desc'){refundDesc=d[i];break;}}
pu.showDesc({title:refundDesc.descTitle,desc:refundDesc.extinfo,showClose:true,showBtn:false});});});$('.order_info_guarantee[type="wrap"] .order_info_guarantee_price').off('click').on('click',function(e){var select=$(this).hasClass('selected');_data={selectFlag:select?'0':'1',reg:'1',callback:'selloopPackageCb'};pu.wrapData(_data);loadJs.loadScript({url:cgi.selloopPackage,data:_data});window.selloopPackageCb=function(d){if(d.errId=='0'){g.orderObj.handleShipeffect();}else{pu.myAlertV2({msg:d.errMsg});}}});$('.order_info_guarantee[type="wrap"] .info').off('click').on('click',function(e){var venderid=$(this).closest('.order_info_guarantee').attr('venderid'),combVid=$(this).closest('.order_info_guarantee').attr('combvid')||'',pItem,supArr=[],notSupArr=[],pHtml;for(i=0;i<g.recyclePackage.length;i++){pItem=g.recyclePackage[i];if(pItem.venderId==venderid||combVid.split('_').indexOf(pItem.venderId)>-1){supArr=supArr.concat(pItem.listSupportPackingSKU);notSupArr=notSupArr.concat(pItem.listUnSupportPackingSKU);}}
pHtml=confirmTplV3.child_loopPackageTpl({supArr:supArr,notSupArr:notSupArr});$('#loopPackage').html(pHtml).show();$('#packageKnown').off('click').on('click',function(e){$('#loopPackage').hide();});});$('#beanCancel, #beanExchange').off('click').on('click',function(e){var chgId,curId=$(this).attr('id'),iType=$(this).parent().attr('itype'),beanPromoId=g.orderObj.products[0].jdBeanPromo.promoId;if(curId=='beanCancel'){chgId=-1;wa('jdClick',{ptag:'7014.24.2'});}else if(curId=='beanExchange'){chgId=beanPromoId;wa('jdClick',{ptag:'7014.24.1'});}
promote.changePromo({chgId:chgId,iType:iType,lastPid:g.orderObj.orderPromotion.selectPromotion[0]?g.orderObj.orderPromotion.selectPromotion[0].pid:'',commlist:g.commlist||g._commlist,callback:function(d){if(curId=='beanCancel'){pu.oneLineTip({msg:'取消兑换成功'});}else{pu.tipShow({msg:'兑换优惠成功，单个商品价格已优惠&yen;'+
(g.orderObj.products[0].jdBeanPromo.discount/100).toFixed(2),time:2000});}
g.loadVendinfo=true;loadDeal('7','0');}});});$('.arrow_btm').off('click').on('click',function(e){var pPrice=$(this).attr('plusprice'),jdPrice=$(this).attr('jdprice'),curPrice=$(this).attr('curPrice')/1,itype=$(this).attr('itype');$('#plusPrice .price').html(pPrice);$('#jdPrice .price').html(jdPrice);if(curPrice==pPrice/1){$('#plusPrice').addClass('selected').siblings().removeClass('selected');}else{$('#jdPrice').addClass('selected').siblings().removeClass('selected');}
$('#plusPriceChange, .mod_alert_mask').show();$('#plusPriceChange .addressChoosing_list li').attr('itype',itype);});$('#plusPriceChange .addressChoosing_list').off('click').on('click','li',function(e){var _id=$(this).attr('id'),chgId,iType=$(this).attr('itype');$('#plusPriceChange, .mod_alert_mask').hide();if($(this).hasClass('selected')){return;}
promote.changePromo({chgId:_id=='plusPrice'?-1:-101,iType:iType,lastPid:g.orderObj.orderPromotion.selectPromotion[0]?g.orderObj.orderPromotion.selectPromotion[0].pid:'',commlist:g.commlist||g._commlist,callback:function(d){g.loadVendinfo=true;loadDeal('7','0');}});});$('#plusPriceChange .close').off('click').on('click',function(e){$('#plusPriceChange, .mod_alert_mask').hide();});if(pu.getOs().versions.ios){pu.myBind({'type':'focus','src':'#shortPassInput','fun':function(e,$this){if($('#topFixedDiv').hasClass('fixed')){g.canFixed=false;$('#topFixedDiv').removeClass('fixed');$('#topFixedDiv').css('position','relative');}}});pu.myBind({'type':'blur','src':'#shortPassInput','fun':function(e,$this){if(g.canFixed===false){$('#topFixedDiv').css('position','');$('#topFixedDiv').addClass('fixed');g.canFixed=true;}}});}
$('.m_header_bar_back').off('click').on('click',function(e){var hash=location.hash.split('|')[0],tag=hash.replace(/#/g,'');wa('jdClick',{ptag:'7039.27.34'});if(g.pages.indexOf(tag)==-1){tag='pagePay';}
if(tag=='pagePay'){pu.myConfirm({'msg':'便宜不等人，请三思而行','icon':'none','okText':'我再想想','cancelText':'去意已决','onCancel':function(){wa('jdClick',{ptag:'7039.27.36'});history.back();},'onConfirm':function(){wa('jdClick',{ptag:'7039.27.35'});}});}else{history.back();}});$('.m_header_bar_menu').off('click').on('click',function(e){$(this).toggleClass('show');$('#headnav').toggle();});$('.type_index').off('click').on('click',function(e){location.href=cgi.m_home+'?sid='+g.sid;});$('.type_search').off('click').on('click',function(e){location.href=cgi.m_search+'?sid='+g.sid;});$('.type_shopcart').off('click').on('click',function(e){location.href=cgi.m_cart+'?sid='+g.sid;});$('.type_my').off('click').on('click',function(e){location.href=cgi.m_user+'?sid='+g.sid;});$('#osProtocal').off('click').on('click',function(e){e.stopPropagation();location.href=cgi.overseaProtocal;});$('#overseaDiv').off('click').on('click',function(e){$(this).toggleClass('selected');});$('#gpProtocal').off('click').on('click',function(e){e.stopPropagation();location.href=cgi.globalPayProtocal;});$('#globalPayDiv').off('click').on('click',function(e){$(this).toggleClass('selected');});$(window).off('scroll').on('scroll',function(){var st=$(window).scrollTop(),barHeight=$('#yellowBar').height(),hash=location.hash.split('|')[0],tag=hash.replace(/#/g,'');if(g.pages.indexOf(tag)==-1){tag='pagePay';}
if(st>barHeight&&g.canFixed){$('#topFixedDiv').addClass('fixed');}else{$('#topFixedDiv').removeClass('fixed');}
if(tag=='pagePay'){g.curHeight=st;}
if(tag=='jdCartPage'){asset.cardOnScroll(g.orderObj.cardNumObj);}});},bindWxPayEvent:function(){pu.myBind({src:'#btnWxPay',fun:function(e,$this){g.loading.show();wa('jdClick',{ptag:'7039.30.7'});if(g.miData&&g.miData.payOptions=='2'&&g.orderObj.totalPrice<=g.miData.supportAmt){wa('jdClick',{ptag:'7039.37.5'});}
g.orderObj.createOrder('0','2','9');}});},showNewUserTip:function(){var hasRun=false,times=0,_hasAsset=false,that=this;function _fun(hasAsset){var p={wid:g.uin,sceneid:12310,tipId:'newUserTip',defaultHtml:_defaultHtml,hasAsset:false,risk:that.riskValue,version:3,skuList:that.skuidList,callback:function(d){if($('#douYellowBar').hasClass('dShow')){$('#newUserTip').hide();}
userCenterLink=d.url;window.userCenterLink=d.url;g.userObj=d;}},_sid=12310;if(pu.isMQQUserAgent()){_sid=42310;}
p.sceneid=_sid;times+=1;if(hasAsset){_hasAsset=true}
if(!hasRun&&hasAsset){hasRun=true;var _defaultHtml=false;p.hasAsset=true;pu.getPinStatus(p);}
if(times==3&&!_hasAsset){p.hasAsset=false;pu.getPinStatus(p);}}
return _fun;},showTotalShipFee:function(){var html=payAddrTpl.child_tplFeeDetail(this);$('#feeDetail').html(html);if(this.isAbord&&this.onlySamsWalmart){$('#shipFeeDetail').hide();}
this.showFreeShipTip();pu.myBind({src:'#shipFeeDetail',fun:function(e,$this){wa('jdClick',{ptag:'7039.1.46'});g.orderObj.showShipFeeDetail();}});pu.myBind({src:'#taxFeeDetail',fun:function(e,$this){g.orderObj.showTaxFeeDetail();}});pu.myBind({src:'#gstFeeDetail',fun:function(e,$this){var gestDesc;pu.loadPPMSData(function(d){for(var i=0;i<d.length;i++){if(d[i].title=='gest_desc'){gestDesc=d[i];break;}}
pu.showDesc({title:gestDesc.descTitle,desc:gestDesc.extinfo});});}});pu.myBind({src:'#shipFeeDiscount',fun:function(e,$this){g.orderObj.showShipFeeDiscount();}});},showShipFeeDetail:function(){var shipFeePopArr=[],shipfeeJdObj,shipFeePopObj,jdVname=[],i,item,shipFeeDetailObj={},html,popShipFee=0,venderFreightObj={};for(i=0;i<this.venderFreight.length;i++){item=this.venderFreight[i];venderFreightObj[item.venderId]=item;}
for(i=0;i<this.venders.length;i++){var venderId=this.venders[i].venderId;var _vender=g.orderObj.vendersById[venderId];var venderType=_vender&&_vender.venderType;if(venderFreightObj[venderId]){item=venderFreightObj[venderId];}else if(venderId=='0'||venderType=='0'||venderType=='1'){item=venderFreightObj['0'];}
if((venderId=='0'||venderType=='0'||venderType=='1')&&_vender&&_vender.isSams=='0'&&_vender.isWalmart!='1'){if(venderId=='0'){shipfeeJdObj=item;if(this.venders[i].containFactory&&this.venders[i].containZY){jdVname.push('京东自营和厂商配送');}else if(this.venders[i].containFactory){jdVname.push('厂商配送');}else{jdVname.push('京东自营');}}else{jdVname.push(g.orderObj.vidObj[venderId]);if(!shipfeeJdObj){shipfeeJdObj=item;}}}else if(!(_vender.isSupShipSvc=='1'&&_vender.selShipSvc)){shipFeePopObj=item;shipFeePopObj.vName=g.orderObj.vidObj[venderId];if(_vender.isSams=='1'){shipFeePopObj.isSams='1';}
if(_vender.isWalmart=='1'){shipFeePopObj.isWalmart='1';}
shipFeePopArr.push(shipFeePopObj);popShipFee+=item.freight/1;}
if(shipfeeJdObj){shipfeeJdObj.vName=jdVname.join('、');shipFeeDetailObj.jdDetail=shipfeeJdObj;shipFeeDetailObj.selectGsd=ship.getGByName('selectGsd');}
shipFeeDetailObj.popDetail=shipFeePopArr;shipFeeDetailObj.popShipFee=popShipFee;shipFeeDetailObj.orderObj=this;}
html=confirmTplV3.child_shipFeeDetailTpl(shipFeeDetailObj);$('.mod_alert_mask').show();$('#shipFeeContent').html(html).show();pu.myBind({src:'#shipFeeClose',fun:function(e,$this){$('#shipFeeContent, .mod_alert_mask').hide();}});pu.myBind({src:'.detailRule',fun:function(e,$this){wa('jdClick',{ptag:'7039.12.3'});jump(cgi.extraYunfeiRule+'?detail=1');}});},showTaxFeeDetail:function(){var html=confirmTplV3.child_taxFeeTpl({products:this.products,orderTaxAmount:this.orderTaxAmount});$('#taxFee').html(html).addClass('show');pu.myBind({src:'#taxConfirm, #taxClose',fun:function(e,$this){$('#taxFee').removeClass('show');}});},showShipFeeDiscount:function(){var _discoutObj={overseaPromotionFreight:this.overseaPromotionFreight,overseaPromotionBookFreight:this.overseaPromotionBookFreight,overseaPromotionTotalFreight:this.overseaPromotionTotalFreight}
var html=confirmTplV3.child_shipFeeDiscountTpl(_discoutObj);$('.mod_alert_mask').show();$('#shipfeeDiscount').html(html).show();pu.myBind({src:'#shipDisKnown',fun:function(e,$this){$('#shipfeeDiscount, .mod_alert_mask').hide();}});},showFreeShipTip:function(){if(g.vid.length>0||g.isGlobalPay||window.locker.ContractMachineConfirm||this.containFresh||g.isPingou||ship.getGByName('selectGsd')||ship.getGByName('selectPopGsd')){return;}
var that=this,_data;try{JD.store.setItem('initindex','',null,null,null,true);}catch(e){}
if((this.baseShipFee>0||this.pickShipFee>0)&&this.shippingFee/100==this.baseShipFee/100+this.pickShipFee/100){var jdAddrId=cookies.get('wq_addr')?cookies.get('wq_addr').split('|')[1]:'',jdAddrid1=jdAddrId?jdAddrId.split('_')[0]:'',jdAddrid2=jdAddrId?jdAddrId.split('_')[1]:'';if(!jdAddrid1||jdAddrid1=='32'||jdAddrid1=='52993'){return;}
if(g[jdAddrId]&&!g.reloadCFP){_showCoudan(g[jdAddrId]);}else{if(g.loadCfp){return;}
g.loadCfp=true;_data={locationid:jdAddrId.replace(/_/g,'-'),userlevel:'',freightconfig:'0_0_'+this.cidArr.join('^').replace(/_/g,';'),reg:'1',callback:'freightConfigCb'};pu.wrapData(_data);loadJs.loadScript({url:cgi.cfp,data:_data});window.freightConfigCb=function(d){g.loadCfp=false;g.reloadCFP=false;if(d.errId!='0'){return;}
g[jdAddrId]={weight:(d.weight/1000).toFixed(3),coudanPrice:d.coudanPrice,price:d.price};_showCoudan(g[jdAddrId]);}}}else{$('#shipFeeChou').attr('isDiamond','');$('#couBar').hide();}
function _showCoudan(d){$('#freeShipFeeTip').html('想省运费，再购买&yen;'+(d.coudanPrice/100).toFixed(2)+'即可免运费').parent().parent().show();$('#shipFeeChou').attr('isDiamond','0');if(!g.coudanBg){g.coudanBg=true;wa('ptagExposure',{ptag:'7039.1.91'});}
pu.myBind({src:'#couBar',fun:function(e,$this){wa('jdClick',{ptag:'7039.1.90'});jump(cgi.yunfeimoreitem+'?zySkus='+g.skulist+'&yfPrice='+(d.price/100-d.coudanPrice/100).toFixed(2)+'&yfWeight='+(g.orderObj.jdVenderWeight/1000).toFixed(3)+'&freightconfig='+'0_0_'+
that.cidArr.join('^').replace(/_/g,';')+(window.mConfirm?'&sceneval=2':''));}});}}};function handleOrderData(d){PayPassObj=asset.initPayPass();g.userLevel=d.userLevel;if(!d.order.orderprice){pu.umpReport({bizid:1,operation:87,result:1,source:'0',message:'no orderprice node'});d.order.orderprice=g.orderprice;}
g.orderObj=new Order(d);g.orderObj.creatProducts();g.orderObj.handleDefAddr();if(!g.ismodifynum){g.orderObj.showInPage();}
g.orderObj.rShowNewUserTip=g.orderObj.showNewUserTip();g.orderObj.handleShipeffect();if(!window.mConfirm){g.orderObj.handleAssitInfo();}
g.orderObj.handleShipment();g.orderObj.handleSvcTip();g.orderObj.showCuofeng();g.orderObj.showTotalShipFee();g.orderObj.bindEvent();window.param.needChangeAddr=false;if(!g.ismodifynum){window.scrollTo(0,0);}
if(window.branch_appconfirm){pu.getUnpl(function(unpl){g.unpl=unpl;});}
g.ismodifynum=false;g.orderObj.timeout3sConfirm=pu.getTimeOutObj({time:3000,name:'confirm接口3秒超时',errmsgId:10});g.orderObj.timeout3sWxPaycgi=pu.getTimeOutObj({time:3000,name:'微信支付接口3秒超时',errmsgId:10});g.orderObj.timeout3sQQPaycgi=pu.getTimeOutObj({time:3000,name:'手Q支付接口3秒超时',errmsgId:10});g.orderObj.timeout3sUnPaycgi=pu.getTimeOutObj({time:3000,name:'网银+支付接口3秒超时',errmsgId:10});}
function handleGlobalAgree(){$('#agreePin').html(eval('"'+g.pin+'"'));$('.mod_alert_mask, #agreeDesc').show();$('#agreeDesc').show();$('#agreeCheck').off('change').on('change',function(e){var agreeCheck;agreeCheck=$('#agreeCheck').prop('checked');if(agreeCheck){$('#agreeTip').hide();$('#agreeSure').removeClass('disabled');}else{$('#agreeTip').show();$('#agreeSure').addClass('disabled');}});$('#agreeCancel').off('click').on('click',function(e){history.back();});$('#agreeSure').off('click').on('click',function(e){var _data;if($('#agreeCheck').prop('checked')){window.cbSetGbuyAut=function(d){pu.umpReport({bizid:1,operation:65,result:d.errId,source:'0',message:d.errMsg||''});if(d.errId=='0'){$('.mod_alert_mask, #agreeDesc').hide();cmdyop='0';g.useshipData='0';g.reset=true;g.firstRender=false;g.initDiscoutArea=true;loadDeal('7','0');}else{$('.mod_alert_mask, #agreeDesc').hide();pu.myAlert(d.errMsg.replace('全球购','海囤全球'));}};g.loading.show();_data={callback:'cbSetGbuyAut',flag:'1'}
pu.wrapData(_data);loadJs.loadScript({url:cgi.SetGbuyAut,data:_data});}else{return false;}});$('#globalAgreeLink').off('click').on('click',function(){location.href='//jdw.jd.hk/rules.html';});$('#ebayagreeLink').off('click').on('click',function(){location.href='//wqs.jd.com/my/agreement/ebay_agree.shtml';});$('#enterAgreeLink').off('click').on('click',function(){location.href='//wqs.jd.com/my/agreement/enter_agree.shtml';});}
function loadDeal(infoType,paytype,skulist,callback){var addr=pu.getDefAddrFromWqAddr(),_useaddr='0',data,cgiUrl;ship.setGByName({name:'supSelShipTime',value:false});if(window.param.needChangeAddr){ship.setGByName({name:'modifyShip',value:false});g.reset=true;_useaddr='1';if(window.param.changeAddrInList){_useaddr='2';window.param.changeAddrInList=false;}}
g.needLoadAssist=true;ump_showinfo=false;window.cbOrderinfo=function(d){clearTimeout(orderinfoCgiErrTimer);g.loadVendinfo=false;if(callback){callback(d);}else{handleDealCB(d,data);}};data={callback:'cbOrderinfo',action:g.action||0,type:g.type||'0',useaddr:_useaddr,addressid:addr[0]||'0',dpid:g.dpid,addrType:'1',paytype:paytype||'0',firstin:g.setDefCoupon?'1':'0',scan_orig:g.scan_orig,reg:'1'};if(skulist){data.skuidlist=skulist;}
window.locker.ContractMachineConfirm=false;if(window.locker.ContractMachine&&(g.feetype!=''||g.flowType!='')){data.feetype=g.feetype||g.flowType;data.packs=g.packs;data.skus=g.skus;data.action=2;window.locker.ContractMachineConfirm=true;}
if(window.locker.SupBuyOne&&g.commlist){data.commlist=g.commlist;if(g.ybcommlist){data.ybcommlist=g.ybcommlist;}
if(g.jdhscommlist){data.jdhscommlist=g.jdhscommlist;}
data.action=1;data.cmdyop=cmdyop;data.locationid=g.locationid;if(g.commlist&&g.commlist.split(',').length>=4){g.commlistSkuid=g.commlist.split(',')[3];if(g.globalbuy>0){g.isGlobalPay=true;}}}
if(window.locker.pingou&&(g.bizval||g.bizkey||g.activeid)){var pin_skuid='';data.bizval=g.bizval;data.bizkey=g.bizkey;data.activeid=g.activeid;if(g.commlist&&g.commlist.split(',').length>=4){pin_skuid=g.commlist.split(',')[3];}
if(g.bizkey=='pingou'&&g.bizval!='0'){data.action=3;cgi.paysuc='//wqs.jd.com/pingou/detail.shtml?sku='+pin_skuid+'&activeid='+g.activeid+'&fromPay=1&';if(g.cpsd){cgi.paysuc+=('d='+g.cpsd+'&');}
g.isPingou=true;window.isPingou=true;}
wa('jdClick',{ptag:'7145.15.1'});}
data.clearbeancard=g.firstVisit;cgiUrl=cgi.view;if(g.isGlobalPay){data.action=6;cgiUrl=cgi.globalPay_view;}
if(g.global=='1'){g.isGlobalPay=true;data.action=5;cgiUrl=cgi.globalPay_view;}
if(g.isPingou&&g.isGlobalPay){data.action=17;}
if(!window.param.getDefaultAddr||g.loadVendinfo){cgiUrl=g.isGlobalPay?cgi.globalPay_venderinfo:cgi.venderinfo;g.venderCgi=true;data.skulist=g.skulist||'';data.token2=g.token2||'';}else{data.wqref=encodeURIComponent(document.referrer)||'';}
if(g.eCard){data.action=10;}
if(g.songli){data.action=22;cgi.paysuc='//wqs.jd.com/my/success/songlisuc.shtml';}
if(g.songli&&g.isGlobalPay){data.action=23;cgi.paysuc='//wqs.jd.com/my/success/songlisuc.shtml';}
if(g.rurl){cgi.paysuc=g.rurl;}
if(g.jzycwt){data.jzycwt=g.jzycwt;}
if(g.skufrom&&['ol','od1','od2'].indexOf(g.skufrom)>=0){data.repeat=1;}
pu.wrapData(data);g.action=data.action>0?data.action:0;cmdyop=2;if(window.locker.preData&&g.usePageData==1){if(window.dealData){handleDealCB(window.dealData,data);}else{waitDealData(10);}}else{orderinfoCgiErrTimer=window.setTimeout(function(){pu.umpReport({bizid:1,operation:86,result:'0',source:'0',message:'ok'});},5e3);loadJs.loadScript({url:cgiUrl,data:data});}
function waitDealData(dealWTime){waitDataTimer=window.setTimeout(function(){if(window.dealData){handleDealCB(window.dealData,data);}else{waitDealData(50);}},dealWTime);}}
window.handleDealCB=function(d,data){waitDataTimer&&clearTimeout(waitDataTimer);var wqLogid,data=data,_bizid=1,_operid;window.param.idCardErrMsg='';g.usePageData=0;if(window.branch_appconfirm){_bizid=145;_operid=32;}else if(window.mConfirm){_bizid=488;_operid=1;}else if(g.isGlobalPay&&g.venderCgi){_operid=60;}else if(g.isGlobalPay){_operid=61;}else if(g.venderCgi){_operid=81;}else{_operid=80;}
pu.umpReport({bizid:_bizid,operation:_operid,result:d.errId,source:'0',message:d.errMsg});g.venderCgi=false;g.loading.hide();if(d.errId=='0'){try{wqLogid=cookies.get('wq_logid');if(wqLogid){wa('jdClick',{wq_logid:wqLogid});}}catch(e){}
data.firstin='0';g.orderviewQuerData=data;if(g.commlist){modifyNumObj.saveVar(d);}
g.firstVisit=0;g.usePcPrice=d.order.usePcPrice;g.pin=d.pin?d.pin:g.pin;g.appid=d.appid?d.appid:g.appid;g.addressErr=false;g.isChgArea=d.order.isChgArea||d.order.isSamChgArea;if(g.mptype==0){g.mptype=d.mptype;}
g.skulist=d.skulist?d.skulist:g.skulist;g.token2=d.token2?d.token2:g.token2;g.zcSkuFlag=d.zcSkuFlag=='1'?true:false;g.closeKaplerCodPay=d.closeKaplerCodPay||g.closeKaplerCodPay||'';g.kaplerSource=d.kaplerSource||g.kaplerSource||'';g.kaplerTitleShow=d.kaplerTitleShow||g.kaplerTitleShow||'';if(d.order.orderprice){g.orderprice=d.order.orderprice;}
if(!d.order.invoice){d.order.invoice=g.orderObj.invoice;}
if(!d.order.address){pu.umpReport({bizid:1,operation:95,result:1,source:'0',message:'no_address'});}
if(d.order.orderprice&&d.order.orderprice.totalPrice===''){pu.umpReport({bizid:1,operation:96,result:1,source:'0',message:'no_price'});}
if(!g.bgFlag.fanli&&d.skulist&&d.kaplerChannel=='30a8d67966b144ada41ad1ce3f4b0972'){g.bgFlag.fanli=true;pu.imgReq(cgi.fanliReport+'?sku='+d.skulist.replace(/,/g,'_'));}
window.setTimeout(function(){var id;if(ump_showinfo){id='0'}else{id='1';}
pu.umpReport({bizid:1,operation:24,result:id,source:'0',message:'ok:'+id});},3000);handleOrderData(d);loadMianmiData();if(g.isPingou&&!g.pingouInfoLoaded){loadPingouInfo();}}else if(d.errId=='13'){checklogin(d.nextUrl);}else if(g.isGlobalPay&&(d.errId=='120043'||d.errId=='9001')){handleGlobalAgree();}else if(d.errId=='8970'&&window.mConfirm){pu.myAlertV2({msg:d.errMsg,onConfirm:function(){history.back();}});}else{if(/^(8727|8728|8472)$/.test(d.errId)){g.addressErr=true;window.param.needChangeAddr=false;g.useshipData='0';g.reset=true;g.firstRender=false;g.initDiscoutArea=true;handleOrderData(d);pu.oneLineTip({msg:'请完善地址信息'});}else if(d.errMsg=='获取用户订单信息失败'){pu.myAlert(d.errMsg,function(){if(g.binded){jump(cgi.jdshopcart);}else{history.back();}});}else if(d.errId=='8970'){pu.myAlert('购物车无商品或未选中商品，请添加商品到到购物车或选择购物车中的商品',function(){if(g.binded){jump(cgi.jdshopcart);}else{history.back();}});}else if(/^(6147|6152)$/.test(d.errId)){g.useshipData='0';g.reset=true;g.firstRender=false;g.initDiscoutArea=true;loadDeal('7','0');}else if(d.errId=='8995'&&g.commlistSkuid){location.replace(cgi.miaoUrl+'?scene=jd&src='+g.src+'&commlist=,,1,'+g.commlistSkuid);}else if(d.errId=='8982'){pu.myAlert('该商品为拼购商品，可返回拼购商品详情页面以拼购价格购买。',function(){jump('//wqs.jd.com/my/pingou/buy.shtml?sku='+d.order.invalidSkus[0]);},'返回拼购详情页');}else{pu.myAlert(d.errMsg.replace('全球购','海囤全球'),function(){history.back();});}}}
function loadPingouInfo(){data={sku_id:g.skulist,client_id:'100',tuan_id:0,active_id:g.activeid,biz_value:g.bizval,jointype:0,from:g.skufrom}
if(pu.isMQQUserAgent()){data.platform=1;}else if(pu.isWxUserAgent()){data.platform=2;}else if(isJdapp){data.platform=3;}else{data.platform=3;}
assist.loadPingouInfo(data,function(active_status){g.pingouInfoLoaded=true;});}
function loadMianmiData(){if(!window.locker.mianmi||g.loadMianmi||!pu.isWxUserAgent()||g.isGlobalPay){return;}
payV2.getMianmi({appid:g.appid,itemType:g.isGlobalPay?'3':'2',callback:function(d){if(d.errcode!='0'){return;}
g.miData=d.data;if(d.data.payOptions=='2'&&g.orderObj.totalPrice<=d.data.supportAmt){$('#btnWxPay a').html('微信支付(免密)').css('text-indent','45px');;$('#wxpayTip').show();}else{$('#btnWxPay a').html('微信支付').css('text-indent','0');;$('#wxpayTip').hide();}}})
g.loadMianmi=true;}
function triggerWxAddrJs(callback){if(typeof window.WeixinJSBridge=='object'&&typeof window.WeixinJSBridge.invoke=='function'){callback();}else{document.addEventListener('WeixinJSBridgeReady',callback,false);}}
function show(){var tipHtml='';if(!g.point3){window._PFM_TIMING[3]=new Date();g.point3=true;}
tipHtml=confirmTplV3.child_tipTpl();$('#tipDiv').html(tipHtml);if(g.pages.indexOf(location.hash.split('|')[0].replace('#',''))>-1){location.hash='';}
loadDeal('7','0');}
function showPagePay(){var defAddr=addressCom.getDefAddrFromCookie();g.loading.hide();if(defAddr[0]==''){loadDeal('7','0');}
if(g.couponChange){g.orderObj.handleUserasset();g.couponChange=false;}else if(ship.getGByName('shipChange')){ship.setGByName({name:'shipChange',value:false});if(g.isGlobalPay){loadDeal('7','0');}else{g.orderObj.handleShipeffect();}}else if(g.svcChange||ship.getGByName('installChange')){g.svcChange=false;ship.setGByName({name:'installChange',value:false});g.loadVendinfo=true;loadDeal('7','0');}else if(promote.getGByName('changePromote')){promote.setGByName({name:'changePromote',value:false});loadDeal('7','0');}else if(g.cardChange){g.orderObj.handleUserasset();g.cardChange=false;}
$('select').blur();}
exports.show=function(){try{show();}catch(ea){pu.umpReport({bizid:1,operation:10,result:1,source:'0',message:ea.message+';'+pu.obj2str2(ea.stack)});}};exports.showpageAddAddress=function(){addressObj.showAddAddressPage();};exports.showpageEditAddress=function(){addressObj.showPageEditAddress();};exports.showpagePay=function(){showPagePay();};exports.shownewPromoPage=function(){g.orderObj.showNewPromoPage();};exports.showfaPiaoPage=function(){g.orderObj.showFaPiaoPage();};exports.showaddressList=function(){window.param.userAction.push(this.id);g.loading.show();addressObj.loadAddressList();};exports.showjdQuanPage=function(){g.orderObj.showJdQuanPage();};exports.showjdCartPage=function(){g.orderObj.showJdCartPage();};exports.showselectShip=function(){g.orderObj.showSelectShip();};$(window).on('hashchange',function(e){try{doHashChange();}catch(ea){pu.umpReport({bizid:1,operation:10,result:1,source:'0',message:ea.message+';'+pu.obj2str2(ea.stack)});}});window.onload=function(){var _href=location.href,cidArr;g.windowLoaded=true;if(_href.indexOf('mshopcart')>0||_href.indexOf('cart.action')>0||(window.mConfirm&&(_href.indexOf('wareId')<0))){cidArr=g.orderObj?g.orderObj.cidArr:'';assist.reportCartData(cidArr);}
assist.reportDelayData();assist.reportPerformance();assist.setEid();if(window.mConfirm&&g.orderObj&&g.orderObj.kaplerSource&&g.orderObj.kaplerSource!='0'&&isMQQBrowser&&!pu.isMQQUserAgent()&&!pu.isWxUserAgent()){pu.loadonJS(cgi.qqLogin,function(){if(window.browser&&window.browser.live){if(window.browser.live.isQQBrowserLogined){try{window.browser.live.isQQBrowserLogined({appID:35},function(succ){if(succ.result=='0'){assist.setUserInfo();}});}catch(e){assist.setUserInfo();}}else{assist.setUserInfo();}}else{assist.setUserInfo();}});}
if(window.getTakId){g.rtk=window.getTakId();}}
function checkGlobalFirstBuy(){var cgiURL=cgi.globalFirstBuyQuery;var cgiData={callback:'firstbuyqueryCb',reg:1,action:g.action,reset:1};pu.wrapData(cgiData);window[cgiData.callback]=function(rsp){if(rsp&&rsp.errCode=='0'){g.globalFirstBuyFlag=rsp.checkFlag;}};loadJs.loadScript({url:cgiURL,data:cgiData});}
function showGlobalFirstBuyToast(createOrderCb){var domWrap=document.querySelector(".wx_wrap")||document.body;var domMain=document.createElement('div');domMain.className='mod_alert mod_alert_info show fixed';domMain.innerHTML='<h3 class="title">下单人信息</h3><p class="tip">因海关规定，购买跨境商品需下单人与支付人信息一致，请完善当前下单人身份信息。</p><div class="input_wrap_v2"><div class="text">姓名</div><input type="text" maxlength="30" placeholder="请输入姓名" tag="inputName"></div><div class="input_wrap_v2"><div class="text">身份证</div><input type="text" maxlength="18" placeholder="请输入身份证号码" tag="inputIDCard"></div><p class="tip color_red" tag="error_tip"></p><p class="btns"><a href="javascript:void(0)" class="btn btn_2" tag="cancel_btn">取消</a><a href="javascript:void(0)" class="btn btn_1" tag="confirm_btn">确认提交</a></p>';domWrap.appendChild(domMain);var domMask=document.createElement('div');domMask.className='mod_alert_mask show';domWrap.appendChild(domMask);domMain.querySelector('[tag="cancel_btn"]').onclick=function(){clear();g.loading.hide();};domMain.querySelector('[tag="confirm_btn"]').onclick=function(){var result=checkInput();if(result.msg.length>0){setTip(result.msg);return;}
setTip('');g.loading.show();var cgiURL=cgi.globalFirstBuy;var cgiData={callback:'firstbuyCb',name:encodeURIComponent(result.name),cardid:result.idCard,reg:1,action:g.action,reset:1};pu.wrapData(cgiData);window[cgiData.callback]=function(rsp){g.loading.hide();if(rsp&&rsp.errCode=='0'){clear();g.globalFirstBuyFlag='1';createOrderCb();}else if(rsp&&rsp.errCode=='13'){checklogin(rsp.nextUrl);}else{setTip(rsp.errMsg);}};loadJs.loadScript({url:cgiURL,data:cgiData});};function clear(){domWrap.removeChild(domMain);domWrap.removeChild(domMask);domWrap=null;domMain=null;domMask=null;}
function setTip(msg){domMain.querySelector('p[tag="error_tip"]').innerText=msg;}
function checkInput(){var msg='';var domInputName=$(domMain.querySelector('[tag="inputName"]'));var nameReg1=/[\?&~\^\*%\$\"\']/g;var nameReg2=/[\*\/\+\\\$\^\.;<>"={}@]/g;var nameReg3=/[^\w+\u4E00-\u9FA5，。《》、？；：‘”“·！￥……（）——~`!#\$%\^&\*\(\)_\-\+=\.,\?<>:;\/\\\{\}\[\]\"\' ]/g;var inputName=domInputName.val()||'';var validName=inputName.replace(nameReg1,'').replace(nameReg2,'').replace(nameReg3,'').trim();domInputName.val(validName);var tempName=inputName.replace(/[\u4E00-\u9FA5\uF900-\uFA2D]/g,'aaa');if(tempName.length===0){msg='姓名不能为空';}else if(tempName.length<3){msg='姓名过短';}else if(tempName.length>30){msg='姓名必须少于等于10个汉字';}else if(/^[A-Za-z· ]{3,30}$/.test(tempName)===false){msg='姓名只能输入中文和字母';}
var domInputIDCard=$(domMain.querySelector('[tag="inputIDCard"]'));var idCard=(domInputIDCard.val()||'').trim();domInputIDCard.val(idCard);if(idCard.length===0){msg=msg===''?'请填写身份证信息':msg;}else if(pu.checkUserId(idCard)!==''){msg=msg===''?'请填写正确身份证号码':msg;}
return{msg:msg,name:validName,idCard:idCard,};}}
window.confirm_badJs=function(ea){pu.umpReport({bizid:1,operation:10,result:1,source:'0',message:ea.message+';'+pu.obj2str2(ea.stack)});};});
modulejs('wq.confirmV3', function (m){
    m.show();
});